/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/m/DynamicDateUtil","sap/ui/comp/util/DateTimeUtil","sap/ui/core/format/DateFormat","../utils/AppConstants","sap/ui/model/odata/v2/ODataModel"],function(e,t,a,r,i,n,o){function l(a,r,i){var n=a.descriptorContent["sap.card"].configuration.parameters;var l=a.descriptorContent["sap.card"]["data"]["request"];var p=false,v={},m={};if(l&&l.batch){p=true;v=l.batch.header||{};m=l.batch.content||{}}var d=a&&n._headerDataUrl,T=a&&n._contentDataUrl;var g=new t;var h=n._relevantODataFilters.value;var S=n._relevantODataParameters.value;var D=n._semanticDateRangeSetting,y=[];if(D){D=JSON.parse(D.value);y=Object.keys(D)||[]}h.forEach(function(e){var a=new t(n[e].value);var r=a.getSelectOption(e);var i=[];if(r&&r.length){if(y.includes(e)){i=c(r[0],"Filter");if(i.length){r[0].Low=i[0];r[0].High=i[1]?i[1]:null;if(r[0].Low&&r[0].High&&r[0].Option!=="BT"){r[0].Option="BT"}g.massAddSelectOption(e,r)}else if(o&&o.prototype.formatValue&&r[0]){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}}else{if(o&&o.prototype.formatValue&&r[0]&&n[e].type==="datetime"){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}g.massAddSelectOption(e,r)}}});S.forEach(function(e){var t="";if(n[e].value&&typeof n[e].value==="string"){t=n[e].value.toString()}else if(n[e].value.value){t=n[e].value.value.toString()}else if(n[e].value&&n[e].value instanceof Date){t=n[e].value}if(n[e].type==="datetime"&&!y.includes(e)&&!t.includes("datetime")){if(o&&o.prototype.formatValue){t=o.prototype.formatValue(t,"Edm.DateTime");g.addParameter(e,t)}}else if(n[e].type==="datetime"&&y.includes(e)){t=c(t,"Parameter");g.addParameter(e,t[0])}else{g.addParameter(e,t)}});var E=n._entitySet.value;var A=E;if(S.length){var O={};S.forEach(function(e){O[e]=n[e].type});A+=e.getParameterQueryFromSV(g,O);var H=A;if(H&&Array.isArray(H.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&H.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){A=f(H)}}if(n._urlSuffix.value){A+=n._urlSuffix.value}var L={};h.forEach(function(e){L[e]=n[e].type});var N=e.getFilterQueryFromSV(g,L);var Q=N;if(Q&&Array.isArray(Q.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&Q.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){N=f(Q)}var _="",R="",x="",I="",w={header:"",content:""};if(p){_=s(n,"_header",N,a.descriptorContent["sap.card"].type);R=_?A+"?"+_:A;if(d&&d.value){var F=u(y,R);if(F){v.url="{= extension.formatters.formatHeaderDataUrlForSemanticDate() }";d.value=""}else{d.value=R;if(r){r._headerDataUrl=d.value}}}else if(d){w.header=R}}if(n._contentDataUrl){x=s(n,"_content",N,a.descriptorContent["sap.card"].type);I=x?A+"?"+x:A;if(n._contentDataUrl.value){var M=u(y,I);if(M){if(p){m.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}else{l.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}T.value=""}else{T.value=I;if(r){r._contentDataUrl=T.value}}}else{w.content=I;return w}if(i){w.header=R;w.content=I;return w}}}function u(e,t){var a=e.length?e:[];if(a.length&&t){return a.some(function(e){return t&&t.indexOf(e)>-1})}}function s(e,t,a,r){var i=[];if(a){i.push(a)}if(e[t+"SelectQuery"]&&e[t+"SelectQuery"].value){i.push(e[t+"SelectQuery"].value)}if(e[t+"ExpandQuery"]&&e[t+"ExpandQuery"].value){i.push(e[t+"ExpandQuery"].value)}if(e[t+"SortQuery"]&&e[t+"SortQuery"].value){var n=e[t+"SortQuery"].value;i.push(decodeURI(n)===n?encodeURI(n):n)}if(r==="Table"||r==="List"){i.push("$inlinecount=allpages");i.push("$skip=0&$top=13")}else{if(e[t+"TopQuery"]&&e[t+"TopQuery"].value){i.push(e[t+"TopQuery"].value)}if(e[t+"SkipQuery"]&&e[t+"SkipQuery"].value){i.push(e[t+"SkipQuery"].value)}}return i.length?i.join("&"):null}function f(e){var t=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length;var a=function(){var t=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0];var a=t;a=a.replace("%27","");var r=a.lastIndexOf("%27");var i=a.substr(0,r)+a.substr(r+3,a.length-1);return i};for(var r=0;r<t;r++){e=e.replace(e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0],a)}return e}function c(e,t){var r,i=[],o=[];if(t==="Parameter"){r=e}else if(t==="Filter"){e=typeof e==="string"?JSON.parse(e):e;r=e.Low;if(n.DATE_OPTIONS.SPECIAL_RANGE.includes(r)){i=e.High.split(",")}}var l;if(n.DATE_OPTIONS.RANGE_OPTIONS.includes(r)||n.DATE_OPTIONS.SINGLE_OPTIONS.includes(r)){if(t==="Filter"){l=a.toDates({values:i,operator:r});o.push(l[0].oDate);o.push(l[1].oDate)}else{l=a.toDates({values:i,operator:r});o.push(l[0].oDate)}}if(o.length){o=p(o,true);return o}else if(Date(e)instanceof Date||e instanceof Date||Date.parse(e)){return p([e],true)}return[]}function p(e,t){var a;e.forEach(function(n,o){if(n.match){if(n.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm)&&n.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm).length){n=new Date(n)}}n=r.localToUtc(n);n=r.normalizeDate(n,true);if(t){a=i.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:"Gregorian"});e[o]=a.format(n,true)}else{var l=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var u=n instanceof Date?n:new Date(n);var s=l.format(u);e[o]=String(s).replace(/'/g,"")}});return e}function v(e,t,r){var i=r;if(e&&t){var n=e.operator;if(n!=="DATE"){return n}else{return e.values[0]}}if(!t){var o=e.operator;var l=e.values;var u="";if(o){switch(o){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"DATETIMERANGE":u="";if(typeof i==="string"){u=i}var s=a.toDates(e);l=s;var f=p(l,false);if(!f[1]){f[1]=""}var c={Low:f[0],High:f[1],Option:"BT",Text:u};if(c){c.Text=u;return c}break;case"FROM":case"TO":case"FROMDATETIME":case"TODATETIME":u="";if(typeof i==="string"){u=i}var v=p(l,false),m;m=o==="FROM"||o==="FROMDATETIME"?"GE":"LE";var d={Low:v[0],High:"",Option:m,Text:u};if(d){d.Text=u;return d}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":u="";if(typeof i==="string"){u=i}return{Low:o,High:l[0].toString(),Option:"BT",Text:u};case"TODAYFROMTO":u="";if(typeof i==="string"){u=i}var T=l&&l[0];var g=l&&l[1];return{Low:o,High:T.toString()+","+g.toString(),Option:"BT",Text:u};default:u="";if(typeof i==="string"){u=i.substring(0,i.indexOf("(")-1)}return{Low:o,High:null,Option:"EQ",Text:u}}}}}return{processPrivateParams:l,formatSemanticDateTime:c,getDateRangeValue:v}});
//# sourceMappingURL=UrlGenerateHelper.js.map