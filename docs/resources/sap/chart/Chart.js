/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/chart/library","sap/viz/ui5/controls/VizFrame","sap/viz/ui5/controls/common/BaseControl","sap/viz/ui5/data/Dataset","sap/viz/ui5/data/FlattenedDataset","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/chart/data/Dimension","sap/chart/data/TimeDimension","sap/chart/data/HierarchyDimension","sap/chart/data/Measure","sap/ui/model/analytics/ODataModelAdapter","sap/chart/utils/RoleFitter","sap/chart/utils/ChartUtils","sap/chart/utils/ChartTypeAdapterUtils","sap/chart/utils/DateFormatUtil","sap/chart/utils/DataSourceUtils","sap/chart/utils/SelectionAPIUtils","sap/chart/utils/MeasureSemanticsUtils","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/analytics/odata4analytics","sap/ui/Device","sap/chart/TimeUnitType","sap/chart/coloring/Colorings","sap/chart/ChartLog","sap/chart/pagination/PagingController","sap/ui/core/LocaleData","sap/ui/core/Control","sap/ui/core/BusyIndicatorUtils","sap/ui/core/theming/Parameters","sap/chart/SeriesColorTracker","sap/viz/ui5/format/ChartFormatter","sap/chart/utils/ValueAxisScaleUtils","sap/chart/AutoScaleMode","sap/chart/ScaleBehavior","sap/viz/ui5/utils/CommonUtil","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,i,r,a,s,n,o,l,h,u,c,d,g,p,f,m,y,v,_,S,b,D,C,P,V,z,F,A,x,T,M,k,N,B,O,E,I,U,R,jQuery){"use strict";var w=e.SelectionBehavior,j=e.SelectionMode;var L=i.extend("sap.chart.Chart",{metadata:{library:"sap.chart",designtime:"sap/chart/designtime/Chart.designtime",properties:{chartType:{type:"string",defaultValue:"bar"},uiConfig:{type:"object",group:"Misc"},visibleDimensions:{type:"string[]",defaultValue:[]},inResultDimensions:{type:"string[]",defaultValue:[]},visibleMeasures:{type:"string[]",defaultValue:[]},vizProperties:{type:"object",group:"Misc"},vizScales:{type:"object[]",group:"Misc"},isAnalytical:{type:"boolean"},selectionBehavior:{type:"sap.chart.SelectionBehavior",defaultValue:w.DataPoint},selectionMode:{type:"sap.chart.SelectionMode",defaultValue:j.Multi},enablePagination:{type:"boolean",defaultValue:false},enableStableColor:{type:"boolean",defaultValue:false},enableScalingFactor:{type:"boolean",defaultValue:false},customMessages:{type:"object",defaultValue:null},colorings:{type:"object",defaultValue:null},activeColoring:{type:"object",defaultValue:null},valueAxisScale:{type:"object",defaultValue:null}},aggregations:{data:{type:"sap.ui.core.Element",multiple:true,bindable:"bindable"},_vizFrame:{type:"sap.viz.ui5.controls.VizFrame",multiple:false,visibility:"hidden"},dimensions:{type:"sap.chart.data.Dimension",multiple:true},measures:{type:"sap.chart.data.Measure",multiple:true}},events:{drilledDown:{parameters:{dimensions:{type:"string[]"}}},drilledUp:{parameters:{dimensions:{type:"string[]"}}},renderComplete:{},selectData:{},deselectData:{},valueAxisFixedScaleTurnedOff:{},drillStackChanged:{}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t).style("width",t.getWidth()).style("height",t.getHeight()).openEnd().renderControl(t.getAggregation("_vizFrame")).close("div")}}});L.getMetadata().getAggregation("data")._doesNotRequireFactory=true;function H(e){return e.indexOf("%")!==-1?"100%":e}L.prototype.setHeight=function(e){this.setProperty("height",e);var t=this._getVizFrame();if(t){t.setHeight(H(this.getProperty("height")))}return this};L.prototype.setWidth=function(e){this.setProperty("width",e);var t=this._getVizFrame();if(t){t.setWidth(H(this.getProperty("width")))}return this};L.prototype.setChartType=function(e,t){this.setProperty("chartType",e,t);this._sAdapteredChartType=e;this._bIsPagingChartType=g.CONFIG.pagingChartTypes.indexOf(e)>-1;if(this._isEnablePaging()){this._getPagingController().init(false)}else{var i=this._getDataset();if(i){i.setPagingOption(null);i.setRange(-1,-1)}}this._invalidateBy({source:this,keys:{vizFrame:true}});this._bNeedToApplyDefaultProperties=true;return this};L.prototype.setColorings=function(e){this.setProperty("colorings",e);this._invalidateBy({source:this,keys:{vizFrame:true,checkBinding:true}});return this};L.prototype.setActiveColoring=function(e){this.setProperty("activeColoring",e);this._invalidateBy({source:this,keys:{vizFrame:true,checkBinding:true}});return this};L.prototype.setValueAxisScale=function(e){this._bEnbableValueAxisScale=true;this.setProperty("valueAxisScale",e);if(this._oValueScaleSetting&&this._oValueScaleSetting.fireValueAxisFixedScaleTurnedOff){this._oValueScaleSetting.fireValueAxisFixedScaleTurnedOff=false;this._oValueScaleSetting.resetValueAxisScale=true}this._invalidateBy({source:this,keys:{vizFrame:true}});return this};L.prototype._setValueAxisScale=function(){var e=this.getValueAxisScale(),t=!this._rendered&&!!e,i=!(this._mNeedToUpdate["binding"]&&this._oValueScaleSetting)&&this._bEnbableValueAxisScale;if(t||i){if(!this._bEnbableValueAxisScale){this._bEnbableValueAxisScale=true}this._oValueScaleSetting=O.getValueAxisScaleSetting(this.getChartType(),e,this.getMeasures(),this.getVisibleMeasures())}};L.prototype._getValueAxisScaleSetting=function(){return this._bEnbableValueAxisScale?this._oValueScaleSetting||{}:{}};L.prototype._validateValueScaleOnDimChange=function(e,t){if(t&&this._oValueScaleSetting){var i=this.getValueAxisScale();if(i&&i.scaleBehavior===I.FixedScale){var r=[];e.forEach(function(e){var i=t.indexOf(e);if(i<0){r.push(e)}else{t.splice(i,1)}});r=r.concat(t);if(r.length>0){var a=false,s=this.getChartType();if(g.isStackedLikeChart(s)){a=true;r.forEach(function(e){if(e._getFixedRole()!=="series"){a=false}})}if(!a){this._oValueScaleSetting.fireValueAxisFixedScaleTurnedOff=true;i.scaleBehavior=I.AutoScale;this.setProperty("valueAxisScale",i);this.fireValueAxisFixedScaleTurnedOff();if(this._oValueScaleSetting.resetValueAxisScale){i=this.getValueAxisScale();this.setProperty("valueAxisScale",i)}this._oValueScaleSetting=O.getValueAxisScaleSetting(s,i,this.getMeasures(),this.getVisibleMeasures())}}else{this._oValueScaleSetting=O.getValueAxisScaleSetting(this.getChartType(),i,this.getMeasures(),this.getVisibleMeasures())}}}};L.prototype.removeDimension=function(e){var t=this._getVisibleDimensions()||[];var i;if(this.getIsAnalytical()===false&&e&&e.getName()){i=t.indexOf(e.getName());if(i!==-1){R.error('Data source does not support aggregation. The method "removeDimension" therefore cannot be used!');return}}var r=this.removeAggregation("dimensions",e);if(r){i=t.indexOf(r.getName());if(i!==-1){t.splice(i,1);this.setVisibleDimensions(t)}var a=this.getInResultDimensions()||[];i=a.indexOf(r.getName());if(i!==-1){a.splice(i,1);this.setInResultDimensions(a)}}return r};L.prototype.removeAllDimensions=function(){var e;if(this.getIsAnalytical()===false){R.error('Data source does not support aggregation. The method "removeAllDimensions" therefore cannot be used!')}else{e=this.removeAllAggregation("dimensions");this.setVisibleDimensions([]);this.setInResultDimensions([])}return e};L.prototype.destroyDimensions=function(){var e;if(this.getIsAnalytical()===false){R.error('Data source does not support aggregation. The method "destroyDimensions" therefore cannot be used!')}else{e=this.destroyAggregation("dimensions");this.setVisibleDimensions([]);this.setInResultDimensions([])}return e};L.prototype.removeMeasure=function(e){var t=this.removeAggregation("measures",e);if(t){var i=this._getVisibleMeasures()||[],r=i.indexOf(t.getName());if(r!==-1){i.splice(r,1);this.setVisibleMeasures(i)}}return t};L.prototype.removeAllMeasures=function(){var e=this.removeAllAggregation("measures");this.setVisibleMeasures([]);return e};L.prototype.destroyMeasures=function(){var e=this.destroyAggregation("measures");this.setVisibleMeasures([]);return e};L.prototype._getVisibleDimensions=function(e){var t=this._getDrillStateTop();var i=t?t.dimensions:this.getProperty("visibleDimensions");return e?this._normalizeDorM(i,true):i};L.prototype.getVisibleDimensions=function(){var e=this._getVisibleDimensions();return this._aFeeds?e.filter(function(e){return this._aFeeds._unused.indexOf(e)===-1},this):e};L.prototype._getVisibleMeasures=function(e){var t=this._getDrillStateTop();var i=t?t.measures:this.getProperty("visibleMeasures");return e?this._normalizeDorM(i):i};L.prototype.getVisibleMeasures=function(){var e=this._getVisibleMeasures();return this._aFeeds?e.filter(function(e){return this._aFeeds._unused.indexOf(e)===-1},this):e};L.prototype.setVisibleDimensions=function(e,t){var i=this._dimensionSanityCheck({visible:e});this.setProperty("visibleDimensions",e,t);this.setProperty("inResultDimensions",i.inResult,t);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this};L.prototype.setInResultDimensions=function(e,t){var i=this._dimensionSanityCheck({inResult:e});this.setProperty("inResultDimensions",e,t);this.setProperty("visibleDimensions",i.visible,t);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this};L.prototype.setVisibleMeasures=function(e,t){this.setProperty("visibleMeasures",e,t);var i=this._getDrillStateTop();if(!this._bIsInitialized){this._createDrillStack()}else{i.measures=this.getProperty("visibleMeasures")}this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this};L.prototype.setEnableStableColor=function(e){e=!!e;if(this.getProperty("enableStableColor")!==e){this.setProperty("enableStableColor",e);this._invalidateBy({source:this,keys:{vizFrame:true}})}return this};L.prototype.setEnablePagination=function(e,t){if(!this._bIsInitialized){this.setProperty("enablePagination",e,t);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}})}return this};L.prototype._dimensionSanityCheck=function(e){var t=e.visible||this.getVisibleDimensions()||[],i=e.inResult||this.getInResultDimensions()||[];var r=[].concat(t).concat(i).reduce(function(e,r){var a=t.indexOf(r)!==-1,s=i.indexOf(r)!==-1;if(a&&s){e.common[r]=true}else if(a){e.visible[r]=true}else if(s){e.inResult[r]=true}return e},{visible:{},inResult:{},common:{}});r.visible=Object.keys(r.visible);r.inResult=Object.keys(r.inResult);r.common=Object.keys(r.common);return r};L.prototype._prepareFeeds=function(){if(!this._aFeeds){var e=this._normalizeDorM(this._getVisibleDimensions(),true),t=this._normalizeDorM(this._getVisibleMeasures(),false),i=this._normalizeDorM(this.getInResultDimensions(),true),r;this._sAdapteredChartType=this.getEnablePagination()?this.getChartType():p.adaptChartType(this.getChartType(),e);var a=this._getVisibleMeasures();r=this._normalizeDorM(this.getMeasures().filter(function(e){return a.indexOf(e.getName())===-1}),false);var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");var n=s&&this.getModel()instanceof s;this._aFeeds=d.fit(this._sAdapteredChartType,e,t,i,this._enableSemanticPattern(),r,n);if((!this._aFeeds._valid||this._aFeeds._unused.length)&&this._sAdapteredChartType!==this.getChartType()){this._sAdapteredChartType=this.getChartType();this._aFeeds=d.fit(this._sAdapteredChartType,e,t,i,this._enableSemanticPattern())}if(this._sAdapteredChartType!==this.getChartType()){this._bNeedToApplyDefaultProperties=true}}return this._aFeeds};L.prototype._normalizeDorM=function(e,t){var i=t?this.getDimensions():this.getMeasures(),r=i.reduce(function(e,t){e[t.getName()]=t;return e},{}),a=t?o:u;var s=e.reduce(function(e,t){var i;if(typeof t==="string"){i=t}else if(t instanceof a){i=t.getName()}else{e.errors.push(t)}if(r[i]){e.normalized.push(r[i])}else{e.errors.push(t)}return e},{normalized:[],errors:[]});var n=s.normalized;if(s.errors.length>0){n.errors=s.errors}return n};L.prototype._redundantsFromSelection=function(){var e=this._getVizFrame().vizSelection();if(!e||e.length===0){return{measureNames:{}}}var t=this._getContinuesSemanticTuples();var i=e.reduce(function(e,i){var r=[];for(var a in t){if(t.hasOwnProperty(a)){var s=t[a];if(i.data[a]){r.push(i.data[s.timeAxis]<s.projectedValueStartTime?s.projected:s.actual)}else{r.push(s.actual);r.push(s.projected)}}}jQuery.each(i.data,function(t,i){if(!(r.length>0&&r.indexOf(t)>-1)){if(!e[t]){e[t]=[]}if(e[t].indexOf(i)===-1){e[t].push(i)}}});return e},{});var r=this._getVisibleDimensions().reduce(function(e,t){var r=i[t];if(r.length===1){e[t]=r[0]}return e},{});r.measureNames=this._getVisibleMeasures().reduce(function(e,t){if(!i[t]){e[t]=true}return e},{});return r};L.prototype._deriveFilterFromSelection=function(){var e=this._getVisibleDimensions();var t=this;var i=this._getVizFrame().vizSelection();if(this.getSelectionBehavior().toUpperCase()===w.Category){i=i.category}else if(this.getSelectionBehavior().toUpperCase()===w.Series){i=i.series}var r=false;var a=i.map(function(i){var a=e.reduce(function(e,a){var s=t.getDimensionByName(a);var n;n=i.data[a];if(n!=null){if(g.CONFIG.timeChartTypes.indexOf(t._sAdapteredChartType)>-1&&s instanceof l){var o=f.getInstance(s.getTimeUnit());if(o){var u=o.format.bind(o);n=u(new Date(i.data[a]))}}var c=new S({path:a,operator:b.EQ,value1:n});if(s instanceof h){e.hierarchyFilters.push(c);r=true}else{e.filters.push(c)}e.signature.push(a+"="+i.data[a])}return e},{filters:[],hierarchyFilters:[],signature:[]});a.signature=a.signature.join(";");return a});var s=a.reduce(function(e,t){if(!e[t.signature]&&t.filters.length+t.hierarchyFilters.length>0){e[t.signature]={filters:t.filters.length?new S(t.filters,true):null,hierarchyFilters:t.hierarchyFilters.length?new S(t.hierarchyFilters,true):null}}return e},{});var n=Object.keys(s).map(function(e){return{filters:s[e].filters,hierarchyFilters:s[e].hierarchyFilters}});if(n.length>1){if(r){return{hierarchyFilters:new S(n.map(function(e){return e.hierarchyFilters}),false)}}else{return{filters:new S(n.map(function(e){return e.filters}),false)}}}else if(n.length===1){return{filters:n[0].filters,hierarchyFilters:n[0].hierarchyFilters}}else{return{filters:null,hierarchyFilters:null}}};function q(){var e=this.getSelectionBehavior();var t=this._getVisibleDimensions().concat(this.getInResultDimensions()).filter(function(t){var i=this.getDimensionByName(t);if(e.toUpperCase()===w.Category){return i._getFixedRole()==="category"||i._getFixedRole()==="category2"}else if(e.toUpperCase()===w.Series){return i._getFixedRole()==="series"}return true}.bind(this));var i=t.some(function(e){var t=this.getDimensionByName(e);return t instanceof h}.bind(this));var r;if(e.toUpperCase()===w.Category){r=this.getSelectedCategories().categories}else if(e.toUpperCase()===w.Series){r=this.getSelectedSeries().series}else{r=this.getSelectedDataPoints().dataPoints}if(i&&Object.keys(t).length>1&&r.length>1){return false}return true}L.prototype._checkDrilldownValid=function(e){if(this._bEmptyData){R.error("Drill down not possible, because there is already no data available!");return false}var t=this.getInResultDimensions();var i=this._getVisibleDimensions().concat(t).reduce(function(e,t){e[t]=true;return e},{});if(!q.call(this)){R.error("Drill down not possible, because multiple selections on hierarchy/regular mixed dimension is not supported in backend service!");return false}function r(e,i){var r=true;if(i[e.getName()]){if(!(e instanceof h)){R.error("Drill down not possible, because one of the given dimensions is already drilled down!");r=false}else{if(t.indexOf(e.getName())>-1){R.error("Drill down not possible, because one of the given dimensions is inResult!");r=false}}}return r}for(var a=0;a<e.length;++a){if(!r(e[a],i)){return false}}var s=e.reduce(function(e,t){e[t.getName()]=t;return e},{});var n=this;function o(e){if(Array.isArray(e.aFilters)){return e.aFilters.some(o)}else{return!r(n.getDimensionByName(e.sPath),s)}}var l=this._getDrillStateTop();if(l&&l.filter&&o(l.filter)){return false}return true};L.prototype._createDrillStack=function(){this._drillStateStack=$.call(this);var e=this.getProperty("visibleDimensions")||[];this._aUnavailableDims=e.filter(function(e){return!this.getDimensionByName(e)}.bind(this));if(this._aUnavailableDims.length){this._invalidateBy({source:this,keys:{drillStack:true}})}else{this.fireDrillStackChanged(this.getDrillStack())}};L.prototype._updateDrillStack=function(){var e=this._aUnavailableDims.some(function(e){return this.getDimensionByName(e)instanceof h}.bind(this));if(e){this._drillStateStack=$.call(this)}this._aUnavailableDims=[];this.fireDrillStackChanged(this.getDrillStack())};function $(){var e=this.getProperty("visibleDimensions")||[],t=this.getProperty("visibleMeasures")||[],i=[{dimensions:[],measures:t,filter:undefined,nonHierarchyFilters:undefined,hierarchyFilters:undefined,hierarchylevel:{}}],r=[];var a={};for(var s=0;s<e.length;s++){var n=e[s];r.push(n);var o=this.getDimensionByName(n);if(o&&o instanceof h){a[n]=o.getLevel()}i.push({dimensions:r.slice(),measures:t,filter:undefined,nonHierarchyFilters:undefined,hierarchyFilters:undefined,hierarchylevel:jQuery.extend(true,{},a)})}return i}L.prototype._invalidateBy=function(e){var t=e.source;var i=this._oCandidateColoringSetting?this._oCandidateColoringSetting.additionalDimensions||[]:[];if(t===this){jQuery.each(e.keys||{},function(e,t){this._markForUpdate(e,t)}.bind(this))}else if(t instanceof u&&this._getVisibleMeasures().indexOf(t.getName())!==-1){this._markForUpdate("dataSet",true);this._markForUpdate("vizFrame",true);if(e.property==="unitBinding"||this.getColorings()&&(e.property==="semantics"||e.property==="semanticallyRelatedMeasures")){this._markForUpdate("binding",true)}}else if(t instanceof o&&this._getVisibleDimensions().concat(i).indexOf(t.getName())!==-1){this._markForUpdate("dataSet",true);this._markForUpdate("vizFrame",true);if(t.getDisplayText()&&(e.property==="textProperty"||e.property==="displayText")){this._markForUpdate("binding",true)}else if(e.property==="level"&&this.getProperty("visibleDimensions").indexOf(t.getName())>-1){this._createDrillStack();this._markForUpdate("binding",true)}}else if(t instanceof o&&this.getProperty("inResultDimensions").indexOf(t.getName())>-1){if(e.property==="level"){this._markForUpdate("dataSet",true);this._markForUpdate("binding",true);this._markForUpdate("vizFrame",true)}}this.invalidate(e)};L.prototype._handleNonAnalyticalFeeding=function(){var e=this;var t=this.getInResultDimensions();var i=this._getVisibleDimensions(),r=this.getDimensions().map(function(e){return e.getName()});var a=[];r.forEach(function(t){if(e.getDimensionByName(t)){var i=e.getDimensionByName(t).getTextProperty();if(i){a.push(i)}}});var s=i.concat(r.filter(function(e){return i.indexOf(e)<0})).filter(function(e){return a.indexOf(e)<0&&t.indexOf(e)<0});this.setProperty("visibleDimensions",s);this._createDrillStack()};L.prototype._markForUpdate=function(e,t){if(!this._mNeedToUpdate){this._mNeedToUpdate={}}this._mNeedToUpdate[e]=t;var i=this._updaters.onInvalidate[e];if(i){i.call(this)}};L.prototype._updaters=function(){return{onInvalidate:{vizFrame:function(){this._aFeeds=null;this._bColoringParsed=null},checkBinding:function(){this._bColoringParsed=null},binding:function(){this._bColoringParsed=null},loopData:function(){this._bColoringParsed=null}},checkBinding:function(){var e=this._getCandidateColoringSetting();var t=e.additionalDimensions;var i=e.additionalMeasures;if(t&&t.length||i&&i.length){this._mNeedToUpdate["binding"]=true}},drillStack:function(){this._updateDrillStack()},dataSet:function(){this._getDataset().invalidate()},binding:function(){var e=this._getDataset().getBinding("data"),t=this.getInResultDimensions();if(!e){return}var i=this._getVisibleDimensions(true).concat(this._normalizeDorM(t,true));var r=this._getVisibleMeasures(true);this._oMeasureRangePromise=m.updateModel(this.getIsAnalytical())(this,i,r);var a=this._getDrillStateTop();if(i.length>0||r.length>0){this._getVizFrame()._readyToRender(false);this.setBusy(true)}this._bFilterCalledByChart=true;e.filter(a&&a.filter?a.filter:undefined,D.Control);var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");if(s&&this.getModel()instanceof s){if(e._bSuspendCalledByChart){e._bSuspendCalledByChart=false;e.getRootBinding().resume()}}if(this._bEnbableValueAxisScale){this._validateValueScaleOnDimChange(i,this._aDimensions)}this._aDimensions=i},vizFrame:function(){var e=this,t=this._getDataset(),i=this._getVizFrame();var r=sap.ui.require("sap/ui/model/odata/v4/ODataModel");if(this._mNeedToUpdate["binding"]){var a=this._getDataset().getBinding("data");if(r&&this.getModel()instanceof r){var o=a.getRootBinding();if(o&&!o.isSuspended()){o.suspend();a._bSuspendCalledByChart=true}}if(this._isEnablePaging()){this._getPagingController().reset();this._oColoringStatus={}}else{this._getDataset().setPagingOption(null)}}else{this._markForUpdate("loopData",true)}if(this.getEnableStableColor()){this._oColorTracker.add(i._runtimeScales());i._runtimeScales(this._oColorTracker.get(),true)}else{this._resetRuntimeScale()}var l=this._isEnablePaging()?this._getPagingController().getMeasureRange():{};t.removeAllAggregation("dimensions",true);t.removeAllAggregation("measures",true);i.removeAllAggregation("feeds",true);if(this.getIsAnalytical()===false){this._handleNonAnalyticalFeeding()}var h={};try{h=this._prepareFeeds();h._def.dim.forEach(function(e){t.addAggregation("dimensions",e,true)},this);h._def.msr.forEach(function(i){if(i){var r=l[i.getIdentity()];if(r){i.setRange([r.min,r.max])}if(!e.getDimensionByName(i.getUnit())){i.setUnit(null)}t.addAggregation("measures",i,true)}},this);h.forEach(function(e){i.addFeed(e)})}catch(e){}this._semanticTuples=h._semanticTuples;var u=this._getCandidateColoringSetting();var c=h._context||[];var d=u.additionalMeasures||[];var g=u.additionalDimensions||[];var p=r&&this.getModel()instanceof r;d.forEach(function(e){c.push({id:e,showInTooltip:false});var i=new n({name:e,identity:e,value:"{"+e+"}"});if(p){i.setBindingContext(null)}t.addMeasure(i)});g.forEach(function(e){c.push({id:e,showInTooltip:false});var i=new s({name:e,identity:e,value:"{"+e+"}"});if(p){i.setBindingContext(null)}t.addDimension(i)});t.setContext(c);i.invalidate();t.invalidate();i.setVizType(this._reset100DonutChartType(this._sAdapteredChartType));i._setCustomMessages(this.getCustomMessages());this._setValueAxisScale();if(!this._mNeedToUpdate["loopData"]){this._setEffectiveScales();i.setVizProperties(this._getEffectiveProperties())}},loopData:function(){var e=this._getVizFrame();try{this._prepareData()}catch(e){if(e instanceof F){e.display()}else{throw e}}var t=this._getEffectiveProperties();this._usingDisplayNameForSemantics(t);e.setVizProperties(t);this._setEffectiveScales()}}}();L.prototype._getDrillStateTop=function(){return this._drillStateStack?this._drillStateStack[this._drillStateStack.length-1]:null};L.prototype._getVizFrame=function(){return this.getAggregation("_vizFrame")};L.prototype._getDataset=function(){var e=this._getVizFrame();return e?e.getDataset():null};L.prototype._prepareData=function(){var e=this._getContexts();if(e){this._bEmptyData=e.length?false:true;var t=this._getCandidateColoringSetting().contextHandler;var i=[];if(t){i.push(t);try{this._loopContext(i)}catch(e){if(e instanceof F){e.display();this._oCandidateColoringSetting={}}else{throw e}}}this._oSemanticVizSettings=v.getSemanticVizSettings(this._sAdapteredChartType,this._semanticTuples,this._oCandidateColoringSetting,this._enableSemanticPattern(),this._bDataPointStyleSetByUser,this._bLegendSetByUser)}};L.prototype._getContexts=function(){return this._getDataset()._getDataContexts()};L.prototype._loopContext=function(e){var t=this._getContexts();if(t.length>0&&!t.dataRequested){var i=this;t.forEach(function(t){e.forEach(function(e){e.call(i,t)})})}};L.prototype._filterHandler=function(){if(!this._bFilterCalledByChart){this._bFilterCalledByCustomer=true;this._bColoringParsed=false}this._bFilterCalledByChart=false};L.prototype._dataRefreshListener=function(e){if(e.getParameters().reason==="filter"){this._filterHandler()}if(this.getIsAnalytical()&&e.getParameters().updateAnalyticalInfo){m.updateModel(true)(this)}};L.prototype._bindingChangeListener=function(e){var t=this._getVizFrame();if(e.getParameters().reason==="filter"){this._filterHandler()}if(this.getEnableStableColor()){this._oColorTracker.add(t._runtimeScales());t._runtimeScales(this._oColorTracker.get(),true)}t.invalidate();this.setBusy(false);if(this._isEnablePaging()){this._getPagingController().bindingChanged()}else{t._readyToRender(true)}try{this._prepareData()}catch(e){if(e instanceof F){e.display()}}var i=this._getEffectiveProperties();this._usingDisplayNameForSemantics(i);t.setVizProperties(i);this._setEffectiveScales();this._bFilterCalledByChart=false;this._bFilterCalledByCustomer=false};L.prototype._resetRuntimeScale=function(){this._oColorTracker.clear();this._getVizFrame()._runtimeScales(this._oColorTracker.get(),true)};L.prototype._hasUserSemanticProps=function(){var e=this.getProperty("vizProperties");if(e&&e.plotArea){if(e.plotArea.dataPointStyle||e.plotArea.seriesStyle){return true}}return false};L.prototype._enableSemanticColoring=function(){var e=true;if(this._sAdapteredChartType==="heatmap"){var t=this.getProperty("vizScales")||[];var i=t.filter(function(e){return e.feed==="color"})[0];if(i){e=false}}else{if(this._hasUserSemanticProps()){e=false}}return e};L.prototype._enableSemanticPattern=function(){return!this._hasUserSemanticProps()&&g.CONFIG.nonSemanticPatternChartType.indexOf(this._sAdapteredChartType)===-1};L.prototype._hasSemanticPattern=function(){return this._enableSemanticPattern()&&v.hasSemanticRelation(this._semanticTuples)};L.prototype._getContinuesSemanticTuples=function(){var e={};if(this._hasSemanticPattern()){e=this._semanticTuples.reduce(function(e,t){if(t.semanticMsrName){e[t.semanticMsrName]=t}return e},{})}return e};L.prototype._getContinuesSemanticMap=function(){var e=[];if(this._hasSemanticPattern()){e=this._semanticTuples.filter(function(e){return e.projectedValueStartTime})}return e};L.prototype._getInternalVisibleMeasures=function(){var e=this._getVisibleMeasures();if(this._hasSemanticPattern()){e=e.concat(this._getContinuesSemanticMap().map(function(e){return e.semanticMsrName}))}return e};L.prototype._buildSelectedDataPoints=function(e,t){var i=this._getInternalVisibleMeasures(),r=this._getVisibleDimensions().concat(this.getInResultDimensions()),a=this._getEffectiveContinuesDataPoints(t);return y.buildSelectionVizCtx(i,r,e,a)};L.prototype._getEffectiveContinuesSeries=function(e){var t=e.slice(),i=this._getContinuesSemanticMap();if(this._hasSemanticPattern()){var r=t.map(function(e){return e.measures});i.forEach(function(e){if(r.indexOf(e.actual)>-1||r.indexOf(e.projected)>-1){t=t.filter(function(t){return t.measures!==e.actual&&t.measures!==e.projected});if(r.indexOf(e.actual)>-1&&r.indexOf(e.projected)>-1){t.push({measures:e.semanticMsrName})}}})}return t};L.prototype._getEffectiveContinuesDataPoints=function(e){var t=e.slice(),i=this._getContinuesSemanticMap();if(this._hasSemanticPattern()){var r,a,s,n;for(var o=0;o<t.length;o++){s=t[o].measures;for(var l=0;l<i.length;l++){n=i[l];r=s.indexOf(n.actual);if(r>-1){s.splice(r,1)}a=s.indexOf(n.projected);if(a>-1){s.splice(a,1)}if(r>-1||a>-1){s.push(n.semanticMsrName)}}}}return t};L.prototype._buildSelectEventData=function(e){if(e&&e.length>0&&this._hasSemanticPattern()){var t,i;var r=this._getContinuesSemanticMap();for(var a=0;a<e.length;a++){t=jQuery.extend(true,{},e[a].data);for(var s=0;s<r.length;s++){i=r[s];if(t.measureNames===i.semanticMsrName){if(t[i.timeAxis]<i.projectedValueStartTime){t.measureNames=i.actual;delete t[i.projected];delete t[i.semanticMsrName]}else{t.measureNames=i.projected;delete t[i.actual];delete t[i.semanticMsrName]}}else{if(t[i.actual]&&t.measureNames!==i.actual){delete t[i.actual]}if(t[i.projected]&&t.measureNames!==i.projected){delete t[i.projected]}}}e[a].data=t}}};L.prototype.addData=function(){R.error('Chart manages the "data" aggregation only via data binding. The method "addData" therefore cannot be used programmatically!')};L.prototype.destroyData=function(){R.error('Chart manages the "data" aggregation only via data binding. The method "destroyData" therefore cannot be used programmatically!')};L.prototype.getData=function(){R.error('Chart manages the "data" aggregation only via data binding. The method "getData" therefore cannot be used programmatically!')};L.prototype.indexOfData=function(){R.error('Chart manages the "data" aggregation only via data binding. The method "indexOfData" therefore cannot be used programmatically!')};L.prototype.insertData=function(){R.error('Chart manages the "data" aggregation only via data binding. The method "insertData" therefore cannot be used programmatically!')};L.prototype.removeData=function(){R.error('Chart manages the "data" aggregation only via data binding. The method "removeData" therefore cannot be used programmatically!')};L.prototype.removeAllData=function(){R.error('Chart manages the "data" aggregation only via data binding. The method "removeAllData" therefore cannot be used programmatically!')};L.prototype._createOData4SAPAnalyticsModel=function(e){var t=null;try{t=new C.Model(new C.Model.ReferenceByModel(e))}catch(e){return undefined}return t};L.prototype.getIsAnalytical=function(){return this.getProperty("isAnalytical")};L.prototype.setIsAnalytical=function(e,t){if(this._bIsInitialized){R.error('The proeprty isAnalytical will programmatically set according to data source. The method "setIsAnalytical" therefore cannot be used!')}else{this.setProperty("isAnalytical",e,t)}return this};L.prototype._setIsAnalyticalProperty=function(e,t){var i=e.findQueryResultByName(m.getEntitySet(this.getIsAnalytical())(t))!==undefined;if(this.getIsAnalytical()!==i){this.setProperty("isAnalytical",i)}};L.prototype.bindAggregation=function(e,t){if(e==="data"){this._oBindingInfo=jQuery.extend(true,{},t);var r=this.getModel(t.model);var a;if(r){var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");var n=sap.ui.require("sap/ui/model/json/JSONModel");if(n&&r instanceof n){if(this.getIsAnalytical()!==false){this.setProperty("isAnalytical",false)}}else if(s&&r instanceof s){this.setProperty("isAnalytical",true);if(t){t.parameters=jQuery.extend(true,{$count:t.length!=undefined||this._isEnablePaging()},t.parameters)}}else{a=this._createOData4SAPAnalyticsModel(r);this._setIsAnalyticalProperty(a,t);if(this.getIsAnalytical()){if(t){var o=true;if(t.length!=undefined||this._isEnablePaging()){o=false}t.parameters=jQuery.extend(true,{analyticalInfo:[],useBatchRequests:true,provideGrandTotals:false,reloadSingleUnitMeasures:true,noPaging:o},t.parameters)}c.apply(r);if(a){r.setAnalyticalExtensions(a)}}}}}return i.prototype.bindAggregation.apply(this,arguments)};L.prototype._bindAggregation=function(e,t){if(e==="data"){var r=this.getModel(t.model);var a;if(r){var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");var n=sap.ui.require("sap/ui/model/json/JSONModel");if(n&&r instanceof n){if(this.getIsAnalytical()!==false){this.setProperty("isAnalytical",false)}this._deriveColumns(r,t)}else if(s&&r instanceof s){this.setProperty("isAnalytical",true);if(t){t.parameters=jQuery.extend(true,{$count:t.length!=undefined||this._isEnablePaging()},t.parameters)}}else{a=this._createOData4SAPAnalyticsModel(r);this._setIsAnalyticalProperty(a,t);if(this.getIsAnalytical()){if(t){var o=true;if(t.length!=undefined||this._isEnablePaging()){o=false}t.parameters=jQuery.extend(true,{analyticalInfo:[],useBatchRequests:true,provideGrandTotals:false,reloadSingleUnitMeasures:true,noPaging:o},t.parameters)}c.apply(r);if(a){r.setAnalyticalExtensions(a)}}this._deriveColumns(r,t)}}var l=this._getDataset();l.bindAggregation("data",t);var h=l.getBinding("data");if(h&&r){var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");if(s&&r instanceof s){h._bSuspendCalledByChart=false}}this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}})}else{i.prototype._bindAggregation.apply(this,arguments)}};L.prototype._dataErrorListener=function(e){var t=this._getVizFrame();if(t){t._readyToRender(true);t.invalidate();this.setBusy(false)}};L.prototype.unbindAggregation=function(e,t){var r=false;if(e==="data"){var a=this._getDataset();if(a){var s=a.getBinding("data");if(s){delete s._bSuspendCalledByChart}a.unbindAggregation.apply(a,arguments)}t=true;r=!this.bHasAnalyticalInfo&&this.aContexts===undefined&&this._getDataset&&this._getDataset()===null&&this.mBindingInfos&&this.mBindingInfos[e]&&this.mBindingInfos[e].binding&&this.mBindingInfos[e].binding.bIsBeingDestroyed}if(!r){return i.prototype.unbindAggregation.apply(this,[e,t])}};L.prototype.unbindData=function(){if(!this.getIsAnalytical()){this.removeAllAggregation("dimensions");this.removeAllAggregation("measures");this.setProperty("visibleDimensions",[]);this.setProperty("inResultDimensions",[]);this.setProperty("visibleMeasures",[]);this._createDrillStack()}this.unbindAggregation("data")};L.prototype._deriveColumns=function(e,t){var i=this.getAggregation("dimensions");var r=this.getAggregation("measures");if((i===null||i.length===0)&&(r===null||r.length===0)){var a=m.deriveColumns(this.getIsAnalytical())(e,t);a.dimensions.forEach(this.addDimension.bind(this));a.measures.forEach(this.addMeasure.bind(this))}};L.prototype.onBeforeRendering=function(){this._bIsInitialized=true;i.prototype.onBeforeRendering.apply(this,arguments);var e=["onInvalidate","drillStack","dataSet","vizFrame","checkBinding","binding","loopData"];e.forEach(function(e){if(this._mNeedToUpdate[e]){this._updaters[e].call(this)}}.bind(this));jQuery.each(this._mNeedToUpdate,function(e){this._mNeedToUpdate[e]=false}.bind(this))};L.prototype.onAfterRendering=function(){this._showLoading(this._bLoading);this._rendered=true};L.prototype.onlocalizationChanged=function(){this._invalidateBy({source:this,keys:{vizFrame:true}})};L.prototype.exit=function(){this._getDataset().unbindAggregation("data",true);this._oColorTracker.clear();i.prototype.exit.apply(this,arguments);var e=this._getVizFrame();if(this._delegateEventHandlers){this._delegateEventHandlers.forEach(function(t){e["detach"+t.name](t.handler,this);delete t.handler},this);delete this._delegateEventHandlers}e.detachRenderComplete(this._vizFrameRenderCompleteHandler,this);e.detachEvent("_zoomDetected",Y.bind(this),this);e.detachEvent("_selectionDetails",Q.bind(this),this)};L.prototype.applySettings=function(){this._mNeedToUpdate={};T.prototype.applySettings.apply(this,arguments);var e=new a;e.attachEvent("dataChange",{},this._bindingChangeListener,this);e.attachEvent("dataRefresh",{},this._dataRefreshListener,this);e.attachEvent("dataError",{},this._dataErrorListener,this);var i=jQuery.extend(true,{},{applicationSet:"fiori"},this.getUiConfig());this.setUiConfig(i);this._bNeedToApplyDefaultProperties=true;this._oSemanticVizSettings={};var r=new t({width:H(this.getWidth()),height:H(this.getHeight()),vizType:this.getChartType(),uiConfig:this.getUiConfig(),vizProperties:jQuery.extend(true,{title:{visible:false}},this._getEffectiveProperties())});r.setDataset(e);r.attachRenderComplete(null,this._updateLoadingIndicator.bind(this));r.attachEvent("_zoomDetected",Y.bind(this));r.attachEvent("renderFail",null,function(e){var t=this._getPagingController();if(t._sLoadingTimer){clearTimeout(t._sLoadingTimer);t._sLoadingTimer=null}this._showLoading(false)},this);this._rendered=false;r._readyToRender(false);this.setAggregation("_vizFrame",r);this._delegateEvents();this._sAdapteredChartType=this.getChartType();this._oCandidateColoringSetting={};this._oColoringStatus={};this._oColorTracker=new N;if(this._isEnablePaging()){this._getPagingController()}};L.prototype.setCustomMessages=function(e){this.setProperty("customMessages",e);var t=this._getVizFrame();if(t){t._setCustomMessages(e)}return this};L.prototype.getZoomInfo=function(){return this._getZoomInfo()};L.prototype._getZoomInfo=function(){var e=this._getVizFrame();if(e){return e._getZoomInfo()}};L.prototype.resetLayout=function(){this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,vizFrame:true,dataSet:true}});return this};L.prototype.setSelectedDataPoints=function(e){if(this.getSelectionMode()!==j.None){var t=this.getBinding("data"),i=this._getVizFrame();if(!t||!i||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this}i.vizSelection([],{clearSelection:true});i.vizSelection(this._buildSelectedDataPoints(t,e),{selectionMode:this.getSelectionMode()})}return this};L.prototype.addSelectedDataPoints=function(e){if(this.getSelectionMode()!==j.None){var t=this.getBinding("data"),i=this._getVizFrame();if(!t||!i||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this}i.vizSelection(this._buildSelectedDataPoints(t,e),{selectionMode:j.Multi})}return this};L.prototype.getSelectedDataPoints=function(){var e=this._getVizFrame();if(!e||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return{count:0,dataPoints:[]}}var t=this._getContinuesSemanticTuples();var i=this._getVisibleMeasures(),r=this._getDataset(),a=e.vizSelection()||[],s={};for(var n=0,o=a.length;n<o;n++){var l=a[n],h=l.data._context_row_number;if(!s[h]){s[h]={index:h,measures:[],context:r.findContext({_context_row_number:h})}}l.measures=y.filterVisibleMsr(l.data,i);if(!jQuery.isEmptyObject(t)){y.filterSemMsr(t,i,l)}s[h].measures=s[h].measures.concat(l.measures);if(l.unit){s[h].unit=jQuery.extend(true,s[h].unit,l.unit)}if(l.dataName){s[h].dataName=jQuery.extend(true,s[h].dataName,l.dataName)}}return{count:a.length,dataPoints:Object.keys(s).map(function(e){return s[e]})}};L.prototype.removeSelectedDataPoints=function(e){if(this.getSelectionMode()!==j.None){var t=this.getBinding("data"),i=this._getVizFrame();if(!i||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this}var r=this._buildSelectedDataPoints(t,e);i.vizSelection(r,{deselection:true})}return this};L.prototype.setSelectedCategories=function(e){if(this.getSelectionMode()!==j.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!=="CATEGORY"){return this}t.vizSelection([],{clearSelection:true});t.vizSelection(e.map(y.toVizCSCtx),{selectionMode:this.getSelectionMode()})}return this};L.prototype.addSelectedCategories=function(e){if(this.getSelectionMode()!==j.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==w.Category){return this}t.vizSelection(e.map(y.toVizCSCtx),{selectionMode:j.Multi})}return this};L.prototype.removeSelectedCategories=function(e){if(this.getSelectionMode()!==j.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==w.Category){return this}t.vizSelection(e.map(y.toVizCSCtx),{deselection:true})}return this};L.prototype.getSelectedCategories=function(){var e=this._getVizFrame(),t=this.getSelectionBehavior().toUpperCase();if(!e||t!==w.Category){return{count:0,categories:[]}}else{var i=e.vizSelection()||[];return{count:i.length,categories:(i.category||[]).map(y.fromVizCSCtx)}}};L.prototype.setSelectedSeries=function(e){if(this.getSelectionMode()!==j.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==w.Series){return this}t.vizSelection([],{clearSelection:true});var r=this._getEffectiveContinuesSeries(e);t.vizSelection(r.map(y.toVizCSCtx),{selectionMode:this.getSelectionMode()})}return this};L.prototype.addSelectedSeries=function(e){if(this.getSelectionMode()!==j.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==w.Series){return this}var r=this._getEffectiveContinuesSeries(e);t.vizSelection(r.map(y.toVizCSCtx),{selectionMode:j.Multi})}return this};L.prototype.removeSelectedSeries=function(e){if(this.getSelectionMode()!==j.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==w.Series){return this}var r=this._getEffectiveContinuesSeries(e);t.vizSelection(r.map(y.toVizCSCtx),{deselection:true})}return this};L.prototype.getSelectedSeries=function(){var e=this._getVizFrame(),t=this.getSelectionBehavior().toUpperCase();if(!e||t!==w.Series){return{count:0,series:[]}}else{var i=e.vizSelection()||[],r=(i.series||[]).map(y.fromVizCSCtx),a=[],s=this._getContinuesSemanticTuples();r=r.filter(function(e){var t=true;if(e&&e.measures){var i=s[e.measures];if(i&&i.semanticMsrName===e.measures){a.push({measures:i.actual});a.push({measures:i.projected});t=false}}return t});r=r.concat(a);return{count:i.length,series:r}}};function G(e){var t=e.filter(function(e){return e});if(t.length===0){return null}else if(t.length===1){return t[0]}else{return new S(t,true)}}L.prototype.drillDown=function(e){if(this.getIsAnalytical()===false){R.error('Data source does not support drillDown/drillUp. The method "drillDown" therefore cannot be used!');return}if(e&&!(e instanceof Array)){e=[e]}var t=this._normalizeDorM(e,true);if(t.length===0){return}if(!this._checkDrilldownValid(t)){return}var i=this._getDrillStateTop(),r=this._redundantsFromSelection(),a=this._deriveFilterFromSelection();var s,n,o;if(a){s=G([a.filters,i.nonHierarchyFilters]);n=a.hierarchyFilters||i.hierarchyFilters;o=G([s,n])||undefined}var l=jQuery.extend(true,{},i.hierarchylevel);t.forEach(function(e){if(e instanceof h){if(l[e.getName()]==null){l[e.getName()]=e.getLevel()}else{l[e.getName()]+=1}}});var u=i.dimensions.slice().filter(function(e){return!r[e]});u=u.concat(t.filter(function(e){return u.indexOf(e.getName())===-1}).map(function(e){return e.getName()}));this._drillStateStack.push({dimensions:u,measures:i.measures.filter(function(e){return!r.measureNames[e]}),filter:o,hierarchylevel:l,nonHierarchyFilters:s,hierarchyFilters:n,redundant:r});if(this._aUnavailableDims.length===0){this.fireDrillStackChanged(this.getDrillStack())}var c=t.map(function(e){return e.getName()});this.fireDrilledDown({dimensions:c});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}})};L.prototype.drillUp=function(e){if(this.getIsAnalytical()===false){R.error('Data source does not support drillDown/drillUp. The method "drillUp" therefore cannot be used!');return}if(arguments.length===0){e=this._drillStateStack.length-2}var t=this._drillStateStack[e];if(t&&e!=this._drillStateStack.length-1){var i=this._drillStateStack.pop();this._drillStateStack.splice(e+1);if(this._aUnavailableDims.length===0){this.fireDrillStackChanged(this.getDrillStack())}this.fireDrilledUp({dimensions:i.dimensions.filter(function(e){return t.dimensions.indexOf(e)===-1})});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}})}};L.prototype.getDrillStack=function(){if(this.getIsAnalytical()===false){R.error('Data source does not support drillDown/drillUp. The method "getDrillStack" therefore cannot be used!');return}return jQuery.map(this._drillStateStack||[],function(e,t){return{dimension:e.dimensions.slice(),measure:e.measures.slice(),filter:e.filter,hierarchylevel:jQuery.extend(true,{},e.hierarchylevel)}})};L.prototype.setUiConfig=function(e){this.setProperty("uiConfig",e);if(this._getVizFrame()){this._getVizFrame().setUiConfig(e)}return this};var W=function(){var e=["interaction.selectability.mode","interaction.selectability.behavior"];function t(e,t){var i=e,r;r=t.reduce(function(e,t){if(i.hasOwnProperty(t)){e.push({parent:i,val:i[t],key:t});i=i[t]}return e},[]);if(r.length!==t.length){return}var a=r.pop();delete a.parent[a.key];while(r.length>0){a=r.pop();if(Object.keys(a.val).length>0){return}else{delete a.parent[a.key]}}}function i(i,r){var a=jQuery.extend(true,{},i);e.forEach(function(e){delete a[e];t(a,e.split("."))});return a}return{sanitize:i,modify:function(e,t,i){var r=t.split("."),a=e;while(r.length>1&&a.hasOwnProperty(r[0])){a=a[r.shift()]}var s=r[0];if(r.length===1&&a.hasOwnProperty(s)){a[s]=i(a[s])}}}}();L.prototype.setVizProperties=function(e){e=W.sanitize(e);var t=function(e,i){for(var r in i){var a=i[r];if(a!==undefined){if(!jQuery.isPlainObject(a)){e[r]=a}else{var s=e[r];if(!s||!jQuery.isPlainObject(s)){s=e[r]={}}t(s,a)}}}};var i=function(i,r){i=i||{};t(i,e);return i};e=i(jQuery.extend(true,{title:{visible:false}},this.getProperty("vizProperties")),e);this.setProperty("vizProperties",e);if(e.plotArea&&e.plotArea.dataPointStyle){this._bDataPointStyleSetByUser=true;this._invalidateBy({source:this,keys:{vizFrame:true,loopData:true}})}if(e.legend&&e.legend.title){this._bLegendSetByUser=true}if(this._getVizFrame()){this._getVizFrame().setVizProperties(this._getEffectiveProperties())}return this};L.prototype.getVizProperties=function(){var e=this._getVizFrame();var t=W.sanitize(e?e.getVizProperties():this.getProperty("vizProperties"));function i(e){var t=sap.viz.api.env.Format.numericFormatter();if(!t||typeof t.stripUnit!=="function"){return e}if(typeof e==="string"||e instanceof String){return t.stripUnit(e)}else if(e&&typeof e==="object"){jQuery.each(e,function(i,r){e[i]=t.stripUnit(r)});return e}else{return e}}W.modify(t,"plotArea.dataLabel.formatString",i);W.modify(t,"tooltip.formatString",i);return t};L.prototype.setVizScales=function(e){this.setProperty("vizScales",e);this._aVizValueScales=e.filter(function(e){return e.feed==="valueAxis"||e.feed==="valueAxis2"||e.feed==="actualValues"});if(this._aVizValueScales&&this._aVizValueScales.length>0){this._bEnbableValueAxisScale=false}if(this._getVizFrame()){this._getVizFrame().setVizScales(e)}return this};L.prototype.getVizScales=function(){var e=this._getVizFrame();return e?e.getVizScales():this.getProperty("vizScales")};L.prototype.getVizUid=function(){return this._getVizFrame().getVizUid()};L.prototype.zoom=function(e){this._getVizFrame().zoom(e)};var Z=["selectData","deselectData"];L.prototype._delegateEvents=function(){if(this._delegateEventHandlers){return}var e=this._getVizFrame();this._delegateEventHandlers=Z.map(function(t){var i=t.charAt(0).toUpperCase()+t.slice(1);var r=function(e){var i=e.getParameters();this._buildSelectEventData(i.data);delete i.id;this.fireEvent(t,i)};r=r.bind(this);e["attach"+i](null,r);return{name:i,handler:r}},this);this._vizFrameRenderCompleteHandler=J.bind(this);e.attachRenderComplete(null,this._vizFrameRenderCompleteHandler);e.attachEvent("_selectionDetails",Q.bind(this))};L.getChartTypes=e.api.getChartTypes;L.prototype.getAvailableChartTypes=function(){var e=this._getVisibleDimensions(true),t=this._getVisibleMeasures(true);return g.CONFIG.chartTypes.reduce(function(i,r){var a=d.compatible(r,e,t);if(a.compatible){i.available.push({chart:r})}else{var s={};if(a.error.missing.dim){s.Dimension=a.error.missing.dim}if(a.error.missing.time){s.DateTimeDimension=a.error.missing.time}if(a.error.missing.msr){s.Measure=a.error.missing.msr}i.unavailable.push({chart:r,error:s})}return i},{available:[],unavailable:[]})};L.prototype._getDynamicScaleProp=function(){return{general:{enableScalingFactor:this.getEnableScalingFactor()}}};L.prototype._getEffectiveProperties=function(){var e={};if(this._bNeedToApplyDefaultProperties){e=jQuery.extend(true,e,this._getDefaultVizProperties());this._bNeedToApplyDefaultProperties=false}var t=this.getChartType();e=jQuery.extend(true,e,this._get100DonutProperty(t),this._oSemanticVizSettings.properties||{},this.getProperty("vizProperties"),this._getHostedVizProperties(),this._getPagingVizProperties(),this._getTimeProperties(),this._getValueAxisScaleSetting().property||{},this._getDynamicScaleProp(),v.getSemanticSettingsForCombination(this._semanticTuples,t));return e};L.prototype._get100DonutProperty=function(e){return{tooltip:{bodyMeasureValue:{type:e.indexOf("100_")===0?"percentage":"value"}}}};L.prototype._reset100DonutChartType=function(e){return e.indexOf("donut")>-1?"donut":e};L.prototype._setEffectiveScales=function(){var e=this._getVizFrame(),t=this.getProperty("vizScales"),i=this._getValueAxisScaleSetting(),r=(t||[]).filter(function(e){return e.feed==="color"});var a=U.extendScales(t,i.scale||[],this._oSemanticVizSettings.scales||[]);if(this._oSemanticVizSettings.replaceColorScales&&r.length===0){e.setVizScales(a,{replace:true})}else{e.setVizScales(a)}};L.prototype._usingDisplayNameForSemantics=function(e){var t=function(e){if(typeof e==="undefined"||e===null){return false}return true};if(e.plotArea&&e.plotArea.dataPointStyle&&e.plotArea.dataPointStyle.rules){var i=this._getContexts();if(i.length>0&&!i.hasOwnProperty("dataRequested")){var r=this.getVisibleDimensions(),a=e.plotArea.dataPointStyle.rules;for(var s=0;s<a.length;s++){var n=a[s].dataContext;if(n&&n.length!==0){var o=Object.keys(n);if(!t(a[s].displayName)&&o.length===1){var l=o[0];if(n[l].hasOwnProperty("equal")&&r.indexOf(l)!==-1){var h=this.getDimensionByName(l).getTextProperty();for(var u=0;u<i.length;u++){if(i[u].getProperty(l)===n[l].equal){var c=i[u].getProperty(h);if(!t(h)||!t(c)||typeof c==="object"||this.getDimensionByName(l).getDisplayText()===false){a[s].displayName=n[l].equal;break}else{a[s].displayName=c;break}}}}}}}}}};L.prototype._getCandidateColoringSetting=function(){if(!this._bColoringParsed&&this._semanticTuples){if(this._enableSemanticColoring()){this._bColoringParsed=true;this._oCandidateColoringSetting={};var e={},t=this.getColorings(),i=this.getActiveColoring();e.aMsr=this._normalizeDorM(this.getVisibleMeasures());var r=this._getDrillStateTop();var a=[],s;if(r.redundant){var a=Object.keys(r.redundant).filter(function(e){return e!=="measureNames"})}s=this._normalizeDorM(this.getVisibleDimensions().concat(a),true);e.aDim=s;e.aInResultDim=this._normalizeDorM(this.getInResultDimensions(),true);e.allMsr=this.getMeasures().map(function(e){return e.getName()});e.allDim=this.getDimensions().map(function(e){return e.getName()});if(t){try{var n=sap.ui.getCore().getLibraryResourceBundle("sap.chart.messages");var o={bFiltered:this._bFilterCalledByCustomer};this._oCandidateColoringSetting=z.getCandidateSetting(t,i,this._semanticTuples,e,this._oColoringStatus||{},this._sAdapteredChartType||this.getChartType(),n,o)}catch(e){if(e instanceof F){e.display()}else{throw e}}}}else{this._oCandidateColoringSetting={}}}return this._oCandidateColoringSetting};L.prototype._hostedVizProperties={selectionMode:{prop:"interaction.selectability.mode"},selectionBehavior:{prop:"interaction.selectability.behavior"}};L.prototype._getHostedVizProperties=function(){return Object.keys(this._hostedVizProperties).reduce(function(e,t){var i=this._hostedVizProperties[t].prop.split(".").reverse().reduce(function(e,t){var i={};i[t]=e;return i},this.getProperty(t));return jQuery.extend(true,e,i)}.bind(this),{})};L.prototype._getDefaultVizProperties=function(){var e=this._sAdapteredChartType||this.getChartType();var t=e.indexOf("100_")===0;var i=e==="pie"||e.indexOf("donut")>-1;e="info/"+this._reset100DonutChartType(e);var r={interaction:{extraEventInfo:true}};return jQuery.extend(true,r,n({},e,["valueAxis.label.formatString","valueAxis2.label.formatString"],t?"":B.DefaultPattern.SHORTFLOAT),n({},e,["legend.formatString","sizeLegend.formatString"],B.DefaultPattern.SHORTFLOAT_MFD2),n({},e,["plotArea.dataLabel.formatString"],i?"":B.DefaultPattern.SHORTFLOAT_MFD2),n({},e,["tooltip.formatString"],t?"":B.DefaultPattern.STANDARDFLOAT));function a(e,t,i){if(t.length===0){return i}e=e||{};var r=e[t[0]];e[t[0]]=a(r,t.slice(1),i);return e}function s(e,t){if(e==null||t.length===0){return e}var i=e[t[0]];if(i&&i.children){return s(i.children,t.slice(1))}return i}function n(e,t,i,r){var n=sap.viz.api.metadata.Viz.get(t);if(n){var o=n.properties;i.forEach(function(t){t=t.split(".");var i=s(o,t);if(i&&i.hasOwnProperty("defaultValue")){a(e,t,r)}})}return e}};L.prototype._getPagingVizProperties=function(){if(this._isEnablePaging()){var e={interaction:{zoom:{enablement:false},selectability:{mode:"NONE"}},plotArea:{isFixedDataPointSize:true}};return e}else{return{}}};L.prototype._getTimeProperties=function(){var e=["year","month","day"];var t=null;var i=this;var r=this.getVisibleDimensions().filter(function(e){var t=i.getDimensionByName(e);return t instanceof l&&t._getFixedRole()==="category"})[0];var a="ISO";var s,n,o;if(r){var h=this.getDimensionByName(r);switch(h.getTimeUnit()){case V.yearmonthday:e=["year","month","day"];break;case V.yearquarter:e=["year","quarter"];break;case V.yearmonth:e=["year","month"];break;case V.yearweek:e=["year","week"];var u=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale(),c=x.getInstance(u),o=u.getRegion();s=c.getMinimalDaysInFirstWeek();n=c.getFirstDayOfWeek();n=n===0?7:n;a="Gregorian";break;case V.fiscalyear:e=["fiscal_year"];break;case V.fiscalyearperiod:e=["fiscal_period","fiscal_year"];break;default:}t=h.getFiscalYearPeriodCount()}var d=this.getProperty("vizProperties");if(d&&d.timeAxis){var g=d.timeAxis;if(g.levels){e=g.levels}if(g.fiscal&&g.fiscal.periodNumbers){t=g.fiscal.periodNumbers}}return{timeAxis:{levels:e,fiscal:{periodNumbers:t},levelConfig:{week:{type:a,minDays:s,firstDayOfWeek:n,region:o}}}}};L.prototype.setSelectionMode=function(e){this.setProperty("selectionMode",e);var t=this._getVizFrame();if(t){t.setVizProperties({interaction:{selectability:{mode:e}}})}return this};L.prototype.getSelectionMode=function(){var e=this._getVizFrame();if(e){return e.getVizProperties().interaction.selectability.mode}else{return this.getProperty("selectionMode")}};L.prototype.setSelectionBehavior=function(e){this.setProperty("selectionBehavior",e);var t=this._getVizFrame();if(t){t.setVizProperties({interaction:{selectability:{behavior:e}}})}return this};L.prototype.setEnableScalingFactor=function(e){this.setProperty("enableScalingFactor",e);this._invalidateBy({source:this,keys:{vizFrame:true}});return this};L.prototype.getScalingFactor=function(){var e=this._getVizFrame();if(e){var t=e._states()["dynamicScale"];if(t){var i=null;var r=["primaryValues","secondaryValues"];var a=[t.valueAxis,t.valueAxis2];for(var s=0;s<r.length;s++){var n=a[s];if(n&&(n.symbol||n.unit)){i=i||{};var o=r[s];i[o]={scalingFactor:n.symbol};if(n.unit){i[o]["unit"]=n.unit}}}return i}}return null};L.prototype.getSelectionBehavior=function(){var e=this._getVizFrame();if(e){return e.getVizProperties().interaction.selectability.behavior}else{return this.getProperty("selectionBehavior")}};L.prototype.getDimensionByName=function(e){return this.getDimensions().filter(function(t){return t.getName()===e})[0]};L.prototype.getMeasureByName=function(e){return this.getMeasures().filter(function(t){return t.getName()===e})[0]};L.prototype.getTimeDimensions=function(){return this.getDimensions().filter(function(e){return e instanceof l})};L.prototype._isEnablePaging=function(){this._bMobile=P.system.tablet&&!P.system.desktop||P.system.phone;var e=this.getModel();var t=sap.ui.require("sap/ui/model/json/JSONModel");var i=!(t&&e instanceof t)&&this.getEnablePagination()&&this._bIsPagingChartType&&!this._bMobile;return i};function J(e){var t=e.getParameters();delete t.id;if(this._isEnablePaging()){this._getPagingController().vizFrameRenderCompleted()}this.fireEvent("renderComplete",t)}function Y(e){var t=e.getParameters();delete t.id;this.fireEvent("_zoomDetected",t)}function Q(e){var t=e.getParameters();delete t.id;var i=this._getDataset();t.data.forEach(function(e){e.context=i.findContext({_context_row_number:e.data._context_row_number})});this.fireEvent("_selectionDetails",t)}L.prototype._showLoading=function(e){var t=this.$();if(!t){return}if(!e){if(this._$loadingIndicator){this._$loadingIndicator.remove()}}else{if(!this._$loadingIndicator){this._$loadingIndicator=this._createLoadingIndicator()}this._updateLoadingIndicator();t.append(this._$loadingIndicator)}this._bLoading=e};L.prototype._createLoadingIndicator=function(){var e=jQuery(M.getElement());var t=jQuery("<p>").attr("class","loading-text").text("Loading");t.css({position:"absolute",transform:"translateY(-3em)",width:"100%","text-align":"center"});t.insertBefore(e.children()[0]);e.css({opacity:1});return e};L.prototype._updateLoadingIndicator=function(){var e=this.$();if(!e||!this._$loadingIndicator){return}var t=this._sAdapteredChartType,i=t==="bar"||t.indexOf("horizontal")!==-1;var r=e.find(".v-plot-bound"),a=e.offset(),s={top:a.top,left:a.left,width:e.width(),height:e.height()};if(r.length){var n=r.offset(),o=r[0].getBoundingClientRect();s.top=n.top-1;s.left=n.left;s.width=o.width+1;if(i){s.height=Math.ceil(o.height+1)}else{s.height=Math.floor(o.height+1)}}this._$loadingIndicator.css(s);var l=this._$loadingIndicator.find(".loading-text");l.css({top:s.height/2,"font-weight":k.get("sapUiChartTitleFontWeight"),"font-size":k.get("sapUiChartMainTitleFontSize"),color:k.get("sapUiChartMainTitleFontSize")});this._$loadingIndicator.css({"background-color":k.get("sapUiExtraLightBG")})};L.prototype._getRequiredDimensions=function(){var e=this._getVisibleDimensions(),t=this.getInResultDimensions();return this._normalizeDorM(e.concat(t),true)};L.prototype._getRequiredMeasures=function(){return this._getVisibleMeasures(true)};L.prototype.exportToSVGString=function(e){var t='<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"/>',i=this._getVizFrame();if(i){t=i.exportToSVGString(e)}return t};L.prototype._getPagingController=function(){if(!this._pagingController){this._pagingController=new A(this)}return this._pagingController};return L});
//# sourceMappingURL=Chart.js.map