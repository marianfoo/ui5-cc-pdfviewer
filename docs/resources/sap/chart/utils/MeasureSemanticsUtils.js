/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/chart/coloring/ColoringUtils","sap/chart/coloring/ColorPalette","sap/chart/data/MeasureSemantics","sap/chart/coloring/CriticalityType","sap/chart/ChartLog","sap/chart/ColoringType","sap/chart/coloring/criticality/Criticality","sap/chart/utils/ChartUtils","sap/ui/thirdparty/jquery"],function(e,t,a,r,i,n,l,u,jQuery){"use strict";var s=["sapUiChartPaletteQualitativeHue1","sapUiChartPaletteQualitativeHue2","sapUiChartPaletteQualitativeHue3","sapUiChartPaletteQualitativeHue4","sapUiChartPaletteQualitativeHue5","sapUiChartPaletteQualitativeHue6","sapUiChartPaletteQualitativeHue7","sapUiChartPaletteQualitativeHue8","sapUiChartPaletteQualitativeHue9","sapUiChartPaletteQualitativeHue10","sapUiChartPaletteQualitativeHue11","sapUiChartPaletteQualitativeHue12","sapUiChartPaletteQualitativeHue13","sapUiChartPaletteQualitativeHue14","sapUiChartPaletteQualitativeHue15","sapUiChartPaletteQualitativeHue16","sapUiChartPaletteQualitativeHue17","sapUiChartPaletteQualitativeHue18","sapUiChartPaletteQualitativeHue19","sapUiChartPaletteQualitativeHue20","sapUiChartPaletteQualitativeHue21","sapUiChartPaletteQualitativeHue22"],c=[["sapUiChartPaletteSequentialHue1","sapUiChartPaletteSequentialHue1Light2","sapUiChartPaletteSequentialHue1Dark1"],["sapUiChartPaletteSequentialHue2","sapUiChartPaletteSequentialHue2Light2","sapUiChartPaletteSequentialHue2Dark1"]],o="sapUiChartPaletteSequentialNeutralDark2",f="sapUiChartPaletteSemanticNeutral",p={actual:"solid",projected:"dash",reference:"dot"},d={projected:"diagonalLightStripe",reference:"noFill"};var h=[r.Positive,r.Neutral,r.Critical,r.Negative];function v(e){var t={};if(e.getSemanticallyRelatedMeasures){var a=e.getSemanticallyRelatedMeasures();if(a){if(a.projectedValueMeasure){t.projected=a.projectedValueMeasure}if(a.referenceValueMeasure){t.reference=a.referenceValueMeasure}return t}}return t}function m(e,t){var a=e.reduce(function(e,t){e[t.getName()]={msr:t,sem:t.getSemantics&&t.getSemantics()||"actual",rel:v(t)};return e},{});jQuery.each(a,function(e,t){if(t.sem==="actual"){jQuery.each(t.rel,function(e,r){if(a[r]&&a[r].sem!==e){delete t.rel[e];var n=new i("error","Semantic Pattern",r+" shouldn't be used as "+e+" in semantic relation. ");n.display()}})}});if(t){for(var r=0;r<t.length;r++){var n=t[r];var l=v(n);if(l.projected&&l.reference&&a[l.projected]&&a[l.reference]){a[l.projected]={msr:n,sem:"projected",rel:{reference:l.reference}}}}}return a}function g(e,t,r){var n=[],l=0,u;var s;if(!r){s=e.slice().sort(function(a,r){var i=t[a.getName()].sem,n=t[r.getName()].sem;if(i<n){return-1}else if(i>n){return 1}else{return e.indexOf(a)-e.indexOf(r)}})}else{s=jQuery.extend(true,{},e)}jQuery.each(s,function(e,s){var c=s.getName();if(!t[c]){return}var o=t[c];var f={};var p;f[r?"actual":o.sem]=c;if(s.getLabel){p=s.getLabel();if(p){f.labels={};f.labels[o.sem]=p}}f.index=l++;if(!r&&(o.sem==="actual"||o.sem==="projected")){if(o.rel.projected){if(t[o.rel.projected]){f.projected=o.rel.projected;if(t[o.rel.projected].msr.getLabel){p=t[o.rel.projected].msr.getLabel();if(p){f.labels=jQuery.extend(true,f.labels,{projected:p})}}delete t[o.rel.projected]}else{u=new i("error","Semantic Pattern",o.msr.getName()+" has an invalid projected semantic relation.");u.display()}}if(o.rel.reference){if(t[o.rel.reference]){f.reference=o.rel.reference;if(t[o.rel.reference].msr.getLabel){p=t[o.rel.reference].msr.getLabel();if(p){f.labels=jQuery.extend(true,f.labels,{reference:p})}}delete t[o.rel.reference]}else{u=new i("error","Semantic Pattern",o.msr.getName()+" has an invalid reference semantic relation.");u.display()}}delete t[c]}f.order=[a.Actual,a.Projected,a.Reference];n.push(f)});return n}var C=function(e,t){if(!e.dataPointStyle){e=jQuery.extend(true,e,{dataPointStyle:{rules:[],others:null}})}e.dataPointStyle.rules.push(t)};var P=function(e,t,a){var r,i;if(e.indexOf("dual")===-1){i=s;r=s.length}else{var n=a==="valueAxis"?0:1;i=c[n];r=i.length}return{actual:i[t%r],projected:i[t%r],reference:i[t%r]}};var y=function(e,t,r){if(e.projectedValueStartTime&&e.timeAxis&&t!==a.Reference){r=r||function(){return true};var i=function(t){return t.hasOwnProperty(e.semanticMsrName)};if(t===a.Actual){return function(t){return r(t)&&i(t)&&new Date(t[e.timeAxis]).getTime()<e.projectedValueStartTime}}else if(t===a.Projected){return function(t){return r(t)&&i(t)&&new Date(t[e.timeAxis]).getTime()>=e.projectedValueStartTime}}}else{r=r||function(a){return a.hasOwnProperty(e[t])};return r}};var S=function(r,i,n,l){var u,s;if(i){if(r.iUnMentionedIndex==undefined){s=f}else{u=e.assignUnmentionedColor(t.CRITICALITY.Neutral,l.unMentionedTuplesNumber);s=u[r.iUnMentionedIndex]}}else{if(n===a.Reference&&l.hasSingleReference){s=o}else{u=P(l.chartType,r.index,r.valueAxisID);s=u[n]}}return s};var U=function(e,t,a){var r=false;if(e.chartType.indexOf("combination")>-1){if(e.chartType.indexOf("timeseries")>-1){if(t.index!==0||t.valueAxisID!=="valueAxis"){r=true}else{if(t.hasOwnProperty("actual")){if(!t.projectedValueStartTime&&a!=="actual"||a==="reference"){r=true}}}}else{if(a!=="actual"){r=true}}}return r};var x=function(r,i,n,l,s){var c,o,f={},v;var m=r[n];var g;(i||[]).forEach(function(e){if(e.parsed.msr&&e.parsed.msr.getName()===m){o=e.parsed;g=e.type}});var P=r.labels&&r.labels[n]?r.labels[n]:m;if(r.semanticMsrName&&(n===a.Actual||n===a.Projected)){f[r.semanticMsrName]=P}if(o){var x=h,b,j=0;if(i.Levels){x=i.Levels;b=t.GRADATION.SingleColorScheme[i.SingleColorScheme];j=x.length}x.forEach(function(a,h){var m=o.callbacks[a];if(m){var P=y(r,n,m[0]);var S=e.assignColor(b||t.CRITICALITY[a],j||m.length);if(i.Saturation==="DarkToLight"){S=S.reverse()}c=S[j===0?0:h];v={color:c,pattern:d[n]};if(u.CONFIG.lineChartType.indexOf(s.chartType)>-1){v.lineType=p[n];if(g==="Static"||g==="DelineatedMeasures"){v.lineColor=c}}if(U(s,r,n)){if(n==="projected"){v.pattern=""}v.lineType=p[n];if(g==="Static"){v.lineColor=c}}C(l,{callback:P,properties:v,displayName:o.legend[a],dataName:f})}})}else{if(!i||i.bShowUnmentionedMsr){var T=y(r,n);c=S(r,i,n,s);v={color:c,pattern:d[n]};if(u.CONFIG.lineChartType.indexOf(s.chartType)>-1){v.lineType=p[n];v.lineColor=c}if(U(s,r,n)){if(n==="projected"){v.pattern=""}v.lineType=p[n];v.lineColor=c}C(l,{callback:T,properties:v,displayName:P,dataName:f})}}};var b=function(e){return e.reference&&!(e.actual||e.projected)};var j=function(e,t,r,i){var n=e.filter(function(e){return e.reference}).length===1;var l=e.filter(function(e){return e.hasOwnProperty("iUnMentionedIndex")}).length;e.forEach(function(e){e.order.forEach(function(u){var s=true;if(i.indexOf("bullet")>-1){s=u!==a.Reference||b(e)}if(e.hasOwnProperty(u)&&s){var c={chartType:i,hasSingleReference:n,unMentionedTuplesNumber:l};x(e,t,u,r,c)}})})};var T=function(e,t,a,r,u,s){a=a||{};var c=a.type===n.Criticality&&a.subType==="MeasureValues"&&!(a.qualifiedSettings&&a.qualifiedSettings.bMBC);var o=a.type===n.Gradation&&a.subType==="DelineatedMeasures";var f={};if(!u){f.plotArea={dataPointStyle:null}}if(!s){f.legend={title:{text:null,visible:e.indexOf("waterfall")>-1?true:false}}}else{f.legend={}}var p,d=true;if(r&&H(t)||c||o){var h=c||o?a.qualifiedSettings:null;j(t,h,f.plotArea,e);jQuery.extend(true,f.legend,l.getLegendProps(h))}else if(a.ruleGenerator){try{var v=a.ruleGenerator();jQuery.extend(true,f,v.properties);p=v.colorScale}catch(e){if(e instanceof i){e.display()}else{throw e}}}if(p){d=false}return{properties:f,scales:p?[p]:[],replaceColorScales:d}};function H(e){if(e){return e.some(function(e){return e.hasOwnProperty(a.Projected)||e.hasOwnProperty(a.Reference)})}return false}function N(e,t){var a;var r;if(e){r=e.slice(0);r.sort(function(e,t){return e.index>t.index?1:-1})}if(t.indexOf("combination")>-1&&e){var i=true;for(var n=0;n<r.length;n++){if(r[n].hasOwnProperty("projected")||r[n].hasOwnProperty("reference")){i=false;break}}var l=[];var u=[];if(!i){r.forEach(function(e){e.order.forEach(function(t){if(e.hasOwnProperty(t)){if(e.valueAxisID==="valueAxis"){l.push(t==="actual"?"bar":"line")}else{u.push(t==="actual"?"bar":"line")}}})})}else{return}a={plotArea:{dataShape:{primaryAxis:l,secondaryAxis:u}}}}return a}return{getTuples:function(e,t,a){return g(e,m(e,t),a)},getSemanticVizSettings:T,hasSemanticRelation:H,getSemanticSettingsForCombination:N}});
//# sourceMappingURL=MeasureSemanticsUtils.js.map