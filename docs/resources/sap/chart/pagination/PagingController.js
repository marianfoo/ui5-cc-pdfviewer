/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/model/Sorter","sap/ui/thirdparty/jquery"],function(e,jQuery){"use strict";var t=500;function i(e,t,i){var a=e.getContexts(t,i),r;if(a.length===0||a.dataRequested){r=true}else{r=a.some(function(e){return e===undefined})}return!r}var a=function(e){this._mMeasureRange={};this._iRenderedPageNo=-1;this._bUnderPaging=false;this._iMaxPageNo=-1;this._iRemainingRecords=-1;this._iOffset=null;this._oChart=e;this._bInitialized=false;this._aPagingSorters=null;this._bMinMaxQueried=false;this._oColorTracker=e._oColorTracker;var i=this._oChart._getDataset();if(i){i.setRange(0,t*2)}var r=this._oChart._getVizFrame();r.attachEvent("_scroll",a.prototype._scrollHandler.bind(this))};a.prototype.bindingChanged=function(){if(!this._bInitialized||!this._bMinMaxQueried){this.init(true)}else if(this.isUnderPaging()){this.paging(this._scrollRatio)}};a.prototype.reset=function(){this._bInitialized=false;this._iRenderedPageNo=0;this._mMeasureRange={};this._bMinMaxQueried=false;this._oColorTracker.clear();var i=this._oChart.getBinding("data");var a=this._oChart._getDataset();if(!a||!i){return}var r=this._oChart._prepareFeeds();r._order=r._order.filter(function(e){return e!=="MND"&&this._oChart.getDimensions().map(function(e){return e.getName()}).indexOf(e)>-1}.bind(this));this._aPagingSorters=null;this._oChart._getVizFrame()._runtimeScales(this._oColorTracker.get(),true);this._oChart._getVizFrame()._readyToRender(false);var n;if(this._oChart.getBindingInfo("data").length){n=Math.min(t*2,this._oChart.getBindingInfo("data").length)}else{n=t*2}a.setRange(0,n);var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");if(r._order.length){var o=this._oChart._aFeeds._order.map(function(t){return new e(t)});i.sort(o);this._aPagingSorters=o}else if(s&&i.getModel()instanceof s){i.sort([])}a.setPagingOption({bEnabled:false})};a.prototype.getPagingSorters=function(){return this._aPagingSorters};a.prototype.isUnderPaging=function(){return!!this._bUnderPaging};a.prototype.init=function(e){this._bInitialized=true;this._bUnderPaging=false;var a=this._oChart._getVizFrame();var r=a.getDataset();var n=r.getBinding("data");if(!n){return}var s=n.isA("sap.ui.model.analytics.AnalyticalBinding")?n.getTotalSize():n.getLength();var o;if(s>=0){if(this._oChart.getBindingInfo("data").length){this._iTotalSize=Math.min(this._oChart.getBindingInfo("data").length,s)}else{this._iTotalSize=s}if(this._iTotalSize>t*2){this._bUnderPaging=true;this._iMaxPageNo=Math.floor(this._iTotalSize/t)-1;this._iRemainingRecords=this._iTotalSize%t;this._iOffset=null;this._iRenderedPageNo=0;var h=t/this._iTotalSize;o={bEnabled:true,sMode:"reset",thumbRatio:h};r.setRange(0,t);if(e){this._bMinMaxQueried=true;var g=this._oChart._oMeasureRangePromise||this._queryMinMax(this._oChart,n);g.then(function(e){this._mMeasureRange=e;this._oChart._invalidateBy({source:this._oChart,keys:{vizFrame:true}});this._oChart.setBusy(false);a._readyToRender(i(n,0,t))}.bind(this))}else{a._readyToRender(i(n,0,t))}this._bUnderPaging=true}else{this._mMeasureRange={};o={bEnabled:false};this._bUnderPaging=false;r.setRange(0,this._iTotalSize);a._readyToRender(i(n,0,this._iTotalSize))}r.setPagingOption(o)}};a.prototype.paging=function(e){var a=Math.floor(this._iTotalSize*e/t);var r=this._oChart._getVizFrame();a=Math.min(a,this._iMaxPageNo);this._iOffset=null;var n=Math.max((a-1)*t,0);var s,o;if(a===0){s=t;o=t}else if(a===this._iMaxPageNo){s=t*2+this._iRemainingRecords;o=t+this._iRemainingRecords}else{s=t*2;o=t}this._iOffset=(this._iTotalSize*e-a*t)/o;if(this._iRenderedPageNo===a){var h={plot:{transform:{translate:{translateByPage:{context:this._middleCtx,offset:this._iOffset}}}}};r._states(h)}else{if(this._pagingTimer){clearTimeout(this._pagingTimer)}var g=r.getDataset();var _=g.getBinding("data");this._pagingTimer=setTimeout(function(){g.setRange(n,s);g.setPagingOption({bEnabled:true,sMode:"update",thumbRatio:null});var e=i(_,n,s);if(e){this._iRenderedPageNo=a;g.invalidate();r._readyToRender(true);r.invalidate();this._oColorTracker.add(r._runtimeScales());r._runtimeScales(this._oColorTracker.get(),true)}else{r._readyToRender(false)}}.bind(this),50);this._sLoadingTimer=this._sLoadingTimer||setTimeout(function(){this._oChart._showLoading(true)}.bind(this),200)}};a.prototype.vizFrameRenderCompleted=function(){if(this._sLoadingTimer){clearTimeout(this._sLoadingTimer);this._sLoadingTimer=null}this._oChart._showLoading(false);if(!this._bUnderPaging){return}var e=this._oChart._getVizFrame();var i=e.getDataset();var a=i.getBinding("data");var r=this._iRenderedPageNo;if(r!==0){var n=r*t-1;this._middleCtx=a.getContexts(n,1)[0].getObject()}else{this._middleCtx=null}if(this._middleCtx||this._iOffset){var s={plot:{transform:{translate:{translateByPage:{context:this._middleCtx,offset:this._iOffset}}}}};e._states(s)}};a.prototype._scrollHandler=function(e){if(this._oChart._isEnablePaging()){this._scrollRatio=e.getParameters().position;this.paging(this._scrollRatio)}};a.prototype._queryMinMax=function(e,t){var i=e._getRequiredDimensions().map(function(e){return e.getName()}),a=e._getRequiredMeasures().map(function(e){return e.getName()});var r=a.reduce(function(e,t){e[t]={min:{},max:{}};return e},{});return new Promise(function(e,n){function s(){var t=a.every(function(e){return r[e].min.requested&&r[e].max.requested});if(t){e(r)}}function o(e,t,i){r[e][t].requested=true;r[e][t].value=parseFloat(i&&i.results[0][e]);s()}function h(e,t,i){r[e][t].requested=true;r[e][t].error=i;s()}var g=a.reduce(function(e,t){return e.concat({urlParameters:{$select:i.concat(t).join(","),$top:1,$orderby:t+" asc"},success:o.bind(null,t,"min"),error:h.bind(null,t,"min")},{urlParameters:{$select:i.concat(t).join(","),$top:1,$orderby:t+" desc"},success:o.bind(null,t,"max"),error:h.bind(null,t,"max")})},[]);var _=t.getPath(),d=t.getModel();g.forEach(function(e){d.read(_,e)})}).then(function(e){var t={};jQuery.each(e,function(e,i){t[e]={min:i.min.value,max:i.max.value}});return t})};a.prototype.getMeasureRange=function(){return this._mMeasureRange};return a});
//# sourceMappingURL=PagingController.js.map