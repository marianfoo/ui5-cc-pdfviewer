/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_omit","sap/base/util/merge","sap/base/Log","sap/ui/fl/apply/_internal/changes/Utils","sap/ui/fl/write/api/ChangesWriteAPI","sap/ui/fl/ChangePersistenceFactory"],function(e,n,t,i,o,r){"use strict";var a={};function s(e,n){if(n.getSelector().name!==e.extensionPointName){return false}return i.filterChangeByView(e,n)}function g(e,n){if(n.fragmentId){var t=e.getExtensionPointInfo&&e.getExtensionPointInfo();if(t){return n.fragmentId!==t.fragmentId}return true}return false}function l(e,t,i){var o=e.getSelector();if(t.closestAggregationBindingCarrier&&t.closestAggregationBinding){o=n(o,{id:t.closestAggregationBindingCarrier,idIsLocal:false});var r={id:t.targetControl.getId(),idIsLocal:false};if(i){e.originalSelectorToBeAdjusted=r}else{e.setDependentSelector({originalSelector:r})}e.setContent({boundAggregation:t.closestAggregationBinding})}else{o=n(o,{id:t.targetControl.getId(),idIsLocal:false})}e.setSelector(o)}a.getChangesForExtensionPoint=function(e,n){if(!n.extensionPointName){t.error("Missing name from extension point info!");return Promise.resolve([])}return e.getChangesForComponent().then(function(e){return e.filter(s.bind(undefined,n))})};a.enhanceExtensionPointChanges=function(n,t){n.extensionPointName=t.name;var i=r.getChangePersistenceForControl(t.targetControl);return a.getChangesForExtensionPoint(i,n).then(function(r){var a=[];r.forEach(function(r){if(r.isInInitialState()&&!(r.getExtensionPointInfo&&r.getExtensionPointInfo())){r.setExtensionPointInfo(t);l(r,t,false);if(i.isChangeMapCreated()){i.addChangeAndUpdateDependencies(n.appComponent,r)}}else if(g(r,t)){var s=r.convertToFileContent();var f=r.getContent();var c=e(s,["dependentSelector","fileName","selector","content"]);Object.keys(f).forEach(function(e){c[e]=f[e]});c.support.sourceChangeFileName=r.getId()||"";a.push(o.create({changeSpecificData:c,selector:{view:t.view,name:t.name}}).then(function(e){l(e,t,true);e.setExtensionPointInfo(t);e.setModuleName(r.getModuleName());e.setCreation(r.getCreation());i.addChangeAndUpdateDependencies(n.appComponent,e,r)}))}});return Promise.all(a).then(function(){return r})})};return a});
//# sourceMappingURL=ExtensionPointState.js.map