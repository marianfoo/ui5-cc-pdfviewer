/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","sap/base/Log","sap/ui/core/CustomData"],function(t,e){"use strict";var a={};a.sync={};a.appliedChangesCustomDataKey="sap.ui.fl.appliedChanges";a.failedChangesCustomDataKeyJs="sap.ui.fl.failedChanges.js";a.failedChangesCustomDataKeyXml="sap.ui.fl.failedChanges.xml";a.notApplicableChangesCustomDataKey="sap.ui.fl.notApplicableChanges";a.sync.getAppliedCustomDataValue=function(t,e){var n=r(t,a._getCustomDataKey(e,a.appliedChangesCustomDataKey));return n.customDataValue};a.getAppliedCustomDataValue=function(t,e,n){return o(t,n,a._getCustomDataKey(e,a.appliedChangesCustomDataKey)).then(function(t){return t.customDataValue})};a.sync.getParsedRevertDataFromCustomData=function(t,n){var u=a.sync.getAppliedCustomDataValue(t,n);try{return u&&JSON.parse(u)}catch(t){e.error("Could not parse revert data from custom data",u);return undefined}};a.getParsedRevertDataFromCustomData=function(t,e,n){return a.getAppliedCustomDataValue(t,e,n).then(function(t){return t&&JSON.parse(t)})};a.sync.hasChangeApplyFinishedCustomData=function(e,n){var u=t.getAggregation(e,"customData")||[];var r=[a._getCustomDataKey(n,a.appliedChangesCustomDataKey),a._getCustomDataKey(n,a.failedChangesCustomDataKeyJs),a._getCustomDataKey(n,a.notApplicableChangesCustomDataKey)];return u.some(function(e){var a=t.getProperty(e,"key");if(r.indexOf(a)>-1){return!!t.getProperty(e,"value")}return false})};a.hasChangeApplyFinishedCustomData=function(t,e,n){return Promise.resolve().then(n.getAggregation.bind(n,t,"customData")).then(function(t){t=t||[];var u=[a._getCustomDataKey(e,a.appliedChangesCustomDataKey),a._getCustomDataKey(e,a.failedChangesCustomDataKeyJs),a._getCustomDataKey(e,a.notApplicableChangesCustomDataKey)];return Promise.all(t.map(function(t){return Promise.resolve().then(n.getProperty.bind(n,t,"key")).then(function(e){if(u.indexOf(e)>-1){return n.getProperty(t,"value")}return undefined}).then(function(t){return!!t})})).then(function(t){return t.includes(true)})})};function n(t,e){var a=e.getRevertData();if(t&&a!==undefined){return JSON.stringify(a)}return"true"}a.addAppliedCustomData=function(t,e,r,o){var s=n(o,e);var i=a._getCustomDataKey(e,a.appliedChangesCustomDataKey);return u(t,i,s,r)};a.addFailedCustomData=function(t,e,n,r){var o=a._getCustomDataKey(e,r);return u(t,o,"true",n)};a.sync.destroyAppliedCustomData=function(t,e,n){var u=a._getCustomDataKey(e,a.appliedChangesCustomDataKey);var o=r(t,u);if(o.customData){n.destroy(o.customData)}};a.destroyAppliedCustomData=function(t,e,n){var u=a._getCustomDataKey(e,a.appliedChangesCustomDataKey);return o(t,n,u).then(function(t){if(t.customData){n.destroy(t.customData)}})};a.getCustomDataIdentifier=function(t,e,n){if(t){return a.appliedChangesCustomDataKey}if(!e){return a.notApplicableChangesCustomDataKey}if(n){return a.failedChangesCustomDataKeyXml}return a.failedChangesCustomDataKeyJs};a._getCustomDataKey=function(t,e){return e+"."+t.getId()};function u(t,e,a,n){return o(t,n.modifier,e).then(function(u){if(!u.customData){return n.modifier.createAndAddCustomData(t,e,a,n.appComponent)}return n.modifier.setProperty(u.customData,"value",a)})}function r(e,a){var n=t.getAggregation(e,"customData")||[];var u={};n.some(function(e){var n=t.getProperty(e,"key");if(n===a){u.customData=e;u.customDataValue=t.getProperty(e,"value");return true}return false});return u}function o(t,e,a){return Promise.resolve().then(e.getAggregation.bind(e,t,"customData")).then(function(t){t=t||[];var n={};return t.reduce(function(t,u){return t.then(e.getProperty.bind(e,u,"key")).then(function(t){if(t===a){n.customData=u;return e.getProperty(u,"value")}return undefined}).then(function(t){if(t){n.customDataValue=t}})},Promise.resolve()).then(function(){return n})})}return a},true);
//# sourceMappingURL=FlexCustomData.js.map