/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/security/encodeURL","sap/ui/core/Core","sap/ui/fl/Utils","sap/ui/thirdparty/jquery"],function(e,t,r,n,jQuery){"use strict";var a={v2:"v2",v4:"v4"};function i(e){if(e&&e.split){var t=e.split(".");return t[t.length-1]}return null}function u(e){var t=[];try{var r=JSON.parse(e.responseText);if(r&&r.error&&r.error.message&&r.error.message.value){t.push({severity:"error",text:r.error.message.value})}else{t.push({severity:"error",text:e.responseText})}}catch(e){}return t}function o(t){var r=i(v(t));if(!r){var n=t.getBindingContext?t.getBindingContext():null;if(n&&n.getPath){r=n.getPath()}}if(!r){e.warning("Control not bound to a path")}return r}function s(e,t,r){return e.metadataLoaded().then(function(){var n=null;if(r){var a=e.oMetadata._getEntityTypeByName(r);n=e.oMetadata._getEntitySetByType(a)}if(!n){n=e.oMetadata._getEntitySetByPath(t)}return n?n.name:null})}function l(e,t){var r=e.getMetaModel();var n=r.getMetaPath(t);return r.requestObject(n).then(function(e){var t=r.fetchEntityContainer().getResult();var n=t[t.$EntityContainer];var a=Object.keys(n).filter(function(t){return n[t]===e});return a.length>0&&a[0]})}function f(e,t,r){return e.metadataLoaded().then(function(){var n=null;if(r){n=e.oMetadata._getEntityTypeByName(r)}if(!n){n=e.oMetadata._getEntityTypeByPath(t)}return n?n.name:null})}function c(e,t){var r=e.getMetaModel();var n=r.getMetaPath(t);return r.requestObject(n).then(function(e){return i(e.$Type)})}function v(e){return e.getEntitySet?e.getEntitySet():null}function g(e){return e.getEntityType?e.getEntityType():null}function p(t){var r=null;if(t&&t.sServiceUrl){r=t.sServiceUrl}if(!r){e.warning("Model has no Service Uri")}return r}function d(e){if(e){if(e.isA("sap.ui.model.odata.v2.ODataModel")){return a.v2}else if(e.isA("sap.ui.model.odata.v4.ODataModel")){return a.v4}}return null}function y(t){if(t){var r=t.getModel?t.getModel():null;if(d(r)){return r}e.warning("Unsupported model type or protocol");return null}e.warning("No Control passed");return null}var h={};h.checkControlPrerequisites=function(t){if(t){var r=y(t);var n=p(r);var a=o(t);var i=g(t);return Boolean(n&&(a||i))}e.warning("No Control passed");return false};h.executeRequest=function(e,t){var r=e+this.getUriParameters(t);return new Promise(function(e){var t={type:"GET",async:true,dataType:"json"};jQuery.ajax(r,t).done(function(t){var r=t&&t.d;e({errorOccurred:false,result:r})}).fail(function(t){e({errorOccurred:true,errorMessages:u(t),statusCode:t.status})})})};h.getBoundEntitySet=function(e){var t=y(e);var r=d(t);if(r===a.v2){return s(t,o(e),g(e))}else if(r===a.v4){return l(t,o(e))}return Promise.resolve(null)};h.getBoundEntityType=function(e){var t=y(e);var r=d(t);if(r===a.v2){return f(t,o(e),g(e))}else if(r===a.v4){return c(t,o(e))}return Promise.resolve(null)};h.getNavigationUriForIntent=function(e){return n.getUShellService("CrossApplicationNavigation").then(function(t){if(t&&t.hrefForExternal){return t.hrefForExternal(e)}return Promise.resolve(null)})};h.getServiceUri=function(e){var t=y(e);return p(t)};h.getText=function(e){return r.getLibraryResourceBundle("sap.ui.fl").getText(e)};h.getUriParameters=function(e){if(!e){return""}var r=[];Object.keys(e).forEach(function(n){if(n){var a="'"+t(e[n]||"")+"'";r.push(t(n)+"="+a)}});return r.length===0?"":"?"+r.join("&")};h.isNavigationSupportedForIntents=function(e){return n.getUShellService("CrossApplicationNavigation").then(function(t){if(t&&t.isNavigationSupported){return t.isNavigationSupported(e).then(function(e){return e.map(function(e){return e&&e.supported===true})})}return Promise.resolve(e.map(function(){return false}))})};return h});
//# sourceMappingURL=Utils.js.map