/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/TooltipBase","./CalloutBaseRenderer","sap/ui/core/Popup","sap/ui/events/ControlEvents","sap/ui/events/KeyCodes","sap/ui/core/Configuration","sap/ui/dom/jquery/control","sap/ui/dom/jquery/Focusable"],function(jQuery,t,e,o,i,s,n,p){"use strict";var r=i.Dock;var u=e.extend("sap.ui.commons.CalloutBase",{metadata:{library:"sap.ui.commons",deprecated:true,events:{open:{parameters:{parent:{type:"sap.ui.core.Control"}}},close:{},beforeOpen:{allowPreventDefault:true,parameters:{parent:{type:"sap.ui.core.Control"}}},opened:{}}}});u.prototype.init=function(){this.oPopup=new i;this.oPopup.setShadow(true);this.oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.commons");this.setPosition(r.BeginBottom,r.BeginTop);this.fAnyEventHandlerProxy=jQuery.proxy(this.onAnyEvent,this);var t=this;this.oPopup._applyPosition=function(e){i.prototype._applyPosition.call(this,e);t.setTip()};this.oPopup.setFollowOf(i.CLOSE_ON_SCROLL)};u.prototype.exit=function(){this.oPopup.close();this.oPopup.detachEvent("opened",this.handleOpened,this);this.oPopup.detachEvent("closed",this.handleClosed,this);this.oPopup.destroy();delete this.oPopup;delete this.oRb;s.unbindAnyEvent(this.fAnyEventHandlerProxy)};u.prototype._getPopup=function(){return this.oPopup};u.prototype.hasChild=function(t){return t&&!!jQuery(t).closest(this.getDomRef()).length};u.prototype.isPopupElement=function(t){if(!t){return false}if(this.hasChild(t)){return true}var e=sap.ui.getCore().getStaticAreaRef();var o=parseInt(jQuery(t).closest(jQuery(e).children()).css("z-index"));var i=parseInt(this.$().css("z-index"));return o&&i&&o>=i};u.prototype.setTip=function(){if(!this.oPopup||!this.oPopup.isOpen()){return}var t=this._currentControl.$(),e=this.$(),o=this.$("arrow"),i=e.offset(),s=t.offset(),n=true,r={},u={l:i.left,r:i.left+e.outerWidth(),w:e.outerWidth(),t:i.top,b:i.top+e.outerHeight(),h:e.outerHeight()},h={l:s.left,r:s.left+t.outerWidth(),w:t.outerWidth(),t:s.top,b:s.top+t.outerHeight(),h:t.outerHeight()},f=(e.outerWidth()-e.innerWidth())/2,l=o.outerWidth()*1.4,a=o.outerWidth()/5,c=a-f-8,d=this.getMyPosition();if(u.r<h.l-c){r.x="right"}else if(u.l-c>h.r){r.x="left"}if(u.t>h.b-c){r.y="top"}else if(u.b<h.t+c){r.y="bottom"}if(r.x){var y=0;if(d.indexOf("top")>-1){y=20}else if(d.indexOf("bottom")>-1){y=u.h-20-l}else{y=(u.h-l)/2}var P=u.t+y+l/2+f;if(P<h.t||P>h.b||h.t>u.t&&h.b<u.b){y=(Math.max(u.t,h.t)+Math.min(u.b,h.b))/2-u.t-l/2}o.css(r.x,c+"px");o.css("top",y);if(y<0||y>u.h-l){n=false}}if(r.y){var m=p.getRTL();if(m){d.replace("begin","right").replace("end","left")}var O=0;if(d.indexOf("begin")>-1||d.indexOf("left")>-1){O=20}else if(d.indexOf("right")>-1||d.indexOf("end")>-1){O=u.w-20-l}else{O=(u.w-l)/2}var v=u.l+O+l/2+f;if(v<h.l||v>h.r){O=(Math.max(u.l,h.l)+Math.min(u.r,h.r))/2-u.l-l/2}o.css(r.y,c+"px");o.css("left",O+"px");if(O<0||O>u.w-l){n=false}}if(r.x&&r.y||!r.x&&!r.y){n=false}o.toggle(n)};u.prototype.adjustPosition=function(){function t(){if(this.oPopup){var t=this._currentControl.getDomRef();this.oPopup.setPosition(this.getMyPosition(),this.getAtPosition(),t,this.getOffset(),this.getCollision())}}setTimeout(jQuery.proxy(t,this),0)};u.prototype.focus=function(){if(this.oPopup&&this.oPopup.isOpen()){var t=this.$("cont");h(t.firstFocusableDomRef()||t.get(0))}};u.prototype.openPopup=function(t){if(!this.oPopup||this.oPopup.isOpen()){return}if(e.sOpenTimeout){clearTimeout(e.sOpenTimeout);e.sOpenTimeout=undefined}if(!this.fireEvent("beforeOpen",{parent:this._currentControl},true,false)){if(!this.sCloseNowTimeout){e.sOpenTimeout=setTimeout(function(){this.openPopup(this._currentControl)}.bind(this),200)}return}this.oParentFocusInfo=t.getFocusInfo();this.oPopup.attachEvent("opened",this.handleOpened,this);e.prototype.openPopup.call(this,t);this.adjustPosition();this.fireOpen({parent:this._currentControl})};u.prototype.close=function(){if(this.oPopup&&this.oPopup.isOpen()&&!this.sCloseNowTimeout){if(e.sOpenTimeout){clearTimeout(e.sOpenTimeout);e.sOpenTimeout=undefined}this.closePopup()}};u.prototype.closePopup=function(){var t=this.oPopup!==undefined&&this.oPopup.isOpen();if(this.fAnyEventHandlerProxy){s.unbindAnyEvent(this.onAnyEvent)}e.prototype.closePopup.call(this);if(t&&this._currentControl&&this.bFocused){this._currentControl.applyFocusInfo(this.oParentFocusInfo);this.bFocused=false}this.fireClose()};u.prototype.handleClosed=function(){if(this.oPopup){this.oPopup.detachEvent("closed",this.handleClosed,this);this.fireClosed()}};u.prototype.onkeydown=function(t){var o=t.ctrlKey&&t.which==n.I;var i=t.which==n.ESCAPE;if(!o&&!i){if(jQuery(t.target).control(0)===this._currentControl){this.close()}return}if(o){if(this.oPopup&&this.oPopup.isOpen()){return}this.bDoFocus=true}e.prototype.onkeydown.call(this,t)};u.prototype.handleOpened=function(){this.oPopup.detachEvent("opened",this.handleOpened,this);if(this.bDoFocus){this.focus();this.bDoFocus=false;this.bFocused=true}this.$().css("display","");this.fireOpened();s.bindAnyEvent(this.fAnyEventHandlerProxy)};u.prototype.onfocusin=function(t){this.bFocused=true;var e=t.target;if(e.id===this.getId()+"-fhfe"){h(this.$("cont").lastFocusableDomRef())}else if(e.id===this.getId()+"-fhee"){h(this.$("cont").firstFocusableDomRef())}};u.prototype.onfocusout=function(t){return};u.prototype.onmouseover=function(t){if(this.oPopup&&(this.oPopup.isOpen()&&this.oPopup.getContent()==this)){if(this.sCloseNowTimeout){clearTimeout(this.sCloseNowTimeout);this.sCloseNowTimeout=null}return}else{e.prototype.onmouseover.call(this,t)}};u.prototype.onmouseout=function(t){if(this.oPopup&&(this.oPopup.isOpen()&&this.isPopupElement(t.relatedTarget))){return}e.prototype.onmouseout.call(this,t)};u.prototype.onmousedown=function(t){if(jQuery(t.target).control(0)===this._currentControl){this.close();this.removeStandardTooltips()}};u.prototype.onAnyEvent=function(t){if(this.oPopup&&!this.oPopup.isOpen()||t.type!="mouseover"||this.hasChild(t.target)){return}var o=this.isPopupElement(t.target)||jQuery(t.target).control(0)===this._currentControl;if(!o&&!this.sCloseNowTimeout&&!e.sOpenTimeout){this.sCloseNowTimeout=setTimeout(function(){this.closePopup()}.bind(this),400)}if(o&&this.sCloseNowTimeout){clearTimeout(this.sCloseNowTimeout);this.sCloseNowTimeout=null}};u.prototype.setPosition=function(t,e){var o=t||r.BeginBottom;var i=e||r.BeginTop;var s=0,n=0,p=0,u=0,h=5;if(o.indexOf("begin")>-1||o.indexOf("left")>-1){s=-1}else if(o.indexOf("right")>-1||o.indexOf("end")>-1){s=1}if(i.indexOf("begin")>-1||i.indexOf("left")>-1){p=-1}else if(i.indexOf("right")>-1||i.indexOf("end")>-1){p=1}if(o.indexOf("top")>-1){n=-1}else if(o.indexOf("bottom")>-1){n=1}if(i.indexOf("top")>-1){u=-1}else if(i.indexOf("bottom")>-1){u=1}var f=(s-p)*s*p*h+" "+(n-u)*n*u*h;this.setMyPosition(o);this.setAtPosition(i);this.setOffset(f);return this};function h(t){if(t){t.focus()}}return u});
//# sourceMappingURL=CalloutBase.js.map