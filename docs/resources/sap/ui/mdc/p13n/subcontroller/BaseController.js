/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/array/diff","sap/ui/base/Object","sap/ui/mdc/p13n/FlexUtil","sap/ui/mdc/p13n/P13nBuilder","sap/base/util/merge","sap/base/util/deepEqual","sap/ui/model/json/JSONModel","sap/m/p13n/SelectionPanel"],function(e,t,n,i,o,a,r,s){"use strict";var p=t.extend("sap.ui.mdc.p13n.subcontroller.BaseController",{constructor:function(e){t.call(this);this._oAdaptationControl=e;this._oP13nData=null;this._bLiveMode=false;this._bResetEnabled=false}});p.prototype.getUISettings=function(){return{title:"Adaptation Dialog"}};p.prototype.getAdaptationControl=function(){return this._oAdaptationControl};p.prototype.getLiveMode=function(){return this._bLiveMode};p.prototype.getChangeOperations=function(){return{add:null,remove:null,move:null}};p.prototype.getResetEnabled=function(){return this._bResetEnabled};p.prototype.getSelectorForReset=function(){return this._oAdaptationControl};p.prototype.sanityCheck=function(e){return e};p.prototype.getAdaptationUI=function(e){var t=new s;var n=this.mixInfoAndState(e);t.setP13nData(n.items);this._oPanel=t;return Promise.resolve(t)};p.prototype.getCurrentState=function(){return this._oAdaptationControl.getCurrentState()[this.getStateKey()]};p.prototype.getStateKey=function(){return"items"};p.prototype.getDelta=function(e){var t=this._getPresenceAttribute(e.externalAppliance);var n;var i=function(e){return e.hasOwnProperty(t)&&e[t]===false?false:true};n=e.applyAbsolute?e.changedState.filter(i):this._getFilledArray(e.existingState,e.changedState,t).filter(i);e.changedState=n;if(a(e.existingState,n)){return[]}else{return this.getArrayDeltaChanges(e)}};p.prototype.getArrayDeltaChanges=function(t){var i=t.existingState;var o=t.changedState;var a=t.control;var r=t.changeOperations.add;var s=t.changeOperations.remove;var p=t.changeOperations.move;var l=t.generator;var c=t.deltaAttributes||[];var d=function(e){var t="";c.forEach(function(n){t=t+e[n]});return t};var u=e(i,o,d);var h=function(e,t){return t.filter(function(t){return t&&t.name===e.name})[0]};var f=[];var g=i.slice(0);u.forEach(function(e){if(e.type==="delete"&&g[e.index]===undefined){g.splice(e.index,1);return}var t,i,d;if(e.type==="insert"){i=h(o[e.index],g);if(i){i.index=g.indexOf(i);g.splice(i.index,1,undefined);f=f.concat(this._createAddRemoveChange(a,s,n._getChangeContent(i,c),l))}}t=e.type==="delete"?g[e.index]:o[e.index];t.index=e.index;if(e.type==="delete"){g.splice(t.index,1)}else{g.splice(t.index,0,t)}if(p){d=f.length;if(d){i=f[d-1];i=i?i.changeSpecificData.content:undefined}if(i&&i.name===t.name&&e.index!=i.index){f.pop();f=f.concat(this._createMoveChange(i.id,i.name,e.index,p,a,p!=="moveSort",l));return}}f=f.concat(this._createAddRemoveChange(a,e.type==="delete"?s:r,n._getChangeContent(t,c),l))}.bind(this));return f};p.prototype._createAddRemoveChange=function(e,t,n){var i={selectorElement:e,changeSpecificData:{changeType:t,content:n}};return i};p.prototype._createMoveChange=function(e,t,n,i,o,a){var r={selectorElement:o,changeSpecificData:{changeType:i,content:{id:e,name:t,index:n}}};if(!a){delete r.changeSpecificData.content.id}return r};p.prototype._getPresenceAttribute=function(e){return"visible"};p.prototype.getBeforeApply=function(){return Promise.resolve()};p.prototype.mixInfoAndState=function(e){var t=this.getCurrentState();var n=i.arrayToMap(t);var o=i.prepareAdaptationData(e,function(e,t){var i=n[t.name];e.visible=!!i;e.position=i?i.position:-1;return t.visible});i.sortP13nData({visible:"visible",position:"position"},o.items);o.items.forEach(function(e){delete e.position});return o};p.prototype.getP13nData=function(){return this._oPanel?this._oPanel.getP13nData():this._oAdaptationModel.getProperty("/items")};p.prototype.model2State=false;p.prototype.update=function(e){if(this._oPanel){var t=this.mixInfoAndState(e);this._oPanel.setP13nData(t.items)}else if(this._oAdaptationModel){var n=this.mixInfoAndState(e);this._oAdaptationModel.setProperty("/items",n.items);this._oAdaptationModel.setProperty("/itemsGrouped",n.itemsGrouped)}};p.prototype._getFilledArray=function(e,t,n){var a=o([],e);var r=o([],t);var s=i.arrayToMap(e);r.forEach(function(e){var t=s[e.name];if(!e.hasOwnProperty(n)||e[n]){var i=e.position;if(t){i=i>-1?i:t.position;var o=t.position;a.splice(i,0,a.splice(o,1)[0])}else{i=i>-1?i:a.length;a.splice(i,0,e)}a[i]=e}else if(t){a[t.position][n]=false}});return a};p.prototype._getP13nModel=function(e){if(!this._oAdaptationModel){this._oAdaptationModel=new r(this.mixInfoAndState(e));this._oP13nData=this._oAdaptationModel.getData();this._oAdaptationModel.setSizeLimit(1e4)}else{this.update(e)}return this._oAdaptationModel};p.prototype.changesToState=function(e){var t=[];e.forEach(function(e){var n=o({},e.changeSpecificData.content);var i=n.index;delete n.index;if(e.changeSpecificData.changeType===this.getChangeOperations()["move"]){n.position=i}if(e.changeSpecificData.changeType===this.getChangeOperations()["remove"]){n[this._getPresenceAttribute()]=false}t.push(n)}.bind(this));return t};p.prototype.destroy=function(){t.prototype.destroy.apply(this,arguments);this._oAdaptationControl=null;this._bLiveMode=null;this._oPanel=null;this._bResetEnabled=null;this._oAdaptationModel=null};return p});
//# sourceMappingURL=BaseController.js.map