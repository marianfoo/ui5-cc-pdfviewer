/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/valuehelp/base/Container","sap/ui/mdc/util/loadModules","sap/ui/dom/units/Rem","sap/ui/thirdparty/jquery","sap/ui/core/library"],function(t,e,n,jQuery,o){"use strict";var i,r,a,s,p;var l=o.ValueState;var u=t.extend("sap.ui.mdc.valuehelp.Popover",{metadata:{library:"sap.ui.mdc",interfaces:["sap.ui.mdc.valuehelp.ITypeaheadContainer","sap.ui.mdc.valuehelp.IDialogContainer","sap.ui.core.PopupInterface"],properties:{},defaultAggregation:"content"}});u.prototype.invalidate=function(e){if(e){var n=this.getAggregation("_container");var o=this._oCurrentContent;if(n&&o&&e===o&&!this._bIsBeingDestroyed){n.invalidate(e)}else{t.prototype.invalidate.apply(this,arguments)}}};u.prototype._getUIAreaForContent=function(){var e=this.getAggregation("_container");if(e){return e.getUIArea()}return t.prototype._getUIAreaForContent.apply(this,arguments)};u.prototype._getContent=function(){var t=this.getContent();return t&&t[0]};u.prototype._getContainer=function(){var t=this.getAggregation("_container");var n=function(t,e){if(t&&t.getValueState&&t.getValueState()!==l.None){e.setText(t.getValueStateText());e.setValueState(t.getValueState());e.setVisible(true)}else{e.setVisible(false)}};if(!t){return e(["sap/m/Popover","sap/m/library","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/ValueStateHeader"]).then(function(e){i=e[0];r=e[1];a=e[2];s=e[3];p=e[4];var o=new p;n(this.getControl(),o);t=new i(this.getId()+"-pop",{contentHeight:"auto",placement:r.PlacementType.VerticalPreferredBottom,showHeader:false,showArrow:false,title:this.getTitle(),titleAlignment:r.TitleAlignment.Center,afterOpen:this._handleOpened.bind(this),afterClose:this._handleClosed.bind(this),customHeader:o}).addStyleClass("sapMdcValueHelpPopover").addStyleClass("sapMComboBoxBasePicker").addStyleClass("sapMComboBoxBasePicker-CTX");if(o){o.setPopup(t)}t.isPopupAdaptationAllowed=function(){return false};t.addStyleClass(this._isSingleSelect()?"sapMdcValueHelpSingleSelect":"sapMdcValueHelpMultiSelect");t.addDelegate({onsapshow:this._handleRequestSwitchToDialog.bind(this)});t._getAllContent=function(){var t=this.getParent();var e=[];if(t){if(this._oCurrentContent){e.push(this._oCurrentContent)}}return e}.bind(this);var l=this._getContent();var u=this._getContainerConfig(l);if(u){t.setShowArrow(!!u.showArrow);t.setShowHeader(!!u.showHeader);t.setResizable(!!u.resizable);if(u.getContentWidth){t.setContentWidth(u.getContentWidth())}}this.setAggregation("_container",t,true);return t}.bind(this))}n(this.getControl(),t.getCustomHeader());return t};var h=function(){var t=this.getAggregation("_container");var e=this._getContent();var o=e&&this._getContainerConfig(e);if(t&&o&&o.getContentHeight){var i=o.getContentHeight();var r=t.$().find(".sapMPopoverCont").height();var a=r<n.toPx("30rem");t.setContentHeight(!i||a||r>=i?"auto":"30rem");t.invalidate()}};u.prototype.providesScrolling=function(){return true};u.prototype._observeChanges=function(e){if(e.name==="content"){var n=e.child;if(e.mutation==="remove"){n.detachEvent("contentUpdated",h,this);n.detachNavigated(this._handleNavigated,this)}else{n.attachEvent("contentUpdated",h,this)}}t.prototype._observeChanges.apply(this,arguments)};u.prototype._placeContent=function(t){var e=this._getContent();var n=e&&e.getContent();var o=this._getContainerConfig(e);var i=o&&o.getFooter&&o.getFooter();return Promise.all([n,i]).then(function(e){this._oCurrentContent=e[0];var n=e[1];if(n&&t.getFooter()!=n&&n.isA&&n.isA("sap.m.Toolbar")){t.setFooter(n);return t}if(n){if(!t.getFooter()){var o=[new s(this.getId()+"-Spacer")].concat(n);var i=new a(this.getId()+"-TB",{content:o}).setModel(this._oManagedObjectModel,"$help");t.setFooter(i)}else{}}else if(t.getFooter()){t.setFooter()}return t}.bind(this))};u.prototype._open=function(e){if(e.isOpen()){return}t.prototype._open.apply(this,arguments);var n=this._getContent();Promise.resolve(n&&n.onBeforeShow(true)).then(function(){var t=this.getControl();var n=t&&t.getFocusElementForValueHelp?t.getFocusElementForValueHelp(this.isTypeahead()):t;if(n&&n.getDomRef()){e.setContentMinWidth(jQuery(n.getDomRef()).outerWidth()+"px");if(!this.isFocusInHelp()){e.setInitialFocus(n)}e.openBy(n)}}.bind(this))};u.prototype._close=function(){t.prototype._close.apply(this,arguments);var e=this.getAggregation("_container");if(e){e.close()}};u.prototype._handleOpened=function(){h.call(this);t.prototype._handleOpened.apply(this,arguments);var e=this._getContent();if(e){e.onContainerOpen();e.onShow(true)}};u.prototype._handleConfirmed=function(t){this.fireConfirm({close:t.getParameter("close")||this._isSingleSelect()})};u.prototype._handleClosed=function(e){var n=this._getContent();if(n){n.onHide();n.onContainerClose()}var o=this.getAggregation("_container");if(o){o._oPreviousFocus=null}t.prototype._handleClosed.apply(this,arguments)};u.prototype.removeFocus=function(){var t=this._getContent();if(t){t.removeFocus()}};u.prototype._navigate=function(t){var e=this._getContent();if(e){e.navigate(t)}};u.prototype.getItemForValue=function(t){var e=this._getContent();if(e){return e.getItemForValue(t)}};u.prototype.isValidationSupported=function(t){var e=this._getContent();if(e){return e.isValidationSupported()}};u.prototype.getUseAsValueHelp=function(){var t=this._getContent();return t&&t.getUseAsValueHelp&&t.getUseAsValueHelp()};u.prototype.getValueHelpIcon=function(){var t=this._getContent();return t&&t.getValueHelpIcon()};u.prototype.getAriaAttributes=function(e){var n=this._getContent();var o=n&&n.getAriaAttributes(e);if(o){return{contentId:o.contentId,ariaHasPopup:o.ariaHasPopup,role:this.isDialog()?"combobox":null,roleDescription:o.roleDescription}}return t.prototype.getAriaAttributes.apply(this,arguments)};u.prototype.shouldOpenOnClick=function(){var t=this._getContent();return!!t&&t.shouldOpenOnClick()};u.prototype.shouldOpenOnNavigate=function(){var t=this._getContent();this._bindContent(t);return!!t&&t.shouldOpenOnNavigate()};u.prototype.isNavigationEnabled=function(t){if(this.isOpen()||this.getUseAsValueHelp()){var e=this._getContent();return!!e&&e.isNavigationEnabled(t)}return false};u.prototype.isFocusInHelp=function(){var t=this._getContent();return!!t&&t.isFocusInHelp()};u.prototype.isMultiSelect=function(){var t=this._getContent();return!!t&&t.isMultiSelect()};u.prototype.isTypeaheadSupported=function(){var t=this._getContent();return t&&t.isSearchSupported()};u.prototype.exit=function(){if(this._oCurrentContent){if(!this._oCurrentContent.bIsDestroyed){this._oCurrentContent.destroy()}this._oCurrentContent=null}t.prototype.exit.apply(this,arguments)};return u});
//# sourceMappingURL=Popover.js.map