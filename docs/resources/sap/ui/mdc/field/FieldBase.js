/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/mdc/enum/EditMode","sap/ui/mdc/enum/FieldDisplay","sap/ui/mdc/enum/ConditionValidated","sap/ui/mdc/field/FieldBaseRenderer","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/condition/Condition","sap/ui/mdc/field/ConditionType","sap/ui/mdc/field/ConditionsType","sap/ui/mdc/enum/BaseType","sap/ui/mdc/field/content/ContentFactory","sap/ui/mdc/Control","sap/ui/mdc/util/loadModules","sap/ui/core/library","sap/ui/core/LabelEnablement","sap/ui/core/message/MessageMixin","sap/base/util/deepEqual","sap/base/util/merge","sap/base/Log","sap/ui/dom/containsOrEquals","sap/ui/model/BindingMode","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/ui/model/base/ManagedObjectModel","sap/ui/base/ManagedObjectObserver","sap/ui/base/SyncPromise","sap/base/util/restricted/_debounce","sap/ui/events/KeyCodes"],function(e,t,i,a,n,s,o,r,l,h,g,d,u,p,c,f,y,v,C,_,m,b,F,D,P,T,E,V,M){"use strict";var I=p.ValueState;var O=p.TextAlign;var A=p.TextDirection;var H=d.extend("sap.ui.mdc.field.FieldBase",{metadata:{interfaces:["sap.ui.core.IFormContent","sap.ui.core.ISemanticFormContent"],designtime:"sap/ui/mdc/designtime/field/FieldBase.designtime",library:"sap.ui.mdc",properties:{dataType:{type:"string",group:"Data",defaultValue:"sap.ui.model.type.String"},dataTypeConstraints:{type:"object",group:"Data",defaultValue:null},dataTypeFormatOptions:{type:"object",group:"Data",defaultValue:null},editMode:{type:"sap.ui.mdc.enum.EditMode",group:"Data",defaultValue:t.Editable},required:{type:"boolean",group:"Data",defaultValue:false},display:{type:"sap.ui.mdc.enum.FieldDisplay",defaultValue:i.Value},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:O.Initial},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:A.Inherit},placeholder:{type:"string",group:"Misc",defaultValue:""},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:I.None},valueStateText:{type:"string",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},multipleLines:{type:"boolean",group:"Appearance",defaultValue:false},maxConditions:{type:"int",group:"Behavior",defaultValue:-1},conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},label:{type:"string",group:"Misc",defaultValue:""},delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/field/FieldBaseDelegate",payload:{}}},showEmptyIndicator:{type:"boolean",group:"Appearance",defaultValue:false},_fieldHelpEnabled:{type:"boolean",group:"Appearance",defaultValue:false,visibility:"hidden"},_ariaAttributes:{type:"object",defaultValue:{},byValue:true,visibility:"hidden"}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false},contentEdit:{type:"sap.ui.core.Control",multiple:false},contentDisplay:{type:"sap.ui.core.Control",multiple:false},_content:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden"},fieldInfo:{type:"sap.ui.mdc.field.FieldInfoBase",multiple:false}},associations:{fieldHelp:{type:"sap.ui.mdc.ValueHelp",multiple:false},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{liveChange:{parameters:{value:{type:"string"},escPressed:{type:"boolean"},previousValue:{type:"string"}}},press:{},submit:{parameters:{promise:{type:"Promise"}}}},publicMethods:[],defaultAggregation:"content"},renderer:n,_oManagedObjectModel:null});f.call(H.prototype);var B={onsapup:te,onsapdown:te,onsaphome:te,onsapend:te,onsappageup:te,onsappagedown:te,onsapbackspace:te};var x={onsapenter:L};var w;H._init=function(){if(w&&w.bool&&w.bool.control){w.bool.control.destroy()}if(w&&w.defineConditions&&w.defineConditions.control){w.defineConditions.control.destroy()}w={bool:{modules:["sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Popover","sap/ui/mdc/valuehelp/content/Bool"],id:"BoolDefaultHelp",getDelegate:"getDefaultValueHelpDelegate",contentProperties:{},dialog:false,control:undefined,updateTitle:function(e,t){}},defineConditions:{modules:["sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Dialog","sap/ui/mdc/valuehelp/content/Conditions"],id:"Field-DefineConditions-Help",getDelegate:"getDefaultValueHelpDelegate",contentProperties:{},dialog:true,control:undefined,updateTitle:function(e,t){e.getDialog().setTitle(t);e.getDialog().getContent()[0].setLabel(t)}}}};H._init();H.prototype.init=function(){d.prototype.init.apply(this,arguments);this._oObserver=new T(this._observeChanges.bind(this));this._oObserver.observe(this,{properties:["display","editMode","dataType","dataTypeFormatOptions","dataTypeConstraints","multipleLines","maxConditions","conditions","delegate"],aggregations:["fieldInfo","content","contentEdit","contentDisplay"],associations:["fieldHelp","ariaLabelledBy"]});this.attachEvent("modelContextChange",this._handleModelContextChange,this);this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this._aAsyncChanges=[];this._bPreventGetDescription=false;this._oContentFactory=this._getContentFactory();this._oCreateContentPromise=undefined;this._sFilterValue=""};H.prototype._getContentFactory=function(){if(this._bIsBeingDestroyed||this.bIsDestroyed){return}if(!this._oContentFactory){this._oContentFactory=new g(this.getId()+"-contentFactory",{field:this,handleTokenUpdate:_e.bind(this),handleContentChange:pe.bind(this),handleContentLiveChange:ye.bind(this),handleValueHelpRequest:Pe.bind(this),handleEnter:L.bind(this),handleContentPress:Ce.bind(this)})}return this._oContentFactory};H.prototype.exit=function(){var e=this.getFieldInfo();if(e){e.detachEvent("dataUpdate",we,this)}var t=this.getContent();if(t){J.call(this,t)}var i=this.getContentEdit();if(i){J.call(this,i)}var a=this.getContentDisplay();if(a){J.call(this,a)}if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel}this._oObserver.disconnect();this._oObserver=undefined;this._oCreateContentPromise=undefined;var n=Fe.call(this);if(n){n.detachEvent("dataUpdate",Ie,this);if(this._bConnected){Ae.call(this,n);n.connect()}}if(this._oContentFactory){this._oContentFactory.destroy();this._oContentFactory=undefined}ve.call(this);delete this._fnLiveChangeTimer};H.prototype.applySettings=function(){d.prototype.applySettings.apply(this,arguments);if(!this.bDelegateInitialized&&!this.bDelegateLoading){this.initControlDelegate()}this._triggerCheckCreateInternalContent();this._bSettingsApplied=true;return this};H.prototype.setProperty=function(e,i,a){if(e==="editMode"){var n=this.getEditMode();if(n!==t.Display&&n!==t.EditableDisplay&&i!==t.Display&&i!==t.EditableDisplay){a=true}}else if(e!=="width"&&e!=="multipleLines"&&e!=="showEmptyIndicator"){a=true}return d.prototype.setProperty.apply(this,[e,i,a])};H.prototype.onBeforeRendering=function(){K.call(this)};H.prototype.onAfterRendering=function(){};H.prototype.onfocusin=function(e){He.call(this)};H.prototype.onsapfocusleave=function(e){ve.call(this)};function S(e){var t=e.indexOf(this.getId());if(t>-1){if(this._bPendingChange){var i=document.activeElement;var a=Fe.call(this);if(!(i&&a&&_(a.getDomRef(),i))){var n=Ne.call(this);if(n){U.call(this,undefined,undefined,undefined,n)}else{U.call(this,this.getConditions(),!this._bParseError)}}}if(e.length>1){e.splice(t,1);this.fireValidateFieldGroup({fieldGroupIds:e})}}}H.prototype.onsapup=function(e){this._handleNavigate(e,-1)};H.prototype.onsapdown=function(e){this._handleNavigate(e,1)};H.prototype.onsaphome=function(e){this._handleNavigate(e,-9999)};H.prototype.onsappageup=function(e){this._handleNavigate(e,-10)};H.prototype.onsappagedown=function(e){this._handleNavigate(e,10)};H.prototype.onsapend=function(e){this._handleNavigate(e,9999)};H.prototype._handleNavigate=function(e,i){if(this.getEditMode()===t.Editable){var a=Fe.call(this);var n=e.srcControl;if(a){if(a.isNavigationEnabled(i)&&(!this._getContentFactory().isMeasure()||n.getShowValueHelp())){e.preventDefault();e.stopPropagation();a.setFilterValue(this._sFilterValue);a.navigate(i)}}}};H.prototype.onsapenter=function(e){var t=Fe.call(this);if(t&&t.isOpen(true)){t.close()}this._sFilterValue=""};H.prototype.onsapescape=function(e){this.onsapenter(e)};H.prototype.ontap=function(e){var t=Fe.call(this);if(t){if(t.shouldOpenOnClick()&&!t.isOpen(true)){t.open(true)}var i=e.srcControl;if(t.isOpen(true)&&(!this._getContentFactory().isMeasure()||i.getShowValueHelp&&i.getShowValueHelp())){i.addStyleClass("sapMFocus");t.removeFocus()}}};H.prototype.clone=function(e,t){this.detachEvent("modelContextChange",this._handleModelContextChange,this);var i=this.getContent();if(i){J.call(this,i)}var a=this.getContentEdit();if(a){J.call(this,a)}var n=this.getContentDisplay();if(n){J.call(this,n)}var s=this.getFieldInfo();if(s){s.detachEvent("dataUpdate",we,this)}var o=d.prototype.clone.apply(this,arguments);this.attachEvent("modelContextChange",this._handleModelContextChange,this);if(i){Y.call(this,i)}if(a){Y.call(this,a)}if(n){Y.call(this,n)}if(s){s.attachEvent("dataUpdate",we,this)}if(this._bTriggerable){o._bTriggerable=this._bTriggerable}return o};H.prototype.getFieldPath=function(){var e=this.getBindingPath("conditions");if(e&&e.startsWith("/conditions/")){return e.slice(12)}else{return""}};function N(e,t,i,a){if(this._getContent().length>1){this._bPendingChange=true}else{U.call(this,e,t,i,a)}}function U(e,t,i,a){if(!a){if(t){a=Promise.resolve(this._getResultForPromise(e))}else{a=Promise.reject(i)}}this._fireChange(e,t,i,a);this._bPendingChange=false}H.prototype._fireChange=function(e,t,i,a){};function L(e){var t=this.getEditMode();if(g._getEditable(t)&&(this.hasListeners("submit")||this._bPendingChange)){var i=Ne.call(this);var a=false;if(i){a=true}else if(this._bParseError){i=Promise.reject()}else{i=Promise.resolve(this._getResultForPromise(this.getConditions()))}if(this._bPendingChange){if(a){U.call(this,undefined,undefined,undefined,i)}else{U.call(this,this.getConditions(),!this._bParseError,undefined,i)}}this.fireSubmit({promise:i})}}H.prototype._initDataType=function(){if(this._getContentFactory().getDataType()){this._getContentFactory().getDataType().destroy();this._getContentFactory().setDataType(undefined)}if(this._getContentFactory().getDateOriginalType()){if(this._getContentFactory().getDateOriginalType()._bCreatedByField){this._getContentFactory().getDateOriginalType().destroy()}this._getContentFactory().setDateOriginalType(undefined)}if(this._getContentFactory().getUnitOriginalType()){if(this._getContentFactory().getUnitOriginalType()._bCreatedByField){this._getContentFactory().getUnitOriginalType().destroy()}this._getContentFactory().getUnitOriginalType(undefined)}};function k(){if(this._getContentFactory().getDataType()&&typeof this._getContentFactory().getDataType()==="object"){return this._getContentFactory().getDataType().getMetadata().getName()}else if(this.bDelegateInitialized){return this.getControlDelegate().getDataTypeClass(this.getPayload(),this.getDataType())}else{return this.getDataType()}}function R(){var e=this._getContentFactory().getDataType();if(e&&typeof e==="object"&&e.getConstraints()){return e.getConstraints()}else{return this.getDataTypeConstraints()}}function G(){var e=this._getContentFactory().getDataType();if(e&&typeof e==="object"&&e.getFormatOptions()){return e.getFormatOptions()}else{return this.getDataTypeFormatOptions()}}H.prototype.getBaseType=function(){var e=k.call(this);var t=R.call(this);var i=G.call(this);var a=this.getTypeUtil().getBaseType(e,i,t);return a};function j(e,t){var i=Fe.call(this);if(i&&this._bConnected){De.call(this,e,i)}}H.prototype._getContent=function(){var e=this.getContent();if(!e){if(this.getEditMode()===t.Display){e=this.getContentDisplay()}else{e=this.getContentEdit()}}if(e){return[e]}else{return this.getAggregation("_content",[])}};H.prototype._handleModelContextChange=function(e){};function $(e){this.setValueState(I.Error);this.setValueStateText(e)}H.prototype._removeUIMessage=function(){this.setValueState(I.None);this.setValueStateText()};H.prototype._observeChanges=function(e){if(e.name==="dataType"){if(this._getContentFactory().getDataType()){var i=function(t){var i=this.getTypeUtil().getDataTypeClass(e.current);if(!(this._getContentFactory().getDataType()instanceof i)){this._initDataType();this.destroyAggregation("_content");this._getContentFactory().updateConditionType()}}.bind(this);if(!this.bDelegateInitialized){this.awaitControlDelegate().then(function(){i.call(this,e.current)}.bind(this));return}i.call(this,e.current)}}if(e.name==="dataTypeFormatOptions"||e.name==="dataTypeConstraints"){if(this._getContentFactory().getDataType()){this._initDataType();this.destroyAggregation("_content");this._getContentFactory().updateConditionType()}}if(e.name==="maxConditions"){this._updateInternalContent()}if(e.name==="conditions"){this._bParseError=false;j.call(this,e.current,e.old);var a=false;var n=0;for(n=0;n<this._aAsyncChanges.length;n++){var s=this._aAsyncChanges[n];if(s.waitForUpdate&&y(s.result,e.current)){ce.call(this,s);a=true;break}}if(a){this._aAsyncChanges.splice(n,1)}if((e.current.length===0||e.old.length===0)&&this.getShowEmptyIndicator()&&this.getEditMode()===t.Display&&!this.getContent()&&!this.getContentDisplay()){this.invalidate()}}if(e.name==="display"){this._destroyInternalContent();this._getContentFactory().updateConditionType()}if(e.name==="fieldHelp"&&e.ids){me.call(this,e.ids,e.mutation);this._getContentFactory().updateConditionType()}if(e.name==="fieldInfo"&&e.child){xe.call(this,e.child,e.mutation)}if(e.name==="content"&&e.child){W.call(this,e.child,e.mutation,e.name)}if(e.name==="contentEdit"&&e.child){W.call(this,e.child,e.mutation,e.name)}if(e.name==="contentDisplay"&&e.child){W.call(this,e.child,e.mutation,e.name)}if(e.name==="delegate"&&!this.bDelegateInitialized&&!this.bDelegateLoading){this.initControlDelegate.call(this)}if(e.name==="ariaLabelledBy"&&e.ids){q.call(this,e.ids,e.mutation)}if(e.name==="editMode"){Q.call(this);if(this._bSettingsApplied&&(e.old===t.Display||e.old===t.EditableDisplay||e.current===t.Display||e.current===t.EditableDisplay)){this._triggerCheckCreateInternalContent()}}};H.prototype._updateInternalContent=function(){if(this.getAggregation("_content",[]).length>0){K.call(this);this._getContentFactory().updateConditionType()}};H.prototype.getFocusDomRef=function(){var e=this._getContent();if(e.length>0){return e[0].getFocusDomRef()}else{return this.getDomRef()}};H.prototype.getIdForLabel=function(){var e;var t=this._getContent();if(t.length>0){e=t[0].getIdForLabel()}else{e=Z.call(this)}return e};H.prototype.getEditable=function(){return g._getEditable(this.getEditMode())};H.prototype.getControlForSuggestion=function(){var e=this._getContent();if(e.length>0){if(this._getContentFactory().isMeasure()){return e[1]}else{return e[0]}}else{return this}};H.prototype.getFocusElementForValueHelp=function(e){var t=this.getControlForSuggestion();var i=t&&t.getMetadata().getAllPrivateAggregations()._endIcon&&t.getAggregation("_endIcon",[]);var a;if(i){for(var n=0;n<i.length;n++){if(i[n].getVisible()){a=i[n];break}}}return e||!a?t:a};H.prototype.getMaxConditionsForHelp=function(){if(this._getContentFactory().isMeasure()){return 1}else{return this.getMaxConditions()}};H.prototype.getFormFormattedValue=function(){var e=this.getConditions();var t=this.getShowEmptyIndicator()&&e.length===0&&!this.getContent()&&!this.getContentDisplay();if(t){if(!this._oResourceBundleM){this._oResourceBundleM=sap.ui.getCore().getLibraryResourceBundle("sap.m")}return this._oResourceBundleM.getText("EMPTY_INDICATOR")}else if(this._getContentFactory().isMeasure()&&this._getContentFactory().getUnitOriginalType()){var i=e.length>0?e[0].values[0]:[0,null];return this._getContentFactory().getUnitOriginalType().formatValue(i,"string")}else if(this._getContentFactory().getDateOriginalType()){var a=e.length>0?e[0].values[0]:null;return this._getContentFactory().getDateOriginalType().formatValue(a,"string")}else{var n=this._getContentFactory().getConditionsType();return n.formatValue(e)}};H.prototype.getFormValueProperty=function(){return"conditions"};H.prototype.enhanceAccessibilityState=function(e,t){var i=this.getParent();if(i&&i.enhanceAccessibilityState){i.enhanceAccessibilityState(this,t)}};H.prototype.getAccessibilityInfo=function(){var e=this._getContent();if(e.length>0&&e[0].getAccessibilityInfo){return e[0].getAccessibilityInfo()}else{return{}}};function q(e,t){var i=this.getAggregation("_content",[]);var a=this.getContent();if(a){i.push(a)}a=this.getContentDisplay();if(a){i.push(a)}a=this.getContentEdit();if(a){i.push(a)}for(var n=0;n<i.length;n++){a=i[n];if(a.getMetadata().getAllAssociations().ariaLabelledBy){if(t==="remove"){a.removeAriaLabelledBy(e)}else if(t==="insert"){a.addAriaLabelledBy(e)}}}}function z(e,t){var i={aria:{}};var a=Fe.call(this);if(a){var n=a.getAriaAttributes(this.getMaxConditionsForHelp());var s=n.roleDescription;i["role"]=n.role;if(s){i.aria["roledescription"]=s}i.aria["haspopup"]=n.ariaHasPopup;i["autocomplete"]="off";if(e){i.aria["expanded"]="true";i.aria["controls"]=n.contentId;if(t){i.aria["activedescendant"]=t}}else{i.aria["expanded"]="false"}i["valueHelpEnabled"]=n.valueHelpEnabled}this.setProperty("_ariaAttributes",i,true)}H.prototype.connectLabel=function(e){ee.call(this,e);e.bindProperty("text",{path:"$field>/label"});e.setLabelFor(this);return this};function Q(){var e=c.getReferencingLabels(this);for(var t=0;t<e.length;t++){var i=sap.ui.getCore().byId(e[t]);i.invalidate()}}function W(e,t,i){if(t==="remove"){J.call(this,e);ae.call(this,e);se.call(this,e);if(this._getContentFactory().getContentConditionTypes()){delete this._getContentFactory().getContentConditionTypes()[i]}e.setModel(null,"$field")}else if(t==="insert"){if(!e.isA("sap.ui.core.IFormContent")){throw new Error(e+" is not a valid content! Only use valid content in "+this)}ie.call(this,e,true);Y.call(this,e);ne.call(this,e,true);if(this.getAggregation("_content",[]).length>0){this._destroyInternalContent()}if(!this._getContentFactory().getContentConditionTypes()){this._getContentFactory().setContentConditionTypes({})}if(!this._getContentFactory().getContentConditionTypes()[i]){this._getContentFactory().getContentConditionTypes()[i]={}}this.awaitControlDelegate().then(function(){if(!this.bIsDestroyed){this._oContentFactory.setHideOperator(he.call(this,this._getOperators()));this._oContentFactory.updateConditionType()}}.bind(this));var a;var n;for(n in e.getMetadata().getAllProperties()){if(e.getBindingPath(n)==="/conditions"){a=e.getBindingInfo(n);if(a&&a.type&&a.type instanceof l){this._getContentFactory().getContentConditionTypes()[i].oConditionsType=a.type}this._getContentFactory().setBoundProperty(n)}if(n==="editable"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/editMode",formatter:g._getEditable})}if(n==="enabled"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/editMode",formatter:g._getEnabled})}if(n==="displayOnly"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/editMode",formatter:g._getDisplayOnly})}if(n==="required"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/required"})}if(n==="textAlign"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/textAlign"})}if(n==="textDirection"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/textDirection"})}if(n==="valueState"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/valueState"})}if(n==="valueStateText"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/valueStateText"})}if(n==="placeholder"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/placeholder"})}if(n==="showValueHelp"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.bindProperty(n,{path:"$field>/_fieldHelpEnabled"})}if(n==="valueHelpIconSrc"&&!e.getBindingPath(n)&&e.isPropertyInitial(n)){e.setValueHelpIconSrc(this._getFieldHelpIcon())}}for(var s in e.getMetadata().getAllAggregations()){if(e.getBindingPath(s)==="/conditions"){a=e.getBindingInfo(s);if(a&&a.template){for(n in a.template.getMetadata().getAllProperties()){var o=a.template.getBindingInfo(n);if(o&&o.type&&o.type instanceof r){this._getContentFactory().getContentConditionTypes()[i].oConditionType=o.type;break}}}}if(s==="tooltip"&&!e.getBindingPath(s)&&!e.getAggregation(s)){e.bindProperty(s,{path:"$field>/tooltip"})}}if(e.getMetadata().getAllAssociations().ariaLabelledBy){this._getContentFactory().setAriaLabelledBy(e)}}}function Y(e){if(e.getMetadata().getEvents().change){e.attachEvent("change",pe,this)}if(e.getMetadata().getEvents().liveChange){e.attachEvent("liveChange",ye,this)}if(e.getMetadata().getEvents().press){e.attachEvent("press",Ce,this)}if(e.getMetadata().getEvents().valueHelpRequest){e.attachEvent("valueHelpRequest",Pe,this)}if(e.getMetadata().getEvents().tokenUpdate){e.attachEvent("tokenUpdate",_e,this)}}function J(e){if(e.getMetadata().getEvents().change){e.detachEvent("change",pe,this)}if(e.getMetadata().getEvents().liveChange){e.detachEvent("liveChange",ye,this)}if(e.getMetadata().getEvents().press){e.detachEvent("press",Ce,this)}if(e.getMetadata().getEvents().valueHelpRequest){e.detachEvent("valueHelpRequest",Pe,this)}if(e.getMetadata().getEvents().tokenUpdate){e.detachEvent("tokenUpdate",_e,this)}}function K(){var e=function(){if(!this.bDelegateInitialized){this.awaitControlDelegate().then(function(){K.call(this)}.bind(this))}else{X.call(this)}};if(this._oCreateContentPromise){this._oCreateContentPromise.then(function(){K.call(this)}.bind(this))}else{e.call(this)}}H.prototype._checkCreateInternalContent=function(){if(!this.bIsDestroyed&&this.getVisible()&&this._getContentFactory().getDataType()){K.call(this)}};H.prototype._triggerCheckCreateInternalContent=function(){if(!this._oCheckCreateInternalContentPromise){this._oCheckCreateInternalContentPromise=this.awaitControlDelegate().then(function(){delete this._oCheckCreateInternalContentPromise;this._checkCreateInternalContent()}.bind(this))}};function X(){if(this._bIsBeingDestroyed||this.bIsDestroyed){return}var e=this.getEditMode();var i=this.getContent();this._getContentFactory()._setUsedConditionType(i,e);be.call(this,this.getFieldHelp());z.call(this,false);if(i||e===t.Display&&this.getContentDisplay()||e!==t.Display&&this.getContentEdit()){this._destroyInternalContent();var a=this._getContent();if(a.length===1){ee.call(this,a[0])}return}var n=this.getMaxConditions();var s=this._getOperators();var o;var r=this.getAggregation("_content",[]);var l;var h;var g=this.getMultipleLines();var d=this._bTriggerable;var u=this._getContentFactory().getContentType(this.getBaseType(),this.getMaxConditions(),d);if(r.length>0){l=r[0];h=l.getMetadata().getName().replace(/\./g,"/")}var p=this._getContentFactory().getContentMode(u,e,n,g,s);var c=u.getControlNames(p,s[0]);o=c[0];if(o!==h){this._getContentFactory().setHideOperator(he.call(this,s));if(l){this._destroyInternalContent();if(l.isA("sap.m.DateTimeField")){this._initDataType()}this._getContentFactory().updateConditionType()}if(le.call(this,u,s,e,n)){oe.call(this,u.getUseDefaultFieldHelp().name)}else if(this._sDefaultFieldHelp){delete this._sDefaultFieldHelp}var f=Z.call(this);this._oCreateContentPromise=this._getContentFactory().createContent(u,p,f);this._oCreateContentPromise.then(function(e){for(var t=0;t<e.length;t++){var i=e[t];i.attachEvent("parseError",ge,this);i.attachEvent("validationError",de,this);i.attachEvent("validationSuccess",ue,this);ie.call(this,i,u.getUseDefaultEnterHandler());ne.call(this,i,false);ee.call(this,i);if(this._bConnected&&(t===0&&!this._getContentFactory().isMeasure()||t===1&&this._getContentFactory().isMeasure())){Be.call(this,i)}this.addAggregation("_content",i)}Q.call(this);delete this._oCreateContentPromise}.bind(this))}}function Z(){return this.getId()+"-inner"}H.prototype._destroyInternalContent=function(){this.destroyAggregation("_content");if(this._getContentFactory().getDateOriginalType()){this._getContentFactory().setDataType(this._getContentFactory().getDateOriginalType());this._getContentFactory().setDateOriginalType(undefined)}else if(this._getContentFactory().getUnitOriginalType()){this._getContentFactory().setDataType(this._getContentFactory().getUnitOriginalType());this._getContentFactory().setUnitOriginalType(undefined)}if(this._bParseError){this._bParseError=false;this._removeUIMessage()}if(this._getContentFactory().isMeasure()){this._getContentFactory().setIsMeasure(false)}};function ee(e){if(!this._oManagedObjectModel&&!this._bIsBeingDestroyed){this._oManagedObjectModel=new P(this)}e.setModel(this._oManagedObjectModel,"$field")}function te(e){var t=false;var i=Fe.call(this);if(!i){return}else{switch(e.type){case"sapup":t=i.isNavigationEnabled(-1);break;case"sapdown":t=i.isNavigationEnabled(1);break;case"saphome":t=i.isNavigationEnabled(-9999);break;case"sapend":t=i.isNavigationEnabled(9999);break;case"sappageup":t=i.isNavigationEnabled(-10);break;case"sappagedown":t=i.isNavigationEnabled(10);break;default:t=i.isOpen();break}}if(t){e.stopPropagation();e.stopImmediatePropagation(true);switch(e.type){case"sapup":this.onsapup(e);break;case"sapdown":this.onsapdown(e);break;case"saphome":this.onsaphome(e);break;case"sapend":this.onsapend(e);break;case"sappageup":this.onsappageup(e);break;case"sappagedown":this.onsappagedown(e);break;default:break}}}function ie(e,t){e.addDelegate(B,true,this);if(t){e.addDelegate(x,false,this)}}function ae(e){e.removeDelegate(B);e.removeDelegate(x)}function ne(e,t){if(t){e._OriginalGetFieldGroupIds=e._getFieldGroupIds;e._OriginalTriggerValidateFieldGroup=e.triggerValidateFieldGroup}e._getFieldGroupIds=function(){var e=this.getFieldGroupIds();var t=this.getParent();if(t){e=e.concat(t._getFieldGroupIds())}return e};e.triggerValidateFieldGroup=function(e){var t=this.getParent();if(t){var i=e.indexOf(t.getId());if(i>-1){S.call(t,e)}else{t.fireValidateFieldGroup({fieldGroupIds:e})}}}}function se(e){if(e._OriginalGetFieldGroupIds&&e._OriginalTriggerValidateFieldGroup){e._getFieldGroupIds=e._OriginalGetFieldGroupIds;delete e._OriginalGetFieldGroupIds;e.triggerValidateFieldGroup=e._OriginalTriggerValidateFieldGroup;delete e._OriginalTriggerValidateFieldGroup}}function oe(e){this._sDefaultFieldHelp=w[e].id;var t=w[e].control;if(t&&t.bIsDestroyed){w[e].control=undefined;t=undefined}if(!t){if(w[e].promise){w[e].promise.then(re.bind(this,w[e].id))}else{w[e].promise=u(w[e].modules).catch(function(t){throw new Error("loadModules promise rejected in sap.ui.mdc.field.FieldBase:_createDefaultFieldHelp function call - could not load controls "+JSON.stringify(w[e].modules))}).then(function(i){var a=i[0];var n=i[1];var s=i[2];var o=this.bDelegateInitialized&&this.getControlDelegate()[w[e].getDelegate]();t=new a(w[e].id,{delegate:o});var r=new n(w[e].id+"-container",{content:[new s(w[e].id+"-content",w[e].contentProperties)]});t._bIsDefaultHelp=true;t._sDefaultHelpType=e;w[e].control=t;if(w[e].dialog){t.setDialog(r)}else{t.setTypeahead(r)}t.connect(this);re.call(this,w[e].id)}.bind(this)).unwrap()}}else{re.call(this,w[e].id)}z.call(this,false)}function re(e){me.call(this,e,"insert")}function le(e,i,a,n){var s=e.getUseDefaultFieldHelp();if(s&&!this.getFieldHelp()&&a!==t.Display){if(n===1&&s.single||n!==1&&s.multi){if(i.length===1){var o=he.call(this,i);if(n===1){if(!(e.getEditOperator()&&e.getEditOperator()[i[0]])&&(s.oneOperatorSingle||!o)){return true}}else if(s.oneOperatorMulti||!o){return true}}else{return true}}}return false}function he(e){if(e.length===1){var t=s.getOperator(e[0]);return!t||t.isSingleValue()}else{return false}}function ge(e){this._bParseError=true;this._sFilterValue=""}function de(e){this._bParseError=true;this._sFilterValue="";var t=e.getParameter("newValue");var i=false;var a=0;var n=this._oContentFactory.isMeasure();var s=0;if(n){var o=e.getParameter("element");var r=this._getContent();for(a=0;a<r.length;a++){if(o===r[a]){s=a}}}for(a=0;a<this._aAsyncChanges.length;a++){var l=this._aAsyncChanges[a];if(l.waitForUpdate&&Array.isArray(l.result)){if(l.result.length===0&&t===""){l.reject(e.getParameter("exception"));i=true}else{for(var h=0;h<l.result.length;h++){var g=l.result[h];var d=g.values[0];var u=g.operator==="BT"&&g.values[1];if(n){d=d[s];u=g.operator==="BT"&&u[s]}if(y(d,t)||g.operator==="BT"&&y(u,t)){l.reject(e.getParameter("exception"));i=true;break}}}if(i){break}}}if(i){this._aAsyncChanges.splice(a,1)}}function ue(e){this._bParseError=false}function pe(e){var t={parameters:v({},e.getParameters()),source:e.getSource()};var i=this._aAsyncChanges.length;if(i>0&&!this._aAsyncChanges[i-1].changeFired){this._aAsyncChanges[i-1].changeFired=true;this._aAsyncChanges[i-1].changeEvent=t;N.call(this,undefined,undefined,undefined,this._aAsyncChanges[i-1].promise);return}var a={changeEvent:t};ce.call(this,a)}function ce(e){var t=this.getConditions();var i;var a=true;var n;var s;var o=e.changeEvent.source;var r=false;var l=true;var h=false;if(e.changeEvent.parameters.hasOwnProperty("valid")){a=e.changeEvent.parameters["valid"];if(!a&&e.changeEvent.parameters.hasOwnProperty("value")){n=e.changeEvent.parameters["value"]}}var g=false;var d=this._getContentFactory().getBoundProperty();var u=d&&o.getBinding(d);if(u&&u.getBindingMode()!==m.OneWay&&u.getPath()==="/conditions"&&a){s=t[0];i=t[0]&&t[0].values[0]}else if(e.changeEvent.parameters.hasOwnProperty("value")){i=e.changeEvent.parameters["value"];if(a){g=true}}else{s=t[0];i=t[0]&&t[0].values[0]}if(g){this._removeUIMessage();var p;var c;if(this._bIgnoreInputValue){this._bIgnoreInputValue=false;o.setDOMValue("");if(o.getMetadata().hasProperty("value")){o.setValue()}return}s=E.resolve().then(function(){var t=this.getMaxConditions();if(this._oNavigateCondition){a=true;return this._oNavigateCondition}else if(i===""&&t!==1){return null}else{p=this._getContentFactory().getConditionType();var n=p.parseValue(i);var s=this._aAsyncChanges.length;if(s>0&&!this._aAsyncChanges[s-1].changeFired){c=this._aAsyncChanges[s-1];c.changeFired=true;c.changeEvent=e.changeEvent;N.call(this,undefined,undefined,undefined,c.promise)}return n}}.bind(this)).then(function(n){l=fe.call(this,n,t,p,a,i,o,c||e);l=l||h;return n}.bind(this)).catch(function(e){if(e&&!(e instanceof F)&&!(e instanceof b)&&!(e instanceof D)){throw e}a=false;n=i;this._bParseError=true;this._sFilterValue="";$.call(this,e.message);if(c&&c.reject){if(Le.call(this,c)){c.reject(e)}}else if(r){N.call(this,t,a,n)}}.bind(this)).unwrap();if(s instanceof Promise){r=true}}else if(!e.changeEvent.parameters.hasOwnProperty("valid")&&this._bParseError){n=e.changeEvent.parameters["value"];a=false}var f=Fe.call(this);if(f&&this._bConnected){if(sap.ui.getCore().getCurrentFocusedControlId()===o.getId()){f.close()}this._sFilterValue="";if(!r&&a){De.call(this,t,f);f.onControlChange()}ve.call(this)}if(this._oNavigateCondition){this._oNavigateCondition=undefined;this._getContentFactory().updateConditionType()}if(e.resolve){Ue.call(this,e)}else if(!r&&l){N.call(this,t,a,n)}}function fe(e,t,i,a,n,o,r){var l=this.getMaxConditions();var h=false;if(e===null&&l!==1){return true}if(i){i.validateValue(e)}if(a){if(e){if(this._getContentFactory().isMeasure()&&t.length===1&&t[0].values[0][0]===undefined){t.length=0}if(l!==1&&s.indexOfCondition(e,t)>=0){throw new F(this._oResourceBundle.getText("field.CONDITION_ALREADY_EXIST",[n]))}else{if(l>0&&l<=t.length){t.splice(0,t.length-l+1)}t.push(e)}}else if(l===1){t.length=0}if(!y(t,this.getConditions())){this.setProperty("conditions",t,true);h=true}if(l!==1){o.setValue("")}}if(r.resolve){var g=Fe.call(this);if(g&&this._bConnected){De.call(this,t,g);g.onControlChange()}r.result=t;Ue.call(this,r);Le.call(this,r)}return h}function ye(e){var t;var i;var a=false;var n=e.getSource();this._oNavigateCondition=undefined;this._getContentFactory().updateConditionType();if("value"in e.getParameters()){t=e.getParameter("value")}else if("newValue"in e.getParameters()){t=e.getParameter("newValue")}if("escPressed"in e.getParameters()){a=e.getParameter("escPressed")}if("previousValue"in e.getParameters()){i=e.getParameter("previousValue")}else{var o=this.getConditions();i=o[0]&&o[0].values[0]}var r=Fe.call(this);if(r&&(!this._getContentFactory().isMeasure()||n.getShowValueHelp())){if(a){if(r.isOpen(true)){r.close();De.call(this,this.getConditions(),r);ve.call(this);this._sFilterValue=""}}else{var l=this._getOperators();var h=false;for(var g=0;g<l.length;g++){var d=s.getOperator(l[g]);if(d.validateInput){h=true;break}}if(h){this._bIgnoreInputValue=false;this._vLiveChangeValue=t;if(!this._fnLiveChangeTimer){this._fnLiveChangeTimer=V(function(){var e=this.getDisplay();if(typeof this._vLiveChangeValue!=="undefined"){this._sFilterValue=""}if(this._vLiveChangeValue){var t=s.getEQOperator();var i=t.getValues(this._vLiveChangeValue,e,true);if(i[0]){this._sFilterValue=i[0];if(i[1]){this._sFilterValue=this._sFilterValue+" "}}if(i[1]){this._sFilterValue=this._sFilterValue+i[1]}}var a=this.hasOwnProperty("_bOpenByTyping")?this._bOpenByTyping:r.isTypeaheadSupported();var n=document.activeElement;if(this._bConnected&&this._getContent()[0]&&a&&n&&_(this.getDomRef(),n)){if(!this._sFilterValue&&r.isOpen()){r.close()}else if(this._sFilterValue){r.setFilterValue(this._sFilterValue);if(this.getMaxConditionsForHelp()===1&&r.getConditions().length>0){r.setConditions([])}r.open(true)}z.call(this,true);delete this._vLiveChangeValue}}.bind(this),300,{leading:false,trailing:true});r.initBeforeOpen(true)}var u=r.isTypeaheadSupported();if(u instanceof Promise){u.then(function(e){var t=document.activeElement;if(t&&_(this.getDomRef(),t)&&this._fnLiveChangeTimer){this._fnLiveChangeTimer()}this._bOpenByTyping=e}.bind(this))}this._fnLiveChangeTimer()}}}this.fireLiveChange({value:t,escPressed:a,previousValue:i})}function ve(){if(this._fnLiveChangeTimer){this._fnLiveChangeTimer.cancel();delete this._vLiveChangeValue}}function Ce(e){var t=this.getFieldInfo();if(t){t.getTriggerHref().then(function(e){if(!e){t.open(this._getContent()[0]);z.call(this,true)}}.bind(this))}this.firePress()}function _e(e){if(e.getParameter("type")==="removed"){var t=e.getParameter("removedTokens");var i=this.getConditions();var a;var n;var s;for(s=0;s<t.length;s++){var r=t[s];var l=r.getBindingContext("$field").sPath;var h=parseInt(l.slice(l.lastIndexOf("/")+1));i[h].delete=true}for(s=i.length-1;s>=0;s--){if(i[s].delete){if(this._getContentFactory().isMeasure()){a=i[s].values[0][1];n=i[s].payload}i.splice(s,1)}}if(this._getContentFactory().isMeasure()&&a&&i.length===0){i=[o.createItemCondition([undefined,a],undefined,undefined,undefined,n)]}this.setProperty("conditions",i,true);U.call(this,i,true);e.preventDefault(true)}}function me(e,t){var i;if(t==="remove"){i=sap.ui.getCore().byId(e);if(i){Ae.call(this,i);i.detachEvent("dataUpdate",Ie,this)}this.resetProperty("_fieldHelpEnabled")}else if(t==="insert"){if(this._sDefaultFieldHelp&&e!==this._sDefaultFieldHelp){me.call(this,this._sDefaultFieldHelp,"remove");delete this._sDefaultFieldHelp}be.call(this,e);var a=this._getContent()[0];if(a&&a.setValueHelpIconSrc){a.setValueHelpIconSrc(this._getFieldHelpIcon())}}j.call(this,this.getConditions())}function be(e){if(e&&this.isPropertyInitial("_fieldHelpEnabled")){var t=sap.ui.getCore().byId(e);if(t){t.attachEvent("dataUpdate",Ie,this);if(t.getIcon()){this.setProperty("_fieldHelpEnabled",true,true)}}}}function Fe(){var e=this.getFieldHelp();var t;if(!e&&this._sDefaultFieldHelp){e=this._sDefaultFieldHelp}if(e){t=sap.ui.getCore().byId(e)}return t}function De(e,t){if(!t){t=Fe.call(this)}if(this._getContentFactory().isMeasure()){var i=[];for(var a=0;a<e.length;a++){var n=e[a];if(n.values[0]&&n.values[0][1]){var s=o.createItemCondition(n.values[0][1],undefined,n.inParameters,n.outParameters,n.payload);i.push(s)}}t.setConditions(i)}else{t.setConditions(e)}}function Pe(e){var t=Fe.call(this);if(t){t.setFilterValue(this._sFilterValue);var i=this.getConditions();De.call(this,i,t);t.toggleOpen(false);z.call(this,true);if(!t.isFocusInHelp()){var a=e.getSource();if(a.bValueHelpRequested){a.bValueHelpRequested=false}}}}function Te(e){var t=this.getConditions();var i=e.getParameter("conditions");var n=e.getParameter("add");var r=e.getParameter("close");var l=e.oSource;var h=this.getMaxConditions();var g;var d=this.getControlForSuggestion();var u;var p=0;if(this._getContentFactory().isMeasure()){if(i.length>1){throw new Error("Only one item must be selected! "+this)}if(i[0].operator!=="EQ"){throw new Error("Only EQ allowed! "+this)}if(t.length>0){for(p=0;p<t.length;p++){t[p].values[0][1]=i[0].values[0];if(t[p].operator==="BT"){t[p].values[1][1]=i[0].values[0]}if(i[0].inParameters){t[p].inParameters=i[0].inParameters}if(i[0].outParameters){t[p].outParameters=i[0].outParameters}if(i[0].payload){t[p].payload=i[0].payload}}}else{var c=s.getEQOperator(this._getOperators());var f=this.getControlDelegate().enhanceValueForUnit(this.getPayload(),[null,i[0].values[0]],this._oTypeInitialization);g=o.createCondition(c.name,[f],i[0].inParameters,i[0].outParameters,a.NotValidated,i[0].payload);t.push(g);var v=this._getContentFactory().getConditionType(true);var C=this._getContentFactory().getUnitConditionsType(true);if(v){u=v.formatValue(g)}else if(C){u=C.formatValue(t)}}}else{if(!n){t=[]}for(p=0;p<i.length;p++){g=i[p];if(!ke.call(this,g.operator)){continue}var _=s.indexOfCondition(g,t);if(_===-1){t.push(g)}else if(g.validated===a.Validated&&g.values.length>1&&(t[_].values.length===1||g.values[1]!==t[_].values[1])){t[_].values=g.values}}}if(h>0&&h<t.length){t.splice(0,t.length-h)}var m=false;if(d&&d.setDOMValue){if(this.getMaxConditionsForHelp()===1&&t.length>0){if(this._getContentFactory().isMeasure()&&this._getContentFactory().getUnitConditionsType()){u=this._getContentFactory().getUnitConditionsType().formatValue(t)}else if(this._getContentFactory().getConditionType(true)){u=this._getContentFactory().getConditionType().formatValue(t[0])}else if(this._getContentFactory().getConditionsType(true)){u=this._getContentFactory().getConditionsType().formatValue(t)}var b=function(e){var i=d.getDOMValue();d.setDOMValue("");d.setDOMValue(e);if(i!==e&&h===1){this.fireLiveChange({value:t[0].values[0]})}}.bind(this);if(u instanceof Promise){u.then(function(e){b(e)})}else{b(u)}this._sFilterValue=""}else if(r){if(this.getMaxConditions()!==1&&!this._getContentFactory().getBoundProperty()&&d.getMetadata().hasProperty("value")&&d.getProperty("value")){d.setValue()}d.setDOMValue("");this._sFilterValue="";this._bIgnoreInputValue=false}else{this._bIgnoreInputValue=true}if(this._bParseError){this._bParseError=false;this._removeUIMessage();m=true}}var F=this.getConditions();if(!y(t,F)){this._oNavigateCondition=undefined;this._getContentFactory().updateConditionType();this.setProperty("conditions",t,true);if(!s.compareConditionsArray(t,F)){l.onControlChange();N.call(this,t,true)}}else if(m){N.call(this,t,true)}}function Ee(e){var t=e.getParameter("value");var n=e.getParameter("key");var r=e.getParameter("condition");var l=e.getParameter("itemId");var h=e.getParameter("leaveFocus");if(!r&&n){r=o.createItemCondition(n,t)}var g;var d;var u=this.getControlForSuggestion();var p=s.getEQOperator(this._getOperators());var c=Fe.call(this);if(h){u.addStyleClass("sapMFocus");u.focus();c.removeFocus();return}if(r){this._oNavigateCondition=v({},r);this._oNavigateCondition.operator=p.name;n=r.values[0];t=r.values[1]}else{this._oNavigateCondition=o.createCondition(p.name,[n,t],undefined,undefined,a.Validated)}if(this._getContentFactory().isMeasure()){var f=this.getConditions();if(f.length>0){this._oNavigateCondition.operator=f[0].operator;this._oNavigateCondition.values[0]=[f[0].values[0][0],n];if(f[0].operator==="BT"){this._oNavigateCondition.values[1]=[f[0].values[1][0],this._oNavigateCondition.values[0][1]]}else if(this._oNavigateCondition.values.length>1){this._oNavigateCondition.values.splice(1)}}else{this._oNavigateCondition.values=[this.getControlDelegate().enhanceValueForUnit(this.getPayload(),[null,n],this._oTypeInitialization)]}}this._bPreventGetDescription=true;this._getContentFactory().updateConditionType();if(this.getDisplay()!==i.Value){g=n}else if(t){g=t}else{g=n}if(u&&u.setDOMValue){if(!d){if(this._getContentFactory().isMeasure()&&this._getContentFactory().getUnitConditionsType()&&this._oNavigateCondition){d=this._getContentFactory().getUnitConditionsType().formatValue([this._oNavigateCondition])}else if(this._getContentFactory().getConditionType(true)&&this._oNavigateCondition){d=this._getContentFactory().getConditionType().formatValue(this._oNavigateCondition)}else if(this._getContentFactory().getConditionsType(true)&&this._oNavigateCondition){d=this._getContentFactory().getConditionsType().formatValue([this._oNavigateCondition])}else{d=t||n}}u.setDOMValue(d);if(u._doSelect){u._doSelect()}if(c.isOpen()){u.removeStyleClass("sapMFocus")}}this._bPreventGetDescription=false;this._getContentFactory().updateConditionType();z.call(this,true,l);this._bIgnoreInputValue=false;this.fireLiveChange({value:g})}function Ve(e){if(this._bIgnoreInputValue){var t=this.getControlForSuggestion();this._bIgnoreInputValue=false;t.setDOMValue("");this._sFilterValue="";if(this.getMaxConditions()!==1&&!this._getContentFactory().getBoundProperty()&&t.getMetadata().hasProperty("value")&&t.getProperty("value")){t.setValue()}}z.call(this,false);var i=e.getSource();var a=this.getConditions();De.call(this,a,i)}function Me(e){var t=this.getControlForSuggestion();t.focus();if(t.fireValueHelpRequest){t.bValueHelpRequested=true;t.fireValueHelpRequest()}}function Ie(e){var a=this.getEditMode()===t.Editable&&this._getContent().length>0&&sap.ui.getCore().getCurrentFocusedControlId()===this._getContent()[0].getId();if(!a&&!this._bPendingConditionUpdate&&this.getConditions().length>0&&(this.getMaxConditions()!==1||this.getDisplay()!==i.Value&&!this._bParseError)&&this._oManagedObjectModel){this._oManagedObjectModel.checkUpdate(true)}}function Oe(e){var t=Fe.call(this);Ae.call(this,t)}function Ae(e){if(this._bConnected){e.detachEvent("select",Te,this);e.detachEvent("navigated",Ee,this);e.detachEvent("disconnect",Oe,this);e.detachEvent("afterClose",Ve,this);e.detachEvent("switchToValueHelp",Me,this);e.detachEvent("closed",Ve,this);this._bConnected=false}}function He(){var e=Fe.call(this);if(e){var t=Re.call(this);var a;var n=this._getContentFactory().isMeasure();if(n){var s=this._getContentFactory().getCompositeTypes();if(s&&s.length>1){a=s[1]}}else{a=this._getContentFactory().getDataType()}var o={maxConditions:this.getMaxConditions(),dataType:a,operators:this._getOperators(),display:n?i.Value:this.getDisplay(),delegate:this.getControlDelegate(),delegateName:this.getDelegate()&&this.getDelegate().name,payload:this.getPayload(),conditionModel:t.model,conditionModelName:t.name,defaultOperatorName:this.getDefaultOperator?this.getDefaultOperator():null};e.connect(this,o);if(!this._bConnected){this._bConnected=true;e.attachEvent("select",Te,this);e.attachEvent("navigated",Ee,this);e.attachEvent("disconnect",Oe,this);e.attachEvent("afterClose",Ve,this);e.attachEvent("switchToValueHelp",Me,this);e.attachEvent("closed",Ve,this);var r=this.getConditions();De.call(this,r,e);var l=this.getControlForSuggestion();Be.call(this,l);if(e._bIsDefaultHelp){w[e._sDefaultHelpType].updateTitle(e,this.getLabel())}}}}function Be(e){if(e&&!e.orgOnsapfocusleave&&e.onsapfocusleave){e.orgOnsapfocusleave=e.onsapfocusleave;e.onsapfocusleave=function(e){var t=Fe.call(this.getParent());if(t){var i=sap.ui.getCore().byId(e.relatedControlId);if(i){if(_(t.getDomRef(),i.getFocusDomRef())){e.stopPropagation();if(this.bValueHelpRequested){this.bValueHelpRequested=false}return}else{t.skipOpening()}}}this.orgOnsapfocusleave(e)}}}H.prototype._getFieldHelpIcon=function(){var e=Fe.call(this);if(e){return e.getIcon()}};function xe(e,t){if(t==="remove"){e.detachEvent("dataUpdate",we,this)}else if(t==="insert"){e.attachEvent("dataUpdate",we,this);we.call(this)}}function we(){var e=this.getFieldInfo();var i=this;e.isTriggerable().then(function(a){i._bTriggerable=a;var n=i.getAggregation("_content",[]);if(n.length>0&&i.getEditMode()===t.Display){K.call(i);if(i._bTriggerable){n=i.getAggregation("_content",[]);var s=n[0];e.getDirectLinkHrefAndTarget().then(function(e){g._updateLink(s,e)})}}})}H.prototype._getFormatOptions=function(){if(!this._asyncParsingCall){this._asyncParsingCall=Se.bind(this)}var e=Re.call(this);return{valueType:this._getContentFactory().retrieveDataType(),originalDateType:this._getContentFactory().getDateOriginalType()||this._getContentFactory().getUnitOriginalType(),additionalType:this._getContentFactory().getUnitType(),compositeTypes:this._getContentFactory().getCompositeTypes(),display:this._getContentFactory().isMeasure()?i.Value:this.getDisplay(),fieldHelpID:this._getContentFactory().isMeasure()?undefined:this.getFieldHelp()||this._sDefaultFieldHelp,operators:this._getOperators(),hideOperator:this._getContentFactory().getHideOperator(),maxConditions:this.getMaxConditions(),bindingContext:this.getBindingContext(),asyncParsing:this._asyncParsingCall,navigateCondition:this._oNavigateCondition,delegate:this.getControlDelegate(),delegateName:this.getDelegate()&&this.getDelegate().name,payload:this.getPayload(),preventGetDescription:this._bPreventGetDescription,conditionModel:e.model,conditionModelName:e.name,convertWhitespaces:this.getEditMode()===t.Display||this.getMaxConditions()!==1,control:this,defaultOperatorName:this.getDefaultOperator?this.getDefaultOperator():null}};H.prototype._checkValueInitial=function(e){if(e===null||e===undefined){return true}if(e===""||typeof e==="string"&&e.match(/^0+$/)){var t=this._getContentFactory().retrieveDataType();var i=t.parseValue("","string");if(i===e){return true}else{try{t.validateValue(i)}catch(e){return true}}}else{var a=k.call(this);if(this.getTypeUtil().getBaseType(a)===h.Unit&&Array.isArray(e)&&e.length>1&&(e[0]===undefined||e[0]===null)&&!e[1]){return true}}return false};H.prototype._getUnitFormatOptions=function(){if(!this._asyncParsingCall){this._asyncParsingCall=Se.bind(this)}var e=Re.call(this);return{valueType:this._getContentFactory().getUnitType(),originalDateType:this._getContentFactory().getDateOriginalType()||this._getContentFactory().getUnitOriginalType(),additionalType:this._getContentFactory().retrieveDataType(),compositeTypes:this._getContentFactory().getCompositeTypes(),display:this.getDisplay(),fieldHelpID:this.getFieldHelp()||this._sDefaultFieldHelp,operators:["EQ"],hideOperator:true,maxConditions:1,bindingContext:this.getBindingContext(),asyncParsing:this._asyncParsingCall,navigateCondition:this._oNavigateCondition,delegate:this.getControlDelegate(),delegateName:this.getDelegate()&&this.getDelegate().name,payload:this.getPayload(),preventGetDescription:this._bPreventGetDescription,conditionModel:e.model,conditionModelName:e.name,convertWhitespaces:this.getEditMode()===t.Display||this.getEditMode()===t.EditableDisplay,control:this,getConditions:this.getConditions.bind(this)}};function Se(e){var t=Fe.call(this);if(t&&t.isOpen()){var i=document.activeElement;if(i&&(_(this.getDomRef(),i)||_(t.getDomRef(),i))){t.close()}}var a={};var n=new Promise(function(t,i){a.resolve=t;a.reject=i;e.then(function(e){a.result=e;this._bParseError=false;var t=this.getConditions();if(y(e,t)){Ue.call(this,a);Le.call(this,a)}else{a.waitForUpdate=true}}.bind(this)).catch(function(e){if(e&&!(e instanceof F)&&!(e instanceof b)&&!(e instanceof D)){throw e}this._bParseError=true;i(e);Le.call(this,a)}.bind(this))}.bind(this));a.promise=n;this._aAsyncChanges.push(a)}function Ne(){var e=[];for(var t=0;t<this._aAsyncChanges.length;t++){e.push(this._aAsyncChanges[t].promise)}if(e.length>0){return Promise.all(e).then(function(){return this._getResultForPromise(this.getConditions())}.bind(this))}return null}H.prototype._getResultForPromise=function(e){return e};function Ue(e){e.resolve(this._getResultForPromise(e.result))}function Le(e){var t=false;var i=0;for(i=0;i<this._aAsyncChanges.length;i++){if(e===this._aAsyncChanges[i]){t=true;break}}if(t){this._aAsyncChanges.splice(i,1)}return t}H.prototype._getOperators=function(){var e=new RegExp("^\\*(.*)\\*|\\$search$");if(e.test(this.getFieldPath())&&this.getMaxConditions()===1){return["Contains"]}var t=this.getBaseType();if(t===h.Unit){t=h.Numeric}return s.getOperatorsForType(t)};function ke(e){var t=this._getOperators();for(var i=0;i<t.length;i++){if(e===t[i]){return true}}return false}function Re(){var e;var t;var i=this.getBinding("conditions");if(i){var a=i.getModel();if(a&&a.isA("sap.ui.mdc.condition.ConditionModel")){e=a;var n=this.getBindingInfo("conditions");if(n.model){t=n.model}else if(n.parts&&n.parts.length===1){t=n.parts[0].model}}}return{name:t,model:e}}H.prototype._isPropertyInitial=function(e){if(this.isBound(e)&&!this.getBinding(e)){return!Object.prototype.hasOwnProperty.call(this.mProperties,e)}else{return this.isPropertyInitial(e)}};return H});
//# sourceMappingURL=FieldBase.js.map