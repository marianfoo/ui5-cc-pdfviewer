/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/XMLComposite","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/base/ManagedObjectObserver","sap/base/strings/formatMessage","sap/ui/model/resource/ResourceModel","sap/m/MultiInput","sap/ui/mdc/enum/ConditionValidated"],function(e,t,i,n,o,a,s,r){"use strict";var l=e.extend("sap.ui.mdc.field.ValueHelpPanel",{metadata:{library:"sap.ui.mdc",properties:{showTokenizer:{type:"boolean",group:"Data",defaultValue:true},showFilterbar:{type:"boolean",group:"Data",defaultValue:true},conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},formatOptions:{type:"object",defaultValue:{}},inputOK:{type:"boolean",defaultValue:true},_filterBarVisible:{type:"boolean",group:"Appearance",defaultValue:false,visibility:"hidden"}}},fragment:"sap.ui.mdc.field.ValueHelpPanel",init:function(){var e=this._getManagedObjectModel();e.setSizeLimit(1e6);if(!this._oTokenizer){this._oTokenizer=this.byId("VHPTokenizer");this._oTokenizer._setValueVisible=function(e){this.$("inner").css("opacity","0")};var t=this._oTokenizer.onAfterRendering;this._oTokenizer.onAfterRendering=function(){t.apply(this._oTokenizer,arguments);this._oTokenizer._setValueVisible();this._oTokenizer.setValue("")}.bind(this)}this._oTokenizerPanel=this.byId("VHPTokenizerPanel");this._oFilterVBox=this.byId("filterbarVBox");this._oFilterVBox._oValueHelpPanel=this;this._oFilterVBox.getItemsOriginal=this._oFilterVBox.getItems;this._oFilterVBox.getItems=function(){var e=this.getItemsOriginal();if(this._oValueHelpPanel._oFilterbar&&this._oValueHelpPanel.getProperty("_filterBarVisible")){e.push(this._oValueHelpPanel._oFilterbar)}return e};this._oTablePanel=this.byId("tablePanel");this._oTablePanel._oValueHelpPanel=this;this._oTablePanel.getContentOriginal=this._oTablePanel.getContent;this._oTablePanel.getContent=function(){var e=this.getContentOriginal();if(this._oValueHelpPanel._oTable){e.push(this._oValueHelpPanel._oTable)}return e};this._oObserver=new n(d.bind(this));this._oObserver.observe(this,{properties:["formatOptions","showFilterbar","showTokenizer","_filterBarVisible"]});this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc")},exit:function(){if(!this.getShowTokenizer()){this._oTokenizerPanel.destroy()}if(this._oDefineConditionPanel&&!this._oDefineConditionPanel.getParent()){this._oDefineConditionPanel.destroy()}this._oObserver.disconnect();this._oObserver=undefined;this._oTablePanel=null;this._oFilterVBox=null;this._oResourceBundle=null},onBeforeRendering:function(){if(!this.getModel("$i18n")){this.setModel(new a({bundleName:"sap/ui/mdc/messagebundle",async:false}),"$i18n")}},setFilterbar:function(e){var t=this.getShowFilterbar();if(this._oFilterbar){if(this._bFilterbarParentSet){this._oFilterbar.setParent();delete this._bFilterbarParentSet}}this._oFilterbar=e;if(e){if(!e.getParent()){e.setParent(this);this._bFilterbarParentSet=true}e.getParent().getDirection=this._oFilterVBox.getDirection.bind(this._oFilterVBox)}var i=this.byId("iconTabBar");i.getItems()[0].setVisible(i.getItems()[0].getContent().length>0);i.setSelectedKey("selectFromList");this._updateITBHeaderVisiblity();this.setProperty("_filterBarVisible",t&&!!this._oFilterbar,true)},setTable:function(e){if(this._oTable){if(this._bTableParentSet&&this._oTable.getParent()){this._oTable.setParent()}delete this._bTableParentSet}this._oTable=e;if(e){if(!e.getParent()){e.setParent(this);this._bTableParentSet=true}}this._oTablePanel.invalidate();var t=this.byId("iconTabBar");t.getItems()[0].setVisible(t.getItems()[0].getContent().length>0);t.setSelectedKey("selectFromList");this._updateITBHeaderVisiblity()},getTable:function(){if(this._oTable){return this._oTable}else{return undefined}},setDefineConditions:function(e){var t=this.byId("iconTabBar");var i=this.byId("defineConditionPanel");if(this._oDefineConditionPanel){i.removeContent(this._oDefineConditionPanel);this._oDefineConditionPanel.destroy()}this._oDefineConditionPanel=e;t.getItems()[1].setVisible(!!this._oDefineConditionPanel);this._updateITBHeaderVisiblity()},_updateITBHeaderVisiblity:function(){var e=this.byId("iconTabBar");if(e.getItems()[0].getVisible()&&e.getItems()[1].getVisible()){e.removeStyleClass("sapMdcNoHeader")}else{e.addStyleClass("sapMdcNoHeader")}if(e.getItems()[1].getVisible()&&e.getSelectedKey()!=="selectFromList"){h.call(this)}},_handleTokenDelete:function(e){if(e.getParameter("removedTokens")){var t=e.getParameter("removedTokens");var i=this.getConditions();var n;for(n=0;n<t.length;n++){var o=t[n];var a=o.getBindingContext("$this").sPath;var s=parseInt(a.slice(a.lastIndexOf("/")+1));i[s].delete=true}for(n=i.length-1;n>=0;n--){if(i[n].delete){i.splice(n,1)}}this.setProperty("conditions",i,true)}},_onRemoveAllConditions:function(e){this.setProperty("conditions",[],true)},iconTabSelect:function(e){var t=e.getParameter("key");if(t==="defineCondition"){h.call(this)}},_formatListTabTitle:function(e,t){var i=0;for(var n=0;n<t.length;n++){var a=t[n];if(a.isEmpty!==true&&a.validated===r.Validated){i++}}if(i===0){e=this._oResourceBundle.getText("valuehelp.SELECTFROMLISTNONUMBER")}return o(e,i)},_formatDefineTabTitle:function(e,t){var i=0;for(var n=0;n<t.length;n++){var a=t[n];if(a.isEmpty!==true&&a.validated!==r.Validated){i++}}if(i===0){e=this._oResourceBundle.getText("valuehelp.DEFINECONDITIONSNONUMBER")}return o(e,i)},_formatTableTitle:function(e){var t=0;e=this._oResourceBundle.getText("valuehelp.TABLETITLENONUMBER");return o(e,t)},_formatTokenizerTitle:function(e,t){var i=0;for(var n=0;n<t.length;n++){var a=t[n];if(a.isEmpty!==true){i++}}if(i===0){e=this._oResourceBundle.getText("valuehelp.TOKENIZERTITLENONUMBER")}return o(e,i)}});function d(e){if(e.name==="formatOptions"){var t=this._oTokenizer.getBindingInfo("tokens");if(t&&t.template){t=t.template.getBindingInfo("text");if(t&&t.type){t.type.setFormatOptions(e.current)}}}if(e.name==="showTokenizer"){var i=this.byId("rootVBox");var n=this._oTokenizer.getBinding("tokens");if(e.current){if(n){n.resume()}i.insertItem(this._oTokenizerPanel,1)}else{if(n){n.suspend()}i.removeItem(this._oTokenizerPanel)}}if(e.name==="showFilterbar"){this.setProperty("_filterBarVisible",e.current&&!!this._oFilterbar,true)}if(e.name==="_filterBarVisible"){this._oTablePanel.invalidate()}}function h(){if(this._oDefineConditionPanel){if(!this._oDefineConditionPanel.getModel("$VHP")){var e=this._getManagedObjectModel();this._oDefineConditionPanel.setModel(e,"$VHP");var t=this._oDefineConditionPanel.getMetadata();if(t.hasProperty("formatOptions")&&!this._oDefineConditionPanel.getBindingPath("formatOptions")&&this._oDefineConditionPanel.isPropertyInitial("formatOptions")){this._oDefineConditionPanel.bindProperty("formatOptions",{path:"$VHP>/formatOptions"})}if(t.hasProperty("conditions")&&!this._oDefineConditionPanel.getBindingPath("conditions")&&this._oDefineConditionPanel.isPropertyInitial("conditions")){this._oDefineConditionPanel.bindProperty("conditions",{path:"$VHP>/conditions"})}if(t.hasProperty("inputOK")&&!this._oDefineConditionPanel.getBindingPath("inputOK")&&this._oDefineConditionPanel.isPropertyInitial("inputOK")){this._oDefineConditionPanel.bindProperty("inputOK",{path:"$VHP>/inputOK"})}}var i=this.byId("defineConditionPanel");i.addContent(this._oDefineConditionPanel)}}return l});
//# sourceMappingURL=ValueHelpPanel.js.map