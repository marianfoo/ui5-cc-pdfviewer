/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/p13n/Engine","sap/base/Log","sap/ui/mdc/flexibility/Util","sap/ui/fl/changeHandler/Base"],function(e,t,n,i){"use strict";var r={beforeAddItem:function(e,t,n,i){return e.addItem.call(e,t,n,i)},afterRemoveItem:function(e,t,n,i){return e.removeItem.call(e,t,n,i)},findItem:function(e,t,n){return Promise.resolve()},beforeApply:function(e,t,n){return},afterApply:function(e,t,n){return},determineAggregation:function(e,t){var n;return Promise.resolve().then(e.getControlMetadata.bind(e,t)).then(function(i){n=i.getDefaultAggregation().name;return e.getAggregation(t,n)}).then(function(e){return{name:n,items:e}})},_getExistingAggregationItem:function(e,t,n){var i=t.modifier;return this.determineAggregation(i,n).then(function(t){var n,r=t.items;if(r){n=this.findItem(i,r,e.name)}return n}.bind(this))},_getDelegate:function(e){return new Promise(function(t,n){sap.ui.require([e],t,n)})},_getOperationText:function(e){return e?"reverted ":"applied "},_getChangeTypeText:function(e){return e?"add":"remove"},_applyAdd:function(e,t,r,a){var o=a===n.REVERT;this.beforeApply(e.getChangeType(),t,o);var g=r.modifier,h=o?e.getRevertData():e.getContent();var s=h.name;var u;var d;var f;var p=this.determineAggregation(g,t).then(function(e){f=e;d=f.items;u=h.index>-1?h.index:d.length;return this._getExistingAggregationItem(h,r,t)}.bind(this)).then(function(e){if(e){return e}else{return g.getProperty(t,"delegate").then(function(e){return this._getDelegate(e.name)}.bind(this)).then(function(e){return this.beforeAddItem(e,s,t,r,h)}.bind(this)).then(function(e){return e})}}.bind(this)).then(function(e){if(!e){throw new Error("No item in"+f.name+"  created. Change to "+this._getChangeTypeText(!o)+"cannot be "+this._getOperationText(o)+"at this moment")}if(d.indexOf(e)<0){g.insertAggregation(t,f.name,e,u)}else{return i.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}return e}.bind(this)).then(function(){if(o){e.resetRevertData()}else{e.setRevertData({name:h.name,index:u})}this.afterApply(e.getChangeType(),t,o)}.bind(this));return p},_applyRemove:function(e,t,r,a){var o=a===n.REVERT;this.beforeApply(e.getChangeType(),t,o);var g=r.modifier,h=o?e.getRevertData():e.getContent();var s;var u;var d;var f=this.determineAggregation(g,t).then(function(e){s=e;return this._getExistingAggregationItem(h,r,t)}.bind(this)).then(function(e){d=e;if(!d){return i.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}else{return g.findIndexInParentAggregation(d)}}).then(function(e){u=e;return g.removeAggregation(t,s.name,d)}).then(function(){return g.getProperty(t,"delegate").then(function(e){return this._getDelegate(e.name)}.bind(this)).then(function(n){return this.afterRemoveItem(n,d,t,r).then(function(n){if(n&&d){g.destroy(d,"KeepDom")}this.afterApply(e.getChangeType(),t,o)}.bind(this))}.bind(this))}.bind(this)).then(function(){if(o){e.resetRevertData()}else{e.setRevertData({name:h.name,index:u})}});return f},_applyMove:function(e,t,r,a){var o=a===n.REVERT;this.beforeApply(e.getChangeType(),t,o);if(this._bSupressFlickering){this._delayInvalidate(t)}var g=r.modifier;var h=o?e.getRevertData():e.getContent();var s;var u;var d;var f=this.determineAggregation(g,t).then(function(e){u=e;return this._getExistingAggregationItem(h,r,t)}.bind(this)).then(function(e){s=e}).then(function(){if(!s){return i.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}else{return g.findIndexInParentAggregation(s)}}).then(function(e){d=e;if(t.moveColumn){return t.moveColumn(s,h.index)}else{return g.removeAggregation(t,u.name,s).then(function(){return g.insertAggregation(t,u.name,s,h.index)})}}).then(function(){if(o){e.resetRevertData()}else{e.setRevertData({name:h.name,index:d})}this.afterApply(e.getChangeType(),t,o)}.bind(this));return f},_removeIndexFromChange:function(e){var t=e.getContent();delete t.index;e.setContent(t)},createAddChangeHandler:function(){return n.createChangeHandler({apply:this._applyAdd.bind(this),revert:this._applyRemove.bind(this)})},createRemoveChangeHandler:function(){return n.createChangeHandler({apply:this._applyRemove.bind(this),complete:this._removeIndexFromChange.bind(this),revert:this._applyAdd.bind(this)})},createMoveChangeHandler:function(){return n.createChangeHandler({apply:this._applyMove.bind(this),revert:this._applyMove.bind(this)})}};return r});
//# sourceMappingURL=ItemBaseFlex.js.map