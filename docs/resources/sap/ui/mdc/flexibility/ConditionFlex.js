/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/Log","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/flexibility/Util"],function(e,n,t,i){"use strict";var r=function(e,n){var t=function(n){if(e._pQueue===n){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(n):n();e._pQueue.then(t.bind(null,e._pQueue));return e._pQueue};var o=function(e){return new Promise(function(n,t){sap.ui.require([e],n,t)})};var a=function(e){var n=e&&e.getEngine?e.getEngine().getController(e,"Filter"):null;return n?n.getFilterControl():null};var u=function(u,l,f,d){var p=a(l);var c=d===i.REVERT;var g=c?u.getRevertData():u.getContent();if(p&&p.applyConditionsAfterChangesApplied){p.applyConditionsAfterChangesApplied(l)}var s,v=null,C=f.modifier;return r(l,function(){return C.getProperty(l,"filterConditions").then(function(i){s=e({},i);if(s){for(var r in s){if(r===g.name){v=s[r];break}}}if(!v){s[g.name]=[];v=s[g.name]}if(!c){u.setRevertData({name:g.name,condition:g.condition})}var a=t.indexOfCondition(g.condition,v);if(a<0){v.push(g.condition);C.setProperty(l,"filterConditions",s);return C.getProperty(l,"delegate").then(function(e){return o(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?e.getFilterDelegate().addCondition:e.addCondition);if(t){return t(g.name,l,f).catch(function(e){n.error("Error during Delegate.addCondition call: "+e)})}}).finally(function(){if(c){u.resetRevertData()}})}})})};var l=function(u,l,f,d){var p=a(l);var c=d===i.REVERT;var g=c?u.getRevertData():u.getContent();if(p&&p.applyConditionsAfterChangesApplied){p.applyConditionsAfterChangesApplied(l)}var s,v,C=-1,m=f.modifier;return r(l,function(){return m.getProperty(l,"filterConditions").then(function(i){s=e({},i);if(s){for(var r in s){if(r===g.name){v=s[r];break}}}if(!c){u.setRevertData({name:g.name,condition:g.condition})}if(v&&v.length>0){C=t.indexOfCondition(g.condition,v);if(C>=0){v.splice(C,1);m.setProperty(l,"filterConditions",s);return m.getProperty(l,"delegate").then(function(e){return o(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?e.getFilterDelegate().removeCondition:e.removeCondition);if(t){return t(g.name,l,f).catch(function(e){n.error("Error during Delegate.removeCondition call: "+e)})}}).finally(function(){if(c){u.resetRevertData()}})}}})})};var f={};f.addCondition=i.createChangeHandler({apply:u,revert:l});f.removeCondition=i.createChangeHandler({apply:l,revert:u});return f});
//# sourceMappingURL=ConditionFlex.js.map