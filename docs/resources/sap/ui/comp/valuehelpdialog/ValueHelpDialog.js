/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Core","sap/base/Log","sap/ui/comp/library","sap/m/Dialog","sap/m/MessageBox","sap/m/Token","./ItemsCollection","sap/ui/core/library","sap/m/VBox","sap/m/HBox","sap/m/FlexBox","sap/ui/comp/util/FormatUtil","sap/m/DialogRenderer","sap/m/FlexItemData","sap/m/Title","sap/m/Text","sap/m/Label","sap/m/Button","sap/m/Bar","sap/m/OverflowToolbarLayoutData","sap/m/Tokenizer","sap/m/Panel","sap/m/StandardListItem","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/library","sap/ui/core/InvisibleText","sap/ui/core/InvisibleMessage","sap/ui/core/IconPool","sap/ui/table/library","sap/ui/table/Table","sap/ui/table/Column","sap/m/Table","sap/m/Column","sap/ui/layout/HorizontalLayout","sap/ui/layout/Grid","sap/ui/Device","sap/m/List","sap/m/Link","sap/ui/comp/p13n/P13nFilterPanel","sap/m/P13nConditionPanel","sap/m/P13nItem","sap/m/P13nAnyFilterItem","sap/m/CheckBox","sap/ui/comp/p13n/P13nOperationsHelper","sap/ui/core/format/NumberFormat","sap/ui/core/ResizeHandler","sap/base/strings/whitespaceReplacer"],function(e,t,i,s,a,o,n,l,r,h,_,d,u,c,g,p,T,f,b,S,y,I,m,v,C,B,R,k,E,V,L,F,P,x,O,D,A,M,w,N,H,K,z,G,W,U,j,$){"use strict";var q;var Z=B.ButtonType;var Q=B.OverflowToolbarPriority;var J=B.ListMode;var X=B.ListType;var Y=l.HorizontalAlign;var ee=l.InvisibleMessageMode;var te=i.smartfilterbar.DisplayBehaviour;var ie={DESKTOP_LIST_VIEW:"DESKTOP_LIST_VIEW",DESKTOP_CONDITIONS_VIEW:"DESKTOP_CONDITIONS_VIEW",PHONE_MAIN_VIEW:"PHONE_MAIN_VIEW",PHONE_SEARCH_VIEW:"PHONE_SEARCH_VIEW",PHONE_LIST_VIEW:"PHONE_LIST_VIEW",PHONE_CONDITIONS_VIEW:"PHONE_CONDITIONS_VIEW"};var se=s.extend("sap.ui.comp.valuehelpdialog.ValueHelpDialog",{metadata:{library:"sap.ui.comp",properties:{basicSearchText:{type:"string",group:"Misc",defaultValue:""},supportMultiselect:{type:"boolean",group:"Misc",defaultValue:true},supportRanges:{type:"boolean",group:"Misc",defaultValue:false},supportRangesOnly:{type:"boolean",group:"Misc",defaultValue:false},key:{type:"string",group:"Misc",defaultValue:""},keys:{type:"string[]",group:"Misc",defaultValue:null},descriptionKey:{type:"string",group:"Misc",defaultValue:""},maxIncludeRanges:{type:"string",group:"Misc",defaultValue:"-1"},maxExcludeRanges:{type:"string",group:"Misc",defaultValue:"-1"},maxConditions:{type:"string",group:"Misc",defaultValue:"-1"},displayFormat:{type:"string",group:"Misc",defaultValue:""},tokenDisplayBehaviour:{type:"string",group:"Misc",defaultValue:""},filterMode:{type:"boolean",group:"Misc",defaultValue:false},_enhancedExcludeOperations:{type:"boolean",group:"Misc",defaultValue:false,visibility:"hidden"},conditionPanelDefaultOperation:{type:"string",group:"Misc",defaultValue:null}},aggregations:{filterBar:{type:"sap.ui.comp.filterbar.FilterBar",multiple:false}},events:{ok:{parameters:{tokens:{type:"sap.m.Token[]"}}},cancel:{},selectionChange:{parameters:{tableSelectionParams:{type:"object"},updateTokens:{type:"object[]"},useDefault:{type:"boolean",defaultValue:false},table:{type:"object"}}},tokenRemove:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}},updateSelection:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}}}},renderer:{apiVersion:2}});se.prototype.setSupportMultiselect=function(e){this.setProperty("supportMultiselect",e);this._updatePropertySupportMultiselect(e);this._oTokenizerGrid.setVisible(e);this._oButtonOk.setVisible(e);return this};se.prototype._updatePropertySupportMultiselect=function(e){if(!this._oTable){return undefined}if(!this._isPhone()){if(this._oTable.setSelectionMode){this._oTable.setSelectionMode(e?V.SelectionMode.MultiToggle:V.SelectionMode.Single)}}else if(this._oTable.setMode){this._oTable.setMode(e?J.MultiSelect:J.SingleSelectLeft)}return this};se.prototype.setSupportRanges=function(e){this.setProperty("supportRanges",e);this._updateNavigationControl();return this};se.prototype.setSupportRangesOnly=function(e){this.setProperty("supportRangesOnly",e);this._updateNavigationControl();return this};se.prototype.setTitle=function(e){this.setProperty("title",e);this._updateDlgTitle();return this};se.prototype.setFilterBar=function(e){this.setAggregation("filterBar",e);if(this._oMainLayout&&e){if(this._isPhone()){if(this._oFilterBar){this._oContentContainer.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize)}}else if(this._oFilterBar){this._oMainLayout.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize)}this._oFilterBar=e;this._oFilterBar.attachInitialise(this._handleFilterBarInitialize,this);if(this._oFilterBar){this._oFilterBar.addStyleClass("compVHSearch");if(this._isPhone()){var t=sap.ui.getCore().byId(this._oFilterBar.getBasicSearch());if(t&&t.isA("sap.m.SearchField")){t.setShowSearchButton(true);t.attachSearch(function(e){if(e.mParameters.refreshButtonPressed!==undefined){this.getFilterBar().search()}}.bind(this))}this._oFilterBar.setShowGoOnFB(false);this._oColSearchBox.setLayoutData(new c({shrinkFactor:0}));this._oContentContainer.insertItem(this._oColSearchBox,0);this._oFilterBar.setLayoutData(new c({shrinkFactor:0}));this._oContentContainer.insertItem(this._oFilterBar,1);this._oFilterBar.attachSearch(function(e){this._updateView(ie.PHONE_LIST_VIEW)}.bind(this));if(this._currentViewMode===ie.PHONE_LIST_VIEW){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);this._handleFilterBarInitialize()}}else{this._oFilterBar._setCollectiveSearch(this._oColSearchBox);this._oMainLayout.insertItem(this._oFilterBar,0)}}if(ne(this._oTabBar)){this.setInitialFocus(this._oTabBar.getItems()[0])}else if(this._oFilterBar._oSearchButton){this.setInitialFocus(this._oFilterBar._oSearchButton)}if(this._oFilterBar._oBasicSearchField){var i=this._oFilterBar._oBasicSearchField;i.setValue(this.getBasicSearchText());if(!ne(this._oTabBar)){this.setInitialFocus(i)}}}return this};se.prototype._handleFilterBarInitialize=function(){if(this._currentViewMode===ie.PHONE_LIST_VIEW){this._oFilterBar._handleVisibilityOfToolbar();var e=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(e);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()))}this._setToolbarSpacerWidth();if(ne(this._oTabBar)){this.setInitialFocus(this._oTabBar.getItems()[0])}else if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this.setInitialFocus(this._oFilterBar._oBasicSearchField)}};se.prototype.getFilterBar=function(){return this._oFilterBar};se.prototype.setBasicSearchText=function(e){this.setProperty("basicSearchText",e);if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this._oFilterBar._oBasicSearchField.setValue(e)}return this};se.prototype.setTokens=function(e){var t=true;if(e.length){var i=0,s;for(var a=0;a<e.length;a++){var n=e[a];if(n.data("range")){var l=Object.assign({},n.data("range"));s=n.getKey();if(!s){do{s="range_"+i;i++}while(this._oSelectedRanges[s])}var r=this._getFormatedRangeTokenText(l.operation,l.value1,l.value2,l.exclude,l.keyField);this._addToken2Tokenizer(s,r,this._getTokenizer(),l.keyField);this._oSelectedRanges[s]=l;t=false}else{s=n.getKey();var h=n.getText();var _=n.data("longKey");var d=n.data("row");if(!_){_=s}this._oSelectedItems.add(_,d?d:n.getText());var u=new o(oe.call(this,_));u.setKey(_);u.setText(h);u.setTooltip(h);this._getTokenizer().addToken(u)}}}else{this._oSelectedItems.removeAll();this._oSelectedRanges={};this._getTokenizer().destroyTokens()}if(t){this._updateTokenizer()}};se.prototype.open=function(){if(!this._oTable&&!(this._isPhone()&&(this.getSupportRangesOnly()||this.getFilterMode()))){return ae.call(this).then(function(){return this.open()}.bind(this))}this._bIgnoreSelectionChange=false;if(this._oColSearchBox){this._bIsMdcCollectiveSearch=this._oColSearchBox.isA("sap.ui.mdc.filterbar.vh.CollectiveSearchSelect");if(this._bIsMdcCollectiveSearch){this.bCollectiveSearchActive=this._oColSearchBox.getVisible()}else{this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();this._oColSearchBox.setVisible(this.bCollectiveSearchActive)}}if(!this._isPhone()){if(this.getSupportRangesOnly()||this.getFilterMode()){this._updateView(ie.DESKTOP_CONDITIONS_VIEW)}if(this.isPropertyInitial("contentWidth")){this.setContentWidth(this._getDefaultContentWidth())}}else{this._updateView(ie.PHONE_MAIN_VIEW)}s.prototype.open.apply(this);if(ne(this._oTabBar)){this.setInitialFocus(this._oTabBar.getItems()[0])}else if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this.setInitialFocus(this._oFilterBar._oBasicSearchField)}else if(!this._oFilterBar&&this._currentViewMode==="DESKTOP_CONDITIONS_VIEW"){if(this._oFilterPanel&&this._oFilterPanel._oConditionPanel){var e=this._oFilterPanel._oConditionPanel._oConditionsGrid.getAggregation("content")[0].operation;this.setInitialFocus(e)}}return this};se.prototype.getTable=function(){t.warning("Please use getTableAsync to prevent synchronous calls.",this);if(!this._oTable){this._createDefaultTable()}return this._oTable};se.prototype.getTableAsync=function(){if(this._oTablePromise){return this._oTablePromise}else if(!this._oTable){return ae.call(this)}else{return new Promise(function(e){e(this._oTable)}.bind(this))}};se.prototype.setTable=function(e){if(this._oTable){this._oMainLayout.removeItem(this._oTable);if(this._bTableCreatedInternal){this._oTable.destroy();this._oTable=null}}this._bTableCreatedInternal=arguments.length>1&&arguments[1]==true;if(e&&e.isA("sap.ui.comp.smarttable.SmartTable")){this._oTable=e.getTable()}else{this._oTable=e}if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this._oTable.setEnableBusyIndicator(true);if(this._oTable.isA("sap.ui.table.AnalyticalTable")){q=sap.ui.require("sap/ui/table/AnalyticalColumn")}}this._oTable.setLayoutData(new c({shrinkFactor:0,growFactor:1}));this.theTable=this._oTable;this._initializeTable();this._oMainLayout.addItem(e)};se.prototype._getDefaultContentWidth=function(){var e;if(A.system.desktop){e=1080}else if(A.system.tablet){if(A.orientation.landscape){e=920}else if(A.orientation.portrait){e=600}}return e+"px"};se.prototype.resetTableState=function(){if(this._oTable){if(this._oTable.unbindRows){this._oTable.unbindRows()}this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"))}};se.prototype.TableStateSearchData=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"))};se.prototype._updateNoDataText=function(e){if(this._oTable){if(this._oTable.setNoData){this._oTable.setNoData(e)}else if(this._oTable.setNoDataText){this._oTable.setNoDataText(e)}}};se.prototype.TableStateDataFilled=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_NODATA"))};se.prototype.TableStateDataSearching=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_SEARCHING"))};se.prototype.init=function(){s.prototype.init.apply(this);this._oTokenIdCount={};this._bTableCreatedInternal=false;this._aIncludeRangeOperations={};this._aExcludeRangeOperations={};this._bInitTokensHaveChanged;this.setStretch(this._isPhone());this.setResizable(!this._isPhone());this.setDraggable(!this._isPhone());this.bCollectiveSearchActive=false;this.addStyleClass("compValueHelpDialog");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._sTableTitle1=this._oRb.getText("VALUEHELPDLG_TABLETITLE1");this._sTableTitle2=this._oRb.getText("VALUEHELPDLG_TABLETITLE2");this._sTableTitleNoCount=this._oRb.getText("VALUEHELPDLG_TABLETITLENOCOUNT");this._currentViewMode=null;this._oSelectedItems=new n;this._oSelectedRanges={};this._oOperationsHelper=new W;this._fnRejectTablePromise;this._createHeaderBar();this._createCollectiveSearch();this._createTokenizer();this._updateTokenizer();this._oNavigationContainer=new r(this.getId()+"-navigationContainer",{width:"100%",layoutData:new c({growFactor:0,shrinkFactor:0})});this._oContentContainer=new r(this.getId()+"-vbox",{width:"100%",height:"100%"}).addStyleClass("compVHContentContainerVbox");this._oContainersWrapper=new _(this.getId()+"-containersWrapper",{alignItems:"Start",height:"100%",width:"100%",direction:"Column",justifyContent:"SpaceBetween",items:[this._oNavigationContainer,this._oContentContainer]});this.addContent(this._oContainersWrapper);this._oMainLayout=new r(this.getId()+"-mainLayout",{fitContainer:true,items:[this._oFilterBar],layoutData:new c({growFactor:1,shrinkFactor:0,styleClass:"mainLayout"})});this._createNavigationControl();this._updateNavigationControl();this._oContentContainer.addItem(this._oMainLayout);if(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode()){this._oContentContainer.addItem(this._oTokenizerGrid)}this._createFooterControls();this.setVerticalScrolling(false);this.setHorizontalScrolling(false);if(!A.system.desktop){this._oContentContainer.attachBrowserEvent("touchmove",function(e){e.setMarked()})}if(!this._isPhone()){this._updateView(ie.DESKTOP_LIST_VIEW)}if(!this._oInvisibleMessage){this._oInvisibleMessage=k.getInstance()}};se.prototype._updateView=function(e){if(this._currentViewMode===e){return}switch(e){case ie.DESKTOP_LIST_VIEW:this._validateRanges(function(){this._oTokenizerGrid.setVisible(this.getSupportMultiselect());this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==ie.DESKTOP_LIST_VIEW){this._oTabBar.setSelectedKey(ie.DESKTOP_LIST_VIEW)}this._oMainLayout.addItem(this._oFilterBar);this._oMainLayout.addItem(this._oTable);this._updateDlgTitle()}.bind(this),function(){this._oTabBar.setSelectedKey(ie.DESKTOP_CONDITIONS_VIEW);this._updateView(ie.DESKTOP_CONDITIONS_VIEW)}.bind(this));break;case ie.DESKTOP_CONDITIONS_VIEW:if(this.getSupportRanges()){this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==ie.DESKTOP_CONDITIONS_VIEW){this._oTabBar.setSelectedKey(ie.DESKTOP_CONDITIONS_VIEW)}this._createAddRanges();this._oButtonOk.setVisible(this.getSupportRangesOnly()||this.getSupportMultiselect());this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false)}}break;case ie.PHONE_MAIN_VIEW:this.setVerticalScrolling(false);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(true);this._updateNavigationControl();this._oAdvancedSearchLink.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false);this._oFilterBar.setFilterBarExpanded(false)}if(this._oTable){this._oTable.setVisible(false)}this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false)}if(this._oRanges){this._oRanges.setVisible(false)}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(false);this._bNoneMainView=false;if(!(this._oSelectItemLI.getVisible()&&this._oDefineConditionsLI.getVisible())){this._bNoneMainView=true;if(this._oSelectItemLI.getVisible()){this._updateView(ie.PHONE_LIST_VIEW)}if(this._oDefineConditionsLI.getVisible()){this._updateView(ie.PHONE_CONDITIONS_VIEW)}return}break;case ie.PHONE_LIST_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(this.bCollectiveSearchActive);if(this._bIsMdcCollectiveSearch){this._oColSearchBox.addStyleClass("sapUiTinyMarginBegin");this._oColSearchBox.oVariantText.removeStyleClass("sapUiMdcCollectiveSearchSelectTextPhoneMaxWidth")}this._oMainListMenu.setVisible(false);if(this._oFilterBar){var t=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(t);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false)}if(this._oTable){this._oTable.setVisible(true)}this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false)}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(this.getSupportMultiselect());this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;case ie.PHONE_SEARCH_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(true)}this._oAdvancedSearchLink.setVisible(false);if(this._oTable){this._oTable.setVisible(false)}this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false)}this._oButtonGo.setVisible(true);this._oButtonClear.setVisible(this._oFilterBar&&this._oFilterBar.getShowClearOnFB());this._oButtonOk.setVisible(false);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(true);break;case ie.PHONE_CONDITIONS_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false)}this._oAdvancedSearchLink.setVisible(false);if(this._oTable){this._oTable.setVisible(false)}this._oTokenizerGrid.setVisible(false);if(!this._oRanges){this._createAddRanges()}if(this._oRanges){this._oRanges.setVisible(true)}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;default:break}if(this._oMainListMenu&&this._oContentContainer){if(this._oFilterBar){this._oFilterBar._handleVisibilityOfToolbar()}this._oContentContainer.rerender()}this._currentViewMode=e;this._updateDlgTitle()};se.prototype._changeTableRowSelectionForKey=function(e,t){var i;var s=this._oTable;this._bIgnoreSelectionChange=true;if(s&&s.isA("sap.ui.table.Table")){var a=s.getBinding("rows");if(a){if(a.aKeys){for(i=0;i<a.aKeys.length;i++){if(decodeURIComponent(a.aKeys[i])===e){if(t){s.addSelectionInterval(i,i)}else{s.removeSelectionInterval(i,i)}break}}}else{this.oRows=s.getBinding("rows");if(this.oRows.aIndices){for(i=0;i<this.oRows.aIndices.length;i++){var o=s.getContextByIndex(this.oRows.aIndices[i]);if(o){var n=o.getObject();if(n[this.getKey()]===e){if(t){s.addSelectionInterval(i,i)}else{s.removeSelectionInterval(i,i)}break}}}}}}}else{for(i=0;i<s.getItems().length;i++){var l=s.getItems()[i];var r=l.getBindingContext().getObject();if(r[this.getKey()]===e){s.setSelectedItem(l,t);break}}}this._bIgnoreSelectionChange=false};se.prototype.update=function(){var e,t,i,s;var a;var o=this._oSelectedItems.getItems();var n={tokenKeys:o,useDefault:false};this._bIgnoreSelectionChange=true;if(this._hasListeners("updateSelection")){this.fireUpdateSelection(n)}else{n.useDefault=true}if(n.useDefault){if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this.oRows=this._oTable.getBinding("rows");this._oTable.clearSelection();if(this.oRows&&this.oRows.aKeys){var l=this.getKeys();var r=l&&l.length>1?this.getKey()+"=":"";for(t=0;t<o.length;t++){a=o[t];var h=r+"'"+a+"'";for(e=0;e<this.oRows.aKeys.length;e++){var _=this.oRows.aKeys[e];if(_===undefined){continue}_=decodeURIComponent(_);var d=_===a;if(d||_.indexOf(h)>=0){if(!d){this._oSelectedItems.remove(a);var u=this._getTokenByKey(a,this._getTokenizer());if(u){u.setKey(_)}}s=this._oTable.getContextByIndex(e);if(s){i=s.getObject();this._oSelectedItems.add(_,i)}this._oTable.addSelectionInterval(e,e);break}}}}else if(this.oRows&&this.oRows.aIndices){this._oTable.clearSelection();var c=this._oTable.getBinding("rows").getContexts();for(t=0;t<o.length;t++){var g=o[t];for(e=0;e<this.oRows.aIndices.length;e++){s=c[e];if(s){i=s.getObject();if(i[this.getKey()]===g){this._oSelectedItems.add(i[this.getKey()],i);this._oTable.addSelectionInterval(e,e);break}}}}}}else{var p=this._oTable;for(t=0;t<o.length;t++){a=o[t];for(e=0;e<p.getItems().length;e++){var T=p.getItems()[e];var f=T.getBindingContext().getObject();if(f[this.getKey()]===a){p.setSelectedItem(T,true);break}}}}}this._bIgnoreSelectionChange=false;if(this._bTriggerInvisibleTableCountMessageNotInitialLoad){this._bTriggerInvisibleTableCountMessage=true}this._updateTitles();this._bTriggerInvisibleTableCountMessageNotInitialLoad=true};se.prototype._createHeaderBar=function(){this._oTitle=new g(this.getId()+"-title");var e=null;if(this._isPhone()){e=new f(this.getId()+"-back",{visible:false,type:Z.Back,press:function(e){if(this._currentViewMode===ie.PHONE_SEARCH_VIEW){this._updateView(ie.PHONE_LIST_VIEW)}else{this._updateView(ie.PHONE_MAIN_VIEW)}}.bind(this)});this._oBackButton=e}this._oTitle.addStyleClass("sapUiSmallMarginBeginEnd");var t=new b(this.getId()+"-header",{contentLeft:[e,this._oTitle],design:"Header"});this.setCustomHeader(t);this.getCustomHeader().addStyleClass("sapContrastPlus")};se.prototype._createCollectiveSearch=function(){this.oSelectionTitle=new p(this.getId()+"-selTitle",{visible:false,wrapping:false}).addStyleClass("compVHColSearchText");if(A.system.tablet&&!A.system.desktop){this.oSelectionTitle.addStyleClass("compVHColSearchTextTabletMaxWidth")}else{this.oSelectionTitle.addStyleClass("compVHColSearchTextMaxWidth")}this.oSelectionButton=new f(this.getId()+"-selButton",{icon:"sap-icon://slim-arrow-down",tooltip:this._oRb.getText("VALUEHELPVALDLG_SEARCHTEMPLATES_TOOLTIP"),type:Z.Transparent,visible:false,ariaLabelledBy:this.oSelectionTitle}).addStyleClass("compVHColSearchBtn");this._oColSearchBox=new h(this.getId()+"-selBox",{fitContainer:true,visible:this.oSelectionButton.getVisible(),items:[this.oSelectionTitle,this.oSelectionButton]}).addStyleClass("compVHColSearchVBox")};se.prototype._createFooterControls=function(){this._oButtonOk=new f(this.getId()+"-ok",{text:this._oRb.getText("VALUEHELPDLG_OK"),press:this._onCloseAndTakeOverValues.bind(this),visible:this.getSupportMultiselect(),type:Z.Emphasized,layoutData:new S({priority:Q.NeverOverflow})});this._oButtonCancel=new f(this.getId()+"-cancel",{text:this._oRb.getText("VALUEHELPDLG_CANCEL"),press:this._onCancel.bind(this),layoutData:new S({priority:Q.NeverOverflow})});this._oButtonOk.setWidth(this._oButtonCancel.getWidth());if(this._isPhone()){this._oButtonGo=new f(this.getId()+"-go",{text:this._oRb.getText("VALUEHELPDLG_GO"),type:Z.Emphasized,press:this._onGo.bind(this),visible:false,layoutData:new S({priority:Q.NeverOverflow})});this._oButtonClear=new f(this.getId()+"-clear",{text:this._oRb.getText("VALUEHELPDLG_CLEAR"),press:this._onClear.bind(this),visible:false,layoutData:new S({priority:Q.NeverOverflow})});this.addButton(this._oButtonGo);this.addButton(this._oButtonClear)}this.addButton(this._oButtonOk);this.addButton(this._oButtonCancel)};se.prototype._createTokenizer=function(){if(this._oTokenizerGrid){return this._oTokenizerGrid}this._oSelectedTokenTitle=new R(this.getId()+"-selectedTokenTitle");this._oSelectedTokens=new y(this.getId()+"-selectedTokens",{tokenUpdate:function(e){if(this._ignoreRemoveToken){return}if(e.getParameter("type")===y.TokenChangeType.Removed){var t=e.getParameter("removedTokens");var i=[];var s=[];for(var a=0;a<t.length;a++){var o=t[a];var n=o.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[n]){s.push(n);this._removeToken(n)}else{i.push(n);this._oSelectedItems.remove(n);this._removeTokenFromTokenizer(n,this._getTokenizer())}}this._removeRangeByKey(s);var l={tokenKeys:i,useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(l);this._bIgnoreSelectionChange=false}else{l.useDefault=true}if(l.useDefault){i.forEach(function(e){this._changeTableRowSelectionForKey(e,false)}.bind(this))}if(t.length===1){setTimeout(function(){var e=this._getTokenizer().getTokens();if(e){var t=e.length-1;if(t>=0){e[t].focus()}else{this._manageFocusAfterRemoveTokens()}}}.bind(this))}this._updateTitles()}}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHTokensDiv");if(e.getConfiguration().getAccessibility()){this._oSelectedTokens.addAriaDescribedBy(this._oSelectedTokens.getTokensInfoId())}this._oRemoveAllSelectedItemsBtn=new f(this.getId()+"-removeSelItems",{type:Z.Transparent,icon:E.getIconURI("decline"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._getTokenizer().destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges));this._oSelectedItems.removeAll();this._bIgnoreSelectionChange=true;if(this._oTable&&this._oTable.clearSelection){this._oTable.clearSelection()}if(this._oTable&&this._oTable.removeSelections){this._oTable.removeSelections()}this._bIgnoreSelectionChange=false;this._updateTitles();this._manageFocusAfterRemoveTokens()}.bind(this),ariaDescribedBy:this._oSelectedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var t=new O(this.getId()+"-selItemsBox",{content:[this._getTokenizer(),this._oRemoveAllSelectedItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oIncludeTokenGrid=new D(this.getId()+"-selItemsGrid",{width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oSelectedTokenTitle,t]}).addStyleClass("sapUiRespGridOverflowHidden");this._oTokenizerPanel=new I(this.getId()+"-tokenPanel",{expanded:A.system.desktop,expandable:false,expandAnimation:true,headerText:"",width:"auto",content:[this._oIncludeTokenGrid],expand:function(e){this._updateTokenizer();if(e.mParameters.expand&&this._oTable&&!this._oTable.isA("sap.m.Table")){var t=window.document.getElementById(this.getId()+"-scrollCont");if(t&&t.scrollTop){t.stop().animate({scrollTop:"1000"},1e3)}}}.bind(this)}).addStyleClass("compVHBackgroundTransparent").addStyleClass("compVHTokensPanel").addStyleClass("compValueHelpDialogTokens");if(this._isPhone()){this._getTokenizer().addStyleClass("sapMTokenizerMultiLine")}this._oTokenizerGrid=new D(this.getId()+"-tokenizerGrid",{width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:this._oTokenizerPanel}).addStyleClass("compVHDBackground").addStyleClass("sapUiRespGridOverflowHidden");return this._oTokenizerGrid};se.prototype._addToken2Tokenizer=function(e,t,i,s){var a=typeof t==="string"?t:"";var n=this._getTokenByKey(e,i);t=$(t);if(!n){n=new o(oe.call(this,e,s));n.setKey(e);i.addToken(n);this._updateTokenizer()}if(n){n.setText(t);n.setTooltip(a)}};se.prototype._getTokenByKey=function(e,t){var i=t.getTokens();for(var s=0;s<i.length;s++){var a=i[s];if(a.getKey()===e){return a}}return null};se.prototype._removeToken=function(e){this._removeTokenFromTokenizer(e,this._getTokenizer())};se.prototype._removeTokenFromTokenizer=function(e,t){var i=this._getTokenByKey(e,t);if(i){this._ignoreRemoveToken=true;t.removeToken(i);i.destroy();this._ignoreRemoveToken=false;this._updateTokenizer();return true}return false};se.prototype._updateTokenizer=function(){this._bInitTokensHaveChanged=true;var e=false;if(this._oTokenizerPanel){e=this._oTokenizerPanel.getExpanded()}var t=this._getTokenizer().getTokens().length;var i=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS_CONDITIONS");var s=this._oRb.getText("VALUEHELPDLG_NONESELECTEDITEMS_CONDITIONS");var a=i.replace("{0}",t.toString());var o=t===0?s:a;if(this._oTokenizerPanel){if(!e){o="";if(t!==0){o=a}if(o===""){o=s}}this._oTokenizerPanel.setHeaderText(o);this._oSelectedTokenTitle.setText(o)}else{this._oSelectedTokenTitle.setText(o)}this._oRemoveAllSelectedItemsBtn.setEnabled(t!==0);this._oIncludeTokenGrid.removeStyleClass("displayNone")};se.prototype._createNavigationControl=function(){if(!this._isPhone()){this._oTabBar=new v(this.getId()+"-navigation",{expandable:false,items:[new C(this.getId()+"-itemstable",{visible:true,text:this._getTabSearchAndSelectText(),key:ie.DESKTOP_LIST_VIEW}),new C(this.getId()+"-ranges",{visible:true,text:this._getTabRangesText(),key:ie.DESKTOP_CONDITIONS_VIEW})],select:function(e){this._updateView(e.getParameters().key)}.bind(this)});this._oTabBar.setLayoutData(new c({shrinkFactor:0}));this._oNavigationContainer.addItem(this._oTabBar)}else{this._oSelectItemLI=new m(this.getId()+"-itemstable",{type:X.Navigation,title:this._getTabSearchAndSelectText()}).data("key",ie.PHONE_LIST_VIEW);this._oDefineConditionsLI=new m(this.getId()+"-ranges",{type:X.Navigation,title:this._getTabRangesText()}).data("key",ie.PHONE_CONDITIONS_VIEW);this._oMainListMenu=new M(this.getId()+"-navigation",{mode:J.None,items:[this._oSelectItemLI,this._oDefineConditionsLI],itemPress:function(e){if(e){this._updateView(e.mParameters.listItem.data("key"))}}.bind(this)});this._oMainListMenu.setLayoutData(new c({shrinkFactor:0}));this._oContentContainer.addItem(this._oMainListMenu);this._oAdvancedSearchLink=new w(this.getId()+"-advancedSearchLink",{text:this._oRb.getText("FILTER_BAR_ADV_FILTERS_DIALOG"),press:function(){this._updateView(ie.PHONE_SEARCH_VIEW)}.bind(this)}).addStyleClass("compVHAdvancedSearchLink");this._oAdvancedSearchLink.setLayoutData(new c({shrinkFactor:0,alignSelf:"End"}));this._oContentContainer.addItem(this._oAdvancedSearchLink)}};se.prototype._updateNavigationControl=function(){var e=!this.getSupportRangesOnly();var t=this.getSupportRangesOnly()||this.getSupportRanges();if(this._oTabBar){var i=this._oTabBar.getItems();i[0].setVisible(e);i[1].setVisible(t);this._oTabBar.setVisible(e&&t);this._updateDlgTitle()}if(this._oMainListMenu){this._oSelectItemLI.setVisible(e);this._oDefineConditionsLI.setVisible(t)}};se.prototype._removeRangeByKey=function(e){var t=e;if(typeof t==="string"){t=[t]}t.forEach(function(e,t,i){var s=this._oSelectedRanges[e];if(!s._oGrid){delete this._oSelectedRanges[e];if(this._oFilterPanel){var a=this._oFilterPanel.getConditionPanel();if(i.length==1){a.removeCondition(e)}else{a._removeConditionFromMap(e)}}}},this);if(t.length>1&&this._oFilterPanel){var i=this._oFilterPanel.getConditionPanel();i._clearConditions();i._fillConditions()}};se.prototype._createAddRanges=function(){if(!this._oRanges){if(!sap.ui.require("sap/m/P13nFilterPanel")){sap.ui.require(["sap/m/P13nFilterPanel"],function(){this._oRanges=this._createRanges();this._oMainLayout.addItem(this._oRanges)}.bind(this))}else{this._oRanges=this._createRanges();this._oMainLayout.addItem(this._oRanges)}}else{this._oMainLayout.addItem(this._oRanges)}};se.prototype._createRanges=function(){var e,t;this._oFilterPanel=new N(this.getId()+"-filterPanel",{maxConditions:this.getMaxConditions(),maxIncludes:this.getMaxIncludeRanges(),maxExcludes:this.getMaxExcludeRanges(),containerQuery:true,enableEmptyOperations:true,defaultOperation:this.getConditionPanelDefaultOperation(),filterItemChanged:function(e){var t=e.getParameter("reason");var i=e.getParameter("key");var s=e.getParameter("itemData");if(s&&t==="added"){var a={exclude:s.exclude,keyField:s.columnKey,operation:s.operation,value1:s.value1,value2:s.value2};this._oSelectedRanges[i]=a;var o=new z({key:i,exclude:s.exclude,columnKey:s.columnKey,operation:s.operation});o.setValue1(s.value1);o.setValue2(s.value2);this._oFilterPanel.addFilterItem(o);var n=this._getFormatedRangeTokenText(a.operation,a.value1,a.value2,a.exclude,a.keyField);this._addToken2Tokenizer(i,n,this._getTokenizer(),a.keyField);this._updateTokenizer()}if(s&&t==="updated"){var a=this._oSelectedRanges[i];a.exclude=s.exclude;a.keyField=s.columnKey;a.operation=s.operation;a.value1=s.value1;a.value2=s.value2;var n=this._getFormatedRangeTokenText(a.operation,a.value1,a.value2,a.exclude,a.keyField);this._addToken2Tokenizer(i,n,this._getTokenizer(),a.keyField);this._updateTokenizer()}if(t==="removed"){delete this._oSelectedRanges[i];this._removeToken(i);this._updateTokenizer()}this._updateTabRangesTitle()}.bind(this)});this._oFilterPanel.bIsSingleIntervalRange=this.bIsSingleIntervalRange;if(this.getProperty("_enhancedExcludeOperations")){this._oFilterPanel._enableEnhancedExcludeOperations()}t=this._oFilterPanel.getConditionPanel();t.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel.setSuggestCallback(this._fSuggestCallback);t._sAddRemoveIconTooltipKey="CONDITION";if(this._aIncludeRangeOperations){for(e in this._aIncludeRangeOperations){this._oFilterPanel.setEnableEmptyOperations(false);this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[e],e)}}if(this._aExcludeRangeOperations){for(e in this._aExcludeRangeOperations){this._oFilterPanel.setEnableEmptyOperations(false);this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[e],e)}}if(this._aRangeKeyFields){this._aRangeKeyFields.forEach(function(e){this._oFilterPanel.addItem(new K({columnKey:e.key,text:e.label,typeInstance:e.typeInstance,type:e.type,maxLength:e.maxLength,formatSettings:e.formatSettings,scale:e.scale,precision:e.precision,isDefault:e.isDefault,values:null,nullable:e.nullable!=="false"}))},this)}if(this._oSelectedRanges){for(var i in this._oSelectedRanges){var s=this._oSelectedRanges[i];var a=new z({key:i,exclude:s.exclude,columnKey:s.keyField,operation:s.operation});a.setValue1(s.value1);a.setValue2(s.value2);this._oFilterPanel.addFilterItem(a)}}var o=new D(this.getId()+"-rangeFieldsGrid",{width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oFilterPanel]}).addStyleClass("sapUiRespGridOverflowHidden");this._sValidationDialogTitle=this._oRb.getText("VALUEHELPVALDLG_TITLE");this._sValidationDialogMessage=this._oRb.getText("VALUEHELPVALDLG_MESSAGE");this._sValidationDialogFieldMessage=this._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE");return o};se.prototype.suggest=function(e){this._fSuggestCallback=e;if(this._oFilterPanel){this._oFilterPanel.setSuggestCallback(this._fSuggestCallback)}};se.prototype._getKeyFieldByKey=function(e){var t;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(i){if(typeof i!=="string"){if(i.key===e){t=i;return true}}return false})}return t};se.prototype._validateRanges=function(e,t){if(this._oRanges){if(!this._oRanges.getParent()){e();return}var i=this._oFilterPanel.validateConditions();if(!i){a.show(this._sValidationDialogMessage,{icon:a.Icon.WARNING,title:this._sValidationDialogTitle,actions:[a.Action.OK,a.Action.CANCEL],emphasizedAction:a.Action.OK,styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(i){if(i===a.Action.OK&&e){e()}if(i===a.Action.CANCEL&&t){t()}}});return}}e()};se.prototype.setUpdateSingleRowCallback=function(e){this.fSingleRowCallback=e;this._updateNavigationControl()};se.prototype._createDefaultTable=function(){if(!this._isPhone()){this.setTable(new L(this.getId()+"-table"),true)}else{this.setTable(new P(this.getId()+"-table"),true);this.TableStateSearchData()}};function ae(){if(!(this._oTablePromise instanceof Promise)){this._oTablePromise=new Promise(function(e,t){this._fnRejectTablePromise=t;if(!this._isPhone()){var i=new L(this.getId()+"-table");this.setTable(i,true);e(i)}else{var i=new P(this.getId()+"-table");this.setTable(i,true);this.TableStateSearchData();e(i)}}.bind(this))}return this._oTablePromise}se.prototype._initializeTable=function(){if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this._oTable.setTitle(A.system.desktop?this._sTableTitleNoCount:null);if(this._bTableCreatedInternal){this._oTable.setSelectionBehavior(V.SelectionBehavior.Row)}this._oTable.setSelectionMode(this.getSupportMultiselect()?V.SelectionMode.MultiToggle:V.SelectionMode.Single);this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));this._oTable.setVisibleRowCountMode(V.VisibleRowCountMode.Fixed);this._oTable.setMinAutoRowCount(A.system.desktop?5:4);this._oTable.attachRowSelectionChange(function(e){if(this._bIgnoreSelectionChange||!e.getParameter("userInteraction")){return}var t={tableSelectionParams:e.mParameters,updateTokens:[],useDefault:false,table:this._oTable};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(t);this._bIgnoreSelectionChange=false;t.updateTokens.forEach(function(e){this._addRemoveTokenByKey(e.sKey,e.oRow,e.bSelected)}.bind(this))}else{t.useDefault=true}if(t.useDefault){var i=e.getSource();var s=i.getBinding("rows");var o=i.getSelectedIndices();var n=e.getParameter("rowIndices");var l=e.getParameter("selectAll");var r=s.isLengthFinal?s.isLengthFinal():true;var h,_=o.length;var d;var u=0;if(r){if(s.aKeys){for(h=0;h<_;h++){d=o[h];if(!s.aKeys[d]){u++}}}}else if(l){u=99999999}if(u!==0){var c=function(){s.attachEventOnce("dataReceived",function(){if(l){i.selectAll();n=i.getSelectedIndices()}this._handleSelectionUpdateTokens(i,n)}.bind(this));if(l){if(r){s.getContexts(0,_)}else{s.getContexts(0,u)}}else{s.getContexts(n[0],n[n.length-1])}}.bind(this);if(u<=400){c();return}else{a.show(this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDLOAD"),{icon:a.Icon.WARNING,title:this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDLOADTITLE"),actions:[a.Action.OK,a.Action.CANCEL],emphasizedAction:a.Action.OK,initialFocus:a.Action.CANCEL,styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(e){if(e===a.Action.OK){c()}else{this.update()}}.bind(this)});return}}this._handleSelectionUpdateTokens(i,n)}this._updateTitles();if(!this.getSupportMultiselect()){this._bIgnoreSelectionChange=true;this._onCloseAndTakeOverValues()}}.bind(this));this._oTable.addStyleClass("compVHMainTable");if(!this._oTable.getParent()||!this._oTable.getParent().isA("sap.ui.comp.smarttable.SmartTable")){this._oTable.bindAggregation("columns","columns>/cols",function(e,t){var i,s,a,o=t.getProperty("tooltip"),n=t.getProperty("template");if(t.getProperty("type")==="string"){s={path:n};if(Array.isArray(n)){s={parts:[{path:n[0]},{path:n[1]}],formatter:function(e,i){var s=d.getFormattedExpressionFromDisplayBehaviour(t.getProperty("displayBehaviour"),e,i);return $(s)}}}}if(t.getProperty("type")==="boolean"){i=new G(e+"-control",{enabled:false,selected:{path:n}})}else{var l={path:n,type:t.getProperty("oType")};if(Array.isArray(n)){l={parts:[{path:n[0]},{path:n[1]}],formatter:function(e,i){var s=d.getFormattedExpressionFromDisplayBehaviour(t.getProperty("displayBehaviour"),e,i);return $(s)}}}i=new p(e+"-control",{wrapping:false,renderWhitespace:true,text:l,tooltip:s})}if(this._oTable.isA("sap.ui.table.AnalyticalTable")){a=new q(e,{label:"{columns>label}",template:i,width:"{columns>width}",hAlign:i instanceof G?Y.Center:Y.Begin,filterProperty:t.getProperty("filter")})}else{a=new F(e,{label:"{columns>label}",template:i,width:"{columns>width}",hAlign:i instanceof G?Y.Center:Y.Begin,sortProperty:t.getProperty("sort"),sorted:t.getProperty("sorted"),sortOrder:t.getProperty("sortOrder"),filterProperty:t.getProperty("filter")})}if(o){a.applySettings({tooltip:o})}return a}.bind(this))}}else{this._oTable.setMode(this.getSupportMultiselect()?J.MultiSelect:J.SingleSelectLeft);this._oTable.setGrowing(true);this._oTable.attachSelectionChange(function(e){if(this._bIgnoreSelectionChange){return}var t=e.mParameters;var i={tableSelectionParams:e.mParameters,updateTokens:[],useDefault:false,table:this._oTable};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(i);this._bIgnoreSelectionChange=false;i.updateTokens.forEach(function(e){this._addRemoveTokenByKey(e.sKey,e.oRow,e.bSelected)}.bind(this))}else{i.useDefault=true}if(i.useDefault){var s=t.selected;var a,o=t.listItems.length;for(a=0;a<o;a++){var n=t.listItems[a];var l=n.getBindingContext();var r=l?l.getObject():null;if(r){var h=r[this.getKey()];if(!this.getSupportMultiselect()){this._oSelectedItems.removeAll()}this._addRemoveTokenByKey(h,r,s)}}}if(!this.getSupportMultiselect()){this._onCloseAndTakeOverValues()}}.bind(this));if(!this._oTable.getParent()||!this._oTable.getParent().isA("sap.ui.comp.smarttable.SmartTable")){var e=0;this._oTable.bindAggregation("columns","columns>/cols",function(t,i){var s=i.getProperty("label");var a=this._oTable.getColumns().length>=2;e++;return new x(this._oTable.getId()+"-column"+e,{header:new T(this._oTable.getId()+"-column"+e+"-label",{text:s}),demandPopin:a,minScreenWidth:a?(this._oTable.getColumns().length+1)*10+"rem":"1px"})}.bind(this))}}};se.prototype._handleSelectionUpdateTokens=function(e,t){var i,s=t.length;var a;var o;var n;var l=false;if(e.getBinding("rows").aKeys){l=true}if(!this.getSupportMultiselect()){this._oSelectedItems.removeAll()}for(i=0;i<s;i++){a=t[i];o=e.getContextByIndex(a);n=o?o.getObject():null;if(n){var r;if(l){r=o.sPath.substring(1)}else{r=n[this.getKey()]}this._addRemoveTokenByKey(r,n,e.isIndexSelected(a))}}};se.prototype._addRemoveTokenByKey=function(e,t,i){try{e=decodeURIComponent(e)}catch(e){}if(i){this._oSelectedItems.add(e,t);this._addToken2Tokenizer(e,this._getFormatedTokenText(e),this._getTokenizer())}else{this._oSelectedItems.remove(e);this._removeTokenFromTokenizer(e,this._getTokenizer())}};se.prototype._onCloseAndTakeOverValues=function(){var e=this;var t=function(){var t;var i=e._oSelectedItems.getSelectedItemsTokenArray(e.getKey(),e.getDescriptionKey(),e.getTokenDisplayBehaviour());if(e._oSelectedRanges){var s=0;for(var a in e._oSelectedRanges){t=e._oSelectedRanges[a];var n=t.tokenValue;if(!n){n=e._getFormatedRangeTokenText(t.operation,t.value1,t.value2,t.exclude,t.keyField)}if(!t._oGrid||t._oGrid.select.getSelected()){var l=new o({key:"range_"+s}).data("range",{exclude:t.exclude,operation:t.operation,keyField:t.keyField,value1:t.value1,value2:t.value2});l.setText(n);l.setTooltip(typeof n==="string"?n:null);i.push(l);s++}}}e.fireOk({tokens:i,_tokensHaveChanged:e._bInitTokensHaveChanged})};this._validateRanges(t)};se.prototype._onCancel=function(){this.fireCancel()};se.prototype._onGo=function(){this._oFilterBar.search()};se.prototype._onClear=function(){this._oFilterBar.clear()};se.prototype._updateTitles=function(){this._updateTableTitle();this._updateTokenizer();this._updateTabSearchAndSelectTitle();this._updateTabRangesTitle();if(this._bTriggerInvisibleTableCountMessageNotInitialLoad&&this._bTriggerInvisibleTableCountMessage){this._addInvisibleMessageSearchAndTableCount()}};se.prototype._addInvisibleMessageSearchAndTableCount=function(){var e=this._oRb.getText("VALUEHELPDLG_SEARCH_RESULT_COUNT",this.nRowCount);this._oInvisibleMessage.announce(e,ee.Polite);this._bTriggerInvisibleTableCountMessage=false};se.prototype._updateDlgTitle=function(){var e="";var t;if(this._oTitle){if(this._oTabBar&&!this._oTabBar.getVisible()&&!this.getFilterMode()){if(this._oTabBar.getSelectedKey()===ie.DESKTOP_LIST_VIEW){e="VALUEHELPDLG_TITLE"}else if(this._oTabBar.getSelectedKey()===ie.DESKTOP_CONDITIONS_VIEW){if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){e="VALUEHELPDLG_SINGLECONDITION_TITLE"}else{e="VALUEHELPDLG_RANGESTITLE"}}}else if(this._isPhone()&&!this.getFilterMode()){switch(this._currentViewMode){case ie.PHONE_MAIN_VIEW:e="";break;case ie.PHONE_LIST_VIEW:t=this._getTabSearchAndSelectText();break;case ie.PHONE_SEARCH_VIEW:e="FILTER_BAR_ADV_FILTERS_DIALOG";break;case ie.PHONE_CONDITIONS_VIEW:if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){e="VALUEHELPDLG_SINGLECONDITION_TITLE"}else{t=this._getTabRangesText()}break;default:break}}if(!t){t=this.getTitle()}if(e){t=this._oRb.getText(e,t)}if(t){this._oTitle.setText(t);this._oFilterPanel&&this._oFilterPanel.setInnerTitle(this.getTitle())}}};se.prototype._updateTableTitle=function(){if(!this._oTable){return}var e=0;this.oRows=this._oTable.getBinding("rows");if(this.oRows){e=this.oRows.getLength()}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=U.getFloatInstance()}if(e>0&&this.oRows.isLengthFinal&&this.oRows.isLengthFinal()){this.nRowCount=this._oNumberFormatInstance.format(e);this._setTableTitle(this._sTableTitle1.replace("{0}",this.nRowCount))}else{this._setTableTitle(this._sTableTitleNoCount)}};se.prototype._getTabSearchAndSelectText=function(){var e=this._oTable;if(e){if(e.isA("sap.ui.comp.smarttable.SmartTable")){e=e.getTable()}var t=0;if(this._oSelectedItems&&this._oSelectedItems.getItems){t=this._oSelectedItems.getItems().length}if(t>0){return this._oRb.getText("VALUEHELPDLG_ITEMSTABLE_SELECT",[t])}}return this._oRb.getText("VALUEHELPDLG_ITEMSTABLE_SELECT").replace("({0})","")};se.prototype._getTabRangesText=function(){if(this._oSelectedRanges&&Object.keys(this._oSelectedRanges).length>0){var e=Object.keys(this._oSelectedRanges).length;return this._oRb.getText("VALUEHELPDLG_RANGES",[e])}return this._oRb.getText("VALUEHELPDLG_RANGES").replace("({0})","")};se.prototype._updateTabSearchAndSelectTitle=function(){var e=!this.getSupportRangesOnly();if(e){if(this._oTabBar){this._oTabBar.getItems()[0].setText(this._getTabSearchAndSelectText())}if(this._oMainListMenu&&this._oSelectItemLI){this._oSelectItemLI.setTitle(this._getTabSearchAndSelectText())}}};se.prototype._updateTabRangesTitle=function(){var e=this.getSupportRangesOnly()||this.getSupportRanges();if(e){if(this._oTabBar){this._oTabBar.getItems()[1].setText(this._getTabRangesText())}if(this._oMainListMenu&&this._oDefineConditionsLI){this._oDefineConditionsLI.setTitle(this._getTabRangesText())}}};se.prototype._setTableTitle=function(e){if(A.system.desktop&&this._oTable&&!this._oTable.isA("sap.m.Table")){if(this._oTable.getTitle()){this._oTable.getTitle().setText(e)}else{this._oTable.setTitle(e)}}else{this._oTable.addStyleClass("compValueHelpSmallMarginTop")}};se.prototype.onAfterRendering=function(){s.prototype.onAfterRendering.apply(this);this._oButtonOk.setWidth(this._oButtonCancel.$().width()+"px");if(this._oTable){this._updateTitles()}if(!this._isPhone()&&this.getContentHeight()===""){if(this.getSupportRangesOnly()&&(this.getMaxExcludeRanges()==="-1"||this.getMaxIncludeRanges()==="-1")){this.setContentHeight("70%")}else{var e=this.getDomRef("scroll");var t=e.clientHeight;this.setContentHeight(t+"px")}if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this._oTable.setVisibleRowCountMode(V.VisibleRowCountMode.Auto)}}if(this._oTabBar&&this._oTabBar.getVisible()&&this.getCustomHeader()){this.getCustomHeader().addStyleClass("compValueHelpDialogHeaderNoBoxShadow")}this._bInitTokensHaveChanged=false;this._setToolbarSpacerWidth();this._registerVHResizeHandler()};se.prototype.onsapbackspace=function(e){if(this._ignoreRemoveToken||!e.srcControl||!e.srcControl.isA("sap.m.Token")){return}var t=e.srcControl.getKey?e.srcControl.getKey():"",i=[];if((e.type==="sapbackspace"||e.type==="sapdelete")&&t){if(this._oSelectedRanges&&this._oSelectedRanges[t]){i.push(t);this._removeToken(t)}else{this._oSelectedItems.remove(t);this._removeTokenFromTokenizer(t,this._getTokenizer())}}this._removeRangeByKey(i);var s={tokenKeys:[t],useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(s);this._bIgnoreSelectionChange=false}else{s.useDefault=true}if(s.useDefault){this._changeTableRowSelectionForKey(t,false)}setTimeout(function(){var e=this._getTokenizer().getTokens();if(e){var t=e.length-1;if(t>=0){e[t].focus()}else{this._manageFocusAfterRemoveTokens()}}}.bind(this));this._updateTitles()};se.prototype.onsapdelete=se.prototype.onsapbackspace;se.prototype._getDialogOffset=function(e){var t=e||this._$Window.width();var i={small:600,large:1024};var s=function(e){var t=parseInt(window.getComputedStyle(document.body).fontSize);return e*t*2};var a=1;if(t>i.small&&t<i.large){a=2}else if(t>=i.large){a=2}return{top:s(a),left:s(a)}};se.prototype.exit=function(){s.prototype.exit.apply(this);if(typeof this._fnRejectTablePromise==="function"){this._fnRejectTablePromise()}this.removeDelegate(this._onBeforeRenderingInputEventDelegate);var e=function(e){if(e&&e.destroy){e.destroy()}return null};this._oTokenizerGrid=e(this._oTokenizerGrid);this._oRanges=e(this._oRanges);this._oFilterPanel=e(this._oFilterPanel);if(this._bTableCreatedInternal){this._oTable=e(this._oTable)}this._oTable=null;this.theTable=null;this._oNumberFormatInstance=null;this._oTabBar=e(this._oTabBar);this._oMainListMenu=e(this._oMainListMenu);this._oContentContainer=e(this._oContentContainer);this._oVarManagment=e(this._oVarManagment);this._aRangeKeyFields=e(this._aRangeKeyFields);this._aIncludeRangeOperations=e(this._aIncludeRangeOperations);this._aExcludeRangeOperations=e(this._aExcludeRangeOperations);if(this._oFilterBar){this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);this._oFilterBar=e(this._oFilterBar)}this._oRb=e(this._oRb);this._sTableTitle1=e(this._sTableTitle1);this._sTableTitle2=e(this._sTableTitle2);this._sTableTitleNoCount=e(this._sTableTitleNoCount);this._sValidationDialogTitle=e(this._sValidationDialogTitle);this._sValidationDialogMessage=e(this._sValidationDialogMessage);this._sValidationDialogFieldMessage=e(this._sValidationDialogFieldMessage);this._oSelectedItems=e(this._oSelectedItems);this._oSelectedRanges=e(this._oSelectedRanges);this._oButtonOk=e(this._oButtonOk);this._oButtonCancel=e(this._oButtonCancel);if(this._oButtonGo){this._oButtonGo=e(this._oButtonGo)}if(this._oButtonClear){this._oButtonClear=e(this._oButtonClear)}if(this._oColSearchBox){this._oColSearchBox=e(this._oColSearchBox)}};se.prototype.setRangeKeyFields=function(e){this._aRangeKeyFields=e;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(e){if(e.typeInstance&&e.typeInstance.isA("sap.ui.model.odata.type.DateTime")){var t=e.typeInstance;if(!t.oFormat){t.formatValue(new Date,"string")}if(t.oFormat){t.oFormat.oFormatOptions.UTC=false}}})}};se.prototype.getRangeKeyFields=function(){return this._aRangeKeyFields};se.prototype.setIncludeRangeOperations=function(e,t){t=t||"default";this._aIncludeRangeOperations[t]=e;if(this._oFilterPanel){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[t],t)}};se.prototype.setExcludeRangeOperations=function(e,t){t=t||"default";this._aExcludeRangeOperations[t]=e.map(function(e){return this._oOperationsHelper.getCorrespondingExcludeOperation(e)}.bind(this));if(this._oFilterPanel){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[t],t)}};se.prototype._getFormatedTokenText=function(e){var t=this._oSelectedItems.getItem(e);var i=t[this.getDescriptionKey()];var s=t[this.getKey()];if(i===undefined){if(typeof t==="string"){i=t}else{i=e}}else{i=d.getFormattedExpressionFromDisplayBehaviour(this.getTokenDisplayBehaviour()?this.getTokenDisplayBehaviour():te.descriptionAndId,s,i)}return i};se.prototype._getFormatedRangeTokenText=function(e,t,i,s,a){var o=this._getKeyFieldByKey(a);var n=t;var l=i;var r=true;if(o){if(!o.typeInstance&&H._createKeyFieldTypeInstance){H._createKeyFieldTypeInstance(o)}if(o.typeInstance){n=o.typeInstance.formatValue(t,"string",r);l=o.typeInstance.formatValue(i,"string",r)}}var h=d.getFormattedRangeText(e,n,l,s);if(this._aRangeKeyFields&&this._aRangeKeyFields.length>1&&o&&o.label&&h!==""){h=o.label+": "+h}return h};se.prototype._isPhone=function(){return A.system.phone};se.prototype._hasListeners=function(e){if(this._bTableCreatedInternal){return false}return this.hasListeners(e)};se.prototype._rotateSelectionButtonIcon=function(e){if(!A.system.phone){var t=sap.ui.getCore().byId(this.oSelectionButton.$("img")[0].id);if(e){t.addStyleClass("sapUiVHImageExpand")}else{t.removeStyleClass("sapUiVHImageExpand")}}};se.prototype._getTokenizer=function(){return this._oSelectedTokens};se.prototype._getTabSearchAndSelect=function(){var e=!this.getSupportRangesOnly();if(e){if(this._oTabBar){return this._oTabBar.getItems()[0]}if(this._oMainListMenu&&this._oSelectItemLI){return this._oSelectItemLI}}return null};se.prototype._getTabDefneConditions=function(){var e=this.getSupportRangesOnly()||this.getSupportRanges();if(e){if(this._oTabBar){return this._oTabBar.getItems()[1]}if(this._oMainListMenu&&this._oDefineConditionsLI){return this._oDefineConditionsLI}}return null};se.prototype._registerVHResizeHandler=function(){j.register(this,this._onVHResize.bind(this))};se.prototype._onVHResize=function(){this._setToolbarSpacerWidth()};se.prototype._setToolbarSpacerWidth=function(){var e,t,i;if(!this._oFilterBar){return}if(this._oFilterBar._oToolbar){t=this._oFilterBar._oToolbar.getContent();for(var s=0;s<t.length;s++){if(t[s].isA("sap.m.ToolbarSpacer")){e=t[s];break}}}if(e&&this._oFilterBar.getBasicSearch()){i=this.getDomRef()&&parseInt(this.getDomRef().style.width);if(i>=1e3){e.setWidth("6rem")}else if(i<1e3&&i>700){e.setWidth("4rem")}else{e.setWidth("0.5rem")}}};se.prototype._manageFocusAfterRemoveTokens=function(){var e,t=this._oFilterPanel?this._oFilterPanel.getConditionPanel():undefined;if(this._currentViewMode.toLowerCase().indexOf("list")>-1){this._oButtonOk.focus()}else{this._onAfterRenderingInputDelegate={onAfterRendering:function(){e.focus()}};this._onBeforeRenderingInputEventDelegate={onBeforeRendering:function(){if(e.getDomRef()){e.removeDelegate(this._onAfterRenderingInputDelegate,this)}}};e=t._oConditionsGrid.getAggregation("content")[0].value1;e.addDelegate(this._onAfterRenderingInputDelegate,this);e.addDelegate(this._onBeforeRenderingInputEventDelegate,this);e.focus()}};function oe(e,t){if(!t){t=this.getKey()}e=e.replace(/[^a-zA-Z0-9]/g,"");t=t.replace(/[^a-zA-Z0-9]/g,"");var i=t?t+"-"+e:e;if(!this._oTokenIdCount[i]){this._oTokenIdCount[i]=0}this._oTokenIdCount[i]++;return this.getId()+"-token-"+i+"_"+this._oTokenIdCount[i]}function ne(e){if(e){var t=e.getItems();return t[0].getVisible()&&t[1].getVisible()}else{return false}}return se});
//# sourceMappingURL=ValueHelpDialog.js.map