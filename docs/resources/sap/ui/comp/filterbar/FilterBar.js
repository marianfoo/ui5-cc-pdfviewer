/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/library","sap/m/Button","sap/m/Label","sap/m/Panel","sap/m/Text","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/ui/Device","sap/ui/comp/state/UIState","./VariantConverterFrom","./VariantConverterTo","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/comp/smartvariants/SmartVariantManagementUi2","sap/ui/core/InvisibleText","sap/ui/layout/Grid","sap/ui/layout/GridRenderer","sap/ui/layout/GridData","sap/ui/layout/HorizontalLayout","sap/ui/layout/VerticalLayout","sap/ui/layout/AlignedFlowLayout","sap/m/library","sap/ui/model/json/JSONModel","./FilterGroupItem","sap/base/Log","sap/base/util/merge","sap/ui/core/ShortcutHintsMixin","sap/base/util/Deferred","sap/m/delegate/ValueStateMessage","sap/m/ToolbarSeparator"],function(t,e,i,r,a,n,s,o,l,h,d,u,f,_,c,p,g,m,F,A,y,v,I,b,V,S,B,C,T){"use strict";var M=t.ValueState;var R=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SEARCH_FIELD_VALIDATION_WARNING_MESSAGE");var D=t.TextAlign;var L=y.ButtonType;var T;var E;var N;var x;var w;var O=c.extend("sap.ui.comp.filterbar.FilterBar",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/filterbar/FilterBar.designtime",properties:{persistencyKey:{type:"string",group:"Misc",defaultValue:""},advancedMode:{type:"boolean",group:"Misc",defaultValue:false},expandAdvancedArea:{type:"boolean",group:"Misc",defaultValue:false,deprecated:true},searchEnabled:{type:"boolean",group:"Misc",defaultValue:true},filterBarExpanded:{type:"boolean",group:"Misc",defaultValue:true},considerGroupTitle:{type:"boolean",group:"Misc",defaultValue:false},showClearButton:{type:"boolean",group:"Misc",defaultValue:false},showRestoreButton:{type:"boolean",group:"Misc",defaultValue:true},showGoOnFB:{type:"boolean",group:"Misc",defaultValue:true},showRestoreOnFB:{type:"boolean",group:"Misc",defaultValue:false},showClearOnFB:{type:"boolean",group:"Misc",defaultValue:false},showGoButton:{type:"boolean",group:"Misc",defaultValue:null,deprecated:true},deltaVariantMode:{type:"boolean",group:"Misc",defaultValue:true},filterContainerWidth:{type:"string",group:"Misc",defaultValue:"12rem"},useToolbar:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:""},showFilterConfiguration:{type:"boolean",group:"Misc",defaultValue:true},useSnapshot:{type:"boolean",group:"Misc"},isRunningInValueHelpDialog:{type:"boolean",group:"Misc",defaultValue:false},disableSearchMatchesPatternWarning:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{filterItems:{type:"sap.ui.comp.filterbar.FilterItem",multiple:true,singularName:"filterItem"},filterGroupItems:{type:"sap.ui.comp.filterbar.FilterGroupItem",multiple:true,singularName:"filterGroupItem"},_parameters:{type:"sap.ui.comp.filterbar.FilterGroupItem",multiple:true,singularName:"_parameter",visibility:"hidden"}},associations:{basicSearch:{type:"sap.m.SearchField",multiple:false}},events:{cancel:{},reset:{parameters:{selectionSet:{type:"sap.ui.core.Control[]"}}},search:{parameters:{selectionSet:{type:"sap.ui.core.Control[]"},firedFromFilterBar:{type:"boolean"}}},beforeVariantSave:{parameters:{context:{type:"string"}}},beforeVariantFetch:{},afterVariantLoad:{parameters:{context:{type:"string"},executeOnSelect:{type:"boolean"}}},filterChange:{added:{type:"sap.ui.core.Control"},deleted:{type:"sap.ui.core.Control"},filterItem:{type:"sap.ui.comp.filterbar.FilterGroupItem"}},clear:{parameters:{selectionSet:{type:"sap.ui.core.Control[]"}}},initialise:{},initialized:{},afterVariantSave:{},filtersDialogClosed:{parameters:{context:{type:"string"}}},filtersDialogBeforeOpen:{},filtersDialogSearch:{},filtersDialogCancel:{},filtersDialogSearchForFilters:{parameters:{newValue:{type:"string"}}},assignedFiltersChanged:{}}},renderer:{apiVersion:2}});O.INTERNAL_GROUP="__$INTERNAL$";O.prototype.init=function(){var t=this.getFilterContainerWidth();c.prototype.init.apply(this,arguments);this._filterGroupItemChange=this._filterGroupItemChange.bind(this);this._filterItemChange=this._filterItemChange.bind(this,null);this._oBasicAreaLayout=null;this._oVariantManagement=null;this._oCollectiveSearch=null;this._aBasicAreaSelection=null;this._mAdvancedAreaFilter=null;this._mAdvancedAreaFilterFlat=[];this._aOrderedFilterItems=[];this._aAdaptFilterItems=[];this._mAdvancedAreaHiddenFilters=[];this._mAdaptFiltersDialogInitialItemsOrder=[];this._fRegisteredFetchData=null;this._fRegisteredApplyData=null;this._fRegisterGetFiltersWithValues=null;this._oHideShowButton=null;this._oShowAllFiltersButton=null;this._oSearchButton=null;this._oFiltersButton=null;this._oClearButtonOnFB=null;this._oRestoreButtonOnFB=null;this._bIsInitialized=false;this._bSearchFiredFromFilterBar=false;this._bMoveTriggered=false;this._oInitializedDeferred=new B;this._aFields=null;this._oBasicSearchField=null;this._oVariant={};this._filterChangeSemaphore=true;this._triggerFilterChangeState=true;this._fRegisteredFilterChangeHandlers=null;this._fInitialiseVariants=null;this._bHostedVariantManagement=false;this._nMaxFiltersByDefault=8;this._bResetFiltersDialogTriggered=false;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.setHSpacing(0);this.addStyleClass("sapUiCompFilterBar sapUiCompFilterBarMarginBottom sapUiCompFilterBarPaddingPanel sapContrastPlus");this.addStyleClass(this._isPhone()?"sapUiCompFilterBarPhone":"sapUiCompFilterBarNonPhone");this._oToolbar=this._createToolbar();this.addContent(this._oToolbar);this._bDelayRendering=true;this._bShowAllFilters=false;this._oBasicAreaLayout=new A;this._oBasicAreaLayout.setVisible(false);this._oBasicAreaLayout.setLayoutData(new g({span:"L12 M12 S12"}));this._oBasicAreaLayout.setMinItemWidth(t);this._oBasicAreaLayout.setMaxItemWidth(t);this.addContent(this._oBasicAreaLayout);this._oAdvancedPanel=new r;this._oAdvancedPanel.setLayoutData(new g({span:"L12 M12 S12"}));this._oAdvancedPanel.setVisible(false);this.addContent(this._oAdvancedPanel);this.oModel=new v({});this.setModel(this.oModel,"FilterBar");this._oHintText=new a({text:this._oRb.getText("FILTER_BAR_NO_FILTERS_ON_FB"),textAlign:D.Center});this._oHintText.setVisible(false);this._oHintText.addStyleClass("sapUiCompFilterBarHint");if(this._isTablet()||this._isPhone()){this.setFilterBarExpanded(false)}this.getMetadata().addPublicMethods("getInitializedPromise")};O.prototype.onBeforeRendering=function(){if(c.prototype.onBeforeRendering){c.prototype.onBeforeRendering.apply(this,arguments)}if(this.getIsRunningInValueHelpDialog()){if(this._isTablet()){this.addStyleClass("compFilterBarTablet")}this.iAddedContentLength=4-this._oBasicAreaLayout.getContent().length;var t=this.iAddedContentLength;if(t<4&&t>0&&!this._bLayoutAdded){while(t>0){this._oBasicAreaLayout.addContent((new F).data("blankLayout",true));t--}this._bLayoutAdded=true}if(this._oShowAllFiltersButton===null){this.initShowAllFiltersButton()}if(this._oBasicSearchField&&this._oBasicSearchField.isA("sap.m.SearchField")){this._oBasicSearchField.setWidth("100%")}this._oBasicAreaLayout.setMaxItemWidth(null);this._oAdvancedPanel.setVisible(false);this._rerenderFilters()}else if(this._oShowAllFiltersButton){this._oBasicAreaLayout.removeEndContent(this._oShowAllFiltersButton);this._oShowAllFiltersButton=null}else{this._oHideShowButton&&this._oHideShowButton.addStyleClass("sapUiCompFilterBarPaddingRightBtn")}};O.prototype.getShowAllFiltersButton=function(){return this._oShowAllFiltersButton};O.prototype.setFilterContainerWidth=function(t){this._oBasicAreaLayout.setMinItemWidth(t);if(this.getUseToolbar()){this._oBasicAreaLayout.setMaxItemWidth(this._oBasicAreaLayout.getMinItemWidth())}else{this._setMaxItemWidth2()}this.setProperty("filterContainerWidth",t);return this};O.prototype._setMaxItemWidth2=function(){var t,e,i=this._oBasicAreaLayout.getMinItemWidth();["rem","%","px","em"].some(function(e){var r=i.indexOf(e);if(r>0){i=i.substring(0,r);t=e;return true}return false});if(t){e=parseInt(i);if(!isNaN(e)){e*=2;this._oBasicAreaLayout.setMaxItemWidth(e+t)}}};O.prototype._hasAnyVisibleFiltersOnFB=function(){var t=this._retrieveVisibleAdvancedItems();for(var e=0;e<t.length;e++){if(t[e].filterItem.getVisibleInFilterBar()){return true}}return false};O.prototype._showHintText=function(){var t=0;if(!this._oHintText){return}if(this._isNewFilterBarDesign()){return}if(!this.getAdvancedMode()&&!this._isPhone()){var e=!this._hasAnyVisibleFiltersOnFB();if(e){t=this._oAdvancedPanel.indexOfContent(this._oHintText);if(t<0){this._oAdvancedPanel.insertContent(this._oHintText,0)}}this._oHintText.setVisible(e);this._oAdvancedPanel.setVisible(e);if(!this._bDelayRendering){this._oBasicAreaLayout.setVisible(!e&&this.getFilterBarExpanded())}}};O.prototype._hasRelevantFilters=function(){var t,e=null,i;if(!this._mAdvancedAreaFilter||Object.keys(this._mAdvancedAreaFilter)<1){return false}if(this.getAdvancedMode()){for(e in this._mAdvancedAreaFilter){var r=this._mAdvancedAreaFilter[e];if(r&&r.items){for(t=0;t<r.items.length;t++){i=r.items[t];if(i){if(this._determineVisibility(i.filterItem)){return true}}}}}return false}return true};O.prototype._adaptButtonsEnablement=function(){var t=false||!!this._mAdvancedAreaFilter;if(this._oHideShowButton){this._oHideShowButton.setEnabled(t);if(this.getAdvancedMode()&&!this._isPhone()){this._oHideShowButton.setVisible(this._hasRelevantFilters())}}this._oClearButtonOnFB.setEnabled(t);this._oRestoreButtonOnFB.setEnabled(t);this._oFiltersButton.setEnabled(t);var e=true;if(this._isPhone()&&this.getUseToolbar()){e=false}if(t&&this.getFilterBarExpanded()&&e&&!this.getAdvancedMode()){this._oBasicAreaLayout.setVisible(true)}};O.prototype.getVariantManagement=function(){return this._oVariantManagement};O.prototype.setShowClearOnFB=function(t){this.setProperty("showClearOnFB",t);this._oClearButtonOnFB.setVisible(t);return this};O.prototype.setShowRestoreOnFB=function(t){this.setProperty("showRestoreOnFB",t);this._oRestoreButtonOnFB.setVisible(t);return this};O.prototype.setShowGoOnFB=function(t){this.setProperty("showGoOnFB",t);this._calcVisibilityGoButton();return this};O.prototype._calcVisibilityGoButton=function(){var t=this.getShowGoOnFB();if(t&&!this._isPhone()&&this.isLiveMode&&this.isLiveMode()){t=false}this._oSearchButton.setVisible(t)};O.prototype.setShowGoButton=function(t){this.setShowGoOnFB(t);return this};O.prototype.getShowGoButton=function(){return this.getShowGoOnFB()};O.prototype.hideGoButton=function(){this._oSearchButton.setVisible(false)};O.prototype.restoreGoButton=function(){this._oSearchButton.setVisible(this.getShowGoOnFB())};O.prototype.setShowFilterConfiguration=function(t){this.setProperty("showFilterConfiguration",t);if(this._oFiltersButton){this._oFiltersButton.setVisible(t)}return this};O.prototype.isCurrentVariantStandard=function(){var t;if(this._oVariantManagement){t=this._oVariantManagement.getCurrentVariantId();if(t===""){return true}return t===this._oVariantManagement.getStandardVariantKey()}return undefined};O.prototype.setCurrentVariantId=function(t,e){if(this._oVariantManagement){this._oVariantManagement.setCurrentVariantId(t,e)}};O.prototype.getCurrentVariantId=function(){var t="";if(this._oVariantManagement){t=this._oVariantManagement.getCurrentVariantId()}return t};O.prototype.getDataSuiteFormat=function(t){return this._getDataSuiteFormat(t,null)};O.prototype._getDataSuiteFormat=function(t,e){var i=null,r,a,n,s,o;if(this._oVariantManagement){r=this.getCurrentVariantId();if(this.getFilterDataAsString){n=this._determineVariantFiltersInfo(t,true);if(this.getFilterContextUrl){o=this.getFilterContextUrl()}if(this.getParameterContextUrl){s=this.getParameterContextUrl()}a=this.getFilterDataAsString(t);if(a){var l=new d;i=l.convert(r,n,a,this,e,s,o)}}}return i};O.prototype.getBasicSearchName=function(){var t=null;if(this._oBasicSearchField&&this.getEntitySet){t="$"+this.getEntitySet()+".basicSearch"}return t};O.prototype.getBasicSearchValue=function(){return this._getBasicSearchValue()};O.prototype.setUiStateAsVariant=function(t){var e={replace:true,strictMode:true};this.setUiState(t,e);this.fireAfterVariantLoad("SPV_VARIANT",false);this._applyVisibility(t.getSelectionVariant())};O.prototype._applyVisibility=function(t){var e=function(t){if(t&&t.getVisible()&&!t.getHiddenFilter()){if(!t.getVisibleInFilterBar()){t.setVisibleInFilterBar(true)}if(!t.getPartOfCurrentVariant()){t.setPartOfCurrentVariant(true)}}};if(this._bIsInitialized){for(var i in this._mAdvancedAreaFilter){if(i){this._mAdvancedAreaFilter[i].items.forEach(function(t){if(t&&t.filterItem&&t.filterItem.getMandatory()){e(t.filterItem)}else if(t&&t.filterItem){if(t.filterItem.getVisibleInFilterBar()){t.filterItem.setVisibleInFilterBar(false)}if(t.filterItem.getPartOfCurrentVariant()){if(i===O.INTERNAL_GROUP){t.filterItem.setPartOfCurrentVariant(true)}else{t.filterItem.setPartOfCurrentVariant(false)}}}})}}if(t&&t.Parameters){t.Parameters.forEach(function(t){var i=this.determineFilterItemByName(t.PropertyName);e(i)}.bind(this))}if(t&&t.SelectOptions){t.SelectOptions.forEach(function(t){var i=this.determineFilterItemByName(t.PropertyName);e(i)}.bind(this))}}};O.prototype.getUiState=function(t){var e,i,r=false,a=null,n,s;if(t){r=t.allFilters===true}i=this._getDataSuiteFormat(r,"13.0");e=new l;e.selectionVariant=JSON.parse(i);e.setSelectionVariant(e.selectionVariant);var o=e.getSelectionVariant();if(o){if(this.getModelData&&this.getModelData()){a=this.getModelData()}s=l.calcSemanticDates(o,a);e.setSemanticDates(s);n=l.calculateValueTexts(o,a);e.setValueTexts(n);window.sessionStorage.setItem(this.getId(),JSON.stringify(n));window.sessionStorage.setItem("semanticDates",JSON.stringify(s))}return e};O.prototype.setUiState=function(t,e){var i,r,a=null,n=false,s=true,o;if(e&&typeof e.replace==="boolean"){n=e.replace}if(e&&typeof e.strictMode==="boolean"){s=e.strictMode}if(t){a=t.getSelectionVariant();if(a){r=JSON.stringify(a)}i=t.getValueTexts();o=t.getSemanticDates()}if(!i){i=JSON.parse(window.sessionStorage.getItem(this.getId()))}if(!o){o=JSON.parse(window.sessionStorage.getItem("semanticDates"))}this._setDataSuiteFormat(r,n,s,i,o);this._enhanceFilterItemsWithTextValue(i,a)};O.prototype.getDescriptionForKeys=function(t){};O.prototype._enhanceFilterItemsWithTextValue=function(t,e){var i=l.determineFiltersWithOnlyKeyValues(t,e,[this.getBasicSearchName()]);this.getDescriptionForKeys(i)};O.prototype.setDataSuiteFormat=function(t,e){this._setDataSuiteFormat(t,e,true)};O.prototype._setDataSuiteFormat=function(t,e,i,r,a){var n,s,o;if(t){n=new h;s=n.convert(t,this,i);if(s){this._clearErrorState();if(s.variantId&&this._oVariantManagement){if(this._bIsInitialized){if(this._oVariantManagement.isPageVariant()){this._oVariantManagement._selectVariant(s.variantId,"DATA_SUITE")}else{this._setFilterVisibility(s.variantId)}}this._oVariantManagement.setInitialSelectionKey(s.variantId)}if(s.payload&&(e||Object.keys(JSON.parse(s.payload)).length>0)&&this.setFilterDataAsString){o=s.payload;if(r){o=l.enrichWithValueTexts(o,r)}if(a){o=l.enrichWithSemanticDates(o,a)}this.setFilterDataAsString(o,e)}if(s.basicSearch&&this._oBasicSearchField&&this._oBasicSearchField.setValue){this._oBasicSearchField.setValue(""||s.basicSearch);this._updateToolbarText()}}}};O.prototype._setFilterVisibility=function(t){if(this._oVariantManagement.getSelectionKey()!==t){this._oVariantManagement.setInitialSelectionKey(t);var e=this._getStandardVariant();if(e){var i=this._oVariantManagement.getVariantContent(this,t);if(i&&i.filterbar){if(i.hasOwnProperty("version")){i=this.mergeVariant(e,i)}this._reapplyVisibility(i.filterbar)}}}};O.prototype.applySettings=function(t){if(this._possibleToChangeVariantManagement()){if(t&&t.customData){for(var e=0;e<t.customData.length;e++){var i=t.customData[e];if(i&&i.mProperties&&i.mProperties.key==="pageVariantPersistencyKey"){this._oVariantManagement.setPersistencyKey(i.mProperties.value);this._oVariantManagement.setVisible(true);this._bHostedVariantManagement=true}}}}if(t&&t.persistencyKey){this._bHostedVariantManagement=true}c.prototype.applySettings.apply(this,arguments);if(!this.getUseToolbar()&&!this.getFilterBarExpanded()){this.setFilterBarExpanded(true)}this._afterVariantsLoad()};O.prototype.setPersistencyKey=function(t){this.setProperty("persistencyKey",t);if(this._possibleToChangeVariantManagement()){this._oVariantManagement.setVisible(true)}return this};O.prototype._possibleToChangeVariantManagement=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){return true}return false};O.prototype.clearVariantSelection=function(){if(this._oVariantManagement){this._oVariantManagement.clearVariantSelection()}};O.prototype.setSearchEnabled=function(t){this.setProperty("searchEnabled",t);if(this._oSearchButton){this._oSearchButton.setEnabled(t)}return this};O.prototype.setSearchButtonEmphType=function(t){};O.prototype.setSimplifiedMode=function(t){};O.prototype.getSimplifiedMode=function(){if(this.getAdvancedMode()){return false}return true};O.prototype.setExpandAdvancedArea=function(t){this.setFilterBarExpanded(t);return this};O.prototype.getExpandAdvancedArea=function(){return this.getFilterBarExpanded()};O.prototype.setAdvancedMode=function(t){this.setProperty("advancedMode",t);this.toggleStyleClass("sapContrastPlus",!t);if(t){if(!this._oAdvancedAreaForm){this._oAdvancedAreaForm=this._createAdvancedAreaForm()}if(this._possibleToChangeVariantManagement()){this._oVariantManagement.setVisible(false)}if(this._oToolbar){this._oToolbar.addStyleClass("sapUiCompFilterBarToolbarBasicSearchNoVariant");if(this._oBasicSearchField){if(this._oToolbar.indexOfContent(this._oBasicSearchField)<0){this._oToolbar.insertContent(this._oBasicSearchField,1)}}}}else{if(this.getPersistencyKey()&&this._possibleToChangeVariantManagement()){if(this._oVariantManagement){this._oVariantManagement.setVisible(true)}if(this._oToolbar){this._oToolbar.removeStyleClass("sapUiCompFilterBarToolbarBasicSearchNoVariant")}}}this._oFiltersButton.setVisible(!t);if(this._oHideShowButton){this._oHideShowButton.setVisible(t&&this._isPhone()?false:true);if(this._oHideShowButton.getVisible()){if(this.getFilterBarExpanded()){this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_VH_HIDE_FILTERS"))}else{this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_VH_SHOW_FILTERS"))}}}if(!this._bDelayRendering){this._oBasicAreaLayout.setVisible(!t&&this.getFilterBarExpanded())}this._oAdvancedPanel.setVisible(t&&this.getFilterBarExpanded());this._adaptButtonsEnablement();return this};O.prototype.setUseToolbar=function(t){this.setProperty("useToolbar",t);if(!t){this._adaptNewFilterBarDesign()}else{this._recreateToolbar()}return this};O.prototype._recreateToolbar=function(){if(!this._oToolbar){this._bButtonaAdded=false;if(this._oButtonsVLayout){this._oBasicAreaLayout.removeContent(this._oButtonsVLayout);this._oButtonsVLayout.destroy();this._oButtonsVLayout=null}this._oToolbar=this._createToolbar(true);this.insertContent(this._oToolbar,0);if(this._oVariantManagement){if(this._oVariantManagement instanceof f||this._oVariantManagement.getId()===this.getId()+"-variant"){this._oToolbar.insertContent(this._oVariantManagement,0)}}this._adaptButtonsEnablement();if(this._oBasicSearchFieldContainer){this._oBasicAreaLayout.removeContent(this._oBasicSearchFieldContainer);this._cleanBasicSearchContainer();this.setBasicSearch(this._oBasicSearchField)}this._oHintText=new a({text:this._oRb.getText("FILTER_BAR_NO_FILTERS_ON_FB"),textAlign:D.Center});this._oHintText.setVisible(false);this._oHintText.addStyleClass("sapUiCompFilterBarHint");this._oBasicAreaLayout.addContent(this._oHintText);this._oBasicAreaLayout.setMaxItemWidth(this._oBasicAreaLayout.getMinItemWidth());this._updateToolbarText()}};O.prototype._cleanBasicSearchContainer=function(){if(this._oBasicSearchFieldContainer){var t=this._oBasicSearchFieldContainer.removeAllContent();if(t){for(var e=0;e<t.length;e++){if(t[e]!==this._oBasicSearchField){t[e].destroy()}}}this._oBasicSearchFieldContainer.destroy();this._oBasicSearchFieldContainer=null}};O.prototype.setHeader=function(t){this.setProperty("header",t);if(this.getUseToolbar()){this._addHeaderToToolbar(t)}return this};O.prototype._addHeaderToToolbar=function(t){if(this._oToolbar){if(t){if(this._oVariantManagement&&(this._oVariantManagement.getVisible()||this._bHostedVariantManagement)&&this._oToolbar.indexOfContent(this._oVariantManagement)>-1){if(!this._oSeparator){if(!T&&!this._bToolbarSeparatorRequested){T=sap.ui.require("sap/m/ToolbarSeparator");if(!T){sap.ui.require(["sap/m/ToolbarSeparator"],P.bind(this));this._bToolbarSeparatorRequested=true}}if(T){this._oSeparator=new T(this.getId()+"-HeadSep")}}this._oToolbar.removeContent(this._oSeparator);this._oToolbar.insertContent(this._oSeparator,0);this._oToolbar.setHeight("3rem")}if(!this._oText){this._oText=new a(this.getId()+"-HeadText");this._oText.addStyleClass("sapMH4Style");this._oText.addStyleClass("sapUiCompSmartChartHeader")}this._oText.setText(t);this._oToolbar.removeContent(this._oText);this._oToolbar.insertContent(this._oText,0)}else{if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator);this._oSeparator.destroy();delete this._oSeparator;this._oToolbar.setHeight()}if(this._oText){this._oToolbar.removeContent(this._oText);this._oText.destroy();delete this._oText}}}};function P(t){T=t;this._bToolbarSeparatorRequested=false;if(!this._bIsBeingDestroyed){this._addHeaderToToolbar(this.getHeader())}}O.prototype._isNewFilterBarDesign=function(){if(this.getAdvancedMode()){return false}if(!this.getUseToolbar()){return true}return false};O.prototype._adaptNewFilterBarDesign=function(){if(this._isNewFilterBarDesign()){this.setFilterBarExpanded(true);if(!this._bDelayRendering){this._oBasicAreaLayout.setVisible(true&&this.getFilterBarExpanded())}if(this._oToolbar){var t=this._oToolbar.getContent();for(var e=0;e<t.length;e++){this._oToolbar.removeContent(t[e]);if(t[e].isA("sap.m.ToolbarSpacer")){t[e].destroy()}}if(!this.getUseToolbar()){this.removeContent(this._oToolbar);this._oToolbar.destroy();this._oToolbar=null}}if(this._oHintText){this._oBasicAreaLayout.removeContent(this._oHintText);this._oHintText.destroy();this._oHintText=null}if(this._oHideShowButton){this._oHideShowButton.destroy();this._oHideShowButton=null}if(!this._bButtonaAdded){this._bButtonaAdded=true;this._addButtonsToBasicArea()}if(this._oBasicSearchField){this.setBasicSearch(this._oBasicSearchField)}this._oBasicAreaLayout.setMinItemWidth(this.getFilterContainerWidth());this._setMaxItemWidth2()}};O.prototype._addButtonsToBasicArea=function(){var t=new F;if(sap.ui.getCore().getConfiguration().getRTL()){t.addStyleClass("sapUiCompFilterBarFloatLeft")}else{t.addStyleClass("sapUiCompFilterBarFloatRight")}var e=new m;t.addContent(new a);t.addContent(e);e.addContent(this._oSearchButton);e.addContent(this._oClearButtonOnFB);e.addContent(this._oRestoreButtonOnFB);e.addContent(this._oFiltersButton);this._updateToolbarText();this._oBasicAreaLayout.addEndContent(t);this._oButtonsVLayout=t};O.prototype._addBasicSearchToBasicArea=function(t){if(this._oBasicSearchFieldContainer){this._cleanBasicSearchContainer()}if(t){var e=new i({text:" "});e.addStyleClass("sapBasicSearchFilter");var r=this._addControlToBasicAreaContainer(null,t,e);if(r){r.setVisible(true);this._oBasicAreaLayout.insertContent(r,0);this._oBasicSearchFieldContainer=r;this._oBasicSearchFieldContainer.setWidth("100%")}}};O.prototype._setCollectiveSearch=function(t){if(this.getAdvancedMode()){if(this._oToolbar){if(this._oVariantManagement){this._oToolbar.removeContent(this._oVariantManagement);this._unregisterVariantManagement(this._oVariantManagement);this._oVariantManagement=null}if(this._oCollectiveSearch){this._oToolbar.removeContent(this._oCollectiveSearch)}this._oCollectiveSearch=t;this._oToolbar.insertContent(this._oCollectiveSearch,0);this._oToolbar.removeStyleClass("sapUiCompFilterBarToolbarBasicSearchNoVariant")}}};O.prototype.setBasicSearch=function(t){var e=this;this.setAssociation("basicSearch",t,true);if(typeof t==="string"){t=sap.ui.getCore().byId(t)}if(t&&t.getParent()){if(this._isUi2Mode()){t.attachLiveChange(function(t){e.fireFilterChange(t)})}this._oBasicSearchField=t;return}if(this._oBasicSearchField&&this._oToolbar){this._oToolbar.removeContent(this._oBasicSearchField)}if(t&&this._isNewFilterBarDesign()){this._addBasicSearchToBasicArea(t)}else{if(t&&this._oToolbar&&(!this._isPhone()||this.getAdvancedMode())){var i=this._indexOfSpacerOnToolbar();this._oToolbar.insertContent(t,i);if(this._isUi2Mode()){t.attachLiveChange(function(t){e.fireFilterChange(t)})}}}this._oBasicSearchField=t;return this};O.prototype._getBasicSearchValue=function(){if(this._oBasicSearchField&&this._oBasicSearchField.getValue){return this._oBasicSearchField.getValue()}return null};O.prototype._indexOfSpacerOnToolbar=function(){var t=this._oToolbar.getContent(),e;if(t){for(e=0;e<t.length;e++){if(t[e]instanceof s){return e}}}return 0};O.prototype.addFilterItem=function(t){var e,i,r,a;if(!t){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterItem()"+" Expected argument 'oFilterItem' may not be null nor empty")}e=t.getName();if(!e){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterItem()"+" Expected argument 'oFilterItem.name' may not be null nor empty")}i=t._getControl();if(!i){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterItem()"+" Expected argument 'oFilterItem.control' may not be null nor empty")}this.addAggregation("filterItems",t,true);if(!this._aBasicAreaSelection){this._aBasicAreaSelection=[]}var n={control:t._getControl(),filterItem:t};this._aBasicAreaSelection.push(n);a=t.getId()+"__filterGroupItem";r=sap.ui.getCore().byId(a);if(!r){r=new I(t.getId()+"__filterGroupItem",{label:t.getLabel(),controlTooltip:t.getControlTooltip(),name:t.getName(),mandatory:t.getMandatory(),visible:t.getVisible(),visibleInFilterBar:t.getVisibleInFilterBar(),partOfCurrentVariant:true,control:t._getControl(),groupName:O.INTERNAL_GROUP,groupTitle:"",hiddenFilter:t.getHiddenFilter(),entitySetName:t.getEntitySetName(),entityTypeName:t.getEntityTypeName()})}if(t.data("isCustomField")){r.data("isCustomField",true)}t.attachChange(this._filterItemChange);this.addFilterGroupItem(r);return this};O.prototype.addFilterGroupItem=function(t){var e,i,r,a;if(!t){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterGroupItem()"+" Expected argument 'oFilterGroupItem' may not be null nor empty")}this.addAggregation("filterGroupItems",t,true);i=t.getGroupName();if(!i){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterGroupItems()"+" GroupName may not be null nor empty")}e=t.getName();if(!e){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterGroupItems()"+" Name may not be null nor empty")}if(!this._mAdvancedAreaFilter){this._mAdvancedAreaFilter={}}if(!this._mAdvancedAreaFilter[i]){this._mAdvancedAreaFilter[i]={};this._mAdvancedAreaFilter[i].filterItem=null;this._mAdvancedAreaFilter[i].items=[]}if(!this._mAdvancedAreaFilter[i].items){this._mAdvancedAreaFilter[i].items=[]}if(!this._mAdvancedAreaFilter[i].filterItem){this._mAdvancedAreaFilter[i].filterItem=t}r={control:t._getControl(),filterItem:t};if(this.getAdvancedMode()||t.getVisibleInFilterBar()){t.setVisibleInFilterBar(true)}else{t.setVisibleInFilterBar(false)}this._mAdvancedAreaFilter[i].items.push(r);if(!t.getHiddenFilter()){a=this._addControlToBasicAreaFormContainer(t);if(a){r.container=a;a.setVisible(t.getVisible()&&t.getVisibleInFilterBar());if(t.getVisibleInFilterBar()){t.setPartOfCurrentVariant(t.getVisibleInFilterBar())}t.attachChange(this._filterGroupItemChange)}if(this.getAdvancedMode()&&!this.getIsRunningInValueHelpDialog()){this._rerenderAA()}else{this._showHintText()}}this._adaptButtonsEnablement();return this};O.prototype.removeFilterItem=function(t){var e,i,r,a,n=this.getFilterItems(),s=this.getFilterGroupItems();if(!n||!n.length){return null}i=this._getRemovedItemAsObject(t,n);if(!i){return null}i.detachChange(this._filterItemChange);for(e=0;e<this._aBasicAreaSelection.length;e++){if(this._aBasicAreaSelection[e].filterItem.getId()===i.getId()){this._aBasicAreaSelection.splice(e,1);if(this._aBasicAreaSelection.length===0){this._aBasicAreaSelection=null}break}}this.removeAggregation("filterItems",i,true);r=i.getId()+"__filterGroupItem";a=this._getRemovedItemAsObject(r,s);this._removeFilterGroupItem(a);return i};O.prototype.removeFilterGroupItem=function(t){var e,i=this.getFilterGroupItems();if(!i||!i.length){return null}e=this._getRemovedItemAsObject(t,i);if(!e){return null}return this._removeFilterGroupItem(e)};O.prototype._getRemovedItemAsObject=function(t,e){var i,r;if(typeof t==="string"){for(i=0;i<e.length;i++){if(e[i].getId()===t){r=e[i];break}}}if(typeof t==="number"){if(t<0||t>=e.length){b.warning("sap.ui.comp.filterbar.FilterBar.prototype.removeFilterGroupItems() is called with invalid index "+t)}else{r=e[t]}}if(typeof t==="object"){r=t}return r};O.prototype._removeFilterGroupItem=function(t){var e,i,r,a=t.getGroupName();t.detachChange(this._filterGroupItemChange);this.removeAggregation("filterGroupItems",t,true);if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[a]&&this._mAdvancedAreaFilter[a].items){i=this._mAdvancedAreaFilter[a];for(e=0;e<i.items.length;e++){r=i.items[e];if(r.filterItem.getId()===t.getId()){r.container.removeAllContent();r.container.destroy();i.items.splice(e,1);if(i.filterItem.getId()===t.getId()){if(i.items.length){i.filterItem=i.items[0].filterItem}else{delete this._mAdvancedAreaFilter[a]}}break}}if(this.getFilterGroupItems().length===0){this._mAdvancedAreaFilter=null;this._adaptButtonsEnablement()}}return t};O.prototype._addParameter=function(t){var e,i,r,a=false,n=false,s=O.INTERNAL_GROUP;t._setParameter(true);t.setVisibleInFilterBar(true);t.setPartOfCurrentVariant(true);this.addAggregation("_parameters",t,true);i={control:t._getControl(),filterItem:t};if(!this._mAdvancedAreaFilter){this._mAdvancedAreaFilter={}}if(!this._mAdvancedAreaFilter[s]){this._mAdvancedAreaFilter[s]={};this._mAdvancedAreaFilter[s].filterItem=null}if(!this._mAdvancedAreaFilter[s].items){this._mAdvancedAreaFilter[s].items=[]}for(e=0;e<this._mAdvancedAreaFilter[s].items.length;e++){var o=this._mAdvancedAreaFilter[s].items[e];if(o.filterItem._isParameter()){continue}this._mAdvancedAreaFilter[s].items.splice(e,0,i);a=true;break}if(!a){this._mAdvancedAreaFilter[s].items.push(i);if(Object.keys(this._mAdvancedAreaFilter).length>1){n=true}}r=this._addControlToBasicAreaFormContainer(t);if(r){i.container=r;r.setVisible(t.getVisible());t.attachChange(this._filterGroupItemChange.bind(this))}if(a||n){this._oBasicAreaLayout.removeContent(r);if(t.getVisible()){this._addContainerInOrder(i.filterItem,i.container)}}if(!this.getAdvancedMode()){this._showHintText()}this._adaptButtonsEnablement();return this};O.prototype._filterItemChange=function(t,e){var i,r,a,n;if(e&&e.oSource&&e.oSource.isA("sap.ui.comp.filterbar.FilterItem")){a=e.getParameter("propertyName");if(a==="visibleInFilterBar"||a==="visible"||a==="label"||a==="labelTooltip"||a==="controlTooltip"||a==="mandatory"){i=this._determineItemByName(e.oSource.getName(),O.INTERNAL_GROUP);if(i&&i.filterItem){if(a==="visible"){r=e.oSource.getVisible();i.filterItem.setVisible(r)}else if(a==="visibleInFilterBar"){r=e.oSource.getVisibleInFilterBar();var s=this._checkChangePossibleVisibleInFilterBar(i.filterItem,r);if(s){i.filterItem.setVisibleInFilterBar(r)}else{e.oSource.setVisibleInFilterBar(true)}}else if(a==="label"){i.filterItem.setLabel(e.oSource.getLabel())}else if(a==="labelTooltip"){i.filterItem.setLabelTooltip(e.oSource.getLabelTooltip())}else if(a==="controlTooltip"){n=this.determineControlByFilterItem(i.filterItem,true);if(n&&n.setTooltip){n.setTooltip(i.filterItem.getControlTooltip())}}else if(a==="mandatory"){r=e.oSource.getMandatory();i.filterItem.setMandatory(r)}}}}};O.prototype._filterGroupItemChange=function(t){var e;var i;if(t&&t.oSource){i=t.getParameter("propertyName");if(i==="visibleInFilterBar"||i==="visible"){e=this._determineItemByName(t.oSource.getName(),t.oSource.getGroupName());if(e){if(i==="visibleInFilterBar"){var r=t.oSource.getVisibleInFilterBar();var a=r;var n=this._checkChangePossibleVisibleInFilterBar(t.oSource,r);if(!n){t.oSource.setVisibleInFilterBar(true);a=true}if(a){t.oSource.setPartOfCurrentVariant(true)}if(!r&&!this._isFilterItemInBasicGroup(e.filterItem)){t.oSource.setPartOfCurrentVariant(false)}if(!this.getAdvancedMode()&&!this._oAdaptFiltersDialog){this._rerenderItem(e)}}else if(i==="visible"){if(!this._oAdaptFiltersDialog){if(this.getAdvancedMode()&&e.container){e.container.setVisible(true)}else{this._updateToolbarText();this._rerenderItem(e)}}}this._showHintText()}}else if(i==="groupTitle"){if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[t.oSource.getGroupName()]){this._adaptGroupTitle(t.oSource.getGroupName())}}else if(i==="label"){if(!this._oAdaptFiltersDialog){this._adaptGroupTitleForFilter(t.oSource)}}else if(i==="mandatory"){this._mandatoryFilterItemChange(t.oSource)}else if(i==="partOfCurrentVariant"&&this.ensureLoadedValueHelpList){var s=this.determineFilterItemByName(t.oSource.getName());if(s&&s.getPartOfCurrentVariant()){this.ensureLoadedValueHelpList(t.oSource.getName())}}if(this.getAdvancedMode()&&!this.getIsRunningInValueHelpDialog()){this._rerenderAA()}}};O.prototype._addContainer=function(t){if(t&&this._oBasicAreaLayout){if(t.container&&this._oBasicAreaLayout.indexOfContent(t.container)===-1){this._addContainerInOrder(t.filterItem,t.container)}}};O.prototype._removeContainer=function(t){if(t&&this._oBasicAreaLayout){if(t.container&&this._oBasicAreaLayout.indexOfContent(t.container)>-1){this._oBasicAreaLayout.removeContent(t.container)}}};O.prototype._addContainerInOrder=function(t,e){var i,r,a,n=this._oBasicAreaLayout.getContent(),s=-1;if(this._oBasicSearchField&&this._isNewFilterBarDesign()){s++}if(this._mAdvancedAreaFilter){for(i in this._mAdvancedAreaFilter){var o=this._mAdvancedAreaFilter[i];if(o&&o.items){for(r=0;r<o.items.length;r++){if(!o.items[r].container){continue}if(o.items[r].container===e){this._oBasicAreaLayout.insertContent(e,s+1);return}a=n.indexOf(o.items[r].container);if(a>=0){s=a}}}}}};O.prototype._checkChangePossibleVisibleInFilterBar=function(t,e){if(t&&t.getMandatory()&&!e){var i=this._hasFilterValue(t);if(!i){t.setVisibleInFilterBar(true);return false}}return true};O.prototype._hasFilterValue=function(t){var e;if(!this._getTriggerFilterChangeState()&&this.getAllFiltersWithValues){e=this.getAllFiltersWithValues()}else{e=this._getFiltersWithValues()}return this._checkFilterForValue(e,t)};O.prototype._adaptGroupTitleForFilter=function(t){var e;var i;if(t&&!t.getHiddenFilter()){e=t.getLabel();i=t.getLabelControl(this.getId());if(this.getConsiderGroupTitle()){if(i&&t.getGroupTitle()){i.setText(e+" ("+t.getGroupTitle()+")")}}else{i.setText(e)}}};O.prototype._adaptGroupTitle=function(t){var e;var i;if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[t]&&this._mAdvancedAreaFilter[t].items){for(e=0;e<this._mAdvancedAreaFilter[t].items.length;e++){i=this._mAdvancedAreaFilter[t].items[e];if(i&&i){this._adaptGroupTitleForFilter(i.filterItem)}}}};O.prototype.registerGetFiltersWithValues=function(t){this._fRegisterGetFiltersWithValues=t;return this};O.prototype.registerFetchData=function(t){this._fRegisteredFetchData=t;return this};O.prototype.registerApplyData=function(t){this._fRegisteredApplyData=t;return this};O.prototype._isTINAFScenario=function(){if(this._oVariantManagement){if(!this._isUi2Mode()){return true}}else{if(this._oCollectiveSearch&&this.getAdvancedMode()){return true}}return false};O.prototype.fireInitialise=function(){if(this._isTINAFScenario()){this._createVisibleFilters();if(this.getAdvancedMode()){this._ensureFilterLoaded(null)}this._fireInitialiseEvent()}else{this._initializeVariantManagement()}if(this.getIsRunningInValueHelpDialog()){this._rerenderFilters()}};O.prototype.variantsInitialized=function(){this._afterVariantsLoad();this.fireInitialized();this._oInitializedDeferred.resolve()};O.prototype.fireInitialized=function(){this.fireEvent("initialized");this._mAdvancedAreaFilterFlat=this._getAllFilterItemsFlat();this._oInitializedDeferred.resolve()};O.prototype.getInitializedPromise=function(){return this._oInitializedDeferred.promise};O.prototype._initializeVariantManagement=function(){this._createVisibleFilters();if(this._oVariantManagement&&this.getPersistencyKey()){if(this._isTINAFScenario()){this._oVariantManagement.initialise(this._initialiseVariants,this)}else{this._fInitialiseVariants=this._initialiseVariants.bind(this);this._oVariantManagement.attachInitialise(this._fInitialiseVariants,this);this._oVariantManagement.initialise()}}else{this._fireInitialiseEvent()}};O.prototype._fireInitialiseEvent=function(){try{this.fireEvent("initialise");this._showHintText()}catch(t){b.error("error during initialise event handling - "+t.message)}this._bIsInitialized=true;this._updateToolbarText()};O.prototype._initialiseVariants=function(){this._fireInitialiseEvent();if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(false)}};O.prototype.fireAfterVariantLoad=function(t,e){this._rerenderFilters();this._aAdaptFilterItems=[];var i={context:t,executeOnSelect:e};try{this.fireEvent("afterVariantLoad",i)}catch(t){b.error("error during 'afterVariantLoad' event handling - "+t.message)}};O.prototype.fireBeforeVariantSave=function(t){var e={context:t};var i=this._getConsiderFilterChanges();if(t){this._setConsiderFilterChanges(false)}this.fireEvent("beforeVariantSave",e);if(t){this._setConsiderFilterChanges(i)}};O.prototype.destroyFilterGroupItems=function(){var t=this.getFilterGroupItems();this._destroyItems(t);return this};O.prototype.destroyFilterItems=function(){var t=this.getFilterItems();this._destroyItems(t);return this};O.prototype.removeAllFilterItems=function(){var t,e=this.getFilterItems();if(e&&e.length){for(t=0;t<e.length;t++){this.removeFilterItem(e[t])}}return e};O.prototype.removeAllFilterGroupItems=function(){var t,e=[],i=this.getFilterGroupItems();if(i&&i.length){for(t=0;t<i.length;t++){e.push(i[t]);this.removeFilterGroupItem(i[t])}}return e};O.prototype.removeAllFilters=function(){this.removeAllFilterItems();this.removeAllFilterGroupItems();this.removeBasicSearch()};O.prototype.removeBasicSearch=function(){this.setBasicSearch(null)};O.prototype.getAllFilterItems=function(t){var e,i=null;var r=[];var a,n;if(!t){this._ensureFilterLoaded(null)}if(this._mAdvancedAreaFilter){for(i in this._mAdvancedAreaFilter){if(i){a=this._mAdvancedAreaFilter[i];if(a.items){for(e=0;e<a.items.length;e++){n=a.items[e];if(n&&n.filterItem&&n.filterItem.getVisible()){if(t){if(n.filterItem.getVisibleInFilterBar()||this._checkIfFilterHasValue(n.filterItem.getName())||n.filterItem.data("isCustomField")&&this._checkIfCustomControlFilterHasValue(n)){r.push(n.filterItem)}}else{r.push(n.filterItem)}}}}}}}return r};O.prototype._checkIfFilterHasValue=function(t){return false};O.prototype._checkIfCustomControlFilterHasValue=function(t){return false};O.prototype._clearErrorState=function(){this._resetFiltersInErrorValueState()};O.prototype.getAggregation=function(t){if(t=="filterGroupItems"&&!this.__bDeleteMode){this._ensureFilterLoaded(null)}return c.prototype.getAggregation.apply(this,arguments)};O.prototype._getFilterInformation=function(){return[]};O.prototype._createVisibleFilters=function(){this._getFilters()};O.prototype._getFilters=function(){var t=[],e=this._oFilterProvider&&this._oFilterProvider.getModel()&&this._oFilterProvider.getModel().getData();if(e){t=Object.keys(e).filter(function(t){return this._checkIfFilterHasValue(t)}.bind(this))}this._aFields=this._getFilterInformation();var i,r;if(this._aFields&&this._aFields.length>0){if(!this._mAdvancedAreaFilter){this._mAdvancedAreaFilter={};if(!this.getAdvancedMode()){this._mAdvancedAreaFilter[O.INTERNAL_GROUP]={};this._mAdvancedAreaFilter[O.INTERNAL_GROUP].filterItem=null;this._mAdvancedAreaFilter[O.INTERNAL_GROUP].items=null}}for(i=0;i<this._aFields.length;i++){r=this._aFields[i];if(r.groupName!==O.INTERNAL_GROUP){if(!this._mAdvancedAreaFilter[r.groupName]){this._mAdvancedAreaFilter[r.groupName]={};this._mAdvancedAreaFilter[r.groupName].groupTitle=r.groupTitle;this._mAdvancedAreaFilter[r.groupName].filterItem=null;this._mAdvancedAreaFilter[r.groupName].items=[]}}if(r.visibleInAdvancedArea||r.groupName===O.INTERNAL_GROUP||t.includes(r.name)){this._instanciateFilterItem(r)}}}this._adaptButtonsEnablement()};O.prototype.isVisibleInFilterBarByName=function(t){var e,i=this._getFilterMetadata(t);if(i&&i.factory){if(i.hasOwnProperty("visibleInAdvancedArea")&&i.visibleInAdvancedArea||i.groupName===O.INTERNAL_GROUP){return true}}else{e=this.determineFilterItemByName(t);if(e){return e.getVisibleInFilterBar()}}return false};O.prototype._getFilterMetadata=function(t){if(this._aFields){for(var e=0;e<this._aFields.length;e++){if(this._aFields[e].fieldName===t){return this._aFields[e]}}}return null};O.prototype.getNonVisibleCustomFilterNames=function(){if(this._aFields.length>0){return this._getLazyNonVisibleCustomFilterNames()}else{return this._getNonVisibleCustomFilterNames()}};O.prototype._getLazyNonVisibleCustomFilterNames=function(){var t=this,e=[];this._aFields.forEach(function(i){if(i.factory){if(i.isCustomFilterField&&!i.visibleInAdvancedArea){e.push(i.fieldName)}}else if(t._isNonVisibleCustomFilterNamesByName(i.fieldName,i.groupName)){e.push(i.fieldName)}});return e};O.prototype._isNonVisibleCustomFilterNamesByName=function(t,e){var i,r;if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[e]&&this._mAdvancedAreaFilter[e].items){for(i=0;i<this._mAdvancedAreaFilter[e].items.length;i++){r=this._mAdvancedAreaFilter[e].items[i];if(r.filterName&&r.filterItem.getName()===t){return this._isNonVisibleCustomFilterNamesByFilter(r.filterItem)}}}return false};O.prototype._isNonVisibleCustomFilterNamesByFilter=function(t){if(t.data("isCustomField")&&!t.getVisibleInFilterBar()){return true}return false};O.prototype._getNonVisibleCustomFilterNames=function(){var t=this,e=[],i=this.getAllFilterItems();if(i){i.forEach(function(i){if(t._isNonVisibleCustomFilterNamesByFilter(i)){e.push(i.getName())}})}return e};O.prototype._ensureFilterLoaded=function(t){var e,i,r;if(this._aFields&&this._aFields.length>0){for(i=0;i<this._aFields.length;i++){r=this._aFields[i];if(!r.factory){continue}if(t){for(e=0;e<t.length;e++){if(r.fieldName===t[e].name){if(r.groupName===t[e].group){this._instanciateFilterItem(r);break}else if(r.groupEntityType===t[e].group){this._instanciateFilterItem(r)}}}}else{this._instanciateFilterItem(r)}}if(!t){this._aFields=[]}}};O.prototype._instanciateFilterItem=function(t){var e=t.factory;if(e){delete t.factory;e.call(t)}};O.prototype._destroyItems=function(t){if(t&&t.length){for(var e=0;e<t.length;e++){t[e].destroy()}}};O.prototype._reapplyVisibility=function(t,e){var i,r=null;var a;var n=[];if(this._mAdvancedAreaFilter){for(r in this._mAdvancedAreaFilter){if(r){var s=this._mAdvancedAreaFilter[r];if(s&&s.items){for(i=0;i<s.items.length;i++){a=s.items[i];if(a&&a.filterItem){this._setPersVisibility(t,a.filterItem,n,e)}}}}}}return n};O.prototype._setPersVisibility=function(t,e,i,r){var a,n;if(e&&!e.getHiddenFilter()){a=e.getGroupName();n=this._checkForFilterInfo(t,e);if(this._isTINAFScenario()){if(n){e.setVisibleInFilterBar(n.visibleInFilterBar);if(n.hasOwnProperty("visible")){e.setVisible(n.visible)}}else{e.setVisibleInFilterBar(false);if(a===O.INTERNAL_GROUP||e._isParameter()){}}}else{if(n&&n.visibleInFilterBar!==undefined){e.setVisibleInFilterBar(n.visibleInFilterBar)}else{if(a!==O.INTERNAL_GROUP&&n&&n.group===a){e.setVisibleInFilterBar(n!==null)}}}if(e){var s=this.determineControlByFilterItem(e,true);if(!r&&s&&s.getValueState&&s.getValueState()!==M.None){s.setValueState(M.None)}if(n&&n.hasOwnProperty("partOfCurrentVariant")&&!n.partOfCurrentVariant){i.push(e)}}}};O.prototype._checkForFilterInfo=function(t,e){var i,r,a=e.getName(),n=[e.getGroupName(),e.getEntitySetName(),e.getEntityTypeName()];var s=[];if(t&&t.length){for(i=0;i<t.length;i++){if(t[i].name===a){if(n.indexOf(t[i].group)>-1){s.push(t[i])}}}}if(s.length===1){return s[0]}else if(s.length>1){for(r=0;r<n.length;r++){for(i=0;i<s.length;i++){if(s[i].group===n[r]){return s[i]}}}}return null};O.prototype._createVariantManagement=function(){var t=new f(this.getId()+"-variantUi2",{});var e=new u({type:"filterBar",keyName:"persistencyKey"});e.setControl(this);t.addPersonalizableControl(e);t.addStyleClass("sapUiCompFilterBarMarginLeft");return t};O.prototype.fireAssignedFiltersChanged=function(){this.fireEvent("assignedFiltersChanged")};O.prototype.retrieveFiltersWithValuesAsText=function(){var t,e,i=this.retrieveFiltersWithValues(),r,a=this.getBasicSearchValue();if(a&&i){i.splice(0,0,this._oRb.getText("FILTER_BAR_ASSIGNED_FILTERS_SEARCH_TERM"))}if(!i||i.length===0){t=this._oRb.getText("FILTER_BAR_ASSIGNED_FILTERS_ZERO")}else if(i&&i.length===1){if(!this._isPhone()){t=this._oRb.getText("FILTER_BAR_ASSIGNED_ONE_FILTER",[i.length,i[0]])}else{t=this._oRb.getText("FILTER_BAR_ASSIGNED_ONE_FILTER_MOBILE",[i.length])}}else{if(!this._isPhone()){r=Math.min(5,i.length);e="";for(var n=0;n<r;n++){e+=i[n];if(n<r-1){e+=", "}}t=this._oRb.getText("FILTER_BAR_ASSIGNED_FILTERS",[i.length,e]);if(r<i.length){t+=", ..."}}else{t=this._oRb.getText("FILTER_BAR_ASSIGNED_FILTERS_MOBILE",[i.length])}}return t};O.prototype.retrieveFiltersWithValuesAsTextExpanded=function(){var t,e="",i=this.retrieveFiltersWithValues(),r=this.getBasicSearchValue(),a=this.retrieveNonVisibleFiltersWithValues();if(a.length>0){e=" "+this._oRb.getText("FILTER_BAR_ASSIGNED_HIDDEN_FILTERS",[a.length])}if(r&&i){i.splice(0,0,this._oRb.getText("FILTER_BAR_ASSIGNED_FILTERS_SEARCH_TERM"))}if(i.length===0){t=this._oRb.getText("FILTER_BAR_ASSIGNED_FILTERS_ZERO")}else if(i.length===1){if(!this._isPhone()){t=this._oRb.getText("FILTER_BAR_ASSIGNED_ONE_FILTER_EXPANDED",[i.length]);t+=e}else{t=this._oRb.getText("FILTER_BAR_ASSIGNED_ONE_FILTER_MOBILE",[i.length]);t+=e}}else{if(!this._isPhone()){t=this._oRb.getText("FILTER_BAR_ASSIGNED_FILTERS_EXPANDED",[i.length]);t+=e}else{t=this._oRb.getText("FILTER_BAR_ASSIGNED_FILTERS_MOBILE",[i.length]);t+=e}}return t};O.prototype.retrieveFiltersWithValues=function(){var t,e=[];var i=this._getFiltersWithValues();if(i){for(t=0;t<i.length;t++){if(i[t].getHiddenFilter()){continue}if(i[t].getVisible()&&i[t].getPartOfCurrentVariant()){e.push(i[t].getLabel())}}}return e};O.prototype.retrieveNonVisibleFiltersWithValues=function(){var t,e=[],i,r=this._getFiltersWithValues();if(r){for(t=0;t<r.length;t++){i=r[t];if(i.getHiddenFilter()){continue}if(i.getVisible()&&!i.getVisibleInFilterBar()&&i.getPartOfCurrentVariant()){e.push(i.getLabel())}}}return e};O.prototype._getFiltersWithValues=function(){if(this._fRegisterGetFiltersWithValues){try{return this._fRegisterGetFiltersWithValues()}catch(t){b.error("callback for obtaining the filter count throws an exception")}}return null};O.prototype._getFiltersWithValuesCount=function(){var t=0;var e=this.retrieveFiltersWithValues();t=e.length;if(this._oBasicSearchField&&this._oBasicSearchField.getValue&&this._oBasicSearchField.getValue()){t++}return t};O.prototype._checkFilterForValue=function(t,e){var i;if(t){for(i=0;i<t.length;i++){if(t[i]===e){return true}}}return false};O.prototype._handleVisibilityOfToolbar=function(){if(this.getAdvancedMode()&&this._oToolbar){var t=false;var e=this._oToolbar.getContent();for(var i=0;i<e.length;i++){if(e[i]instanceof s){continue}if(e[i].getVisible&&e[i].getVisible()){t=true;break}}this._oToolbar.setVisible(t)}};O.prototype._hasMandatoryFields=function(){return this.getFilterGroupItems().some(function(t){return t.getMandatory()})};O.prototype._toggleHideShow=function(){this.setFilterBarExpanded(!this.getFilterBarExpanded());this._bShowAllFilters=this._hasMandatoryFields()?true:false;if(!this.getAdvancedMode()){this._rerenderFilters()}};O.prototype._updateToolbarText=function(){var t=this._isNewFilterBarDesign()?"FILTER_BAR_ADAPT_FILTERS":"FILTER_BAR_ACTIVE_FILTERS";var e=this._isNewFilterBarDesign()?"FILTER_BAR_ADAPT_FILTERS_ZERO":"FILTER_BAR_ACTIVE_FILTERS_ZERO";var i=this._getFiltersWithValuesCount();var r=i?this._oRb.getText(t,[i]):this._oRb.getText(e);this._oFiltersButton.setText(r);this.fireAssignedFiltersChanged()};O.prototype.setFilterBarExpanded=function(t){var e;if(this.getAdvancedMode()){this.setProperty("filterBarExpanded",t);if(this._oHideShowButton){if(t){this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_VH_HIDE_FILTERS"))}else{this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_VH_SHOW_FILTERS"))}}this._calcVisibilityGoButton();if(this.getIsRunningInValueHelpDialog()){this._oBasicAreaLayout.setVisible(t)}else{this._oAdvancedPanel.setVisible(t)}}else{if(this._isPhone()&&this.getUseToolbar()){e=false}else{e=t}this.setProperty("filterBarExpanded",e);if(this._isNewFilterBarDesign()){return this}if(this._isPhone()){if(this._oHideShowButton){this._oHideShowButton.setVisible(false)}this._calcVisibilityGoButton();this._oBasicAreaLayout.setVisible(false)}else{if(this._oHideShowButton){if(e){this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_HIDE"))}else{this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_SHOW"))}this._oHideShowButton.setVisible(true)}this._calcVisibilityGoButton();if(this._oHideShowButton){if(this._oHideShowButton.getEnabled()){this._oBasicAreaLayout.setVisible(e)}else{this._oBasicAreaLayout.setVisible(false)}}}}this._updateToolbarText();return this};O.prototype._selectionChangedInFilterDialogByValue=function(t,e){e.setVisibleInFilterBar(t);if(this._getConsiderFilterChanges()&&this._oVariantManagement&&!this._oVariantManagement.getInErrorState()){this._oVariantManagement.currentVariantSetModified(true)}this._bDirtyViaDialog=true};O.prototype._onLiveChangeValidateSymbols=function(t){var e=new RegExp("[\\w][*][\\w]"),i=new RegExp("[+]"),r=t.getSource(),a=r.getValue(),n=e.test(a)||i.test(a);this._onSymbolsValidationSetValueState.call(this,n,r)};O.prototype._onSymbolsValidationSetValueState=function(t,e){var i=e._oValueStateMessage,r="sapMSFContentWrapperWarning";if(t&&!e.hasStyleClass(r)&&e.setValueState===undefined){e.addStyleClass(r);e.getValueState=function(){return M.Warning};i.open()}else if(!t&&e.hasStyleClass(r)&&e.setValueState===undefined){e.getValueState=function(){return M.None};i.close();e.removeStyleClass(r)}else if(t&&e.getValueState&&e.getValueState()===M.None){e.setValueState(M.Warning);e.setValueStateText(R)}else if(!t&&e.getValueState()===M.Warning){e.setValueState(M.None)}};O.prototype._mandatoryFilterChange=function(t){if(!t){return}var e=t.getParameters();if(!e||!e.oSource){return}var i=this._determineByControl(e.oSource);if(i){this._mandatoryFilterItemChange(i.filterItem)}};O.prototype._mandatoryFilterItemChange=function(t){if(t){if(!t.getMandatory()){return}var e=this._hasFilterValue(t);if(!t.getVisibleInFilterBar()&&!e){t.setVisibleInFilterBar(true)}}};O.prototype._isPhone=function(){return!!o.system.phone};O.prototype._isTablet=function(){return!!(o.system.tablet&&!o.system.desktop)};O.prototype.fireSearch=function(t){if(this._bOKFiltersDialogTriggered&&this._oAdaptFiltersDialog){this._oAdaptFiltersDialog.close()}else if(this._oAdaptFiltersDialog){this._bEnterPressedLeadsToSearch=true}this.fireEvent("search",t)};O.prototype._variantSave=function(t){this._oVariant={};this.fireBeforeVariantSave()};O.prototype._afterVariantSave=function(t){this._aOrderedFilterItems=this._aAdaptFilterItems;this._aAdaptFilterItems=[];this.fireAfterVariantSave()};O.prototype._filterSetInErrorState=function(t){if(this._oAdaptFiltersDialog&&this._oAdaptFiltersDialog.isOpen()){if(this._getConsiderFilterChanges()&&this._oVariantManagement&&!this._oVariantManagement.getInErrorState()){this._oVariantManagement.currentVariantSetModified(true)}this._bDirtyViaDialog=true}};O.prototype._cancelFilterDialog=function(t){if(t&&this._oVariantManagement){this._bDirtyViaDialog=this._oVariantManagement._bSaveCanceled}if(!this.getPersistencyKey()&&this.getUseSnapshot()===false){this.fireCancel();return}if(this._oInitialVariant&&this._oInitialVariant.content&&this._bDirtyViaDialog){var e=this._retrieveCurrentSelectionSet(false);this._deleteValidatingTokenFlag(e);this.applyVariant(this._oInitialVariant.content,"CANCEL");if(this._oVariantManagement){if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantKey(this._oInitialVariant.key)}this._oVariantManagement.currentVariantSetModified(this._oInitialVariant.modified)}this.fireCancel()}};O.prototype._resetFiltersInErrorValueState=function(){var t;t=this._retrieveCurrentSelectionSet(true,true);t.forEach(function(t){if(t.control&&t.control.setValueState&&t.control.getValueState){if(t.control.getValueState()===M.Error){if(t.control.setValue){t.control.setValue("")}t.control.setValueState(M.None)}}})};O.prototype.setContentWidth=function(t){if(this._oAdaptFiltersDialog){this._oAdaptFiltersDialog.setContentWidth(t+"px")}};O.prototype.setContentHeight=function(t){if(this._oAdaptFiltersDialog){this._oAdaptFiltersDialog.setContentHeight(t+"px")}};O.prototype.addAdaptFilterDialogCustomContent=function(t){this._mCustomViewInfo={item:t.item,search:t.search,selectionChange:t.selectionChange,filterSelect:t.filterSelect,content:t.content}};O.prototype._createStructureForAdaptFiltersDialog=function(){var t,e,i={filtersOnFilterBar:{},allFilters:[]};var r,a=this.getAllFiltersWithValues?this.getAllFiltersWithValues():this._getFiltersWithValues();if(this._mAdvancedAreaFilter){for(var n in this._mAdvancedAreaFilter){if(n){t=this._mAdvancedAreaFilter[n];if(t.items){for(var s=0;s<t.items.length;s++){e=t.items[s];r=this._checkFilterForValue(a,e.filterItem);if(e.filterItem.getVisibleInFilterBar()){i.filtersOnFilterBar[e.filterItem.getName()]=e.filterItem}var o=e.filterItem.getGroupName()?e.filterItem.getGroupName():O.INTERNAL_GROUP;var l=o===O.INTERNAL_GROUP?this._oRb.getText("FILTER_BAR_BASIC_GROUP"):e.filterItem.getGroupTitle();var h=e.filterItem.getControlTooltip()?e.filterItem.getControlTooltip():"";i.allFilters.push({name:e.filterItem.getName(),label:e.filterItem.getLabel(),group:o,groupLabel:l,tooltip:h,visibleInDialog:e.filterItem.getVisible(),filterItem:e.filterItem,active:r,required:e.filterItem.getMandatory()})}}}}if(i.allFilters.length>0){var d=[],u=this._aAdaptFilterItems.length>0?this._aAdaptFilterItems:this._aOrderedFilterItems;if(u.length>0){u.forEach(function(t,e){d[t.name]=e});i.allFilters.sort(function(t,e){return d[t.name]-d[e.name]})}}}return i};O.prototype._getAllFilterItemsFlat=function(){var t,e,i,r=[];if(this._mAdvancedAreaFilter){for(var a in this._mAdvancedAreaFilter){if(a){t=this._mAdvancedAreaFilter[a];if(t.items){for(var n=0;n<t.items.length;n++){e=t.items[n];i=e.filterItem;var s=i.getGroupName()?i.getGroupName():O.INTERNAL_GROUP;var o=s===O.INTERNAL_GROUP?this._oRb.getText("FILTER_BAR_BASIC_GROUP"):i.getGroupTitle();var l=i.getControlTooltip()?i.getControlTooltip():"";r.push({name:i.getName(),label:i.getLabel(),group:s,groupLabel:o,tooltip:l,visibleInDialog:i.getVisible(),filterItem:i,required:i.getMandatory()})}}}}}return r};O.prototype._restoreControls=function(t,e){var i,r,a;if(this._fRegisteredFilterChangeHandlers){this.detachFilterChange(this._fRegisteredFilterChangeHandlers);this._fRegisteredFilterChangeHandlers=null}if(this._mAdvancedAreaFilter){for(var n in this._mAdvancedAreaFilter){if(n){i=this._mAdvancedAreaFilter[n];if(i.items){for(var s=0;s<i.items.length;s++){r=i.items[s];if(r.filterItem&&!r.filterItem.getHiddenFilter()&&r.control&&r.container){if(r.contentReplaced){r.contentReplaced=undefined;a=r.container.getContent();var o=a[1];r.container.removeContent(o);if(o&&o.getValueState){if(e&&o.getValueState()!=r.control.getValueState()){r.control.setValueState(o.getValueState())}}o.destroy();r.container.getContent()[0].setLabelFor(r.control);r.container.insertContent(r.control,1)}r.filterItem.detachChange(t)}}}}}}this._rerenderFilters()};O.prototype._expandGroup=function(t){if(this._oAdaptFiltersDialog&&this._oAdaptFiltersDialogModel&&this._oAdaptFiltersPanel&&t&&t.filterItem){var e=t.filterItem.getGroupName()?t.filterItem.getGroupName():O.INTERNAL_GROUP;var i=this._oAdaptFiltersDialogModel.getData().itemsGrouped;for(var r=0;r<i.length;r++){if(i[r].group===e){for(var a=0;a<i[r].items.length;a++){if(i[r].items[a].name===t.filterItem.getName()){this._oAdaptFiltersPanel.setGroupExpanded(i[r].items[a].group,true);return}}return}}}};var G,H;O.prototype._getEntitiesLazy=function(){if(G&&H){return Promise.resolve()}this.setBusy(true);return sap.ui.getCore().loadLibrary("sap.ui.mdc",{async:true}).then(function(){return new Promise(function(t){sap.ui.require(["sap/ui/mdc/p13n/P13nBuilder","sap/ui/mdc/p13n/panels/AdaptFiltersPanel"],function(e,i){G=e;H=i;t();this.setBusy(false)}.bind(this))}.bind(this))}.bind(this))};O.prototype._filtersButtonPressed=function(){this._oFiltersButton.focus();this.showAdaptFilterDialog()};O.prototype._checkAssignedFilters=function(){if(this._oAdaptFiltersDialog){var t=this.getAllFiltersWithValues?this.getAllFiltersWithValues():this._getFiltersWithValues();var e=this._oAdaptFiltersDialogModel.getData().items;for(var i=0;i<e.length;i++){if(e[i].hasOwnProperty("filterItem")){var r=this._checkFilterForValue(t,e[i].filterItem);if(e[i].active!==r){e[i].active=r}}}}};O.prototype.showAdaptFilterDialogForKeyUser=function(t,e){this._fGetDataForKeyUser=e;this.showAdaptFilterDialog().then(function(){this._oAdaptFiltersDialog.addStyleClass(t);G.addRTACustomFieldButton(this._oAdaptFiltersDialog)}.bind(this))};O.prototype._createKeyUserChange=function(){var t=[];if(this._bOKFiltersDialogTriggered&&this._oVariantManagement&&this._oVariantManagement.isA("sap.ui.comp.smartvariants.SmartVariantManagement")&&this._oVariantManagement.getVisible()&&this._oVariantManagement._getPersoController()){t=[{selectorControl:this._oVariantManagement._getPersoController(),changeSpecificData:{changeType:"variantContent",content:{key:this._oVariantManagement.getSelectionKey(),persistencyKey:this.getPersistencyKey(),content:this.fetchVariant()}}}]}return t};O.prototype.showAdaptFilterDialog=function(t){return new Promise(function(e){this._getEntitiesLazy().then(function(){var i;if(!this._oAdaptFiltersDialog){i=new v;i.setSizeLimit(0);var r=function(t,e){for(var i=0;i<t.length;i++){if(t[i].group===e){var r=t[i].items;for(var a=0;a<r.length;a++){if(r[a].filterItem&&r[a].filterItem.getVisible()){if(!t[i].groupVisible){t[i].groupVisible=true}return}}if(t[i].groupVisible){t[i].groupVisible=false}return}}};var a=function(t){if(t&&t.oSource&&t.oSource.isA("sap.ui.comp.filterbar.FilterItem")){var e=t.getParameter("propertyName");if(this._oAdaptFiltersDialogModel&&e){var i=this._oAdaptFiltersDialogModel.getData().items;for(var a=0;a<i.length;a++){if(i[a].hasOwnProperty("filterItem")&&i[a].filterItem===t.oSource){if(e==="visible"){var n=t.oSource.getVisible();if(i[a].visibleInDialog!=n){i[a].visibleInDialog=n;r(this._oAdaptFiltersDialogModel.getData().itemsGrouped,i[a].group);this._oAdaptFiltersDialogModel.checkUpdate();break}}else if(e==="visibleInFilterBar"){i[a].visible=t.oSource.getVisibleInFilterBar();this._oAdaptFiltersDialogModel.checkUpdate();break}}}}}}.bind(this);this._ensureFilterLoaded(null);var n=this._createStructureForAdaptFiltersDialog();var s=this;var o=G.prepareAdaptationData(n.allFilters,function(t,e){V(t,e);var i=true;if(!e.filterItem||e.filterItem.getHiddenFilter()){s._mAdvancedAreaHiddenFilters.push(t);i=false}t.visible=!!n.filtersOnFilterBar[e.name];return i},true);G.sortP13nData({visible:"visible",position:"position"},o.items);this._oAdaptFiltersDialogModel=new v;this._oAdaptFiltersDialogModel.setSizeLimit(1e3);this._oAdaptFiltersDialogModel.setData(o);this._mAdaptFiltersDialogInitialItemsOrder=[].concat(this._oAdaptFiltersDialogModel.getData().items,this._mAdvancedAreaHiddenFilters);var l=this._oAdaptFiltersDialogModel.getData().items;for(var h=0;h<l.length;h++){if(l[h].hasOwnProperty("filterItem")){l[h].filterItem.attachChange(a)}}this._fRegisteredFilterChangeHandlers=function(t){this._mandatoryFilterChange(t)}.bind(this);this.attachFilterChange(this._fRegisteredFilterChangeHandlers);var d=function(t,e){if(t&&t.filterItem&&t.filterItem.getVisibleInFilterBar()!==e){this._selectionChangedInFilterDialogByValue(e,t.filterItem)}}.bind(this);var u=function(t){var e,i,r,a,n=t.getParameter("item"),s=t.getParameter("reason"),o=s==="Add"||s==="SelectAll"||s==="RangeSelect";if(s==="SelectAll"||s==="DeselectAll"){if(this._oAdaptFiltersPanel.getCurrentViewKey()===this._oAdaptFiltersPanel.GROUP_KEY){i=t.getParameter("item").group;r=this._oAdaptFiltersDialogModel.getProperty("/itemsGrouped").filter(function(t){return t.group===i})[0].items}else{r=this._oAdaptFiltersDialogModel.getProperty("/items")}for(e=0;e<r.length;e++){n=r[e];if(!o&&this._shouldBeVisible(n)){a="/items/"+e;this._oAdaptFiltersDialogModel.setProperty(a+"/visible",true)}else{d(n,o)}}}else if(s==="RangeSelect"&&n){if(this._oAdaptFiltersPanel.getCurrentViewKey()===this._oAdaptFiltersPanel.LIST_KEY){for(e=0;e<n.length;e++){var l=n[e];if(!o&&this._shouldBeVisible(l)){a="/items/"+e;this._oAdaptFiltersDialogModel.setProperty(a+"/visible",true)}else{d(l,o)}}}}else if((s==="Add"||s==="Remove")&&n){if(!o&&this._shouldBeVisible(n)){n.visible=true}else{d(n,o)}}else if(s==="Move"){this._bDirtyViaDialog=true;this._bMoveTriggered=true}}.bind(this);var f=new H({enableReorder:true});f.getView(f.GROUP_KEY).getContent().attachChange(u);f.getView(f.LIST_KEY).getContent().attachChange(u);this._oAdaptFiltersPanel=f;f.setItemFactory(function(t){var e,r,a,n;n=t.getObject();if(!n){return undefined}a=this._determineItemByName(n.name,n.group);if(!a||!a.filterItem||!a.control){return undefined}e=a.control;if(!a.contentReplaced&&a.container&&a.container.getContent()[1]===e){a.contentReplaced=true;a.container.removeContent(e);r=e.clone();a.container.getContent()[0].setLabelFor("");r.setModel(i);a.container.insertContent(r,1)}return e}.bind(this));this.fireFiltersDialogBeforeOpen({newDialog:true});if(this._mCustomViewInfo&&this._mCustomViewInfo.item&&this._mCustomViewInfo.item.getKey()){f.addCustomView(this._mCustomViewInfo);f.switchView(t?t:f.getDefaultView())}var _=function(t){this._dialogCancel(this._oAdaptFiltersDialog)}.bind(this);var c=function(t){this._bOKFiltersDialogTriggered=true;this._oAdaptFiltersDialog.close()}.bind(this);var p;if(this.getShowRestoreButton()&&!this._fGetDataForKeyUser){p={onExecute:this._dialogRestore.bind(this),idButton:this.getId()+"-resetBtn"}}G.createP13nDialog(f,{id:this.getId()+"-adapt-filters-dialog",title:this._oRb.getText(this._isNewFilterBarDesign()?"FILTER_BAR_ADAPT_FILTERS_DIALOG":"FILTER_BAR_ADV_FILTERS_DIALOG"),reset:p,verticalScrolling:false,cancel:_,confirm:{text:this._oRb.getText("FILTER_BAR_OK"),handler:c}}).then(function(t){this._oAdaptFiltersDialog=t;this._oAdaptFiltersDialog.setParent(this);this._oVariant.content=this.fetchVariant();if(this._oVariantManagement){this._oVariant.key=this._oVariantManagement.getSelectionKey();this._oVariant.modified=this._oVariantManagement.currentVariantGetModified()}this._oInitialVariant={};V(this._oInitialVariant,this._oVariant);this._bOKFiltersDialogTriggered=false;this._oAdaptFiltersDialog.attachBeforeOpen(function(){this._bDirtyViaDialog=false;this._bEnterPressedLeadsToSearch=false}.bind(this));this._oAdaptFiltersDialog.attachBeforeClose(function(){this._restoreControls(a,!this._bOKFiltersDialogTriggered);if(!this._bOKFiltersDialogTriggered){this._cancelFilterDialog(false)}if(this._fGetDataForKeyUser){this._fGetDataForKeyUser(this._createKeyUserChange())}}.bind(this));this._oAdaptFiltersDialog.attachAfterClose(function(){if(this._bOKFiltersDialogTriggered){this._aAdaptFilterItems=this._oAdaptFiltersDialogModel.getProperty("/items");this._aAdaptFilterItems=[].concat(this._aAdaptFilterItems,this._mAdvancedAreaHiddenFilters);this._mAdvancedAreaFilter=this._mapReorderedFilterItemsInGroups(this._aAdaptFilterItems);this._reorderItemsInBasicAreaLayout(this._aAdaptFilterItems);this._bMoveTriggered=false;this._mAdvancedAreaHiddenFilters=[]}else{this._aAdaptFilterItems=[]}this._oBasicAreaLayout.rerender();this._oAdaptFiltersDialogModel=null;this._oAdaptFiltersPanel=null;this._oVariant={};this._oInitialVariant=null;this._oAdaptFiltersDialog.destroy();this._oAdaptFiltersDialog=null;this._fGetDataForKeyUser=null;if((this._bOKFiltersDialogTriggered&&this._bDirtyViaDialog||this._bResetFiltersDialogTriggered)&&!this._bEnterPressedLeadsToSearch){if(!this.isLiveMode||!this.isLiveMode()){this.fireFilterChange()}}this._bEnterPressedLeadsToSearch=false;this._bResetFiltersDialogTriggered=false;this.fireFiltersDialogClosed({context:this._bOKFiltersDialogTriggered?"SEARCH":"CANCEL"});if(this._bNoFiltersInAdvancedArea&&this._oHintText&&!this._oHintText.getVisible()){this._bNoFiltersInAdvancedArea=false;this.setFilterBarExpanded(true)}}.bind(this));if(this.$().closest(".sapUiSizeCompact").length>0){this._oAdaptFiltersDialog.addStyleClass("sapUiSizeCompact")}this._oAdaptFiltersDialog.isPopupAdaptationAllowed=function(){return false};this._oAdaptFiltersDialog.open();e()}.bind(this));f.setP13nModel(this._oAdaptFiltersDialogModel);return}e()}.bind(this))}.bind(this))};O.prototype._mapReorderedFilterItemsInGroups=function(t){var e=[];t.forEach(function(t){if(!e[t.group]){e[t.group]={};e[t.group].filterItem=null;e[t.group].items=[]}if(!e[t.group].items){e[t.group].items=[]}e[t.group].items.push(this._mAdvancedAreaFilter[t.group].items.find(function(e){return e.filterItem===t.filterItem}));if(!e[t.group].filterItem){e[t.group].filterItem=t.filterItem}}.bind(this));return e};O.prototype._reorderItemsInBasicAreaLayout=function(t){if(!t||!t.length){return}t.forEach(function(t,e){var i=this._determineItemByName(t.name,t.group);if(!i||!i.filterItem||!i.control){return}var r=this._oBasicAreaLayout.removeContent(i.container);this._oBasicAreaLayout.insertContent(r,e+1);return}.bind(this))};O.prototype._reorderItemsInAdvancedAreaFilter=function(){var t,e;t=this._createStructureForAdaptFiltersDialog();e=t.allFilters;this._mAdvancedAreaFilter=this._mapReorderedFilterItemsInGroups(e)};O.prototype.isDialogOpen=function(){return this._oAdaptFiltersDialog?true:false};O.prototype._dialogCancel=function(t){if(t){this._bOKFiltersDialogTriggered=false;this.fireFiltersDialogCancel();t.close()}};O.prototype._dialogRestore=function(){this.reset();if(this._oVariantManagement&&this._oVariantManagement.getVisible()&&!this._oVariantManagement.getInErrorState()){this._oVariantManagement.currentVariantSetModified(false)}if(this._oAdaptFiltersPanel){var t=[],e=this._oAdaptFiltersDialogModel.getData();if(this._bMoveTriggered&&this._mAdaptFiltersDialogInitialItemsOrder.length>0){this._mAdaptFiltersDialogInitialItemsOrder.forEach(function(e,i){t[e.name]=i});e.items.sort(function(e,i){return t[e.name]-t[i.name]})}else{this._aOrderedFilterItems.forEach(function(e,i){t[e.name]=i});e.items.sort(function(e,i){return t[e.name]-t[i.name]});G.sortP13nData({visible:"visible",position:"position"},e.items)}this._oAdaptFiltersPanel.setP13nData(e)}this._bDirtyViaDialog=false;this._bResetFiltersDialogTriggered=true};O.prototype._createButtons=function(t){var i=this;this._oSearchButton=new e(this.getId()+"-btnGo",{visible:this.getShowGoOnFB(),text:this._oRb.getText("FILTER_BAR_GO"),type:L.Emphasized}).addStyleClass("sapUiCompFilterBarPaddingRightBtn");S.addConfig(this._oSearchButton,{event:"search"},this);this._oSearchButton.attachPress(function(){i._oSearchButton.focus();i._searchFromFilterBar()});t.addContent(this._oSearchButton);this._oHideShowButton=new e(this.getId()+"-btnShowHide",{text:this._oRb.getText("FILTER_BAR_HIDE"),type:L.Transparent,enabled:false});this._oHideShowButton.attachPress(function(){i._toggleHideShow()});t.addContent(this._oHideShowButton);this._oClearButtonOnFB=new e(this.getId()+"-btnClear",{visible:this.getShowClearOnFB(),text:this._oRb.getText("FILTER_BAR_CLEAR"),type:L.Transparent,enabled:false}).addStyleClass("sapUiCompFilterBarPaddingRightBtn");this._oClearButtonOnFB.attachPress(function(){i.clear();if(i.isLiveMode&&i.isLiveMode()){i._searchFromFilterBar()}});t.addContent(this._oClearButtonOnFB);this._oRestoreButtonOnFB=new e(this.getId()+"-btnRestore",{visible:this.getShowRestoreOnFB(),text:this._oRb.getText("FILTER_BAR_RESTORE"),type:L.Transparent,enabled:false});this._oRestoreButtonOnFB.attachPress(function(){i.reset();if(i._oVariantManagement){i._oVariantManagement.currentVariantSetModified(false)}});t.addContent(this._oRestoreButtonOnFB);this._oFiltersButton=new e(this.getId()+"-btnFilters",{visible:this.getShowFilterConfiguration(),text:this._oRb.getText("FILTER_BAR_ACTIVE_FILTERS_ZERO"),type:L.Transparent,enabled:false});this._oFiltersButton.attachPress(function(){this._filtersButtonPressed()}.bind(this));t.addContent(this._oFiltersButton)};O.prototype._toggleAllFilters=function(){this._bShowAllFilters=!this._bShowAllFilters;this._oShowAllFiltersButton.setVisible(!this._bShowAllFilters);this._rerenderFilters()};O.prototype.initShowAllFiltersButton=function(){this._oShowAllFiltersButton=new e(this.getId()+"-btnShowAll",{text:this._oRb.getText("FILTER_BAR_VH_SHOW_ALL"),type:L.Transparent,press:this._toggleAllFilters.bind(this)});this._oBasicAreaLayout.addEndContent(this._oShowAllFiltersButton)};O.prototype._createVariantLayout=function(){this._oVariantManagement=this._createVariantManagement();if(this._possibleToChangeVariantManagement()){this._oVariantManagement.setVisible(false)}this._registerVariantManagement();return this._oVariantManagement};O.prototype._createToolbar=function(t){var e=new n(this.getId()+"-toolbar");if(!t){var i=this._createVariantLayout();e.addContent(i)}e.addContent(new s);this._createButtons(e);e.addStyleClass("sapUiCompFilterBarToolbar");e.setLayoutData(new g({span:"L12 M12 S12"}));return e};O.prototype._replaceVariantManagement=function(t){if(this._oVariantManagement){this._unregisterVariantManagement();if(this._oToolbar&&this._oToolbar.getContent(this._oVariantManagement)){this._oToolbar.removeContent(this._oVariantManagement)}this._oVariantManagement.destroy()}this._oVariantManagement=t;this._registerVariantManagement();this._adaptNewFilterBarDesign()};O.prototype._createAdvancedAreaForm=function(){if((!E||!N||!x||!w)&&!this._bAdvancedRequested){E=sap.ui.require("sap/ui/layout/form/Form");N=sap.ui.require("sap/ui/layout/form/FormContainer");x=sap.ui.require("sap/ui/layout/form/FormElement");w=sap.ui.require("sap/ui/layout/form/ResponsiveGridLayout");if(!E||!N||!x||!w){sap.ui.require(["sap/ui/layout/form/Form","sap/ui/layout/form/FormContainer","sap/ui/layout/form/FormElement","sap/ui/layout/form/ResponsiveGridLayout"],U.bind(this));this._bAdvancedRequested=true}}if(!E||!N||!x||!w){return}var t=new w(this.getId()+"-AdvancedFormLayout");t.addStyleClass("sapUiCompFilterBarPaddingForm");t.setColumnsL(3);t.setColumnsM(2);var e=new E(this.getId()+"-AdvancedForm",{editable:true});e.setLayout(t);if(!this.oInvisibleFormTitle){this.oInvisibleFormTitle=new _({text:this._oRb.getText("ADVANCED_SEARCH_TEXT")});this.addContent(this.oInvisibleFormTitle)}e.addAriaLabelledBy(this.oInvisibleFormTitle);this._oAdvancedPanel.addContent(e);return e};function U(t,e,i,r){E=t;N=e;x=i;w=r;this._bAdvancedRequested=false;if(!this._bIsBeingDestroyed){if(!this.getIsRunningInValueHelpDialog()){this._oAdvancedAreaForm=this._createAdvancedAreaForm();this._rerenderAA()}}}O.prototype._addControlToBasicAreaFormContainer=function(t){var e=t._getControl();if(!e){b.error("no Control obtained");return null}var i=t.getLabelControl(this.getId());if(!i){b.error("no Label obtained");return null}this._adaptGroupTitleForFilter(t);return this._addControlToBasicAreaContainer(t,e,i)};O.prototype._addControlToBasicAreaContainer=function(t,e,i){var r=new F;if(e.setWidth){e.setWidth("100%")}r.setWidth("100%");if(i){if(!i.hasStyleClass("sapUiCompFilterLabel")){i.addStyleClass("sapUiCompFilterLabel")}r.addContent(i);if(i.setLabelFor){if(t&&e){i.setLabelFor(e);if(e.setTooltip&&t.getControlTooltip()){e.setTooltip(t.getControlTooltip())}}}}r.addContent(e);if((!this.getAdvancedMode()||this.getIsRunningInValueHelpDialog())&&!this._oAdaptFiltersDialog){if(t&&t.getVisible()&&t.getVisibleInFilterBar()){var a=this._oBasicAreaLayout.getContent();if(this._isNewFilterBarDesign()&&!this._isPhone()){this._oBasicAreaLayout.insertContent(r,a.length)}else{this._oBasicAreaLayout.addContent(r)}}}return r};O.prototype._rerenderAA=function(){if(this._oAdvancedAreaForm){this._oAdvancedAreaForm.removeAllFormContainers();var t=this._flattenMap();this._layOutAA(t)}};O.prototype._groupsWithVisibleFilters=function(){var t,e,i=this._mAdvancedAreaFilter;if(this._mAdvancedAreaFilter&&Object.keys(this._mAdvancedAreaFilter).length>1){i={};for(var r in this._mAdvancedAreaFilter){if(r&&this._mAdvancedAreaFilter[r]&&this._mAdvancedAreaFilter[r].items){t=this._mAdvancedAreaFilter[r].items.length;for(var a=0;a<this._mAdvancedAreaFilter[r].items.length;a++){e=this._mAdvancedAreaFilter[r].items[a].filterItem;if(e&&(e.getHiddenFilter()||!e.getVisible())){t--}}if(t){i[r]={}}}}}return i};O.prototype._layOutAA=function(t){var e=this._groupsWithVisibleFilters();if(e&&Object.keys(e).length>1){this._layOutAAMultipleGroup(t)}else{this._layOutAASingleGroup(t)}};O.prototype._layOutAAMultipleGroup=function(t){var e,i,r=0,a=null,n=false;for(e=0;e<t.length;e++){if(t[e].control===null){r++}}if(this._mAdvancedAreaFilter&&Object.keys(this._mAdvancedAreaFilter).length===2&&this._mAdvancedAreaFilter[O.INTERNAL_GROUP]&&this._mAdvancedAreaFilter[O.INTERNAL_GROUP].items&&this._mAdvancedAreaFilter[O.INTERNAL_GROUP].items.length>0){n=true}var s=this._oAdvancedAreaForm.getLayout();if(s){if(r>=3){s.setLabelSpanL(5);s.setLabelSpanM(5);s.setColumnsL(3);s.setColumnsM(2)}else if(r===2){s.setLabelSpanL(4);s.setLabelSpanM(5);s.setColumnsL(2);s.setColumnsM(2)}else if(r===1){s.setLabelSpanL(4);s.setLabelSpanM(5);s.setColumnsL(2);s.setColumnsM(2)}}for(e=0;e<t.length;e++){if(t[e].control===null){a=new N;if(Object.keys(this._mAdvancedAreaFilter).length>1&&!n){if(r>=3&&t[e].filterItem.getGroupName()===O.INTERNAL_GROUP){a.setTitle(this._oRb.getText("FILTER_BAR_BASIC_GROUP"))}else{a.setTitle(t[e].filterItem.getGroupTitle())}}this._oAdvancedAreaForm.addFormContainer(a);i=e+1;while(i<t.length&&t[i].control){this._addControlToAdvancedArea(t[i].filterItem,t[i].control,a);i++}e=i-1}}if(r===1){this._oAdvancedAreaForm.addFormContainer(new N)}};O.prototype._layOutAASingleGroup=function(t){var e,i,r,a;var n=t.length-1;var s=n>2?2:1;if(s>1){r=Math.floor(n/s);a=r*s<n;for(e=1;e<s;e++){i=e*r;if(a){++i}if(i+e<t.length){t.splice(i+e,0,t[0])}}}this._layOutAAMultipleGroup(t)};O.prototype._flattenMap=function(){var t=null,e,i=[],r;if(this._mAdvancedAreaFilter){for(t in this._mAdvancedAreaFilter){if(t&&this._mAdvancedAreaFilter[t].items){r=false;for(e=0;e<this._mAdvancedAreaFilter[t].items.length;e++){var a=this._mAdvancedAreaFilter[t].items[e];if(a.filterItem&&a.filterItem.getVisibleInFilterBar()&&a.filterItem.getVisible()&&!a.filterItem.getHiddenFilter()){if(!r){r=true;i.push({control:null,filterItem:this._mAdvancedAreaFilter[t].filterItem})}i.push({control:a.control,filterItem:a.filterItem})}}}}}return i};O.prototype._rerenderItem=function(t,e){var i;if(t){i=t.filterItem.getVisible()&&t.filterItem.getVisibleInFilterBar()&&!t.filterItem.getHiddenFilter();if(e!==undefined){i=i&&!e}if(t.container){t.container.setVisible(i);if(i){this._addContainer(t)}else{this._removeContainer(t)}}}};O.prototype._rerenderFilters=function(){var t;var e=null;var i=null;var r=[];if(this._mAdvancedAreaFilter){for(e in this._mAdvancedAreaFilter){if(e&&this._mAdvancedAreaFilter[e]&&this._mAdvancedAreaFilter[e].items){for(t=0;t<this._mAdvancedAreaFilter[e].items.length;t++){i=this._mAdvancedAreaFilter[e].items[t];var a=i.filterItem.getVisible()&&i.filterItem.getVisibleInFilterBar()&&!i.filterItem.getHiddenFilter();if(a){r.push({visible:a,item:i})}else{this._removeContainer(i)}}}}}var n=this.getIsRunningInValueHelpDialog()&&!this._bShowAllFilters;var s=r.length;var o=r.length>this._nMaxFiltersByDefault?this._nMaxFiltersByDefault-1:this._nMaxFiltersByDefault;for(var l=0;l<r.length;l++){var h=n&&l>=o;this._rerenderItem(r[l].item,h)}if(this._oShowAllFiltersButton){if(n&&s>this._nMaxFiltersByDefault){this._oShowAllFiltersButton.setVisible(true)}else{this._oShowAllFiltersButton.setVisible(false)}}this._updateToolbarText()};O.prototype.rerenderFilters=function(){this._rerenderFilters()};O.prototype._setTriggerFilterChangeState=function(t){this._triggerFilterChangeState=t};O.prototype._getTriggerFilterChangeState=function(){return this._triggerFilterChangeState};O.prototype._setConsiderFilterChanges=function(t){this._filterChangeSemaphore=t};O.prototype._getConsiderFilterChanges=function(){return this._filterChangeSemaphore};O.prototype.fireFilterChange=function(t){this._updateToolbarText();if(!this._getTriggerFilterChangeState()){return}if(this._getConsiderFilterChanges()&&this._oVariantManagement&&!this._oVariantManagement.getInErrorState()){this._oVariantManagement.currentVariantSetModified(true)}if(this._oAdaptFiltersDialog&&!this._oAdaptFiltersDialog.isOpen()){return}if(this._oAdaptFiltersDialog){this._bDirtyViaDialog=true;this._checkAssignedFilters()}this.fireEvent("filterChange",t)};O.prototype._notifyAboutChangedFilters=function(t,e){var i,r=this._determineByControl(e);if(t){i={added:e,filterItem:r}}else{i={deleted:e,filterItem:r}}this.fireFilterChange(i)};O.prototype._determineVariantFiltersInfo=function(t,e){var i;var r=null,a,n;var s=[];if(this._mAdvancedAreaFilter){for(r in this._mAdvancedAreaFilter){if(r){if(this._mAdvancedAreaFilter[r].items){for(i=0;i<this._mAdvancedAreaFilter[r].items.length;i++){a=this._mAdvancedAreaFilter[r].items[i];if(t||a.filterItem.getVisible()){n={group:a.filterItem.getGroupName(),name:a.filterItem.getName(),partOfCurrentVariant:a.filterItem.getPartOfCurrentVariant(),visibleInFilterBar:a.filterItem.getVisibleInFilterBar(),visible:a.filterItem.getVisible()};if(e||this._considerFilter(n)){s.push(n)}}}}}}}return s};O.prototype.mergeVariant=function(t,e){var i={};V(i,e);i.filterbar=[];i.filterBarVariant={};V(i.filterbar,t.filterbar);V(i.filterBarVariant,t.filterBarVariant);if(e&&e.hasOwnProperty("version")){i.filterbar=this._mergeVariantFields(i.filterbar,e.filterbar);i.filterBarVariant=e.filterBarVariant}return i};O.prototype._mergeVariantFields=function(t,e){var i;e.forEach(function(e){for(i=0;i<t.length;i++){if(t[i].group===e.group&&t[i].name===e.name){t.splice(i,1);break}}});return t.concat(e)};O.prototype._isUi2Mode=function(){if(this._oVariantManagement instanceof f){return true}return false};O.prototype._isDeltaHandling=function(){if(this._isUi2Mode()){return false}return this.getDeltaVariantMode()};O.prototype._getStandardVariant=function(){return this._oVariantManagement.getStandardVariant(this)};O.prototype._considerFilter=function(t){if(!this._isDeltaHandling()){return true}var e=null;var i=this._getStandardVariant();if(i&&i.filterbar){for(var r=0;r<i.filterbar.length;r++){if(i.filterbar[r].group===t.group&&i.filterbar[r].name===t.name){e=i.filterbar[r];break}}}if(!e){if(!t.partOfCurrentVariant){return false}return true}if(e.partOfCurrentVariant!==t.partOfCurrentVariant||e.visibleInFilterBar!==t.visibleInFilterBar||e.visible!==t.visible){return true}return false};O.prototype._addControlToAdvancedArea=function(t,e,i){var r=new x({label:t.getLabelControl(this.getId()),fields:[e!==null?e:new a]});i.addFormElement(r)};O.prototype._determineVisibility=function(t){var e=false;if(t){e=t.getVisible()&&(t.getVisibleInFilterBar()||this._checkIfFilterHasValue(t.getName()));e=e&&!t.getHiddenFilter()}return e};O.prototype._retrieveVisibleAdvancedItems=function(){var t,e=null,i;var r=[];if(this._mAdvancedAreaFilter){for(e in this._mAdvancedAreaFilter){if(e){if(this._mAdvancedAreaFilter[e]&&this._mAdvancedAreaFilter[e].items){for(t=0;t<this._mAdvancedAreaFilter[e].items.length;t++){i=this._mAdvancedAreaFilter[e].items[t];if(i){if(this._determineVisibility(i.filterItem)){r.push(i)}}}}}}}return r};O.prototype._retrieveCurrentSelectionSet=function(t,e){var i,r,a,n=[];var s=this._retrieveVisibleAdvancedItems();for(i=0;i<s.length;i++){r=s[i];if(r.control&&r.filterItem&&(e||!r.filterItem._isParameter())){if(t){a={name:s[i].filterItem.getName(),control:s[i].control}}else{a=s[i].control}n.push(a)}}return n};O.prototype.search=function(){this.fireSearch({selectionSet:this._retrieveCurrentSelectionSet(false),firedFromFilterBar:this._bSearchFiredFromFilterBar});this._bSearchFiredFromFilterBar=false;return true};O.prototype._searchFromFilterBar=function(){this._bSearchFiredFromFilterBar=true;this.search.apply(this,arguments)};O.prototype.clear=function(){var t={};t.selectionSet=this._retrieveCurrentSelectionSet(false);this._deleteValidatingTokenFlag(t.selectionSet);this._clearErrorState();this.fireClear(t);this._updateToolbarText()};O.prototype._deleteValidatingTokenFlag=function(t){t.forEach(function(t){if(t.hasOwnProperty("__bValidatingToken")){delete t.__bValidatingToken}})};O.prototype.reset=function(){var t={};t.selectionSet=this._retrieveCurrentSelectionSet(false);this.fireReset(t);this._resetVariant()};O.prototype._resetVariant=function(){var t=null,e=null;this._resetFiltersInErrorValueState();var i=this._retrieveCurrentSelectionSet(false);this._deleteValidatingTokenFlag(i);if(this._oVariantManagement){var r=this._oVariantManagement.getSelectionKey()||this._oVariantManagement.getStandardVariantKey();if(r){t=this._oVariantManagement.getVariantContent(this,r);if(this._oVariant){this._oVariant.content=t;this._oVariant.modified=false;if(this.getPersistencyKey()&&this._oInitialVariant){this._oInitialVariant.content=t;this._oInitialVariant.modified=false;this._oInitialVariant.key=r}}if(!this.getPersistencyKey()&&this.getUseSnapshot()===undefined&&this._oInitialVariant&&this._oInitialVariant.content){e=this._oInitialVariant.content}if(t||e){this.applyVariant(t||e,"RESET")}}}};O.prototype._removeValuesForNonPartOfCurrentVariants=function(t){};O.prototype._removeEmptyFilters=function(t){return t};O.prototype._applyVariant=function(t,e,i,r){var a,n=null,s,o=false,l=[];if(t){if(i){s=this._getTriggerFilterChangeState();this._setTriggerFilterChangeState(false)}this._setConsiderFilterChanges(false);a=t.filterBarVariant;n=t.filterbar;if(this._oFilterProvider){this._oFilterProvider._setSingleInputsTextArrangementData(JSON.parse(t.singleInputsTextArrangementData||"{}"))}l=t.orderedFilterItems?JSON.parse(t.orderedFilterItems):[];if(!l.length){l=this._mAdvancedAreaFilterFlat}if(Array.isArray(n)&&n.length){this._ensureFilterLoaded(n.filter(function(t){return t.visibleInFilterBar}))}this._applyVariantFields(a,r);var h=this._reapplyVisibility(n,e==="CANCEL");this._removeValuesForNonPartOfCurrentVariants(h);if(this._oBasicSearchField&&this._oBasicSearchField.setValue){this._oBasicSearchField.setValue(""||t.basicSearch)}if(t.executeOnSelection){o=t.executeOnSelection}this._reorderItemsInBasicAreaLayout(l);this._aOrderedFilterItems=l;this._reorderItemsInAdvancedAreaFilter();this.fireAfterVariantLoad(e,o);this._setConsiderFilterChanges(true);this._updateToolbarText();if(o||this.getLiveMode&&this.getLiveMode()){this._searchFromFilterBar()}else if(e!=="CANCEL"){this._clearErrorState()}if(i){this._setTriggerFilterChangeState(s)}}};O.prototype._fetchVariantFiltersData=function(t){if(this._fRegisteredFetchData){try{return this._fRegisteredFetchData(t)}catch(t){b.error("callback for fetching data throws an exception")}}else{b.warning("no callback for fetch data supplied")}return null};O.prototype._applyVariantFields=function(t,e){if(this._fRegisteredApplyData){try{return this._fRegisteredApplyData(t,e)}catch(t){b.error("callback for applying data throws an exception")}}else{b.warning("no callback for apply data supplied")}};O.prototype._isStandardVariant=function(){var t=this.getCurrentVariantId();if(!t){return true}if(this._oVariantManagement){if(t===this._oVariantManagement.getStandardVariantKey()){return true}if(this._oVariantManagement._oStandardVariant===null){return true}}return false};O.prototype.isCurrentVariantExecuteOnSelectEnabled=function(){if(this._oVariantManagement&&!this._oVariantManagement.getInErrorState()){var t=this.getCurrentVariantId();if(!t){return this._oVariantManagement.getExecuteOnSelectForStandardVariant()}var e=this._oVariantManagement.getItemByKey(t);if(e){return e.getExecuteOnSelection()}}return false};O.prototype.fetchVariant=function(){var t,e={},i,r,a=[];if(this._isDeltaHandling()){if(!this._isStandardVariant()){e.version="V3"}}this.fireBeforeVariantFetch();t=this._determineVariantFiltersInfo(true,!e.version);e.filterbar=!t?[]:t;var n=function(t){t.forEach(function(t){a.push({name:t.name,group:t.group})})};if(this._aAdaptFilterItems&&this._aAdaptFilterItems.length>0){n(this._aAdaptFilterItems);e.orderedFilterItems=JSON.stringify(a)}else{this._mAdvancedAreaFilterFlat=this._getAllFilterItemsFlat();n(this._mAdvancedAreaFilterFlat);e.orderedFilterItems=JSON.stringify(a)}r=this._fetchVariantFiltersData(e.version);e.filterBarVariant=this._removeEmptyFilters(r);e.singleInputsTextArrangementData=JSON.stringify(this._oFilterProvider?this._oFilterProvider._getSingleInputsTextArrangementData():{});i=this._getBasicSearchValue();if(i){e.basicSearch=i}if(this._oVariant&&this._oVariant.content){this._oVariant.content=e}return e};O.prototype.applyVariant=function(t,e,i){if(t.hasOwnProperty("version")){t=this.mergeVariant(this._getStandardVariant(),t,e)}this._applyVariant(t,e,i,t.version)};O.prototype._afterVariantsLoad=function(){if(this._bDelayRendering){this._oBasicAreaLayout.setVisible(this.getFilterBarExpanded())}this._bDelayRendering=false};O.prototype.determineMandatoryFilterItems=function(){var t;var e=[];var i=this._retrieveVisibleAdvancedItems();for(t=0;t<i.length;t++){if(i[t].filterItem.getMandatory()===true){if(i[t].control){e.push(i[t].filterItem)}}}return e};O.prototype.determineControlByFilterItem=function(t,e){var i,r=null;var a,n;if(!t||!e&&t._isParameter()){return null}if(this._aBasicAreaSelection){for(i=0;i<this._aBasicAreaSelection.length;i++){a=this._aBasicAreaSelection[i];if(t===a.filterItem){return a.control}}}if(this._mAdvancedAreaFilter){for(r in this._mAdvancedAreaFilter){if(r){n=this._mAdvancedAreaFilter[r];if(n&&n.items){for(i=0;i<n.items.length;i++){a=n.items[i];if((e||!a.filterItem._isParameter())&&t===a.filterItem){return a.control}}}}}}return null};O.prototype.determineControlByName=function(t,e){var i=this._determineEnsuredItemByName(t,e);if(i&&i.filterItem&&!i.filterItem._isParameter()){return i.control}return null};O.prototype.determineLabelByName=function(t,e){var i=this._determineEnsuredItemByName(t,e);if(i&&i.filterItem){return i.filterItem._oLabel}return null};O.prototype._determineEnsuredItemByName=function(t,e){if(!e){e=this._determineGroupNameByName(t)}this._ensureFilterLoaded([{name:t,group:e}]);return this._determineItemByName(t,e)};O.prototype._determineGroupNameByName=function(t){if(this._aFields){for(var e=0;e<this._aFields.length;e++){if(this._aFields[e].fieldName===t){return this._aFields[e].groupName}}}var i=this._determineFilterItemByName(t);if(i){var r=i.getGroupName();if(r!==O.INTERNAL_GROUP){return r}}return null};O.prototype._determineItemByName=function(t,e){var i;var r,a;var n=e;if(!t){return null}if(!n){n=O.INTERNAL_GROUP}if(this._mAdvancedAreaFilter){a=this._mAdvancedAreaFilter[n];if(a&&a.items){for(i=0;i<a.items.length;i++){r=a.items[i];if(r&&r.filterItem&&r.filterItem.getName()===t){return r}}}}return null};O.prototype.determineFilterItemByName=function(t,e){var i;if(e){i=this._determineEnsuredItemByName(t,e)}else{i=this._determineEnsuredItemByName(t)}if(i&&i.filterItem){return i.filterItem}return null};O.prototype._determineFilterItemByName=function(t){var e,i;if(this._mAdvancedAreaFilter){for(e in this._mAdvancedAreaFilter){i=this._determineItemByName(t,e);if(i){return i.filterItem}}}return null};O.prototype._determineByControl=function(t){var e=null,i;if(this._mAdvancedAreaFilter){for(e in this._mAdvancedAreaFilter){if(e){var r=this._mAdvancedAreaFilter[e];if(r&&r.items){for(i=0;i<r.items.length;i++){if(r.items[i]&&r.items[i].control===t){return r.items[i]}}}}}}return null};O.prototype.onAfterRendering=function(t){if(!(this._isPhone()||this._isTablet())){if(this._oHintText&&this._oHintText.getVisible()){this._bNoFiltersInAdvancedArea=true;this.setFilterBarExpanded(false)}}if(this.getIsRunningInValueHelpDialog()){if(!this._isPhone()){var e=this.iAddedContentLength,i=this._oBasicAreaLayout.getContent(),r;if(e>0&&e<4){for(var a=3;a>=4-e;a--){r=i[a].$().parent()[0];if(r){r.style.height="0px";r.style.margin="0px"}}}}}else{if(this._oToolbar&&this._oBasicSearchField&&(this._oVariantManagement&&this._oVariantManagement.getVisible()||this.getHeader())&&!this._isPhone()&&!this._oToolbar.getContent()[1].isA("sap.m.ToolbarSeparator")){this._oToolbar.insertContent((new T).addStyleClass("sapUiTinyMarginEnd"),1)}}};O.prototype._destroyLazyFilterControl=function(){var t,e;if(this._aFields&&this._aFields.length>0){if(this._aFields&&this._aFields.length>0){for(t=0;t<this._aFields.length;t++){e=this._aFields[t];if(e.factory){if(e.control){e.control.destroy()}}}}}};O.prototype._destroyNonVisibleFilterControl=function(){var t,e,i;if(this._mAdvancedAreaFilter){for(e in this._mAdvancedAreaFilter){if(e&&this._mAdvancedAreaFilter[e]&&this._mAdvancedAreaFilter[e].items){for(t=0;t<this._mAdvancedAreaFilter[e].items.length;t++){i=this._mAdvancedAreaFilter[e].items[t];if(i&&i.container){if(this._oBasicAreaLayout&&this._oBasicAreaLayout.indexOfContent(i.container)<0){if(i.control&&!i.bDestroyed){i.control.destroy();i.bDestroyed=true}}}}}}}};O.prototype._destroyFilterControls=function(){if(!this.getAdvancedMode()){this._destroyLazyFilterControl();this._destroyNonVisibleFilterControl()}};O.prototype._registerVariantManagement=function(){if(this._oVariantManagement){this._oVariantManagement.attachSave(this._variantSave,this);this._oVariantManagement.attachAfterSave(this._afterVariantSave,this)}};O.prototype._unregisterVariantManagement=function(){if(this._oVariantManagement){if(this._fInitialiseVariants){this._oVariantManagement.detachInitialise(this._fInitialiseVariants);this._fInitialiseVariants=null}this._oVariantManagement.detachSave(this._variantSave,this);this._oVariantManagement.detachAfterSave(this._afterVariantSave,this);if((!this.getUseToolbar()||this.getAdvancedMode())&&!this._oVariantManagement.getDomRef()){this._oVariantManagement.destroy()}}};O.prototype.showFilterDialog=function(){if(!this._oAdaptFiltersDialog){this.showAdaptFilterDialog()}};O.prototype.addFilterDialogContent=function(t){if(this._oAdaptFiltersDialog){return t}return null};O.prototype.getFilterDialogContent=function(){if(this._oAdaptFiltersDialog){return new sap.ui.layout.form.Form}return null};O.prototype.setShowOldFilterDialog=function(){};O.prototype._getFilterControlById=function(t){for(var e in this._mAdvancedAreaFilter){var i=this._mAdvancedAreaFilter[e];for(var r=0;r<i.items.length;r++){var a=i.items[r];if(a.control&&a.control.getId()===t){return a.control}}}return null};O.prototype._getFilterControlByIndex=function(t){var e=0;for(var i in this._mAdvancedAreaFilter){var r=this._mAdvancedAreaFilter[i];for(var a=0;a<r.items.length;a++){var n=r.items[a];if(n.filterItem.getVisibleInFilterBar()){if(e===t){return n.control}e++}}}};function W(t,e){var i=t.filter(function(t){return t.getText()===e});return i.length>0}O.prototype._getFilterControlByLabel=function(t){for(var e in this._mAdvancedAreaFilter){var i=this._mAdvancedAreaFilter[e];for(var r=0;r<i.items.length;r++){var a=i.items[r];if(a.control){if(W(a.control.getLabels(),t)){return a.control}}}}};O.prototype._isFilterItemInBasicGroup=function(t){return t&&!t.getGroupName()||t.getGroupName()===O.INTERNAL_GROUP};O.prototype._shouldBeVisible=function(t){return t.filterItem.getMandatory()&&!this._hasFilterValue(t.filterItem)||t.name==="_BASIC_SEARCH_FIELD"};O.prototype.exit=function(){this._unregisterVariantManagement();this._destroyFilterControls();if(this._oHintText&&this._oAdvancedPanel.indexOfContent(this._oHintText)<0){this._oHintText.destroy()}window.sessionStorage.removeItem(this.getId());window.sessionStorage.removeItem("semanticDates");c.prototype.exit.apply(this,arguments);if(this._oAdaptFiltersDialog){this._oAdaptFiltersDialog.destroy();this._oAdaptFiltersDialog=null}if(this._oAdaptFiltersDialogModel){this._oAdaptFiltersDialogModel=null}if(this._oAdaptFiltersPanel){this._oAdaptFiltersPanel=null}if(this.oModel){this.oModel.destroy();this.oModel=null}this._aFields=null;this._oHintText=null;this._aBasicAreaSelection=null;this._mAdvancedAreaFilter=null;this._oBasicAreaLayout=null;this._oVariantManagement=null;this._oCollectiveSearch=null;this._oVariant=null;this._fRegisteredFetchData=null;this._fRegisteredApplyData=null;this._fRegisterGetFiltersWithValues=null;this._fRegisteredFilterChangeHandlers=null;this._oSearchButton=null;this._oFiltersButton=null;this._oHideShowButton=null;this._oClearButtonOnFB=null;this._oRestoreButtonOnFB=null;this._oBasicSearchField=null;this._oBasicSearchFieldContainer=null;this._oButtonsVLayout=null;this._bLayoutAdded=null;this.iAddedContentLength=null;this._bSearchFiredFromFilterBar=false;this._oInitializedDeferred=null};return O});
//# sourceMappingURL=FilterBar.js.map