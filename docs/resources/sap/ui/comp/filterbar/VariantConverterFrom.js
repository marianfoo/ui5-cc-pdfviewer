/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/comp/util/DateTimeUtil","sap/m/DatePicker","sap/m/DateRangeSelection","sap/base/Log","sap/ui/core/format/DateFormat"],function(e,t,i,a,r,n){"use strict";var o=e.ANALYTICAL_PARAMETER_PREFIX;var l=e.smartfilterbar.FilterType;var s=e.valuehelpdialog.ValueHelpRangeOperation;var f=function(){};f.prototype.convert=function(e,t,i){var a=null,r=null,n;if(e){this._bStrictMode=i;n=JSON.parse(e);if(t&&t.getFilterBarViewMetadata&&n){this._sBasicSearchName=null;this._sBasicSearchValue=null;if(t.getBasicSearchName){this._sBasicSearchName=t.getBasicSearchName()}a={};if(n.Parameters){this._addParameters(n.Parameters,t,a)}if(n.SelectOptions){this._addSelectOptions(n.SelectOptions,t,a)}r={payload:null,variantId:null};r.payload=JSON.stringify(a);if(n.SelectionVariantID){r.variantId=n.SelectionVariantID}if(this._sBasicSearchValue){r.basicSearch=this._sBasicSearchValue}}}return r};f.prototype.retrieveVariantId=function(e){var t=null;var i;if(e){i=JSON.parse(e);if(i&&i.SelectionVariantID){t=i.SelectionVariantID}}return t};f.prototype._getParameterMetaData=function(e,t,i){if(this._bStrictMode){return this._getParameterMetaDataStrictMode(e,t)}return this._getParameterMetaDataNonStrictMode(e,t,i)};f.prototype._getFilter=function(e,t){var i,a,r,n;n=t.getFilterBarViewMetadata();if(n){for(i=0;i<n.length;i++){r=n[i];for(a=0;a<r.fields.length;a++){if(e===r.fields[a].fieldName){return r.fields[a]}}}}return null};f.prototype._getParameter=function(e,t){var i,a;if(t.getAnalyticalParameters){a=t.getAnalyticalParameters();if(a){for(i=0;i<a.length;i++){if(e===a[i].fieldName){return a[i]}}}}return null};f.prototype._getParameterWithInnerPrefix=function(e,t){var i=e;if(e.indexOf(o)!==0){i=o+e}return this._getParameter(i,t)};f.prototype._getParameterMetaDataStrictMode=function(e,t){var i=this._getExactFilterParameterMatch(e,t);if(i){return i}return null};f.prototype._getParameterMetaDataNonStrictMode=function(e,t,i){var a,r,n,l,s=e,f=false,c=function(){return f&&s===l||!f&&s!==l};if(e.indexOf(o)===0){s=e.substr(o.length);f=true}if(s.indexOf("P_")===0){r=s;n=s.substr(2)}else{r="P_"+s;n=s}if(s!==r){l=r}else if(s!==n){l=n}a=this._getExactParameterMatch(s,t);if(a){return a}a=this._getExactParameterMatch(l,t);if(a){return a}if(c()){a=this._getFilter(n,t);if(a){return a}}return null};f.prototype._getExactParameterMatch=function(e,t){var i;i=this._getParameterWithInnerPrefix(e,t);if(i){return i}return null};f.prototype._getExactFilterParameterMatch=function(e,t){var i,a;i=this._getFilter(e,t);if(i){return i}a=this._getParameterWithInnerPrefix(e,t);if(a){return a}return null};f.prototype._addParameters=function(e,t,i){var a;var n,o;var l;for(a=0;a<e.length;a++){o=e[a].PropertyValue;n=e[a].PropertyName;if(this._sBasicSearchName&&n===this._sBasicSearchName){this._sBasicSearchValue=o;continue}l=this._getParameterMetaData(n,t,true);if(l){t.determineControlByName(n);this._addAccordingMetaData(i,t,l,o)}else{r.error("neither metadata nor custom information for filter '"+n+"'")}}};f.prototype._addSelectOptions=function(e,t,i){var a;var n,o;var l,s;for(a=0;a<e.length;a++){n=e[a].PropertyName;o=e[a].Ranges;if(this._sBasicSearchName&&n===this._sBasicSearchName){if(o&&o.length>0){this._sBasicSearchValue=o[0].Low}continue}t.determineControlByName(n);l=this._getParameterMetaData(n,t,false);if(l){s=l.control;this._addRangesAccordingMetaData(i,t,l,o,s)}else{r.error("neither metadata nor custom information for filter '"+n+"'")}}};f.convertOption=function(e,t){var i;switch(e){case"CP":i=s.Contains;if(t){var a=t.indexOf("*");var n=t.lastIndexOf("*");if(a>-1){if(a===0&&n!==t.length-1){i=s.EndsWith;t=t.substring(1,t.length)}else if(a!==0&&n===t.length-1){i=s.StartsWith;t=t.substring(0,t.length-1)}else{t=t.substring(1,t.length-1)}}}break;case"EQ":if(t===""||t===null){i=s.Empty;t=null}else{i=e}break;case"BT":case"LE":case"GE":case"GT":case"LT":i=e;break;default:r.error("Suite Option is not supported '"+e+"'");i=undefined;t=undefined}return{op:i,v:t}};f.prototype._getYearMonthDatePattern=function(e){var t=e.match(/^([0-9]{4})([0-9]{2})([0-9]{2})$/);if(t){return[t[1],t[2],t[3]]}};f.prototype._getTimeZoneFormat=function(e){return e.split(/[\s+-]/)[0]};f.prototype._createDateObject=function(e){var t,i,a,r,n,o,l,s;if(!e){return}t=e.split(".");i=t[0];a=t[1];if(a){a=this._getTimeZoneFormat(a)}n=i.split("T");s=n[0].split("-");if(s.length===1){r=this._getYearMonthDatePattern(s[0]);if(r){s=r}}if(n.length<2){o=new Date(s[0],s[1]-1,s[2])}else{l=n[1].split(":");o=new Date(s[0],s[1]-1,s[2],l[0],l[1],l[2],a?a:0)}o.setFullYear(s[0]);return o};f.prototype._addRangesAccordingMetaData=function(e,o,c,u,d,m){var h,p;var g=function(e,i,a,n){if(i&&i.isInUTCMode&&a.indexOf("PT")===-1&&e.filterType==="date"){if(i.isInUTCMode()){a=a.split("T")[0]+"T00:00:00"}else if(!i.isInUTCMode()&&a.split("T").length===1){a+="T00:00:00"}}if(a.indexOf("Z")!==a.length-1){if(i&&i.isInUTCMode&&!i.isInUTCMode()){n=t.localToUtc(this._createDateObject(a)).toJSON()}else{n=this._createDateObject(a).toJSON()}}else{r.error("Property '"+e.fieldName+"' was added with zulu time zone information.")}return n}.bind(this);var v=function(e){var t=n.getTimeInstance({pattern:"'PT'hh'H'mm'M'ss'S'"});return t.parse(e)};var _=function(e){var t=e;if(e&&c){if(c.filterType==="numeric"){if(c.type==="Edm.Decimal"||c.type==="Edm.Float"||c.type==="Edm.Double"||c.type==="Edm.Single"){t=parseFloat(e)}else{t=parseInt(e)}}else{switch(c.type){case"Edm.DateTime":t=g(c,o,e,t);break;case"Edm.Time":if(e.indexOf("PT")===0){t=v(e)}else{t=g(c,o,e,t)}break;case"Edm.String":if(c.isCalendarDate&&!(c.filterType==="stringdate"&&c.controlType==="date")){t=g(c,o,e,t)}break;case"Edm.DateTimeOffset":t=e;break;case"Edm.Date":var i=e.split("T"),a=i[1];if(a){a=this._getTimeZoneFormat(a)}t=a?i[0]+"T"+a:e;break;default:t=e;break}}}return t};var y=function(t,i){var a,r,n;for(a=0;a<i.length;a++){n=f.convertOption(i[a].Option,i[a].Low);if(n&&n.op){r={exclude:i[a].Sign==="E",operation:n.op,keyField:t,value1:_(n.v),value2:_(i[a].High)};if(!e[t]){e[t]={ranges:[],items:[],value:null}}e[t].ranges.push(r)}}};var S=function(e){for(var t=0;t<e.length;t++){if(e[t].Sign==="E"){return true}}return false};if(u&&u.length>0){if(c.isCustomFilterField){if(!e._CUSTOM){e._CUSTOM={}}if(Array.isArray(u)&&u.length>1){e._CUSTOM[c.fieldName]=u.map(function(e){return e.Low})}else{e._CUSTOM[c.fieldName]=u[0].Low}return}if(c.conditionType){for(h=0;h<u.length;h++){if(!u[h].High){u[h].High=u[h].Low}}y(c.fieldName,u);return}if(c.filterRestriction===l.single){if(!u[0].Low&&d&&d instanceof i){e[c.fieldName]=null}else{e[c.fieldName]=_(u[0].Low)}}else if(c.filterRestriction===l.interval){if(d&&d instanceof a){if(u[0].Low&&u[0].High){e[c.fieldName]={low:_(u[0].Low),high:_(u[0].High)}}else if(u[0].Low&&!u[0].High){e[c.fieldName]={low:_(u[0].Low),high:_(u[0].Low)}}else if(!u[0].Low&&u[0].High){e[c.fieldName]={low:_(u[0].High),high:_(u[0].High)}}else{e[c.fieldName]={low:null,high:null}}}else{if(c.type==="Edm.Time"){y(c.fieldName,u)}else{e[c.fieldName]={low:u[0].Low===undefined?null:_(u[0].Low),high:u[0].High===undefined?null:_(u[0].High)}}}}else if(c.filterRestriction===l.multiple){e[c.fieldName]={ranges:[],items:[],value:null};var T=c.type==="Edm.DateTimeOffset"||c.isCalendarDate||c.type==="Edm.DateTime"||c.type==="Edm.Time";var M=d&&d.isA("sap.m.MultiInput")&&S(u);if(d&&!T&&(d.isA("sap.m.MultiComboBox")||d.isA("sap.m.MultiInput"))&&!M){var P;for(h=0;h<u.length;h++){P=_(u[h].Low);if(u[h].Option==="EQ"&&P===""){p={op:u[h].Option,v:P}}else{p=f.convertOption(u[h].Option,P)}if(p.op===s.EQ){e[c.fieldName].items.push({key:_(p.v)})}}}else{y(c.fieldName,u)}}else{y(c.fieldName,u)}r.warning("potential reduced information for filter '"+c.fieldName+"'")}else{r.warning("no Ranges-section found for filter '"+c.fieldName+"'")}};f.prototype._addAccordingMetaData=function(e,t,i,a){var r=i.type==="Edm.DateTime"?"":a;var n=[{Sign:"I",Low:a,High:r,Option:"EQ"}];this._addRangesAccordingMetaData(e,t,i,n)};return f},true);
//# sourceMappingURL=VariantConverterFrom.js.map