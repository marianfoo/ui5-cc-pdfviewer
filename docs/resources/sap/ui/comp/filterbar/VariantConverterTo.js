/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/comp/util/DateTimeUtil","sap/ui/comp/odata/ODataType","sap/ui/comp/util/FormatUtil","sap/ui/core/format/DateFormat","sap/ui/core/format/TimezoneUtil","sap/base/Log"],function(e,a,t,i,n,l,r){"use strict";var s=e.smartfilterbar.FilterType;var o=e.valuehelpdialog.ValueHelpRangeOperation;var g=e.ANALYTICAL_PARAMETER_PREFIX;var u=function(){};u.prototype.convert=function(e,a,t,i,n,l,r){var s,o,g,d,f=null,h,p;var c={SelectionVariantID:e};if(l){c.ParameterContextUrl=l}if(r){c.FilterContextUrl=r}this._sAPILevel=n;if(t&&a){g=JSON.parse(t);if(g){s=this._getFields(a);if(s&&s.length>0){for(o=0;o<s.length;o++){this._convertField(c,s[o],g,i)}}if(g._CUSTOM){if(typeof g._CUSTOM==="string"){d=JSON.parse(g._CUSTOM)}else{d=g._CUSTOM}for(f in d){if(f){if(Array.isArray(d[f])&&d[f].length>1){this._addArrayOfSingleValues(c,f,d[f])}else{this._addSingleValue(c,f,u._getValue(d[f],true))}}}}if(i&&i.getBasicSearchName){h=i.getBasicSearchName();if(h){p=i.getBasicSearchValue();this._addSingleValue(c,h,u._getValue(p,true))}}}}return JSON.stringify(c)};u.prototype._getParameterMetaData=function(e,a){var t,i,n;var l=a.getFilterBarViewMetadata();if(l){for(t=0;t<l.length;t++){n=l[t];for(i=0;i<n.fields.length;i++){if(e===n.fields[i].fieldName){return n.fields[i]}}}}if(a.getAnalyticalParameters){var r=a.getAnalyticalParameters();if(r){for(i=0;i<r.length;i++){if(e===r[i].fieldName){return r[i]}}}}return null};u.prototype._convertField=function(e,a,n,l){var r,o,g=null,d,f,h,p;if(n&&a&&e){r=n[a];if(r){f=this._getParameterMetaData(a,l);if(f){if(f.isCustomFilterField){return}var c=l.getUseDateRangeType()&&(f.type==="Edm.DateTime"&&f.displayFormat==="Date"||f.type==="Edm.String"&&f.isCalendarDate)||n[a]&&n[a].conditionTypeInfo&&n[a].conditionTypeInfo.name&&n[a].conditionTypeInfo.name==="sap.ui.comp.config.condition.DateRangeType";if(f.filterRestriction===s.single&&(!c||f.isParameter)){o=r.value===undefined?r:r.value;o=u._getValueWithMetadata(l,f,o,true);this._addSingleValue(e,a,o);if(c&&f.isParameter){if(n&&a&&e&&n[a]&&n[a].conditionTypeInfo){var r=n[a];if(r.ranges&&r.ranges.length>0){d=u.addRangeEntry(e,a);u.addRanges(d,r.ranges,l,f)}}}}else if(f.filterRestriction===s.interval){if(r.conditionTypeInfo){this._convertFieldByValue(e,a,n,l,f)}else{d=u.addRangeEntry(e,a);if(f.type==="Edm.DateTime"&&!r.high){r.high=r.low}else if(f.type==="Edm.String"&&!r.high){g="EQ"}if(f.type==="Edm.Time"){this._addRangeMultipleRangeValues(l,f,d,r.ranges,true)}else if(f.type==="Edm.DateTimeOffset"&&!r.high){g="BT";h=i.parseDateTimeOffsetInterval(r.low);if(h&&h.length===2&&h[0]){h[0]=f.ui5Type.parseValue(h[0],"string");if(h.length===2){h[1]=f.ui5Type.parseValue(h[1],"string")}p={low:h[0],high:h[1]};this._addRangeLowHigh(l,f,d,p,"BT")}else{this._addRangeLowHigh(l,f,d,r,"EQ")}}else if(t.isNumeric(f.type)&&!r.high){h=i.parseFilterNumericIntervalData(r.low);if(h&&h.length===2&&h[0]){this._addRangeLowHigh(l,f,d,{low:h[0],high:h[1]},"BT")}else{this._addRangeLowHigh(l,f,d,r,"EQ")}}else{this._addRangeLowHigh(l,f,d,r,g)}}}else if(f.filterRestriction===s.multiple){d=u.addRangeEntry(e,a);if(r.items&&r.items.length>0){this._addRangeMultipleSingleValues(l,f,d,r.items)}else if(r.ranges&&r.ranges.length>0){this._addRangeMultipleRangeValues(l,f,d,r.ranges,r.conditionTypeInfo?true:false)}else{this._addRangeSingleValue(d,r.value)}}else{this._convertFieldByValue(e,a,n,l,f)}}else{this._convertFieldByValue(e,a,n,l,f)}}}};u.prototype._convertFieldByValue=function(e,a,t,i,n){var l;var r;if(t&&a&&e){l=t[a];if(l){if(l.conditionTypeInfo){if(l.ranges&&l.ranges.length>0){r=u.addRangeEntry(e,a);u.addRanges(r,l.ranges,i,n)}}else if(l.ranges!==undefined&&l.items!==undefined&&l.value!==undefined){r=u.addRangeEntry(e,a);if(l.ranges&&l.ranges.length>0){u.addRanges(r,l.ranges,i,n)}if(l.items&&l.items.length>0){this._addRangeMultipleSingleValues(i,n,r,l.items)}if(l.value){this._addRangeSingleValue(r,u._getValueWithMetadata(i,n,l.value))}}else if(l.items!==undefined&&l.items&&l.items.length>0){r=u.addRangeEntry(e,a);this._addRangeMultipleSingleValues(i,n,r,l.items)}else if(l.low!==undefined&&l.low&&l.high!==undefined&&l.high){r=u.addRangeEntry(e,a);this._addRangeLowHigh(i,n,r,l)}else if(l.value!==undefined&&l.value){this._addSingleValue(e,a,l.value)}else if(l){this._addSingleValue(e,a,l)}}}};u.addRangeEntry=function(e,a){var t={PropertyName:a,Ranges:[]};if(!e.SelectOptions){e.SelectOptions=[]}e.SelectOptions.push(t);return t.Ranges};u.addRanges=function(e,a,t,i){var n,l,s,g;for(var d=0;d<a.length;d++){n=a[d].exclude?"E":"I";s=u._getValueWithMetadata(t,i,a[d].value1,true);g=null;if(a[d].operation===o.BT){g=u._getValueWithMetadata(t,i,a[d].value2)}switch(a[d].operation){case o.Contains:l="CP";if(s){s="*"+s+"*"}break;case o.StartsWith:l="CP";if(s){s=s+"*"}break;case o.EndsWith:l="CP";if(s){s="*"+s}break;case o.Empty:l="EQ";s="";break;case o.EQ:case o.BT:case o.LE:case o.GE:case o.GT:case o.LT:l=a[d].operation;break;default:r.error("ValueHelpRangeOperation is not supported '"+a[d].operation+"'");return}e.push({Sign:n,Option:l,Low:s,High:g})}};u.prototype._addRangeMultipleSingleValues=function(e,a,t,i){for(var n=0;n<i.length;n++){t.push({Sign:"I",Option:"EQ",Low:u._getValueWithMetadata(e,a,i[n].key,true),High:null})}};u.prototype._addRangeMultipleRangeValues=function(e,a,t,i,n){for(var l=0;l<i.length;l++){t.push({Sign:"I",Option:n?"BT":"EQ",Low:u._getValueWithMetadata(e,a,i[l].value1,true),High:n?u._getValueWithMetadata(e,a,i[l].value2):null})}};u.prototype._addRangeSingleValue=function(e,a){e.push({Sign:"I",Option:"EQ",Low:u._getValue(a,true),High:null})};u.prototype._addRangeLowHigh=function(e,a,t,i,n){var l=n||"BT";t.push({Sign:"I",Option:l,Low:u._getValueWithMetadata(e,a,i.low,true),High:u._getValueWithMetadata(e,a,i.high)})};u.prototype._addParamaterSingleValue=function(e,a,t){if(!e.Parameters){e.Parameters=[]}e.Parameters.push({PropertyName:a,PropertyValue:t})};u.prototype._createRangeSingleValue=function(e,a,t){var i=u.addRangeEntry(e,a);this._addRangeSingleValue(i,t)};u.prototype._addSingleValue=function(e,a,t){var i;if(this._sAPILevel){i=a.split(g);if(i.length>1){this._addParamaterSingleValue(e,i[i.length-1],t)}else{this._createRangeSingleValue(e,a,t)}}else{this._addParamaterSingleValue(e,a,t)}};u.prototype._addArrayOfSingleValues=function(e,a,t){var i=u.addRangeEntry(e,a);t.forEach(function(e){i.push({Sign:"I",Option:"EQ",Low:u._getValue(e,true),High:null})})};u.prototype._getFields=function(e){var a=[];if(e){for(var t=0;t<e.length;t++){a.push(e[t].name)}}return a};u._getValue=function(e,a){if(e===null||e===undefined||e===""){return a?"":null}return""+e};u._getValueWithMetadata=function(e,t,i,n){if(i===null||i===undefined||i===""){return n?"":null}else if(e&&t){if(t.type==="Edm.DateTime"||t.type==="Edm.Time"){if(t.isParameter&&i.oData){i=i.oData}if(t.isParameter&&!i.oData&&i.ranges&&i.ranges[0]&&i.ranges[0].value1){i=i.ranges[0].value1}if(e&&e.isInUTCMode&&e.isInUTCMode()){i=a.localToUtc(new Date(i)).toJSON()}if(i.indexOf("Z")===i.length-1){i=i.substr(0,i.length-1)}}else if(t.type==="Edm.DateTimeOffset"){var l=e&&e._oFilterProvider&&e._oFilterProvider._getFilterTimeZone(t.name);if(l){i=a.toTimezone(i,l).toJSON()}else{i=new Date(i).toJSON()}}}return""+i};return u},true);
//# sourceMappingURL=VariantConverterTo.js.map