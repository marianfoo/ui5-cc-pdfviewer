/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
(function(){"use strict";var t=sap.ui.require("sap/ui/performance/Measurement");if(t&&t.getActive()){t.start("SmartChartInit","Measurement of SmartChart init time")}})();sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/comp/library","sap/ui/comp/util/DateTimeUtil","sap/m/Button","sap/m/Text","sap/m/FlexItemData","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarToggleButton","sap/m/ToolbarSeparator","sap/m/ToolbarSpacer","sap/m/VBox","sap/ui/comp/providers/ChartProvider","sap/ui/comp/smartfilterbar/FilterProvider","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/model/json/JSONModel","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/comp/personalization/Util","sap/ui/Device","sap/ui/comp/odata/ODataModelUtil","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/state/UIState","sap/m/SelectionDetails","sap/m/SelectionDetailsItem","sap/m/SelectionDetailsItemLine","sap/m/Title","sap/ui/comp/util/FormatUtil","sap/ui/comp/navpopover/NavigationPopoverHandler","sap/ui/core/InvisibleText","sap/m/OverflowToolbarLayoutData","sap/m/library","sap/ui/comp/personalization/Controller","sap/ui/comp/personalization/ChartWrapper","sap/ui/comp/navpopover/SemanticObjectController","sap/ui/performance/Measurement","sap/base/Log","sap/base/util/merge","sap/chart/TimeUnitType","sap/ui/core/CustomData","sap/ui/core/ResizeHandler","sap/ui/comp/util/FullScreenUtil","sap/ui/comp/util/FilterUtil","sap/ui/core/aria/HasPopup"],function(jQuery,t,e,i,a,r,o,s,n,h,l,u,c,p,d,_,f,m,g,b,C,y,v,T,S,D,B,V,P,w,I,M,O,A,L,F,R,x,N,H,E,U,z,j,q,k){"use strict";var Z=A.ToolbarDesign;var K=A.ListMode;var G=A.ListType;var W=A.PlacementType;var X=t.personalization.ChangeType;var $=t.personalization.ResetType;var J=t.smartchart.SelectionMode;var Y;var Q;var tt;var et;var it;var at;var rt;var ot;var st;var nt;var ht;var lt;var ut;var ct;var pt;var dt;var _t;var ft;var mt;var gt=u.extend("sap.ui.comp.smartchart.SmartChart",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartchart/SmartChart.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},chartType:{type:"string",group:"Misc",defaultValue:null},ignoredChartTypes:{type:"string",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useChartPersonalisation:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},persistencyKey:{type:"string",group:"Misc",defaultValue:null},currentVariantId:{type:"string",group:"Misc",defaultValue:null},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},chartBindingPath:{type:"string",group:"Misc",defaultValue:null},showDrillButtons:{type:"boolean",group:"Misc",defaultValue:true},showZoomButtons:{type:"boolean",group:"Misc",defaultValue:true},showSemanticNavigationButton:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showDownloadButton:{type:"boolean",group:"Misc",defaultValue:false},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false},showDrillBreadcrumbs:{type:"boolean",group:"Misc",defaultValue:false},showChartTooltip:{type:"boolean",group:"Misc",defaultValue:true},showLegendButton:{type:"boolean",group:"Misc",defaultValue:true},legendVisible:{type:"boolean",group:"Misc",defaultValue:true},selectionMode:{type:"sap.ui.comp.smartchart.SelectionMode",group:"Misc",defaultValue:J.Multi},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:true},useTooltip:{type:"boolean",group:"Misc",defaultValue:true},useListForChartTypeSelection:{type:"boolean",group:"Misc",defaultValue:true},showChartTypeSelectionButton:{type:"boolean",group:"Misc",defaultValue:true},noData:{type:"string",group:"Misc",defaultValue:null},showToolbar:{type:"boolean",group:"Misc",defaultValue:true},toolbarStyle:{type:"sap.m.ToolbarStyle",group:"Appearance"},showDimensionsTitle:{type:"boolean",group:"Misc",defaultValue:true},showMeasuresTitle:{type:"boolean",group:"Misc",defaultValue:true},activateTimeSeries:{type:"boolean",group:"Misc",defaultValue:false},notAssignedText:{type:"string",group:"Misc",defaultValue:""}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},selectionDetailsItemActions:{type:"sap.ui.core.Item",multiple:true},selectionDetailsActions:{type:"sap.ui.core.Item",multiple:true},selectionDetailsActionGroups:{type:"sap.ui.core.Item",multiple:true}},events:{initialise:{},initialized:{},beforeRebindChart:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},selectionDetailsActionPress:{parameters:{action:{type:"sap.ui.core.Item"},itemContexts:{type:"sap.ui.model.Context"},level:{type:"sap.m.SelectionDetailsActionLevel"}}},chartDataChanged:{parameters:{changeTypes:{type:"object"}}},uiStateChange:{}}},renderer:{apiVersion:2}});gt.prototype.init=function(){u.prototype.init.call(this);this.addStyleClass("sapUiCompSmartChart");this.setFitContainer(true);this._bUpdateToolbar=true;this._oChartTypeModel=null;var t=new f({items:[]});this.setModel(t,"$smartChartTypes");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");if(!this.getLayoutData()){this.setLayoutData(new r({growFactor:1,baseSize:"auto"}))}};gt.prototype._getVariantManagementControl=function(t){var e=null;if(t){if(typeof t==="string"){e=sap.ui.getCore().byId(t)}else{e=t}if(e){if(!(e instanceof d)){N.error("Control with the id="+typeof t.getId=="function"?t.getId():t+" not of expected type");return null}}}return e};gt.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||!this.getUseVariantManagement()&&!this.getUseChartPersonalisation()||!this.getPersistencyKey()){return}var t=new _({type:"chart",keyName:"persistencyKey",dataSource:this.getEntitySet()});t.setControl(this);var e=this.getSmartVariant();if(e){this._oVariantManagement=this._getVariantManagementControl(e)}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){e=this._oSmartFilter.getSmartVariant();if(e){this._oVariantManagement=this._getVariantManagementControl(e)}}else{this._oVariantManagement=new d(this.getId()+"-variant",{showShare:true})}if(this._oVariantManagement){if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement())}this._oVariantManagement.addPersonalizableControl(t);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this)}};gt.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD"}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding()}};gt.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true)}};gt.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()})};gt.prototype.setUseChartPersonalisation=function(t){this.setProperty("useChartPersonalisation",t,true);this._bUpdateToolbar=true;return this};gt.prototype.setUseTooltip=function(t){this.setProperty("useTooltip",t,true);this._createTooltipOrPopover();return this};gt.prototype._createTooltipOrPopover=function(){if(this.getUseTooltip()&&this.getShowChartTooltip()){this._toggleChartTooltipVisibility(true)}else{this._createPopover()}};gt.prototype._createPopover=function(){if(this._oChart){if(!nt&&!this._bVizPopoverRequested){nt=sap.ui.require("sap/viz/ui5/controls/Popover");if(!nt){sap.ui.require(["sap/viz/ui5/controls/Popover"],bt.bind(this));this._bVizPopoverRequested=true}}if(!this._oPopover&&nt&&!this._oChart._getVizFrame()._connectPopover){this._oPopover=new nt({})}if(this._oPopover){this._oPopover.connect(this._oChart.getVizUid())}}};function bt(t){nt=t;this._bVizPopoverRequested=false;if(!this._bIsBeingDestroyed){this._createPopover()}}gt.prototype._destroyPopover=function(){if(this._oPopover){this._oPopover.destroy();this._oPopover=null}};gt.prototype.setUseVariantManagement=function(t){this.setProperty("useVariantManagement",t,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!t)}this._bUpdateToolbar=true;return this};gt.prototype.setToolbar=function(t){if(this._oToolbar){this.removeItem(this._oToolbar)}this._oToolbar=t;this._bUpdateToolbar=true;this._oToolbar.setLayoutData(new r({shrinkFactor:0}));this.insertItem(this._oToolbar,0);this._oToolbar.setVisible(this.getShowToolbar());this._oToolbar.setStyle(this.getToolbarStyle());return this};gt.prototype.getToolbar=function(){return this._oToolbar};gt.prototype.setHeader=function(t){this.setProperty("header",t,true);this._refreshHeaderText();return this};gt.prototype._refreshHeaderText=function(){if(!this._headerText){this._bUpdateToolbar=true;return}var t=this.getHeader();this._headerText.setText(t);if(this._oSeparator){if(t){this._oSeparator.setVisible(true)}else{this._oSeparator.setVisible(false)}}};gt.prototype._createToolbar=function(){if(!this._oToolbar){this._oToolbar=new o({design:Z.Transparent});this._oToolbar.addStyleClass("sapUiCompSmartChartToolbar");this._oToolbar.addStyleClass("sapMTBHeader-CTX");this._oToolbar.setLayoutData(new r({shrinkFactor:0}));this.insertItem(this._oToolbar,0);this._oToolbar.setVisible(this.getShowToolbar());this._oToolbar.setStyle(this.getToolbarStyle())}};gt.prototype._createToolbarContent=function(){this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addSemanticNavigationButton();this._addDetailsButton();this._addDrillUpDownButtons();this._addLegendButton();this._addZoomInOutButtons();this._addDownloadButton();this._addPersonalisationToToolbar();this._addFullScreenButton();this._addChartTypeToToolbar();if(this._oToolbar&&(this._oToolbar.getContent().length===0||this._oToolbar.getContent().length===1&&this._oToolbar.getContent()[0]instanceof l)){this.removeItem(this._oToolbar);this._oToolbar.destroy();this._oToolbar=null}};gt.prototype.setShowVariantManagement=function(t){this.setProperty("showVariantManagement",t);if(this._oVariantManagement&&this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(t)}return this};gt.prototype.setShowDetailsButton=function(t){this.setProperty("showDetailsButton",t);if(this._oSelectionDetails){this._oSelectionDetails.setVisible(t);if(this._oDrillDownTextButton){this._oDrillDownTextButton.setVisible(t)}this._setBehaviorTypeForDataSelection()}if(this._oDrillDownButton){this._oDrillDownButton.setVisible(!t)}return this};gt.prototype.setShowChartTypeSelectionButton=function(t){this.setProperty("showChartTypeSelectionButton",t);if(this._oChartTypeButton){this._oChartTypeButton.setVisible(t)}return this};gt.prototype.setShowDownloadButton=function(t){this.setProperty("showDownloadButton",t);if(this._oDownloadButton){this._oDownloadButton.setVisible(t)}return this};gt.prototype.setShowDrillBreadcrumbs=function(t){this.setProperty("showDrillBreadcrumbs",t);if(this._oDrillBreadcrumbs){this._oDrillBreadcrumbs.setVisible(t)}if(this._oDrillUpButton){this._oDrillUpButton.setVisible(!t)}return this};gt.prototype.setShowChartTooltip=function(t){this.setProperty("showChartTooltip",t);this._toggleChartTooltipVisibility(t);return this};gt.prototype._setBehaviorTypeForDataSelection=function(){if(this.getShowDetailsButton()){this._oChart.setVizProperties({interaction:{behaviorType:"noHoverBehavior"}})}else if(this._oChart.getVizProperties().interaction.behaviorType){var t=this._oChart.getVizProperties().interaction;delete t.behaviorType;this._oChart.setVizProperties({interaction:t})}};gt.prototype._addDrillBreadcrumbs=function(){if(!this._oDrillBreadcrumbs&&this.getShowDrillBreadcrumbs()){if((!lt||!ut)&&!this._bBreadcrumbsRequested){lt=sap.ui.require("sap/m/Breadcrumbs");ut=sap.ui.require("sap/m/Link");if(!lt){sap.ui.require(["sap/m/Breadcrumbs","sap/m/Link"],Ct.bind(this));this._bBreadcrumbsRequested=true}}if(this._oChart&&lt&&ut){this._oDrillBreadcrumbs=new lt(this.getId()+"-drillBreadcrumbs",{visible:this.getShowDrillBreadcrumbs()}).addStyleClass("sapUiCompSmartChartBreadcrumbs");this.insertItem(this._oDrillBreadcrumbs,1);this._updateDrillBreadcrumbs();this._oChart.attachDrilledUp(function(t){this._updateDrillBreadcrumbs()}.bind(this));this._oChart.attachDrilledDown(function(t){this._updateDrillBreadcrumbs()}.bind(this))}}};function Ct(t,e){lt=t;ut=e;this._bBreadcrumbsRequested=false;if(!this._bIsBeingDestroyed){this._addDrillBreadcrumbs()}}gt.prototype.getDrillStackFilters=function(){var t=this._oChart.getDrillStack();var e=[];var i=function(t){if(!t){return}if(t&&t.sPath&&t.sOperator){e.push(t)}if(t.aFilters){t.aFilters.forEach(function(t){i(t)})}};t.forEach(function(t){i(t.filter)});return e};gt.prototype._getDrillStackDimensions=function(){var t=this._oChart.getDrillStack();var e=[];t.forEach(function(t){t.dimension.forEach(function(t){if(t!=null&&t!=""&&e.indexOf(t)==-1){e.push(t)}})});return e};gt.prototype._updateDrillBreadcrumbs=function(){if(!this._oDrillBreadcrumbs){return}var t=this._oChart.getDrillStack();var e=[];if(t){t.reverse();t.forEach(function(t,i,a){if(t.dimension.length>0&&typeof this._oChart.getDimensionByName(t.dimension[t.dimension.length-1])!="undefined"){if(this.getShowDrillBreadcrumbs()){this._oDrillBreadcrumbs.setVisible(true)}var r=this._oChart.getDimensionByName(t.dimension[t.dimension.length-1]).getLabel();if(i==0){this._oDrillBreadcrumbs.setCurrentLocationText(r)}else{var o=new ut({text:r,press:function(t){var e=this._oDrillBreadcrumbs.indexOfLink(t.getSource());this._oChart.drillUp(e+1);this._oChart.fireDeselectData(t);this._updateDrillBreadcrumbs()}.bind(this)});e.push(o)}}else{if(i==0){this._oDrillBreadcrumbs.setVisible(false)}}}.bind(this))}var i=this._oDrillBreadcrumbs.getLinks();e.reverse();var a=false;if(i.length!==e.length){a=true}else{for(var r=0;r<e.length;r++){if(e[r].getText()!=i[r].getText()){a=true;break}}}if(a){if(this._oDrillBreadcrumbs.getLinks()){this._oDrillBreadcrumbs.removeAllLinks()}for(var r=0;r<e.length;r++){this._oDrillBreadcrumbs.addLink(e[r])}}};gt.prototype._addDetailsButton=function(){this._oSelectionDetails=new D(this.getId()+"-selectionDetails",{visible:this.getShowDetailsButton(),customData:[new U({key:"sap-ui-custom-settings",value:{"sap.ui.dt":{designtime:"sap/ui/comp/designtime/smartchart/SmartChartDetails.designtime"}}})]});this._oSelectionDetails.registerSelectionDetailsItemFactory([],function(t,e,i,a){var r=[];var o=function(e){var e=t[s].value;if(e){return e instanceof Object?e:e.toString()}else{return e}};for(var s=0;s<t.length;s++){r.push(new V({label:t[s].label,value:o(t[s].value),unit:t[s].unit}))}return new B({enableNav:function(){if(this._determineSemanticObjectsforDetailsPopover(e,i).length>0){return true}else{return false}}.bind(this)(),lines:r}).setBindingContext(i)}.bind(this));this._oSelectionDetails.attachNavigate(function(t){if(t.getParameter("direction")==="back"){t.getParameter("content").destroy()}else{this._navigateToSemanticObjectDetails(t)}}.bind(this));this._oSelectionDetails.attachActionPress(function(t){var e=[];t.getParameter("items").forEach(function(t){e.push(t.getBindingContext())});this.fireSelectionDetailsActionPress({id:t.getParameter("id"),action:t.getParameter("action"),itemContexts:e,level:t.getParameter("level")})}.bind(this));this._oSelectionDetails.attachBeforeOpen(function(t){var e=this._oSelectionDetails.getItems();e.forEach(function(t){var e=this._getDetailsActionsClones();e.selectionDetailsItemActions.forEach(function(e){t.addAction(e)})}.bind(this));var i=this._getDetailsActionsClones().selectionDetailsActions;this._oSelectionDetails.removeAllActions();i.forEach(function(t){this._oSelectionDetails.addAction(t)}.bind(this));var a=this._getDetailsActionsClones().selectionDetailsActionGroups;this._oSelectionDetails.removeAllActionGroups();a.forEach(function(t){this._oSelectionDetails.addActionGroup(t)}.bind(this))}.bind(this));this._oSelectionDetails.attachBeforeClose(function(t){if(this._oNavigationContainer){this._oNavigationContainer.destroy()}}.bind(this));this._oToolbar.addContent(this._oSelectionDetails);this._addDrillDownTextButton()};gt.prototype._getDetailsActionsClones=function(){var t={selectionDetailsItemActions:[],selectionDetailsActions:[],selectionDetailsActionGroups:[]};this.getSelectionDetailsItemActions().forEach(function(e){t.selectionDetailsItemActions.push(e.clone())});this.getSelectionDetailsActions().forEach(function(e){t.selectionDetailsActions.push(e.clone())});this.getSelectionDetailsActionGroups().forEach(function(e){t.selectionDetailsActionGroups.push(e.clone())});return t};gt.prototype._addDownloadButton=function(){if(!this._oDownloadButton){this._oDownloadButton=new s(this.getId()+"btnDownload",{type:"Transparent",text:this._oRb.getText("CHART_DOWNLOADBTN_TEXT"),tooltip:this._oRb.getText("CHART_DOWNLOADBTN_TOOLTIP"),icon:"sap-icon://download",visible:this.getShowDownloadButton(),enabled:false,press:function(t){if(window.navigator&&window.navigator.msSaveOrOpenBlob){var e=new window.Blob([this._getVizFrame().exportToSVGString()],{type:"image/svg+xml"});window.navigator.msSaveOrOpenBlob(e)}else{this._downloadChartPNG()}}.bind(this)});this._oToolbar.addContent(this._oDownloadButton)}};gt.prototype._downloadChartSVG=function(){var t=this.getHeader();var e=document.createElement("a");e.setAttribute("href","data:image/svg+xml,"+encodeURIComponent(this._getVizFrame().exportToSVGString()));e.setAttribute("download",t?t:"Chart"+".svg");e.click()};gt.prototype._downloadChartPNG=function(){var t=this.getHeader();var e=this._getVizFrame().exportToSVGString();var i=document.createElement("canvas");var a=i.getContext("2d");var r=new Image;r.width=i.width=document.getElementById(this._oChart.getId()).offsetWidth;r.height=i.height=document.getElementById(this._oChart.getId()).offsetHeight;r.onload=function(){a.drawImage(r,0,0);var e=document.createElement("a");e.setAttribute("href",i.toDataURL());e.setAttribute("download",t?t:"Chart"+".png");e.click()};r.setAttribute("crossOrigin","anonymous");r.src="data:image/svg+xml,"+encodeURIComponent(e)};gt.prototype._addFullScreenButton=function(){var t;if(this.getShowFullScreenButton()){t=new s(this.getId()+"-btnFullScreen",{type:"Transparent",press:function(){this._toggleFullScreen(!this.bFullScreen)}.bind(this),enabled:false});this.oFullScreenButton=t;this._renderFullScreenButton();this._oToolbar.addContent(t)}};gt.prototype._addZoomInOutButtons=function(){var t=this;this._oZoomInButton=new s(this.getId()+"-btnZoomIn",{type:"Transparent",text:this._oRb.getText("CHART_ZOOMINBTN_TEXT"),tooltip:this._oRb.getText("CHART_ZOOMINBTN_TOOLTIP"),icon:"sap-icon://zoom-in",press:function(){if(t._oChart){t._oChart.zoom({direction:"in"});this._oZoomInPressed=true;this._toggleZoomButtonEnablement()}}.bind(this),visible:this.getShowZoomButtons(),enabled:false});this._oZoomOutButton=new s(this.getId()+"-btnZoomOut",{type:"Transparent",text:this._oRb.getText("CHART_ZOOMOUTBTN_TEXT"),tooltip:this._oRb.getText("CHART_ZOOMOUTBTN_TOOLTIP"),icon:"sap-icon://zoom-out",press:function(){if(t._oChart){t._oChart.zoom({direction:"out"});this._oZoomOutPressed=true;this._toggleZoomButtonEnablement()}}.bind(this),visible:this.getShowZoomButtons(),enabled:false});this._oToolbar.addContent(this._oZoomInButton);this._oToolbar.addContent(this._oZoomOutButton)};gt.prototype._toggleZoomButtonEnablement=function(){var t=this._oChart.getZoomInfo().currentZoomLevel;if(t===undefined){return}else if(t===null){this._oZoomOutButton.setEnabled(false);this._oZoomInButton.setEnabled(false)}else if(t===0){if(this._oZoomInPressed){this._oZoomInButton.focus();this._oZoomInPressed=false}this._oZoomOutButton.setEnabled(false);this._oZoomInButton.setEnabled(true)}else if(t===1){if(this._oZoomOutPressed){this._oZoomOutButton.focus();this._oZoomOutPressed=false}this._oZoomInButton.setEnabled(false);this._oZoomOutButton.setEnabled(true)}else{if(this._oZoomOutButton.getEnabled()==false){this._oZoomOutButton.setEnabled(true)}if(this._oZoomInButton.getEnabled()==false){this._oZoomInButton.setEnabled(true)}}};gt.prototype.setShowZoomButtons=function(t){this.setProperty("showZoomButtons",t);if(this._oZoomInButton){this._oZoomInButton.setVisible(t)}if(this._oZoomOutButton){this._oZoomOutButton.setVisible(t)}return this};gt.prototype.setShowFullScreenButton=function(t){this.setProperty("showFullScreenButton",t);if(this.oFullScreenButton){this.oFullScreenButton.setVisible(t)}return this};gt.prototype.setLegendVisible=function(t){this.setProperty("legendVisible",t);this._setLegendVisible(t);return this};gt.prototype._setLegendVisible=function(t){var e=this._getVizFrame();if(e){e.setLegendVisible(t)}};gt.prototype._getVizFrame=function(){var t=null;if(this._oChart){t=this._oChart.getAggregation("_vizFrame")}return t};gt.prototype._addLegendButton=function(){var t=this;this._oLegendButton=new n(this.getId()+"-btnLegend",{type:"Transparent",text:this._oRb.getText("CHART_LEGENDBTN_TEXT"),tooltip:this._oRb.getText("CHART_LEGENDBTN_TOOLTIP"),icon:"sap-icon://legend",press:function(){t.setLegendVisible(!t.getLegendVisible());this.setPressed(t.getLegendVisible())},pressed:this.getLegendVisible(),visible:this.getShowLegendButton(),enabled:false});this._oToolbar.addContent(this._oLegendButton)};gt.prototype.setShowLegendButton=function(t){this.setProperty("showLegendButton",t);if(this._oLegendButton){this._oLegendButton.setVisible(t)}return this};gt.prototype.setShowSemanticNavigationButton=function(t){this.setProperty("showSemanticNavigationButton",t);if(this._oSemanticalNavButton){this._oSemanticalNavButton.setVisible(t)}else{if(t){this._addSemanticNavigationButton()}}return this};gt.prototype._addSemanticNavigationButton=function(){var t=this;if(!this._oSemanticalNavButton&&this.getShowSemanticNavigationButton()&&this._oToolbar){this._oSemanticalNavButton=new i(this.getId()+"-btnNavigation",{type:"Transparent",text:this._oRb.getText("CHART_SEMNAVBTN"),tooltip:this._oRb.getText("CHART_SEMNAVBTN_TOOLTIP"),visible:this.getShowSemanticNavigationButton(),enabled:false});this._oNavHandler=new I({control:this._oSemanticalNavButton,navigationTargetsObtained:function(t){var e=t.getParameters().mainNavigation;if(e){var i=t.getSource().getBindingContext().getObject();var a=this._getField(t.getSource().getFieldName());var r=w.getTextsFromDisplayBehaviour(a.displayBehaviour,i[a.name],i[a.description]);e.setDescription(r.secondText);t.getParameters().show(r.firstText,e,undefined,undefined)}t.getParameters().show()}.bind(this)});var e=this.getSemanticObjectController();if(e){this._oNavHandler.setSemanticObjectController(e)}this._oSemanticalNavButton.attachPress(function(e){if(this._aSemanticObjects&&this._aSemanticObjects.length>0){if(this._aSemanticObjects.length===1){var i=T.getSemanticObjectsFromProperty(this._aSemanticObjects[0]);if(i){this._oNavHandler.setFieldName(this._aSemanticObjects[0].name);this._oNavHandler.setSemanticObject(i.defaultSemanticObject);this._oNavHandler.setAdditionalSemanticObjects(i.additionalSemanticObjects);this._oNavHandler.openPopover()}}else{t._semanticObjectList(this._aSemanticObjects,this._oNavHandler)}}}.bind(this));if(this._oChart){this._attachDataPointHandling()}else{this.attachInitialized(function(){this._attachDataPointHandling()}.bind(this))}var a=this._indexOfSpacerOnToolbar();this._oToolbar.insertContent(this._oSemanticalNavButton,a+1)}};gt.prototype._attachDataPointHandling=function(){if(this._oChart){this._oChart.attachDeselectData(function(){this._aSemanticObjects=this._setSelectionDataPointHandling(this._oNavHandler)}.bind(this));this._oChart.attachSelectData(function(){this._aSemanticObjects=this._setSelectionDataPointHandling(this._oNavHandler)}.bind(this))}};gt.prototype.setSelectionMode=function(t){this.setProperty("selectionMode",t);if(this._oChart){this._oChart.setSelectionMode(t)}return this};gt.prototype._setSelectionDataPointHandling=function(t){var e=this._setSelectionDataPoint(t);if(e&&e.length>0){this._oSemanticalNavButton.setEnabled(true)}else{this._oSemanticalNavButton.setEnabled(false)}return e};gt.prototype._setSemanticObjectsContext=function(t){var e,i,a=null;e=t.getParameter("item").getBindingContext();if(e){i=e.getObject();if(i){a=this._determineSemanticObjectsforDetailsPopover(i,e)}}return a};gt.prototype._setSelectionDataPoint=function(t){var e,i,a=null,r;var o=this._oChart.getSelectedDataPoints();if(!o||!o.dataPoints||o.dataPoints.length===0){return a}if(o.dataPoints.length===1){e=o.dataPoints[0].context;if(e){i=e.getObject();if(i){a=this._determineSemanticObjects(i,e);if(a&&a.length>0){t.setBindingContext(e)}}}return a}r=[];for(var s=0;s<o.dataPoints.length;s++){e=o.dataPoints[s].context;if(e){i=e.getObject();if(i){r.push(i)}}}if(r&&r.length>0){a=this._condensBasedOnSameValue(r);if(a&&a.length>0){t.setBindingContext(o.dataPoints[o.dataPoints.length-1].context)}}return a};gt.prototype._condensBasedOnSameValue=function(t){var e=null,i,a,r;e=this._determineSemanticObjects(t[0]);if(e&&e.length>0){for(var o=0;o<e.length;o++){a=e[o];r=a.name;if(this._bAllValuesAreEqual(t,r)){if(!i){i=[]}i.push(a)}}e=i}return e};gt.prototype._bAllValuesAreEqual=function(t,e){var i,a;for(var r=0;r<t.length;r++){i=t[r];if(r===0){a=i[e];continue}if(a!=i[e]){return false}}return true};gt.prototype._semanticObjectList=function(t,e){var i,a,r,o;if(this._oChart){if((!ct||!pt||!dt)&&!this._bSemanticObjectListRequested){ct=sap.ui.require("sap/m/ResponsivePopover");pt=sap.ui.require("sap/m/List");dt=sap.ui.require("sap/m/StandardListItem");if(!ct||!pt||!dt){sap.ui.require(["sap/m/ResponsivePopover","sap/m/List","sap/m/StandardListItem"],yt.bind(this));this._bSemanticObjectListRequested=true;this._oSemanticObjectListAttr={object:t,nav:e}}}if(!ct||!pt||!dt){return}a=new pt({mode:K.SingleSelectMaster,selectionChange:function(t){if(t&&t.mParameters&&t.mParameters.listItem){var a=t.mParameters.listItem.data("semObj");if(a){e.setFieldName(t.mParameters.listItem.data("fieldName"));e.setSemanticObject(a.defaultSemanticObject);e.setAdditionalSemanticObjects(a.additionalSemanticObjects);e.openPopover()}}i.close()}});for(var s=0;s<t.length;s++){o=t[s];r=new dt({title:o.fieldLabel,type:G.Active});r.data("semObj",T.getSemanticObjectsFromProperty(o));r.data("fieldName",o.name);a.addItem(r)}i=new ct({title:this._oRb.getText("CHART_SEMNAVBTN"),showHeader:false,contentWidth:"12rem",placement:W.Left});i.addContent(a);i.openBy(this._oSemanticalNavButton)}};function yt(t,e,i){ct=t;pt=e;dt=i;this._bSemanticObjectListRequested=false;if(!this._bIsBeingDestroyed){this._semanticObjectList(this._oSemanticObjectListAttr.object,this._oSemanticObjectListAttr.nav)}delete this._oSemanticObjectListAttr}gt.prototype._semanticObjectListForDetails=function(t,e){var i,a,r;if(!this._oChart){return undefined}i=new pt({mode:K.SingleSelectMaster,rememberSelections:false,itemPress:function(t){if(t&&t.mParameters&&t.mParameters.listItem){var i=t.mParameters.listItem.data("semObj");if(i){var a=new I({fieldName:t.mParameters.listItem.data("fieldName"),control:t.mParameters.listItem,semanticObject:i.defaultSemanticObject,additionalSemanticObjects:i.additionalSemanticObjects,navigationTargetsObtained:function(t){var i=t.getParameters().mainNavigation;if(i){var a=e.getObject();var r=this._getField(t.getSource().getFieldName());var o=w.getTextsFromDisplayBehaviour(r.displayBehaviour,a[r.name],a[r.description]);i.setDescription(o.secondText);t.getParameters().show(o.firstText,i,undefined,undefined)}t.getParameters().show()}.bind(this)});a._getNavigationContainer().then(function(t){this._oNavigationContainer=t;var e=t.getDirectLink();if(e){a._fireInnerNavigate({text:e.getText(),href:e.getHref()});window.location.href=e.getHref();t.destroy();return}t.attachBeforePopoverOpen(function(){this._oSelectionDetails.setPopoverModal(true)}.bind(this));t.attachAfterPopoverClose(function(){this._oSelectionDetails.setPopoverModal(false)}.bind(this));this._oSelectionDetails.navTo("",t)}.bind(this),function(t){N.error("NavigationContainer could not be determined: "+t)})}}}.bind(this)});R.getDistinctSemanticObjects().then(function(o){for(var s=0;s<t.length;s++){r=t[s];if(r["com.sap.vocabularies.Common.v1.SemanticObject"]&&r["com.sap.vocabularies.Common.v1.SemanticObject"].String&&R.hasDistinctSemanticObject([r["com.sap.vocabularies.Common.v1.SemanticObject"].String],o)){a=new dt({title:r.fieldLabel,type:G.Navigation});a.setBindingContext(e);a.data("semObj",T.getSemanticObjectsFromProperty(r));a.data("fieldName",r.name);i.addItem(a)}}});return i};gt.prototype._determineSemanticObjects=function(t,e){var i,a,r=[];if(t){for(i in t){if(i){a=this._getField(i);if(a&&a.isDimension&&a.isSemanticObject){r.push(a)}}}}if(r){r.sort(function(t,e){return t.fieldLabel.localeCompare(e.fieldLabel)})}return r};gt.prototype._determineSemanticObjectsforDetailsPopover=function(t,e){var i,a,r=[];if(t){for(i in t){if(i){a=this._getField(i);if(a&&a.isDimension&&a.isSemanticObject){r.push(a)}}}}if(r){r.sort(function(t,e){return t.fieldLabel.localeCompare(e.fieldLabel)})}return r};gt.prototype._addDrillUpDownButtons=function(){if(this.getShowDrillButtons()){var t=this;this._oDrillUpButton=new s(this.getId()+"-btnDrillUp",{type:"Transparent",tooltip:this._oRb.getText("CHART_DRILLUPBTN_TOOLTIP"),text:this._oRb.getText("CHART_DRILLUPBTN_TEXT"),icon:"sap-icon://drill-up",press:function(){if(t._oChart){t._oChart.drillUp()}},visible:!this.getShowDrillBreadcrumbs(),enabled:false});this._oDrillDownButton=new s(this.getId()+"-btnDrillDown",{type:"Transparent",text:this._oRb.getText("CHART_DRILLDOWNBTN_TEXT"),icon:"sap-icon://drill-down",press:function(e){t._drillDown(e)},visible:!this.getShowDetailsButton(),enabled:false,ariaHasPopup:k.ListBox});this._oToolbar.addContent(this._oDrillUpButton);this._oToolbar.addContent(this._oDrillDownButton)}};gt.prototype._addDrillDownTextButton=function(){this._oDrillDownTextButton=new i(this.getId()+"-btnDrillDownText",{type:"Transparent",text:this._oRb.getText("CHART_DRILLDOWNBTN_TEXT"),tooltip:this._oRb.getText("CHART_DRILLDOWNBTN_TOOLTIP"),enabled:false,visible:this.getShowDetailsButton(),layoutData:new O({closeOverflowOnInteraction:false}),press:function(t){this._drillDown(t)}.bind(this)});this._oToolbar.addContent(this._oDrillDownTextButton)};gt.prototype.setShowDrillButtons=function(t){this.setProperty("showDrillButtons",t);if(this._oDrillUpButton){this._oDrillUpButton.setVisible(t)}if(this._oDrillDownButton){this._oDrillDownButton.setVisible(t)}return this};gt.prototype._triggerSearchInPopover=function(t,e){var i,a,r,o,s,n;if(!t||!e){return}i=t.getParameters();if(!i){return}s=i.newValue?i.newValue.toLowerCase():"";if(this._oChart){n=e.getItems();for(a=0;a<n.length;a++){o=n[a].getTooltip();r=n[a].getTitle();if(r&&r.toLowerCase().indexOf(s)>-1||o&&o.toLowerCase().indexOf(s)>-1){n[a].setVisible(true)}else{n[a].setVisible(false)}}}};gt.prototype._drillDown=function(t,e){var i=this,a,r,o,s,n,h,l,u,c,p,d;if(this._oChart){if((!ct||!pt||!_t||!ft||!dt)&&!this._bDrillDownRequested){ct=sap.ui.require("sap/m/ResponsivePopover");pt=sap.ui.require("sap/m/List");_t=sap.ui.require("sap/m/Bar");ft=sap.ui.require("sap/m/SearchField");dt=sap.ui.require("sap/m/StandardListItem");if(!ct||!pt||!_t||!ft||!dt){sap.ui.require(["sap/m/ResponsivePopover","sap/m/List","sap/m/Bar","sap/m/SearchField","sap/m/StandardListItem"],vt.bind(this));this._bDrillDownRequested=true;this._oDrillDownSource=t.getSource()}}if(!ct||!pt||!_t||!ft||!dt){return}h=new pt({mode:K.SingleSelectMaster,selectionChange:function(t){if(t&&t.mParameters&&t.mParameters.listItem){if(t.mParameters.listItem.getType()===G.Inactive){return}var e=t.mParameters.listItem.data("dim");if(e){i._oChart.drillDown(e)}}a.close()}});l=new _t;u=new ft({placeholder:this._oRb.getText("CHART_DRILLDOWN_SEARCH")});var _=new M({text:this._oRb.getText("CHART_DRILLDOWN_SEARCH")});u.addAriaLabelledBy(_.getId());u.attachLiveChange(function(t){i._triggerSearchInPopover(t,h)});l.addContentMiddle(_);l.addContentMiddle(u);a=new ct({contentWidth:"25rem",contentHeight:"20rem",placement:W.Bottom,subHeader:l});a.addStyleClass("sapUiCompSmartChartDrillDownPopover");if(y.system.desktop){var _=new M({text:this._oRb.getText("CHART_DRILLDOWN_TITLE")});a.setShowHeader(false);a.addContent(_);a.addAriaLabelledBy(_);if(a.getSubHeader()&&a.getSubHeader().getVisible()&&u.getVisible()&&u.getEnabled()){d=new M({text:this._oRb.getText("CHART_DRILLDOWN_SEARCH_AVAILABLE")});a.addContent(d);a.addAriaLabelledBy(d)}}else{a.setTitle(this._oRb.getText("CHART_DRILLDOWN_TITLE"))}a.addContent(h);r=this._getDrillStackDimensions();o=this._getSortedDimensions();if(o.length<7){l.setVisible(false);d.destroy()}for(c=0;c<o.length;c++){s=o[c];if(r.indexOf(s.getName())>-1){continue}p=this._oChartProvider.getViewField(s.getName());if(!p.filterable&&this._oChart.getSelectedDataPoints().count>0){continue}n=new dt({title:s.getLabel(),type:G.Active});n.data("dim",s);h.addItem(n)}a.openBy(t?t.getSource():e)}};function vt(t,e,i,a,r){ct=t;pt=e;_t=i;ft=a;dt=r;this._bDrillDownRequested=false;if(!this._bIsBeingDestroyed){this._drillDown(null,this._oDrillDownSource)}delete this._oDrillDownSource}gt.prototype._navigateToSemanticObjectDetails=function(t){var e=this._setSemanticObjectsContext(t);if(e&&e.length>0){if(e.length===1){var i=T.getSemanticObjectsFromProperty(e[0]);if(i){var a=t.getParameter("item");var r=new I({fieldName:e[0].name,control:a,semanticObject:i.defaultSemanticObject,additionalSemanticObjects:i.additionalSemanticObjects,navigationTargetsObtained:function(t){var e=t.getParameters().mainNavigation;if(e){var i=a.getBindingContext().getObject();var r=this._getField(t.getSource().getFieldName());var o=w.getTextsFromDisplayBehaviour(r.displayBehaviour,i[r.name],i[r.description]);e.setDescription(o.secondText);t.getParameters().show(o.firstText,e,undefined,undefined)}t.getParameters().show()}.bind(this)});r._getNavigationContainer().then(function(t){this._oNavigationContainer=t;this._oNavigationContainer.attachBeforePopoverOpen(function(){this._oSelectionDetails.setPopoverModal(true)}.bind(this));this._oNavigationContainer.attachAfterPopoverClose(function(){this._oSelectionDetails.setPopoverModal(false)}.bind(this));this._oSelectionDetails.navTo("",this._oNavigationContainer)}.bind(this),function(t){N.error("NavigationContainer could not be determined")})}}else{var o=t.getParameter("item").getBindingContext();if((!pt||!dt)&&!this._bObjectListRequested){pt=sap.ui.require("sap/m/List");dt=sap.ui.require("sap/m/StandardListItem");if(!pt||!dt){sap.ui.require(["sap/m/List","sap/m/StandardListItem"],Tt.bind(this));this._bObjectListRequested=true;this._oObjectListAttr={context:o,objects:e}}}if(pt&&dt){var s=this._semanticObjectListForDetails(e,o);this._oSelectionDetails.navTo(this._oRb.getText("CHART_SEMNAVBTN"),s)}}}};function Tt(t,e){pt=t;dt=e;this._bObjectListRequested=false;if(!this._bIsBeingDestroyed){var i=this._semanticObjectListForDetails(this._oObjectListAttr.objects,this._oObjectListAttr.context);this._oSelectionDetails.navTo(this._oRb.getText("CHART_SEMNAVBTN"),i)}delete this._oObjectListAttr}gt.prototype._addHeaderToToolbar=function(){if(this._oToolbar){if(!this._headerText){this._headerText=new P({});this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartChartHeader")}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0)}};gt.prototype._addSeparatorToToolbar=function(){if(this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oSeparator=new h;this._oToolbar.insertContent(this._oSeparator,0);if(!this._oToolbar.getHeight()){this._oToolbar.setHeight("auto")}}else if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator)}};gt.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0)}else if(this._oVariantManagement){this._oToolbar.removeContent(this._oVariantManagement)}}};gt.prototype._addSpacerToToolbar=function(){if(this._indexOfSpacerOnToolbar()===-1){this._oToolbar.addContent(new l)}};gt.prototype._indexOfSpacerOnToolbar=function(){var t=this._oToolbar.getContent(),e,i;if(t){i=t.length;e=0;for(e;e<i;e++){if(t[e]instanceof l){return e}}}return-1};gt.prototype._getP13NSettings=function(){return{dimeasure:{visible:true,payload:{availableChartTypes:this.getAvailableChartTypes()}},sort:{visible:true},filter:{visible:true},contentWidth:"48rem"}};gt.prototype._addPersonalisationToToolbar=function(){if(this.getUseChartPersonalisation()){if(!this._oChartPersonalisationButton){this._oChartPersonalisationButton=new s(this.getId()+"-btnPersonalisation",{type:"Transparent",icon:"sap-icon://action-settings",text:this._oRb.getText("CHART_PERSOBTN_TEXT"),tooltip:this._oRb.getText("CHART_PERSOBTN_TOOLTIP"),press:function(t){if(this._oPersController){this._oPersController.openDialog(this._getP13NSettings())}}.bind(this),enabled:false})}this._oToolbar.addContent(this._oChartPersonalisationButton)}else if(this._oChartPersonalisationButton){this._oToolbar.removeContent(this._oChartPersonalisationButton)}};gt.prototype.getVariantManagement=function(){return this._oVariantManagement};gt.prototype.openDialogForKeyUser=function(t,e){this._fGetDataForKeyUser=e;var i=this._getP13NSettings();i.styleClass=t;i.showReset=false;this._oPersController.openDialog(i)};gt.prototype._cleanUpKeyUser=function(){this._fGetDataForKeyUser=null};gt.prototype._createKeyUserChange=function(){return[{selectorControl:this._oVariantManagement._getPersoController(),changeSpecificData:{changeType:"variantContent",content:{key:this._oVariantManagement.getSelectionKey(),persistencyKey:this.getPersistencyKey(),content:this.fetchVariant()}}}]};gt.prototype._addChartTypeToToolbar=function(){this._oChartTypeButton=this._createChartTypeButton();this._oToolbar.addContent(this._oChartTypeButton)};gt.prototype._createChartTypeButton=function(){var t=new s(this.getId()+"-btnChartType",{visible:this.getShowChartTypeSelectionButton(),enabled:false,type:"Transparent",text:this._oRb.getText("CHART_TYPEBTN_TEXT"),ariaHasPopup:k.ListBox,layoutData:new O({closeOverflowOnInteraction:false}),press:function(t){this._displayChartTypes(t)}.bind(this)});return t};gt.prototype._displayChartTypes=function(t,e){var i=this,a,r,o,s,n=false;if(this._bAvailableChartListIsOpen){return}if(this._oChart&&(t||e)){if((!ct||!pt||!_t||!ft||!dt)&&!this._bChartTypesRequested){ct=sap.ui.require("sap/m/ResponsivePopover");pt=sap.ui.require("sap/m/List");_t=sap.ui.require("sap/m/Bar");ft=sap.ui.require("sap/m/SearchField");dt=sap.ui.require("sap/m/StandardListItem");if(!ct||!pt||!_t||!ft||!dt){sap.ui.require(["sap/m/ResponsivePopover","sap/m/List","sap/m/Bar","sap/m/SearchField","sap/m/StandardListItem"],St.bind(this));this._bChartTypesRequested=true;this._oChartTypesSource=t.getSource()}}if(!ct||!pt||!_t||!ft||!dt){return}var h=t?t.getSource():e;var l=new dt({title:"{$smartChartTypes>text}",icon:"{$smartChartTypes>icon}",selected:"{$smartChartTypes>selected}"});r=new pt({mode:K.SingleSelectMaster,items:{path:"$smartChartTypes>/items",template:l},selectionChange:function(t){if(t&&t.mParameters&&t.mParameters.listItem){var e=t.mParameters.listItem.getBinding("title");if(e){var r=e.getContext();if(r){var o=r.getObject();if(o&&o.key){i._setChartType(o.key);i._enrichPassedButton(i._oChartTypeButton,i._oChart.getChartType())}}}}n=true;i._rerenderControlInFullscreen();a.close()}});o=new _t;s=new ft({placeholder:this._oRb.getText("CHART_TYPE_SEARCH")});s.attachLiveChange(function(t){i._triggerSearchInPopover(t,r)});o.addContentRight(s);a=new ct({placement:W.Bottom,subHeader:o,contentWidth:"25rem"});a.addStyleClass("sapUiCompSmartChartTypePopover");a.attachAfterClose(function(t){if(!n){}i._bAvailableChartListIsOpen=false});a.setModel(this.getModel("$smartChartTypes"),"$smartChartTypes");if(y.system.desktop){var u=new M({text:this._oRb.getText("CHART_TYPELIST_TEXT")});a.setShowHeader(false);a.addContent(u);a.addAriaLabelledBy(u)}else{a.setTitle(this._oRb.getText("CHART_TYPELIST_TEXT"))}a.addContent(r);if(r.getItems().length<7){o.setVisible(false)}this._bAvailableChartListIsOpen=true;a.openBy(h)}};function St(t,e,i,a,r){ct=t;pt=e;_t=i;ft=a;dt=r;this._bChartTypesRequested=false;if(!this._bIsBeingDestroyed){this._displayChartTypes(null,this._oChartTypesSource)}delete this._oChartTypesSource}var Dt={bar:"sap-icon://horizontal-bar-chart",bullet:"sap-icon://horizontal-bullet-chart",bubble:"sap-icon://bubble-chart",column:"sap-icon://vertical-bar-chart",combination:"sap-icon://business-objects-experience",dual_bar:"sap-icon://horizontal-bar-chart",dual_column:"sap-icon://vertical-bar-chart",dual_combination:"sap-icon://business-objects-experience",dual_horizontal_combination:"sap-icon://business-objects-experience",dual_horizontal_stacked_combination:"sap-icon://business-objects-experience",dual_line:"sap-icon://line-chart",dual_stacked_bar:"sap-icon://full-stacked-chart",dual_stacked_column:"sap-icon://vertical-stacked-chart",dual_stacked_combination:"sap-icon://business-objects-experience",donut:"sap-icon://donut-chart",heatmap:"sap-icon://heatmap-chart",horizontal_stacked_combination:"sap-icon://business-objects-experience",line:"sap-icon://line-chart",pie:"sap-icon://pie-chart",scatter:"sap-icon://scatter-chart",stacked_bar:"sap-icon://full-stacked-chart",stacked_column:"sap-icon://vertical-stacked-chart",stacked_combination:"sap-icon://business-objects-experience",treemap:"sap-icon://Chart-Tree-Map",vertical_bullet:"sap-icon://vertical-bullet-chart","100_dual_stacked_bar":"sap-icon://full-stacked-chart","100_dual_stacked_column":"sap-icon://vertical-stacked-chart","100_stacked_bar":"sap-icon://full-stacked-chart","100_stacked_column":"sap-icon://full-stacked-column-chart",waterfall:"sap-icon://vertical-waterfall-chart",horizontal_waterfall:"sap-icon://horizontal-waterfall-chart"};gt.prototype._rerenderControlInFullscreen=function(){if(this.bFullScreen){this._oChart.setLayoutData(new r({baseSize:"100%"}));this.invalidate(this._oChart)}};gt.prototype._getMatchingIcon=function(t){var e=Dt[t];if(!e){e=""}return e};gt.prototype._enrichPassedButton=function(t,e,i){if(!t){return}if(i===undefined){i=e;var a=this._retrieveChartTypeDescription(e);if(a&&a.text){i=a.text}}t.data("chartType",e);var r=this._getMatchingIcon(e);t.setIcon(r?r:"sap-icon://vertical-bar-chart");var o=this._oChart.getChartType()===e?"CHART_TYPE_TOOLTIP":"CHART_TYPE_UNSEL_TOOLTIP";t.setTooltip(this._oRb.getText(o,[i]))};gt.prototype._updateAvailableChartType=function(){var t=this,e,i,a=[];e=this.getModel("$smartChartTypes");if(!e){return}i={items:a};var r=this._oChart.getChartType();this.getAvailableChartTypes().forEach(function(e){var i={key:e.key,text:e.text,icon:t._getMatchingIcon(e.key),selected:r===e.key};a.push(i)});e.setData(i);if(this._oSegmentedButton){this._updateVisibilityOfChartTypes(this._oSegmentedButton)}this._updateVizTooltipFormatter()};gt.prototype._createPersonalizationController=function(){if(this._oPersController){return}var t=this.data("p13nDialogSettings");if(typeof t==="string"){try{t=JSON.parse(t)}catch(e){t=null}}t=this._setIgnoreFromPersonalisationToSettings(t);t=t||{};var e=F.createChartWrapper(this._oChart,this._oChart.data("p13nData"),this._aColumnKeysOrdered);if(this.$()&&this.$().closest(".sapUiSizeCompact").length>0){this._oChart.addStyleClass("sapUiSizeCompact")}var i=this._oChart.setVisibleMeasures;var a=function(t,e){this.setProperty("visibleMeasures",t,e);var i=this._getDrillStateTop();if(!this._bIsInitialized){this._createDrillStack()}else{i.measures=this.getProperty("visibleMeasures")}if(!e){this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}})}return this}.bind(this._oChart);this._oPersController=new L(this.getId()+"-persoController",{table:e,setting:t,resetToInitialTableState:!this.getUseVariantManagement(),afterP13nModelDataChange:this._personalisationModelDataChange.bind(this),beforePotentialTableChange:function(t){this._oChart.setVisibleMeasures=a}.bind(this),afterPotentialTableChange:function(t){this._oChart.setVisibleMeasures=i}.bind(this)});this._oPersController.attachDialogConfirmedReset(function(){if(this._oDrillBreadcrumbs){this._updateDrillBreadcrumbs()}var t=sap.ui.getCore().byId(this.getId()+"-btnChartType");if(t){this._enrichPassedButton(t,this._oChart.getChartType())}}.bind(this));this._oPersController.attachDialogAfterClose(function(t){if(this._fGetDataForKeyUser){if(t.getParameter("cancel")){this._fGetDataForKeyUser([])}this._cleanUpKeyUser()}}.bind(this))};gt.prototype._setIgnoreFromPersonalisationToSettings=function(t){var e=C.createArrayFromString(this.getIgnoreFromPersonalisation());if(e.length){if(!t){t={}}var i=function(i){if(!t[i]){t[i]={}}t[i].ignoreColumnKeys=e};i("dimeasure");i("filter");i("sort")}return t};gt.prototype._personalisationModelDataChange=function(t){this._oCurrentVariant=t.getParameter("persistentData");if(this._fGetDataForKeyUser){this._fGetDataForKeyUser(this._createKeyUserChange())}var e=t.getParameter("runtimeDeltaDataChangeType");var i=this._getChangeStatus(e);if(i===X.Unchanged){return}this._fireChartDataChanged(e);if(!this._bApplyingVariant){if(!this.getUseVariantManagement()){this._persistPersonalisation()}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true)}}this._updateAvailableChartType();this._enrichPassedButton(this._oChartTypeButton,this._oChart.getChartType());this._checkDimensionColoring();if(!this._bDisableTimeseriesUTC&&!this._oChart.getVizProperties().general.showAsUTC){try{if(!this._oChart.getVizProperties().general.showAsUTC){this._oChart.setVizProperties({general:{showAsUTC:true}})}if(this._bWorkaroundVizFormatter){this._oChart.setVizProperties({timeAxis:{levelConfig:{day:{visible:true,formatString:"MediumDay"},month:{visible:true,formatString:"MediumMonth"}}}})}}catch(t){N.error("Couldn't set showAsUTC=true")}}if(i===X.TableChanged){if(this._oSemanticalNavButton){this._oSemanticalNavButton.setEnabled(false)}}else if(i===X.ModelChanged&&this._bIsChartBound){if(this._oSmartFilter){this._oSmartFilter.search()}else{this._reBindChart()}}if(this._oDrillBreadcrumbs){this._updateDrillBreadcrumbs()}this.fireUiStateChange()};gt.prototype._fireChartDataChanged=function(t){var e={dimeasure:false,filter:false,sort:false};for(var i in t){if(t[i]!=="Unchanged"){e[i]=true}}this.fireChartDataChanged({changeTypes:e})};gt.prototype._getChangeStatus=function(t){if(!t){return X.ModelChanged}if(t.sort===X.ModelChanged||t.filter===X.ModelChanged||t.dimeasure===X.ModelChanged||t.group===X.ModelChanged){return X.ModelChanged}if(t.sort===X.TableChanged||t.filter===X.TableChanged||t.dimeasure===X.TableChanged||t.group===X.TableChanged){return X.TableChanged}return X.Unchanged};gt.prototype.setEntitySet=function(t){this.setProperty("entitySet",t);this._initialiseMetadata();return this};gt.prototype.propagateProperties=function(){u.prototype.propagateProperties.apply(this,arguments);this._initialiseMetadata()};gt.prototype._initialiseMetadata=function(){if(!this._bMetadataIsInitialised){v.handleModelInit(this,this._onMetadataInitialised,true)}};gt.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(!this._bMetadataIsInitialised){this._listenToSmartFilter();this._createToolbar();this._createVariantManagementControl();this._createToolbarContent();this._bMetadataIsInitialised=true;if(mt){this._initialiseInnerChart()}if(x.getActive()){x.end("SmartChartInit")}if(!this._oVariantManagement||this._oVariantManagement&&this._bVariantInitialised){this._checkAndTriggerBinding()}}};gt.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){this._oSmartFilter.search()}else{this._reBindChart()}}else if(!this._oChart){this._createTempNoData()}}};gt.prototype._createTempNoData=function(){var t=new a({text:this.getNoData()});this._oNoDataStruct=new u({items:[t],justifyContent:"Center",alignItems:"Center",height:"100%"});this.insertItem(this._oNoDataStruct,2)};gt.prototype._createChartProvider=function(){var t,e;e=this.getEntitySet();t=this.getModel();if(t&&!this._bChartCreated){this._aAlwaysSelect=[];this._aInitialSorters=[];this._addDrillBreadcrumbs();this._bChartCreated=true}if(t&&e){this._oChartProvider=new c({entitySet:e,ignoredFields:this.getIgnoredFields(),dateFormatSettings:this.data("dateFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDimensionDisplayBehaviour"),skipAnnotationParse:this.data("skipAnnotationParse"),chartQualifier:this.data("chartQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),model:t,chartLibrary:Y,useTimeSeries:this.getActivateTimeSeries(),notAssignedText:this.getNotAssignedText()})}};gt.prototype._listenToSmartFilter=function(){this._fetchSmartFilter();if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindChart,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this)}};gt.prototype.setNoData=function(t){if(this._oChart){this._oChart.setCustomMessages({NO_DATA:t})}this.setProperty("noData",t);return this};gt.prototype.getNoData=function(){var t=this.getProperty("noData");if(!this.getProperty("noData")){if(!this._oChart){this._fetchSmartFilter();if(this._oSmartFilter){t=this._oRb.getText("CHART_NO_DATA")}else{t=this._oRb.getText("CHART_NO_DATA_WITHOUT_FILTERBAR")}}else{t=this._oRb.getText("CHART_NO_RESULTS")}}return t};gt.prototype._fetchSmartFilter=function(){var t=null;t=this.getSmartFilterId();this._oSmartFilter=this._findControl(t)};gt.prototype._filterChangeEvent=function(){if(this._bIsChartBound&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true)}};gt.prototype._adjustOverlayHeight=function(){if(y.browser.safari||y.browser.chrome){var t=this._oChart.$(),e=t.find(".sapUiCompSmartChartOverlay");if(e.length===1){e.height(t.height())}}};gt.prototype._renderOverlay=function(t){if(this._oChart){var e=this._oChart.$(),i=e.find(".sapUiCompSmartChartOverlay");if(t&&i.length===0){i=jQuery("<div>").addClass("sapUiOverlay sapUiCompSmartChartOverlay").css("z-index","1");e.append(i);this._adjustOverlayHeight();this.sOverlayResizeListenerId=z.register(e,this._adjustOverlayHeight.bind(this))}else if(!t){i.remove();z.deregister(this.sOverlayResizeListenerId)}}};gt.prototype.showOverlay=function(t){this._showOverlay(t)};gt.prototype._showOverlay=function(t){if(t){var e={show:true};this.fireShowOverlay({overlay:e});t=e.show}this._hasOverlay=t;this._renderOverlay(t)};gt.prototype._findControl=function(t){var e,i;if(t){e=sap.ui.getCore().byId(t);if(!e){i=this._getView();if(i){e=i.byId(t)}}}return e};gt.prototype._getView=function(){if(!this._oView){var t=this.getParent();while(t){if(t.isA("sap.ui.core.mvc.View")){this._oView=t;break}t=t.getParent()}}return this._oView};gt.prototype._updateInResultDimensions=function(){var t=this._getInResultDimensionTotal();var e=function(t){var e=this._oChart.getInResultDimensions();if(e.length!=t.length){return false}for(var i=0,a=e.length;i<a;i++){if(e[i]!=t[i]){return false}}return true}.bind(this);if(t.length>0&&!e(t)){this._oChart.setInResultDimensions(t)}};gt.prototype._initialiseInnerChart=function(){this._createChart();this._createChartProvider();if(this._oChartProvider){this._oChartViewMetadata=this._oChartProvider.getChartViewMetadata();if(this._oChartViewMetadata){this._assignData();this._createContent();this._createPersonalizationController();this._oChart.attachRenderComplete(this._toggleZoomButtonEnablement,this);this._oSelectionDetails.attachSelectionHandler("_selectionDetails",this._oChart);this._enrichPassedButton(this._oChartTypeButton,this._oChart.getChartType());this._enableToolbarButtons();this._checkDimensionColoring();this._updateDrillBreadcrumbs();this.bIsInitialised=true;this.fireInitialise();this.fireInitialized();this.applyVariant(this.fetchVariant())}}};gt.prototype._enableToolbarButtons=function(){if(this._oDrillUpButton&&this._oDrillDownButton){this._oDrillUpButton.setEnabled(true);this._oDrillDownButton.setEnabled(true)}if(this._oDrillDownTextButton){this._oDrillDownTextButton.setEnabled(true)}if(this._oLegendButton){this._oLegendButton.setEnabled(true)}if(this._oZoomInButton&&this._oZoomOutButton){this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(true)}if(this._oDownloadButton){this._oDownloadButton.setEnabled(true)}if(this._oChartPersonalisationButton){this._oChartPersonalisationButton.setEnabled(true)}if(this.oFullScreenButton){this.oFullScreenButton.setEnabled(true)}if(this._oChartTypeButton){this._oChartTypeButton.setEnabled(true)}};function Bt(t,e,i,a,r,o,s,n,h,l){Y=t;Q=e;tt=i;it=a;at=r;rt=o;ot=s;st=n;ht=h;et=l;this._bChartRequested=false;if(!this._bIsBeingDestroyed){this._reBindChart()}}gt.prototype.rebindChart=function(){if(!this._bMetadataIsInitialised){N.error("rebindChart method called before the metadata is initialized. Please execute the UI5 Support Assistant 'SmartChart' rules to get more information",this.getId(),"sap.ui.comp.smartChart")}this._reBindChart()};gt.prototype._reBindChart=function(){var t,e,i=[],a,r,o,s={},n={preventChartBind:false};if(!this._oChart){if((!Y||!Q||!it||!at||!rt||!ot||!ht)&&!this._bChartRequested){Y=sap.ui.require("sap/chart/library");Q=sap.ui.require("sap/chart/Chart");tt=sap.ui.require("sap/chart/ColoringType");it=sap.ui.require("sap/chart/data/Dimension");at=sap.ui.require("sap/chart/data/HierarchyDimension");rt=sap.ui.require("sap/chart/data/TimeDimension");ot=sap.ui.require("sap/chart/data/Measure");st=sap.ui.require("sap/chart/data/MeasureSemantics");ht=sap.ui.require("sap/viz/ui5/controls/VizTooltip");et=sap.ui.require("sap/viz/ui5/format/ChartFormatter");if(!Y||!Q||!it||!at||!rt||!ot||!ht){sap.ui.getCore().loadLibrary("sap.chart",{async:true}).then(function(){sap.ui.require(["sap/chart/library","sap/chart/Chart","sap/chart/ColoringType","sap/chart/data/Dimension","sap/chart/data/HierarchyDimension","sap/chart/data/TimeDimension","sap/chart/data/Measure","sap/chart/data/MeasureSemantics","sap/viz/ui5/controls/VizTooltip","sap/viz/ui5/format/ChartFormatter"],Bt.bind(this));this._bChartRequested=true}.bind(this))}}if(!Y||!Q||!it||!at||!rt||!ot||!ht){return}this._initialiseInnerChart()}t=this._getChartPersonalisationData()||{};a=t.filters;r=t.excludeFilters;o=t.sorters;if(this._oSmartFilter){e=this._oSmartFilter.getFilters();s=this._oSmartFilter.getParameters()||{}}if(e&&e.length){if(r){i=[new g([e[0],r],true)]}else{i=e}}else if(r){i=[r]}if(a){a=i.concat(a)}else{a=i}this._updateInResultDimensions();s["entitySet"]=this.getEntitySet();if(!o){o=[]}n.filters=a;n.sorter=o;n.parameters=s;n.events={};this.fireBeforeRebindChart({bindingParams:n});if(!n.preventChartBind&&this._oChartViewMetadata){o=n.sorter;a=n.filters;s=n.parameters;this._oChart.setBusy(true);this._bDataLoadPending=true;gt._addBindingListener(n,"change",this._onDataLoadComplete.bind(this));gt._addBindingListener(n,"dataReceived",this._onDataReceived.bind(this));var h={path:this.getChartBindingPath()||"/"+this.getEntitySet(),parameters:s,filters:a,events:n.events};if(!this._bIsChartBound){h.sorter=o}if(n.length){h.length=n.length}else{var l=this._oChartProvider.getMaxItems();if(l>0){h.length=l}}this._oChart.bindData(h);if(this._bIsChartBound){this._oChart.getBinding("data").sort(o)}this._showOverlay(false);this._bIsChartBound=true}};gt.prototype._validateSorters=function(t){var e=[];var i=this._oChart.getVisibleDimensions().concat(this._oChart.getVisibleMeasures());if(t){t.forEach(function(t){i.forEach(function(i){if(t.sPath===i){e.push(t)}})})}return e};gt.prototype._onDataReceived=function(t){if(t&&t.getParameter&&t.getParameter("__simulateAsyncAnalyticalBinding")){return}this._onDataLoadComplete(t,true);this.fireDataReceived(t)};gt._addBindingListener=function(t,e,i){if(!t.events){t.events={}}if(!t.events[e]){t.events[e]=i}else{var a=t.events[e];t.events[e]=function(){i.apply(this,arguments);a.apply(this,arguments)}}};gt.prototype._onDataLoadComplete=function(t,e){if(this._oSemanticalNavButton){this._oSemanticalNavButton.setEnabled(false)}if(this._bDataLoadPending||e){this._bDataLoadPending=false;this._updateAvailableChartType();this._oChart.setBusy(false)}};gt.prototype._assignData=function(){if(this._oChartViewMetadata&&this._oChart){this._oChart.resetLayout();if(this._oChartViewMetadata.measureFields&&this._oChartViewMetadata.measureFields.length>0){this._oChart.setVisibleMeasures(this._oChartViewMetadata.measureFields)}if(this._oChartViewMetadata.dimensionFields&&this._oChartViewMetadata.dimensionFields.length>0){this._oChart.setVisibleDimensions(this._oChartViewMetadata.dimensionFields)}if(!this.getChartType()&&this._oChartViewMetadata.chartType){this._setChartType(this._oChartViewMetadata.chartType)}}};gt.prototype._createP13nObject=function(t){if(t.sortable&&t.sorted){var e={columnKey:t.name,operation:t.sortOrder};if(t.sortIndex!=null){this._aInitialSorters.splice(t.sortIndex,0,e)}else{this._aInitialSorters.push(e)}}return{columnKey:t.name,leadingProperty:t.name,additionalProperty:t.additionalProperty,sortProperty:t.sortable?t.name:undefined,filterProperty:t.filterable?t.name:undefined,fullName:t.hasValueListAnnotation?t.fullName:null,type:t.filterType,typeInstance:t.modelType,maxLength:t.maxLength,precision:t.precision,scale:t.scale,isMeasure:t.isMeasure,isDimension:t.isDimension,isHierarchyDimension:t.isHierarchyDimension,hierarchyLevel:t.hierarchyLevel,aggregationRole:t.aggregationRole,label:t.label,tooltip:t.quickInfo,sorted:t.sorted,sortOrder:t.sortOrder,criticality:t.valueCriticality}};gt.prototype._createContent=function(){var t,e=0,i,a,r,o=[],s;var n=[];this._aColumnKeysOrdered=[];Object.assign(this._aColumnKeysOrdered,this._oChartViewMetadata.dimensionFields);this._aColumnKeysOrdered=this._aColumnKeysOrdered.concat(this._oChartViewMetadata.measureFields);e=this._oChartViewMetadata.fields.length;var h=this._oChartViewMetadata.dimensionFields||[];var l=this._oChartViewMetadata.measureFields||[];for(t=0;t<e;t++){a=null;i=this._oChartViewMetadata.fields[t];i.label=i.fieldLabel||i.name;if(this._aColumnKeysOrdered.indexOf(i.name)===-1){this._aColumnKeysOrdered.push(i.name)}if(this._oChart.getDimensionByName(i.name)===undefined&&this._oChart.getMeasureByName(i.name)===undefined){s=this._createP13nObject(i);r={name:i.name,label:i.label,tooltip:i.quickInfo}}if(i.inResult){this._aAlwaysSelect.push(i.name)}if(i.isDimension||i.isHierarchyDimension||h.indexOf(i.name)!=-1){if(this._oChart.getDimensionByName(i.name)===undefined){if(i.isDimension){if(i.isTimeDimension&&this.getActivateTimeSeries()){a=new rt(r);var u=i.timeUnitType;if(E.hasOwnProperty(i.timeUnitType)){a.setTimeUnit(E[u])}if(!this._bDisableTimeseriesUTC){try{a._setIsUTC(true)}catch(t){N.error("Couldn't set UTC settings on TimeDimension")}}}else{a=new it(r)}}else{r.level=i.hierarchyLevel;a=new at(r)}this._oChart.addDimension(a);if(i.description&&(!i.isTimeDimension||!this.getActivateTimeSeries())){a.setTextProperty(i.description);a.setTextFormatter(w.getFormatterFunctionFromDisplayBehaviour(i.displayBehaviour,false,this))}else if(i.dateFormatter&&(!i.isTimeDimension||!this.getActivateTimeSeries())){a.setTextFormatter(i.dateFormatter)}else if(i.isDimension&&(!i.isTimeDimension||!this.getActivateTimeSeries())){a.setTextFormatter(function(t,e){if(t===""){return this.getNotAssignedText()}else{return t}}.bind(this))}}else{var c=this._oChart.getDimensionByName(i.name).data("p13nData");if(c){this._oChart.getDimensionByName(i.name).data("p13nData",typeof c==="string"?JSON.parse(c):c)}}}else if(i.isMeasure||l.indexOf(i.name)!=-1){if(this._oChart.getMeasureByName(i.name)===undefined){a=new ot(r);this._oChart.addMeasure(a);if(i.dataPoint){n.push({dataPoint:i.dataPoint,measure:a})}if(i.unit){a.setUnitBinding(i.unit)}}else{var c=this._oChart.getMeasureByName(i.name).data("p13nData");if(c){this._oChart.getMeasureByName(i.name).data("p13nData",typeof c==="string"?JSON.parse(c):c)}}}else if(i.sortable||i.filterable){o.push(s)}if(a){if(i.role){a.setRole(i.role)}a.data("p13nData",s)}}if(this._oChart){this._oChart.data("p13nData",o)}if(n.length>0){this._enrichFromDataPoints(n)}};gt.prototype._getField=function(t){var e,i,a;if(t&&this._oChartViewMetadata&&this._oChartViewMetadata.fields){a=this._oChartViewMetadata.fields.length;for(i=0;i<a;i++){e=this._oChartViewMetadata.fields[i];if(e.name===t){return e}}}return null};gt.prototype.attachInitialise=function(t,e,i){this.attachEvent("initialise",t,e,i);mt=true;sap.ui.getCore().loadLibrary("sap.chart");Y=sap.ui.requireSync("sap/chart/library");Q=sap.ui.requireSync("sap/chart/Chart");tt=sap.ui.requireSync("sap/chart/ColoringType");it=sap.ui.requireSync("sap/chart/data/Dimension");at=sap.ui.requireSync("sap/chart/data/HierarchyDimension");rt=sap.ui.requireSync("sap/chart/data/TimeDimension");ot=sap.ui.requireSync("sap/chart/data/Measure");st=sap.ui.requireSync("sap/chart/data/MeasureSemantics");ht=sap.ui.requireSync("sap/viz/ui5/controls/VizTooltip");et=sap.ui.requireSync("sap/viz/ui5/format/ChartFormatter");if(this._bMetadataIsInitialised){this._initialiseInnerChart()}N.error("The event 'initialise' is deprecated, please use 'initialized' instead");return this};gt.prototype._createChart=function(){if(this._oNoDataStruct){this._oNoDataStruct.destroy()}var t=this.getItems(),e=t?t.length:0,i,a=this;var o;this._bDisableTimeseriesUTC=true;while(e--){i=t[e];if(i instanceof Q){break}i=null}if(i){this._oChart=i;try{o=this.data("dateFormatSettings")?JSON.parse(this.data("dateFormatSettings")):{};if(o.hasOwnProperty("UTC")){this._bDisableTimeseriesUTC=!o["UTC"]}if(o.hasOwnProperty("style")&&o["style"].toLowerCase()=="medium"){this._bWorkaroundVizFormatter=true}}catch(t){}}else{var s={uiConfig:{applicationSet:"fiori"},busyIndicatorDelay:0,vizProperties:{title:{text:""},plotArea:{dataLabel:{hideWhenOverlap:false}},general:{groupData:false},valueAxis:{title:{visible:a.getShowMeasuresTitle()}},categoryAxis:{title:{visible:a.getShowDimensionsTitle()},layout:{autoHeight:true,autoWidth:true}}},selectionMode:this.getSelectionMode(),width:"100%"};try{o=this.data("dateFormatSettings")?JSON.parse(this.data("dateFormatSettings")):{};if(o.hasOwnProperty("UTC")){s.vizProperties.general.showAsUTC=!!o["UTC"];this._bDisableTimeseriesUTC=!o["UTC"];if(o.hasOwnProperty("style")&&o["style"].toLowerCase()=="medium"){s.timeAxis={levelConfig:{day:{visible:true,formatString:"MediumDay"},month:{visible:true,formatString:"MediumMonth"}}};this._bWorkaroundVizFormatter=true}}}catch(t){}this._oChart=new Q(s);if(this.getHeight()){this._oChart.setHeight("100%")}this._toggleChartTooltipVisibility(this.getShowChartTooltip());this._setBehaviorTypeForDataSelection();this.insertItem(this._oChart,2)}if(y.browser.safari||y.browser.chrome||y.browser.firefox){this.addStyleClass("sapUiCompSmartChartInnerChartHeight")}this.setLegendVisible(this.getLegendVisible());if(!this._oChart.getLayoutData()){var n={growFactor:1};var h=this.getLayoutData();if(h&&h.getBaseSize){n.baseSize=h.getBaseSize()}else{n.baseSize="100%"}this._oChart.setLayoutData(new r(n))}if(this.getChartType()){this._setChartType(this.getChartType())}this._oChart.attachRenderComplete(function(){if(this._hasOverlay){setTimeout(function(){this._showOverlay(true)}.bind(this),0)}this._oChart.getLayoutData().setGrowFactor(1)}.bind(this));this._oChart.setCustomMessages({NO_DATA:this.getNoData()});this._createTooltipOrPopover()};gt.prototype._toggleChartTooltipVisibility=function(t){if(this._oChart){if(t){if(!this._vizTooltip){this._vizTooltip=new ht}this._vizTooltip.connect(this._oChart.getVizUid())}else{if(this._vizTooltip){this._vizTooltip.destroy()}}}};gt.prototype._updateVizTooltipFormatter=function(){if(this._vizTooltip){if(this._oChart.getChartType().match(/100/)!==null){this._vizTooltip.setFormatString(et.DefaultPattern.PERCENT)}else{this._vizTooltip.setFormatString(et.DefaultPattern.STANDARDFLOAT)}}};gt.prototype.getChart=function(){if(!this._oChart&&this._bMetadataIsInitialised){sap.ui.getCore().loadLibrary("sap.chart");Y=sap.ui.requireSync("sap/chart/library");Q=sap.ui.requireSync("sap/chart/Chart");tt=sap.ui.requireSync("sap/chart/ColoringType");it=sap.ui.requireSync("sap/chart/data/Dimension");at=sap.ui.requireSync("sap/chart/data/HierarchyDimension");rt=sap.ui.requireSync("sap/chart/data/TimeDimension");ot=sap.ui.requireSync("sap/chart/data/Measure");st=sap.ui.requireSync("sap/chart/data/MeasureSemantics");ht=sap.ui.requireSync("sap/viz/ui5/controls/VizTooltip");et=sap.ui.requireSync("sap/viz/ui5/format/ChartFormatter");this._initialiseInnerChart()}else if(!this._bMetadataIsInitialised){N.error("Accesing the inner chart before the metadata is initialized will not work. Instead, wait for the initialized event!")}N.error("This function is deprecated, please use getChartAsync instead");return this._oChart};gt.prototype.getChartAsync=function(){if(!this._oChart&&this._bMetadataIsInitialised){return new Promise(function(t,e){sap.ui.require(["sap/chart/library","sap/chart/Chart","sap/chart/ColoringType","sap/chart/data/Dimension","sap/chart/data/HierarchyDimension","sap/chart/data/TimeDimension","sap/chart/data/Measure","sap/chart/data/MeasureSemantics","sap/viz/ui5/controls/VizTooltip","sap/viz/ui5/format/ChartFormatter"],function(i,a,r,o,s,n,h,l,u,c){Y=i;Q=a;tt=r;it=o;at=s;rt=n;ot=h;st=l;ht=u;et=c;if(!this._oChart){this._initialiseInnerChart()}if(this._oChart){t(this._oChart)}else{e("The inner chart couldn't be created")}}.bind(this))}.bind(this))}else if(!this._bMetadataIsInitialised){N.error("Accessing the inner chart before the metadata is initialized will not work. Instead, wait for the initialized event!");return Promise.reject(new Error("Accessing the inner chart before the metadata is initialized will not work. Instead, wait for the initialized event!"))}else{return Promise.resolve(this._oChart)}};gt.prototype._getChartTypes=function(){var t;try{t=Y.api.getChartTypes()}catch(e){t={};N.error("sap.chart.api.getChartTypes throws an exception.\n"+e.toString())}return t};gt.prototype.getAvailableChartTypes=function(){var t,e,i=[],a,r={},o;if(this._oChart){o=C.createArrayFromString(this.getIgnoredChartTypes());r=this._getChartTypes();a=this._oChart.getAvailableChartTypes().available;if(a){for(t=0;t<a.length;t++){e=a[t].chart;if(o.indexOf(e)<0){i.push({key:e,text:r[e]})}}}}return i};gt.prototype._getAllChartTypes=function(){var t,e=[],i,a;a=C.createArrayFromString(this.getIgnoredChartTypes());i=this._getChartTypes();for(t in i){if(t){if(a.indexOf(t)<0){e.push({key:t,text:i[t]})}}}return e};gt.prototype._retrieveChartTypeDescription=function(t){var e=this._getChartTypes();return{key:t,text:e[t]}};gt.prototype._setChartType=function(t){if(this._oChart){var e=this._oChart.getHeight();this._oChart.setChartType(t);this._aDetailsEntries=[];this._toggleMeasureUnitBinding(t,this._oChart.getMeasures());this._oChart.setHeight(e)}};gt.prototype._toggleMeasureUnitBinding=function(t,e){if(typeof e!="undefined"&&e instanceof Array){if(t.substring(0,4)==="100_"){e.forEach(function(t){t.setUnitBinding()})}else{if(this._oChartProvider){var i=this._oChartProvider._aODataFieldMetadata;e.forEach(function(t){for(var e=i.length-1;e>=0;e--){if(i[e].name==t.getName()){if(i[e]["Org.OData.Measures.V1.ISOCurrency"]&&i[e]["Org.OData.Measures.V1.ISOCurrency"].Path){t.setUnitBinding(i[e]["Org.OData.Measures.V1.ISOCurrency"].Path)}else if(i[e]["Org.OData.Measures.V1.Unit"]&&i[e]["Org.OData.Measures.V1.Unit"].Path){t.setUnitBinding(i[e]["Org.OData.Measures.V1.Unit"].Path)}break}}})}}}};gt.prototype._getDimensions=function(){var t=[];if(this._oChart){t=this._oChart.getDimensions()}return t};gt.prototype._getVisibleDimensions=function(){var t=[];if(this._oChart){t=this._oChart.getVisibleDimensions()}return t};gt.prototype._getMeasures=function(){var t=[];if(this._oChart){t=this._oChart.getMeasures()}return t};gt.prototype._getVisibleMeasures=function(){var t=[];if(this._oChart){t=this._oChart.getVisibleMeasures()}return t};gt.prototype._getSortedDimensions=function(){var t=[];if(this._oChart){t=this._oChart.getDimensions();if(t){t.sort(function(t,e){if(t.getLabel()&&e.getLabel()){return t.getLabel().localeCompare(e.getLabel())}})}}return t};gt.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{}}return this._oCurrentVariant};gt.prototype.applyVariant=function(t,e){this._oCurrentVariant=t;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null}this._bApplyingVariant=true;if(this._oPersController){if(this._oCurrentVariant===null||jQuery.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization($.ResetFull)}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true)}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()})};gt.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding()};gt.prototype.getUiState=function(){if(!this.isInitialised()){N.error("SmartChart: Called getUiState() before inner structure was initialized. This will force a synchronous load of dependencies.");this.getChart()}var t=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new S({presentationVariant:{ContextUrl:"",MaxItems:this._oChartProvider?this._oChartProvider.getMaxItems():undefined,SortOrder:t?t.SortOrder:[],GroupBy:t?t.GroupBy:[],Total:t?t.Total:[],RequestAtLeast:this._getInResultDimensionTotal(),Visualizations:t?t.Visualizations:[]},selectionVariant:{SelectOptions:t?t.SelectOptions:[]},variantName:this.getCurrentVariantId()})};gt.prototype.setUiState=function(t){if(this._oPersController){var e=this._oVariantManagement&&t.getVariantName()?this._oVariantManagement.getVariantContent(this,t.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(H({},t.getPresentationVariant(),t.getSelectionVariant()),e,true)}this._setInResultDimensionFromVariant(t)};gt.prototype.setUiStateAsVariant=function(t){if(this._oPersController){this._oPersController.setPersonalizationDataAsDataSuiteFormat(H({},t.getPresentationVariant(),t.getSelectionVariant()),true)}this._setInResultDimensionFromVariant(t)};gt.prototype._setInResultDimensionFromVariant=function(t){if(t.getPresentationVariant()&&this._oChart){this._oChart.setInResultDimensions(t.getPresentationVariant().RequestAtLeast)}else{this._oUiStateRequestAtLeast=t.getPresentationVariant().RequestAtLeast}};gt.prototype.setRequestAtLeastFields=function(t){this.setProperty("requestAtLeastFields",t);if(this._oChart){this._updateInResultDimensions()}return this};gt.prototype._getInResultDimensionTotal=function(){var t=[];if(this.getRequestAtLeastFields()){t=this.getRequestAtLeastFields().split(",")}t=t.concat(this._aAlwaysSelect);if(this._oChart){t=t.concat(this._oChart.getInResultDimensions())}if(this._oUiStateRequestAtLeast){t.concat(this._oUiStateRequestAtLeast);this._oUiStateRequestAtLeast=null}return t.filter(function(t,e,i){return e==i.indexOf(t)})};gt.prototype._getFieldTooltip=function(t){var e=this._getFieldByKey(t);if(e){return e.quickInfo}return""};gt.prototype._getFieldByKey=function(t){var e,i=null;if(this._oChartViewMetadata&&this._oChartViewMetadata.fields){for(e=0;e<this._oChartViewMetadata.fields.length;e++){i=this._oChartViewMetadata.fields[e];if(t===i.name){return i}}return null}};gt.prototype._getByKey=function(t,e){var i,a,r,o;if(t){a=t.length;for(i=0;i<a;i++){r=t[i];o=r.data("p13nData");if(o&&o.columnKey===e){return r}}}return null};gt.prototype._getDimensionByKey=function(t){if(this._oChart){return this._getByKey(this._oChart.getDimensions(),t)}return null};gt.prototype._getMeasureByKey=function(t){if(this._oChart){return this._getByKey(this._oChart.getMeasures(),t)}return null};gt.prototype._getChartObjByKey=function(t){var e=this._getDimensionByKey(t);if(!e){e=this._getMeasureByKey(t)}return e};gt.prototype._getPathFromColumnKeyAndProperty=function(t,e){var i=null,a,r;a=this._getChartObjByKey(t);if(a){r=a.data("p13nData");if(r){i=r[e]}}return i};gt.prototype._getChartPersonalisationData=function(){if(!this._oCurrentVariant){return null}var t=[],i=[],a=[],r,o,s;if(this._oCurrentVariant.sort){o=this._oCurrentVariant.sort.sortItems}else{o=this._aInitialSorters}if(o){o.forEach(function(e){var i=e.operation==="Descending";s=e.columnKey;t.push(new m(s,i))},this)}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(t){var r=t.value1,o=t.value2;s=t.columnKey;if(r instanceof Date&&this._oChartProvider&&this._oChartProvider.getIsUTCDateHandlingEnabled()){r=e.localToUtc(r);o=o?e.localToUtc(o):o}if(t.exclude){if(t.operation==="Empty"){a.push(new g(s,"NE",t.operation==="Empty"?"":r))}else{a.push(new g(s,q.getTransformedExcludeOperation(t.operation),t.operation==="Empty"?"":r,o))}}else if(t.operation==="Empty"){i.push(new g(s,"EQ",""))}else{i.push(new g(s,t.operation,r,o))}},this);if(a.length){r=new g(a,true)}}return{filters:i,excludeFilters:r,sorters:t}};gt.prototype._persistPersonalisation=function(){if(!sap.ui.getCore().getConfiguration().getDesignMode()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var t=this.getCurrentVariantId();if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:"Personalisation",implicit:true,global:false,overwrite:!!t,key:t,def:true});delete this._bSaving}}};gt.prototype.getCurrentVariantId=function(){var t="";if(this._oVariantManagement){t=this._oVariantManagement.getCurrentVariantId()}return t};gt.prototype.setCurrentVariantId=function(t){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(t)}else{N.error("sap.ui.comp.smartchart.SmartChart.prototype.setCurrentVariantId: VariantManagement does not exist or is a page variant")}return this};gt.prototype._adjustHeight=function(){if(this._oChart){var t=0,e=0;var i=this.getDomRef()?this.getDomRef().offsetHeight:0;if(i===0){return}if(this._oToolbar&&this._oToolbar.getDomRef()){t=this._oToolbar.getDomRef().offsetHeight}if(this._oDrillBreadcrumbs&&this._oDrillBreadcrumbs.getDomRef()){var a=this._oDrillBreadcrumbs.getDomRef().parentNode?this._oDrillBreadcrumbs.getDomRef().parentNode:this._oDrillBreadcrumbs.getDomRef();e=a.offsetHeight}var r=i-t-e;this._oChart.setHeight(r+"px");this._updateDrillBreadcrumbs();if(this._hasOverlay){setTimeout(function(){this._showOverlay(true)}.bind(this),0)}}};gt.prototype._toggleFullScreen=function(t,e){if(!this.oFullScreenButton||t===this.bFullScreen&&!e){return}if(t==true&&this._oChart){this._sChartHeight=this._oChart.getHeight();this._oChart.setHeight("100%")}this.bFullScreen=t;j.toggleFullScreen(this,this.bFullScreen,this.oFullScreenButton,this._toggleFullScreen,"sapContrastPlus",true);if(!t){this._adjustHeight()}this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:t});if(t==false&&this._oChart){this._oChart.setHeight(this._sChartHeight)}};gt.prototype._renderFullScreenButton=function(){this.oFullScreenButton.setTooltip(this.bFullScreen?this._oRb.getText("CHART_MINIMIZEBTN_TOOLTIP"):this._oRb.getText("CHART_MAXIMIZEBTN_TOOLTIP"));this.oFullScreenButton.setText(this.bFullScreen?this._oRb.getText("CHART_MINIMIZEBTN_TEXT"):this._oRb.getText("CHART_MAXIMIZEBTN_TEXT"));this.oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen")};gt.prototype._enrichFromDataPoints=function(t){var e=t.length;var i=[];var a={};for(var r=0;r<e;r++){this._interpretDataPoint(t[r].dataPoint,t[r].measure,a,i)}if(i.length>0){this._oChart.setActiveColoring({coloring:tt.Criticality,parameters:{measure:i}});this._oChart.setColorings({Criticality:{MeasureValues:a}})}};gt.prototype._interpretDataPoint=function(t,e,i,a){this._setSemanticPatterns(t,e);if(e.setBoundaryValues){this._setBoundaryValues(t,e)}if(t.Criticality||t.CriticalityCalculation){i[t.Value.Path]=this._oChartProvider.provideSemanticColoring(t);a.push(t.Value.Path)}};gt.prototype._setSemanticPatterns=function(t,e){var i=t.TargetValue?t.TargetValue.Path:null;var a=t.ForecastValue?t.ForecastValue.Path:null;e.setSemantics(st.Actual);if(i!=null){var r=this._oChart.getMeasureByName(i);if(r){r.setSemantics(st.Reference)}else{N.error("sap.ui.comp.SmartChart: "+t.TargetValue.Path+" is not a valid measure")}}if(a){var o=this._oChart.getMeasureByName(a);if(o){o.setSemantics(st.Projected)}else{N.error("sap.ui.comp.SmartChart: "+t.ForecastValue.Path+" is not a valid measure")}}e.setSemanticallyRelatedMeasures({referenceValueMeasure:i,projectedValueMeasure:a})};gt.prototype._setBoundaryValues=function(t,e){var i={};if(t.MinimumValue){i.minimum=t.MinimumValue}if(t.MaximumValue){i.maximum=t.MaximumValue}if(i.minimum||i.maximum){e.setBoundaryValues(i)}};gt.prototype.isInitialised=function(){return!!this.bIsInitialised};gt.prototype.exit=function(){this._oRb=null;if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindChart,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this)}if(this._oChartProvider&&this._oChartProvider.destroy){this._oChartProvider.destroy()}this._oChartProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy()}if(this._oSegmentedButton){this._oSegmentedButton.removeAllButtons();this._oButtonChart1.destroy();this._oButtonChart2.destroy();this._oButtonChart3.destroy();this._oButtonChart4.destroy();this._oButtonChart5.destroy();this._oButtonChart1=null;this._oButtonChart2=null;this._oButtonChart3=null;this._oButtonChart4=null;this._oButtonChart5=null}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy()}}this._oVariantManagement=null;this._destroyPopover();j.cleanUpFullScreen(this);if(this._oDetailsPopover){this._oDetailsPopover.destroy();if(this._oRelatedAppsMasterList){this._oRelatedAppsMasterList.destroy()}}if(this.oChart){this._oChart.detachRenderComplete(this._toggleZoomButtonEnablement,this)}this._oCurrentVariant=null;this._oChartViewMetadata=null;this._aAlwaysSelect=null;this._aInitialSorters=null;this._oSmartFilter=null;this._oToolbar=null;this._oChartPersonalisationButton=null;this._oView=null;this._oChart=null;this._bDisableTimeseriesUTC=null;this._bWorkaroundVizFormatter=null};gt.prototype._processResizeHandler=function(t){if(t){this.sResizeListenerId=null;if(y.system.desktop){this.sResizeListenerId=z.register(this,this._adjustHeight.bind(this))}else{y.orientation.attachHandler(this._adjustHeight,this);y.resize.attachHandler(this._adjustHeight,this)}}else{if(y.system.desktop&&this.sResizeListenerId){z.deregister(this.sResizeListenerId);this.sResizeListenerId=null}else{y.orientation.detachHandler(this._adjustHeight,this);y.resize.detachHandler(this._adjustHeight,this)}}};gt.prototype.setShowToolbar=function(t){if(this._oToolbar){this._oToolbar.setVisible(t)}return this.setProperty("showToolbar",t,true)};gt.prototype.setToolbarStyle=function(t){if(this._oToolbar){this._oToolbar.setStyle(t)}return this.setProperty("toolbarStyle",t,true)};gt.prototype.setShowDimensionsTitle=function(t){if(this._oChart){this._oChart.setVizProperties({categoryAxis:{title:{visible:t}}})}return this.setProperty("showDimensionsTitle",t,true)};gt.prototype.setShowMeasuresTitle=function(t){if(this._oChart){this._oChart.setVizProperties({valueAxis:{title:{visible:t}}})}return this.setProperty("showMeasuresTitle",t,true)};gt.prototype._checkDimensionColoring=function(){var t=this._getVisibleDimensions(),e,i={Criticality:{DimensionValues:{}}},a;for(var r=0;r<t.length;r++){e=this._getField(t[r]);a=this._oChartProvider.calculateDimensionColoring(e);if(a){if(this._sColoringDimension!=e.name){i.Criticality.DimensionValues[e.name]=a;this._oChart.setActiveColoring({coloring:tt.Criticality,parameters:{dimension:e.name}});this._oChart.setColorings(i);this._sColoringDimension=e.name}return}}};gt.prototype.getIdForLabel=function(){if(this._headerText){return this._headerText.getId()}return u.prototype.getIdForLabel.apply(this,[])};return gt});
//# sourceMappingURL=SmartChart.js.map