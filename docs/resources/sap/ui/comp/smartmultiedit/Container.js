/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery",".././library","sap/ui/core/Control","sap/ui/comp/smartmultiedit/Field","sap/ui/model/Context","sap/base/Log"],function(jQuery,t,e,i,o,a){"use strict";var n=e.extend("sap.ui.comp.smartmultiedit.Container",{metadata:{library:"sap.ui.comp",properties:{entitySet:{type:"string",defaultValue:null},contexts:{type:"sap.ui.model.Context[]",defaultValue:[]}},defaultAggregation:"layout",aggregations:{layout:{type:"sap.ui.comp.smartform.SmartForm",multiple:false}},designTime:"sap/ui/comp/designtime/smartmultiedit/Container.designtime"},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiCompSmartMultiEditContainer");t.openEnd();if(e._bReadyToRender){t.renderControl(e.getLayout())}t.close("div")}}});n.prototype.init=function(){this._bIsInitialized=false;this._bReadyToRender=false;this._aFields=null;this.attachEvent("modelContextChange",this._initializeMetadata,this)};n.prototype.setEntitySet=function(t){if(t!==this.getProperty("entitySet")){this.setProperty("entitySet",t,true);if(t){this._initializeMetadata()}}return this};n.prototype.setContexts=function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){if(!(t[e]instanceof o)){return this}}this.setProperty("contexts",t,true);this._getFields().forEach(function(t){t._updateContextItems()})}else{a.error("Parameter contexts is expected to be an array.")}return this};n.prototype.setLayout=function(t){this.setAggregation("layout",t,true);this._refreshFields();return this};n.prototype.addCustomData=function(t){var i;if(!t){return this}e.prototype.addCustomData.apply(this,arguments);this._getFields().forEach(function(e){i=t.clone();e._oSmartField.addCustomData(i)});return this};n.prototype.insertCustomData=function(t,i){var o;if(!t){return this}e.prototype.insertCustomData.apply(this,arguments);this._getFields().forEach(function(e){o=t.clone();e._oSmartField.addCustomData(o)});return this};n.prototype.removeCustomData=function(t){var i=e.prototype.removeCustomData.apply(this,arguments);if(i){this._getFields().forEach(function(t){t._oSmartField.removeCustomData(i)})}return i};n.prototype.removeAllCustomData=function(){var t=e.prototype.removeAllCustomData.apply(this,arguments);if(t.length>0){this._getFields().forEach(function(e){t.forEach(function(t){e._oSmartField.removeCustomData(t)})})}return t};n.prototype.destroyCustomData=function(){e.prototype.destroyCustomData.apply(this,arguments);this._getFields().forEach(function(t){t._oSmartField.destroyCustomData()});return this};n.prototype.getAllUpdatedContexts=function(t){var e=this.getContexts(),i=[],o=this,a=0,n=10;if(e.length===0){return Promise.resolve(i)}return new Promise(function(r){function s(l,u,d){for(a=u;a<Math.min(d,l.length);a++){i.push({context:l[a],data:o._getUpdatedDataObject(l[a].getObject(),t)})}if(a<l.length){setTimeout(s.bind(null,e,a,a+n),0)}else{r(i)}}s(e,a,a+n)})};n.prototype.getErroneousFields=function(){return this._getFields().filter(function(t){t._performValidation();return t.hasClientError()})};n.prototype.getErroneousFieldsAndTokens=function(){var t=this._getFields().map(function(t){return t._performValidation()});return Promise.all(t).then(function(){var t=this._getFields().filter(function(t){return t.hasClientError()});return t}.bind(this))};n.prototype.indexField=function(t){var e;if(!(t instanceof i)){a.error("Container.indexField","Element '"+JSON.stringify(t)+"' must be of type sap.ui.comp.smartmultiedit.Field","sap.ui.comp.smartmultiedit.Container");return}this._aFields.push(t);t._setContainer(this);this.getCustomData().forEach(function(i){if(t.getSmartField()){e=i.clone();t.getSmartField().addCustomData(e)}})};n.prototype._getUpdatedDataObject=function(t,e){var i=e?Object.assign({},t):{},o,n,r,s;this._getFields().forEach(function(e){o=e.getPropertyName();n=e.getUnitOfMeasurePropertyName();s=e.getRawValue();if(s.hasOwnProperty(o)){if(e.isDate()||e.isDateTime()){if(!t[o]){if(s[o]){i[o]=s[o]}}else if(!s[o]){i[o]=null}else if(!t[o].getTime){a.error("Container._getUpdatedDataObject","Field "+o+" has incompatible data and metadata, expected: Date/DateTime, but found "+typeof i[o],"sap.ui.comp.smartmultiedit.Container");return}else if(s[o].getTime()!==t[o].getTime()){i[o]=s[o]}}else{if(s[o]!==t[o]&&(s[o]!==""&&s[o]!=null||t[o]!==""&&t[o]!=null)){i[o]=s[o]}}}if(e.isComposite()&&s.hasOwnProperty(n)&&s[n]!==t[n]){i[n]=s[n]}else if(e.isComboBox()){r=e.getRecordTextPath();if(s.hasOwnProperty(r)&&s[r]!==t[r]){i[r]=s[r]}}});return i};n.prototype.getFields=function(t){return this._getFields(t)};n.prototype._getFields=function(t){var e=[];if((t||!this._aFields||Array.isArray(this._aFields)&&!this._aFields.length)&&this.getLayout()){this._aFields=[];this.getLayout().getGroups().forEach(function(o){o.getGroupElements().forEach(function(o){o.getElements().forEach(function(o){if(o instanceof i){this.indexField(o)}else if(t){e.push(o)}}.bind(this))}.bind(this))}.bind(this))}return e.concat(this._aFields||[])};n.prototype._initializeMetadata=function(){var t=this.getModel();if(!this._bIsInitialized&&this.getEntitySet()&&t&&t.getMetadata().getName()==="sap.ui.model.odata.v2.ODataModel"){if(!this.getBindingContext()){var e=t.createEntry("/"+this.getEntitySet());this.setBindingContext(e);this.getModel().deleteCreatedEntry(e)}t.getMetaModel().loaded().then(this._onMetadataInitialized.bind(this))}};n.prototype._onMetadataInitialized=function(){if(this._bIsInitialized){return}this._bIsInitialized=true;this._bReadyToRender=true;this.invalidate()};n.prototype.resetContainer=function(){this._aFields.forEach(function(t){t.resetField()});this.setBindingContext(null);this._bIsInitialized=false};n.prototype._refreshFields=function(){this._aFields=null;this._getFields()};return n});
//# sourceMappingURL=Container.js.map