/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/core/library","sap/ui/comp/library","sap/m/library","./JSONControlFactory","./ODataControlFactory","./BindingUtil","./SideEffectUtil","./ODataHelper","./ValidationUtil","sap/ui/core/Control","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/ui/comp/smartfield/UoMValidateException","sap/ui/model/json/JSONModel","sap/ui/model/BindingMode","sap/base/strings/capitalize","sap/base/Log","sap/base/util/Deferred","sap/m/DisplayListItem","sap/m/InputListItem","sap/ui/core/message/MessageMixin","./TextArrangementRead"],function(t,e,i,r,o,n,a,s,l,u,d,p,h,g,c,f,y,_,m,C,b,v,V){"use strict";var I=e.ValueState;var S=i.smartfield.TextInEditModeSource;var E=i.smartfield.Importance;var F=e.TextAlign;var P=r.FlexJustifyContent;var M=e.TextDirection;var x=i.smartfield.ControlContextType;var T=i.smartfield.ControlProposalType;var A=r.EmptyIndicatorMode;var D=d.extend("sap.ui.comp.smartfield.SmartField",{metadata:{interfaces:["sap.ui.core.IFormContent","sap.ui.core.ISemanticFormContent"],library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartfield/SmartField.designtime",properties:{value:{type:"any",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Misc",defaultValue:true},entitySet:{type:"string",group:"Misc",defaultValue:""},editable:{type:"boolean",group:"Misc",defaultValue:true},contextEditable:{type:"boolean",group:"Misc",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:""},textAlign:{type:"sap.ui.core.TextAlign",group:"Misc",defaultValue:F.Initial},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:M.Inherit},placeholder:{type:"string",group:"Misc",defaultValue:""},name:{type:"string",group:"Misc",defaultValue:""},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:I.None},valueStateText:{type:"string",group:"Appearance",defaultValue:""},showValueStateMessage:{type:"boolean",group:"Appearance",defaultValue:true},jsontype:{type:"sap.ui.comp.smartfield.JSONType",group:"Misc",defaultValue:null},mandatory:{type:"boolean",group:"Misc",defaultValue:false},maxLength:{type:"int",group:"Misc",defaultValue:0},showSuggestion:{type:"boolean",group:"Misc",defaultValue:true},showValueHelp:{type:"boolean",group:"Misc",defaultValue:true},showLabel:{type:"boolean",group:"Appearance",defaultValue:true},textLabel:{type:"string",group:"Misc",defaultValue:""},tooltipLabel:{type:"string",group:"Misc",defaultValue:""},uomVisible:{type:"boolean",group:"Misc",defaultValue:true},uomEditable:{type:"boolean",group:"Misc",defaultValue:true},uomEnabled:{type:"boolean",group:"Misc",defaultValue:true},url:{type:"string",group:"Misc",defaultValue:""},uomEditState:{type:"int",group:"Misc",defaultValue:-1},controlContext:{type:"sap.ui.comp.smartfield.ControlContextType",group:"Misc",defaultValue:x.None},proposedControl:{type:"sap.ui.comp.smartfield.ControlProposalType",group:"Misc",defaultValue:T.None},wrapping:{type:"boolean",group:"Misc",defaultValue:true},clientSideMandatoryCheck:{type:"boolean",group:"Misc",defaultValue:true},fetchValueListReadOnly:{type:"boolean",group:"Misc",defaultValue:true},expandNavigationProperties:{type:"boolean",group:"Behavior",defaultValue:false},textInEditModeSource:{type:"sap.ui.comp.smartfield.TextInEditModeSource",group:"Behavior",defaultValue:S.None},historyEnabled:{type:"boolean",group:"Misc",defaultValue:true},importance:{type:"sap.ui.comp.smartfield.Importance",group:"Misc",defaultValue:E.Low},fixedValueListValidationEnabled:{type:"boolean",group:"Misc",defaultValue:false},_internalFieldGroupIds:{type:"string[]",defaultValue:[],visibility:"hidden"}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},configuration:{type:"sap.ui.comp.smartfield.Configuration",multiple:false},controlProposal:{type:"sap.ui.comp.smartfield.ControlProposal",multiple:false},_ariaLabelInvisibleText:{type:"sap.ui.core.InvisibleText",multiple:true,visibility:"hidden"},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"}},events:{entitySetFound:{parameters:{entitySet:{type:"string"}}},change:{parameters:{value:{type:"string"},newValue:{type:"string"}}},changeModelValue:{parameters:{valueChanged:{type:"boolean"},valueLastValueState:{type:"boolean"},unitChanged:{type:"boolean"},unitLastValueState:{type:"sap.ui.core.ValueState"}}},initialise:{},visibleChanged:{parameters:{visible:{type:"boolean"}}},editableChanged:{parameters:{editable:{type:"boolean"}}},contextEditableChanged:{parameters:{editable:{type:"boolean"}}},innerControlsCreated:{},valueListChanged:{parameters:{changes:{type:"sap.ui.core.Control[]"}}},press:{}}},renderer:{apiVersion:2,render:function(e,i){var r=i.getContent(),o=i._oControl.edit,n=i.getFirstInnerControl();e.openStart("div",i);e.class("sapUiCompSmartField");e.openEnd();if(r&&i.getMode()==="display"&&i.isFormContextType()&&i._innerControlHasNoValue()&&n!==null&&!n.getMetadata().hasProperty("emptyIndicatorMode")){e.openStart("span");e.class("sapUiPseudoInvisibleText");e.openEnd();e.text(t.getLibraryResourceBundle("sap.ui.comp").getText("NO_VALUE"));e.close("span");e.openStart("span");e.attr("aria-hidden","true");e.class("sapMText");e.class("sapUiSelectable");e.class("sapMTextMaxWidth");e.class("sapUiCompSmartFieldValue");e.class("sapUiCompEmptyValue");e.openEnd();e.close("span")}if(i.getMode()==="edit"&&!i._getFocusCatcher()&&(o===null||o!==null&&r!==null&&o.getId()!==r.getId())){i._createFocusCatcher();e.renderControl(i._getFocusCatcher())}else if(r){e.renderControl(r);if(i._isFocusCatcherFocused()&&o&&o.getId()===r.getId()){r.focus()}if(i._getFocusCatcher()){i._destroyFocusCatcher()}}if(i.getAggregation("_ariaLabelInvisibleText")){i.getAggregation("_ariaLabelInvisibleText").forEach(function(t){e.renderControl(t)})}e.close("div")}}});v.call(D.prototype);var B=D.prototype.refreshDataState;D.prototype.init=function(){this._isInnerControlCreationDelayed=true;this._sAnnotationLabel="";this._bInDestroy=false;this._oSideEffects=new s(this);this._oFactory=null;this._oControl={display:null,edit:null,current:null};this._oValue={display:null,edit:null,uom:null,uomset:null};this._oError={bComplex:false,bFirst:false,bSecond:false};this._oState=this._initState();this._oUtil=new a;this._bSuppressToggleControl=false;this.oValidation=new u(this);this._oLastValidated=null;this.attachModelContextChange(function(){if(this._hasDefaultModel()){if(this.getBindingContext()){this._createICRenderedDeferred()}this.invalidate()}}.bind(this));this._initialStateApplied=new m;this._innerControlsRendered=Promise.resolve();this._initialStateApplied.promise.then(function(){var t=this.getBinding("value");if(t){var e=function(){var i=this.getBinding("value").getDataState();if(i.getOriginalValue()!==i.getValue()){this._bValueNotInitial=true;t.detachChange(e)}}.bind(this);t.attachChange(e)}}.bind(this))};D.prototype._getICRenderedPromise=function(){var t=this._oRenderedWithContext;return t?t.promise:undefined};D.prototype._createICRenderedDeferred=function(){var t;t=new m;this._oRenderedWithContext=t;Promise.all([new Promise(function(t){this.attachInnerControlsCreated(t)}.bind(this)),new Promise(function(t){var e={onAfterRendering:function(i){var r=this._getFocusCatcher(),o=this._oControl.edit,n=this.getAggregation("_content");if(o&&o.getDomRef()&&o.getFocusDomRef()&&o===n&&(!r||!r.getDomRef())){this.removeEventDelegate(e);t()}}.bind(this)};this.addEventDelegate(e)}.bind(this))]).then(function(){t.resolve()})};D.prototype.setVisible=function(t,e){var i=this.getVisible();d.prototype.setVisible.apply(this,arguments);t=this.getVisible();if(t!==i){this.fireVisibleChanged({visible:t})}return this};D.prototype._setVisibilityBasedOnImportance=function(t){var e,i,r,o,n,a=this._oFactory,s=this.oParent&&this.oParent.isA("sap.ui.comp.smartform.GroupElement")&&this.oParent.getDomRef();if(!a||!s){return}e=a.getMetaData&&a.getMetaData();i=e&&e.property&&e.property.property;o=a._oHelper&&a._oHelper.oAnnotation;if(o){if(!o.isNullable(i)||o.isStaticMandatory(i)||o.getVisible(i)==="false"){return}}if(this.getMandatory()||!this.getVisible()||this._fieldControlValue===0||this._fieldControlValue===7){return}r=!this.isPropertyInitial("importance")&&this.getImportance()||o&&o.getImportanceAnnotation(i);switch(t){case E.High:n=r===E.High?"":"none";break;case E.Medium:n=r===E.Low?"none":"";break;default:n=""}s.style.display=n};D.prototype.getComputedTextLabel=function(){return this.getProperty("textLabel")||this._sAnnotationLabel};D.prototype.isPropertyBeingUpdatedByModel=function(t){var e=this.getBindingInfo(t);return!!(e&&e.skipModelUpdate)};D.prototype._boundEntityExists=function(t){t=t||this.getBindingContext();return!!(t&&t.getObject())};D.prototype.setUomEditable=function(t){this.setProperty("uomEditable",t,true);var e=this._getEmbeddedSmartField();if(e){e.setEditable(this.getUomProperty("editable"))}return this};D.prototype.setUomEnabled=function(t){this.setProperty("uomEnabled",t,true);var e=this._getEmbeddedSmartField();if(e){e.setEnabled(this.getUomEnabled())}return this};D.prototype.setUomVisible=function(t){this.setProperty("uomVisible",t,true);var e=this._getEmbeddedSmartField();if(e){t=this.getUomProperty("visible");e.setVisible(t);var i=this._oFactory&&this._oFactory.oMeasureField;if(i){i.toggleStyleClass("smartFieldPaddingRight",t)}}return this};D.prototype.setShowValueHelp=function(t){var e=this.getShowValueHelp();this.setProperty("showValueHelp",t,true);var i=this.getContent();if(i&&typeof i.setShowValueHelp==="function"){t=this.getShowValueHelp();var r=t!==e,o=this._oFactory;if(r&&o){if(t){o._createValueHelp()}else{o.destroyValueHelp()}}i.setShowValueHelp(t)}return this};D.prototype.setShowSuggestion=function(t){var e=this.getShowSuggestion();this.setProperty("showSuggestion",t,true);var i=this.getContent();if(i&&typeof i.setShowSuggestion==="function"){t=this.getShowSuggestion();var r=t!==e,o=this._oFactory;if(r&&o){if(t){o._createValueHelp()}else{o.destroyValueHelp()}}i.setShowSuggestion(t)}return this};D.prototype.setConfiguration=function(t){var e=this.getConfiguration(),i=this.setAggregation("configuration",t,true);t=this.getConfiguration();var r=!!(t&&e===null||e&&t===null),o=!!this.getContent();if(o&&(r||t&&e&&(t.getControlType()!==e.getControlType()||t.getDisplayBehaviour()!==e.getDisplayBehaviour()))){this._destroyControls();this._toggleInnerControlIfRequired({mode:this.getMode()});if(t&&t.getDisplayBehaviour()){this._onInnerControlToggled({mode:this.getMode(),fetchIDAndDescription:true,forceTextArrangementFetch:true})}}return i};D.prototype.setTextInEditModeSource=function(t){var e=this.getTextInEditModeSource();this.setProperty("textInEditModeSource",t);t=this.getTextInEditModeSource();if(t!==e){if(this._oFactory){this._destroyFactory()}}return this};D.prototype.setTooltip=function(t){this._refreshTooltipBaseDelegate(t);this.setAggregation("tooltip",t,true);var e=this.getFirstInnerControl();if(e){e.setTooltip(t)}return this};D.prototype._setOnInnerControl=function(){var t,e=this.getContent(),i=this.getFirstInnerControl();if(e){if(typeof e.setWidth==="function"){var r=this.getWidth();if(r){e.setWidth(r)}}this._setPropertyOnControls("wrapping",this.getWrapping());if(typeof e.setName==="function"){e.setName(this.getName())}if(typeof e.setPlaceholder==="function"&&this.getPlaceholder()!==""){e.setPlaceholder(this.getPlaceholder())}if(typeof e.setTextAlign==="function"&&(!e.getTextAlign()||this.getTextAlign()!==F.Initial)){e.setTextAlign(this.getTextAlign())}if(typeof e.setJustifyContent==="function"){if(this.getTextAlign()===F.Initial||this.getTextAlign()===F.Begin){t=P.Start}else if(this.getTextAlign()==="Right"){t=P.End}else{t=this.getTextAlign()}e.setJustifyContent(t)}this._setPropertyOnControls("required",this.getMandatory());this._setPropertyOnControls("textDirection",this.getTextDirection());if(i&&i.getMetadata().getProperty("textAlign")&&(!i.getTextAlign()||this.getTextAlign()!==F.Initial)){this._setPropertyOnControls("textAlign",this.getTextAlign())}var o=this._getEmbeddedSmartField();if(o){if(!this.isPropertyInitial("uomEditable")){o.setEditable(this.getUomProperty("editable"))}if(!this.isPropertyInitial("uomEnabled")){o.setEnabled(this.getUomEnabled())}if(!this.isPropertyInitial("uomVisible")){o.setVisible(this.getUomProperty("visible"))}}}return this};D.prototype.getUomProperty=function(t){var e=this._getEmbeddedSmartField(),i=e&&e.getControlFactory(),r=i&&i._oFieldControl,o=y(t),n="getUom"+o,a=this[n]();if(e.isBound(t)&&r){var s=i.getMetaData();if(s){var l=r._oStoredBindings[t],u=r["_get"+o](s,l,t);u.path();var d=u.formatter.call(e,a);return d}}return a};D.prototype._setPropertyOnControls=function(t,e,i){i=i||this.getInnerControls();i.forEach(function(i){var r="set"+y(t);if(typeof i[r]==="function"){i[r](this._convertValueForControl(t,e,i))}},this)};D.prototype._convertValueForControl=function(t,i,r){var o;if(r){o=r.getMetadata().getProperty(t)}if(o){switch(t){case"wrapping":switch(o.type){case"boolean":return i;case"sap.ui.core.Wrapping":var n=e.Wrapping;if(i){return n.Soft}return n.None}}}return i};D.prototype.setEntitySet=function(t){this.setProperty("entitySet",t,true);this.fireEntitySetFound({entitySet:t});return this};D.prototype._setPendingEditState=function(t){this.data("pendingEditableState",!t)};D.prototype.setContent=function(t){return this.setAggregation("_content",t)};D.prototype.getContent=function(){return this.getAggregation("_content")};D.prototype.getControlFactory=function(){return this._oFactory};D.prototype.getValue=function(){var t=this.getInnerValueFunction();if(t){return t()}return this.getProperty("value")};D.prototype.getInnerValueFunction=function(){if(this._oValue&&typeof this._oValue[this.getMode()]==="function"){return this._oValue[this.getMode()]}return null};D.prototype.getValueState=function(){var t=this.getInnerControls(),e=this._getMaxSeverity(t);if(e>-1){return t[e].getValueState()}return I.None};D.prototype.setValueState=function(t){this.setProperty("valueState",t,true);var e=this.getInnerControls(),i,r="setSimpleClientError";if(e&&e.length){i=e[0];if(e.length>1){r="setComplexClientErrorFirstOperand"}}if(i&&typeof i.setValueState==="function"){i.setValueState(t);this[r](t===I.Error)}return this};D.prototype.getValueStateText=function(){var t=this.getInnerControls(),e=this._getMaxSeverity(t);if(e>-1){return t[e].getValueStateText()}return this.getProperty("valueStateText")};D.prototype.setValueStateText=function(t){this.setProperty("valueStateText",t,true);var e=this.getInnerControls(),i;if(e&&e.length){i=e[0]}if(i&&typeof i.setValueStateText==="function"){i.setValueStateText(t)}return this};D.prototype._getMaxSeverity=function(t){var e,i,r,o,n=0,a=-1,s={Error:3,Warning:2,Success:1,None:0};o=t.length;for(r=0;r<o;r++){i=t[r];if(i.getValueState){e=i.getValueState();if(e&&s[e]>n){n=s[e];a=r}}}return a};D.prototype.getFocusDomRef=function(){var t=this.getInnerControls(),e,i=t.length;if(i>0){e=t[0]}if(e&&e.getFocusDomRef){return e.getFocusDomRef()}return d.prototype.getFocusDomRef.apply(this,arguments)};D.prototype.getIdForLabel=function(){var t=this.getInnerControls(),e,i=t.length;if(i>0){e=t[0]}if(e&&typeof e.getIdForLabel==="function"){return e.getIdForLabel()}return this.getId()};D.prototype.unbindProperty=function(t,e){d.prototype.unbindProperty.apply(this,arguments);var i=this.getAllInnerControls();i.forEach(function(i){var r=i.getMetadata().getName();var o=n.getBoundPropertiesMapInfoForControl(r,{propertyName:t});if(Array.isArray(o)){o.forEach(function(t){i.unbindProperty(t,e)})}});return this};D.prototype.getMode=function(){var t=this.getEditable(),e=this.getEnabled(),i=this.getContextEditable();if(this.data("configdata")&&this.data("configdata").configdata&&this.data("configdata").configdata.isUOM&&this.data("configdata").configdata.isInnerControl&&this.data("configdata").configdata.getContextEditable){i=this.data("configdata").configdata.getContextEditable()}return t&&e&&i?"edit":"display"};D.prototype.isInEditMode=function(){return this.getMode()==="edit"};D.prototype._toggleInnerControlIfRequired=function(t){var e=t.mode;if(this._bSuppressToggleControl||(!this._oFactory||this._oFactory.bPending)){return}if(e==="edit"){this._createControlIfRequired(t)}else{var i=this.getProperty("value"),r=true;var o=this.data("configdata");if(o&&o.configdata&&!o.configdata.isUOM){if(i===null||i===""){r=false}}if(r){this._createControlIfRequired(t)}else{this.setContent(null);this._oControl.current="display"}}};D.prototype._propagateToInnerControls=function(t){if(t==="edit"){this._propagateFieldGroupIDs(this.getProperty("_internalFieldGroupIds"))}this._setOnInnerControl()};D.prototype._propagateFieldGroupIDs=function(t){var e;if(Array.isArray(t)&&t.length){e=this.getFirstInnerControl();if(e){e.setFieldGroupIds(t)}}};D.prototype._onInnerControlToggled=function(t){var e,i,r,o=false,n=false;if(t&&t.fetchIDAndDescription&&this.getModel()&&this.getBindingContext()&&this.getBinding("value")){this._oFactory.fetchIDAndDescriptionCollectionIfRequired(t.forceTextArrangementFetch)}this._initialStateApplied.resolve();this._propagateToInnerControls(t.mode);this._processEvents({editableChanged:t.editableChanged,editable:t.editable,contextEditableChanged:t.contextEditableChanged,contextEditable:t.contextEditable});if(t.mode==="display"&&this.isFormContextType()){this._setEmptyIndicator(this.getFirstInnerControl())}if(t.mode==="edit"){i=this.getContent();r=this._oControl.edit;o=r&&i&&r.getId()===i.getId();if(o){this._checkFieldGroups({mode:t.mode})}}e=this._getEmbeddedSmartField();if(e&&e.data("configdata")&&e.data("configdata").configdata.isUOM){e.setClientSideMandatoryCheck(t.clientSideMandatoryCheck);var a=this._oFactory.getMetaData&&this._oFactory.getMetaData();if(e.getBindingInfo("editable")||a&&a.annotations&&a.annotations.uom.property&&a.annotations.uom.property.property&&a.annotations.uom.property.property["sap:updatable"]){n=true}if(t.isFormContextType&&t.contextEditable&&t.contextEditable!==t.editable&&!n&&e.getEditable()!==t.editable){e.setEditable(t.editable)}}};D.prototype._processEvents=function(t){if(t.editableChanged){this.fireEditableChanged({editable:t.editable})}if(t.contextEditableChanged){this.fireContextEditableChanged({editable:t.contextEditable})}};D.prototype._forceInitialise=function(){if(this._isBoundToDefaultModel()){return this._processStateHandler()}else if(!this.bIsListeningForDefaultModel){this.bIsListeningForDefaultModel=true;return new Promise(function(t,e){this.attachEvent("modelContextChange",{resolve:t,reject:e},this._forceInitialiseHandler,this)}.bind(this))}};D.prototype._forceInitialiseHandler=function(t,e){if(this._isBoundToDefaultModel()){this.detachEvent("modelContextChange",this._forceInitialiseHandler,this);this._processStateHandler().then(function(){e.resolve()}).catch(function(t){e.reject(t)})}};D.prototype._processStateHandler=function(){var t=this.getMode();return this._processState().then(function(){var e=this._getEmbeddedSmartFieldByMode(t);return e&&e._processState()}.bind(this))};D.prototype._updateInnerControlsIfRequired=function(){var t,e,i={mode:this.getMode(),contextEditable:this.getContextEditable(),editable:this.getEditable(),enabled:this.getEnabled(),visible:this.getVisible()};this._updateInnerControlsIfRequiredHandler(i);t=this._getEmbeddedSmartField();if(t&&t.isA("sap.ui.comp.smartfield.SmartField")){e={mode:t.getMode(),contextEditable:t.getContextEditable(),editable:t.getEditable(),enabled:t.getEnabled(),visible:t.getVisible()};t._updateInnerControlsIfRequiredHandler(e)}};D.prototype._updateInnerControlsIfRequiredHandler=function(t){this._init();if(this._oFactory!==null){this._oFactory._init(this._oFactory._oMeta)}this._toggleInnerControlIfRequired(t)};D.prototype.setImportance=function(t){var e=this.getProperty("importance");if(e===t){return this}this.setProperty("importance",t);return this};D.prototype.setValue=function(t){this.setProperty("value",t);if(!this.isPropertyBeingUpdatedByModel("value")&&!this.getBindingContext()){var e=this.getFirstInnerControl();if(e){var i=e.getMetadata().getName();var r=n.getBoundPropertiesMapInfoForControl(i,{propertyName:"value"})[0];var o=e.getBinding(r);if(this.getMode()==="display"&&o&&typeof o.getFormatter()==="function"&&o.getBindingMode()===f.OneWay){t=o.getExternalValue()}this._setPropertyOnControls(r,t,[e])}}return this};D.prototype._getInnerControlPropertyBinding=function(t){var e,i,r,o,a,s=this._oControl[t],l=s&&this._getInnerControls(s);if(Array.isArray(l)&&l.length>0){e=l[0];i=e.getMetadata().getName();r=n.getBoundPropertiesMapInfoForControl(i,{propertyName:"value"})}if(Array.isArray(r)&&r.length>0){o=r[0];a=e.getBinding(o)}return a};D.prototype.isTextInEditModeSourceNotNone=function(t){return this._getComputedTextInEditModeSource(false,t)!==S.None};D.prototype._getComputedTextInEditModeSource=function(t,e){var i=e||this.getMode(),r=this.getTextInEditModeSource(),o=this.data("defaultTextInEditModeSource");if(o&&this.isPropertyInitial("textInEditModeSource")&&i==="edit"){r=o}if(!t&&r===S.ValueListWarning){r=S.ValueListNoValidation}return r};D.prototype._isValueListWarning=function(){return this._getComputedTextInEditModeSource(true)===S.ValueListWarning};D.prototype._isValueListValidationMode=function(){var t=this._getComputedTextInEditModeSource(true);if(t===S.ValueList||t===S.ValueListWarning){return true}return false};D.prototype._createControlIfRequired=function(t){if(!this._oFactory){return}var e=t.mode,i=this._oControl[e];if(e!==this._oControl.current||!i){if(!i){var r=this._oFactory.createControl(t);if(r){if(e!=="edit"&&this._getFocusCatcher()){this._destroyFocusCatcher()}this._oControl[e]=r.control;this._placeCallBacks(r,e)}}this._oControl.current=e;this.setContent(this._oControl[e]);this._oFactory.updateControl(t);this._setOnInnerControl();this._fireInnerControlsCreated()}else if(!this.getContent()){this._oControl.current=e;this.setContent(this._oControl[e])}};D.prototype._fireInnerControlsCreated=function(){var t=this._getEmbeddedSmartField();if(t&&t.isA("sap.ui.comp.smartfield.SmartField")){t.attachInnerControlsCreated(function(){this.fireInnerControlsCreated(this.getInnerControls())}.bind(this))}else{this.fireInnerControlsCreated(this.getInnerControls())}};D.prototype._placeCallBacks=function(t,e){if(t.params&&t.params.getValue){this._oValue[e]=t.params.getValue}if(t.params&&t.params.uom){this._oValue.uom=t.params.uom}if(t.params&&t.params.uomset){this._oValue.uomset=t.params.uomset}};D.prototype._init=function(t){var e,i,r;if(!this._oFactory){i=this.data("configdata");if(!i){e=this.getModel(t)}r=this.getBindingPath("value");if(t===undefined&&r&&(i||e)){this._oFactory=this._createFactory(t,e,r,i)}}};D.prototype.clone=function(){var t=d.prototype.clone.apply(this,arguments);t.attachModelContextChange(function(){t.invalidate()});return t};D.prototype._destroyFactory=function(){this._bSuppressToggleControl=true;this._bSideEffects=false;if(this._oFactory){this._oFactory.destroy()}this._oFactory=null;this._bSuppressToggleControl=false;this._destroyControls()};D.prototype._destroyControls=function(){if(this._oControl){if(this._oControl.display){this._oControl.display.destroy()}if(this._oControl.edit){this._oControl.edit.destroy()}this._oControl.display=null;this._oControl.edit=null;this._oControl.current=null}this._oValue={display:null,edit:null,uom:null,uomset:null};this.destroyAggregation("_content")};D.prototype._createFactory=function(t,e,i,r){if(e&&e instanceof c){return new o(e,this,{model:t,path:i})}var a;if(!r){a=this._getEntitySet(t)}if(a||r){var s;if(r){s=r.configdata;this._enhanceConfigData(s)}else{s={entitySet:a,model:t,path:i}}return new n(e,this,s)}return null};D.prototype._enhanceConfigData=function(t){var e=this.data("ignoreInsertRestrictions");if(typeof e==="boolean"){t.ignoreInsertRestrictions=e}};D.prototype._getEntitySet=function(t,e){var i=this.getEntitySet(),r=i!=="";if(r&&!t){return i}var o=this.getBindingContext(t);if(o){var n=o.getPath();if(n===""||n===undefined||n==="/undefined"){return""}i=this._oUtil.correctPath(n);if(!e){this.fireEntitySetFound({entitySet:i})}return i}return""};D.prototype._getODataEntityType=function(t){var e,i,r,o,n=this.getModel(),a=n&&n.getMetaModel();e=this._getEntitySet(t);if(e===""){return}o=a.getODataEntitySet(e);if(o!==null&&o.entityType){i=o.entityType}if(i===undefined){r=a.getODataFunctionImport(e);if(r!==null&&r.returnType){i=r.returnType}}return i};D.prototype.getDataType=function(){var t;if(this._oFactory){if(this._oFactory.getDataProperty){t=this._oFactory.getDataProperty();if(t){return t.property.type}}return this.getJsonType()}return null};D.prototype.getDataProperty=function(){var t,e,i,r,o,n=this.getModel(),a=n&&n.getMetaModel();if(this._oFactory){if(this._oFactory.getDataProperty){return this._oFactory.getDataProperty()}}else{o=this.data("configdata")&&this.data("configdata").configdata;if(o&&o.property){return o.property}if(!a||!a.oModel){return null}e=this._getODataEntityType();if(e===undefined){return null}t=this.getBindingPath("value");if(t===undefined){return null}i=a.getODataEntityType(e);r=a.getODataProperty(i,t);if(r===null){return null}return{property:r}}};D.prototype.getUnitOfMeasure=function(){if(this._oValue.uom){return this._oValue.uom()}return null};D.prototype.setUnitOfMeasure=function(t){if(t&&this._oValue.uomset){this._oValue.uomset(t)}};D.prototype.setSimpleClientError=function(t){this._oError.bFirst=t};D.prototype.setComplexClientErrorFirstOperand=function(t){this._oError.bComplex=true;this._oError.bFirst=t};D.prototype.setComplexClientErrorSecondOperand=function(t){this._oError.bComplex=true;this._oError.bSecond=t};D.prototype.setComplexClientErrorSecondOperandNested=function(t){var e=this.getParent().getParent();e.setComplexClientErrorSecondOperand(t)};D.prototype._hasClientError=function(){if(this._oError.bComplex){return this._oError.bFirst||this._oError.bSecond}return this._oError.bFirst};D.prototype.checkClientError=function(t){t=Object.assign({handleSuccess:false},t);var e="The sap.ui.comp.smartfield.SmartField#checkClientError method is deprecated. "+"Please use the sap.ui.comp.smartfield.SmartField#checkValuesValidity method instead.";_.warning(e,this.getMetadata().getName());if(this.getMode()==="display"){return false}if(this._hasClientError()&&!t.handleSuccess){return true}this.getInnerControls().forEach(function(e){this._checkErrors(e,{checkClientErrorsOnly:true,handleSuccess:t.handleSuccess})}.bind(this));return this._hasClientError()};D.prototype.checkValuesValidity=function(t){var e,i=this.getControlFactory(),r;if(i&&i.getEdmProperty){r=i.getEdmProperty();if(!r){return Promise.resolve()}e=r.name}if(this.getMode()==="display"){return Promise.resolve({property:e,instance:this})}t=t||{};var o={handleSuccess:true,innerControls:this.getInnerControls(),rawValues:[]};var n=this._getEmbeddedSmartField();t=Object.assign(o,t);if(t.rawValues.length===0&&n&&n.data("configdata")&&n.data("configdata").configdata.isUOM){this._updateCurrencyRawValues(t)}return new Promise(function(i,r){var o={rawValues:t.rawValues,handleSuccess:t.handleSuccess,bCheckValuesValidity:true};var n=t.innerControls.map(function(t){return this._checkErrors(t,o)},this);Promise.all(n).then(function(){i({property:e,instance:this})}.bind(this)).catch(function(t){r({property:e,instance:this})}.bind(this))}.bind(this))};D.prototype.checkUnitValidity=function(t){var e=false;if(this.getMode()==="display"){return true}t=t||{};var i={handleSuccess:true,innerControls:this.getInnerControls(),rawValues:[]};var r=this._getEmbeddedSmartField();t=Object.assign(i,t);if(t.rawValues.length===0&&r&&r.data("configdata")&&r.data("configdata").configdata.isUOM){this._updateCurrencyRawValues(t)}if(i.innerControls.length!==2&&(i.innerControls.length!==1&&!this._oFactory._checkSuppressUnit())){throw new h}r=r?r:i.innerControls[1];var o=i.innerControls[0],a=r?r:this._getUomControl(),s,l,u,d;t=Object.assign({checkClientErrorsOnly:false,handleSuccess:true},t);if(o){var c=n.getBoundPropertiesMapInfoForControl(o.getMetadata().getName(),{propertyName:"value"});u=c&&c[0]}if(a){var f=n.getBoundPropertiesMapInfoForControl(a.getMetadata().getName(),{propertyName:"value"});d=f&&f[0]}if(u){s=o.getBinding(u)}if(d){l=a.getBinding(d)}if(!s||!l&&!this._oFactory._checkSuppressUnit()){return true}try{var _="get"+y(u),m=s.getType(),C=s.sInternalType,b=o[_]();if(C&&m){var v=t.rawValues||s.getValue(),V=m.parseValue(b,s.sInternalType,v);if(V){m.validateValue(V)}if(s.hasValidation()){var I=false,S=true,E={element:o,property:u,type:s.getType(),newValue:b,oldValue:s.getValue(),mParameters:{suppressChangeModelValue:true}};o.fireValidationSuccess(E,I,S);e=true}}}catch(t){var F={element:o,property:u,type:s.getType(),newValue:b,oldValue:s.getValue(),exception:t,message:t.message};if(t instanceof g){F.targetControl=r&&r.getFirstInnerControl()}if(t instanceof p){o.fireParseError(F)}else if(t instanceof h){o.fireValidationError(F)}else{if(t.toString()==="TypeError: Cannot read property 'decimals' of undefined"){t.validationUnitError=true}throw t}}try{if(!d||!a.getVisible()){return e}var P="get"+y(d),M=l.getType(),x=l.sInternalType,b=o[_](),T=a[P]();if(x&&M){var v=t.rawValues||s.getValue(),A=M.parseValue(T,l.sInternalType,v);if(A){M.validateValue(A)}if(l.hasValidation()){var I=false,S=true,D={element:a,property:d,type:l.getType(),newValue:T,oldValue:l.getValue(),mParameters:{suppressChangeModelValue:true}};a.fireValidationSuccess(D,I,S);e&=true}}}catch(t){var B={element:a,property:d,type:l.getType(),newValue:T,oldValue:l.getValue(),exception:t,message:t.message};if(t instanceof p){a.fireParseError(B)}else if(t instanceof h){a.fireValidationError(B)}else{t.validationUnitError=true;throw t}e=false}return e};D.prototype._updateCurrencyRawValues=function(t){t.rawValues=t.innerControls.map(function(t){var e=t.getMetadata(),i=n.getBoundPropertiesMapInfoForControl(e.getName(),{propertyName:"value"});return e.getProperty(i).get(t)})};D.prototype._checkErrors=function(t,e){e=Object.assign({checkClientErrorsOnly:false,handleSuccess:true},e);var i,r,o=this;if(t){var a=n.getBoundPropertiesMapInfoForControl(t.getMetadata().getName(),{propertyName:"value"});r=a&&a[0]}if(r){i=t.getBinding(r)}if(!i){return Promise.resolve()}var s;function l(e){var n,a={element:t,property:r,type:i.getType(),newValue:s,oldValue:i.getValue(),exception:e,message:e.message};if(e instanceof g){n=o._getEmbeddedSmartField();a.targetControl=n&&n.getFirstInnerControl()}if(e instanceof p){t.fireParseError(a)}else if(e instanceof h){t.fireValidationError(a)}else{throw e}}function u(){if(e.handleSuccess&&i.hasValidation()){var o={element:t,property:r,type:i.getType(),newValue:s,oldValue:i.getValue(),mParameters:{suppressChangeModelValue:true}};var n=false,a=true;t.fireValidationSuccess(o,n,a)}}try{var d="get"+y(r),c=i.getType(),f=i.sInternalType;s=t[d]();if(f&&c){if(e.checkClientErrorsOnly&&c.async){var m="The deprecated sap.ui.comp.smartfield.SmartField#checkClientError method can not be "+"used with async types. Please use sap.ui.comp.smartfield.SmartField#checkValuesValidity "+"method instead.";_.error(m,this.getMetadata().getName());this.setSimpleClientError(true);return Promise.reject()}if(c.async){var C=i.getDataState();var b=c.formatValue(C.getValue(),f);if(!C.isControlDirty()&&b===s){u();return Promise.resolve()}}var v=e.rawValues||i.getValue(),V=c.parseValue(s,i.sInternalType,v),I;if(V&&V instanceof Promise){I=V.then(function(t){return c.validateValue(t)}).then(u);I.catch(l);return I}I=c.validateValue(V,e.bCheckValuesValidity);if(I instanceof Promise){I.catch(l);return I.then(u)}}}catch(t){l(t);return Promise.reject()}u();return Promise.resolve()};D.prototype.isContextTable=function(){return this.getControlContext()==="responsiveTable"||this.getControlContext()==="table"};D.prototype.isFormContextType=function(){var t=this.getControlContext(),e=i.smartfield.ControlContextType;return t===e.Form||t===e.SmartFormGrid};D.prototype.isTableContextType=function(){var t=this.getControlContext(),e=i.smartfield.ControlContextType;return t===e.Table||t===e.ResponsiveTable};D.prototype.getInnerControls=function(){var t=this.getContent();return this._getInnerControls(t)};D.prototype._getInnerControls=function(t){var e,i={"sap.m.HBox":function(t){var e,i,r=0;i=t.getItems();if(i){r=i.length}if(r===0){return[]}if(r===1){return[i[0]]}e=i[1].getContent();if(e){return[i[0],e]}return[i[0]]},"sap.ui.comp.navpopover.SmartLink":function(t){var e=t.getAggregation("innerControl");if(e){return[e]}return[t]}};if(t){e=i[t.getMetadata()._sClassName]}if(e){return e(t)}if(t){return[t]}return[]};D.prototype.getAllInnerControls=function(){var t=[],e=this._oControl;if(e){for(var i in e){if(e.hasOwnProperty(i)){var r=e[i];if(r&&r instanceof Object){t.push(r)}}}}return t};D.prototype._getEmbeddedSmartField=function(){var t=this.getContent();return this._getEmbeddedSmartFieldInstace(t)};D.prototype._getEmbeddedSmartFieldByMode=function(t){var e=t==="edit"?this._oControl.edit:this._oControl.display;return this._getEmbeddedSmartFieldInstace(e)};D.prototype._getEmbeddedSmartFieldInstace=function(t){if(t){if(t.isA("sap.m.HBox")){var e=t.getItems();if(e){for(var i=0;i<e.length;i++){if(e[i].isA("sap.ui.comp.smartfield.SmartField")){return e[i]}}}}}return null};D.prototype._createFocusCatcher=function(){this.__oFakeInput=new sap.m.Input(this.getId()+"-fakeInput")};D.prototype._destroyFocusCatcher=function(){if(this.__oFakeInput){this.__oFakeInput.destroy();this.__oFakeInput=null}};D.prototype._getFocusCatcher=function(){return this.__oFakeInput};D.prototype._isFocusCatcherFocused=function(){return this._getFocusCatcher()&&this._getFocusCatcher().getId()+"-inner"===document.activeElement.getAttribute("id")};D.prototype.onAfterRendering=function t(){d.prototype.onAfterRendering.bind(this,arguments);this._applyPlaceHolder();if(this.__oFakeInput){setTimeout(function(){if(this.__oFakeInput){this.__oFakeInput.setBlocked(true)}}.bind(this),1e3)}};D.prototype.onBeforeRendering=function t(){var e;if(this.__oFakeInput){this.__oFakeInput.setBlocked(false)}if(!this._hasDefaultModel()||this._bInDestroy){return Promise.resolve()}e=this._processState().then(this.accessibilityAttributesHandler.bind(this)).then(d.prototype.onBeforeRendering.bind(this,arguments));return e};D.prototype._calculateCurrentState=function(){var t,e,i,r=this.getClientSideMandatoryCheck(),o=this._getControlDescriptionPath(this._oControl.edit),n=this._getControlDescriptionPath(this._oControl.display),a=this.getEditable(),s=this.getContextEditable(),l=this.isFormContextType(),u=this.getMode(),d=this.getEnabled(),p=this.getVisible(),h=this.getBinding("value"),g=h&&this._oState.isValuePropertyChanged(h.getValue()),c=this._oState.isValueBindingPathChanged(this.getBindingPath("value")),f=this._oState.isModelChanged(this.getModel()),y=this._oState.isBindingContextChanged(this.getBindingContext()),_=this._oState.isEntitySetChanged(this._getEntitySet(undefined,true)),m=this._oState.isModeChanged(u),C=this._oState.isEditableChanged(a),b=this._oState.isContextEditableChanged(s),v=this._isDescriptionBindingPathDefault(),V=this._getComputedTextInEditModeSource()===S.ValueListNoValidation&&g,I=m&&o!==n,E=c||f||_,F=E;if(E){this._oState._resetProperty("EDIT");this._oState._resetProperty("DISPLAY")}t=this._oState.isModeInitialized(u);e=y||!t;i=V||!t||v||g||I;return{mode:u,rebind:i,enabled:d,visible:p,editable:a,editableChanged:C,contextEditable:s,contextEditableChanged:b,forceTextArrangementFetch:e,clientSideMandatoryCheck:r,isFormContextType:l,isFactoryJustCreated:F,destroyFactory:E,bindingContextChanged:y}};D.prototype._processState=function(){var t,e,i,r,o=this._calculateCurrentState();e={mode:o.mode,rebind:o.rebind};i={mode:o.mode,contextEditable:o.contextEditable,editable:o.editable,enabled:o.enabled,visible:o.visible};r={editable:o.editable,editableChanged:o.editableChanged,isFormContextType:o.isFormContextType,contextEditable:o.contextEditable,contextEditableChanged:o.contextEditableChanged,forceTextArrangementFetch:o.forceTextArrangementFetch,clientSideMandatoryCheck:o.clientSideMandatoryCheck,mode:o.mode};if(this.isContextTable()&&(o.editableChanged||o.contextEditableChanged)&&(o.editable&&o.contextEditable)){var n=this._oControl&&this._oControl.edit;if(n){(n.isA("sap.m.HBox")?n.getItems():[n]).forEach(function(t){if(t.getValueState&&(t.getValueState()===I.Error||t.getValueState()===I.Warning)){t.setValueState(I.None)}})}}if(this._oFactory!==null&&o.destroyFactory){this._calculatePlaceHolder();this._destroyFactory()}if(o.bindingContextChanged){this._bSideEffects=false}this._init();if(this._oFactory===null){return Promise.resolve()}else{this._deletePlaceHolder()}t=this._oFactory.bind(e).then(function t(e){r.fetchIDAndDescription=e&&e.fetchIDAndDescription||false;if(this._oFactory===null){return Promise.reject()}if(o.isFactoryJustCreated&&this._oFactory.isA("sap.ui.comp.smartfield.ODataControlFactory")){this._oFactory.triggerCreationOfControls()}this._toggleInnerControlIfRequired(i);this._onInnerControlToggled(r);if(o.isFactoryJustCreated&&this._oFactory.isA("sap.ui.comp.smartfield.ODataControlFactory")){this._fireInitialise()}}.bind(this));return t};D.prototype._fireInitialise=function(){var t=this._getEmbeddedSmartField();if(t&&t.isA("sap.ui.comp.smartfield.SmartField")){t.attachInitialise(this.fireInitialise.bind(this))}else{this.fireInitialise()}};D.prototype._calculatePlaceHolder=function(){var t=this.getFirstInnerControl(),e=t&&t.getDomRef()||null;this._iInnerControlHeight=e&&e.offsetHeight||null};D.prototype._deletePlaceHolder=function(){this._iInnerControlHeight=null};D.prototype._applyPlaceHolder=function(){var t=this.getDomRef();if(t){if(this._iInnerControlHeight){t.style.minHeight=this._iInnerControlHeight+"px"}else{t.style.minHeight=""}}};D.prototype.accessibilityAttributesHandler=function(){var t=this._getEmbeddedSmartField();if(this.isContextTable()){this._handleAriaLabelledByInSmartTable(t)}else if(t){this._handleUoMAriaLabelledBy(t)}};D.prototype.getFirstInnerControl=function(){var t=this.getInnerControls();if(t.length){return t[0]||null}return null};D.prototype._checkFieldGroups=function(t){var e,i,r=t.mode;if(this.getBindingContext()&&this._oFactory&&this._oFactory.getMetaData&&r==="edit"&&!this._bSideEffects){i=this._calculateFieldGroupMetaData();e=this._getView();if(e&&i){this._setFieldGroup(i,e)}}};D.prototype._calculateFieldGroupMetaData=function(){var t=this._oFactory.getMetaData();if(t&&(!t.property||t.property&&!t.property.property)){return}return t};D.prototype._setFieldGroup=function(t,e){var i,r=this._oSideEffects.getFieldGroupIDs(t,e);if(r){i=this.getFirstInnerControl();if(i){this._bSideEffects=true;i.setFieldGroupIds(r)}}};D.prototype._getView=function(){var t=this.getParent();while(t){if(t.isA("sap.ui.core.mvc.View")){return t}t=t.getParent()}return null};D.prototype._getUomControl=function(){var t=this.getAllInnerControls();if(this.getUomEnabled()&&t&&t.length===1){var e=t[0].getItems?t[0].getItems():[];for(var i=0;i<e.length;i++){if(e[i].isA("sap.ui.comp.smartfield.SmartField")){return e[i]}}}return null};D.prototype.refreshDataState=function(t,e){var i,r,o,n;if(t==="value"){o=e&&e.getChanges();n=o&&o.value;if(n&&n.value!==n.oldValue){this._oLastValidated=null}B.apply(this,arguments);if(e.isLaundering()){if(this.getEditable()){i=this.getBindingContext();if(i&&i.getObject){r=i.getObject();if(r&&r.__metadata&&r.__metadata.created){this._checkCreated=true;return}}}}if(this._checkCreated&&!e.isLaundering()&&!e.isDirty()){if(this._oFactory){this._oFactory.rebindOnCreated()}this._checkCreated=false}}};D.prototype.onValidation=function(t){var e,i=t.getParameters(),r=i.newValue!==i.oldValue,o=this.data("configdata")&&this.data("configdata").configdata,n=o&&o.smartFieldRootControl?o.smartFieldRootControl:this,a=n._getEmbeddedSmartField(),s=a&&a.getFirstInnerControl(),l=s&&s.getId(),u=n.getModel(),d=t.getSource().getId(),p=i.mParameters,h=p&&p.originSource&&p.originSource.getId(),g=this._oLastValidated!==null&&this._oLastValidated.sourceId===d&&this._oLastValidated.sNewValue===i.newValue,c=p&&p.suppressChangeModelValue||g||false,y=l&&l!==d,_=l&&l===d,m=l&&h&&l!==h,C=l&&h&&l===h;if(h&&h!==d||c||u.getDefaultBindingMode()!==f.TwoWay){return}this._oLastValidated={sourceId:d,sNewValue:i.newValue};if(m||y){e={valueChanged:r,valueLastValueState:n.getValueState(),unitChanged:false,unitLastValueState:a.getValueState()}}else if(C||_){e={valueChanged:false,valueLastValueState:n.getValueState(),unitChanged:r,unitLastValueState:a.getValueState()}}else{e={valueChanged:r,valueLastValueState:n.getValueState()}}n.fireChangeModelValue(e)};D.prototype.exit=function(){this._bInDestroy=true;var t=null;if(this.__oFakeInput){this.__oFakeInput.destroy()}if(this._oSideEffects){this._oSideEffects.destroy()}if(this._oUtil){this._oUtil.destroy()}if(this._oFactory){this._oFactory.destroy()}var e=this._oControl;if(e){if(e.current==="edit"){t=e["display"]}else{t=e["edit"]}if(e[e.current]&&!e[e.current].getParent()){e[e.current].destroy()}}if(t&&typeof t.destroy==="function"){t.destroy()}this._oUtil=null;this._oError=null;this._oValue=null;this._oFactory=null;this._oControl=null;this._oSideEffects=null;this._oState=null;this._sAnnotationLabel="";this._oLastValidated=null};D.getSupportedAnnotationPaths=function(t,e,i,r){var o,n,a=[],s;if(t&&e&&i){s={entitySet:e,entityType:t.getODataEntityType(e.entityType),path:i};o={helper:new l(null,null,t)};if(r){o.navigationPathOnly=r}o.helper.getProperty(s);D._getFromEntitySet(a,s,o);D._getFromProperty(a,s,o);n=o.helper.getUnitOfMeasure2(s);if(n){D._getFromProperty(a,n,o)}o.helper.destroy()}return a};D._getFromEntitySet=function(t,e,i){var r;if(e.entitySet){r=i.helper.oAnnotation.getUpdateEntitySetPath(e.entitySet);D._push(r,t,e,i)}};D._push=function(t,e,i,r){var o,n,a,s,l={};if(t){if(r.navigationPathOnly){o=t.split("/");a=o.length;l.entityType=i.entityType;while(a--){n=o.shift();if(n===""){continue}l=r.helper.getNavigationProperty(l.entityType,n);if(!l.entitySet){break}if(s){s=s+"/"+n}else{s=n}}}else{s=t}}if(s){if(i.navigationPath){e.push(i.navigationPath+"/"+s)}else{e.push(s)}}};D._getFromProperty=function(t,e,i){var r;if(e.property.property){r=i.helper.oAnnotation.getText(e.property.property);D._push(r,t,e,i);r=i.helper.oAnnotation.getUnit(e.property.property);D._push(r,t,e,i);r=i.helper.oAnnotation.getFieldControlPath(e.property.property);D._push(r,t,e,i)}};D.prototype.addAssociation=function(t,e,i){if(t==="ariaLabelledBy"&&e){this.getInnerControls().forEach(function(t){if(t.addAriaLabelledBy){t.addAriaLabelledBy(e)}})}else if(t==="ariaDescribedBy"&&e){this.getInnerControls().forEach(function(t){if(t.addAriaDescribedBy){t.addAriaDescribedBy(e)}})}return d.prototype.addAssociation.apply(this,arguments)};D.prototype.removeAssociation=function(t,e,i){var r=d.prototype.removeAssociation.apply(this,arguments);if(t==="ariaLabelledBy"&&r){this.getInnerControls().forEach(function(t){if(t.removeAriaLabelledBy){t.removeAriaLabelledBy(r)}})}else if(t==="ariaDescribedBy"&&r){this.getInnerControls().forEach(function(t){if(t.removeAriaDescribedBy){t.removeAriaDescribedBy(r)}})}return r};D.prototype.getAccessibilityInfo=function(){var t=this.getContent();return t&&t.getAccessibilityInfo?t.getAccessibilityInfo():null};D.prototype.enhanceAccessibilityState=function(t,e){var i=this.getParent();if(i&&i.enhanceAccessibilityState){i.enhanceAccessibilityState(this,e)}};D.prototype._handleAriaLabelledByInSmartTable=function(t){var e,i=this;if(this.getAriaLabelledBy().length>0){this.getInnerControls().forEach(function(r){if(r.addAriaLabelledBy&&r.getAriaLabelledBy){e=r.getAriaLabelledBy().indexOf(i.getAriaLabelledBy()[0])>-1;if(!e&&r.getAriaLabelledBy().length===0){r.addAriaLabelledBy(i.getAriaLabelledBy()[0])}if(t){i._handleUoMAriaLabelledBy(t)}}})}};D.prototype._handleUoMAriaLabelledBy=function(t){this.getInnerControls().forEach(function(e){if(e.addAriaLabelledBy&&e.getAriaLabelledBy&&!t.getEditable()){var i=e.getAriaLabelledBy().indexOf(t.getId()+"-text")>-1;if(!i){e.addAriaLabelledBy(t.getId()+"-text")}}})};D.prototype._isValueInitial=function(){var t,e=this.getBinding("value"),i=e&&e.getDataState();if(!i||this._bValueNotInitial){t=false}else if(this._isValueInValidation()){t=this._getValueInValidation()===i.getOriginalValue()}else{t=i.getValue()===i.getOriginalValue()}return t};D.prototype._setValueInValidation=function(t){this._vValueInValidation=t};D.prototype._getValueInValidation=function(){return this._vValueInValidation};D.prototype._isValueInValidation=function(){return this._vValueInValidation!==undefined};D.prototype.getRequired=function(){if(this.getContextEditable()&&this.getEditable()){return this.getMandatory()}else{return false}};D.prototype.getBindingMode=function(t){var e=this.getBindingInfo(t);return e?e.parts[0].mode:undefined};D.prototype._innerControlHasNoValue=function(){var t,e,i,r,o,a,s,l,u=this.getInnerControls(),d=false;for(t=0;t<u.length;t++){o=u[t];a=o.getMetadata().getName();if(a==="sap.m.ObjectStatus"&&!(o.getText().trim()||o.getIcon().trim()||o.getTitle().trim())){d=true;break}else{l=n.getBoundPropertiesMapInfoForControl(a,{propertyName:"value"});if(!Array.isArray(l)){return false}i=0;for(e=0;e<l.length;e++){r=undefined;s=l[e];r=o.getProperty(s);if(r===""||r===null){i+=1}}if(i===l.length){d=true;break}}}return d};D.prototype._getHistoryEnabled=function(){return this.getHistoryEnabled()};D.prototype.getFormValueProperty=function(){return"value"};D.prototype.getFormFormattedValue=function(){var t,e=this._forceInitialise();if(e instanceof Promise){return e.then(function(){return this.getInnerControls().map(function(e){if(e.isA("sap.m.Text")){t=e.getText();if(!t&&e.getEmptyIndicatorMode()===A.On){t="-"}return t}}).join("")}.bind(this))}};D.prototype.getDataSourceLabel=function(){return this._sAnnotationLabel};D.prototype._isAsync=function(){var t=this._getComputedTextInEditModeSource(),e=i.smartfield.TextInEditModeSource,r;if(t===e.ValueList){return true}else if(t===e.NavigationProperty){return true}else if(t===e.ValueListNoValidation){r=this.getControlFactory()._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour");return r==="descriptionOnly"}return false};D.prototype._getTextArrangementRead=function(){if(!this._oTextArrangementRead){this._oTextArrangementRead=new V}return this._oTextArrangementRead};D.prototype._hasDefaultModel=function(){var t=this.getModel();return t!==undefined};D.prototype._isBoundToDefaultModel=function(){var t=this._hasDefaultModel(),e=this._getEntitySet(undefined,true);return t&&e};D.prototype._isDescriptionBindingPathDefault=function(){var t=this.getFirstInnerControl(),e=t&&t.getBinding("value"),i=e&&e.isA("sap.ui.model.CompositeBinding")&&e.getBindings()[1]&&e.getBindings()[1].getPath()==="__$$SmartFieldNotExistingBindingPath"||false;return i};D.prototype._getControlDescriptionPath=function(t){var e=t&&t.getBindingInfo("value"),i=e&&Array.isArray(e.parts)&&e.parts[1]&&e.parts[1].path;return i};D.prototype._initState=function(){return Object.create({_setProperty:function(t,e){if(this.mProperties===undefined||this.mProperties===null){this.mProperties={}}if(this.mProperties[t]===undefined){this.mProperties[t]={}}this.mProperties[t].previous=this.mProperties[t].current;this.mProperties[t].current=e},_getProperty:function(t){return this.mProperties&&this.mProperties[t]&&this.mProperties[t].current},_resetProperty:function(t){if(this.mProperties[t]!==undefined){this.mProperties[t]={}}},_resetProperties:function(){if(this.mProperties){this.mProperties={}}},isModeInitialized:function(t){var e=t==="edit"?"EDIT":"DISPLAY",i=this._getProperty(e);if(!i){this._setProperty(e,true)}return i},isModeChanged:function(t){var e="MODE",i=this._getProperty(e)!==t;if(i){this._setProperty(e,t)}return i},isValuePropertyChanged:function(t){var e="VALUE_PROPERTY_VALUE",i=this._getProperty(e)!==t;if(i){this._setProperty(e,t)}return i},isModelChanged:function(t){var e="MODEL_ID",i=t&&t.getId(),r=this._getProperty(e)!==i;if(r){this._setProperty(e,i)}return r},isValueBindingPathChanged:function(t){var e="VALUE_PROPERTY_BINDING_PATH",i=typeof t!=="undefined"&&this._getProperty(e)!==t;if(i){this._setProperty(e,t)}return i},isEntitySetChanged:function(t){var e="ENTITY_SET",i=this._getProperty(e)!==t;if(i){this._setProperty(e,t)}return i},isBindingContextChanged:function(t){var e="BINDING_CONTEXT_PATH",i=t&&t.getPath(),r=typeof i!=="undefined"&&this._getProperty(e)!==i;if(r){this._setProperty(e,i)}return r},isEditableChanged:function(t){var e="EDITABLE",i=this._getProperty(e)!==t;if(i){this._setProperty(e,t)}return i},isContextEditableChanged:function(t){var e="CONTEXT_EDITABLE",i=this._getProperty(e)!==t;if(i){this._setProperty(e,t)}return i}})};D.prototype.readODataLabel=function(){return new Promise(function(t,e){var i=this.getModel(),r=this.data("configdata"),o,n=i&&i.getMetaModel(),a,s;if(this._sAnnotationLabel){t(this._sAnnotationLabel);return}if(!i&&!r){e();return}a=new l(i,this._oUtil,n);if(r&&r.configdata){this._sAnnotationLabel=a.oAnnotation.getLabel(a.getEdmProperty(r.configdata));t(this._sAnnotationLabel);return}o=this.getBindingPath("value");s=this._getEntitySet();if(o&&s){n.loaded().then(function(){var e=a.oMeta.getODataEntitySet(s),i={entitySet:e,entityType:a.oMeta.getODataEntityType(e.entityType),path:o};a.getProperty(i);this._sAnnotationLabel=a.oAnnotation.getLabel(a.getEdmProperty(i));t(this._sAnnotationLabel)}.bind(this))}else{e()}}.bind(this))};D.prototype._setEmptyIndicator=function(t){if(t&&t.getEmptyIndicatorMode&&t.getEmptyIndicatorMode()!==A.On){t.setEmptyIndicatorMode(A.On)}};D.prototype._getEditableForNotExpandedNavigation=function(){return false};D.prototype._getComputedMetadata=function(){return this._initialStateApplied.promise.then(function(){return this._oFactory.isA("sap.ui.comp.smartfield.ODataControlFactory")&&this._oFactory.getMetaData()}.bind(this))};D.prototype._calculateFieldGroupIDs=function(t){return this._oSideEffects.getFieldGroupIDs(t,this._getView())};D.prototype._setInternalFieldGroupIds=function(t){this.setProperty("_internalFieldGroupIds",t)};D.prototype._isFixedValueList=function(){var t=this._oFactory.getMetaData();if(t&&t.annotations&&t.annotations.valuelistType==="fixed-values"){return true}return false};return D},true);
//# sourceMappingURL=SmartField.js.map