/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/apply/api/FlexRuntimeInfoAPI","sap/ui/fl/write/api/ReloadInfoAPI","sap/ui/fl/write/api/VersionsAPI","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/rta/Utils"],function(e,a,r,t,n,i,s){"use strict";var o={};var l={};var u={NOT_NEEDED:"NO_RELOAD",VIA_HASH:"CROSS_APP_NAVIGATION",RELOAD_PAGE:"HARD_RELOAD"};function f(e){return{target:{semanticObject:e.semanticObject,action:e.action,context:e.contextRaw},params:e.params,appSpecificRoute:e.appSpecificRoute,writeHistory:false}}function A(e){var a;var r=e.layer===n.CUSTOMER;if(e.hasHigherLayerChanges&&e.isDraftAvailable){a=r?"MSG_VIEWS_OR_PERSONALIZATION_AND_DRAFT_EXISTS":"MSG_HIGHER_LAYER_CHANGES_AND_DRAFT_EXISTS"}else if(e.hasHigherLayerChanges&&e.allContexts){a="MSG_RESTRICTED_CONTEXT_EXIST_AND_PERSONALIZATION"}else if(e.hasHigherLayerChanges){a=r?"MSG_PERSONALIZATION_OR_PUBLIC_VIEWS_EXISTS":"MSG_HIGHER_LAYER_CHANGES_EXIST"}else if(e.isDraftAvailable){a="MSG_DRAFT_EXISTS"}else if(e.allContexts){a="MSG_RESTRICTED_CONTEXT_EXIST"}return a}function _(e){var a=e.layer===n.CUSTOMER;if(e.hasHigherLayerChanges){if(!a){return"MSG_RELOAD_WITH_ALL_CHANGES"}if(e.isDraftAvailable){return"MSG_RELOAD_WITH_VIEWS_PERSONALIZATION_AND_WITHOUT_DRAFT"}if(e.allContexts){return"MSG_RELOAD_WITH_PERSONALIZATION_AND_RESTRICTED_CONTEXT"}return"MSG_RELOAD_WITH_PERSONALIZATION_AND_VIEWS"}if(e.initialDraftGotActivated){return"MSG_RELOAD_ACTIVATED_DRAFT"}if(e.isDraftAvailable){return"MSG_RELOAD_WITHOUT_DRAFT"}if(e.changesNeedReload){return"MSG_RELOAD_NEEDED"}if(e.allContexts){return"MSG_RELOAD_WITHOUT_ALL_CONTEXT"}return undefined}function c(e){var a=_(e);if(a){return s.showMessageBox("information",a,{titleKey:"HEADER_RELOAD_NEEDED"})}return Promise.resolve()}function E(e,a,r){if(l.CrossApplicationNavigation&&a){if(e.isDraftAvailable){t.loadDraftForApplication({control:e.selector,layer:e.layer,allContexts:e.allContexts})}else{t.loadVersionForApplication({control:e.selector,layer:e.layer,allContexts:e.allContexts})}}var n=A(e);var i=r?Promise.resolve():s.showMessageBox("information",n);return i.then(function(){o.enableAutomaticStart(e.layer,e.selector);e.onStart=true;return o.triggerReload(e)}).then(function(){return true})}function R(e){e.parameters=document.location.search;if(e.onStart){r.handleParametersOnStart(e,"standalone")}else{r.handleUrlParameters(e,"standalone")}if(document.location.search===e.parameters){o.reloadPage()}else{o.setUriParameters(e.parameters)}}function S(e){e.URLParsingService=l.URLParsing;e.parsedHash=i.getParsedURLHash(l.URLParsing);e.parameters=e.parsedHash.params;var a=e.onStart?r.handleParametersOnStart(e,"flp"):r.handleUrlParameters(e,"flp");if(a){l.CrossApplicationNavigation.toExternal(f(e.parsedHash))}else{l.AppLifeCycle.reloadCurrentApp()}if(e.triggerHardReload){o.reloadPage()}}o.setUShellServices=function(e){l=e};o.enableAutomaticStart=function(e,r){var t=a.getFlexReference({element:r});var n=t||true;window.sessionStorage.setItem("sap.ui.rta.restart."+e,n)};o.disableAutomaticStart=function(e){window.sessionStorage.removeItem("sap.ui.rta.restart."+e)};o.needsAutomaticStart=function(e){return!!window.sessionStorage.getItem("sap.ui.rta.restart."+e)};o.triggerReload=function(e){if(i.getUshellContainer()){S(e)}else{R(e)}};o.reloadPage=function(){window.location.reload()};o.setUriParameters=function(e){document.location.search=e};o.handleReloadOnStart=function(a){e(a,{hasHigherLayerChanges:false,isDraftAvailable:false,ignoreMaxLayerParameter:false,includeCtrlVariants:true,URLParsingService:l.URLParsing});return r.getReloadReasonsForStart(a).then(function(e){if(e.hasHigherLayerChanges||e.isDraftAvailable||e.allContexts){return E(e,a.versioningEnabled,a.developerMode)}return undefined})};o.checkReloadOnExit=function(e){return e.changesNeedReloadPromise.then(function(a){e.changesNeedReload=a;e.URLParsingService=l.URLParsing;var t=r.getReloadMethod(e);return c(t).then(function(){t.triggerHardReload=t.reloadMethod===u.RELOAD_PAGE;return t})})};o.handleUrlParametersOnExit=function(e){if(e.layer!==n.USER&&e.reloadMethod!==u.NOT_NEEDED){e.removeVersionParameter=true;o.triggerReload(e)}};return o});
//# sourceMappingURL=ReloadManager.js.map