/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","sap/m/MessageBox","sap/ui/rta/Utils","sap/ui/core/BusyIndicator","sap/base/util/uid","sap/base/Log","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/write/api/AppVariantWriteAPI","sap/ui/fl/write/api/ChangesWriteAPI","sap/ui/fl/write/_internal/connectors/LrepConnector"],function(e,t,n,r,a,i,s,o,u,p){"use strict";var c={};var l=56;c._newAppVariantId=null;c.getManifirstSupport=function(e){return p.appVariant.getManifirstSupport({appId:e})};c.getNewAppVariantId=function(){return c._newAppVariantId};c.setNewAppVariantId=function(e){c._newAppVariantId=e};c.trimIdIfRequired=function(e){if(e.length>l){var t=e.split(".");var n;var r=t[t.length-1].length;var a=t.pop();n=t.join(".");if(n.length>r){n=n.substring(0,n.length-r)}else{return e.substr(0,l)}if(n[n.length-1]==="."){n=n+a}else{n=n+"."+a}return this.trimIdIfRequired(n)}return e};c.getId=function(e){var t;var n=e.split(".");if(n[0]!=="customer"){n[0]="customer."+n[0]}var r=false;var i=/^id.*/i;n.forEach(function(e,t,n){if(e.match(i)){e=e.replace(i,a().replace(/-/g,"_"));n[t]=e;r=true}});t=n.join(".");if(!r){t=t+"."+a().replace(/-/g,"_")}t=this.trimIdIfRequired(t);this.setNewAppVariantId(t);return t};c.createAppVariant=function(e,t){t.version="1.0.0";return o.saveAs(Object.assign({selector:e},t))};c.getInlineChangeInput=function(e,t){return{type:"XTIT",maxLength:50,comment:t,value:{"":e}}};c.prepareTextsChange=function(e,t){var n="New "+e+" entered by a key user via RTA tool";return this.getInlineChangeInput(t,n)};c.getInlineChangeInputIcon=function(e){return{content:{icon:e}}};c.prepareRemoveAllInboundsExceptOneChange=function(e){return{content:{inboundId:e}}};c.getInboundInfo=function(t){var n={};if(!t){n.currentRunningInbound="customer.savedAsAppVariant";n.addNewInboundRequired=true;return Promise.resolve(n)}return e.getUShellService("URLParsing").then(function(t){return e.getParsedURLHash(t)}).then(function(e){var r=Object.keys(t);var a=[];if(r.length===1&&r[0]==="customer.savedAsAppVariant"){return{currentRunningInbound:"customer.savedAsAppVariant",addNewInboundRequired:false}}r.forEach(function(n){if(t[n].action===e.action&&t[n].semanticObject===e.semanticObject){a.push(n)}});switch(a.length){case 0:n.currentRunningInbound="customer.savedAsAppVariant";n.addNewInboundRequired=true;break;case 1:n.currentRunningInbound=a[0];n.addNewInboundRequired=false;break;default:n.currentRunningInbound="customer.savedAsAppVariant";n.addNewInboundRequired=true;break}return n})};c.getInboundPropertiesKey=function(e,t,n){return e+"_sap.app.crossNavigation.inbounds."+t+"."+n};c.getInlineChangeForInboundPropertySaveAs=function(e,t){return{inboundId:e,entityPropertyChange:{propertyPath:"signature/parameters/sap-appvar-id",operation:"UPSERT",propertyValue:{required:true,filter:{value:t,format:"plain"},launcherValue:{value:t}}}}};c.prepareAddNewInboundChange=function(t,n,r){return e.getUShellService("URLParsing").then(function(t){return e.getParsedURLHash(t)}).then(function(e){var a={content:{inbound:{}},texts:{}};var i=this.getInboundPropertiesKey(r.referenceAppId,t,"title");var s=this.getInboundPropertiesKey(r.referenceAppId,t,"subTitle");a.content.inbound[t]={semanticObject:e.semanticObject,action:e.action,title:"{{"+i+"}}",subTitle:"{{"+s+"}}",icon:r.icon,signature:{parameters:{"sap-appvar-id":{required:true,filter:{value:n,format:"plain"},launcherValue:{value:n}}},additionalParameters:"ignored"}};a.texts[i]=this.prepareTextsChange("title",r.title);a.texts[s]=this.prepareTextsChange("subTitle",r.subTitle);return a}.bind(this))};c.prepareChangeInboundChange=function(e,t,n){var r={content:{},texts:{}};var a=this.getInboundPropertiesKey(n.referenceAppId,e,"title");var i=this.getInboundPropertiesKey(n.referenceAppId,e,"subTitle");r.content={inboundId:e,entityPropertyChange:[{propertyPath:"signature/parameters/sap-appvar-id",operation:"UPSERT",propertyValue:{required:true,filter:{value:t,format:"plain"},launcherValue:{value:t}}},{propertyPath:"title",operation:"UPSERT",propertyValue:"{{"+a+"}}"},{propertyPath:"subTitle",operation:"UPSERT",propertyValue:"{{"+i+"}}"},{propertyPath:"icon",operation:"UPSERT",propertyValue:n.icon}]};r.texts[a]=this.prepareTextsChange("title",n.title);r.texts[i]=this.prepareTextsChange("subTitle",n.subTitle);return r};c.createInlineChange=function(e,t,n){var r={changeType:t,content:e.content};if(e.texts){r.texts=e.texts}return u.create({changeSpecificData:r,selector:n})};c.addChangesToPersistence=function(e,t){e.forEach(function(e){return s.add({change:e,selector:t})});return Promise.resolve()};c.getTransportInput=function(e,t,n,r){return{getPackage:function(){return e},getNamespace:function(){return t},getId:function(){return n},getDefinition:function(){return{fileType:r}}}};c.triggerCatalogAssignment=function(e,t,n){return o.assignCatalogs({selector:{appId:e},action:"assignCatalogs",assignFromAppId:n,layer:t})};c.triggerCatalogUnAssignment=function(e,t){return o.unassignCatalogs({selector:{appId:e},action:"unassignCatalogs",layer:t})};c.isS4HanaCloud=function(e){return e.isAtoEnabled()&&e.isAtoAvailable()};c.copyId=function(e){var t=document.createElement("textarea");t.value=e;document.body.appendChild(t);t.select();document.execCommand("copy");document.body.removeChild(t);return true};c.getTextResources=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta")};c.getText=function(e,t){var n=this.getTextResources();return t?n.getText(e,t):n.getText(e)};c._getErrorMessageText=function(e){var t;if(e.messages&&e.messages.length){t=e.messages.map(function(e){return e.text}).join("\n")}else if(e.userMessage){t=e.userMessage}else if(e.iamAppId){t="IAM App Id: "+e.iamAppId}else{t=e.stack||e.message||e.status||e}return t};c.buildErrorInfo=function(e,t,n){var r=this._getErrorMessageText(t);var a=c.getText(e)+"\n\n";if(n){a+=c.getText("MSG_APP_VARIANT_ID",n)+"\n"}a+=c.getText("MSG_TECHNICAL_ERROR",r);i.error("App variant error: ",r);return{text:a,appVariantId:n,error:true}};c.buildSuccessInfo=function(e,t,n){var r=n?"CLOUD":"ON_PREMISE";var a=t?"":"_OVERVIEW_LIST";var i=n?undefined:e;var s=c.getText("SAVE_APP_VARIANT_SUCCESS_MESSAGE")+"\n\n";s+=c.getText("SAVE_APP_VARIANT_SUCCESS_S4HANA_"+r+"_MESSAGE"+a,i);return{text:s,appVariantId:e,copyId:!n}};c.buildFinalSuccessInfoS4HANACloud=function(){var e=c.getText("MSG_SAVE_APP_VARIANT_NEW_TILE_AVAILABLE");return{text:e}};c.buildDeleteSuccessMessage=function(e,t){var n=t?"DELETE_APP_VARIANT_SUCCESS_MESSAGE_CLOUD":"DELETE_APP_VARIANT_SUCCESS_MESSAGE";var r=c.getText(n,e);return{text:r}};c.showRelevantDialog=function(e,a){r.hide();var i;var s;var o;var u;var p=[];if(a){i=this.getText("SAVE_APP_VARIANT_SUCCESS_MESSAGE_TITLE");s=this.getText("SAVE_APP_VARIANT_OK_TEXT")}else{i=this.getText("HEADER_SAVE_APP_VARIANT_FAILED");s=this.getText("SAVE_APP_VARIANT_CLOSE_TEXT")}if(e&&e.copyId){u=this.getText("SAVE_APP_VARIANT_COPY_ID_TEXT");p.push(u)}else if(e&&e.deleteAppVariant){i=this.getText("DELETE_APP_VARIANT_INFO_MESSAGE_TITLE");o=this.getText("DELETE_APP_VARIANT_OK_TEXT");p.push(o);s=this.getText("DELETE_APP_VARIANT_CLOSE_TEXT")}p.push(s);return new Promise(function(r,l){var g=function(t){if(t===u){c.copyId(e.appVariantId)}if(a){r()}else if(e.overviewDialog){r(false)}else if(e.deleteAppVariant&&t===o){r()}else if(e.deleteAppVariant&&t===s){l(e.deleteAppVariant)}else if(e.error){l(e.error)}else{r()}};t.show(e.text,{icon:a||e.deleteAppVariant?t.Icon.INFORMATION:t.Icon.ERROR,onClose:g,title:i,actions:p,styleClass:n.getRtaStyleClassName()})})};c.closeOverviewDialog=function(){sap.ui.getCore().getEventBus().publish("sap.ui.rta.appVariant.manageApps.controller.ManageApps","navigate")};c.navigateToFLPHomepage=function(){var t=e.getUshellContainer();var n;if(t){return t.getServiceAsync("AppLifeCycle").then(function(e){var r=e.getCurrentApplication();n=r.componentInstance;if(n){return t.getServiceAsync("CrossApplicationNavigation")}return undefined}).then(function(e){if(e&&e.toExternal){e.toExternal({target:{shellHash:"#"}},n)}}).catch(function(e){throw new Error("Error navigating to FLP Homepage: "+e)})}return Promise.resolve()};c.deleteAppVariant=function(e,t){r.hide();return o.deleteAppVariant({selector:e,layer:t})};c.handleBeforeUnloadEvent=function(){return c.getText("MSG_DO_NOT_CLOSE_BROWSER")};c.showMessage=function(e){var t=c.getText(e);var n={text:t,copyId:false};return c.showRelevantDialog(n,true)};c.catchErrorDialog=function(e,t,n){r.hide();var a=c.buildErrorInfo(t,e,n);return c.showRelevantDialog(a,false)};return c},true);
//# sourceMappingURL=AppVariantUtils.js.map