/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/fl/write/api/ContextSharingAPI","sap/m/ColumnListItem","sap/ui/core/Fragment","sap/base/util/uid","sap/ui/rta/appContexts/controller/RestAPIConnector"],function(t,e,o,n,r,s,i,a){"use strict";var p;var l;var d={Initial:0,Default:1024,Before:function(t){return t+1024},Between:function(t,e){return(t+e)/2},After:function(t){return t+.5}};function g(t){if(t.getParameter("selected")===true){var e=this.byId("moveUpButton");var o=this.byId("moveDownButton");e.setEnabled(true);o.setEnabled(true)}}function C(t){var e=t.getProperty("/appContexts")||[];e.forEach(function(t,e){t.rank=e+1});t.setProperty("/appContexts",e)}function u(t,e){return t.rank-e.rank}function c(t){var e=t.getProperty("/appContexts")||[];e.sort(u);t.setProperty("/appContexts",e);t.refresh(true)}function h(t){return s.load({id:this.getView().getId(),name:"sap.ui.rta.appContexts.view."+t,controller:this}).then(function(t){t.setModel(this.oAppContextsModel);this.getView().addDependent(t);return t}.bind(this))}function x(t){var e=this.oAppContextsModel.getProperty("types/role",t)||[];this.oComponent.setSelectedContexts({role:e})}function v(t,e){var o=this.oAppContextsModel.getProperty("/appContexts");var n=t?{types:{role:[]}}:Object.assign({},this.oAppContextsModel.getProperty("",e));n.id=i();n.title="";n.description="";n.rank=o.length+1;o.push(n);this.oAppContextsModel.setProperty("/appContexts",o);return n}return t.extend("sap.ui.rta.appContexts.controller.ManageContexts",{onInit:function(){this.oAppContextsModel=this.getView().getModel("appContexts");this.oI18n=this.getView().getModel("i18n").getResourceBundle();p=this.getOwnerComponent().getLayer();var t=this.byId("manageContexts");t.attachSelectionChange(g.bind(this));this.oAppContextsModel.setData(a.getAppContextData());C(this.oAppContextsModel);return n.createComponent({layer:p}).then(function(t){l=t;this.oComponent=l.getComponentInstance()}.bind(this))},formatContextColumnCell:function(t){var e=t.length+" "+this.oI18n.getText("TXT_TABLE_CONTEXT_CELL_ROLE");e+=t.length===1?"":"s";return e},formatEnabled:function(){var t=this.byId("manageContexts");return t.getSelectedItems().length!==0},formatContextTooltip:function(t){return(this.oI18n.getText("TXT_TABLE_CONTEXT_CELL_ROLE")+(t.length===1?"":"s")).toUpperCase()+" - \n"+t.join("\n")},moveUp:function(t){this.moveSelectedItem("Up");t.getSource().focus()},moveDown:function(t){this.moveSelectedItem("Down");t.getSource().focus()},moveSelectedItem:function(t){var e=this.byId("manageContexts");var o=e.getSelectedItem(0);var n=o.getBindingContext("appContexts");var r=e.indexOfItem(o)+(t==="Up"?-1:1);var s=e.getItems()[r];var i=s?s.getBindingContext("appContexts"):undefined;if(!i){return}var a=i.getProperty("rank");var p=n.getProperty("rank");this.oAppContextsModel.setProperty("rank",a,n);this.oAppContextsModel.setProperty("rank",p,i);c(this.oAppContextsModel);e.getItems()[r].setSelected(true).focus()},onDropSelectedProductsTable:function(t){var e=t.getParameter("draggedControl");var o=e.getBindingContext("appContexts");if(!o){return}var n=d.Default;var s=t.getParameter("droppedControl");if(s instanceof r){var i=t.getParameter("dropPosition");var a=s.getBindingContext("appContexts");var p=a.getProperty("rank");var l=s.getParent();var g=l.indexOfItem(s);var u=g+(i==="After"?1:-1);var h=l.getItems()[u];if(!h){n=d[i](p)}else{var x=h.getBindingContext("appContexts");n=d.Between(p,x.getProperty("rank"))}}this.oAppContextsModel.setProperty("rank",n,o);c(this.oAppContextsModel);C(this.oAppContextsModel)},onMenuAction:function(t){var e=t.getParameter("item");var o=e.getText();switch(o){case this.oI18n.getText("MAA_DIALOG_ADAPT_UI"):return this.handleUiAdaptation(t);case this.oI18n.getText("MENU_BTN_EDIT"):return this.edit(t);case this.oI18n.getText("MENU_BTN_SHARE"):return this.share(t);case this.oI18n.getText("MAA_DIALOG_DELETE"):return this.deleteContext(t);case this.oI18n.getText("MAA_DIALOG_SAVE_AS_APP"):return this.save(t);default:return undefined}},edit:function(t){var e=t.getSource().getBindingContext("appContexts");x.call(this,e);if(!this._pEditDialog){this._pEditDialog=h.call(this,"EditContextsDialog")}this._pEditDialog.then(function(t){t.addContent(l);this.oEditedContext=Object.assign({},this.oAppContextsModel.getProperty("",e));t.bindElement(e.getPath());t.open()}.bind(this))},editSelect:function(t){var e=t.getSource().getBindingContext();var o=this.oComponent.getSelectedContexts();this.oAppContextsModel.setProperty("types/role",o.role,e);t.getSource().getParent().close()},editClose:function(t){var e=t.getSource().getBindingContext();this.oAppContextsModel.setProperty("",this.oEditedContext,e);t.getSource().getParent().close()},save:function(t){var e=t.getSource().getBindingContext("appContexts");x.call(this,e);if(!this._pSaveAsDialog){this._pSaveAsDialog=h.call(this,"SaveAsContextsDialog")}var o=t.getSource().getId().endsWith("manageContexts-newContextButton");var n=v.call(this,o,e);this._pSaveAsDialog.then(function(t){t.addContent(l);t.bindElement("/appContexts/".concat(n.rank-1));t.open()})},saveSelect:function(t){var e=t.getSource().getBindingContext();var o=this.oAppContextsModel.getProperty("title",e);if(o===""){return this.byId("savecontextdialog-title-input").setValueState("Error")}var n=this.oComponent.getSelectedContexts();this.oAppContextsModel.setProperty("types/role",n.role,e);t.getSource().getParent().close()},saveClose:function(t){var e=this.oAppContextsModel.getProperty("/appContexts");e.pop();this.oAppContextsModel.setProperty("/appContexts",e);t.getSource().getParent().close()},share:function(){var t=this.byId("manageContexts");var e=t.getSelectedItem(0).getBindingContext("appContexts");var n=this.oAppContextsModel.getProperty("title",e);o.show("Context '"+n+"' shared!")},deleteContext:function(t){var e=t.getSource().getBindingContext("appContexts");var o=this.oAppContextsModel.getProperty("id",e);var n=this.oAppContextsModel.getProperty("/appContexts");var r=n.filter(function(t){return t.id!==o});this.oAppContextsModel.setProperty("/appContexts",r);C(this.oAppContextsModel)},pressColumnListItem:function(t){var o=t.getSource().getBindingContext("appContexts");var n=this.oAppContextsModel.getProperty("title",o);e.confirm("Do you want to adapt context '"+n+"'?")},handleUiAdaptation:function(){return false}})});
//# sourceMappingURL=ManageContexts.controller.js.map