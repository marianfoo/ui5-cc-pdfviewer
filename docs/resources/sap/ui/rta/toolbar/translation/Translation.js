/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/base/ManagedObject","sap/ui/core/Fragment","sap/ui/rta/Utils","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/MessageToast","sap/ui/fl/write/api/TranslationAPI","sap/ui/fl/Layer","sap/ui/core/util/File"],function(a,o,t,e,n,i,r,l,s,d){"use strict";function g(o){var t=o.userMessage||o.stack||o.message||o.status||o;var n=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");a.error(t);var r=n.getText("MSG_LREP_TRANSFER_ERROR")+"\n"+n.getText("MSG_ERROR_REASON",t);i.error(r,{styleClass:e.getRtaStyleClassName()})}var u=o.extend("sap.ui.rta.toolbar.translation.Translation",{metadata:{properties:{toolbar:{type:"any"}}},constructor:function(){o.prototype.constructor.apply(this,arguments);this._oTranslationModel=new n(h())}});function p(a){var o=a.getSource().getModel("translation");var t=o.getProperty("/sourceLanguage");var e=o.getProperty("/targetLanguage");var n=t+"_"+e+"_"+"TranslationXLIFF";var i={layer:s.CUSTOMER,sourceLanguage:t,targetLanguage:e,selector:this.getToolbar().getRtaInformation().rootControl};var r=new Promise(function(a){if(o.getProperty("/translationRelevantDirtyChangesExist")){r=this.getToolbar().fireSave({callback:a})}else{a()}}.bind(this));r.then(l.getTexts.bind(undefined,i)).then(function(a){d.save(a,n,"xml","application/xml");this._oDownloadDialog.close()}.bind(this)).catch(function(a){g(a)})}u.prototype._createDownloadTranslationDialog=function(){return t.load({name:"sap.ui.rta.toolbar.translation.DownloadTranslationDialog",id:this.getToolbar().getId()+"_download_translation_fragment",controller:{onDownloadFile:p.bind(this),onCancelDownloadDialog:function(){this._oDownloadDialog.close()}.bind(this)}}).then(function(a){this._oDownloadDialog=a;this._oDownloadDialog.setModel(this._oTranslationModel,"translation");this.getToolbar().addDependent(this._oDownloadDialog);return a}.bind(this))};u.prototype._createUploadTranslationDialog=function(){var a=this.getToolbar().getId()+"_upload_translation_fragment";return t.load({name:"sap.ui.rta.toolbar.translation.UploadTranslationDialog",id:a,controller:{onCancelUploadDialog:function(){this._oUploadDialog.close()}.bind(this),formatUploadEnabled:function(){var o=sap.ui.getCore().byId(a+"--fileUploader");return o.checkFileReadable()},saveFiles:function(a){this._oTranslationModel.setProperty("/file",a.getParameter("files")[0])}.bind(this),handleUploadPress:c.bind(this,a)}}).then(function(a){this._oUploadDialog=a;this._oUploadDialog.setModel(this._oTranslationModel,"translation");this.getToolbar().addDependent(this._oUploadDialog);return this._oUploadDialog}.bind(this))};function c(a){var o=sap.ui.getCore().byId(a+"--fileUploader");o.checkFileReadable().then(function(){if(this._oTranslationModel.getProperty("/file")){var a={layer:s.CUSTOMER,payload:new FormData};a.payload.append("file",this._oTranslationModel.getProperty("/file"),o.getValue());return l.uploadTranslationTexts(a).then(function(){var a=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");var o=a.getText("MSG_UPLOAD_TRANSLATION_SUCCESS");r.show(o,{styleClass:e.getRtaStyleClassName()});this._oUploadDialog.close()}.bind(this)).catch(function(a){g(a)}).finally(o.clear.bind(o))}}.bind(this))}function h(){return Object.assign({},{sourceLanguage:"",sourceLanguages:[],downloadChangedTexts:false,file:undefined})}u.prototype.openDownloadTranslationDialog=function(a){var o=l.hasTranslationRelevantDirtyChanges(a);this._oTranslationModel.setProperty("/translationRelevantDirtyChangesExist",o);return l.getSourceLanguages(a).then(function(a){if(a){this._oTranslationModel.setProperty("/sourceLanguages",a);this._oTranslationModel.setProperty("/sourceLanguage",a[0]||"")}}.bind(this)).then(function(){if(this._oDownloadDialogPromise){this._oTranslationModel.setProperty("/targetLanguage","")}else{this._oDownloadDialogPromise=this._createDownloadTranslationDialog()}return this._oDownloadDialogPromise}.bind(this)).then(function(a){return a.open()}).catch(function(a){g(a)})};u.prototype.openUploadTranslationDialog=function(){if(!this._oUploadDialogPromise){this._oUploadDialogPromise=this._createUploadTranslationDialog()}return this._oUploadDialogPromise.then(function(a){this.getToolbar().addDependent(a);return a.open()}.bind(this))};return u});
//# sourceMappingURL=Translation.js.map