/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/rta/plugin/Plugin","sap/ui/dt/Util","sap/ui/fl/Utils","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/write/api/ExtensionPointRegistryAPI","sap/base/util/values","sap/ui/core/Configuration"],function(t,n,e,r,i,a,o){"use strict";var s=t.extend("sap.ui.rta.plugin.AddXMLAtExtensionPoint",{metadata:{library:"sap.ui.rta",properties:{fragmentHandler:{type:"function"}},associations:{},events:{}}});var u="addXMLAtExtensionPoint";var l="appdescr_ui5_setFlexExtensionPointEnabled";function p(t){var n=t.getId();var e=i.getExtensionPointInfoByParentId({parentId:n});return e.length?e:a(i.getExtensionPointInfoByViewId({viewId:n}))}function d(t){return p(t).length>0}function f(){return o.getDesignMode()}s.prototype.bAppDescriptorCommandAlreadyAvailable=false;s.prototype._isEditable=function(t){if(f()){var n=t.getElement();return this.hasChangeHandler(u,n).then(function(t){return t&&d(n)})}return Promise.resolve(false)};s.prototype.isEnabled=function(t){return t.length===1};s.prototype.isAvailable=function(t){if(f()){var n=t[0].getElement();return d(n)}return false};function c(t,n,r){var i=n.extensionPointName;var a=e.getViewForControl(t);var o={name:i,view:a};var s={fragment:n.fragment,fragmentPath:n.fragmentPath};return this.getCommandFactory().getCommandFor(o,u,s).then(function(t){return r.addCommand(t)})}function m(t,n){var i=r.isFlexExtensionPointHandlingEnabled(t);if(i||this.bAppDescriptorCommandAlreadyAvailable){return Promise.resolve()}var a=e.getAppComponentForControl(t);var o=a.getManifestEntry("sap.app").id;return this.getCommandFactory().getCommandFor(t,"appDescriptor",{reference:o,appComponent:a,changeType:l,parameters:{flexExtensionPointEnabled:true},texts:{}}).then(function(t){this.bAppDescriptorCommandAlreadyAvailable=true;return n.addCommand(t)}.bind(this))}function g(t,n){var e;var r=t[0];var i=r.getElement();return this.getCommandFactory().getCommandFor(i,"composite").then(function(t){e=t}).then(function(){return c.call(this,i,n,e)}.bind(this)).then(function(){return m.call(this,i,e)}.bind(this)).then(function(){return e})}s.prototype.handler=function(t,e){return Promise.resolve().then(function(){var n=e.fragmentHandler||this.getFragmentHandler();if(!n){return Promise.reject("Fragment handler function is not available in the handler")}var r=t[0];var i=r.getElement();var a=p(i);return n(r,a)}.bind(this)).then(function(t){if(!t.extensionPointName||!(typeof t.extensionPointName==="string")){return Promise.reject("Extension point name is not selected!")}if(!t.fragmentPath||!(typeof t.fragmentPath==="string")){return Promise.reject("Fragment path is not available")}return t}).then(function(n){return g.call(this,t,n)}.bind(this)).then(function(t){this.fireElementModified({command:t})}.bind(this)).catch(function(t){throw n.propagateError(t,"AddXMLAtExtensionPoint#handler","Error occurred in AddXMLAtExtensionPoint handler function","sap.ui.rta")})};s.prototype.getMenuItems=function(t){return this._getMenuItems(t,{pluginId:"CTX_ADDXML_AT_EXTENSIONPOINT",rank:110,icon:"sap-icon://add-equipment"})};s.prototype.getActionName=function(){return"AddXMLAtExtensionPoint"};s.prototype.getAction=function(){return{changeType:u}};return s});
//# sourceMappingURL=AddXMLAtExtensionPoint.js.map