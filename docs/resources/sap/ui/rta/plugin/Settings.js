/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/rta/plugin/Plugin","sap/ui/rta/Utils","sap/ui/dt/Util","sap/base/Log"],function(e,t,n,a){"use strict";var r=e.extend("sap.ui.rta.plugin.Settings",{metadata:{library:"sap.ui.rta",properties:{commandStack:{type:"any"}},associations:{},events:{}}});var i="CTX_SETTINGS";r.prototype._isEditable=function(e){var t=this.getAction(e);if(t){if(t.handler){return this.hasStableId(e)}var n=Object.keys(t).some(function(n){var a=t[n];return a.handler&&this._checkRelevantContainerStableID(a,e)}.bind(this));if(n){return this.hasStableId(e)}}return false};r.prototype.isEnabled=function(e){var t=e[0];var n=this.getAction(t);if(!n){return false}if(typeof n.isEnabled!=="undefined"){if(typeof n.isEnabled==="function"){return n.isEnabled(t.getElement())}return n.isEnabled}return true};r.prototype._getUnsavedChanges=function(e,t){var n;var a=this.getCommandStack().getAllExecutedCommands().filter(function(a){n=a.getElementId&&a.getElementId()||a.getElement&&a.getElement().getId();return n===e&&t.indexOf(a.getChangeType())>=0}).map(function(e){return e.getPreparedChange()});return a};r.prototype._handleFlexChangeCommand=function(e,t,n,a){var r=e.changeSpecificData;var i;var o=e.selectorElement||e.selectorControl;var s;var d;if(o.controlType){s=o.controlType}else{d=o}return this.hasChangeHandler(r.changeType,d,s).then(function(e){if(t[0].getVariantManagement&&e&&!a.CAUTION_variantIndependent){i=t[0].getVariantManagement()}return this.getCommandFactory().getCommandFor(o,"settings",r,undefined,i)}.bind(this)).then(function(e){var t=a.runtimeOnly;if(e&&t){e.setRuntimeOnly(t)}return n.addCommand(e)})};r.prototype._handleAppDescriptorChangeCommand=function(e,t,n){var a=e.changeSpecificData;var r=e.appComponent;var i=r.getManifest();var o=i["sap.app"].id;return this.getCommandFactory().getCommandFor(t,"appDescriptor",{reference:o,appComponent:r,changeType:a.appDescriptorChangeType,parameters:a.content.parameters,texts:a.content.texts}).then(function(e){return n.addCommand(e)})};r.prototype._handleCompositeCommand=function(e,t,n,a){var r;return this.getCommandFactory().getCommandFor(t,"composite").then(function(e){r=e}).then(function(){return n.map(function(n){var i=n.changeSpecificData;if(i.changeType){return this._handleFlexChangeCommand(n,e,r,a)}else if(i.appDescriptorChangeType){return this._handleAppDescriptorChangeCommand(n,t,r)}},this)}.bind(this)).then(function(e){return Promise.all(e)}).then(function(){if(r.getCommands().length>0){this.fireElementModified({command:r})}}.bind(this))};r.prototype.handler=function(e,a,r){a=a||{};var i=e[0].getElement();var o=a.fnHandler;if(!o){o=e[0].getDesignTimeMetadata().getAction("settings").handler;if(!o){throw new Error("Handler not found for settings action")}}a.getUnsavedChanges=this._getUnsavedChanges.bind(this);a.styleClass=t.getRtaStyleClassName();return o(i,a).then(function(t){if(t.length>0){return this._handleCompositeCommand(e,i,t,r)}}.bind(this)).catch(function(e){throw n.propagateError(e,"Settings#handler","Error occurred during handler execution","sap.ui.rta.plugin")})};r.prototype.getMenuItems=function(e){var t=e[0];var n=this.getAction(t);var r=[];if(n){var d=110;if(n.handler){n={settings:n}}var u=Object.keys(n);u.forEach(function(e,u,c){var l=n[e];if(l.handler&&this._checkRelevantContainerStableID(l,t)&&this.isAvailable([t])){var h=c.length===1;r.push({id:h?i:i+u,rank:h?d:d+u,text:this.getActionText(t,l,i),icon:s(l),enabled:typeof l.isEnabled==="function"&&function(e){return l.isEnabled(e[0].getElement())}||l.isEnabled||this.isEnabled([t]),handler:function(e,t,n){n=n||{};n.fnHandler=e;return this.handler(t,n,l)}.bind(this,l.handler),submenu:o(l.submenu)})}else{a.warning("Handler not found for settings action '"+e+"' or relevant container has no stable id")}},this)}return r};function o(e){if(e){return e.map(function(e,t){return{id:e.key||i+"_SUB_"+t,icon:e.icon||"blank",text:e.name||"",enabled:e.hasOwnProperty("enabled")?e.enabled:true}})}}function s(e){var t="sap-icon://key-user-settings";var n=e.icon;if(!n){return t}if(typeof n!=="string"){a.error("Icon setting for settingsAction should be a string");return t}return n}r.prototype.getActionName=function(){return"settings"};return r});
//# sourceMappingURL=Settings.js.map