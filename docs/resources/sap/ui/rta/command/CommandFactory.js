/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/Log","sap/ui/base/ManagedObject","sap/ui/dt/ElementUtil","sap/ui/dt/OverlayRegistry","sap/ui/dt/Util","sap/ui/fl/Utils","sap/ui/fl/Layer"],function(e,t,n,a,r,i,o,c){"use strict";function m(e){var t=a.getAggregationInformation(e.getElement());if(t.elementId){var n=r.getOverlay(t.elementId);var o=n.getParentElementOverlay();var c=o?!!a.getAggregationInformation(o.getElement()).templateId:false;if(c){throw i.createError("CommandFactory#evaluateTemplateBinding","Multiple template bindings are not supported","sap.ui.rta")}var m=a.extractTemplateId(t);if(m){return{templateSelector:t.elementId,originalSelector:m,content:{boundAggregation:t.aggregation}}}}return undefined}function u(e,t){var n=typeof e==="string"?sap.ui.getCore().byId(e):e;var i=r.getOverlay(n);if(i){var o=a.getAggregationInformation(n);if(typeof t==="number"){o.stack[0].index=t}return a.extractTemplateId(o)}return n.getId()}function d(e){if(!e){throw new Error("adjustment for template failed")}}function s(e,n){var a;var r=false;var i=false;if(typeof n==="string"){a=n}else if(n){a=n.changeType;r=n.jsOnly===true;i=n.CAUTION_variantIndependent===true}if(!a){return false}e.setChangeType(a);e.setJsOnly(r);if(e.setVariantIndependent){e.setVariantIndependent(i)}else if(i){t.error("the variant independent Flag is not available for the action",a)}return true}function l(e,t,n){var a;if(n){a=n.getAction(t.name,e)}var r=a||{};Object.assign(r,{changeType:t.name});return r}function p(e){e.element=sap.ui.getCore().byId(u(e.element));d(e.element)}function g(e,t,n){var a=t.element||sap.ui.getCore().byId(t.element.id);var r=n.getActionDataFromAggregations("createContainer",a)[0];return r}function f(e){e.element=sap.ui.getCore().byId(u(e.element));d(e.element);e.parentId=u(e.parentId);d(e.parentId)}function v(e,t,n){var a=t.movedElements[0].element||sap.ui.getCore().byId(t.movedElements[0].id);var r=n.getAction("move",a);return r}function y(e){var t=e.movedElements.map(function(e){var t=sap.ui.getCore().byId(u(e.element,e.sourceIndex));d(t);return t});e.movedElements.forEach(function(e,n){e.element=t[n]});e.element=sap.ui.getCore().byId(u(e.element));d(e.element);e.source.parent=sap.ui.getCore().byId(u(e.source.parent));d(e.source.parent);e.target.parent=sap.ui.getCore().byId(u(e.target.parent));d(e.target.parent)}function z(e,t,n){return n.getAction("localReset",e)}function C(e,t,n){var a=t.renamedElement;var r=n.getAction("rename",a);return r}function I(e){e.element=sap.ui.getCore().byId(u(e.element));d(e.element);e.renamedElement=sap.ui.getCore().byId(u(e.renamedElement));d(e.renamedElement)}function b(e,t,a){var r=t.removedElement;if(!r){r=e}else if(!(r instanceof n)){throw new Error("No valid 'removedElement' found")}var i=a.getAction("remove",r);return i}function A(e){e.element=sap.ui.getCore().byId(u(e.element));d(e.element);e.removedElement=sap.ui.getCore().byId(u(e.removedElement));d(e.removedElement)}function E(e,t,n){var a=t.source;var r=n.getAction("combine",a);return r}function h(e){e.element=sap.ui.getCore().byId(u(e.element));d(e.element);e.source=sap.ui.getCore().byId(u(e.source));d(e.source);var t=e.combineElements.map(function(e){e=sap.ui.getCore().byId(u(e));d(e);return e});e.combineElements=t}function F(e,t,n){var a=t.source;var r=n.getAction("split",a);return r}function j(e){e.element=sap.ui.getCore().byId(u(e.element));d(e.element);e.parentElement=sap.ui.getCore().byId(u(e.parentElement));d(e.parentElement);e.source=sap.ui.getCore().byId(u(e.source));d(e.source)}function S(e,t,n){var a=t.element;return n.getAction("add",a,"delegate")}function O(e){e.element=sap.ui.getCore().byId(u(e.element));d(e.element);e.parentId=u(e.parentId);d(e.parentId)}function V(e,t,n){var a=t.element;var r=n.getAction("reveal",a);return r}function P(e){e.element=sap.ui.getCore().byId(u(e.element));d(e.element);if(e.revealedElementId){e.revealedElementId=u(e.revealedElementId);d(e.revealedElementId)}if(e.directParent){e.directParent=sap.ui.getCore().byId(u(e.directParent));d(e.directParent)}}function B(e,t,n){var a=n.getAction("add",t.element);if(a&&a.custom&&typeof a.custom.getItems==="function"){var r=Object.assign(a.custom,{changeOnRelevantContainer:t.changeOnRelevantContainer,changeType:t.changeType});delete t["changeOnRelevantContainer"];return r}return undefined}function R(e,t,n){return n.getAction("addIFrame",t.element)||n.getActionDataFromAggregations("addIFrame",t.element)[0]}function x(){return"propertyBindingChange"}function T(){return"propertyChange"}var w={composite:{clazz:"sap/ui/rta/command/CompositeCommand",noSelector:true},property:{clazz:"sap/ui/rta/command/Property",adjustForBinding:p,configure:T},bindProperty:{clazz:"sap/ui/rta/command/BindProperty",configure:x},addXML:{clazz:"sap/ui/rta/command/AddXML",configure:l,adjustForBinding:p},addXMLAtExtensionPoint:{clazz:"sap/ui/rta/command/AddXMLAtExtensionPoint",configure:l,adjustForBinding:p},createContainer:{clazz:"sap/ui/rta/command/CreateContainer",configure:g,adjustForBinding:f},move:{clazz:"sap/ui/rta/command/Move",configure:v,adjustForBinding:y},remove:{clazz:"sap/ui/rta/command/Remove",configure:b,adjustForBinding:A},localReset:{clazz:"sap/ui/rta/command/LocalReset",configure:z},rename:{clazz:"sap/ui/rta/command/Rename",configure:C,adjustForBinding:I},addDelegateProperty:{clazz:"sap/ui/rta/command/AddProperty",configure:S,adjustForBinding:O},reveal:{clazz:"sap/ui/rta/command/Reveal",configure:V,adjustForBinding:P},customAdd:{clazz:"sap/ui/rta/command/CustomAdd",configure:B},combine:{clazz:"sap/ui/rta/command/Combine",configure:E,adjustForBinding:h},split:{clazz:"sap/ui/rta/command/Split",configure:F,adjustForBinding:j},resize:{clazz:"sap/ui/rta/command/Resize"},switch:{clazz:"sap/ui/rta/command/ControlVariantSwitch"},save:{clazz:"sap/ui/rta/command/ControlVariantSave"},saveAs:{clazz:"sap/ui/rta/command/ControlVariantSaveAs"},setTitle:{clazz:"sap/ui/rta/command/ControlVariantSetTitle"},configure:{clazz:"sap/ui/rta/command/ControlVariantConfigure"},settings:{clazz:"sap/ui/rta/command/Settings"},addLibrary:{clazz:"sap/ui/rta/command/appDescriptor/AddLibrary",noSelector:true},appDescriptor:{clazz:"sap/ui/rta/command/AppDescriptorCommand",noSelector:true},addIFrame:{clazz:"sap/ui/rta/command/AddIFrame",configure:R},compVariantContent:{clazz:"sap/ui/rta/command/compVariant/CompVariantContent"},compVariantSaveAs:{clazz:"sap/ui/rta/command/compVariant/CompVariantSaveAs"},compVariantSwitch:{clazz:"sap/ui/rta/command/compVariant/CompVariantSwitch"},compVariantUpdate:{clazz:"sap/ui/rta/command/compVariant/CompVariantUpdate"}};function L(t,a,o,c,u,d){var l;a=a[0].toLowerCase()+a.slice(1);var p=w[a];var g=u;if(!p){return Promise.reject(i.createError("CommandFactory#getCommandFor","Command '"+a+"' doesn't exist, check typing","sap.ui.rta"))}return new Promise(function(e){var t=p.clazz;sap.ui.require([t],function(t){e(t)})}).then(function(i){var u=t instanceof n;if(!p.noSelector){o=Object.assign({},o,!u&&{selector:t})}o=Object.assign({},o,{element:u?t:undefined,name:a});var f;if(p.configure){f=p.configure(t,o,c)}var v;if(u){v=r.getOverlay(t)}if(f&&f.changeOnRelevantContainer){Object.assign(o,{element:v.getRelevantContainer()});t=o.element;v=r.getOverlay(t)}var y;if(v&&t.sParentAggregationName){y=m(v)}if(y){if(p.adjustForBinding){p.adjustForBinding(o)}g=e(y,g)}l=new i(o);var z=true;if(p.configure){z=s(l,f)}if(z){return l.prepare(g,d,a)}return undefined}).then(function(e){if(e){return l}l.destroy();return undefined})}var M=n.extend("sap.ui.rta.command.CommandFactory",{metadata:{library:"sap.ui.rta",properties:{flexSettings:{type:"object"}}}});M.prototype.init=function(){this.setProperty("flexSettings",{layer:c.CUSTOMER,developerMode:true})};M.prototype.setFlexSettings=function(e){this.setProperty("flexSettings",Object.assign(this.getFlexSettings(),e))};M.prototype.getCommandFor=function(e,t,n,a,r){return L(e,t,n,a,this.getFlexSettings(),r)};M.getCommandFor=function(e,t,n,a,r){if(!r){r={layer:c.CUSTOMER,developerMode:true}}if(r.scenario||r.baseId){var i=o.buildLrepRootNamespace(r.baseId,r.scenario,r.projectId);r.rootNamespace=i;r.namespace=i+"changes/"}return L(e,t,n,a,r)};return M},true);
//# sourceMappingURL=CommandFactory.js.map