/* Ephox advanced code plugin
 *
 * Copyright 2010-2016 Ephox Corporation.  All rights reserved.
 *
 * Version: 2.0.3-131
 */

!function(l){"use strict";var e,t,n,r,o,i,u,c,a=function(e){return parseInt(e,10)},s=function(e,t){var n=e-t;return 0===n?0:0<n?1:-1},f=function(e,t,n){return{major:e,minor:t,patch:n}},d=function(e){var t=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(e);return t?f(a(t[1]),a(t[2]),a(t[3])):f(0,0,0)},m=function(e,t){var n=s(e.major,t.major);if(0!==n)return n;var r=s(e.minor,t.minor);if(0!==r)return r;var o=s(e.patch,t.patch);return 0!==o?o:0},p=function(e){return d([(t=e).majorVersion,t.minorVersion].join(".").split(".").slice(0,3).join("."));var t},h=function(e,t){return!!e&&-1===m(p(e),d(t))},g=function(r,o){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r.console;n&&o in n&&n[o].apply(n,arguments)}},y={log:g(l.window,"log"),error:g(l.window,"error"),warn:g(l.window,"warm")},v=function(){},w=function(e){return function(){return e}},b=w(!1),_=w(!0),T=function(){return C},C=(e=function(e){return e.isNone()},r={fold:function(e,t){return e()},is:b,isSome:b,isNone:_,getOr:n=function(e){return e},getOrThunk:t=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:w(null),getOrUndefined:w(void 0),or:n,orThunk:t,map:T,each:v,bind:T,exists:b,forall:_,filter:T,equals:e,equals_:e,toArray:function(){return[]},toString:w("none()")},Object.freeze&&Object.freeze(r),r),x=function(n){var e=w(n),t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:_,isNone:b,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return x(e(n))},each:function(e){e(n)},bind:r,exists:r,forall:r,filter:function(e){return e(n)?o:C},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(b,function(e){return t(n,e)})}};return o},E={some:x,none:T,from:function(e){return null==e?C:x(e)}},j=(o="function",function(e){return function(e){if(null===e)return"null";var t=typeof e;return"object"===t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t}(e)===o}),I=(Array.prototype.slice,j(Array.from)&&Array.from,{}),k=function(e,t,n){var r=n();!function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}(I[e].callbacks,function(e){e(r)}),I[e]={module:r,callbacks:null}},S=function(e,t,n){var r,o,i,u,c,a;e in I?(c=n,null===(a=I[e]).module?a.callbacks.push(c):c(a.module)):(r=e,o=t,i=n,u=l.document.createElement("script"),tinymce.codeMirrorLazyLoader={define:k},I[r]={module:null,callbacks:[i]},u.src=o,l.document.body.appendChild(u))},P={},O={exports:P};u=P,c=O,i=void 0,function(e){"object"==typeof u&&void 0!==c?c.exports=e():"function"==typeof i&&i.amd?i([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=e()}(function(){return function i(u,c,a){function l(t,e){if(!c[t]){if(!u[t]){var n=!1;if(!e&&n)return n(t,!0);if(s)return s(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=c[t]={exports:{}};u[t][0].call(o.exports,function(e){return l(u[t][1][e]||e)},o,o.exports,i,u,c,a)}return c[t].exports}for(var s=!1,e=0;e<a.length;e++)l(a[e]);return l}({1:[function(e,t,n){var r,o,i=t.exports={};function u(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===u||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:u}catch(e){r=u}try{o="function"==typeof clearTimeout?clearTimeout:c}catch(e){o=c}}();var l,s=[],f=!1,d=-1;function m(){f&&l&&(f=!1,l.length?s=l.concat(s):d=-1,s.length&&p())}function p(){if(!f){var e=a(m);f=!0;for(var t=s.length;t;){for(l=s,s=[];++d<t;)l&&l[d].run();d=-1,t=s.length}l=null,f=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===c||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new h(e,t)),1!==s.length||f||a(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(e,f,t){(function(n){!function(e){var t=setTimeout;function r(){}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(e,this)}function o(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn(function(){var e=1===n._state?r.onFulfilled:r.onRejected;if(null!==e){var t;try{t=e(n._value)}catch(e){return void c(r.promise,e)}u(r.promise,t)}else(1===n._state?u:c)(r.promise,n._value)})):n._deferreds.push(r)}function u(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void a(t);if("function"==typeof n)return void s((r=n,o=e,function(){r.apply(o,arguments)}),t)}t._state=1,t._value=e,a(t)}catch(e){c(t,e)}var r,o}function c(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)o(e,e._deferreds[t]);e._deferreds=null}function l(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function s(e,t){var n=!1;try{e(function(e){n||(n=!0,u(t,e))},function(e){n||(n=!0,c(t,e))})}catch(e){if(n)return;n=!0,c(t,e)}}i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=new this.constructor(r);return o(this,new l(e,t,n)),n},i.all=function(e){var c=Array.prototype.slice.call(e);return new i(function(r,o){if(0===c.length)return r([]);var i=c.length;function u(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){u(t,e)},o)}c[t]=e,0==--i&&r(c)}catch(e){o(e)}}for(var e=0;e<c.length;e++)u(e,c[e])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(n){return new i(function(e,t){t(n)})},i.race=function(o){return new i(function(e,t){for(var n=0,r=o.length;n<r;n++)o[n].then(e,t)})},i._immediateFn="function"==typeof n?function(e){n(e)}:function(e){t(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},i._setImmediateFn=function(e){i._immediateFn=e},i._setUnhandledRejectionFn=function(e){i._unhandledRejectionFn=e},void 0!==f&&f.exports?f.exports=i:e.Promise||(e.Promise=i)}(this)}).call(this,e("timers").setImmediate)},{timers:3}],3:[function(a,e,l){(function(e,t){var r=a("process/browser.js").nextTick,n=Function.prototype.apply,o=Array.prototype.slice,i={},u=0;function c(e,t){this._id=e,this._clearFn=t}l.setTimeout=function(){return new c(n.call(setTimeout,window,arguments),clearTimeout)},l.setInterval=function(){return new c(n.call(setInterval,window,arguments),clearInterval)},l.clearTimeout=l.clearInterval=function(e){e.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},l.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},l.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},l._unrefActive=l.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},l.setImmediate="function"==typeof e?e:function(e){var t=u++,n=!(arguments.length<2)&&o.call(arguments,1);return i[t]=!0,r(function(){i[t]&&(n?e.apply(null,n):e.call(null),l.clearImmediate(t))}),t},l.clearImmediate="function"==typeof t?t:function(e){delete i[e]}}).call(this,a("timers").setImmediate,a("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(e,t,n){var r=e("promise-polyfill"),o="undefined"!=typeof window?window:Function("return this;")();t.exports={boltExport:o.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)});var A=O.exports.boltExport,M=function(e){return e.getParam("code_dialog_width",600)},L=function(e,t,n,r){void 0===r&&(r="");var o,i,u=(o=e,{completeAfter:i=function(e,t){return t&&!t()||setTimeout(function(){e.state.completionActive||e.showHint({completeSingle:!1})},100),o.Pass},completeIfAfterLt:function(t){return i(t,function(){var e=t.getCursor();return"<"===t.getRange(o.Pos(e.line,e.ch-1),e)})},completeIfInTag:function(t){return i(t,function(){var e=t.getTokenAt(t.getCursor());return!!("string"!==e.type||/['"]/.test(e.string.charAt(e.string.length-1))&&1!==e.string.length)&&o.innerMode(t.getMode(),e.state).state.tagName})}}),c={lineWrapping:n.lineWrapping,lineNumbers:n.lineNumbers,foldGutter:n.foldGutter,theme:n.theme,direction:n.direction,matchTags:{bothTags:!0},keyMap:"sublime",gutters:n.gutter?["CodeMirror-linenumbers","CodeMirror-foldgutter"]:[],extraKeys:{"Alt-F":"findPersistent","Ctrl-J":"toMatchingTag","Ctrl-B":"selectNextOccurrence","'<'":u.completeAfter,"'/'":u.completeIfAfterLt,"' '":u.completeIfInTag,"'='":u.completeIfInTag,"Ctrl-Q":function(e){e.foldCode(e.getCursor())}},mode:"text/html",value:r},a=e(t,c),l=function(e){27!==e.keyCode&&e.stopPropagation()};return t.addEventListener("keyup",l),t.addEventListener("keydown",l),t.addEventListener("keypress",l),setTimeout(function(){a&&(a.refresh(),a.focus())},200),{cmi:a,unbind:function(){t.removeEventListener("keyup",l),t.removeEventListener("keydown",l),t.removeEventListener("keypress",l)}}},F=function(t,n){return new A(function(e){!function(t){if(!function(e,t){for(var n=0,r=e.length;n<r;n++)if(t(e[n],n))return!0;return!1}(l.document.styleSheets,function(e){return e.href===t})){var e=l.document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,l.document.getElementsByTagName("head")[0].appendChild(e)}}(n),S("ephox.wrap.CodeMirror",t,e)})},U=function(e,t){e.focus(),e.undoManager.transact(function(){e.setContent(t)}),e.selection.setCursorLocation(),e.nodeChanged()},N=function(e){var t=e,n=function(){return t};return{get:n,set:function(e){t=e},clone:function(){return N(n())}}},R=function(e,o){e.windowManager.open({title:o.title,body:o.body,buttons:[{text:"Ok",subtype:"primary",onclick:"submit",disabled:!0},{text:"Cancel",onclick:"close"}],onPostRender:function(){var e,t,n,r=this.getRoot();t=r.find("form > *")[0],n=r.getEl("body"),(e=new tinymce.ui.Throbber(n)).show(1e3),o.onPostRender(t).then(function(){e.hide(),r.statusbar.items().disabled(!1)})},onSubmit:function(e){o.onSubmit(e.data)},onClose:function(e){o.onClose&&o.onClose()}})},D=function(r,o){var t,i=F(o.codeMirrorScriptUrl,o.codeMirrorCssUrl),u=(t=N(E.none()),{clear:function(){t.set(E.none())},set:function(e){t.set(E.some(e))},isSet:function(){return t.get().isSome()},on:function(e){t.get().each(e)}});R(r,{title:"Source code",body:{type:"panel",border:1,classes:"codemirror",minWidth:M(r),minHeight:M(r)},onPostRender:function(e){var t=e.getEl("body"),n=r.getContent({source_view:!0});return i.then(function(e){return L(e,t,o,n)}).then(function(e){u.set(e)})},onSubmit:function(){return u.on(function(e){U(r,e.cmi.doc.getValue()),e.unbind()})},onClose:function(){return u.on(function(e){return e.unbind()})}})},V=function(){return(V=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},q=function(t,n){var e,r,o,i=t.getContent({source_view:!0}),u={name:"codeview",type:"customeditor",tag:"div"};if(r=tinymce,o="5.0.12",r&&1===m(p(r),d(o))){var c=n.customEditorScriptUrl;e=V(V({},u),{scriptId:"tinymce.plugins.advcode.customeditor",scriptUrl:c,settings:n})}else e=V(V({},u),{init:function(e){return o=e,i=n,new A(function(e){o.style.width="100%",o.parentElement.classList.add("mce-codemirror"),e(F(i.codeMirrorScriptUrl,i.codeMirrorCssUrl).then(function(e){var t=L(e,o,i),n=t.cmi,r=t.unbind;return{getValue:function(){return n.doc.getValue()},setValue:function(e){return n.doc.setValue(e)},destroy:function(){return r()}}}))});var o,i}});var a={title:"Source Code",size:"large",body:{type:"panel",items:[e]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{codeview:i},onSubmit:function(e){U(t,e.getData().codeview),e.close()}};t.windowManager.open(a)},B=function(m,p,h){return function(){var e,t,n,r,o,i,u,c,a,l,s,f,d={customEditorScriptUrl:(t=h)+"/customeditor.min.js",codeMirrorScriptUrl:(s=e=p,f=t,s.getParam("codemirror_script",f+"/codemirror.min.js","string")),codeMirrorCssUrl:(a=e,l=t,a.getParam("codemirror_css",l+"/codemirror.min.css","string")),lineWrapping:(c=e,c.getParam("codemirror_linewrapping",!0,"boolean")),lineNumbers:(u=e,u.getParam("codemirror_linenumbers",!0,"boolean")),foldGutter:(i=e,i.getParam("codemirror_foldgutter",!0,"boolean")),theme:(o=e,o.getParam("codemirror_theme","default","string")),direction:(r=e,"rtl"===r.getBody().dir?"rtl":"ltr"),gutter:(n=e,n.getParam("codemirror_gutter",!0,"boolean"))};m(p,d)}};tinymce.PluginManager.add("advcode",function(e,t){return h(tinymce,"4.3.13")?(y.error("The advcode plugin requires at least 4.3.13 version of TinyMCE."),function(){}):(h(tinymce,"5.0.0")?(u=B(D,i=e,t),i.addCommand("mceCodeEditor",u),i.addButton("code",{icon:"code",tooltip:"Source code",onclick:u}),i.addMenuItem("code",{icon:"code",text:"Source code",context:"tools",onclick:u})):(r="sourcecode",o=B(q,n=e,t),n.addCommand("mceCodeEditor",o),n.ui.registry.addButton("code",{icon:r,tooltip:"Source code",onAction:o}),n.ui.registry.addMenuItem("code",{icon:r,text:"Source code",onAction:o})),{});var n,r,o,i,u})}(window);