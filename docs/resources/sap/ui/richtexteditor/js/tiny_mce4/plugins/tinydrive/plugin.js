/* TinyDrive
 *
 * Copyright 2010-2018 Tiny Technologies LLC. All rights reserved.
 *
 * Version: 1.3.0-76
 */

!function(l){"use strict";var m=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return m(t())}}},h=function(){},v=function(t,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(r.apply(null,n))}},g=function(n){return function(){return n}},s=function(n){return n};var n,e,t,r,o,c,u,i=g(!1),a=g(!0),f=i,d=a,p=function(){return y},y=(r={fold:function(n,e){return n()},is:f,isSome:f,isNone:d,getOr:t=function(n){return n},getOrThunk:e=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:t,orThunk:e,map:p,ap:p,each:function(){},bind:p,flatten:p,exists:f,forall:d,filter:p,equals:n=function(n){return n.isNone()},equals_:n,toArray:function(){return[]},toString:g("none()")},Object.freeze&&Object.freeze(r),r),b=function(t){var n=function(){return t},e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:d,isNone:f,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return b(n(t))},ap:function(n){return n.fold(p,function(n){return b(n(t))})},each:function(n){n(t)},bind:r,flatten:n,exists:r,forall:r,filter:function(n){return n(t)?o:y},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(f,function(n){return e(t,n)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},w={some:b,none:p,from:function(n){return null==n?y:b(n)}},T=tinymce.PluginManager,O=function(){return(O=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}).apply(this,arguments)},_=function(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&Array.prototype.isPrototypeOf(n)?"array":"object"===e&&String.prototype.isPrototypeOf(n)?"string":e}(n)===e}},F=_("string"),E=_("object"),S=_("array"),x=_("boolean"),D=_("function"),I=_("number"),R=Array.prototype.slice,N=void 0===(o=Array.prototype.indexOf)?function(n,e){return B(n,e)}:function(n,e){return o.call(n,e)},A=function(n,e){return-1<N(n,e)},j=function(n,e){return M(n,e).isSome()},U=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var u=n[o];r[o]=e(u,o,n)}return r},C=function(n,e){for(var t=0,r=n.length;t<r;t++){e(n[t],t,n)}},k=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var u=n[r];e(u,r,n)&&t.push(u)}return t},P=function(n,e,t){return C(n,function(n){t=e(t,n)}),t},L=function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t,n))return w.some(o)}return w.none()},M=function(n,e){for(var t=0,r=n.length;t<r;t++){if(e(n[t],t,n))return w.some(t)}return w.none()},B=function(n,e){for(var t=0,r=n.length;t<r;++t)if(n[t]===e)return t;return-1},G=Array.prototype.push,H=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!Array.prototype.isPrototypeOf(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);G.apply(e,n[t])}return e},z=function(n,e){var t=U(n,e);return H(t)},q=function(n){return 0===n.length?w.none():w.some(n[0])},J=(D(Array.from)&&Array.from,function(n){var t=w.none(),e=[],r=function(n){o()?i(n):e.push(n)},o=function(){return t.isSome()},u=function(n){C(n,i)},i=function(e){t.each(function(n){l.setTimeout(function(){e(n)},0)})};return n(function(n){t=w.some(n),u(e),e=[]}),{get:r,map:function(t){return J(function(e){r(function(n){e(t(n))})})},isReady:o}}),V={nu:J,pure:function(e){return J(function(n){n(e)})}},W=function(e){var n=function(n){var r;e((r=n,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this;l.setTimeout(function(){r.apply(t,n)},0)}))},t=function(){return V.nu(n)};return{map:function(r){return W(function(t){n(function(n){var e=r(n);t(e)})})},bind:function(t){return W(function(e){n(function(n){t(n).get(e)})})},anonBind:function(t){return W(function(e){n(function(n){t.get(e)})})},toLazy:t,toCached:function(){var e=null;return W(function(n){null===e&&(e=t()),e.get(n)})},get:n}},Y={nu:W,pure:function(e){return W(function(n){n(e)})}},K=function(t){return{is:function(n){return t===n},isValue:a,isError:i,getOr:g(t),getOrThunk:g(t),getOrDie:g(t),or:function(n){return K(t)},orThunk:function(n){return K(t)},fold:function(n,e){return e(t)},map:function(n){return K(n(t))},mapError:function(n){return K(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return w.some(t)}}},X=function(t){return{is:i,isValue:i,isError:a,getOr:s,getOrThunk:function(n){return n()},getOrDie:function(){return n=String(t),function(){throw new Error(n)}();var n},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,e){return n(t)},map:function(n){return X(t)},mapError:function(n){return X(n(t))},each:h,bind:function(n){return X(t)},exists:i,forall:a,toOption:w.none}},$={value:K,error:X,fromOption:function(n,e){return n.fold(function(){return X(e)},K)}},Z=function(u){return O({},u,{toCached:function(){return Z(u.toCached())},bindFuture:function(e){return Z(u.bind(function(n){return n.fold(function(n){return Y.pure($.error(n))},function(n){return e(n)})}))},bindResult:function(e){return Z(u.map(function(n){return n.bind(e)}))},mapResult:function(e){return Z(u.map(function(n){return n.map(e)}))},mapError:function(e){return Z(u.map(function(n){return n.mapError(e)}))},foldResult:function(e,t){return u.map(function(n){return n.fold(e,t)})},withTimeout:function(n,o){return Z(Y.nu(function(e){var t=!1,r=l.setTimeout(function(){t=!0,e($.error(o()))},n);u.get(function(n){t||(l.clearTimeout(r),e(n))})}))}})},Q=function(n){return Z(Y.nu(n))},nn=function(n){return Z(Y.pure($.value(n)))},en={nu:Q,wrap:Z,pure:nn,value:nn,error:function(n){return Z(Y.pure($.error(n)))},fromResult:function(n){return Z(Y.pure(n))},fromFuture:function(n){return Z(n.map($.value))},fromPromise:function(n){return Q(function(e){n.then(function(n){e($.value(n))},function(n){e($.error(n))})})}},tn=void 0!==l.window?l.window:Function("return this;")(),rn=function(n,e){return function(n,e){for(var t=null!=e?e:tn,r=0;r<n.length&&null!=t;++r)t=t[n[r]];return t}(n.split("."),e)},on=function(n){return n<10?"0"+n.toString():n.toString()},un=function(n){return e=new Date,t=n,o=e.getFullYear(),u=on(e.getMonth()+1),i=on(e.getDate()),r=""+o+u+i,t.replace(/\/$/,"")+"/"+r.replace(/^\//,"");var e,t,r,o,u,i},an=Object.keys,fn=Object.hasOwnProperty,cn=function(n,e){for(var t=an(n),r=0,o=t.length;r<o;r++){var u=t[r];e(n[u],u,n)}},sn=function(n,r){return ln(n,function(n,e,t){return{k:e,v:r(n,e,t)}})},ln=function(r,o){var u={};return cn(r,function(n,e){var t=o(n,e,r);u[t.k]=t.v}),u},dn=function(n,t){var r=[];return cn(n,function(n,e){r.push(t(n,e))}),r},pn=function(n){return dn(n,function(n){return n})},mn=function(n,e){return hn(n,e)?w.from(n[e]):w.none()},hn=function(n,e){return fn.call(n,e)},vn=function(n,e){return-1!==n.indexOf(e)},gn=function(n,e){return t=n,o=0,""===(r=e)||!(t.length<r.length)&&t.substr(o,o+r.length)===r;var t,r,o},yn=function(n){try{var e=JSON.parse(n);return $.value(e)}catch(n){return $.error("Response was not JSON.")}};(u=c||(c={})).JSON="json",u.Blob="blob",u.Text="text",u.FormData="formdata",u.MultipartFormData="multipart/form-data";var bn,wn,Tn=function(e){return Y.nu(function(t){var n=new l.FileReader;n.onload=function(n){var e=n.target?n.target.result:new l.Blob([]);t(e)},n.readAsText(e)})},On=function(n){return Y.pure(n.response)},_n=function(n,e){switch(n){case c.JSON:return yn(e.response).fold(function(){return On(e)},Y.pure);case c.Blob:return t=e,w.from(t.response).map(Tn).getOr(Y.pure("no response content"));case c.Text:default:return On(e)}var t},Fn=function(n){return{type:c.JSON,data:n}},En=function(n){var e,t=(e=n.body,w.from(e).bind(function(n){switch(n.type){case c.JSON:return w.some("application/json");case c.FormData:return w.some("application/x-www-form-urlencoded; charset=UTF-8");case c.MultipartFormData:return w.none();case c.Text:default:return w.some("text/plain")}})),r=!0===n.credentials?w.some(!0):w.none(),o=function(n){switch(n){case c.Blob:return"application/octet-stream";case c.JSON:return"application/json, text/javascript";case c.Text:return"text/plain";default:return""}}(n.responseType)+", */*; q=0.01",u=void 0!==n.headers?n.headers:{};return{contentType:t,responseType:function(n){switch(n){case c.JSON:return w.none();case c.Blob:return w.some("blob");case c.Text:return w.some("text");default:return w.none()}}(n.responseType),credentials:r,accept:o,headers:u,progress:D(n.progress)?w.some(n.progress):w.none()}},Sn=function(n){var t=new l.FormData;return cn(n,function(n,e){t.append(e,n)}),t},xn=function(f){return en.nu(function(r){var o,u=new l.XMLHttpRequest;u.open(f.method,(o=f.url,w.from(f.query).map(function(n){var e=dn(n,function(n,e){return encodeURIComponent(e)+"="+encodeURIComponent(n)}),t=vn(o,"?")?"&":"?";return 0<e.length?o+t+e.join("&"):o}).getOr(o)),!0);var t,n,e=En(f);t=u,(n=e).contentType.each(function(n){return t.setRequestHeader("Content-Type",n)}),t.setRequestHeader("Accept",n.accept),n.credentials.each(function(n){return t.withCredentials=n}),n.responseType.each(function(n){return t.responseType=n}),n.progress.each(function(e){return t.upload.addEventListener("progress",function(n){return e(n.loaded,n.total)})}),cn(n.headers,function(n,e){return t.setRequestHeader(e,n)});var i,a=function(){var e,n,t;(e=f.url,n=f.responseType,t=u,_n(n,t).map(function(n){return{message:0===t.status?"Unknown HTTP error (possible cross-domain request)":"Could not load url "+e+": "+t.statusText,status:t.status,responseText:n}})).get(function(n){return r($.error(n))})};u.onerror=a,u.onload=function(){0!==u.status||gn(f.url,"file:")?u.status<100||400<=u.status?a():function(n,e){var t=function(){return en.pure(e.response)},r=function(n){return en.error({message:n,status:e.status,responseText:e.responseText})};switch(n){case c.JSON:return yn(e.response).fold(r,en.pure);case c.Blob:case c.Text:return t();default:return r("unknown data type")}}(f.responseType,u).get(r):a()},(i=f.body,w.from(i).map(function(n){return n.type===c.JSON?JSON.stringify(n.data):n.type===c.FormData?Sn(n.data):n.type===c.MultipartFormData?Sn(n.data):n})).fold(function(){return u.send()},function(n){u.send(n)})})},Dn=function(){return n="",{type:c.Text,data:n};var n},In=function(n){return xn(O({},n,{method:"post"}))},Rn=function(n,e,t){return $.error({message:e,status:n,responseText:t})},Nn=function(r,o){return In({url:r,responseType:c.JSON,body:Fn({})}).bindResult(function(n){return F(n.token)?(t=n.token,o.set(w.some(t)),$.value(t)):(e=r,o.set(w.none()),Rn(500,'Jwt token provider: "'+e+'" did not return a "token" string property in it\'s JSON response body.',""));var e,t})},An=function(n,t){return en.nu(function(e){n(function(n){t.set(w.some(n.token)),e($.value(n.token))},function(n){t.set(w.none()),e(Rn(0,n,""))})})},jn=function(n,e){return F(n)?(u=n,i=e,function(n){return n?Nn(u,i):i.get().fold(function(){return Nn(u,i)},function(n){return en.pure(n)})}):D(n)?(r=n,o=e,function(n){return n?An(r,o):o.get().fold(function(){return An(r,o)},function(n){return en.pure(n)})}):(t="Required jwt token provider not defined.",function(n){return en.fromResult(Rn(0,t,""))});var t,r,o,u,i},Un=function(n){return w.from(n.getParam("tinydrive_max_image_dimension",null,"number"))},Cn=function(i){if(!S(i))throw new Error("cases must be an array");if(0===i.length)throw new Error("there must be at least one case");var a=[],t={};return C(i,function(n,r){var e=an(n);if(1!==e.length)throw new Error("one and only one name per case");var o=e[0],u=n[o];if(void 0!==t[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!S(u))throw new Error("case arguments must be an array");a.push(o),t[o]=function(){var n=arguments.length;if(n!==u.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+u.length+" ("+u+"), got "+n);for(var t=new Array(n),e=0;e<t.length;e++)t[e]=arguments[e];return{fold:function(){if(arguments.length!==i.length)throw new Error("Wrong number of arguments to fold. Expected "+i.length+", got "+arguments.length);return arguments[r].apply(null,t)},match:function(n){var e=an(n);if(a.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+a.join(",")+"\nActual: "+e.join(","));if(!function(n,e){for(var t=0,r=n.length;t<r;++t)if(!0!==e(n[t],t,n))return!1;return!0}(a,function(n){return A(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+a.join(", "));return n[o].apply(null,t)},log:function(n){l.console.log(n,{constructors:a,constructor:o,params:t})}}}}),t},kn=Object.prototype.hasOwnProperty,Pn=function(i){return function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},r=0;r<n.length;r++){var o=n[r];for(var u in o)kn.call(o,u)&&(t[u]=i(t[u],o[u]))}return t}},Ln=Pn(function(n,e){return E(n)&&E(e)?Ln(n,e):e}),Mn=Pn(function(n,e){return e}),Bn=function(t){var r,o=!1;return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return o||(o=!0,r=t.apply(null,n)),r}},Gn=Cn([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),Hn=Gn.strict,zn=Gn.asOption,qn=function(n,e){return hn(t=n,r=e)?w.from(t[r]):w.none();var t,r},Jn=function(n,e){var t={};return t[n]=e,t};Cn([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);(wn=bn||(bn={}))[wn.Error=0]="Error",wn[wn.Value=1]="Value";var Vn,Wn,Yn=function(n,e,t){return n.stype===bn.Error?e(n.serror):t(n.svalue)},Kn=function(n){return{stype:bn.Value,svalue:n}},Xn=function(n){return{stype:bn.Error,serror:n}},$n=function(n){return Yn(n,$.error,$.value)},Zn=Kn,Qn=function(n){var e=[],t=[];return C(n,function(n){Yn(n,function(n){return t.push(n)},function(n){return e.push(n)})}),{values:e,errors:t}},ne=Xn,ee=function(n,e){return n.stype===bn.Value?e(n.svalue):n},te=function(n,e){return n.stype===bn.Error?e(n.serror):n},re=function(n,e){return n.stype===bn.Value?{stype:bn.Value,svalue:e(n.svalue)}:n},oe=function(n,e){return n.stype===bn.Error?{stype:bn.Error,serror:e(n.serror)}:n},ue=function(n){return v(ne,H)(n)},ie=function(n,e){var t,r,o=Qn(n);return 0<o.errors.length?ue(o.errors):(t=o.values,r=e,0<t.length?Zn(Ln(r,Mn.apply(void 0,t))):Zn(r))},ae=function(n){var e=Qn(n);return 0<e.errors.length?ue(e.errors):Zn(e.values)},fe=Cn([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),ce=Cn([{field:["name","presence","type"]},{state:["name"]}]),se={getOrDie:function(n,e){var t=rn(n,e);if(null==t)throw n+" not available on this browser";return t}},le=function(){return se.getOrDie("JSON")},de=function(n,e,t){return le().stringify(n,e,t)},pe=function(n){return E(n)&&100<an(n).length?" removed due to size":de(n,null,2)},me=function(n,e){return ne([{path:n,getErrorInfo:e}])},he=Cn([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),ve=function(t,r,o){return qn(r,o).fold(function(){return n=o,e=r,me(t,function(){return'Could not find valid *strict* value for "'+n+'" in '+pe(e)});var n,e},Zn)},ge=function(n,e,t){var r=qn(n,e).fold(function(){return t(n)},s);return Zn(r)},ye=function(a,f,n,c){return n.fold(function(o,t,n,r){var u=function(n){var e=r.extract(a.concat([o]),c,n);return re(e,function(n){return Jn(t,c(n))})},i=function(n){return n.fold(function(){var n=Jn(t,c(w.none()));return Zn(n)},function(n){var e=r.extract(a.concat([o]),c,n);return re(e,function(n){return Jn(t,c(w.some(n)))})})};return n.fold(function(){return ee(ve(a,f,o),u)},function(n){return ee(ge(f,o,n),u)},function(){return ee(Zn(qn(f,o)),i)},function(n){return ee((t=n,r=qn(e=f,o).map(function(n){return!0===n?t(e):n}),Zn(r)),i);var e,t,r},function(n){var e=n(f),t=re(ge(f,o,g({})),function(n){return Ln(e,n)});return ee(t,u)})},function(n,e){var t=e(f);return Zn(Jn(n,c(t)))})},be=function(r){return{extract:function(t,n,e){return te(r(e,n),function(n){return e=n,me(t,function(){return e});var e})},toString:function(){return"val"},toDsl:function(){return fe.itemOf(r)}}},we=function(a){return{extract:function(n,e,t){return r=n,o=t,u=e,i=U(a,function(n){return ye(r,o,n,u)}),ie(i,{});var r,o,u,i},toString:function(){return"obj{\n"+U(a,function(n){return n.fold(function(n,e,t,r){return n+" -> "+r.toString()},function(n,e){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return fe.objOf(U(a,function(n){return n.fold(function(n,e,t,r){return ce.field(n,t,r)},function(n,e){return ce.state(n)})}))}}},Te=function(o){return{extract:function(t,r,n){var e=U(n,function(n,e){return o.extract(t.concat(["["+e+"]"]),r,n)});return ae(e)},toString:function(){return"array("+o.toString()+")"},toDsl:function(){return fe.arrOf(o)}}},Oe=g(be(Zn)),_e=he.field,Fe=function(n,e,t){return $n((r=n,o=s,u=t,i=e.extract([r],o,u),oe(i,function(n){return{input:u,errors:n}})));var r,o,u,i},Ee=function(n){return"Errors: \n"+(e=n.errors,t=10<e.length?e.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):e,U(t,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: "+pe(n.input);var e,t},Se=function(t,r){return be(function(n){var e=typeof n;return t(n)?Zn(n):ne("Expected type: "+r+" but got: "+e)})},xe=Se(I,"number"),De=Se(F,"string"),Ie=Se(x,"boolean"),Re=Se(D,"function"),Ne=function(n,e){return _e(n,n,Hn(),e)},Ae=function(n){return Ne(n,xe)},je=function(n){return Ne(n,De)},Ue=function(n){return Ne(n,Ie)},Ce=function(n,e){return _e(n,n,Hn(),Te(e))},ke=function(n){return t=De,_e(e=n,e,zn(),t);var e,t},Pe=function(n,e,t){return _e(n,n,(r=e,Gn.defaultedThunk(g(r))),t);var r},Le=function(n,e,t){return Fe(n,e,t.data)},Me=function(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e},Be=function(n){return n.replace(/\\/g,"/")},Ge=function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var o=Be(n).replace(/\/$/,"")+"/"+Be(e).replace(/^\//,"");return P(t,Ge,o)},He=H(pn({"image/gif":["gif"],"image/jpeg":["jpeg","jpg"],"image/png":["png"],"image/tiff":["tif","tiff"],"image/bmp":["bmp"]})),ze=H(pn({"application/msword":["doc"],"application/vnd.ms-excel":["xls"],"application/vnd.ms-powerpoint":["ppt","pps"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/pdf":["pdf"],"application/rtf":["rtf"],"text/plain":["txt"],"application/x-iwork-keynote-sffkey":["key"],"application/x-iwork-pages-sffpages":["pages"],"application/x-iwork-numbers-sffnumbers":["numbers"]})),qe=H(pn({"audio/wav":["wav","wave"],"audio/mpeg":["mp3"],"audio/ogg":["ogg","oga","ogx","ogm","spx","opus"]})),Je=H(pn({"video/mp4":["mp4","m4v"],"video/ogg":["ogv"],"video/webm":["webm"],"video/quicktime":["mov"]})),Ve=H(pn({"application/zip":["zip"]})),We=function(n){var e,t,r=(e=n,t=e.lastIndexOf("."),-1!==t?e.substr(t):"").substring(1).toLowerCase(),o=function(e,n){return L(n,function(n){return n===e}).isSome()};return o(r,He)?w.some("image"):o(r,ze)?w.some("document"):o(r,qe)?w.some("audio"):o(r,Je)?w.some("video"):o(r,Ve)?w.some("archive"):w.none()},Ye=function(n){switch(n){case"directory":return"directory";case"document":return"document";case"audio":return"audio";case"video":return"video";case"image":return"image";case"archive":return"archive"}},Ke=function(n){switch(n){case"directory":return w.some("directory");case"document":return w.some("document");case"audio":return w.some("audio");case"video":return w.some("video");case"image":return w.some("image");case"archive":return w.some("archive");default:return w.none()}},Xe=we([je("id"),je("name"),Ae("size"),je("type"),je("mdate"),ke("url"),Ce("thumbs",De),Ue("starred"),ke("path")]),$e=function(n){return function(n,e){for(var t=[],r=0;r<n.length;r++){var o=n[r];if(!o.isSome())return w.none();t.push(o.getOrDie())}return w.some(e.apply(null,t))}([q(n.thumbs),n.url],function(n,e){return e+"-"+n})},Ze=function(n){return{uuid:n.id,parentUuid:w.none(),name:n.name,size:n.size,type:(t=n.type,Ke(t).getOr("document")),modificationDate:(e=n.mdate,w.from(/^([0-9]{4})\-([0-9]{2})\-([0-9]{2})T([0-9]{2})\:([0-9]{2})\:([0-9]{2})Z$/.exec(e)).map(function(n){var e=U(n.slice(1),function(n){return parseInt(n,10)});return new Date(Date.UTC(e[0],e[1]-1,e[2],e[3],e[4],e[5]))})).getOr(new Date),url:n.url,thumbUrl:$e(n),starred:n.starred,path:n.path};var e,t},Qe=function(n,e,t,r){return{last:e,offset:t,files:U(n,Ze)}},nt=we([Ue("last"),Ae("offset"),Ce("files",Xe)]),et=function(n){return Le("fileListResult",nt,n)},tt=function(n,e){return Qe(e.files,e.last,e.offset)},rt=function(n,e){var t,r,o,u,i=e,a=sn(n,function(n,e){return i[e](n)}),f=(t=a,r=function(n){return n.isSome()},o={},u={},cn(t,function(n,e){(r(n,e)?o:u)[e]=n}),{t:o,f:u}).t,c=sn(f,function(n){return n.fold(function(){return null},s)});return Fn(c)},ot=function(n){return rt(n,{offset:w.some,parent:s,sortBy:s,sortOrder:s,query:s,fileTypes:w.some})},ut=we([Ne("file",Xe)]),it=Fn,at=we([Ne("file",Xe)]),ft=we([Ce("ids",De)]);(Wn=Vn||(Vn={})).Thumbnail="thumbnail",Wn.File="file";var ct,st,lt=Fn;(st=ct||(ct={})).Thumbnail="thumbnail",st.File="file";var dt,pt,mt,ht,vt,gt=function(n){return rt(n,{fileType:w.some,parent:s,path:s,name:w.some,size:w.some})},yt=we([Ne("file",Xe)]),bt=we([je("uploadUrl"),je("blobUrl"),Ce("formItems",we([je("name"),je("value")])),je("id")]),wt=function(n){var e,t=P(n,function(n,e){return n[e.name]=e.value,n},{});return e=t,{type:c.MultipartFormData,data:e}},Tt=function(n){return Le("create",bt,n)},Ot=we([Ce("ids",De)]),_t=Fn,Ft=we([Ce("ids",De)]),Et=Fn,St=we([Ce("ids",De)]),xt=we([(dt="error",pt=[ke("type"),ke("data"),je("message")],_e(dt,dt,Hn(),we(pt)))]),Dt=we([je("message")]),It=function(n){return Le("error",xt,n).fold(function(){return Le("error",Dt,n).map(function(n){return{error:{type:w.none(),data:w.none(),message:n.message}}})},function(n){return $.value(n)})},Rt=we([je("id")]),Nt=we([je("id"),je("description"),ke("createdBy")]),At=we([Ce("id",De)]),jt=we([Ue("last"),Ae("offset"),Ce("files",Xe)]),Ut=function(e,o){return(n=o,n(!1)).bindFuture(function(n){return e(n).bind(function(n){return n.fold((t=o,r=e,function(n){return 401===n.status?(e=t,e(!0)).bindFuture(r):en.error(n);var e}),en.pure);var t,r})});var n},Ct=function(o,n){return Ut(function(n){return In(O({},o,{headers:(e=o.headers,t=n,r={Authorization:"Bearer "+t},e?O({},e,r):r)}));var e,t,r},n)},kt=function(e){return It(Fn(e.responseText)).fold(function(n){return{type:"",message:"Error: "+e.message+" ("+e.status+")"}},function(n){return{type:"",message:n.error.message}})},Pt=function(n,e,t){var r,o,u=Ct({url:(r=n,o=e,Ge(r.restApiEndpoint,"/1",o)+"?apiKey="+encodeURIComponent(r.apiKey)),body:t,responseType:c.JSON},n.jwtTokenFactory);return en.wrap(u.foldResult(function(n){return $.error(kt(n))},function(n){return $.value(Fn(n))}))},Lt=function(n){return U(n,Ye)},Mt=function(n,e,t){return Pt(n,"client/files/stars",(r={offset:e.offset,sortBy:w.some(e.sortBy),sortOrder:w.some(e.sortOrder),query:e.query,fileTypes:Lt(e.fileTypes)},rt(r,{offset:w.some,sortBy:s,sortOrder:s,query:s,fileTypes:w.some}))).bindResult(function(n){return(e=n,Le("starsResult",jt,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value((w.none(),Qe((e=n).files,e.last,e.offset)));var e});var e});var r},Bt=function(n,e,t){return Pt(n,"client/files/mkdir",(r={parent:e,name:t},rt(r,{parent:s,name:w.some}))).bindResult(function(n){return(e=n,Le("mkdir",ut,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(n.file.id)});var e});var r},Gt=function(n,t,e){return Pt(n,"client/files/rename",it({id:t,name:e})).bindResult(function(n){return(e=n,Le("rename",at,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(t)});var e})},Ht=function(n,t){return Pt(n,"client/files/delete",(e={ids:t},rt(e,{ids:w.some}))).bindResult(function(n){return(e=n,Le("remove",ft,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(t)});var e});var e},zt=function(n,e,t){return Pt(n,"client/files/commit",lt({id:e,type:t})).bindResult(function(n){return(e=n,Le("commit",yt,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(n)});var e})},qt=function(n,e,t,r,o){return Pt(n,"client/files/create",gt({fileType:e,parent:t,path:w.none(),name:r,size:o})).bindResult(function(n){return Tt(n).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(n)})})},Jt=function(n,t,r,e,o){var u=wt(t.formItems);u.data.file=e;var i=In({url:t.uploadUrl,body:u,responseType:c.Text,progress:function(n,e){return o({loaded:n,total:e,name:r,uuid:t.id})}});return en.wrap(i.foldResult(function(n){return $.error(kt(n))},function(n){return $.value(t.id)}))},Vt=function(e,t,r,o,n){return(u=e,i=ct.File,a=n,f=r,c=t.size,Pt(u,"client/files/create",gt({fileType:i,parent:w.none(),path:w.some(a),name:f,size:c})).bindResult(function(n){return Tt(n).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(n)})})).bindFuture(function(n){return Jt(0,n,r,t,o).bindFuture(function(n){return zt(e,n,Vn.File)}).mapResult(function(n){return Ze(n.file)})});var u,i,a,f,c},Wt=function(i,n,a){return function(u){return n.fold(function(){return en.value(u)},function(n){return(e=i,t=n,r=a,o=u.uuid,qt(e,ct.Thumbnail,w.from(o),r,t.size).bindFuture(function(n){return Jt(0,n,r,t,h)}).bindFuture(function(n){return zt(e,n,Vn.Thumbnail)}).mapResult(function(n){return n.file.id})).bindResult(function(n){return $.value(u)});var e,t,r,o})}},Yt=function(n,t,e){return Pt(n,"client/files/move",(r={ids:t,parent:e},rt(r,{parent:s,ids:w.some}))).bindResult(function(n){return(e=n,Le("move",Ot,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(t)});var e});var r},Kt=function(n,t,e){return Pt(n,"client/files/copy",(r={id:t,parent:e},rt(r,{parent:s,id:w.some}))).bindResult(function(n){return(e=n,Le("copy",At,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(t)});var e});var r},Xt=function(n,t){return Pt(n,"client/files/star",_t({ids:t})).bindResult(function(n){return(e=n,Le("star",Ft,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(t)});var e})},$t=function(n,t){return Pt(n,"client/files/unstar",Et({ids:t})).bindResult(function(n){return(e=n,Le("unstar",St,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(t)});var e})},Zt=function(n,t,e){return Pt(n,"client/files/setMeta",(r={id:t,description:e.description},rt(r,{id:w.some,description:w.some}))).bindResult(function(n){return(e=n,Le("setFileMeta",Rt,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(t)});var e});var r},Qt=function(n,e){return Pt(n,"client/files/getMeta",(t={id:e},rt(t,{id:w.some}))).bindResult(function(n){return(e=n,Le("getFileMeta",Nt,e)).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value({description:n.description,createdBy:n.createdBy})});var e});var t},nr=function(i){return{rename:function(n,e){return Gt(i,n,e)},mkdir:function(n,e){return Bt(i,w.from(e),n)},upload:function(n){return(e=i,t=n.blob,r=n.name,o=n.progress,u=n.parent,qt(e,ct.File,u,r,t.size).bindFuture(function(n){return Jt(0,n,r,t,o).bindFuture(function(n){return zt(e,n,Vn.File)}).mapResult(function(n){return Ze(n.file)})})).bindFuture(Wt(i,n.thumbBlob,n.name));var e,t,r,o,u},list:function(n){return Pt(i,"client/files/list",ot({offset:(e=n).offset,parent:e.parentUuid,sortBy:w.some(e.sortBy),sortOrder:w.some(e.sortOrder),query:e.query,fileTypes:Lt(e.fileTypes)})).bindResult(function(n){return et(n).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(tt(w.none(),n))})});var e},listStarred:function(n){return Mt(i,n)},search:function(n){return Pt(i,"client/files/search",ot({offset:(e=n).offset,parent:w.none(),sortBy:w.some(e.sortBy),sortOrder:w.some(e.sortOrder),query:e.query,fileTypes:Lt(e.fileTypes)})).bindResult(function(n){return et(n).fold(function(n){return $.error({type:"",message:"Could not decode http json response"})},function(n){return $.value(tt(w.none(),n))})});var e},remove:function(n){return Ht(i,n)},copy:function(n,e){return Kt(i,n,w.from(e))},move:function(n,e){return Yt(i,n,w.from(e))},star:function(n){return Xt(i,n)},unstar:function(n){return $t(i,n)},setMeta:function(n,e){return Zt(i,n,e)},getMeta:function(n){return Qt(i,n)},uploadToPath:function(n){return Vt(i,n.blob,n.name,n.progress,n.path).bindFuture(Wt(i,n.thumbBlob,n.name))}}},er=function(n,o,u){return n.sort(function(n,e){if("name"===o)return"desc"===u?e.name.localeCompare(n.name):n.name.localeCompare(e.name);if("size"===o)return"desc"===u?e.size-n.size:n.size-e.size;var t=n.modificationDate.getTime(),r=e.modificationDate.getTime();return"desc"===u?r-t:t-r})},tr=function(n,e,t){var r=function(n,e){for(var t=[],r=[],o=0,u=n.length;o<u;o++){var i=n[o];(e(i,o,n)?t:r).push(i)}return{pass:t,fail:r}}(n,function(n){return"directory"===n.type});return er(r.pass,e,t).concat(er(r.fail,e,t))},rr=function(n){return{type:"",message:n}},or=function(n){return{type:"",message:n.message}},ur=function(n){return(e=n,w.from(/^([0-9]{4})\-([0-9]{2})\-([0-9]{2}) ([0-9]{2})\:([0-9]{2})\:([0-9]{2})$/.exec(e))).map(function(n){var e=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+"Z");return new Date(e)});var e},ir=function(i,n){return n(function(r){var o=[],u=0;0===i.length?r([]):C(i,function(n,e){var t;n.get((t=e,function(n){o[t]=n,++u>=i.length&&r(o)}))})})},ar={},fr={exports:ar};ht=ar,vt=fr,mt=void 0,function(n){"object"==typeof ht&&void 0!==vt?vt.exports=n():"function"==typeof mt&&mt.amd?mt([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=n()}(function(){return function u(i,a,f){function c(e,n){if(!a[e]){if(!i[e]){var t=!1;if(!n&&t)return t(e,!0);if(s)return s(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=a[e]={exports:{}};i[e][0].call(o.exports,function(n){return c(i[e][1][n]||n)},o,o.exports,u,i,a,f)}return a[e].exports}for(var s=!1,n=0;n<f.length;n++)c(f[n]);return c}({1:[function(n,e,t){var r,o,u=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function f(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(n){try{return r.call(null,e,0)}catch(n){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(n){r=i}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(n){o=a}}();var c,s=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?s=c.concat(s):d=-1,s.length&&m())}function m(){if(!l){var n=f(p);l=!0;for(var e=s.length;e;){for(c=s,s=[];++d<e;)c&&c[d].run();d=-1,e=s.length}c=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(n){try{return o.call(null,e)}catch(n){return o.call(this,e)}}}(n)}}function h(n,e){this.fun=n,this.array=e}function v(){}u.nextTick=function(n){var e=new Array(arguments.length-1);if(1<arguments.length)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];s.push(new h(n,e)),1!==s.length||l||f(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=v,u.addListener=v,u.once=v,u.off=v,u.removeListener=v,u.removeAllListeners=v,u.emit=v,u.prependListener=v,u.prependOnceListener=v,u.listeners=function(n){return[]},u.binding=function(n){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(n){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],2:[function(n,l,e){(function(t){!function(n){var e=setTimeout;function r(){}function u(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(n,this)}function o(t,r){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,u._immediateFn(function(){var n=1===t._state?r.onFulfilled:r.onRejected;if(null!==n){var e;try{e=n(t._value)}catch(n){return void a(r.promise,n)}i(r.promise,e)}else(1===t._state?i:a)(r.promise,t._value)})):t._deferreds.push(r)}function i(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof u)return e._state=3,e._value=n,void f(e);if("function"==typeof t)return void s((r=t,o=n,function(){r.apply(o,arguments)}),e)}e._state=1,e._value=n,f(e)}catch(n){a(e,n)}var r,o}function a(n,e){n._state=2,n._value=e,f(n)}function f(n){2===n._state&&0===n._deferreds.length&&u._immediateFn(function(){n._handled||u._unhandledRejectionFn(n._value)});for(var e=0,t=n._deferreds.length;e<t;e++)o(n,n._deferreds[e]);n._deferreds=null}function c(n,e,t){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.promise=t}function s(n,e){var t=!1;try{n(function(n){t||(t=!0,i(e,n))},function(n){t||(t=!0,a(e,n))})}catch(n){if(t)return;t=!0,a(e,n)}}u.prototype.catch=function(n){return this.then(null,n)},u.prototype.then=function(n,e){var t=new this.constructor(r);return o(this,new c(n,e,t)),t},u.all=function(n){var a=Array.prototype.slice.call(n);return new u(function(r,o){if(0===a.length)return r([]);var u=a.length;function i(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void t.call(n,function(n){i(e,n)},o)}a[e]=n,0==--u&&r(a)}catch(n){o(n)}}for(var n=0;n<a.length;n++)i(n,a[n])})},u.resolve=function(e){return e&&"object"==typeof e&&e.constructor===u?e:new u(function(n){n(e)})},u.reject=function(t){return new u(function(n,e){e(t)})},u.race=function(o){return new u(function(n,e){for(var t=0,r=o.length;t<r;t++)o[t].then(n,e)})},u._immediateFn="function"==typeof t?function(n){t(n)}:function(n){e(n,0)},u._unhandledRejectionFn=function(n){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",n)},u._setImmediateFn=function(n){u._immediateFn=n},u._setUnhandledRejectionFn=function(n){u._unhandledRejectionFn=n},void 0!==l&&l.exports?l.exports=u:n.Promise||(n.Promise=u)}(this)}).call(this,n("timers").setImmediate)},{timers:3}],3:[function(f,n,c){(function(n,e){var r=f("process/browser.js").nextTick,t=Function.prototype.apply,o=Array.prototype.slice,u={},i=0;function a(n,e){this._id=n,this._clearFn=e}c.setTimeout=function(){return new a(t.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new a(t.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(n){n.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(n,e){clearTimeout(n._idleTimeoutId),n._idleTimeout=e},c.unenroll=function(n){clearTimeout(n._idleTimeoutId),n._idleTimeout=-1},c._unrefActive=c.active=function(n){clearTimeout(n._idleTimeoutId);var e=n._idleTimeout;0<=e&&(n._idleTimeoutId=setTimeout(function(){n._onTimeout&&n._onTimeout()},e))},c.setImmediate="function"==typeof n?n:function(n){var e=i++,t=!(arguments.length<2)&&o.call(arguments,1);return u[e]=!0,r(function(){u[e]&&(t?n.apply(null,t):n.call(null),c.clearImmediate(e))}),e},c.clearImmediate="function"==typeof e?e:function(n){delete u[n]}}).call(this,f("timers").setImmediate,f("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(n,e,t){var r=n("promise-polyfill"),o="undefined"!=typeof window?window:Function("return this;")();e.exports={boltExport:o.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)});var cr=fr.exports.boltExport,sr=function(n){return en.nu(function(e){n().then(function(n){return e($.value(n))}).catch(function(n){return e($.error(n))})})},lr=function(n){return new cr(function(e,t){n.get(function(n){n.fold(function(n){return t(n)},e)})})},dr=function(n){return w.from(n.split(".")[1]).map(function(n){return JSON.parse(l.window.atob(n))})},pr=0,mr=function(){return n="file",e=(new Date).getTime(),n+"_"+Math.floor(1e9*Math.random())+ ++pr+String(e);var n,e},hr=function(e,t){var n,r,o;return(n=e.files,r=e.parentUuid,o=t,L(n,function(t){return r.fold(function(){return t.parentUuid.isNone()&&t.name===o},function(e){return t.parentUuid.exists(function(n){return n===e&&t.name===o})})})).fold(function(){var n={uuid:mr(),type:"directory",parentUuid:e.parentUuid,name:t,size:0,modificationDate:new Date,url:w.none(),thumbUrl:w.none(),starred:!1,path:w.none()};return{files:e.files.concat([n]),parentUuid:w.some(n.uuid)}},function(n){return{files:e.files,parentUuid:w.some(n.uuid)}})},vr=function(n,e){return P(k(e.split("/"),function(n){return 0<n.length}),hr,{files:n,parentUuid:w.none()})},gr=we([je("name"),je("sub"),ke("root"),_e("https://claims.tiny.cloud/drive/root","root",zn(),De)]),yr=function(n,e){n.set(Mn(n.get(),{files:e}))},br=function(n,e){n.set(Mn(n.get(),{meta:Mn(n.get().meta,e)}))},wr=function(h,n){var e,v={},r=P(n,function(n,e){var t,r,o,u,i,a,f,c,s=I(e.size)?We(e.name).getOr("document"):"directory",l=e.size?e.size:0,d=F(e.date)?ur(e.date).getOr(new Date):new Date,p=e.uuid?e.uuid:mr(),m={uuid:p,type:s,parentUuid:w.from(e.parentUuid),name:e.name,size:l,modificationDate:d,url:w.from(e.url),thumbUrl:w.from(e.thumbUrl),starred:!0===e.starred,path:w.none()};return v[p]=(r=h,o=(t=e).meta?t.meta:{},u=w.from(o.createdBy).orThunk(function(){return dr(r).map(function(n){return n.name})}),{description:o.description?o.description:"",createdBy:u}),i=n,a=e.path,f=m,(c=vr(i,a)).files.concat([Mn(f,{parentUuid:c.parentUuid})])},[]),o=(e=h,dr(e).bind(function(n){return Fe("claims",gr,n).toOption()})).getOr({name:"",sub:"",root:w.none()});return o.root.fold(function(){return{files:r,meta:v,claims:o,rootUuid:w.none()}},function(n){var e=vr(r,n),t=e.parentUuid;return{files:e.files,meta:v,claims:o,rootUuid:t}})},Tr=function(n,r){var o=m({files:[],meta:{},claims:{name:"",sub:"",root:w.none()},rootUuid:w.none()});return function(){return n.jwtTokenFactory(!1).bindFuture((t=n.requestDelay,function(e){return Y.nu(function(n){setTimeout(function(){n($.value(e))},t)})})).mapError(or).bindFuture(function(e){return r.mapResult(function(n){return 0<o.get().files.length||o.set(wr(e,n)),o})});var t}},Or=function(n,e){return n.parentUuid.bind(function(n){return _r(n,e)})},_r=function(e,n){return L(n,function(n){return n.uuid===e})},Fr=function(n,e){return Mn(n,{path:e})},Er=function(n,e){return Fr(n,w.some(function(n,e){for(var t=[],r=Or(n,e);r.isSome();r=r.bind(function(n){return Or(n,e)}))r.each(function(n){return t.push(n)});return"/"+U(t.reverse(),function(n){return n.name}).concat([n.name]).join("/")}(n,e)))},Sr=function(n,e){return n.query.fold(g(!0),function(n){return-1!==e.name.toLowerCase().indexOf(n.toLowerCase())})},xr=function(n,e){return 0===n.fileTypes.length||j(n.fileTypes,function(n){return n===e.type})},Dr=function(i,a,f,c,n){return en.nu(function(o){var u=n.or(i.get().rootUuid);We(f).fold(function(){return o($.error({type:"",message:'Invalid file extension for "'+f+'"'}))},function(n){var e,t=mr(),r={uuid:t,type:n,parentUuid:u,name:f,size:a.size,modificationDate:new Date,url:w.some(l.URL.createObjectURL(a)),thumbUrl:c.map(l.URL.createObjectURL),starred:!1,path:w.none()};br(i,((e={})[t]={description:"",createdBy:w.some(i.get().claims.name)},e)),yr(i,i.get().files.concat([r])),o($.value(r))})})},Ir=function(a){return function(i){return en.nu(function(n){var t,r,e,o,u;t=function(n,e){var t=Math.round(i.size*(n/e));a({name:i.name,uuid:i.uuid,loaded:t,total:i.size})},r=function(){n($.value(i))},o=e=10,(u=function(n,e){setTimeout(function(){e<n?(t(e,n),u(n,e+1)):(t(e,n),r())},o)})(e,0)})}},Rr=function(n,e){var t,r=vr(n.get().files,(t=e,n.get().claims.root.map(function(n){return Ge(n,t.path)}).getOr(t.path)));return yr(n,r.files),Dr(n,e.blob,e.name,e.thumbBlob,r.parentUuid).bindFuture(Ir(e.progress))},Nr=function(f,n){var t,r,l=(t=Tr(f,n),r=f,function(e){return t().mapResult(function(n){return r.log&&console.log("memfs:",e,n.get().claims),n})}),u=function(n,t,r){var e=w.from(n.get().meta[t]).fold(function(){var n;return(n={})[t]=r,n},function(n){var e;return(e={})[t]=Mn(n,r),e});br(n,Mn(n.get().meta,e))},c=function(n,e){return n.claims.root.map(function(t){return e.path.exists(function(n){return t===n||(e=t,0===Ge(n,"/").indexOf(Ge(e,"/")));var e})}).getOr(!0)},s=function(n,e){return U(n,function(n){return e.fold(g(n),function(u){return Fr(n,n.path.map(function(n){var e,t,r,o;return"/"+(gn(e=n,t=u+"/")?(r=e,o=t.length,r.substring(o)):e)}))})})};return{rename:function(o,u){return l("rename").bindFuture(function(r){return en.nu(function(e){var n,t;yr(r,U(r.get().files,function(n){return n.uuid===o?Mn(n,{name:u}):n})),q((n=r.get().files,t=[o],k(n,function(n){return A(t,n.uuid)}))).fold(function(){return e($.error({type:"error",message:"File not found"}))},function(n){return e($.value(n.uuid))})})})},mkdir:function(c,s){return l("mkdir").bindFuture(function(f){return en.nu(function(n){var e,t,r,o,u,i=mr(),a={uuid:i,type:"directory",parentUuid:F(s)?(e=s,t=f,w.from(e).or(t.get().rootUuid)):w.none(),name:c,size:0,modificationDate:new Date,url:w.none(),thumbUrl:w.none(),starred:!1,path:w.none()};r=f.get().files,o=w.from(s),u=c,j(k(r,function(n){return o.fold(function(){return n.parentUuid.isNone()},function(e){return n.parentUuid.exists(function(n){return n===e})})}),function(n){return"directory"===n.type&&n.name===u})?n($.error({type:"x",message:"Directory already exists"})):(yr(f,f.get().files.concat([a])),n($.value(i)))})})},upload:function(t){return l("upload").bindFuture(function(n){return Dr(n,(e=t).blob,e.name,e.thumbBlob,e.parent).bindFuture(Ir(e.progress));var e})},list:function(i){return l("list").bindFuture(function(u){return en.nu(function(n){var e=k(u.get().files,function(n){return e=i,t=n,r=u.get().rootUuid,e.parentUuid.fold(function(){return r.fold(function(){return t.parentUuid.isNone()},function(e){return t.parentUuid.exists(function(n){return n===e})})},function(e){return t.parentUuid.exists(function(n){return n===e})})&&Sr(i,n)&&xr(i,n);var e,t,r}),t=tr(e,i.sortBy,i.sortOrder),r=t.slice(i.offset,i.offset+f.limit),o=i.offset+r.length;n($.value({last:o>=t.length,offset:o,files:r}))})})},listStarred:function(a){return l("listStarred").bindFuture(function(i){return en.nu(function(n){var e=i.get().claims.root,t=z(i.get().files,function(n){var e=Er(n,i.get().files);return c(i.get(),e)&&Sr(a,e)&&xr(a,n)&&!0===e.starred?[e]:[]}),r=tr(t,a.sortBy,a.sortOrder),o=r.slice(a.offset,a.offset+f.limit),u=a.offset+o.length;n($.value({last:u>=r.length,offset:u,files:s(o,e)}))})})},search:function(a){return l("search").bindFuture(function(i){return en.nu(function(n){var e=i.get().claims.root,t=z(i.get().files,function(n){var e=Er(n,i.get().files);return c(i.get(),e)&&Sr(a,e)&&xr(a,n)&&"directory"!==n.type?[e]:[]}),r=tr(t,a.sortBy,a.sortOrder),o=r.slice(a.offset,a.offset+f.limit),u=a.offset+o.length;n($.value({last:u>=r.length,offset:u,files:s(o,e)}))})})},remove:function(t){return l("remove").bindFuture(function(e){return en.nu(function(n){yr(e,z(e.get().files,function(n){return A(t,n.uuid)?[]:[n]})),n($.value(t))})})},copy:function(r,o){return l("copy").bindFuture(function(t){return en.nu(function(n){var e=mr();yr(t,z(t.get().files,function(n){return n.uuid===r?[n,Mn(n,{uuid:e,parentUuid:w.from(o)})]:[n]})),t.get().meta[r]&&u(t,e,t.get().meta[r]),n($.value(e))})})},move:function(t,r){return l("move").bindFuture(function(e){return en.nu(function(n){yr(e,U(e.get().files,function(n){return A(t,n.uuid)?Mn(n,{parentUuid:w.from(r)}):n})),n($.value(t))})})},star:function(t){return l("star").bindFuture(function(e){return en.nu(function(n){yr(e,U(e.get().files,function(n){return A(t,n.uuid)?Mn(n,{starred:!0}):n})),n($.value(t))})})},unstar:function(t){return l("unstar").bindFuture(function(e){return en.nu(function(n){yr(e,U(e.get().files,function(n){return A(t,n.uuid)?Mn(n,{starred:!1}):n})),n($.value(t))})})},setMeta:function(r,o){return l("setMeta").bindFuture(function(t){return en.nu(function(e){_r(r,t.get().files).fold(function(){return e($.error({type:"error",message:"No file!!"}))},function(n){u(t,r,{description:o.description}),e($.value(n.uuid))})})})},getMeta:function(o){return l("getMeta").bindFuture(function(r){return en.nu(function(t){_r(o,r.get().files).fold(function(){return t($.error({type:"error",message:"No file!!"}))},function(n){var e=r.get().meta[o];t($.value(e||{description:"",createdBy:w.none()}))})})})},uploadToPath:function(e){return l("uploadToPath").bindFuture(function(n){return Rr(n,e)})}}},Ar=function(n,e){return e&&!/^https?:/.test(e)?Ge(n,e):e},jr=function(n,r){var e,t=en.wrap((e={url:r,responseType:c.JSON},xn(O({},e,{method:"get",body:Dn()}))).map(function(n){return n.fold(function(n){return $.error({type:"",message:"fs error"})},function(n){return $.value((e=Be(r).replace(/\/[^\/]*\/?$/,""),t=n.files,U(t,function(n){return O({},n,{url:Ar(e,n.url),thumbUrl:Ar(e,n.thumbUrl)})})));var e,t})}));return Nr(n,t.toCached())},Ur=function(u){var i=u.jwtTokenFactory;return u.demoFilesUrl.fold(function(){return u.demoFiles.fold(function(){return n=i,e=u.serviceUrl,t=u.apiKey,r=e.getOrDie("Failed to get service url"),o=t.getOrDie("Failed to get api key"),nr({jwtTokenFactory:n,restApiEndpoint:r,apiKey:o});var n,e,t,r,o},function(n){return e=n,Nr({jwtTokenFactory:i,requestDelay:0,log:!1,limit:30},en.pure(e));var e})},function(n){return jr({jwtTokenFactory:i,requestDelay:0,log:!1,limit:30},n)})},Cr=function(){return mn(tn,"tinymce").or(mn(tn,"tinydrive")).getOrThunk(function(){var n={};return tn.tinydrive=n})},kr=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:g(n)}},Pr={fromHtml:function(n,e){var t=(e||l.document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw l.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return kr(t.childNodes[0])},fromTag:function(n,e){var t=(e||l.document).createElement(n);return kr(t)},fromText:function(n,e){var t=(e||l.document).createTextNode(n);return kr(t)},fromDom:kr,fromPoint:function(n,e,t){var r=n.dom();return w.from(r.elementFromPoint(e,t)).map(kr)}},Lr=function(){return se.getOrDie("Node")},Mr=function(n,e,t){return 0!=(n.compareDocumentPosition(e)&t)},Br=function(n,e){return Mr(n,e,Lr().DOCUMENT_POSITION_CONTAINED_BY)},Gr=function(){return Hr(0,0)},Hr=function(n,e){return{major:n,minor:e}},zr={nu:Hr,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?Gr():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return Hr(r(1),r(2))}(n,t)},unknown:Gr},qr="Firefox",Jr=function(n,e){return function(){return e===n}},Vr=function(n){var e=n.current;return{current:e,version:n.version,isEdge:Jr("Edge",e),isChrome:Jr("Chrome",e),isIE:Jr("IE",e),isOpera:Jr("Opera",e),isFirefox:Jr(qr,e),isSafari:Jr("Safari",e)}},Wr={unknown:function(){return Vr({current:void 0,version:zr.unknown()})},nu:Vr,edge:g("Edge"),chrome:g("Chrome"),ie:g("IE"),opera:g("Opera"),firefox:g(qr),safari:g("Safari")},Yr="Windows",Kr="Android",Xr="Solaris",$r="FreeBSD",Zr=function(n,e){return function(){return e===n}},Qr=function(n){var e=n.current;return{current:e,version:n.version,isWindows:Zr(Yr,e),isiOS:Zr("iOS",e),isAndroid:Zr(Kr,e),isOSX:Zr("OSX",e),isLinux:Zr("Linux",e),isSolaris:Zr(Xr,e),isFreeBSD:Zr($r,e)}},no={unknown:function(){return Qr({current:void 0,version:zr.unknown()})},nu:Qr,windows:g(Yr),ios:g("iOS"),android:g(Kr),linux:g("Linux"),osx:g("OSX"),solaris:g(Xr),freebsd:g($r)},eo=function(n,e){var t=String(e).toLowerCase();return L(n,function(n){return n.search(t)})},to=function(n,t){return eo(n,t).map(function(n){var e=zr.detect(n.versionRegexes,t);return{current:n.name,version:e}})},ro=function(n,t){return eo(n,t).map(function(n){var e=zr.detect(n.versionRegexes,t);return{current:n.name,version:e}})},oo=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,uo=function(e){return function(n){return vn(n,e)}},io=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return vn(n,"edge/")&&vn(n,"chrome")&&vn(n,"safari")&&vn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,oo],search:function(n){return vn(n,"chrome")&&!vn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return vn(n,"msie")||vn(n,"trident")}},{name:"Opera",versionRegexes:[oo,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:uo("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:uo("firefox")},{name:"Safari",versionRegexes:[oo,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(vn(n,"safari")||vn(n,"mobile/"))&&vn(n,"applewebkit")}}],ao=[{name:"Windows",search:uo("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return vn(n,"iphone")||vn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:uo("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:uo("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:uo("linux"),versionRegexes:[]},{name:"Solaris",search:uo("sunos"),versionRegexes:[]},{name:"FreeBSD",search:uo("freebsd"),versionRegexes:[]}],fo={browsers:g(io),oses:g(ao)},co=function(n){var e,t,r,o,u,i,a,f,c,s,l,d=fo.browsers(),p=fo.oses(),m=to(d,n).fold(Wr.unknown,Wr.nu),h=ro(p,n).fold(no.unknown,no.nu);return{browser:m,os:h,deviceType:(t=m,r=n,o=(e=h).isiOS()&&!0===/ipad/i.test(r),u=e.isiOS()&&!o,i=e.isAndroid()&&3===e.version.major,a=e.isAndroid()&&4===e.version.major,f=o||i||a&&!0===/mobile/i.test(r),c=e.isiOS()||e.isAndroid(),s=c&&!f,l=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(r),{isiPad:g(o),isiPhone:g(u),isTablet:g(f),isPhone:g(s),isTouch:g(c),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:g(l)})}},so={detect:Bn(function(){var n=l.navigator.userAgent;return co(n)})},lo=(l.Node.ATTRIBUTE_NODE,l.Node.CDATA_SECTION_NODE,l.Node.COMMENT_NODE,l.Node.DOCUMENT_NODE,l.Node.DOCUMENT_TYPE_NODE,l.Node.DOCUMENT_FRAGMENT_NODE,l.Node.ELEMENT_NODE,l.Node.TEXT_NODE,l.Node.PROCESSING_INSTRUCTION_NODE,l.Node.ENTITY_REFERENCE_NODE,l.Node.ENTITY_NODE,l.Node.NOTATION_NODE,so.detect().browser.isIE(),function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e]}("element","offset"),function(n,e){n.dom().appendChild(e.dom())}),po=Bn(function(){return mo(Pr.fromDom(l.document))}),mo=function(n){var e=n.dom().body;if(null==e)throw new Error("Body is not available yet");return Pr.fromDom(e)},ho=function(n,e){var t=n.dom();cn(e,function(n,e){!function(n,e,t){if(!(F(t)||x(t)||I(t)))throw l.console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")}(t,e,n)})},vo=function(p,m){return function(n){if(p(n)){var e,t,r,o,u,i,a,f=Pr.fromDom(n.target),c=function(){n.stopPropagation()},s=function(){n.preventDefault()},l=v(s,c),d=(e=f,t=n.clientX,r=n.clientY,o=c,u=s,i=l,a=n,{target:g(e),x:g(t),y:g(r),stop:o,prevent:u,kill:i,raw:g(a)});m(d)}}},go=function(n,e,t,r){return o=n,u=e,i=!1,a=vo(t,r),o.dom().addEventListener(u,a,i),{unbind:function(r){for(var o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=o.concat(n);return r.apply(null,t)}}(yo,o,u,a,i)};var o,u,i,a},yo=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},bo=g(!0),wo=function(n,e,t){return go(n,e,bo,t)},To="_assetManagerProvider",Oo="_assetManagerLazy",_o=en.nu(function(n){Cr()[To]=n}),Fo=function(n){var e=k(n,function(n){return n.isError()});return 0<e.length?e[0]:n[0]},Eo=function(u){var i=Cr();return mn(i,Oo).getOrThunk(function(){var n,t,r,o,e=(n=[_o,(o=u.css,en.nu(function(n){var e=Pr.fromTag("link");ho(e,{rel:"stylesheet",href:o}),wo(e,"load",function(){n($.value(e))}),wo(e,"error",function(){n($.error("Failed to load css: "+o))}),lo(Pr.fromDom(l.document.head),e)})),(t=u.js,r={},en.nu(function(n){var e=Pr.fromTag("script");ho(e,O({src:t},r)),wo(e,"load",function(){n($.value(e))}),wo(e,"error",function(){n($.error("Failed to load script: "+t))}),lo(po(),e)})).mapError(function(n){return So(n),n})],ir(n,Y.nu)).map(Fo).toLazy();return i[Oo]=e})},So=function(n){(0,Cr()[To])($.error(n))},xo=function(){return w.from(rn("ui.FloatPanel.currentZIndex",tinymce)).getOr(65536)},Do=function(n){return"media"===n?["directory","video","audio"]:"image"===n?["directory","image"]:[]},Io=function(n){var e,t,r,o=xo(),u=Un(n),i=(e=n,w.from(e.getParam("tinydrive_dropbox_app_key",null,"string"))),a=(t=n,w.from(t.getParam("tinydrive_google_drive_key",null,"string"))),f=(r=n,w.from(r.getParam("tinydrive_google_drive_client_id",null,"string")));return{close:!0,insert:!0,fullscreen:!1,target:w.none(),fileTypes:[],zIndex:o,maxImageDimension:u,dropboxAppKey:i,googleDriveDeveloperKey:a,googleDriveClientId:f}},Ro=function(n,e){return Eo({js:(o=n,u=e+"/assetmanager.min.js",o.getParam("tinydrive_script_url",u,"string")),css:(t=n,r=e+"/assetmanager.min.css",t.getParam("tinydrive_css_url",r,"string"))});var t,r,o,u},No=function(o,n,u,i){return Y.nu(function(r){Ro(o,n).get(function(n){n.fold(function(n){console.error(n)},function(n){return n(u,(e=Io(o),t=i,w.from(t.filetype).map(Do).fold(g(e),function(n){return O({},e,{fileTypes:n})})),r);var e,t})})})},Ao=function(i,a){a.url.each(function(n){var e,t,r,o,u;i.insertContent((u=a.name,We(u).is("image")?(o=n,i.dom.createHTML("img",{src:o})):(t=n,r=a,(e=i).dom.createHTML("a",{href:t},e.dom.encode(r.name)))))})},jo=function(e,n,t){No(e,n,t,{filetype:""}).get(function(n){C(n,function(n){return Ao(e,n)})})},Uo=function(n,e,t){var r,o,u,i,a,f;n.ui?(a=e,f=t,(i=n).ui.registry.addButton("insertfile",{icon:"browse",tooltip:"Insert file",onAction:function(){return jo(i,a,f)}})):(o=e,u=t,(r=n).addButton("insertfile",{icon:"browse",tooltip:"Insert file",onclick:function(){return jo(r,o,u)}}))},Co=function(n,e,t){var r,o,u,i,a,f;n.ui?(a=e,f=t,(i=n).ui.registry.addMenuItem("insertfile",{icon:"browse",text:"File",onAction:function(){return jo(i,a,f)}})):(o=e,u=t,(r=n).addMenuItem("insertfile",{icon:"browse",text:"File",onclick:function(){return jo(r,o,u)}}))},ko=function(n,e){return Ur({demoFilesUrl:(f=n,w.from(f.getParam("tinydrive_demo_files_url",null,"string"))),demoFiles:(a=n,w.from(a.getParam("tinydrive_demo_files"))),jwtTokenFactory:(o=n,u=e,i=o.getParam("tinydrive_token_provider"),jn(i,u)),serviceUrl:(r=n,w.from(r.getParam("tinydrive_service_url",null,"string"))),apiKey:(t=n,w.from(t.getParam("tinydrive_api_key",null,"string")).orThunk(function(){return w.from(t.getParam("api_key",null,"string"))}))});var t,r,o,u,i,a,f};function Po(n,e){return Bo(l.document.createElement("canvas"),n,e)}function Lo(n){var e=Po(n.width,n.height);return Mo(e).drawImage(n,0,0),e}function Mo(n){return n.getContext("2d")}function Bo(n,e,t){return n.width=e,n.height=t,n}function Go(){return new(se.getOrDie("FileReader"))}var Ho={atob:function(n){return se.getOrDie("atob")(n)},requestAnimationFrame:function(n){se.getOrDie("requestAnimationFrame")(n)}};function zo(n){return n.naturalWidth||n.width}function qo(n){return n.naturalHeight||n.height}var Jo=window.Promise?window.Promise:function(){var u=function(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],s(n,t(o,this),t(a,this))},n=u.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(n){l.setTimeout(n,1)};function t(n,e){return function(){return n.apply(e,arguments)}}var r=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};function i(t){var r=this;null!==this._state?n(function(){var n=r._state?t.onFulfilled:t.onRejected;if(null!==n){var e;try{e=n(r._value)}catch(n){return void t.reject(n)}t.resolve(e)}else(r._state?t.resolve:t.reject)(r._value)}):this._deferreds.push(t)}function o(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var e=n.then;if("function"==typeof e)return void s(t(e,n),t(o,this),t(a,this))}this._state=!0,this._value=n,f.call(this)}catch(n){a.call(this,n)}}function a(n){this._state=!1,this._value=n,f.call(this)}function f(){for(var n=0,e=this._deferreds;n<e.length;n++){var t=e[n];i.call(this,t)}this._deferreds=[]}function c(n,e,t,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=r}function s(n,e,t){var r=!1;try{n(function(n){r||(r=!0,e(n))},function(n){r||(r=!0,t(n))})}catch(n){if(r)return;r=!0,t(n)}}return u.prototype.catch=function(n){return this.then(null,n)},u.prototype.then=function(t,r){var o=this;return new u(function(n,e){i.call(o,new c(t,r,n,e))})},u.all=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var a=Array.prototype.slice.call(1===n.length&&r(n[0])?n[0]:n);return new u(function(r,o){if(0===a.length)return r([]);var u=a.length;function i(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void t.call(n,function(n){i(e,n)},o)}a[e]=n,0==--u&&r(a)}catch(n){o(n)}}for(var n=0;n<a.length;n++)i(n,a[n])})},u.resolve=function(e){return e&&"object"==typeof e&&e.constructor===u?e:new u(function(n){n(e)})},u.reject=function(t){return new u(function(n,e){e(t)})},u.race=function(o){return new u(function(n,e){for(var t=0,r=o;t<r.length;t++)r[t].then(n,e)})},u}();function Vo(a){return new Jo(function(n,e){var t=l.URL.createObjectURL(a),r=new l.Image,o=function(){r.removeEventListener("load",u),r.removeEventListener("error",i)};function u(){o(),n(r)}function i(){o(),e("Unable to load data of type "+a.type+": "+t)}r.addEventListener("load",u),r.addEventListener("error",i),r.src=t,r.complete&&u()})}function Wo(n){var e=n.split(","),t=/data:([^;]+)/.exec(e[0]);if(!t)return w.none();for(var r,o,u,i=t[1],a=e[1],f=Ho.atob(a),c=f.length,s=Math.ceil(c/1024),l=new Array(s),d=0;d<s;++d){for(var p=1024*d,m=Math.min(p+1024,c),h=new Array(m-p),v=p,g=0;v<m;++g,++v)h[g]=f[v].charCodeAt(0);l[d]=(r=h,new(se.getOrDie("Uint8Array"))(r))}return w.some((o=l,u={type:i},new(se.getOrDie("Blob"))(o,u)))}function Yo(n,r,o){return r=r||"image/png",l.HTMLCanvasElement.prototype.toBlob?new Jo(function(e,t){n.toBlob(function(n){n?e(n):t()},r,o)}):(t=n.toDataURL(r,o),new Jo(function(n,e){Wo(t).fold(function(){e("uri is not base64: "+t)},n)}));var t}function Ko(n){return Vo(n).then(function(n){var e;e=n,l.URL.revokeObjectURL(e.src);var t=Po(zo(n),qo(n));return Mo(t).drawImage(n,0,0),t})}function Xo(n,e,t){var r=e.type;function o(r,o){return n.then(function(n){return t=o,e=(e=r)||"image/png",n.toDataURL(e,t);var e,t})}return{getType:g(r),toBlob:function(){return Jo.resolve(e)},toDataURL:function(){return t},toBase64:function(){return t.split(",")[1]},toAdjustedBlob:function(e,t){return n.then(function(n){return Yo(n,e,t)})},toAdjustedDataURL:o,toAdjustedBase64:function(n,e){return o(n,e).then(function(n){return n.split(",")[1]})},toCanvas:function(){return n.then(Lo)}}}function $o(e){return(t=e,new Jo(function(n){var e=Go();e.onloadend=function(){n(e.result)},e.readAsDataURL(t)})).then(function(n){return Xo(Ko(e),e,n)});var t}function Zo(e,n){return Yo(e,n).then(function(n){return Xo(Jo.resolve(e),n,e.toDataURL())})}var Qo=function(n){return $o(n)};function nu(n,e,t){var r=zo(n),o=qo(n),u=e/r,i=t/o,a=!1;(u<.5||2<u)&&(u=u<.5?.5:2,a=!0),(i<.5||2<i)&&(i=i<.5?.5:2,a=!0);var f,c,s,l=(f=n,c=u,s=i,new Jo(function(n){var e=zo(f),t=qo(f),r=Math.floor(e*c),o=Math.floor(t*s),u=Po(r,o),i=Mo(u);i.drawImage(f,0,0,e,t,0,0,r,o),n(u)}));return a?l.then(function(n){return nu(n,e,t)}):l}function eu(e,t){return e.toCanvas().then(function(n){return function(n,e,t){var r=Po(n.width,n.height),o=Mo(r),u=0,i=0;90!==(t=t<0?360+t:t)&&270!==t||Bo(r,r.height,r.width);90!==t&&180!==t||(u=r.width);270!==t&&180!==t||(i=r.height);return o.translate(u,i),o.rotate(t*Math.PI/180),o.drawImage(n,0,0),Zo(r,e)}(n,e.getType(),t)})}var tu,ru,ou,uu,iu,au,fu,cu,su=function(){function n(n){this.littleEndian=!1,this._dv=new DataView(n)}return n.prototype.readByteAt=function(n){return this._dv.getUint8(n)},n.prototype.read=function(n,e){if(n+e>this.length())return null;for(var t=this.littleEndian?0:-8*(e-1),r=0,o=0;o<e;o++)r|=this.readByteAt(n+o)<<Math.abs(t+8*o);return r},n.prototype.BYTE=function(n){return this.read(n,1)},n.prototype.SHORT=function(n){return this.read(n,2)},n.prototype.LONG=function(n){return this.read(n,4)},n.prototype.SLONG=function(n){var e=this.read(n,4);return null===e?null:2147483647<e?e-4294967296:e},n.prototype.CHAR=function(n){var e=this.read(n,1);return null===e?"":String.fromCharCode(e)},n.prototype.STRING=function(n,e){return this.asArray("CHAR",n,e).join("")},n.prototype.SEGMENT=function(n,e){var t=this._dv.buffer;return void 0!==n&&void 0!==e?t.slice(n,n+e):void 0!==n?t.slice(n):t},n.prototype.asArray=function(n,e,t){for(var r=[],o=0;o<t;o++)r[o]=this[n](e+o);return r},n.prototype.length=function(){return this._dv?this._dv.byteLength:0},n}(),lu={274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},du={36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},pu={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},mu={513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"},hu={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},vu=function(){function n(n){if(this._offsets={tiffHeader:10,IFD0:null,IFD1:null,exifIFD:null,gpsIFD:null},this._reader=new su(n),this._idx=this._offsets.tiffHeader,65505!==this.SHORT(0)||"EXIF\0"!==this.STRING(4,5).toUpperCase())throw new Error("Exif data cannot be read or not available.");if(this._reader.littleEndian=18761===this.SHORT(this._idx),42!==this.SHORT(this._idx+=2))throw new Error("Invalid Exif data.");this._offsets.IFD0=this._offsets.tiffHeader+this.LONG(this._idx+=2),this._tiffTags=this.extractTags(this._offsets.IFD0,lu),"ExifIFDPointer"in this._tiffTags&&(this._offsets.exifIFD=this._offsets.tiffHeader+this._tiffTags.ExifIFDPointer,delete this._tiffTags.ExifIFDPointer),"GPSInfoIFDPointer"in this._tiffTags&&(this._offsets.gpsIFD=this._offsets.tiffHeader+this._tiffTags.GPSInfoIFDPointer,delete this._tiffTags.GPSInfoIFDPointer);var e=this.LONG(this._offsets.IFD0+12*this.SHORT(this._offsets.IFD0)+2);e&&(this._offsets.IFD1=this._offsets.tiffHeader+e)}return n.prototype.BYTE=function(n){return this._reader.BYTE(n)},n.prototype.SHORT=function(n){return this._reader.SHORT(n)},n.prototype.LONG=function(n){return this._reader.LONG(n)},n.prototype.SLONG=function(n){return this._reader.SLONG(n)},n.prototype.CHAR=function(n){return this._reader.CHAR(n)},n.prototype.STRING=function(n,e){return this._reader.STRING(n,e)},n.prototype.SEGMENT=function(n,e){return this._reader.SEGMENT(n,e)},n.prototype.asArray=function(n,e,t){for(var r=[],o=0;o<t;o++)r[o]=this[n](e+o);return r},n.prototype.length=function(){return this._reader.length()},n.prototype.UNDEFINED=function(n){return this.BYTE(n)},n.prototype.RATIONAL=function(n){return this.LONG(n)/this.LONG(n+4)},n.prototype.SRATIONAL=function(n){return this.SLONG(n)/this.SLONG(n+4)},n.prototype.ASCII=function(n){return this.CHAR(n)},n.prototype.TIFF=function(){return this._tiffTags},n.prototype.EXIF=function(){var n=null;if(this._offsets.exifIFD){try{n=this.extractTags(this._offsets.exifIFD,du)}catch(n){return null}if(n.ExifVersion&&Array.isArray(n.ExifVersion)){for(var e="",t=0,r=n.ExifVersion;t<r.length;t++){var o=r[t];e+=String.fromCharCode(o)}n.ExifVersion=e}}return n},n.prototype.GPS=function(){var n=null;if(this._offsets.gpsIFD){try{n=this.extractTags(this._offsets.gpsIFD,pu)}catch(n){return null}n.GPSVersionID&&Array.isArray(n.GPSVersionID)&&(n.GPSVersionID=n.GPSVersionID.join("."))}return n},n.prototype.thumb=function(){var n=this;if(n._offsets.IFD1)try{var e=n.extractTags(n._offsets.IFD1,mu);if("JPEGInterchangeFormat"in e)return n.SEGMENT(n._offsets.tiffHeader+e.JPEGInterchangeFormat,e.JPEGInterchangeFormatLength)}catch(n){return null}return null},n.prototype.extractTags=function(n,e){var t=this,r={},o={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},u={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};if(n+2>t.length())return r;for(var i=t.SHORT(n),a=0;a<i;a++){var f=[],c=n+2+12*a,s=e[t.SHORT(c)];if(void 0!==s){var l=o[t.SHORT(c+=2)],d=t.LONG(c+=2),p=u[l];if(!p)throw new Error("Invalid Exif data.");if(c+=4,4<p*d&&(c=t.LONG(c)+t._offsets.tiffHeader),c+p*d>=t.length())throw new Error("Invalid Exif data.");if("ASCII"!==l){f=t.asArray(l,c,d);var m=1===d?f[0]:f;hu.hasOwnProperty(s)&&"object"!=typeof m?r[s]=hu[s][m]:r[s]=m}else r[s]=t.STRING(c,d).replace(/\0$/,"").trim()}}return r},n}(),gu=function(i){return(t=i,new Jo(function(n){var e=Go();e.onloadend=function(){n(e.result)},e.readAsArrayBuffer(t)})).then(function(n){try{var e=new su(n);if(65496!==e.SHORT(0))return Jo.reject("Image was not a jpeg");var t=yu(e),r=t.filter(function(n){return"APP1"===n.name}),o={rawHeaders:t};if(!r.length)return Jo.reject("Headers did not include required information");var u=new vu(r[0].segment);return o.tiff=u.TIFF(),o.exif=u.EXIF(),o.gps=u.GPS(),o.thumb=u.thumb(),o}catch(n){return Jo.reject("Unsupported format or not an image: "+i.type+" (Exception: "+n.message+")")}});var t},yu=function(n){for(var e,t=[],r=2;r+2<=n.length();)if(65488<=(e=n.SHORT(r))&&e<=65495)r+=2;else{if(65498===e||65497===e)break;var o=n.SHORT(r+2)+2;65505<=e&&e<=65519&&t.push({hex:e,name:"APP"+(15&e),start:r,length:o,segment:n.SEGMENT(r,o)}),r+=o}return t},bu=function(n,e,t){return o=e,u=t,(r=n).toCanvas().then(function(n){return nu(n,o,u).then(function(n){return Zo(n,r.getType())})});var r,o,u},wu=function(n,e){return eu(n,e)},Tu=function(e){return e.toBlob().then(gu).then(function(n){switch(n.tiff.Orientation){case 6:return wu(e,90);case 3:return wu(e,180);case 8:return wu(e,270);default:return e}},function(){return e})},Ou=function(e){return sr(function(){return(n=e,Vo(n)).then(function(n){var e=n.naturalWidth,t=n.naturalHeight;return l.URL.revokeObjectURL(n.src),{width:e,height:t}});var n})},_u=["image/jpeg","image/png","image/gif"],Fu=function(n,e){return Math.max(n.width/e.width,n.height/e.height)},Eu=function(u,i){return Ou(u).bindFuture(function(n){return 1<Fu(n,i)?(e=u,o=Fu(r=n,i),t={width:Math.round(r.width/o),height:Math.round(r.height/o)},sr(function(){return Qo(e).then(function(n){return bu(n,t.width,t.height)}).then(function(n){return n.toAdjustedBlob(e.type,9)})})):en.value(u);var e,t,r,o})},Su=function(n){return en.fromPromise(Qo(n).then(Tu).then(function(n){return n.toBlob()}))},xu=function(n,e){return(t=n,r=e,r.map(function(n){return Eu(t,{width:n,height:n})}).getOr(en.pure(t)).bindFuture(Su).bindFuture(function(e){return Eu(e,{width:512,height:512}).mapResult(function(n){return{blob:e,thumbBlob:w.some(n)}})})).mapError(rr);var t,r},Du=function(n,e){return A(_u,n.type)?xu(n,e):en.pure({blob:n,thumbBlob:w.none()})},Iu=function(e){return Du(e.blob,e.maxImageDimension).bindFuture(function(n){return e.fs.uploadToPath({blob:n.blob,thumbBlob:n.thumbBlob,name:e.name,progress:e.progress,path:e.path})})},Ru=function(n,e,t){if(!0!==D(n.settings.images_upload_handler)){var r=n.getParam("tinydrive_upload_path",un("/uploads"),"string");n.settings.images_upload_handler=(o=e,u=r,i=t,a=Un(n),function(n,e,t,r){Iu({fs:o,path:u,name:n.filename(),blob:n.blob(),progress:function(n){return r(Math.round(n.total/n.loaded*100))},maxImageDimension:a}).get(function(n){n.fold(function(n){return t(n.message)},function(n){n.url.fold(function(){return t("Failed to get upload url")},function(n){i(n),e(n)})})})})}var o,u,i,a},Nu=function(n,e){var t=String(n);if(t.length<e)for(var r=0;r<e-t.length;r++)t="0"+t;return t},Au=function(n){return e="%Y-%m-%dT%H:%M:%SZ",a=n,t=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),r="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),o="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),u="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),i="January February March April May June July August September October November December".split(" "),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+t.getFullYear())).replace("%m",Nu(t.getMonth()+1,2))).replace("%d",Nu(t.getDate(),2))).replace("%H",""+Nu(t.getHours(),2))).replace("%M",""+Nu(t.getMinutes(),2))).replace("%S",""+Nu(t.getSeconds(),2))).replace("%I",""+((t.getHours()+11)%12+1))).replace("%p",t.getHours()<12?"AM":"PM")).replace("%B",""+i[t.getMonth()])).replace("%b",""+u[t.getMonth()])).replace("%A",""+o[t.getDay()])).replace("%a",""+r[t.getDay()])).replace("%%","%");var e,t,r,o,u,i,a},ju=function(n){var e=n.name,t=n.url,r=n.size,o=n.type,u=n.modificationDate;return t.map(function(n){return{name:e,url:n,size:r,type:Ye(o),mdate:Au(u)}})},Uu=function(n){return{files:Me(U(n,ju))}},Cu=we([(tu="filetypes",ru=[],ou=De,Pe(tu,ru,Te(ou)))]),ku=we([(fu="path",cu="/",Pe(fu,cu,De)),je("name"),(au="blob",_e(au,au,Hn(),Oe())),(uu="onprogress",iu=h,Pe(uu,iu,Re)),_e("max_image_dimension","maxImageDimension",zn(),xe)]),Pu=function(a,f,c,n,s){return(e=n,t=Fe("picker settings",Cu,e).mapError(Ee),en.fromResult(t)).bindFuture(function(n){return r=f,o=c,u=O({},Io(t=a),{fileTypes:(e=n.filetypes,i=Me(U(e,Ke)),0<i.length?["directory"].concat(i):[]),insert:s}),en.nu(function(e){Ro(t,r).get(function(n){n.fold(function(n){return e($.error(n))},function(n){return n(o,u,function(n){return e($.value(n))})})})});var t,r,o,u,e,i}).mapResult(Uu);var e,t},Lu=function(e,t,n){return(r=n,o=Fe("upload settings",ku,r).mapError(Ee),en.fromResult(o)).bindFuture(function(n){return Iu({fs:t,path:n.path,name:n.name,blob:n.blob,progress:(r=n.onprogress,function(n){var e=n.loaded,t=n.total;r({loaded:e,total:t})}),maxImageDimension:n.maxImageDimension.or(Un(e))}).bindResult(function(n){return $.fromOption(ju(n).map(function(n){return{file:n}}),rr("Failed to get upload file"))}).mapError(function(n){return n.message});var r});var r,o};T.add("tinydrive",function(n,e){var t,r,o,u,i,a,f,c,s,l=m(w.none()),d=ko(n,l),p=(r={},(t=n).on("PreInit",function(){t.editorUpload.addFilter&&t.editorUpload.addFilter(function(n){return!1===r.hasOwnProperty(n.src)})}),function(n){r[n]=!0});return Ru(n,d,p),Uo(n,e,d),Co(n,e,d),u=e,i=d,(a=(o=n).settings).file_picker_callback||(a.file_picker_callback=function(t,n,e){No(o,u,i,e).get(function(n){q(n).each(function(e){e.url.each(function(n){return t(n,{title:e.name,text:e.name})})})})}),f=n,c=e,s=d,{pick:function(n){return lr(Pu(f,c,s,n,!0))},browse:function(n){return lr(Pu(f,c,s,n,!1).mapResult(h))},upload:function(n){return lr(Lu(f,s,n))}}})}(window);