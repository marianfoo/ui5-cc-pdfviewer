/* TinyDrive
 *
 * Copyright 2010-2018 Tiny Technologies LLC. All rights reserved.
 *
 * Version: 1.3.0-76
 */

!function(l){"use strict";var f=function(e){var n=e,t=function(){return n};return{get:t,set:function(e){n=e},clone:function(){return f(t())}}},c=function(){},h=function(t,r){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t(r.apply(null,e))}},v=function(e){return function(){return e}},s=function(e){return e};var e,n,t,r,o,u,i,a=v(!1),d=v(!0),p=a,m=d,g=function(){return y},y=(r={fold:function(e,n){return e()},is:p,isSome:p,isNone:m,getOr:t=function(e){return e},getOrThunk:n=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:t,orThunk:n,map:g,ap:g,each:function(){},bind:g,flatten:g,exists:p,forall:m,filter:g,equals:e=function(e){return e.isNone()},equals_:e,toArray:function(){return[]},toString:v("none()")},Object.freeze&&Object.freeze(r),r),b=function(t){var e=function(){return t},n=function(){return o},r=function(e){return e(t)},o={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:m,isNone:p,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:n,orThunk:n,map:function(e){return b(e(t))},ap:function(e){return e.fold(g,function(e){return b(e(t))})},each:function(e){e(t)},bind:r,flatten:e,exists:r,forall:r,filter:function(e){return e(t)?o:y},equals:function(e){return e.is(t)},equals_:function(e,n){return e.fold(p,function(e){return n(t,e)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},w={some:b,none:g,from:function(e){return null==e?y:b(e)}},T=function(){return(T=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},O=function(n){return function(e){return function(e){if(null===e)return"null";var n=typeof e;return"object"===n&&Array.prototype.isPrototypeOf(e)?"array":"object"===n&&String.prototype.isPrototypeOf(e)?"string":n}(e)===n}},_=O("string"),E=O("object"),F=O("array"),S=O("boolean"),x=O("function"),D=O("number"),I=Array.prototype.slice,R=void 0===(o=Array.prototype.indexOf)?function(e,n){return P(e,n)}:function(e,n){return o.call(e,n)},N=function(e,n){return-1<R(e,n)},A=function(e,n){return M(e,n).isSome()},j=function(e,n){for(var t=e.length,r=new Array(t),o=0;o<t;o++){var u=e[o];r[o]=n(u,o,e)}return r},U=function(e,n){for(var t=0,r=e.length;t<r;t++){n(e[t],t,e)}},C=function(e,n){for(var t=[],r=0,o=e.length;r<o;r++){var u=e[r];n(u,r,e)&&t.push(u)}return t},k=function(e,n,t){return U(e,function(e){t=n(t,e)}),t},L=function(e,n){for(var t=0,r=e.length;t<r;t++){var o=e[t];if(n(o,t,e))return w.some(o)}return w.none()},M=function(e,n){for(var t=0,r=e.length;t<r;t++){if(n(e[t],t,e))return w.some(t)}return w.none()},P=function(e,n){for(var t=0,r=e.length;t<r;++t)if(e[t]===n)return t;return-1},B=Array.prototype.push,G=function(e){for(var n=[],t=0,r=e.length;t<r;++t){if(!Array.prototype.isPrototypeOf(e[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+e);B.apply(n,e[t])}return n},H=function(e,n){var t=j(e,n);return G(t)},z=function(e){return 0===e.length?w.none():w.some(e[0])},q=x(Array.from)?Array.from:function(e){return I.call(e)},J=function(e){var t=w.none(),n=[],r=function(e){o()?i(e):n.push(e)},o=function(){return t.isSome()},u=function(e){U(e,i)},i=function(n){t.each(function(e){l.setTimeout(function(){n(e)},0)})};return e(function(e){t=w.some(e),u(n),n=[]}),{get:r,map:function(t){return J(function(n){r(function(e){n(t(e))})})},isReady:o}},V={nu:J,pure:function(n){return J(function(e){e(n)})}},W=function(n){var e=function(e){var r;n((r=e,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=this;l.setTimeout(function(){r.apply(t,e)},0)}))},t=function(){return V.nu(e)};return{map:function(r){return W(function(t){e(function(e){var n=r(e);t(n)})})},bind:function(t){return W(function(n){e(function(e){t(e).get(n)})})},anonBind:function(t){return W(function(n){e(function(e){t.get(n)})})},toLazy:t,toCached:function(){var n=null;return W(function(e){null===n&&(n=t()),n.get(e)})},get:e}},Y={nu:W,pure:function(n){return W(function(e){e(n)})}},K=function(i,e){return e(function(r){var o=[],u=0;0===i.length?r([]):U(i,function(e,n){var t;e.get((t=n,function(e){o[t]=e,++u>=i.length&&r(o)}))})})},X=Object.keys,$=Object.hasOwnProperty,Z=function(e,n){for(var t=X(e),r=0,o=t.length;r<o;r++){var u=t[r];n(e[u],u,e)}},Q=function(e,r){return ee(e,function(e,n,t){return{k:n,v:r(e,n,t)}})},ee=function(r,o){var u={};return Z(r,function(e,n){var t=o(e,n,r);u[t.k]=t.v}),u},ne=function(e,t){var r=[];return Z(e,function(e,n){r.push(t(e,n))}),r},te=function(e){return ne(e,function(e){return e})},re=function(e,n){return oe(e,n)?w.from(e[n]):w.none()},oe=function(e,n){return $.call(e,n)},ue=function(t){return{is:function(e){return t===e},isValue:d,isError:a,getOr:v(t),getOrThunk:v(t),getOrDie:v(t),or:function(e){return ue(t)},orThunk:function(e){return ue(t)},fold:function(e,n){return n(t)},map:function(e){return ue(e(t))},mapError:function(e){return ue(t)},each:function(e){e(t)},bind:function(e){return e(t)},exists:function(e){return e(t)},forall:function(e){return e(t)},toOption:function(){return w.some(t)}}},ie=function(t){return{is:a,isValue:a,isError:d,getOr:s,getOrThunk:function(e){return e()},getOrDie:function(){return e=String(t),function(){throw new Error(e)}();var e},or:function(e){return e},orThunk:function(e){return e()},fold:function(e,n){return e(t)},map:function(e){return ie(t)},mapError:function(e){return ie(e(t))},each:c,bind:function(e){return ie(t)},exists:a,forall:d,toOption:w.none}},ae={value:ue,error:ie,fromOption:function(e,n){return e.fold(function(){return ie(n)},ue)}},fe=function(u){return T({},u,{toCached:function(){return fe(u.toCached())},bindFuture:function(n){return fe(u.bind(function(e){return e.fold(function(e){return Y.pure(ae.error(e))},function(e){return n(e)})}))},bindResult:function(n){return fe(u.map(function(e){return e.bind(n)}))},mapResult:function(n){return fe(u.map(function(e){return e.map(n)}))},mapError:function(n){return fe(u.map(function(e){return e.mapError(n)}))},foldResult:function(n,t){return u.map(function(e){return e.fold(n,t)})},withTimeout:function(e,o){return fe(Y.nu(function(n){var t=!1,r=l.setTimeout(function(){t=!0,n(ae.error(o()))},e);u.get(function(e){t||(l.clearTimeout(r),n(e))})}))}})},ce=function(e){return fe(Y.nu(e))},se=function(e){return fe(Y.pure(ae.value(e)))},le={nu:ce,wrap:fe,pure:se,value:se,error:function(e){return fe(Y.pure(ae.error(e)))},fromResult:function(e){return fe(Y.pure(e))},fromFuture:function(e){return fe(e.map(ae.value))},fromPromise:function(e){return ce(function(n){e.then(function(e){n(ae.value(e))},function(e){n(ae.error(e))})})}},de=void 0!==l.window?l.window:Function("return this;")(),pe=function(){return re(de,"tinymce").or(re(de,"tinydrive")).getOrThunk(function(){var e={};return de.tinydrive=e})},me=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:v(e)}},he={fromHtml:function(e,n){var t=(n||l.document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw l.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return me(t.childNodes[0])},fromTag:function(e,n){var t=(n||l.document).createElement(e);return me(t)},fromText:function(e,n){var t=(n||l.document).createTextNode(e);return me(t)},fromDom:me,fromPoint:function(e,n,t){var r=e.dom();return w.from(r.elementFromPoint(n,t)).map(me)}},ve=function(e,n){return function(e,n){for(var t=null!=n?n:de,r=0;r<e.length&&null!=t;++r)t=t[e[r]];return t}(e.split("."),n)},ge={getOrDie:function(e,n){var t=ve(e,n);if(null==t)throw e+" not available on this browser";return t}},ye=function(){return ge.getOrDie("Node")},be=function(e,n,t){return 0!=(e.compareDocumentPosition(n)&t)},we=function(e,n){return be(e,n,ye().DOCUMENT_POSITION_CONTAINED_BY)},Te=function(t){var r,o=!1;return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return o||(o=!0,r=t.apply(null,e)),r}},Oe=function(){return _e(0,0)},_e=function(e,n){return{major:e,minor:n}},Ee={nu:_e,detect:function(e,n){var t=String(n).toLowerCase();return 0===e.length?Oe():function(e,n){var t=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}}(e,n);if(!t)return{major:0,minor:0};var r=function(e){return Number(n.replace(t,"$"+e))};return _e(r(1),r(2))}(e,t)},unknown:Oe},Fe="Firefox",Se=function(e,n){return function(){return n===e}},xe=function(e){var n=e.current;return{current:n,version:e.version,isEdge:Se("Edge",n),isChrome:Se("Chrome",n),isIE:Se("IE",n),isOpera:Se("Opera",n),isFirefox:Se(Fe,n),isSafari:Se("Safari",n)}},De={unknown:function(){return xe({current:void 0,version:Ee.unknown()})},nu:xe,edge:v("Edge"),chrome:v("Chrome"),ie:v("IE"),opera:v("Opera"),firefox:v(Fe),safari:v("Safari")},Ie="Windows",Re="Android",Ne="Solaris",Ae="FreeBSD",je=function(e,n){return function(){return n===e}},Ue=function(e){var n=e.current;return{current:n,version:e.version,isWindows:je(Ie,n),isiOS:je("iOS",n),isAndroid:je(Re,n),isOSX:je("OSX",n),isLinux:je("Linux",n),isSolaris:je(Ne,n),isFreeBSD:je(Ae,n)}},Ce={unknown:function(){return Ue({current:void 0,version:Ee.unknown()})},nu:Ue,windows:v(Ie),ios:v("iOS"),android:v(Re),linux:v("Linux"),osx:v("OSX"),solaris:v(Ne),freebsd:v(Ae)},ke=function(e,n){var t=String(n).toLowerCase();return L(e,function(e){return e.search(t)})},Le=function(e,t){return ke(e,t).map(function(e){var n=Ee.detect(e.versionRegexes,t);return{current:e.name,version:n}})},Me=function(e,t){return ke(e,t).map(function(e){var n=Ee.detect(e.versionRegexes,t);return{current:e.name,version:n}})},Pe=function(e,n){return-1!==e.indexOf(n)},Be=function(e,n){return t=e,o=0,""===(r=n)||!(t.length<r.length)&&t.substr(o,o+r.length)===r;var t,r,o},Ge=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,He=function(n){return function(e){return Pe(e,n)}},ze=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return Pe(e,"edge/")&&Pe(e,"chrome")&&Pe(e,"safari")&&Pe(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Ge],search:function(e){return Pe(e,"chrome")&&!Pe(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return Pe(e,"msie")||Pe(e,"trident")}},{name:"Opera",versionRegexes:[Ge,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:He("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:He("firefox")},{name:"Safari",versionRegexes:[Ge,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(Pe(e,"safari")||Pe(e,"mobile/"))&&Pe(e,"applewebkit")}}],qe=[{name:"Windows",search:He("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return Pe(e,"iphone")||Pe(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:He("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:He("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:He("linux"),versionRegexes:[]},{name:"Solaris",search:He("sunos"),versionRegexes:[]},{name:"FreeBSD",search:He("freebsd"),versionRegexes:[]}],Je={browsers:v(ze),oses:v(qe)},Ve=function(e){var n,t,r,o,u,i,a,f,c,s,l,d=Je.browsers(),p=Je.oses(),m=Le(d,e).fold(De.unknown,De.nu),h=Me(p,e).fold(Ce.unknown,Ce.nu);return{browser:m,os:h,deviceType:(t=m,r=e,o=(n=h).isiOS()&&!0===/ipad/i.test(r),u=n.isiOS()&&!o,i=n.isAndroid()&&3===n.version.major,a=n.isAndroid()&&4===n.version.major,f=o||i||a&&!0===/mobile/i.test(r),c=n.isiOS()||n.isAndroid(),s=c&&!f,l=t.isSafari()&&n.isiOS()&&!1===/safari/i.test(r),{isiPad:v(o),isiPhone:v(u),isTablet:v(f),isPhone:v(s),isTouch:v(c),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:v(l)})}},We={detect:Te(function(){var e=l.navigator.userAgent;return Ve(e)})},Ye=(l.Node.ATTRIBUTE_NODE,l.Node.CDATA_SECTION_NODE,l.Node.COMMENT_NODE,l.Node.DOCUMENT_NODE,l.Node.DOCUMENT_TYPE_NODE,l.Node.DOCUMENT_FRAGMENT_NODE,l.Node.ELEMENT_NODE,l.Node.TEXT_NODE,l.Node.PROCESSING_INSTRUCTION_NODE,l.Node.ENTITY_REFERENCE_NODE,l.Node.ENTITY_NODE,l.Node.NOTATION_NODE,We.detect().browser.isIE(),function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n]}("element","offset"),function(e,n){e.dom().appendChild(n.dom())}),Ke=Te(function(){return Xe(he.fromDom(l.document))}),Xe=function(e){var n=e.dom().body;if(null==n)throw new Error("Body is not available yet");return he.fromDom(n)},$e=function(e,n){var t=e.dom();Z(n,function(e,n){!function(e,n,t){if(!(_(t)||S(t)||D(t)))throw l.console.error("Invalid call to Attr.set. Key ",n,":: Value ",t,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(n,t+"")}(t,n,e)})},Ze=function(p,m){return function(e){if(p(e)){var n,t,r,o,u,i,a,f=he.fromDom(e.target),c=function(){e.stopPropagation()},s=function(){e.preventDefault()},l=h(s,c),d=(n=f,t=e.clientX,r=e.clientY,o=c,u=s,i=l,a=e,{target:v(n),x:v(t),y:v(r),stop:o,prevent:u,kill:i,raw:v(a)});m(d)}}},Qe=function(e,n,t,r){return o=e,u=n,i=!1,a=Ze(t,r),o.dom().addEventListener(u,a,i),{unbind:function(r){for(var o=[],e=1;e<arguments.length;e++)o[e-1]=arguments[e];return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=o.concat(e);return r.apply(null,t)}}(en,o,u,a,i)};var o,u,i,a},en=function(e,n,t,r){e.dom().removeEventListener(n,t,r)},nn=v(!0),tn=function(e,n,t){return Qe(e,n,nn,t)},rn="_assetManagerProvider",on="_assetManagerLazy",un=le.nu(function(e){pe()[rn]=e}),an=function(e){var n=C(e,function(e){return e.isError()});return 0<n.length?n[0]:e[0]},fn=function(u){var i=pe();return re(i,on).getOrThunk(function(){var e,t,r,o,n=(e=[un,(o=u.css,le.nu(function(e){var n=he.fromTag("link");$e(n,{rel:"stylesheet",href:o}),tn(n,"load",function(){e(ae.value(n))}),tn(n,"error",function(){e(ae.error("Failed to load css: "+o))}),Ye(he.fromDom(l.document.head),n)})),(t=u.js,r={},le.nu(function(e){var n=he.fromTag("script");$e(n,T({src:t},r)),tn(n,"load",function(){e(ae.value(n))}),tn(n,"error",function(){e(ae.error("Failed to load script: "+t))}),Ye(Ke(),n)})).mapError(function(e){return cn(e),e})],K(e,Y.nu)).map(an).toLazy();return i[on]=n})},cn=function(e){(0,pe()[rn])(ae.error(e))},sn=function(i){if(!F(i))throw new Error("cases must be an array");if(0===i.length)throw new Error("there must be at least one case");var a=[],t={};return U(i,function(e,r){var n=X(e);if(1!==n.length)throw new Error("one and only one name per case");var o=n[0],u=e[o];if(void 0!==t[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!F(u))throw new Error("case arguments must be an array");a.push(o),t[o]=function(){var e=arguments.length;if(e!==u.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+u.length+" ("+u+"), got "+e);for(var t=new Array(e),n=0;n<t.length;n++)t[n]=arguments[n];return{fold:function(){if(arguments.length!==i.length)throw new Error("Wrong number of arguments to fold. Expected "+i.length+", got "+arguments.length);return arguments[r].apply(null,t)},match:function(e){var n=X(e);if(a.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+a.join(",")+"\nActual: "+n.join(","));if(!function(e,n){for(var t=0,r=e.length;t<r;++t)if(!0!==n(e[t],t,e))return!1;return!0}(a,function(e){return N(n,e)}))throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+a.join(", "));return e[o].apply(null,t)},log:function(e){l.console.log(e,{constructors:a,constructor:o,params:t})}}}}),t},ln=Object.prototype.hasOwnProperty,dn=function(i){return function(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];if(0===e.length)throw new Error("Can't merge zero objects");for(var t={},r=0;r<e.length;r++){var o=e[r];for(var u in o)ln.call(o,u)&&(t[u]=i(t[u],o[u]))}return t}},pn=dn(function(e,n){return E(e)&&E(n)?pn(e,n):n}),mn=dn(function(e,n){return n}),hn=sn([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),vn=hn.strict,gn=hn.asOption,yn=function(e,n){return oe(t=e,r=n)?w.from(t[r]):w.none();var t,r},bn=function(e,n){var t={};return t[e]=n,t};sn([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);(i=u||(u={}))[i.Error=0]="Error",i[i.Value=1]="Value";var wn,Tn,On=function(e,n,t){return e.stype===u.Error?n(e.serror):t(e.svalue)},_n=function(e){return{stype:u.Value,svalue:e}},En=function(e){return{stype:u.Error,serror:e}},Fn=function(e){return On(e,ae.error,ae.value)},Sn=_n,xn=function(e){var n=[],t=[];return U(e,function(e){On(e,function(e){return t.push(e)},function(e){return n.push(e)})}),{values:n,errors:t}},Dn=En,In=function(e,n){return e.stype===u.Value?n(e.svalue):e},Rn=function(e,n){return e.stype===u.Error?n(e.serror):e},Nn=function(e,n){return e.stype===u.Value?{stype:u.Value,svalue:n(e.svalue)}:e},An=function(e,n){return e.stype===u.Error?{stype:u.Error,serror:n(e.serror)}:e},jn=function(e){return h(Dn,G)(e)},Un=function(e,n){var t,r,o=xn(e);return 0<o.errors.length?jn(o.errors):(t=o.values,r=n,0<t.length?Sn(pn(r,mn.apply(void 0,t))):Sn(r))},Cn=function(e){var n=xn(e);return 0<n.errors.length?jn(n.errors):Sn(n.values)},kn=sn([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),Ln=sn([{field:["name","presence","type"]},{state:["name"]}]),Mn=function(){return ge.getOrDie("JSON")},Pn=function(e,n,t){return Mn().stringify(e,n,t)},Bn=function(e){return E(e)&&100<X(e).length?" removed due to size":Pn(e,null,2)},Gn=function(e,n){return Dn([{path:e,getErrorInfo:n}])},Hn=sn([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),zn=function(t,r,o){return yn(r,o).fold(function(){return e=o,n=r,Gn(t,function(){return'Could not find valid *strict* value for "'+e+'" in '+Bn(n)});var e,n},Sn)},qn=function(e,n,t){var r=yn(e,n).fold(function(){return t(e)},s);return Sn(r)},Jn=function(a,f,e,c){return e.fold(function(o,t,e,r){var u=function(e){var n=r.extract(a.concat([o]),c,e);return Nn(n,function(e){return bn(t,c(e))})},i=function(e){return e.fold(function(){var e=bn(t,c(w.none()));return Sn(e)},function(e){var n=r.extract(a.concat([o]),c,e);return Nn(n,function(e){return bn(t,c(w.some(e)))})})};return e.fold(function(){return In(zn(a,f,o),u)},function(e){return In(qn(f,o,e),u)},function(){return In(Sn(yn(f,o)),i)},function(e){return In((t=e,r=yn(n=f,o).map(function(e){return!0===e?t(n):e}),Sn(r)),i);var n,t,r},function(e){var n=e(f),t=Nn(qn(f,o,v({})),function(e){return pn(n,e)});return In(t,u)})},function(e,n){var t=n(f);return Sn(bn(e,c(t)))})},Vn=function(r){return{extract:function(t,e,n){return Rn(r(n,e),function(e){return n=e,Gn(t,function(){return n});var n})},toString:function(){return"val"},toDsl:function(){return kn.itemOf(r)}}},Wn=function(a){return{extract:function(e,n,t){return r=e,o=t,u=n,i=j(a,function(e){return Jn(r,o,e,u)}),Un(i,{});var r,o,u,i},toString:function(){return"obj{\n"+j(a,function(e){return e.fold(function(e,n,t,r){return e+" -> "+r.toString()},function(e,n){return"state("+e+")"})}).join("\n")+"}"},toDsl:function(){return kn.objOf(j(a,function(e){return e.fold(function(e,n,t,r){return Ln.field(e,t,r)},function(e,n){return Ln.state(e)})}))}}},Yn=function(o){return{extract:function(t,r,e){var n=j(e,function(e,n){return o.extract(t.concat(["["+n+"]"]),r,e)});return Cn(n)},toString:function(){return"array("+o.toString()+")"},toDsl:function(){return kn.arrOf(o)}}},Kn=v(Vn(Sn)),Xn=Hn.field,$n=function(e,n,t){return Fn((r=e,o=s,u=t,i=n.extract([r],o,u),An(i,function(e){return{input:u,errors:e}})));var r,o,u,i},Zn=function(e){return"Errors: \n"+(n=e.errors,t=10<n.length?n.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):n,j(t,function(e){return"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()}))+"\n\nInput object: "+Bn(e.input);var n,t},Qn=function(t,r){return Vn(function(e){var n=typeof e;return t(e)?Sn(e):Dn("Expected type: "+r+" but got: "+n)})},et=Qn(D,"number"),nt=Qn(_,"string"),tt=Qn(S,"boolean"),rt=Qn(x,"function"),ot=function(e){return Xn(e,e,vn(),Kn())},ut=function(e,n){return Xn(e,e,vn(),n)},it=function(e){return ut(e,et)},at=function(e){return ut(e,nt)},ft=function(e){return ut(e,tt)},ct=function(e,n){return Xn(e,e,vn(),Yn(n))},st=function(e,n){return Xn(e,e,gn(),n)},lt=function(e){return st(e,nt)},dt=function(e,n,t){return Xn(e,e,(r=n,hn.defaultedThunk(v(r))),t);var r},pt=function(e,n,t){return $n(e,n,t.data)},mt=function(e){for(var n=[],t=function(e){n.push(e)},r=0;r<e.length;r++)e[r].each(t);return n},ht=function(e){return e.replace(/\\/g,"/")},vt=function(e,n){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var o=ht(e).replace(/\/$/,"")+"/"+ht(n).replace(/^\//,"");return k(t,vt,o)},gt=G(te({"image/gif":["gif"],"image/jpeg":["jpeg","jpg"],"image/png":["png"],"image/tiff":["tif","tiff"],"image/bmp":["bmp"]})),yt=G(te({"application/msword":["doc"],"application/vnd.ms-excel":["xls"],"application/vnd.ms-powerpoint":["ppt","pps"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/pdf":["pdf"],"application/rtf":["rtf"],"text/plain":["txt"],"application/x-iwork-keynote-sffkey":["key"],"application/x-iwork-pages-sffpages":["pages"],"application/x-iwork-numbers-sffnumbers":["numbers"]})),bt=G(te({"audio/wav":["wav","wave"],"audio/mpeg":["mp3"],"audio/ogg":["ogg","oga","ogx","ogm","spx","opus"]})),wt=G(te({"video/mp4":["mp4","m4v"],"video/ogg":["ogv"],"video/webm":["webm"],"video/quicktime":["mov"]})),Tt=G(te({"application/zip":["zip"]})),Ot=function(e){var n,t,r=(n=e,t=n.lastIndexOf("."),-1!==t?n.substr(t):"").substring(1).toLowerCase(),o=function(n,e){return L(e,function(e){return e===n}).isSome()};return o(r,gt)?w.some("image"):o(r,yt)?w.some("document"):o(r,bt)?w.some("audio"):o(r,wt)?w.some("video"):o(r,Tt)?w.some("archive"):w.none()},_t=function(e){switch(e){case"directory":return"directory";case"document":return"document";case"audio":return"audio";case"video":return"video";case"image":return"image";case"archive":return"archive"}},Et=function(e){switch(e){case"directory":return w.some("directory");case"document":return w.some("document");case"audio":return w.some("audio");case"video":return w.some("video");case"image":return w.some("image");case"archive":return w.some("archive");default:return w.none()}},Ft=Wn([at("id"),at("name"),it("size"),at("type"),at("mdate"),lt("url"),ct("thumbs",nt),ft("starred"),lt("path")]),St=function(e){return function(e,n){for(var t=[],r=0;r<e.length;r++){var o=e[r];if(!o.isSome())return w.none();t.push(o.getOrDie())}return w.some(n.apply(null,t))}([z(e.thumbs),e.url],function(e,n){return n+"-"+e})},xt=function(e){return{uuid:e.id,parentUuid:w.none(),name:e.name,size:e.size,type:(t=e.type,Et(t).getOr("document")),modificationDate:(n=e.mdate,w.from(/^([0-9]{4})\-([0-9]{2})\-([0-9]{2})T([0-9]{2})\:([0-9]{2})\:([0-9]{2})Z$/.exec(n)).map(function(e){var n=j(e.slice(1),function(e){return parseInt(e,10)});return new Date(Date.UTC(n[0],n[1]-1,n[2],n[3],n[4],n[5]))})).getOr(new Date),url:e.url,thumbUrl:St(e),starred:e.starred,path:e.path};var n,t},Dt=function(e,n,t,r){return{last:n,offset:t,files:j(e,xt)}},It=Wn([ft("last"),it("offset"),ct("files",Ft)]),Rt=function(e){return pt("fileListResult",It,e)},Nt=function(e,n){return Dt(n.files,n.last,n.offset)};(Tn=wn||(wn={})).JSON="json",Tn.Blob="blob",Tn.Text="text",Tn.FormData="formdata",Tn.MultipartFormData="multipart/form-data";var At,jt,Ut=function(e){return{type:wn.JSON,data:e}},Ct=function(e,n){var t,r,o,u,i=n,a=Q(e,function(e,n){return i[n](e)}),f=(t=a,r=function(e){return e.isSome()},o={},u={},Z(t,function(e,n){(r(e,n)?o:u)[n]=e}),{t:o,f:u}).t,c=Q(f,function(e){return e.fold(function(){return null},s)});return Ut(c)},kt=function(e){return Ct(e,{offset:w.some,parent:s,sortBy:s,sortOrder:s,query:s,fileTypes:w.some})},Lt=Wn([ut("file",Ft)]),Mt=Ut,Pt=Wn([ut("file",Ft)]),Bt=Wn([ct("ids",nt)]);(jt=At||(At={})).Thumbnail="thumbnail",jt.File="file";var Gt,Ht,zt=Ut;(Ht=Gt||(Gt={})).Thumbnail="thumbnail",Ht.File="file";var qt,Jt,Vt,Wt,Yt,Kt=function(e){return Ct(e,{fileType:w.some,parent:s,path:s,name:w.some,size:w.some})},Xt=Wn([ut("file",Ft)]),$t=Wn([at("uploadUrl"),at("blobUrl"),ct("formItems",Wn([at("name"),at("value")])),at("id")]),Zt=function(e){var n,t=k(e,function(e,n){return e[n.name]=n.value,e},{});return n=t,{type:wn.MultipartFormData,data:n}},Qt=function(e){return pt("create",$t,e)},er=Wn([ct("ids",nt)]),nr=Ut,tr=Wn([ct("ids",nt)]),rr=Ut,or=Wn([ct("ids",nt)]),ur=Wn([(qt="error",Jt=[lt("type"),lt("data"),at("message")],Xn(qt,qt,vn(),Wn(Jt)))]),ir=Wn([at("message")]),ar=function(e){return pt("error",ur,e).fold(function(){return pt("error",ir,e).map(function(e){return{error:{type:w.none(),data:w.none(),message:e.message}}})},function(e){return ae.value(e)})},fr=Wn([at("id")]),cr=Wn([at("id"),at("description"),lt("createdBy")]),sr=Wn([ct("id",nt)]),lr=Wn([ft("last"),it("offset"),ct("files",Ft)]),dr=function(e){try{var n=JSON.parse(e);return ae.value(n)}catch(e){return ae.error("Response was not JSON.")}},pr=function(n){return Y.nu(function(t){var e=new l.FileReader;e.onload=function(e){var n=e.target?e.target.result:new l.Blob([]);t(n)},e.readAsText(n)})},mr=function(e){return Y.pure(e.response)},hr=function(e,n){switch(e){case wn.JSON:return dr(n.response).fold(function(){return mr(n)},Y.pure);case wn.Blob:return t=n,w.from(t.response).map(pr).getOr(Y.pure("no response content"));case wn.Text:default:return mr(n)}var t},vr=function(e){var n,t=(n=e.body,w.from(n).bind(function(e){switch(e.type){case wn.JSON:return w.some("application/json");case wn.FormData:return w.some("application/x-www-form-urlencoded; charset=UTF-8");case wn.MultipartFormData:return w.none();case wn.Text:default:return w.some("text/plain")}})),r=!0===e.credentials?w.some(!0):w.none(),o=function(e){switch(e){case wn.Blob:return"application/octet-stream";case wn.JSON:return"application/json, text/javascript";case wn.Text:return"text/plain";default:return""}}(e.responseType)+", */*; q=0.01",u=void 0!==e.headers?e.headers:{};return{contentType:t,responseType:function(e){switch(e){case wn.JSON:return w.none();case wn.Blob:return w.some("blob");case wn.Text:return w.some("text");default:return w.none()}}(e.responseType),credentials:r,accept:o,headers:u,progress:x(e.progress)?w.some(e.progress):w.none()}},gr=function(e){var t=new l.FormData;return Z(e,function(e,n){t.append(n,e)}),t},yr=function(f){return le.nu(function(r){var o,u=new l.XMLHttpRequest;u.open(f.method,(o=f.url,w.from(f.query).map(function(e){var n=ne(e,function(e,n){return encodeURIComponent(n)+"="+encodeURIComponent(e)}),t=Pe(o,"?")?"&":"?";return 0<n.length?o+t+n.join("&"):o}).getOr(o)),!0);var t,e,n=vr(f);t=u,(e=n).contentType.each(function(e){return t.setRequestHeader("Content-Type",e)}),t.setRequestHeader("Accept",e.accept),e.credentials.each(function(e){return t.withCredentials=e}),e.responseType.each(function(e){return t.responseType=e}),e.progress.each(function(n){return t.upload.addEventListener("progress",function(e){return n(e.loaded,e.total)})}),Z(e.headers,function(e,n){return t.setRequestHeader(n,e)});var i,a=function(){var n,e,t;(n=f.url,e=f.responseType,t=u,hr(e,t).map(function(e){return{message:0===t.status?"Unknown HTTP error (possible cross-domain request)":"Could not load url "+n+": "+t.statusText,status:t.status,responseText:e}})).get(function(e){return r(ae.error(e))})};u.onerror=a,u.onload=function(){0!==u.status||Be(f.url,"file:")?u.status<100||400<=u.status?a():function(e,n){var t=function(){return le.pure(n.response)},r=function(e){return le.error({message:e,status:n.status,responseText:n.responseText})};switch(e){case wn.JSON:return dr(n.response).fold(r,le.pure);case wn.Blob:case wn.Text:return t();default:return r("unknown data type")}}(f.responseType,u).get(r):a()},(i=f.body,w.from(i).map(function(e){return e.type===wn.JSON?JSON.stringify(e.data):e.type===wn.FormData?gr(e.data):e.type===wn.MultipartFormData?gr(e.data):e})).fold(function(){return u.send()},function(e){u.send(e)})})},br=function(){return e="",{type:wn.Text,data:e};var e},wr=function(e){return yr(T({},e,{method:"post"}))},Tr=function(n,o){return(e=o,e(!1)).bindFuture(function(e){return n(e).bind(function(e){return e.fold((t=o,r=n,function(e){return 401===e.status?(n=t,n(!0)).bindFuture(r):le.error(e);var n}),le.pure);var t,r})});var e},Or=function(o,e){return Tr(function(e){return wr(T({},o,{headers:(n=o.headers,t=e,r={Authorization:"Bearer "+t},n?T({},n,r):r)}));var n,t,r},e)},_r=function(n){return ar(Ut(n.responseText)).fold(function(e){return{type:"",message:"Error: "+n.message+" ("+n.status+")"}},function(e){return{type:"",message:e.error.message}})},Er=function(e,n,t){var r,o,u=Or({url:(r=e,o=n,vt(r.restApiEndpoint,"/1",o)+"?apiKey="+encodeURIComponent(r.apiKey)),body:t,responseType:wn.JSON},e.jwtTokenFactory);return le.wrap(u.foldResult(function(e){return ae.error(_r(e))},function(e){return ae.value(Ut(e))}))},Fr=function(e){return j(e,_t)},Sr=function(e,n,t){return Er(e,"client/files/stars",(r={offset:n.offset,sortBy:w.some(n.sortBy),sortOrder:w.some(n.sortOrder),query:n.query,fileTypes:Fr(n.fileTypes)},Ct(r,{offset:w.some,sortBy:s,sortOrder:s,query:s,fileTypes:w.some}))).bindResult(function(e){return(n=e,pt("starsResult",lr,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value((w.none(),Dt((n=e).files,n.last,n.offset)));var n});var n});var r},xr=function(e,n,t){return Er(e,"client/files/mkdir",(r={parent:n,name:t},Ct(r,{parent:s,name:w.some}))).bindResult(function(e){return(n=e,pt("mkdir",Lt,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(e.file.id)});var n});var r},Dr=function(e,t,n){return Er(e,"client/files/rename",Mt({id:t,name:n})).bindResult(function(e){return(n=e,pt("rename",Pt,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(t)});var n})},Ir=function(e,t){return Er(e,"client/files/delete",(n={ids:t},Ct(n,{ids:w.some}))).bindResult(function(e){return(n=e,pt("remove",Bt,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(t)});var n});var n},Rr=function(e,n,t){return Er(e,"client/files/commit",zt({id:n,type:t})).bindResult(function(e){return(n=e,pt("commit",Xt,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(e)});var n})},Nr=function(e,n,t,r,o){return Er(e,"client/files/create",Kt({fileType:n,parent:t,path:w.none(),name:r,size:o})).bindResult(function(e){return Qt(e).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(e)})})},Ar=function(e,t,r,n,o){var u=Zt(t.formItems);u.data.file=n;var i=wr({url:t.uploadUrl,body:u,responseType:wn.Text,progress:function(e,n){return o({loaded:e,total:n,name:r,uuid:t.id})}});return le.wrap(i.foldResult(function(e){return ae.error(_r(e))},function(e){return ae.value(t.id)}))},jr=function(n,t,r,o,e){return(u=n,i=Gt.File,a=e,f=r,c=t.size,Er(u,"client/files/create",Kt({fileType:i,parent:w.none(),path:w.some(a),name:f,size:c})).bindResult(function(e){return Qt(e).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(e)})})).bindFuture(function(e){return Ar(0,e,r,t,o).bindFuture(function(e){return Rr(n,e,At.File)}).mapResult(function(e){return xt(e.file)})});var u,i,a,f,c},Ur=function(i,e,a){return function(u){return e.fold(function(){return le.value(u)},function(e){return(n=i,t=e,r=a,o=u.uuid,Nr(n,Gt.Thumbnail,w.from(o),r,t.size).bindFuture(function(e){return Ar(0,e,r,t,c)}).bindFuture(function(e){return Rr(n,e,At.Thumbnail)}).mapResult(function(e){return e.file.id})).bindResult(function(e){return ae.value(u)});var n,t,r,o})}},Cr=function(e,t,n){return Er(e,"client/files/move",(r={ids:t,parent:n},Ct(r,{parent:s,ids:w.some}))).bindResult(function(e){return(n=e,pt("move",er,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(t)});var n});var r},kr=function(e,t,n){return Er(e,"client/files/copy",(r={id:t,parent:n},Ct(r,{parent:s,id:w.some}))).bindResult(function(e){return(n=e,pt("copy",sr,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(t)});var n});var r},Lr=function(e,t){return Er(e,"client/files/star",nr({ids:t})).bindResult(function(e){return(n=e,pt("star",tr,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(t)});var n})},Mr=function(e,t){return Er(e,"client/files/unstar",rr({ids:t})).bindResult(function(e){return(n=e,pt("unstar",or,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(t)});var n})},Pr=function(e,t,n){return Er(e,"client/files/setMeta",(r={id:t,description:n.description},Ct(r,{id:w.some,description:w.some}))).bindResult(function(e){return(n=e,pt("setFileMeta",fr,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(t)});var n});var r},Br=function(e,n){return Er(e,"client/files/getMeta",(t={id:n},Ct(t,{id:w.some}))).bindResult(function(e){return(n=e,pt("getFileMeta",cr,n)).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value({description:e.description,createdBy:e.createdBy})});var n});var t},Gr=function(i){return{rename:function(e,n){return Dr(i,e,n)},mkdir:function(e,n){return xr(i,w.from(n),e)},upload:function(e){return(n=i,t=e.blob,r=e.name,o=e.progress,u=e.parent,Nr(n,Gt.File,u,r,t.size).bindFuture(function(e){return Ar(0,e,r,t,o).bindFuture(function(e){return Rr(n,e,At.File)}).mapResult(function(e){return xt(e.file)})})).bindFuture(Ur(i,e.thumbBlob,e.name));var n,t,r,o,u},list:function(e){return Er(i,"client/files/list",kt({offset:(n=e).offset,parent:n.parentUuid,sortBy:w.some(n.sortBy),sortOrder:w.some(n.sortOrder),query:n.query,fileTypes:Fr(n.fileTypes)})).bindResult(function(e){return Rt(e).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(Nt(w.none(),e))})});var n},listStarred:function(e){return Sr(i,e)},search:function(e){return Er(i,"client/files/search",kt({offset:(n=e).offset,parent:w.none(),sortBy:w.some(n.sortBy),sortOrder:w.some(n.sortOrder),query:n.query,fileTypes:Fr(n.fileTypes)})).bindResult(function(e){return Rt(e).fold(function(e){return ae.error({type:"",message:"Could not decode http json response"})},function(e){return ae.value(Nt(w.none(),e))})});var n},remove:function(e){return Ir(i,e)},copy:function(e,n){return kr(i,e,w.from(n))},move:function(e,n){return Cr(i,e,w.from(n))},star:function(e){return Lr(i,e)},unstar:function(e){return Mr(i,e)},setMeta:function(e,n){return Pr(i,e,n)},getMeta:function(e){return Br(i,e)},uploadToPath:function(e){return jr(i,e.blob,e.name,e.progress,e.path).bindFuture(Ur(i,e.thumbBlob,e.name))}}},Hr=function(e,o,u){return e.sort(function(e,n){if("name"===o)return"desc"===u?n.name.localeCompare(e.name):e.name.localeCompare(n.name);if("size"===o)return"desc"===u?n.size-e.size:e.size-n.size;var t=e.modificationDate.getTime(),r=n.modificationDate.getTime();return"desc"===u?r-t:t-r})},zr=function(e,n,t){var r=function(e,n){for(var t=[],r=[],o=0,u=e.length;o<u;o++){var i=e[o];(n(i,o,e)?t:r).push(i)}return{pass:t,fail:r}}(e,function(e){return"directory"===e.type});return Hr(r.pass,n,t).concat(Hr(r.fail,n,t))},qr=function(e){return{type:"",message:e}},Jr=function(e){return{type:"",message:e.message}},Vr=function(e){return(n=e,w.from(/^([0-9]{4})\-([0-9]{2})\-([0-9]{2}) ([0-9]{2})\:([0-9]{2})\:([0-9]{2})$/.exec(n))).map(function(e){var n=Date.parse(e[1]+"-"+e[2]+"-"+e[3]+"T"+e[4]+":"+e[5]+":"+e[6]+"Z");return new Date(n)});var n},Wr={},Yr={exports:Wr};Wt=Wr,Yt=Yr,Vt=void 0,function(e){"object"==typeof Wt&&void 0!==Yt?Yt.exports=e():"function"==typeof Vt&&Vt.amd?Vt([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=e()}(function(){return function u(i,a,f){function c(n,e){if(!a[n]){if(!i[n]){var t=!1;if(!e&&t)return t(n,!0);if(s)return s(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var o=a[n]={exports:{}};i[n][0].call(o.exports,function(e){return c(i[n][1][e]||e)},o,o.exports,u,i,a,f)}return a[n].exports}for(var s=!1,e=0;e<f.length;e++)c(f[e]);return c}({1:[function(e,n,t){var r,o,u=n.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function f(n){if(r===setTimeout)return setTimeout(n,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(n,0);try{return r(n,0)}catch(e){try{return r.call(null,n,0)}catch(e){return r.call(this,n,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var c,s=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?s=c.concat(s):d=-1,s.length&&m())}function m(){if(!l){var e=f(p);l=!0;for(var n=s.length;n;){for(c=s,s=[];++d<n;)c&&c[d].run();d=-1,n=s.length}c=null,l=!1,function(n){if(o===clearTimeout)return clearTimeout(n);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(n);try{o(n)}catch(e){try{return o.call(null,n)}catch(e){return o.call(this,n)}}}(e)}}function h(e,n){this.fun=e,this.array=n}function v(){}u.nextTick=function(e){var n=new Array(arguments.length-1);if(1<arguments.length)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];s.push(new h(e,n)),1!==s.length||l||f(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=v,u.addListener=v,u.once=v,u.off=v,u.removeListener=v,u.removeAllListeners=v,u.emit=v,u.prependListener=v,u.prependOnceListener=v,u.listeners=function(e){return[]},u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],2:[function(e,l,n){(function(t){!function(e){var n=setTimeout;function r(){}function u(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(e,this)}function o(t,r){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,u._immediateFn(function(){var e=1===t._state?r.onFulfilled:r.onRejected;if(null!==e){var n;try{n=e(t._value)}catch(e){return void a(r.promise,e)}i(r.promise,n)}else(1===t._state?i:a)(r.promise,t._value)})):t._deferreds.push(r)}function i(n,e){try{if(e===n)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if(e instanceof u)return n._state=3,n._value=e,void f(n);if("function"==typeof t)return void s((r=t,o=e,function(){r.apply(o,arguments)}),n)}n._state=1,n._value=e,f(n)}catch(e){a(n,e)}var r,o}function a(e,n){e._state=2,e._value=n,f(e)}function f(e){2===e._state&&0===e._deferreds.length&&u._immediateFn(function(){e._handled||u._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;n<t;n++)o(e,e._deferreds[n]);e._deferreds=null}function c(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}function s(e,n){var t=!1;try{e(function(e){t||(t=!0,i(n,e))},function(e){t||(t=!0,a(n,e))})}catch(e){if(t)return;t=!0,a(n,e)}}u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,n){var t=new this.constructor(r);return o(this,new c(e,n,t)),t},u.all=function(e){var a=Array.prototype.slice.call(e);return new u(function(r,o){if(0===a.length)return r([]);var u=a.length;function i(n,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void t.call(e,function(e){i(n,e)},o)}a[n]=e,0==--u&&r(a)}catch(e){o(e)}}for(var e=0;e<a.length;e++)i(e,a[e])})},u.resolve=function(n){return n&&"object"==typeof n&&n.constructor===u?n:new u(function(e){e(n)})},u.reject=function(t){return new u(function(e,n){n(t)})},u.race=function(o){return new u(function(e,n){for(var t=0,r=o.length;t<r;t++)o[t].then(e,n)})},u._immediateFn="function"==typeof t?function(e){t(e)}:function(e){n(e,0)},u._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},u._setImmediateFn=function(e){u._immediateFn=e},u._setUnhandledRejectionFn=function(e){u._unhandledRejectionFn=e},void 0!==l&&l.exports?l.exports=u:e.Promise||(e.Promise=u)}(this)}).call(this,e("timers").setImmediate)},{timers:3}],3:[function(f,e,c){(function(e,n){var r=f("process/browser.js").nextTick,t=Function.prototype.apply,o=Array.prototype.slice,u={},i=0;function a(e,n){this._id=e,this._clearFn=n}c.setTimeout=function(){return new a(t.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new a(t.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(e){e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(e,n){clearTimeout(e._idleTimeoutId),e._idleTimeout=n},c.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},c._unrefActive=c.active=function(e){clearTimeout(e._idleTimeoutId);var n=e._idleTimeout;0<=n&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},n))},c.setImmediate="function"==typeof e?e:function(e){var n=i++,t=!(arguments.length<2)&&o.call(arguments,1);return u[n]=!0,r(function(){u[n]&&(t?e.apply(null,t):e.call(null),c.clearImmediate(n))}),n},c.clearImmediate="function"==typeof n?n:function(e){delete u[e]}}).call(this,f("timers").setImmediate,f("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(e,n,t){var r=e("promise-polyfill"),o="undefined"!=typeof window?window:Function("return this;")();n.exports={boltExport:o.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)});var Kr,Xr,$r,Zr,Qr,eo,no,to,ro,oo,uo,io=Yr.exports.boltExport,ao=function(e){return le.nu(function(n){e().then(function(e){return n(ae.value(e))}).catch(function(e){return n(ae.error(e))})})},fo=function(e){return new io(function(n,t){e.get(function(e){e.fold(function(e){return t(e)},n)})})},co=function(e){return w.from(e.split(".")[1]).map(function(e){return JSON.parse(l.window.atob(e))})},so=0,lo=function(){return e="file",n=(new Date).getTime(),e+"_"+Math.floor(1e9*Math.random())+ ++so+String(n);var e,n},po=function(n,t){var e,r,o;return(e=n.files,r=n.parentUuid,o=t,L(e,function(t){return r.fold(function(){return t.parentUuid.isNone()&&t.name===o},function(n){return t.parentUuid.exists(function(e){return e===n&&t.name===o})})})).fold(function(){var e={uuid:lo(),type:"directory",parentUuid:n.parentUuid,name:t,size:0,modificationDate:new Date,url:w.none(),thumbUrl:w.none(),starred:!1,path:w.none()};return{files:n.files.concat([e]),parentUuid:w.some(e.uuid)}},function(e){return{files:n.files,parentUuid:w.some(e.uuid)}})},mo=function(e,n){return k(C(n.split("/"),function(e){return 0<e.length}),po,{files:e,parentUuid:w.none()})},ho=Wn([at("name"),at("sub"),lt("root"),Xn("https://claims.tiny.cloud/drive/root","root",gn(),nt)]),vo=function(e,n){e.set(mn(e.get(),{files:n}))},go=function(e,n){e.set(mn(e.get(),{meta:mn(e.get().meta,n)}))},yo=function(h,e){var n,v={},r=k(e,function(e,n){var t,r,o,u,i,a,f,c,s=D(n.size)?Ot(n.name).getOr("document"):"directory",l=n.size?n.size:0,d=_(n.date)?Vr(n.date).getOr(new Date):new Date,p=n.uuid?n.uuid:lo(),m={uuid:p,type:s,parentUuid:w.from(n.parentUuid),name:n.name,size:l,modificationDate:d,url:w.from(n.url),thumbUrl:w.from(n.thumbUrl),starred:!0===n.starred,path:w.none()};return v[p]=(r=h,o=(t=n).meta?t.meta:{},u=w.from(o.createdBy).orThunk(function(){return co(r).map(function(e){return e.name})}),{description:o.description?o.description:"",createdBy:u}),i=e,a=n.path,f=m,(c=mo(i,a)).files.concat([mn(f,{parentUuid:c.parentUuid})])},[]),o=(n=h,co(n).bind(function(e){return $n("claims",ho,e).toOption()})).getOr({name:"",sub:"",root:w.none()});return o.root.fold(function(){return{files:r,meta:v,claims:o,rootUuid:w.none()}},function(e){var n=mo(r,e),t=n.parentUuid;return{files:n.files,meta:v,claims:o,rootUuid:t}})},bo=function(e,r){var o=f({files:[],meta:{},claims:{name:"",sub:"",root:w.none()},rootUuid:w.none()});return function(){return e.jwtTokenFactory(!1).bindFuture((t=e.requestDelay,function(n){return Y.nu(function(e){setTimeout(function(){e(ae.value(n))},t)})})).mapError(Jr).bindFuture(function(n){return r.mapResult(function(e){return 0<o.get().files.length||o.set(yo(n,e)),o})});var t}},wo=function(e,n){return e.parentUuid.bind(function(e){return To(e,n)})},To=function(n,e){return L(e,function(e){return e.uuid===n})},Oo=function(e,n){return mn(e,{path:n})},_o=function(e,n){return Oo(e,w.some(function(e,n){for(var t=[],r=wo(e,n);r.isSome();r=r.bind(function(e){return wo(e,n)}))r.each(function(e){return t.push(e)});return"/"+j(t.reverse(),function(e){return e.name}).concat([e.name]).join("/")}(e,n)))},Eo=function(e,n){return e.query.fold(v(!0),function(e){return-1!==n.name.toLowerCase().indexOf(e.toLowerCase())})},Fo=function(e,n){return 0===e.fileTypes.length||A(e.fileTypes,function(e){return e===n.type})},So=function(i,a,f,c,e){return le.nu(function(o){var u=e.or(i.get().rootUuid);Ot(f).fold(function(){return o(ae.error({type:"",message:'Invalid file extension for "'+f+'"'}))},function(e){var n,t=lo(),r={uuid:t,type:e,parentUuid:u,name:f,size:a.size,modificationDate:new Date,url:w.some(l.URL.createObjectURL(a)),thumbUrl:c.map(l.URL.createObjectURL),starred:!1,path:w.none()};go(i,((n={})[t]={description:"",createdBy:w.some(i.get().claims.name)},n)),vo(i,i.get().files.concat([r])),o(ae.value(r))})})},xo=function(a){return function(i){return le.nu(function(e){var t,r,n,o,u;t=function(e,n){var t=Math.round(i.size*(e/n));a({name:i.name,uuid:i.uuid,loaded:t,total:i.size})},r=function(){e(ae.value(i))},o=n=10,(u=function(e,n){setTimeout(function(){n<e?(t(n,e),u(e,n+1)):(t(n,e),r())},o)})(n,0)})}},Do=function(e,n){var t,r=mo(e.get().files,(t=n,e.get().claims.root.map(function(e){return vt(e,t.path)}).getOr(t.path)));return vo(e,r.files),So(e,n.blob,n.name,n.thumbBlob,r.parentUuid).bindFuture(xo(n.progress))},Io=function(f,e){var t,r,l=(t=bo(f,e),r=f,function(n){return t().mapResult(function(e){return r.log&&console.log("memfs:",n,e.get().claims),e})}),u=function(e,t,r){var n=w.from(e.get().meta[t]).fold(function(){var e;return(e={})[t]=r,e},function(e){var n;return(n={})[t]=mn(e,r),n});go(e,mn(e.get().meta,n))},c=function(e,n){return e.claims.root.map(function(t){return n.path.exists(function(e){return t===e||(n=t,0===vt(e,"/").indexOf(vt(n,"/")));var n})}).getOr(!0)},s=function(e,n){return j(e,function(e){return n.fold(v(e),function(u){return Oo(e,e.path.map(function(e){var n,t,r,o;return"/"+(Be(n=e,t=u+"/")?(r=n,o=t.length,r.substring(o)):n)}))})})};return{rename:function(o,u){return l("rename").bindFuture(function(r){return le.nu(function(n){var e,t;vo(r,j(r.get().files,function(e){return e.uuid===o?mn(e,{name:u}):e})),z((e=r.get().files,t=[o],C(e,function(e){return N(t,e.uuid)}))).fold(function(){return n(ae.error({type:"error",message:"File not found"}))},function(e){return n(ae.value(e.uuid))})})})},mkdir:function(c,s){return l("mkdir").bindFuture(function(f){return le.nu(function(e){var n,t,r,o,u,i=lo(),a={uuid:i,type:"directory",parentUuid:_(s)?(n=s,t=f,w.from(n).or(t.get().rootUuid)):w.none(),name:c,size:0,modificationDate:new Date,url:w.none(),thumbUrl:w.none(),starred:!1,path:w.none()};r=f.get().files,o=w.from(s),u=c,A(C(r,function(e){return o.fold(function(){return e.parentUuid.isNone()},function(n){return e.parentUuid.exists(function(e){return e===n})})}),function(e){return"directory"===e.type&&e.name===u})?e(ae.error({type:"x",message:"Directory already exists"})):(vo(f,f.get().files.concat([a])),e(ae.value(i)))})})},upload:function(t){return l("upload").bindFuture(function(e){return So(e,(n=t).blob,n.name,n.thumbBlob,n.parent).bindFuture(xo(n.progress));var n})},list:function(i){return l("list").bindFuture(function(u){return le.nu(function(e){var n=C(u.get().files,function(e){return n=i,t=e,r=u.get().rootUuid,n.parentUuid.fold(function(){return r.fold(function(){return t.parentUuid.isNone()},function(n){return t.parentUuid.exists(function(e){return e===n})})},function(n){return t.parentUuid.exists(function(e){return e===n})})&&Eo(i,e)&&Fo(i,e);var n,t,r}),t=zr(n,i.sortBy,i.sortOrder),r=t.slice(i.offset,i.offset+f.limit),o=i.offset+r.length;e(ae.value({last:o>=t.length,offset:o,files:r}))})})},listStarred:function(a){return l("listStarred").bindFuture(function(i){return le.nu(function(e){var n=i.get().claims.root,t=H(i.get().files,function(e){var n=_o(e,i.get().files);return c(i.get(),n)&&Eo(a,n)&&Fo(a,e)&&!0===n.starred?[n]:[]}),r=zr(t,a.sortBy,a.sortOrder),o=r.slice(a.offset,a.offset+f.limit),u=a.offset+o.length;e(ae.value({last:u>=r.length,offset:u,files:s(o,n)}))})})},search:function(a){return l("search").bindFuture(function(i){return le.nu(function(e){var n=i.get().claims.root,t=H(i.get().files,function(e){var n=_o(e,i.get().files);return c(i.get(),n)&&Eo(a,n)&&Fo(a,e)&&"directory"!==e.type?[n]:[]}),r=zr(t,a.sortBy,a.sortOrder),o=r.slice(a.offset,a.offset+f.limit),u=a.offset+o.length;e(ae.value({last:u>=r.length,offset:u,files:s(o,n)}))})})},remove:function(t){return l("remove").bindFuture(function(n){return le.nu(function(e){vo(n,H(n.get().files,function(e){return N(t,e.uuid)?[]:[e]})),e(ae.value(t))})})},copy:function(r,o){return l("copy").bindFuture(function(t){return le.nu(function(e){var n=lo();vo(t,H(t.get().files,function(e){return e.uuid===r?[e,mn(e,{uuid:n,parentUuid:w.from(o)})]:[e]})),t.get().meta[r]&&u(t,n,t.get().meta[r]),e(ae.value(n))})})},move:function(t,r){return l("move").bindFuture(function(n){return le.nu(function(e){vo(n,j(n.get().files,function(e){return N(t,e.uuid)?mn(e,{parentUuid:w.from(r)}):e})),e(ae.value(t))})})},star:function(t){return l("star").bindFuture(function(n){return le.nu(function(e){vo(n,j(n.get().files,function(e){return N(t,e.uuid)?mn(e,{starred:!0}):e})),e(ae.value(t))})})},unstar:function(t){return l("unstar").bindFuture(function(n){return le.nu(function(e){vo(n,j(n.get().files,function(e){return N(t,e.uuid)?mn(e,{starred:!1}):e})),e(ae.value(t))})})},setMeta:function(r,o){return l("setMeta").bindFuture(function(t){return le.nu(function(n){To(r,t.get().files).fold(function(){return n(ae.error({type:"error",message:"No file!!"}))},function(e){u(t,r,{description:o.description}),n(ae.value(e.uuid))})})})},getMeta:function(o){return l("getMeta").bindFuture(function(r){return le.nu(function(t){To(o,r.get().files).fold(function(){return t(ae.error({type:"error",message:"No file!!"}))},function(e){var n=r.get().meta[o];t(ae.value(n||{description:"",createdBy:w.none()}))})})})},uploadToPath:function(n){return l("uploadToPath").bindFuture(function(e){return Do(e,n)})}}},Ro=function(e,n){return n&&!/^https?:/.test(n)?vt(e,n):n},No=function(e,r){var n,t=le.wrap((n={url:r,responseType:wn.JSON},yr(T({},n,{method:"get",body:br()}))).map(function(e){return e.fold(function(e){return ae.error({type:"",message:"fs error"})},function(e){return ae.value((n=ht(r).replace(/\/[^\/]*\/?$/,""),t=e.files,j(t,function(e){return T({},e,{url:Ro(n,e.url),thumbUrl:Ro(n,e.thumbUrl)})})));var n,t})}));return Io(e,t.toCached())},Ao=function(u){var i=u.jwtTokenFactory;return u.demoFilesUrl.fold(function(){return u.demoFiles.fold(function(){return e=i,n=u.serviceUrl,t=u.apiKey,r=n.getOrDie("Failed to get service url"),o=t.getOrDie("Failed to get api key"),Gr({jwtTokenFactory:e,restApiEndpoint:r,apiKey:o});var e,n,t,r,o},function(e){return n=e,Io({jwtTokenFactory:i,requestDelay:0,log:!1,limit:30},le.pure(n));var n})},function(e){return No({jwtTokenFactory:i,requestDelay:0,log:!1,limit:30},e)})},jo=function(e,n,t){return ae.error({message:n,status:e,responseText:t})},Uo=function(r,o){return wr({url:r,responseType:wn.JSON,body:Ut({})}).bindResult(function(e){return _(e.token)?(t=e.token,o.set(w.some(t)),ae.value(t)):(n=r,o.set(w.none()),jo(500,'Jwt token provider: "'+n+'" did not return a "token" string property in it\'s JSON response body.',""));var n,t})},Co=function(e,t){return le.nu(function(n){e(function(e){t.set(w.some(e.token)),n(ae.value(e.token))},function(e){t.set(w.none()),n(jo(0,e,""))})})},ko=function(e){var n,t,r,o,u,i=f(w.none()),a=e.token_provider;return _(a)?(o=a,u=i,function(e){return e?Uo(o,u):u.get().fold(function(){return Uo(o,u)},function(e){return le.pure(e)})}):x(a)?(t=a,r=i,function(e){return e?Co(t,r):r.get().fold(function(){return Co(t,r)},function(e){return le.pure(e)})}):(n='Required "tinydrive_token_provider" setting not defined.',function(e){return le.fromResult(jo(0,n,""))})},Lo=function(t,r){return t.get().getOrThunk(function(){var e,n=Ao({demoFilesUrl:(e=r).demo_files_url,demoFiles:e.demo_files,jwtTokenFactory:ko(e),serviceUrl:e.service_url,apiKey:e.api_key});return t.set(w.some(n)),n})},Mo=function(e,n){var t=String(e);if(t.length<n)for(var r=0;r<n-t.length;r++)t="0"+t;return t},Po=function(e){return n="%Y-%m-%dT%H:%M:%SZ",a=e,t=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),r="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),o="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),u="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),i="January February March April May June July August September October November December".split(" "),n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=n.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+t.getFullYear())).replace("%m",Mo(t.getMonth()+1,2))).replace("%d",Mo(t.getDate(),2))).replace("%H",""+Mo(t.getHours(),2))).replace("%M",""+Mo(t.getMinutes(),2))).replace("%S",""+Mo(t.getSeconds(),2))).replace("%I",""+((t.getHours()+11)%12+1))).replace("%p",t.getHours()<12?"AM":"PM")).replace("%B",""+i[t.getMonth()])).replace("%b",""+u[t.getMonth()])).replace("%A",""+o[t.getDay()])).replace("%a",""+r[t.getDay()])).replace("%%","%");var n,t,r,o,u,i,a},Bo=function(e){var n=e.name,t=e.url,r=e.size,o=e.type,u=e.modificationDate;return t.map(function(e){return{name:n,url:e,size:r,type:_t(o),mdate:Po(u)}})},Go=[lt("api_key"),lt("demo_files_url"),(Kr="demo_files",Xn(Kr,Kr,gn(),Kn())),lt("service_url"),ot("token_provider")],Ho=Wn(Go.concat([(Qr="filetypes",eo=[],no=nt,dt(Qr,eo,Yn(no))),(Zr="max_image_dimension",st(Zr,et)),lt("dropbox_app_key"),lt("google_drive_key"),lt("google_drive_client_id"),(Xr="z_index",$r=65535,dt(Xr,$r,et)),lt("script_url"),lt("css_url"),lt("target")])),zo=Wn(Go.concat([(oo="path",uo="/",dt(oo,uo,nt)),at("name"),ot("blob"),(to="onprogress",ro=c,dt(to,ro,rt)),Xn("max_image_dimension","maxImageDimension",gn(),et)])),qo=function(e){return ee(e,function(e,n){return{k:n.replace(/^tinydrive_/,""),v:e}})},Jo=function(e){return{zIndex:e.z_index,fileTypes:(n=e.filetypes,t=mt(j(n,Et)),0<t.length?["directory"].concat(t):[]),maxImageDimension:e.max_image_dimension,dropboxAppKey:e.dropbox_app_key,googleDriveDeveloperKey:e.google_drive_key,googleDriveClientId:e.google_drive_client_id,target:e.target,insert:!0,close:!0,fullscreen:!0};var n,t},Vo=function(n,u,i,a){return function(o){return le.nu(function(t){var r=Lo(n,o),e=L(q(l.document.getElementsByTagName("script")),function(e){return/tinydrive.min.js/.test(e.src)}).map(function(e){return e.src.substring(0,e.src.lastIndexOf("/"))}).getOr("");fn({js:o.script_url.getOr(e+"/assetmanager.min.js"),css:o.css_url.getOr(e+"/assetmanager.min.css")}).get(function(e){e.fold(function(e){return t(ae.error(e))},function(e){var n=T({},Jo(o),{insert:u,close:i,fullscreen:a});e(r,n,function(e){t(ae.value({files:mt(j(e,Bo))}))})})})})}},Wo=function(e,n,t,r,o,u){return le.fromResult((i=T({},n.get().getOr({}),t),$n("standalone settings",Ho,qo(i)).mapError(Zn))).bindFuture(Vo(e,r,o,u));var i};function Yo(e,n){return $o(l.document.createElement("canvas"),e,n)}function Ko(e){var n=Yo(e.width,e.height);return Xo(n).drawImage(e,0,0),n}function Xo(e){return e.getContext("2d")}function $o(e,n,t){return e.width=n,e.height=t,e}function Zo(){return new(ge.getOrDie("FileReader"))}var Qo={atob:function(e){return ge.getOrDie("atob")(e)},requestAnimationFrame:function(e){ge.getOrDie("requestAnimationFrame")(e)}};function eu(e){return e.naturalWidth||e.width}function nu(e){return e.naturalHeight||e.height}var tu=window.Promise?window.Promise:function(){var u=function(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],s(e,t(o,this),t(a,this))},e=u.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(e){l.setTimeout(e,1)};function t(e,n){return function(){return e.apply(n,arguments)}}var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(t){var r=this;null!==this._state?e(function(){var e=r._state?t.onFulfilled:t.onRejected;if(null!==e){var n;try{n=e(r._value)}catch(e){return void t.reject(e)}t.resolve(n)}else(r._state?t.resolve:t.reject)(r._value)}):this._deferreds.push(t)}function o(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void s(t(n,e),t(o,this),t(a,this))}this._state=!0,this._value=e,f.call(this)}catch(e){a.call(this,e)}}function a(e){this._state=!1,this._value=e,f.call(this)}function f(){for(var e=0,n=this._deferreds;e<n.length;e++){var t=n[e];i.call(this,t)}this._deferreds=[]}function c(e,n,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r}function s(e,n,t){var r=!1;try{e(function(e){r||(r=!0,n(e))},function(e){r||(r=!0,t(e))})}catch(e){if(r)return;r=!0,t(e)}}return u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(t,r){var o=this;return new u(function(e,n){i.call(o,new c(t,r,e,n))})},u.all=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var a=Array.prototype.slice.call(1===e.length&&r(e[0])?e[0]:e);return new u(function(r,o){if(0===a.length)return r([]);var u=a.length;function i(n,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void t.call(e,function(e){i(n,e)},o)}a[n]=e,0==--u&&r(a)}catch(e){o(e)}}for(var e=0;e<a.length;e++)i(e,a[e])})},u.resolve=function(n){return n&&"object"==typeof n&&n.constructor===u?n:new u(function(e){e(n)})},u.reject=function(t){return new u(function(e,n){n(t)})},u.race=function(o){return new u(function(e,n){for(var t=0,r=o;t<r.length;t++)r[t].then(e,n)})},u}();function ru(a){return new tu(function(e,n){var t=l.URL.createObjectURL(a),r=new l.Image,o=function(){r.removeEventListener("load",u),r.removeEventListener("error",i)};function u(){o(),e(r)}function i(){o(),n("Unable to load data of type "+a.type+": "+t)}r.addEventListener("load",u),r.addEventListener("error",i),r.src=t,r.complete&&u()})}function ou(e){var n=e.split(","),t=/data:([^;]+)/.exec(n[0]);if(!t)return w.none();for(var r,o,u,i=t[1],a=n[1],f=Qo.atob(a),c=f.length,s=Math.ceil(c/1024),l=new Array(s),d=0;d<s;++d){for(var p=1024*d,m=Math.min(p+1024,c),h=new Array(m-p),v=p,g=0;v<m;++g,++v)h[g]=f[v].charCodeAt(0);l[d]=(r=h,new(ge.getOrDie("Uint8Array"))(r))}return w.some((o=l,u={type:i},new(ge.getOrDie("Blob"))(o,u)))}function uu(e,r,o){return r=r||"image/png",l.HTMLCanvasElement.prototype.toBlob?new tu(function(n,t){e.toBlob(function(e){e?n(e):t()},r,o)}):(t=e.toDataURL(r,o),new tu(function(e,n){ou(t).fold(function(){n("uri is not base64: "+t)},e)}));var t}function iu(e){return ru(e).then(function(e){var n;n=e,l.URL.revokeObjectURL(n.src);var t=Yo(eu(e),nu(e));return Xo(t).drawImage(e,0,0),t})}function au(e,n,t){var r=n.type;function o(r,o){return e.then(function(e){return t=o,n=(n=r)||"image/png",e.toDataURL(n,t);var n,t})}return{getType:v(r),toBlob:function(){return tu.resolve(n)},toDataURL:function(){return t},toBase64:function(){return t.split(",")[1]},toAdjustedBlob:function(n,t){return e.then(function(e){return uu(e,n,t)})},toAdjustedDataURL:o,toAdjustedBase64:function(e,n){return o(e,n).then(function(e){return e.split(",")[1]})},toCanvas:function(){return e.then(Ko)}}}function fu(n){return(t=n,new tu(function(e){var n=Zo();n.onloadend=function(){e(n.result)},n.readAsDataURL(t)})).then(function(e){return au(iu(n),n,e)});var t}function cu(n,e){return uu(n,e).then(function(e){return au(tu.resolve(n),e,n.toDataURL())})}var su=function(e){return fu(e)};function lu(e,n,t){var r=eu(e),o=nu(e),u=n/r,i=t/o,a=!1;(u<.5||2<u)&&(u=u<.5?.5:2,a=!0),(i<.5||2<i)&&(i=i<.5?.5:2,a=!0);var f,c,s,l=(f=e,c=u,s=i,new tu(function(e){var n=eu(f),t=nu(f),r=Math.floor(n*c),o=Math.floor(t*s),u=Yo(r,o),i=Xo(u);i.drawImage(f,0,0,n,t,0,0,r,o),e(u)}));return a?l.then(function(e){return lu(e,n,t)}):l}function du(n,t){return n.toCanvas().then(function(e){return function(e,n,t){var r=Yo(e.width,e.height),o=Xo(r),u=0,i=0;90!==(t=t<0?360+t:t)&&270!==t||$o(r,r.height,r.width);90!==t&&180!==t||(u=r.width);270!==t&&180!==t||(i=r.height);return o.translate(u,i),o.rotate(t*Math.PI/180),o.drawImage(e,0,0),cu(r,n)}(e,n.getType(),t)})}var pu,mu,hu,vu=function(){function e(e){this.littleEndian=!1,this._dv=new DataView(e)}return e.prototype.readByteAt=function(e){return this._dv.getUint8(e)},e.prototype.read=function(e,n){if(e+n>this.length())return null;for(var t=this.littleEndian?0:-8*(n-1),r=0,o=0;o<n;o++)r|=this.readByteAt(e+o)<<Math.abs(t+8*o);return r},e.prototype.BYTE=function(e){return this.read(e,1)},e.prototype.SHORT=function(e){return this.read(e,2)},e.prototype.LONG=function(e){return this.read(e,4)},e.prototype.SLONG=function(e){var n=this.read(e,4);return null===n?null:2147483647<n?n-4294967296:n},e.prototype.CHAR=function(e){var n=this.read(e,1);return null===n?"":String.fromCharCode(n)},e.prototype.STRING=function(e,n){return this.asArray("CHAR",e,n).join("")},e.prototype.SEGMENT=function(e,n){var t=this._dv.buffer;return void 0!==e&&void 0!==n?t.slice(e,e+n):void 0!==e?t.slice(e):t},e.prototype.asArray=function(e,n,t){for(var r=[],o=0;o<t;o++)r[o]=this[e](n+o);return r},e.prototype.length=function(){return this._dv?this._dv.byteLength:0},e}(),gu={274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},yu={36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},bu={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},wu={513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"},Tu={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},Ou=function(){function e(e){if(this._offsets={tiffHeader:10,IFD0:null,IFD1:null,exifIFD:null,gpsIFD:null},this._reader=new vu(e),this._idx=this._offsets.tiffHeader,65505!==this.SHORT(0)||"EXIF\0"!==this.STRING(4,5).toUpperCase())throw new Error("Exif data cannot be read or not available.");if(this._reader.littleEndian=18761===this.SHORT(this._idx),42!==this.SHORT(this._idx+=2))throw new Error("Invalid Exif data.");this._offsets.IFD0=this._offsets.tiffHeader+this.LONG(this._idx+=2),this._tiffTags=this.extractTags(this._offsets.IFD0,gu),"ExifIFDPointer"in this._tiffTags&&(this._offsets.exifIFD=this._offsets.tiffHeader+this._tiffTags.ExifIFDPointer,delete this._tiffTags.ExifIFDPointer),"GPSInfoIFDPointer"in this._tiffTags&&(this._offsets.gpsIFD=this._offsets.tiffHeader+this._tiffTags.GPSInfoIFDPointer,delete this._tiffTags.GPSInfoIFDPointer);var n=this.LONG(this._offsets.IFD0+12*this.SHORT(this._offsets.IFD0)+2);n&&(this._offsets.IFD1=this._offsets.tiffHeader+n)}return e.prototype.BYTE=function(e){return this._reader.BYTE(e)},e.prototype.SHORT=function(e){return this._reader.SHORT(e)},e.prototype.LONG=function(e){return this._reader.LONG(e)},e.prototype.SLONG=function(e){return this._reader.SLONG(e)},e.prototype.CHAR=function(e){return this._reader.CHAR(e)},e.prototype.STRING=function(e,n){return this._reader.STRING(e,n)},e.prototype.SEGMENT=function(e,n){return this._reader.SEGMENT(e,n)},e.prototype.asArray=function(e,n,t){for(var r=[],o=0;o<t;o++)r[o]=this[e](n+o);return r},e.prototype.length=function(){return this._reader.length()},e.prototype.UNDEFINED=function(e){return this.BYTE(e)},e.prototype.RATIONAL=function(e){return this.LONG(e)/this.LONG(e+4)},e.prototype.SRATIONAL=function(e){return this.SLONG(e)/this.SLONG(e+4)},e.prototype.ASCII=function(e){return this.CHAR(e)},e.prototype.TIFF=function(){return this._tiffTags},e.prototype.EXIF=function(){var e=null;if(this._offsets.exifIFD){try{e=this.extractTags(this._offsets.exifIFD,yu)}catch(e){return null}if(e.ExifVersion&&Array.isArray(e.ExifVersion)){for(var n="",t=0,r=e.ExifVersion;t<r.length;t++){var o=r[t];n+=String.fromCharCode(o)}e.ExifVersion=n}}return e},e.prototype.GPS=function(){var e=null;if(this._offsets.gpsIFD){try{e=this.extractTags(this._offsets.gpsIFD,bu)}catch(e){return null}e.GPSVersionID&&Array.isArray(e.GPSVersionID)&&(e.GPSVersionID=e.GPSVersionID.join("."))}return e},e.prototype.thumb=function(){var e=this;if(e._offsets.IFD1)try{var n=e.extractTags(e._offsets.IFD1,wu);if("JPEGInterchangeFormat"in n)return e.SEGMENT(e._offsets.tiffHeader+n.JPEGInterchangeFormat,n.JPEGInterchangeFormatLength)}catch(e){return null}return null},e.prototype.extractTags=function(e,n){var t=this,r={},o={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},u={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};if(e+2>t.length())return r;for(var i=t.SHORT(e),a=0;a<i;a++){var f=[],c=e+2+12*a,s=n[t.SHORT(c)];if(void 0!==s){var l=o[t.SHORT(c+=2)],d=t.LONG(c+=2),p=u[l];if(!p)throw new Error("Invalid Exif data.");if(c+=4,4<p*d&&(c=t.LONG(c)+t._offsets.tiffHeader),c+p*d>=t.length())throw new Error("Invalid Exif data.");if("ASCII"!==l){f=t.asArray(l,c,d);var m=1===d?f[0]:f;Tu.hasOwnProperty(s)&&"object"!=typeof m?r[s]=Tu[s][m]:r[s]=m}else r[s]=t.STRING(c,d).replace(/\0$/,"").trim()}}return r},e}(),_u=function(i){return(t=i,new tu(function(e){var n=Zo();n.onloadend=function(){e(n.result)},n.readAsArrayBuffer(t)})).then(function(e){try{var n=new vu(e);if(65496!==n.SHORT(0))return tu.reject("Image was not a jpeg");var t=Eu(n),r=t.filter(function(e){return"APP1"===e.name}),o={rawHeaders:t};if(!r.length)return tu.reject("Headers did not include required information");var u=new Ou(r[0].segment);return o.tiff=u.TIFF(),o.exif=u.EXIF(),o.gps=u.GPS(),o.thumb=u.thumb(),o}catch(e){return tu.reject("Unsupported format or not an image: "+i.type+" (Exception: "+e.message+")")}});var t},Eu=function(e){for(var n,t=[],r=2;r+2<=e.length();)if(65488<=(n=e.SHORT(r))&&n<=65495)r+=2;else{if(65498===n||65497===n)break;var o=e.SHORT(r+2)+2;65505<=n&&n<=65519&&t.push({hex:n,name:"APP"+(15&n),start:r,length:o,segment:e.SEGMENT(r,o)}),r+=o}return t},Fu=function(e,n,t){return o=n,u=t,(r=e).toCanvas().then(function(e){return lu(e,o,u).then(function(e){return cu(e,r.getType())})});var r,o,u},Su=function(e,n){return du(e,n)},xu=function(n){return n.toBlob().then(_u).then(function(e){switch(e.tiff.Orientation){case 6:return Su(n,90);case 3:return Su(n,180);case 8:return Su(n,270);default:return n}},function(){return n})},Du=function(n){return ao(function(){return(e=n,ru(e)).then(function(e){var n=e.naturalWidth,t=e.naturalHeight;return l.URL.revokeObjectURL(e.src),{width:n,height:t}});var e})},Iu=["image/jpeg","image/png","image/gif"],Ru=function(e,n){return Math.max(e.width/n.width,e.height/n.height)},Nu=function(u,i){return Du(u).bindFuture(function(e){return 1<Ru(e,i)?(n=u,o=Ru(r=e,i),t={width:Math.round(r.width/o),height:Math.round(r.height/o)},ao(function(){return su(n).then(function(e){return Fu(e,t.width,t.height)}).then(function(e){return e.toAdjustedBlob(n.type,9)})})):le.value(u);var n,t,r,o})},Au=function(e){return le.fromPromise(su(e).then(xu).then(function(e){return e.toBlob()}))},ju=function(e,n){return(t=e,r=n,r.map(function(e){return Nu(t,{width:e,height:e})}).getOr(le.pure(t)).bindFuture(Au).bindFuture(function(n){return Nu(n,{width:512,height:512}).mapResult(function(e){return{blob:n,thumbBlob:w.some(e)}})})).mapError(qr);var t,r},Uu=function(e,n){return N(Iu,e.type)?ju(e,n):le.pure({blob:e,thumbBlob:w.none()})},Cu=function(e){return le.fromResult($n("standalone upload settings",zo,qo(e)).mapError(Zn))},ku=function(o,e,n){return Cu(T({},e.get().getOr({}),n)).bindFuture(function(e){var n,r,t=Lo(o,e);return(n={fs:t,path:e.path,name:e.name,blob:e.blob,progress:(r=e.onprogress,function(e){var n=e.loaded,t=e.total;r({loaded:n,total:t})}),maxImageDimension:e.maxImageDimension},Uu(n.blob,n.maxImageDimension).bindFuture(function(e){return n.fs.uploadToPath({blob:e.blob,thumbBlob:e.thumbBlob,name:n.name,progress:n.progress,path:n.path})})).bindResult(function(e){return ae.fromOption(Bo(e).map(function(e){return{file:e}}),qr("Failed to get upload file"))}).mapError(function(e){return e.message})})},Lu=function(n,r){return{overrideDefaults:function(e){return t=e,void(n=r).get().fold(function(){n.set(w.some(t))},function(e){n.set(w.some(T({},e,t)))});var n,t},pick:function(e){return fo(Wo(n,r,e,!0,!0,!1))},browse:function(e){return fo(Wo(n,r,e,!1,!0,!1).mapResult(c))},start:function(e){return fo(Wo(n,r,e,!1,!1,!0).mapResult(c))},upload:function(e){return fo(ku(n,r,e))}}};mu=f(w.none()),hu=f(w.none()),pu=Lu(hu,mu),de.tinydrive=pu}(window);