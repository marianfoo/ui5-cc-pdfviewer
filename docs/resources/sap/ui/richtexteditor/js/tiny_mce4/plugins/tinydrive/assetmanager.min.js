/* TinyDrive
 *
 * Copyright 2010-2018 Tiny Technologies LLC. All rights reserved.
 *
 * Version: 1.3.0-76
 */

!function(L){"use strict";var b=function(){},g=function(n,o){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(o.apply(null,e))}},U=function(e){return function(){return e}},m=function(e){return e},v=function(e,t){return e===t};function l(o){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r.concat(e);return o.apply(null,n)}}var e,t,n,o,r,i,u,a=function(e){return function(){throw new Error(e)}},c=U(!1),s=U(!0),f=c,d=s,p=function(){return h},h=(o={fold:function(e,t){return e()},is:f,isSome:f,isNone:d,getOr:n=function(e){return e},getOrThunk:t=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:n,orThunk:t,map:p,ap:p,each:function(){},bind:p,flatten:p,exists:f,forall:d,filter:p,equals:e=function(e){return e.isNone()},equals_:e,toArray:function(){return[]},toString:U("none()")},Object.freeze&&Object.freeze(o),o),y=function(n){var e=function(){return n},t=function(){return r},o=function(e){return e(n)},r={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:d,isNone:f,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return y(e(n))},ap:function(e){return e.fold(p,function(e){return y(e(n))})},each:function(e){e(n)},bind:o,flatten:e,exists:o,forall:o,filter:function(e){return e(n)?r:h},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(f,function(e){return t(n,e)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return r},B={some:y,none:p,from:function(e){return null==e?h:y(e)}},w=function(n){return{is:function(e){return n===e},isValue:s,isError:c,getOr:U(n),getOrThunk:U(n),getOrDie:U(n),or:function(e){return w(n)},orThunk:function(e){return w(n)},fold:function(e,t){return t(n)},map:function(e){return w(e(n))},mapError:function(e){return w(n)},each:function(e){e(n)},bind:function(e){return e(n)},exists:function(e){return e(n)},forall:function(e){return e(n)},toOption:function(){return B.some(n)}}},x=function(n){return{is:c,isValue:c,isError:s,getOr:m,getOrThunk:function(e){return e()},getOrDie:function(){return a(String(n))()},or:function(e){return e},orThunk:function(e){return e()},fold:function(e,t){return e(n)},map:function(e){return x(n)},mapError:function(e){return x(e(n))},each:b,bind:function(e){return x(n)},exists:c,forall:s,toOption:B.none}},M={value:w,error:x,fromOption:function(e,t){return e.fold(function(){return x(t)},w)}},S=function(t){return function(e){return function(e){if(null===e)return"null";var t=typeof e;return"object"===t&&Array.prototype.isPrototypeOf(e)?"array":"object"===t&&String.prototype.isPrototypeOf(e)?"string":t}(e)===t}},O=S("string"),k=S("object"),T=S("array"),F=S("null"),D=S("boolean"),C=S("undefined"),I=S("function"),E=S("number"),A=Array.prototype.slice,_=void 0===(r=Array.prototype.indexOf)?function(e,t){return q(e,t)}:function(e,t){return r.call(e,t)},N=function(e,t){return-1<_(e,t)},z=function(e,t){return W(e,t).isSome()},H=function(e,t){for(var n=e.length,o=new Array(n),r=0;r<n;r++){var i=e[r];o[r]=t(i,r,e)}return o},R=function(e,t){for(var n=0,o=e.length;n<o;n++){t(e[n],n,e)}},V=function(e,t){for(var n=[],o=0,r=e.length;o<r;o++){var i=e[o];t(i,o,e)&&n.push(i)}return n},P=function(e,t,n){return function(e,t){for(var n=e.length-1;0<=n;n--)t(e[n],n,e)}(e,function(e){n=t(n,e)}),n},G=function(e,t,n){return R(e,function(e){n=t(n,e)}),n},j=function(e,t){for(var n=0,o=e.length;n<o;n++){var r=e[n];if(t(r,n,e))return B.some(r)}return B.none()},W=function(e,t){for(var n=0,o=e.length;n<o;n++){if(t(e[n],n,e))return B.some(n)}return B.none()},q=function(e,t){for(var n=0,o=e.length;n<o;++n)if(e[n]===t)return n;return-1},K=Array.prototype.push,Y=function(e){for(var t=[],n=0,o=e.length;n<o;++n){if(!Array.prototype.isPrototypeOf(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);K.apply(t,e[n])}return t},J=function(e,t){var n=H(e,t);return Y(n)},Z=function(e,t){for(var n=0,o=e.length;n<o;++n){if(!0!==t(e[n],n,e))return!1}return!0},X=function(e){var t=A.call(e,0);return t.reverse(),t},$=function(e,t){return V(e,function(e){return!N(t,e)})},Q=function(e){return 0===e.length?B.none():B.some(e[0])},ee=function(e){return 0===e.length?B.none():B.some(e[e.length-1])},te=I(Array.from)?Array.from:function(e){return A.call(e)},ne=Object.keys,oe=Object.hasOwnProperty,re=function(e,t){for(var n=ne(e),o=0,r=n.length;o<r;o++){var i=n[o];t(e[i],i,e)}},ie=function(e,o){return ue(e,function(e,t,n){return{k:t,v:o(e,t,n)}})},ue=function(o,r){var i={};return re(o,function(e,t){var n=r(e,t,o);i[n.k]=n.v}),i},ae=function(e,n){var o=[];return re(e,function(e,t){o.push(n(e,t))}),o},ce=function(e){return ae(e,function(e){return e})},se=function(e,t){return fe(e,t)?B.from(e[t]):B.none()},fe=function(e,t){return oe.call(e,t)},le=function(u){if(!T(u))throw new Error("cases must be an array");if(0===u.length)throw new Error("there must be at least one case");var a=[],n={};return R(u,function(e,o){var t=ne(e);if(1!==t.length)throw new Error("one and only one name per case");var r=t[0],i=e[r];if(void 0!==n[r])throw new Error("duplicate key detected:"+r);if("cata"===r)throw new Error("cannot have a case named cata (sorry)");if(!T(i))throw new Error("case arguments must be an array");a.push(r),n[r]=function(){var e=arguments.length;if(e!==i.length)throw new Error("Wrong number of arguments to case "+r+". Expected "+i.length+" ("+i+"), got "+e);for(var n=new Array(e),t=0;t<n.length;t++)n[t]=arguments[t];return{fold:function(){if(arguments.length!==u.length)throw new Error("Wrong number of arguments to fold. Expected "+u.length+", got "+arguments.length);return arguments[o].apply(null,n)},match:function(e){var t=ne(e);if(a.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+a.join(",")+"\nActual: "+t.join(","));if(!Z(a,function(e){return N(t,e)}))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+a.join(", "));return e[r].apply(null,n)},log:function(e){L.console.log(e,{constructors:a,constructor:r,params:n})}}}}),n},de=Object.prototype.hasOwnProperty,me=function(u){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(0===e.length)throw new Error("Can't merge zero objects");for(var n={},o=0;o<e.length;o++){var r=e[o];for(var i in r)de.call(r,i)&&(n[i]=u(n[i],r[i]))}return n}},pe=me(function(e,t){return k(e)&&k(t)?pe(e,t):t}),ge=me(function(e,t){return t}),he=function(n){var o,r=!1;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r||(r=!0,o=n.apply(null,e)),o}},ve=le([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),ye=function(e){return ve.defaultedThunk(U(e))},be=ve.strict,we=ve.asOption,xe=ve.defaultedThunk,Se=ve.mergeWithThunk,Oe=function(t){return function(e){return fe(e,t)?B.from(e[t]):B.none()}},ke=function(e,t){return Oe(t)(e)},Te=function(e,t){var n={};return n[e]=t,n},Fe=(le([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(e,t){return n=t,o={},re(e,function(e,t){N(n,t)||(o[t]=e)}),o;var n,o}),De=function(e){return Oe(e)},Ce=function(e,t){return n=e,o=t,function(e){return fe(e,n)?e[n]:o};var n,o},Ie=function(e,t){return ke(e,t)},Ee=function(e,t){return Te(e,t)},Le=function(e){return t={},R(e,function(e){t[e.key]=e.value}),t;var t},Be=function(e,t){var n,o,r,i,u,a=(n=[],o=[],R(e,function(e){e.fold(function(e){n.push(e)},function(e){o.push(e)})}),{errors:n,values:o});return 0<a.errors.length?(u=a.errors,g(M.error,Y)(u)):(i=t,0===(r=a.values).length?M.value(i):M.value(pe(i,ge.apply(void 0,r))))},Me=function(e,t){return fe(n=e,o=t)&&void 0!==n[o]&&null!==n[o];var n,o};(u=i||(i={}))[u.Error=0]="Error",u[u.Value=1]="Value";var Ae=function(e,t,n){return e.stype===i.Error?t(e.serror):n(e.svalue)},_e=function(e){return{stype:i.Value,svalue:e}},Ne=function(e){return{stype:i.Error,serror:e}},ze=function(e){return e.fold(Ne,_e)},He=function(e){return Ae(e,M.error,M.value)},Re=_e,Ve=function(e){var t=[],n=[];return R(e,function(e){Ae(e,function(e){return n.push(e)},function(e){return t.push(e)})}),{values:t,errors:n}},Pe=Ne,je=function(e,t){return e.stype===i.Value?t(e.svalue):e},Ue=function(e,t){return e.stype===i.Error?t(e.serror):e},Ge=function(e,t){return e.stype===i.Value?{stype:i.Value,svalue:t(e.svalue)}:e},We=function(e,t){return e.stype===i.Error?{stype:i.Error,serror:t(e.serror)}:e},qe=function(e){return g(Pe,Y)(e)},Ke=function(e,t){var n,o,r=Ve(e);return 0<r.errors.length?qe(r.errors):(n=r.values,o=t,0<n.length?Re(pe(o,ge.apply(void 0,n))):Re(o))},Ye=function(e){var t=Ve(e);return 0<t.errors.length?qe(t.errors):Re(t.values)},Je=le([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),Ze=le([{field:["name","presence","type"]},{state:["name"]}]),Xe=void 0!==L.window?L.window:Function("return this;")(),$e=function(e,t){for(var n=null!=t?t:Xe,o=0;o<e.length&&null!=n;++o)n=n[e[o]];return n},Qe=function(e,t){return n=t,o=e.split("."),$e(o,n);var n,o},et={getOrDie:function(e,t){var n=Qe(e,t);if(null==n)throw e+" not available on this browser";return n}},tt=function(){return et.getOrDie("JSON")},nt=function(e,t,n){return tt().stringify(e,t,n)},ot=function(e){return k(e)&&100<ne(e).length?" removed due to size":nt(e,null,2)},rt=function(e,t){return Pe([{path:e,getErrorInfo:t}])},it=le([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),ut=function(n,o,r){return ke(o,r).fold(function(){return e=r,t=o,rt(n,function(){return'Could not find valid *strict* value for "'+e+'" in '+ot(t)});var e,t},Re)},at=function(e,t,n){var o=ke(e,t).fold(function(){return n(e)},m);return Re(o)},ct=function(a,c,e,s){return e.fold(function(r,n,e,o){var i=function(e){var t=o.extract(a.concat([r]),s,e);return Ge(t,function(e){return Te(n,s(e))})},u=function(e){return e.fold(function(){var e=Te(n,s(B.none()));return Re(e)},function(e){var t=o.extract(a.concat([r]),s,e);return Ge(t,function(e){return Te(n,s(B.some(e)))})})};return e.fold(function(){return je(ut(a,c,r),i)},function(e){return je(at(c,r,e),i)},function(){return je(Re(ke(c,r)),u)},function(e){return je((n=e,o=ke(t=c,r).map(function(e){return!0===e?n(t):e}),Re(o)),u);var t,n,o},function(e){var t=e(c),n=Ge(at(c,r,U({})),function(e){return pe(t,e)});return je(n,i)})},function(e,t){var n=t(c);return Re(Te(e,s(n)))})},st=function(o){return{extract:function(n,e,t){return Ue(o(t,e),function(e){return t=e,rt(n,function(){return t});var t})},toString:function(){return"val"},toDsl:function(){return Je.itemOf(o)}}},ft=function(e){var c=lt(e),s=P(e,function(t,e){return e.fold(function(e){return pe(t,Ee(e,!0))},U(t))},{});return{extract:function(e,t,n){var o,r,i,u=D(n)?[]:(r=ne(o=n),V(r,function(e){return Me(o,e)})),a=V(u,function(e){return!Me(s,e)});return 0===a.length?c.extract(e,t,n):(i=a,rt(e,function(){return"There are unsupported fields: ["+i.join(", ")+"] specified"}))},toString:c.toString,toDsl:c.toDsl}},lt=function(a){return{extract:function(e,t,n){return o=e,r=n,i=t,u=H(a,function(e){return ct(o,r,e,i)}),Ke(u,{});var o,r,i,u},toString:function(){return"obj{\n"+H(a,function(e){return e.fold(function(e,t,n,o){return e+" -> "+o.toString()},function(e,t){return"state("+e+")"})}).join("\n")+"}"},toDsl:function(){return Je.objOf(H(a,function(e){return e.fold(function(e,t,n,o){return Ze.field(e,n,o)},function(e,t){return Ze.state(e)})}))}}},dt=function(r){return{extract:function(n,o,e){var t=H(e,function(e,t){return r.extract(n.concat(["["+t+"]"]),o,e)});return Ye(t)},toString:function(){return"array("+r.toString()+")"},toDsl:function(){return Je.arrOf(r)}}},mt=function(a,c){return{extract:function(n,o,r){var e,t,i=ne(r),u=(e=n,t=i,dt(st(a)).extract(e,m,t));return je(u,function(e){var t=H(e,function(e){return it.field(e,e,be(),c)});return lt(t).extract(n,o,r)})},toString:function(){return"setOf("+c.toString()+")"},toDsl:function(){return Je.setOf(a,c)}}},pt=U(st(Re)),gt=it.state,ht=it.field,vt=function(n,t,o,r,i){return Ie(r,i).fold(function(){return e=r,t=i,rt(n,function(){return'The chosen schema: "'+t+'" did not exist in branches: '+ot(e)});var e,t},function(e){return lt(e).extract(n.concat(["branch: "+i]),t,o)})},yt=function(r,i){return{extract:function(t,n,o){return Ie(o,r).fold(function(){return e=r,rt(t,function(){return'Choice schema did not contain choice key: "'+e+'"'});var e},function(e){return vt(t,n,o,i,e)})},toString:function(){return"chooseOn("+r+"). Possible values: "+ne(i)},toDsl:function(){return Je.choiceOf(r,i)}}},bt=st(Re),wt=function(t){return st(function(e){return t(e).fold(Pe,Re)})},xt=function(t,e){return mt(function(e){return ze(t(e))},e)},St=function(e,t,n){return He((o=e,r=m,i=n,u=t.extract([o],r,i),We(u,function(e){return{input:i,errors:e}})));var o,r,i,u},Ot=function(e){return e.fold(function(e){throw new Error(Tt(e))},m)},kt=function(e,t,n){return Ot(St(e,t,n))},Tt=function(e){return"Errors: \n"+(t=e.errors,n=10<t.length?t.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):t,H(n,function(e){return"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()}))+"\n\nInput object: "+ot(e.input);var t,n},Ft=function(e,t){return yt(e,t)},Dt=U(bt),Ct=function(n,o){return st(function(e){var t=typeof e;return n(e)?Re(e):Pe("Expected type: "+o+" but got: "+t)})},It=Ct(E,"number"),Et=Ct(O,"string"),Lt=Ct(D,"boolean"),Bt=Ct(I,"function"),Mt=function(t){return wt(function(e){return N(t,e)?M.value(e):M.error('Unsupported value: "'+e+'", choose one of "'+t.join(", ")+'".')})},At=function(e){return ht(e,e,be(),pt())},_t=function(e,t){return ht(e,e,be(),t)},Nt=function(e){return _t(e,It)},zt=function(e){return _t(e,Et)},Ht=function(e){return _t(e,Lt)},Rt=function(e){return _t(e,Bt)},Vt=function(t,n){return ht(t,t,we(),st(function(e){return Pe("The field: "+t+" is forbidden. "+n)}))},Pt=function(e,t){return ht(e,e,be(),lt(t))},jt=function(e){return ht(e,e,we(),pt())},Ut=function(e,t){return ht(e,e,we(),t)},Gt=function(e){return Ut(e,Bt)},Wt=function(e,t){return Ut(e,lt(t))},qt=function(e,t){return ht(e,e,ye(t),pt())},Kt=function(e,t,n){return ht(e,e,ye(t),n)},Yt=function(e,t){return Kt(e,t,It)},Jt=function(e,t){return Kt(e,t,Et)},Zt=function(e,t,n){return Kt(e,t,Mt(n))},Xt=function(e,t){return Kt(e,t,Bt)},$t=function(e,t){return gt(e,t)},Qt={init:function(){return en({readState:function(){return"No State required"}})}},en=function(e){return e},tn=function(){return et.getOrDie("Node")},nn=function(e,t,n){return 0!=(e.compareDocumentPosition(t)&n)},on=function(e,t){return nn(e,t,tn().DOCUMENT_POSITION_CONTAINED_BY)},rn=function(){return un(0,0)},un=function(e,t){return{major:e,minor:t}},an={nu:un,detect:function(e,t){var n=String(t).toLowerCase();return 0===e.length?rn():function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.test(t))return o}}(e,t);if(!n)return{major:0,minor:0};var o=function(e){return Number(t.replace(n,"$"+e))};return un(o(1),o(2))}(e,n)},unknown:rn},cn="Firefox",sn=function(e,t){return function(){return t===e}},fn=function(e){var t=e.current;return{current:t,version:e.version,isEdge:sn("Edge",t),isChrome:sn("Chrome",t),isIE:sn("IE",t),isOpera:sn("Opera",t),isFirefox:sn(cn,t),isSafari:sn("Safari",t)}},ln={unknown:function(){return fn({current:void 0,version:an.unknown()})},nu:fn,edge:U("Edge"),chrome:U("Chrome"),ie:U("IE"),opera:U("Opera"),firefox:U(cn),safari:U("Safari")},dn="Windows",mn="Android",pn="Solaris",gn="FreeBSD",hn=function(e,t){return function(){return t===e}},vn=function(e){var t=e.current;return{current:t,version:e.version,isWindows:hn(dn,t),isiOS:hn("iOS",t),isAndroid:hn(mn,t),isOSX:hn("OSX",t),isLinux:hn("Linux",t),isSolaris:hn(pn,t),isFreeBSD:hn(gn,t)}},yn={unknown:function(){return vn({current:void 0,version:an.unknown()})},nu:vn,windows:U(dn),ios:U("iOS"),android:U(mn),linux:U("Linux"),osx:U("OSX"),solaris:U(pn),freebsd:U(gn)},bn=function(e,t){var n=String(t).toLowerCase();return j(e,function(e){return e.search(n)})},wn=function(e,n){return bn(e,n).map(function(e){var t=an.detect(e.versionRegexes,n);return{current:e.name,version:t}})},xn=function(e,n){return bn(e,n).map(function(e){var t=an.detect(e.versionRegexes,n);return{current:e.name,version:t}})},Sn=function(e,t,n){return""===t||!(e.length<t.length)&&e.substr(n,n+t.length)===t},On=function(e,t){return-1!==e.indexOf(t)},kn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Tn=function(t){return function(e){return On(e,t)}},Fn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return On(e,"edge/")&&On(e,"chrome")&&On(e,"safari")&&On(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,kn],search:function(e){return On(e,"chrome")&&!On(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return On(e,"msie")||On(e,"trident")}},{name:"Opera",versionRegexes:[kn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Tn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Tn("firefox")},{name:"Safari",versionRegexes:[kn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(On(e,"safari")||On(e,"mobile/"))&&On(e,"applewebkit")}}],Dn=[{name:"Windows",search:Tn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return On(e,"iphone")||On(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Tn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Tn("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Tn("linux"),versionRegexes:[]},{name:"Solaris",search:Tn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Tn("freebsd"),versionRegexes:[]}],Cn={browsers:U(Fn),oses:U(Dn)},In=function(e){var t,n,o,r,i,u,a,c,s,f,l,d=Cn.browsers(),m=Cn.oses(),p=wn(d,e).fold(ln.unknown,ln.nu),g=xn(m,e).fold(yn.unknown,yn.nu);return{browser:p,os:g,deviceType:(n=p,o=e,r=(t=g).isiOS()&&!0===/ipad/i.test(o),i=t.isiOS()&&!r,u=t.isAndroid()&&3===t.version.major,a=t.isAndroid()&&4===t.version.major,c=r||u||a&&!0===/mobile/i.test(o),s=t.isiOS()||t.isAndroid(),f=s&&!c,l=n.isSafari()&&t.isiOS()&&!1===/safari/i.test(o),{isiPad:U(r),isiPhone:U(i),isTablet:U(c),isPhone:U(f),isTouch:U(s),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:U(l)})}},En={detect:he(function(){var e=L.navigator.userAgent;return In(e)})},Ln=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:U(e)}},Bn={fromHtml:function(e,t){var n=(t||L.document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||1<n.childNodes.length)throw L.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return Ln(n.childNodes[0])},fromTag:function(e,t){var n=(t||L.document).createElement(e);return Ln(n)},fromText:function(e,t){var n=(t||L.document).createTextNode(e);return Ln(n)},fromDom:Ln,fromPoint:function(e,t,n){var o=e.dom();return B.from(o.elementFromPoint(t,n)).map(Ln)}},Mn=(L.Node.ATTRIBUTE_NODE,L.Node.CDATA_SECTION_NODE,L.Node.COMMENT_NODE,L.Node.DOCUMENT_NODE),An=(L.Node.DOCUMENT_TYPE_NODE,L.Node.DOCUMENT_FRAGMENT_NODE,L.Node.ELEMENT_NODE),_n=L.Node.TEXT_NODE,Nn=(L.Node.PROCESSING_INSTRUCTION_NODE,L.Node.ENTITY_REFERENCE_NODE,L.Node.ENTITY_NODE,L.Node.NOTATION_NODE,An),zn=Mn,Hn=function(e,t){var n=e.dom();if(n.nodeType!==Nn)return!1;if(void 0!==n.matches)return n.matches(t);if(void 0!==n.msMatchesSelector)return n.msMatchesSelector(t);if(void 0!==n.webkitMatchesSelector)return n.webkitMatchesSelector(t);if(void 0!==n.mozMatchesSelector)return n.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},Rn=function(e){return e.nodeType!==Nn&&e.nodeType!==zn||0===e.childElementCount},Vn=function(e,t){var n=void 0===t?L.document:t.dom();return Rn(n)?[]:H(n.querySelectorAll(e),Bn.fromDom)},Pn=function(e,t){return e.dom()===t.dom()},jn=En.detect().browser.isIE()?function(e,t){return on(e.dom(),t.dom())}:function(e,t){var n=e.dom(),o=t.dom();return n!==o&&n.contains(o)},Un=function(e,t){return Pn(e.element(),t.event().target())},Gn=function(e){if(!Me(e,"can")&&!Me(e,"abort")&&!Me(e,"run"))throw new Error("EventHandler defined by: "+nt(e,null,2)+" does not have can, abort, or run!");return kt("Extracting event.handler",ft([qt("can",U(!0)),qt("abort",U(!1)),qt("run",b)]),e)},Wn=function(n){var t,o,r,i,e=(t=n,o=function(e){return e.can},function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return G(t,function(e,t){return e&&o(t).apply(void 0,n)},!0)}),u=(r=n,i=function(e){return e.abort},function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return G(r,function(e,t){return e||i(t).apply(void 0,n)},!1)});return Gn({can:e,abort:u,run:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];R(n,function(e){e.run.apply(void 0,t)})}})},qn=function(){return(qn=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function Kn(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}var Yn=U("touchstart"),Jn=U("touchmove"),Zn=U("touchend"),Xn=U("mousedown"),$n=U("mousemove"),Qn=U("mouseout"),eo=U("mouseup"),to=U("mouseover"),no=U("focusin"),oo=U("focusout"),ro=U("keydown"),io=U("keyup"),uo=U("input"),ao=U("click"),co=U("dragover"),so=U("dragend"),fo=U("dragstart"),lo=U("dragleave"),mo=U("dragenter"),po=U("drop"),go=U("drag"),ho={tap:U("alloy.tap")},vo=U("alloy.focus"),yo=U("alloy.blur.post"),bo=U("alloy.paste.post"),wo=U("alloy.receive"),xo=U("alloy.execute"),So=U("alloy.focus.item"),Oo=ho.tap,ko=En.detect().deviceType.isTouch()?ho.tap:ao,To=U("alloy.longpress"),Fo=U("alloy.sandbox.close"),Do=U("alloy.system.init"),Co=U("alloy.system.attached"),Io=U("alloy.system.detached"),Eo=U("alloy.system.dismissRequested"),Lo=U("alloy.focusmanager.shifted"),Bo=U("alloy.highlight"),Mo=U("alloy.dehighlight"),Ao=function(e,t){Ho(e,e.element(),t,{})},_o=function(e,t,n){Ho(e,e.element(),t,n)},No=function(e){Ao(e,xo())},zo=function(e,t,n){Ho(e,t,n,{})},Ho=function(e,t,n,o){var r=qn({target:t},o);e.getSystem().triggerEvent(n,t,ie(r,U))};function Ro(e,t,n,o,r){return e(n,o)?B.some(n):I(r)&&r(n)?B.none():t(n,o,r)}var Vo,Po,jo,Uo,Go=function(e){return e.dom().nodeName.toLowerCase()},Wo=function(t){return function(e){return e.dom().nodeType===t}},qo=Wo(An),Ko=Wo(_n),Yo=Wo(Mn),Jo=function(e){var t=Ko(e)?e.dom().parentNode:e.dom();return null!=t&&t.ownerDocument.body.contains(t)},Zo=he(function(){return Xo(Bn.fromDom(L.document))}),Xo=function(e){var t=e.dom().body;if(null==t)throw new Error("Body is not available yet");return Bn.fromDom(t)},$o=function(e,t,n){for(var o=e.dom(),r=I(n)?n:U(!1);o.parentNode;){o=o.parentNode;var i=Bn.fromDom(o);if(t(i))return B.some(i);if(r(i))break}return B.none()},Qo=function(e,t,n){return Ro(function(e){return t(e)},$o,e,t,n)},er=function(e,o){var r=function(e){for(var t=0;t<e.childNodes.length;t++){if(o(Bn.fromDom(e.childNodes[t])))return B.some(Bn.fromDom(e.childNodes[t]));var n=r(e.childNodes[t]);if(n.isSome())return n}return B.none()};return r(e.dom())},tr=function(e,t,n){return Qo(e,function(e){return t(e).isSome()},n).bind(t)},nr=function(e){return Le(e)},or=function(e,t){return{key:e,value:Gn({run:t})}},rr=function(e){return function(n){return{key:e,value:Gn({run:function(e,t){Un(e,t)&&n(e,t)}})}}},ir=function(e){return or(e,function(e,t){t.cut()})},ur=function(e){return or(e,function(e,t){t.stop()})},ar=rr(Co()),cr=rr(Io()),sr=rr(Do()),fr=(Vo=xo(),function(e){return or(Vo,e)}),lr=function(e){return H(e,function(e){return Sn(t=e,n="/*",t.length-n.length)?e.substring(0,e.length-"/*".length):e;var t,n})},dr=function(e,t){var n=e.toString(),o=n.indexOf(")")+1,r=n.indexOf("("),i=n.substring(r+1,o-1).split(/,\s*/);return e.toFunctionAnnotation=function(){return{name:t,parameters:lr(i)}},e},mr=function(e){return{classes:void 0!==e.classes?e.classes:[],attributes:void 0!==e.attributes?e.attributes:{},styles:void 0!==e.styles?e.styles:{}}},pr=function(n,o,r){return sr(function(e,t){r(e,n,o)})},gr=function(e,t,n,o,r,i){var u,a,c=ft(e),s=Wt(t,[(u="config",a=e,Ut(u,ft(a)))]);return yr(c,s,t,n,o,r,i)},hr=function(r,i,u){var e,t,n,o,a,c;return e=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var o=[n].concat(e);return n.config({name:U(r)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+r+". Using API: "+u)},function(e){var t=Array.prototype.slice.call(o,1);return i.apply(void 0,[n,e.config,e.state].concat(t))})},t=u,n=i.toString(),o=n.indexOf(")")+1,a=n.indexOf("("),c=n.substring(a+1,o-1).split(/,\s*/),e.toFunctionAnnotation=function(){return{name:t,parameters:lr(c.slice(0,1).concat(c.slice(3)))}},e},vr=function(e){return{key:e,value:void 0}},yr=function(n,e,o,r,t,i,u){var a=function(e){return Me(e,o)?e[o]():B.none()},c=ie(t,function(e,t){return hr(o,e,t)}),s=ie(i,function(e,t){return dr(e,t)}),f=qn({},s,c,{revoke:l(vr,o),config:function(e){var t=kt(o+"-config",n,e);return{key:o,value:{config:t,me:f,configAsRaw:he(function(){return kt(o+"-config",n,e)}),initialConfig:e,state:u}}},schema:function(){return e},exhibit:function(e,n){return a(e).bind(function(t){return Ie(r,"exhibit").map(function(e){return e(n,t.config,t.state)})}).getOr(mr({}))},name:function(){return o},handlers:function(e){return a(e).map(function(e){return Ce("events",function(e,t){return{}})(r)(e.config,e.state)}).getOr({})}});return f},br=function(e){return Le(e)},wr=ft([At("fields"),At("name"),qt("active",{}),qt("apis",{}),qt("state",Qt),qt("extra",{})]),xr=function(e){var t=kt("Creating behaviour: "+e.name,wr,e);return gr(t.fields,t.name,t.active,t.apis,t.extra,t.state)},Sr=ft([At("branchKey"),At("branches"),At("name"),qt("active",{}),qt("apis",{}),qt("state",Qt),qt("extra",{})]),Or=function(e){var t,n,o,r,i,u,a,c,s=kt("Creating behaviour: "+e.name,Sr,e);return t=Ft(s.branchKey,s.branches),n=s.name,o=s.active,r=s.apis,i=s.extra,u=s.state,c=Wt(n,[Ut("config",a=t)]),yr(a,c,n,o,r,i,u)},kr=U(void 0),Tr=function(e,t){var n,o;return{key:e,value:{config:{},me:(n=e,o=nr(t),xr({fields:[At("enabled")],name:n,active:{events:U(o)}})),configAsRaw:U({}),initialConfig:{},state:Qt}}},Fr=function(e){var t=e,n=function(){return t};return{get:n,set:function(e){t=e},clone:function(){return Fr(n())}}},Dr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];if(t.length!==n.length)throw new Error('Wrong number of arguments to struct. Expected "['+t.length+']", got '+n.length+" arguments");var o={};return R(t,function(e,t){o[e]=U(n[t])}),o}},Cr=function(e){return e.slice(0).sort()},Ir=function(t,e){if(!T(e))throw new Error("The "+t+" fields must be an array. Was: "+e+".");R(e,function(e){if(!O(e))throw new Error("The value "+e+" in the "+t+" fields was not a string.")})},Er=function(r,i){var n,u=r.concat(i);if(0===u.length)throw new Error("You must specify at least one required or optional field.");return Ir("required",r),Ir("optional",i),n=Cr(u),j(n,function(e,t){return t<n.length-1&&e===n[t+1]}).each(function(e){throw new Error("The field: "+e+" occurs more than once in the combined fields: ["+n.join(", ")+"].")}),function(t){var n=ne(t);Z(r,function(e){return N(n,e)})||function(e,t){throw new Error("All required keys ("+Cr(e).join(", ")+") were not specified. Specified keys were: "+Cr(t).join(", ")+".")}(r,n);var e=V(n,function(e){return!N(u,e)});0<e.length&&function(e){throw new Error("Unsupported keys for object: "+Cr(e).join(", "))}(e);var o={};return R(r,function(e){o[e]=U(t[e])}),R(i,function(e){o[e]=U(Object.prototype.hasOwnProperty.call(t,e)?B.some(t[e]):B.none())}),o}},Lr=function(e){return Bn.fromDom(e.dom().ownerDocument)},Br=function(e){var t=e.dom().ownerDocument.defaultView;return Bn.fromDom(t)},Mr=function(e){var t=e.dom();return B.from(t.parentNode).map(Bn.fromDom)},Ar=function(e){var t=e.dom();return B.from(t.offsetParent).map(Bn.fromDom)},_r=function(e){var t=e.dom();return H(t.childNodes,Bn.fromDom)},Nr=function(e,t){var n=e.dom().childNodes;return B.from(n[t]).map(Bn.fromDom)},zr=function(e){return Nr(e,0)},Hr=(Dr("element","offset"),function(t,n){Mr(t).each(function(e){e.dom().insertBefore(n.dom(),t.dom())})}),Rr=function(t,n){zr(t).fold(function(){Vr(t,n)},function(e){t.dom().insertBefore(n.dom(),e.dom())})},Vr=function(e,t){e.dom().appendChild(t.dom())},Pr=function(t,e){R(e,function(e){Vr(t,e)})},jr=function(e){e.dom().textContent="",R(_r(e),function(e){Ur(e)})},Ur=function(e){var t=e.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Gr=function(e,t){var n,o,r=Lr(e).dom(),i=Bn.fromDom(r.createDocumentFragment()),u=(n=t,(o=(r||L.document).createElement("div")).innerHTML=n,_r(Bn.fromDom(o)));Pr(i,u),jr(e),Vr(e,i)},Wr=function(e,t,n){if(!(O(n)||D(n)||E(n)))throw L.console.error("Invalid call to Attr.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")},qr=function(e,t,n){Wr(e.dom(),t,n)},Kr=function(e,t){var n=e.dom();re(t,function(e,t){Wr(n,t,e)})},Yr=function(e,t){var n=e.dom().getAttribute(t);return null===n?void 0:n},Jr=function(e,t){var n=e.dom();return!(!n||!n.hasAttribute)&&n.hasAttribute(t)},Zr=function(e,t){e.dom().removeAttribute(t)},Xr=function(e,t){return Bn.fromDom(e.dom().cloneNode(t))},$r=function(e){return Xr(e,!0)},Qr=function(e){var t,n,o,r=Xr(e,!1);return t=r,n=Bn.fromTag("div"),o=Bn.fromDom(t.dom().cloneNode(!0)),Vr(n,o),n.dom().innerHTML},ei=function(e){return Qr(e)},ti=nr([(Po=vo(),jo=function(e,t){var n,o,r=t.event().originator(),i=t.event().target();return o=i,!(Pn(n=r,e.element())&&!Pn(n,o))||(L.console.warn(vo()+" did not get interpreted by the desired target. \nOriginator: "+ei(r)+"\nTarget: "+ei(i)+"\nCheck the "+vo()+" event handlers"),!1)},{key:Po,value:Gn({can:jo})})]),ni=Object.freeze({events:ti}),oi=0,ri=function(e){var t=(new Date).getTime();return e+"_"+Math.floor(1e9*Math.random())+ ++oi+String(t)},ii=U("alloy-id-"),ui=U("data-alloy-id"),ai=ii(),ci=ui(),si=function(e,t){Object.defineProperty(e.dom(),ci,{value:t,writable:!0})},fi=function(e){var t=qo(e)?e.dom()[ci]:null;return B.from(t)},li=function(e){return ri(e)},di=m,mi=function(t){var e=function(e){return function(){throw new Error("The component must be in a context to send: "+e+"\n"+ei(t().element())+" is not in context.")}};return{debugInfo:U("fake"),triggerEvent:e("triggerEvent"),triggerFocus:e("triggerFocus"),triggerEscape:e("triggerEscape"),build:e("build"),addToWorld:e("addToWorld"),removeFromWorld:e("removeFromWorld"),addToGui:e("addToGui"),removeFromGui:e("removeFromGui"),getByUid:e("getByUid"),getByDom:e("getByDom"),broadcast:e("broadcast"),broadcastOn:e("broadcastOn"),broadcastEvent:e("broadcastEvent"),isConnected:U(!1)}},pi=mi(),gi=ri("alloy-premade"),hi=function(e){return Ee(gi,e)},vi=function(o){return e=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return o.apply(void 0,[e.getApis()].concat([e].concat(t)))},t=o.toString(),n=t.indexOf(")")+1,r=t.indexOf("("),i=t.substring(r+1,n-1).split(/,\s*/),e.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:lr(i.slice(1))}},e;var e,t,n,r,i},yi=function(e,r){var i={};return re(e,function(e,o){re(e,function(e,t){var n=Ce(t,[])(i);i[t]=n.concat([r(o,e)])})}),i},bi=function(e,t){return n=l.apply(void 0,[e.handler].concat(t)),o=e.purpose(),{cHandler:n,purpose:U(o)};var n,o},wi=function(e){return e.cHandler},xi=function(e,t){return{name:U(e),handler:U(t)}},Si=function(e,t,n){var o,r,i=qn({},n,(o=e,r={},R(t,function(e){r[e.name()]=e.handlers(o)}),r));return yi(i,xi)},Oi=function(e){var t,i=I(t=e)?{can:U(!0),abort:U(!1),run:t}:t;return function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var r=[e,t].concat(n);i.abort.apply(void 0,r)?t.stop():i.can.apply(void 0,r)&&i.run.apply(void 0,r)}},ki=function(e,t,n){var o,r,i=t[n];return i?function(u,a,e,c){var t=e.slice(0);try{var n=t.sort(function(e,t){var n=e[a](),o=t[a](),r=c.indexOf(n),i=c.indexOf(o);if(-1===r)throw new Error("The ordering for "+u+" does not have an entry for "+n+".\nOrder specified: "+nt(c,null,2));if(-1===i)throw new Error("The ordering for "+u+" does not have an entry for "+o+".\nOrder specified: "+nt(c,null,2));return r<i?-1:i<r?1:0});return M.value(n)}catch(e){return M.error([e])}}("Event: "+n,"name",e,i).map(function(e){var t=H(e,function(e){return e.handler()});return Wn(t)}):(o=n,r=e,M.error(["The event ("+o+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+nt(H(r,function(e){return e.name()}),null,2)]))},Ti=function(e,i){var t=ae(e,function(o,r){return(1===o.length?M.value(o[0].handler()):ki(o,i,r)).map(function(e){var t=Oi(e),n=1<o.length?V(i,function(t){return N(o,function(e){return e.name()===t})}).join(" > "):o[0].name();return Ee(r,{handler:t,purpose:U(n)})})});return Be(t,{})},Fi=function(e){return St("custom.definition",lt([ht("dom","dom",be(),lt([At("tag"),qt("styles",{}),qt("classes",[]),qt("attributes",{}),jt("value"),jt("innerHtml")])),At("components"),At("uid"),qt("events",{}),qt("apis",{}),ht("eventOrder","eventOrder",(t={"alloy.execute":["disabling","alloy.base.behaviour","toggling","typeaheadevents"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing","item-events","tooltipping"],mousedown:["focusing","alloy.base.behaviour","item-type-events"],mouseover:["item-type-events","tooltipping"]},ve.mergeWithThunk(U(t))),Dt()),jt("domModification")]),e);var t},Di=function(e,t){var n=Yr(e,t);return void 0===n||""===n?[]:n.split(" ")},Ci=function(e){return void 0!==e.dom().classList},Ii=function(e,t){return r=t,i=Di(n=e,o="class").concat([r]),qr(n,o,i.join(" ")),!0;var n,o,r,i},Ei=function(e,t){return r=t,0<(i=V(Di(n=e,o="class"),function(e){return e!==r})).length?qr(n,o,i.join(" ")):Zr(n,o),!1;var n,o,r,i},Li=function(e,t){Ci(e)?e.dom().classList.add(t):Ii(e,t)},Bi=function(e){0===(Ci(e)?e.dom().classList:Di(e,"class")).length&&Zr(e,"class")},Mi=function(e,t){Ci(e)?e.dom().classList.remove(t):Ei(e,t);Bi(e)},Ai=function(e,t){return Ci(e)&&e.dom().classList.contains(t)},_i=function(t,e){R(e,function(e){Li(t,e)})},Ni=function(t,e){R(e,function(e){Mi(t,e)})},zi=function(e){return void 0!==e.style},Hi=function(e,t,n){if(!O(n))throw L.console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);zi(e)&&e.style.setProperty(t,n)},Ri=function(e,t){zi(e)&&e.style.removeProperty(t)},Vi=function(e,t,n){var o=e.dom();Hi(o,t,n)},Pi=function(e,t){var n=e.dom();re(t,function(e,t){Hi(n,t,e)})},ji=function(e,t){var n=e.dom(),o=L.window.getComputedStyle(n).getPropertyValue(t),r=""!==o||Jo(e)?o:Ui(n,t);return null===r?void 0:r},Ui=function(e,t){return zi(e)?e.style.getPropertyValue(t):""},Gi=function(e,t){var n=e.dom(),o=Ui(n,t);return B.from(o).filter(function(e){return 0<e.length})},Wi=function(e,t){var n=e.dom();Ri(n,t),Jr(e,"style")&&""===Yr(e,"style").replace(/^\s+|\s+$/g,"")&&Zr(e,"style")},qi=function(e){return e.dom().value},Ki=function(e,t){if(void 0===t)throw new Error("Value.set was undefined");e.dom().value=t},Yi=function(e,t){return n=e,r=H(o=t,function(e){return Wt(e.name(),[At("config"),qt("state",Qt)])}),i=St("component.behaviours",lt(r),n.behaviours).fold(function(e){throw new Error(Tt(e)+"\nComplete spec:\n"+nt(n,null,2))},function(e){return e}),{list:o,data:ie(i,function(e){var t=e.map(function(e){return{config:e.config,state:e.state.init(e.config)}});return function(){return t}})};var n,o,r,i},Ji=function(e){var t,n,o,r=(t=e,n=Ce("behaviours",{})(t),o=V(ne(n),function(e){return void 0!==n[e]}),H(o,function(e){return n[e].me}));return Yi(e,r)},Zi=function(e,t,n){var o,r,i,u=qn({},(o=e).dom,{uid:o.uid,domChildren:H(o.components,function(e){return e.element()})}),a=e.domModification.fold(function(){return mr({})},mr),c={"alloy.base.modification":a},s=0<t.length?function(t,e,n,o){var r=qn({},e);R(n,function(e){r[e.name()]=e.exhibit(t,o)});var i=yi(r,function(e,t){return{name:e,modification:t}}),u=function(e){return P(e,function(e,t){return qn({},t.modification,e)},{})},a=P(i.classes,function(e,t){return t.modification.concat(e)},[]),c=u(i.attributes),s=u(i.styles);return mr({classes:a,attributes:c,styles:s})}(n,c,t,u):a;return i=s,qn({},r=u,{attributes:qn({},r.attributes,i.attributes),styles:qn({},r.styles,i.styles),classes:r.classes.concat(i.classes)})},Xi=function(e,t,n){var o,r,i,u,a,c,s={"alloy.base.behaviour":(o=e,o.events)};return(r=n,i=e.eventOrder,u=t,a=s,c=Si(r,u,a),Ti(c,i)).getOrDie()},$i=function(n){var e=function(){return f},o=Fr(pi),t=Ot(Fi(n)),r=Ji(n),i=r.list,u=r.data,a=function(e){var t=Bn.fromTag(e.tag);Kr(t,e.attributes),_i(t,e.classes),Pi(t,e.styles),e.innerHtml.each(function(e){return Gr(t,e)});var n=e.domChildren;return Pr(t,n),e.value.each(function(e){Ki(t,e)}),e.uid,si(t,e.uid),t}(Zi(t,i,u)),c=Xi(t,i,u),s=Fr(t.components),f={getSystem:o.get,config:function(e){var t=u;return(I(t[e.name()])?t[e.name()]:function(){throw new Error("Could not find "+e.name()+" in "+nt(n,null,2))})()},hasConfigured:function(e){return I(u[e.name()])},spec:U(n),readState:function(e){return u[e]().map(function(e){return e.state.readState()}).getOr("not enabled")},getApis:function(){return t.apis},connect:function(e){o.set(e)},disconnect:function(){o.set(mi(e))},element:U(a),syncComponents:function(){var e=_r(a),t=J(e,function(e){return o.get().getByDom(e).fold(function(){return[]},function(e){return[e]})});s.set(t)},components:s.get,events:U(c)};return f},Qi=function(e){var t,n,o=di(e),r=o.events,i=Kn(o,["events"]),u=(t=i,n=Ce("components",[])(t),H(n,ou)),a=qn({},i,{events:qn({},ni,r),components:u});return M.value($i(a))},eu=function(e){var t=Bn.fromText(e);return tu({element:t})},tu=function(e){var t=kt("external.component",ft([At("element"),jt("uid")]),e),n=Fr(mi());t.uid.each(function(e){si(t.element,e)});var o={getSystem:n.get,config:B.none,hasConfigured:U(!1),connect:function(e){n.set(e)},disconnect:function(){n.set(mi(function(){return o}))},getApis:function(){return{}},element:U(t.element),spec:U(e),readState:U("No state"),syncComponents:b,components:U([]),events:U({})};return hi(o)},nu=li,ou=function(t){return(e=t,Ie(e,gi)).fold(function(){var e=t.hasOwnProperty("uid")?t:qn({uid:nu("")},t);return Qi(e).getOrDie()},function(e){return e});var e},ru=hi,iu=function(m,p){return function(e){if(m(e)){var t,n,o,r,i,u,a,c=Bn.fromDom(e.target),s=function(){e.stopPropagation()},f=function(){e.preventDefault()},l=g(f,s),d=(t=c,n=e.clientX,o=e.clientY,r=s,i=f,u=l,a=e,{target:U(t),x:U(n),y:U(o),stop:r,prevent:i,kill:u,raw:U(a)});p(d)}}},uu=function(e,t,n,o,r){var i=iu(n,o);return e.dom().addEventListener(t,i,r),{unbind:l(au,e,t,i,r)}},au=function(e,t,n,o){e.dom().removeEventListener(t,n,o)},cu=U(!0),su=function(e,t,n){return uu(e,t,cu,n,!1)},fu=function(e,t,n){return uu(e,t,cu,n,!0)};(Uo||(Uo={})).SetOrderByField="orderBy.set";var lu;(lu||(lu={})).SetSortOrder="sortOrder.set";var du,mu;(mu=du||(du={})).Loading="files.loading",mu.Set="files.set",mu.Add="files.add",mu.Append="files.append",mu.Remove="files.remove";var pu,gu,hu=function(e){return ge({offset:0,parentUuid:B.none(),sortBy:"name",sortOrder:"asc",query:B.none(),fileTypes:[]},e)},vu=function(e){return{type:"",message:e}},yu=function(e){return{type:"",message:e.message}},bu=function(e){return ee(e).bind(function(e){return e.uuid})};(gu=pu||(pu={})).Add="notification.add",gu.Remove="notification.remove";var wu,xu,Su=function(e){return{type:pu.Add,payload:{notification:{data:{uid:ri("error")},status:"error",text:e}}}},Ou=function(t){return function(e){return t(Su(e.message))}};(xu=wu||(wu={})).Open="inPreview.open",xu.Close="inPreview.close",xu.SetDimensions="inPreview.setDimensions",xu.SetDescription="inPreview.setDescription";var ku,Tu,Fu=function(o){return function(e,t,n){return Du(t().fileState.files,o)(e,t,n)}},Du=function(n,o){return function(r,e,t){j(n,function(e){return e.uuid===o}).each(function(o){t.getMeta(o.uuid).get(function(e){return e.fold(Ou(r),function(e){return r((t=o,n=e,{type:wu.Open,payload:{file:t,meta:n}}));var t,n})})})}},Cu=function(r){return function(e,t,n){var o;e((o=r,{type:wu.SetDimensions,payload:{dimensions:o}}))}};(Tu=ku||(ku={})).Set="query.set",Tu.Clear="query.clear";var Iu,Eu=function(e,t,n){return n.query.isSome()?e.search(n):"starred"===t?e.listStarred(n):e.list(n)},Lu=function(e,t){var n={parentUuid:bu(e.path),sortBy:e.sortBy,sortOrder:e.sortOrder,query:e.query,fileTypes:e.fileTypes};return hu(ge({},n,t))},Bu=function(e){var t=ri("files");return{type:du.Set,payload:{complete:!0===e.last,offset:e.offset,files:e.files,hash:t}}},Mu=function(e){return{type:du.Loading,payload:{loading:e}}},Au=function(t,e,n,o,r){"done"===e.fileState.loading&&(t(Mu(n)),o.get(function(e){return e.fold(function(e){t(Mu("done")),t(Su(e.message))},function(e){t(Mu("done")),r(e)})}))},_u=function(e,t,n,o){Au(e,t,"reload",n,o)},Nu=function(e,t,n,o){Au(e,t,"new",n,o)},zu=function(t,e,n){var o=Eu(n,e().viewType,Lu(e(),{offset:0}));_u(t,e(),o,function(e){return t(Bu(e))})},Hu=function(n,o,r){var e=Eu(r,o().viewType,Lu(o(),{offset:0}));_u(n,o(),e,function(t){n(Bu(t)),o().preview.each(function(e){return Du(t.files,e.file.uuid)(n,o,r)})})},Ru=function(o,e,t){if(!1===e().fileState.complete){var n=Eu(t,e().viewType,Lu(e(),{offset:e().fileState.offset}));Au(o,e(),"append",n,function(e){return o((t=e,n=ri("files"),{type:du.Append,payload:{complete:!0===t.last,offset:t.offset,files:t.files,hash:n}}));var t,n})}},Vu=function(i){return function(t,e,n){var o=B.from(i).filter(function(e){return 0<e.length});o.fold(function(){t({type:ku.Clear,payload:{query:i}})},function(){t({type:ku.Set,payload:{query:i}})});var r=Eu(n,e().viewType,Lu(e(),{query:o}));Nu(t,e(),r,function(e){return t(Bu(e))})}};(Iu||(Iu={})).SetListType="listType.set";var Pu,ju,Uu,Gu=function(e){return{type:Uo.SetOrderByField,payload:{field:e}}},Wu=function(i){return function(n,e,t){var o=e().sortBy===i?"asc"===e().sortOrder?"desc":"asc":"asc",r=Eu(t,e().viewType,Lu(e(),{sortOrder:o,sortBy:i}));_u(n,e(),r,function(e){var t;n(Gu(i)),n((t=o,{type:lu.SetSortOrder,payload:{sortOrder:t}})),n(Bu(e))})}},qu=function(r){return function(t,e,n){var o=Eu(n,e().viewType,Lu(e(),{}));Nu(t,e(),o,function(e){t(Gu("name")),t({type:Iu.SetListType,payload:{listType:r}}),t(Bu(e))})}},Ku=function(n){return{schema:lt([At("state"),At("oldState")]),onReceive:function(e,t){e.getSystem().isConnected()&&n(e,t)}}},Yu=function(e,t){e.getSystem().isConnected()&&_o(e,"action",{data:t})},Ju=function(e){var n=B.none(),t=[],o=function(e){r()?u(e):t.push(e)},r=function(){return n.isSome()},i=function(e){R(e,u)},u=function(t){n.each(function(e){L.setTimeout(function(){t(e)},0)})};return e(function(e){n=B.some(e),i(t),t=[]}),{get:o,map:function(n){return Ju(function(t){o(function(e){t(n(e))})})},isReady:r}},Zu={nu:Ju,pure:function(t){return Ju(function(e){e(t)})}},Xu=function(t){var e=function(e){var o;t((o=e,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;L.setTimeout(function(){o.apply(n,e)},0)}))},n=function(){return Zu.nu(e)};return{map:function(o){return Xu(function(n){e(function(e){var t=o(e);n(t)})})},bind:function(n){return Xu(function(t){e(function(e){n(e).get(t)})})},anonBind:function(n){return Xu(function(t){e(function(e){n.get(t)})})},toLazy:n,toCached:function(){var t=null;return Xu(function(e){null===t&&(t=n()),t.get(e)})},get:e}},$u={nu:Xu,pure:function(t){return Xu(function(e){e(t)})}},Qu=function(u,e){return e(function(o){var r=[],i=0;0===u.length?o([]):R(u,function(e,t){var n;e.get((n=t,function(e){r[n]=e,++i>=u.length&&o(r)}))})})},ea=function(e){return Qu(e,$u.nu)},ta=function(i){return qn({},i,{toCached:function(){return ta(i.toCached())},bindFuture:function(t){return ta(i.bind(function(e){return e.fold(function(e){return $u.pure(M.error(e))},function(e){return t(e)})}))},bindResult:function(t){return ta(i.map(function(e){return e.bind(t)}))},mapResult:function(t){return ta(i.map(function(e){return e.map(t)}))},mapError:function(t){return ta(i.map(function(e){return e.mapError(t)}))},foldResult:function(t,n){return i.map(function(e){return e.fold(t,n)})},withTimeout:function(e,r){return ta($u.nu(function(t){var n=!1,o=L.setTimeout(function(){n=!0,t(M.error(r()))},e);i.get(function(e){n||(L.clearTimeout(o),t(e))})}))}})},na=function(e){return ta($u.nu(e))},oa=function(e){return ta($u.pure(M.value(e)))},ra=na,ia=oa,ua=oa,aa=function(e){return ta($u.pure(M.error(e)))},ca=function(e){return na(function(t){e.then(function(e){t(M.value(e))},function(e){t(M.error(e))})})},sa=function(){return se(Xe,"tinymce").or(se(Xe,"tinydrive")).getOrThunk(function(){var e={};return Xe.tinydrive=e})},fa=function(n,o){return ra(function(e){var t=Bn.fromTag("script");Kr(t,qn({src:n},o)),su(t,"load",function(){e(M.value(t))}),su(t,"error",function(){e(M.error("Failed to load script: "+n))}),Vr(Zo(),t)})},la="_assetManagerProvider";ra(function(e){sa()[la]=e});(ju=Pu||(Pu={})).DownloadFiles="external.download",ju.Exit="external.exit",(Uu||(Uu={})).InsertFiles="insert.insertFiles";var da,ma;(ma=da||(da={})).PushPathItem="path.push",ma.Slice="path.slice";var pa;(pa||(pa={})).SetViewType="viewType.set";var ga,ha;(ha=ga||(ga={})).Push="clipboard.push",ha.SetOperation="clipboard.setOperation",ha.Clear="clipboard.clear";var va;(va||(va={})).UploadProgress="upload.progress";var ya,ba=function(e,t){return e.uuid===t.uuid},wa=function(e,t){return{lastUpdate:B.some(new Date),files:(n=t.files,o=e,V(n,function(e){return!1===ba(e,o)}))};var n,o},xa=function(o,r){var e=j(r.files,function(e){return e.uuid===o.uuid}).fold(function(){return r.files.concat([o])},function(e){return t=r.files,n=o,H(t,function(e){return ba(e,n)?n:e});var t,n});return{lastUpdate:B.some(new Date),files:e}},Sa=(ya={notifications:function(e,t){switch(t.type){case pu.Add:return e.concat([t.payload.notification]);case pu.Remove:return V(e,function(e){return e.data.uid!==t.payload.uid});default:return e}},viewType:function(e,t){switch(t.type){case pa.SetViewType:return t.payload.viewType;default:return e}},listType:function(e,t){switch(t.type){case Iu.SetListType:return t.payload.listType;default:return e}},fileState:function(e,t){switch(t.type){case du.Loading:return"new"===t.payload.loading||"reload"===t.payload.loading?{loading:t.payload.loading,complete:e.complete,offset:0,files:[],hash:e.hash}:{loading:t.payload.loading,complete:e.complete,offset:e.offset,files:e.files,hash:e.hash};case du.Set:return{loading:e.loading,complete:t.payload.complete,offset:t.payload.offset,files:t.payload.files,hash:t.payload.hash};case du.Append:return{loading:e.loading,complete:t.payload.complete,offset:t.payload.offset,files:e.files.concat(t.payload.files),hash:t.payload.hash};case du.Add:var n=e.files.concat([t.payload.file]);return{loading:e.loading,complete:!0,offset:e.files.length,files:n,hash:t.payload.hash};case du.Remove:var o=V(e.files,function(e){return e.uuid!==t.payload.uuid});return{loading:e.loading,complete:!0,offset:e.files.length,files:o,hash:t.payload.hash};default:return e}},selectedFiles:function(e,t){switch(t.type){case"selectedFiles.set":return t.payload.files;case"selectedFiles.select":return e.concat([t.payload.file]);case"selectedFiles.unselect":return V(e,function(e){return e.uuid!==t.payload.uuid});case"selectedFiles.selectAll":return t.payload.files;case"selectedFiles.clear":return[];default:return e}},sortBy:function(e,t){switch(t.type){case Uo.SetOrderByField:return t.payload.field;default:return e}},sortOrder:function(e,t){switch(t.type){case lu.SetSortOrder:return t.payload.sortOrder;default:return e}},upload:function(e,t){switch(t.type){case va.UploadProgress:return n=t.payload,o=e,(r=n).loaded===r.total?wa(n,o):xa(n,o);default:return e}var n,o,r},path:function(e,t){switch(t.type){case da.PushPathItem:return e.concat(t.payload.pathItem);case da.Slice:return e.slice(0,t.payload.index);default:return e}},clipboard:function(e,t){switch(t.type){case ga.Push:return B.some({operation:t.payload.operation,files:t.payload.files});case ga.Clear:return B.none();default:return e}},preview:function(e,t){switch(t.type){case wu.Open:return B.some({file:t.payload.file,meta:t.payload.meta,dimensions:e.bind(function(e){return e.dimensions})});case wu.Close:return B.none();case wu.SetDimensions:return e.map(function(e){return qn({},e,{dimensions:t.payload.dimensions})});case wu.SetDescription:return e.map(function(e){return qn({},e,{meta:qn({},e.meta,{description:t.payload.description})})});default:return e}},query:function(e,t){switch(t.type){case ku.Set:return B.some(t.payload.query);case ku.Clear:return B.none();default:return e}},fileTypes:function(e,t){return e}},function(n,o){return Object.keys(ya).reduce(function(e,t){return e[t]=ya[t](n[t],o),e},{})}),Oa=function(e){for(var t=[],n=function(e){t.push(e)},o=0;o<e.length;o++)e[o].each(n);return t},ka=function(e,t){for(var n=0;n<e.length;n++){var o=t(e[n],n);if(o.isSome())return o}return B.none()};function Ta(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.pop();return function(e,t){for(var n=[],o=0;o<e.length;o++){var r=e[o];if(!r.isSome())return B.none();n.push(r.getOrDie())}return B.some(t.apply(null,n))}(e,n)}var Fa,Da,Ca="unknown";(Da=Fa||(Fa={}))[Da.STOP=0]="STOP",Da[Da.NORMAL=1]="NORMAL",Da[Da.LOGGING=2]="LOGGING";var Ia=Fr({}),Ea=function(t,e,n){var o,r,i,u;switch(Ie(Ia.get(),t).orThunk(function(){var e=ne(Ia.get());return ka(e,function(e){return-1<t.indexOf(e)?B.some(Ia.get()[e]):B.none()})}).getOr(Fa.NORMAL)){case Fa.NORMAL:return n(Ma());case Fa.LOGGING:var a=(o=t,r=e,i=[],u=(new Date).getTime(),{logEventCut:function(e,t,n){i.push({outcome:"cut",target:t,purpose:n})},logEventStopped:function(e,t,n){i.push({outcome:"stopped",target:t,purpose:n})},logNoParent:function(e,t,n){i.push({outcome:"no-parent",target:t,purpose:n})},logEventNoHandlers:function(e,t){i.push({outcome:"no-handlers-left",target:t})},logEventResponse:function(e,t,n){i.push({outcome:"response",purpose:n,target:t})},write:function(){var e=(new Date).getTime();N(["mousemove","mouseover","mouseout",Do()],o)||L.console.log(o,{event:o,time:e-u,target:r.dom(),sequence:H(i,function(e){return N(["cut","stopped","response"],e.outcome)?"{"+e.purpose+"} "+e.outcome+" at ("+ei(e.target)+")":e.outcome})})}}),c=n(a);return a.write(),c;case Fa.STOP:return!0}},La=["alloy/data/Fields","alloy/debugging/Debugging"],Ba=function(e,t,n){return Ea(e,t,n)},Ma=U({logEventCut:b,logEventStopped:b,logNoParent:b,logEventNoHandlers:b,logEventResponse:b,write:b}),Aa=U([At("menu"),At("selectedMenu")]),_a=U([At("item"),At("selectedItem")]),Na=(U(lt(_a().concat(Aa()))),U(lt(_a()))),za=Pt("initSize",[At("numColumns"),At("numRows")]),Ha=function(){return Pt("markers",[At("backgroundMenu")].concat(Aa()).concat(_a()))},Ra=function(e,t,n){!function(){var e=new Error;if(void 0===e.stack)return;var t=e.stack.split("\n");j(t,function(t){return 0<t.indexOf("alloy")&&!z(La,function(e){return-1<t.indexOf(e)})}).getOr(Ca)}();return ht(t,t,n,wt(function(n){return M.value(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.apply(void 0,e)})}))},Va=function(e){return Ra(0,e,ye(b))},Pa=function(e){return Ra(0,e,ye(B.none))},ja=function(e){return Ra(0,e,be())},Ua=function(e){return Ra(0,e,be())},Ga=function(e,t){return $t(e,U(t))},Wa=function(e){return $t(e,m)},qa=U(za),Ka="placeholder",Ya=le([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Ja=function(e,t,n,o){return n.uiType===Ka?(i=n,u=o,(r=e).exists(function(e){return e!==i.owner})?Ya.single(!0,U(i)):Ie(u,i.name).fold(function(){throw new Error("Unknown placeholder component: "+i.name+"\nKnown: ["+ne(u)+"]\nNamespace: "+r.getOr("none")+"\nSpec: "+nt(i,null,2))},function(e){return e.replace()})):Ya.single(!1,U(n));var r,i,u},Za=function(i,u,a,c){return Ja(i,0,a,c).fold(function(e,t){var n=t(u,a.config,a.validated),o=Ie(n,"components").getOr([]),r=J(o,function(e){return Za(i,u,e,c)});return[qn({},n,{components:r})]},function(e,t){var n=t(u,a.config,a.validated);return a.validated.preprocess.getOr(m)(n)})},Xa=function(t,n,e,o){var r,i,u,a=ie(o,function(e,t){return o=e,r=!1,{name:U(n=t),required:function(){return o.fold(function(e,t){return e},function(e,t){return e})},used:function(){return r},replace:function(){if(!0===r)throw new Error("Trying to use the same placeholder more than once: "+n);return r=!0,o}};var n,o,r}),c=(r=t,i=n,u=a,J(e,function(e){return Za(r,i,e,u)}));return re(a,function(e){if(!1===e.used()&&e.required())throw new Error("Placeholder: "+e.name()+" was not found in components list\nNamespace: "+t.getOr("none")+"\nComponents: "+nt(n.components,null,2))}),c},$a=Ya.single,Qa=Ya.multiple,ec=U(Ka),tc=le([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),nc=qt("factory",{sketch:m}),oc=qt("schema",[]),rc=At("name"),ic=ht("pname","pname",xe(function(e){return"<alloy."+ri(e.name)+">"}),Dt()),uc=$t("schema",function(){return[jt("preprocess")]}),ac=qt("defaults",U({})),cc=qt("overrides",U({})),sc=lt([nc,oc,rc,ic,ac,cc]),fc=lt([nc,oc,rc,ac,cc]),lc=lt([nc,oc,rc,ic,ac,cc]),dc=lt([nc,uc,rc,At("unit"),ic,ac,cc]),mc=function(e){var t=function(e){return e.name};return e.fold(t,t,t,t)},pc=function(n,o){return function(e){var t=kt("Converting part type",o,e);return n(t)}},gc=pc(tc.required,sc),hc=pc(tc.external,fc),vc=pc(tc.optional,lc),yc=pc(tc.group,dc),bc=U("entirety"),wc=function(e,t,n,o){return pe(t.defaults(e,n,o),n,{uid:e.partUids[t.name]},t.overrides(e,n,o))},xc=function(r,e){var i={};return R(e,function(e){var t;(t=e,t.fold(B.some,B.none,B.some,B.some)).each(function(n){var o=Sc(r,n.pname);i[n.name]=function(e){var t=kt("Part: "+n.name+" in "+r,lt(n.schema),e);return qn({},o,{config:e,validated:t})}})}),i},Sc=function(e,t){return{uiType:ec(),owner:e,name:t}},Oc=function(e,t,n){return o=t,i={},r={},R(n,function(e){e.fold(function(o){i[o.pname]=$a(!0,function(e,t,n){return o.factory.sketch(wc(e,o,t,n))})},function(e){var t=o.parts[e.name];r[e.name]=U(e.factory.sketch(wc(o,e,t[bc()]),t))},function(o){i[o.pname]=$a(!1,function(e,t,n){return o.factory.sketch(wc(e,o,t,n))})},function(r){i[r.pname]=Qa(!0,function(t,e,n){var o=t[r.name];return H(o,function(e){return r.factory.sketch(pe(r.defaults(t,e,n),e,r.overrides(t,e)))})})})}),{internals:U(i),externals:U(r)};var o,i,r},kc=function(e,t,n){return Xa(B.some(e),t,t.components,n)},Tc=function(e,t,n){var o=t.partUids[n];return e.getSystem().getByUid(o).toOption()},Fc=function(e,t,n){return Tc(e,t,n).getOrDie("Could not find part: "+n)},Dc=function(t,e){var n=H(e,mc);return Le(H(n,function(e){return{key:e,value:t+"-"+e}}))},Cc=function(t){return ht("partUids","partUids",Se(function(e){return Dc(e.uid,t)}),Dt())},Ic=function(e,t,n,o,r){var i,u,a=(u=r,(0<(i=o).length?[Pt("parts",i)]:[]).concat([At("uid"),qt("dom",{}),qt("components",[]),Wa("originalSpec"),qt("debug.sketcher",{})]).concat(u));return kt(e+" [SpecSchema]",ft(a.concat(t)),n)},Ec=function(e,t,n,o,r){var i=Lc(r),u=J(n,function(e){return e.fold(B.none,B.some,B.none,B.none).map(function(e){return Pt(e.name,e.schema.concat([Wa(bc())]))}).toArray()}),a=Cc(n),c=Ic(e,t,i,u,[a]),s=Oc(0,c,n);return o(c,kc(e,c,s.internals()),i,s.externals())},Lc=function(e){return e.hasOwnProperty("uid")?e:qn({},e,{uid:li("uid")})};var Bc=ft([At("name"),At("factory"),At("configFields"),qt("apis",{}),qt("extraApis",{})]),Mc=ft([At("name"),At("factory"),At("configFields"),At("partFields"),qt("apis",{}),qt("extraApis",{})]),Ac=function(e){var i=kt("Sketcher for "+e.name,Bc,e),t=ie(i.apis,vi),n=ie(i.extraApis,function(e,t){return dr(e,t)});return qn({name:U(i.name),partFields:U([]),configFields:U(i.configFields),sketch:function(e){return t=i.name,n=i.configFields,o=i.factory,r=Lc(e),o(Ic(t,n,r,[],[]),r);var t,n,o,r}},t,n)},_c=function(e){var t=kt("Sketcher for "+e.name,Mc,e),n=xc(t.name,t.partFields),o=ie(t.apis,vi),r=ie(t.extraApis,function(e,t){return dr(e,t)});return qn({name:U(t.name),partFields:U(t.partFields),configFields:U(t.configFields),sketch:function(e){return Ec(t.name,t.configFields,t.partFields,t.factory,e)},parts:U(n)},o,r)},Nc=function(t,e){return n=t,o={},r=H(e,function(e){return Vt(e.name(),"Cannot configure "+e.name()+" for "+t)}).concat([$t("dump",m)]),Kt(n,o,lt(r));var n,o,r},zc=function(e){return e.dump},Hc=function(e,t){return qn({},e.dump,br(t))},Rc=Nc,Vc=Hc,Pc=Ac({name:"Container",factory:function(e){var t=e.dom,n=t.attributes,o=Kn(t,["attributes"]);return{uid:e.uid,dom:qn({tag:"div",attributes:qn({role:"presentation"},n)},o),components:e.components,behaviours:zc(e.containerBehaviours),events:e.events,domModification:e.domModification,eventOrder:e.eventOrder}},configFields:[qt("components",[]),Nc("containerBehaviours",[]),qt("events",{}),qt("domModification",{}),qt("eventOrder",{})]}),jc=Object.freeze({events:function(a){return nr([or(wo(),function(r,i){var e,t,u=a.channels,n=ne(u),o=(e=n,(t=i).universal()?e:V(e,function(e){return N(t.channels(),e)}));R(o,function(e){var t=u[e],n=t.schema,o=kt("channel["+e+"] data\nReceiver: "+ei(r.element()),n,i.data());t.onReceive(r,o)})})])}}),Uc=[_t("channels",xt(M.value,ft([ja("onReceive"),qt("schema",Dt())])))],Gc=xr({fields:Uc,name:"receiving",active:jc}),Wc=function(e){e.dom().focus()},qc=function(e){var t=void 0!==e?e.dom():L.document;return B.from(t.activeElement).map(Bn.fromDom)},Kc=function(t){return qc(Lr(t)).filter(function(e){return t.dom().contains(e.dom())})},Yc=function(e){Ao(e,Io());var t=e.components();R(t,Yc)},Jc=function(e){var t=e.components();R(t,Jc),Ao(e,Co())},Zc=function(e,t){Xc(e,t,Vr)},Xc=function(e,t,n){e.getSystem().addToWorld(t),n(e.element(),t.element()),Jo(e.element())&&Jc(t),e.syncComponents()},$c=function(e){Yc(e),Ur(e.element()),e.getSystem().removeFromWorld(e)},Qc=function(t){var e=Mr(t.element()).bind(function(e){return t.getSystem().getByDom(e).fold(B.none,B.some)});$c(t),e.each(function(e){e.syncComponents()})},es=function(e){var t=e.components();R(t,$c),jr(e.element()),e.syncComponents()},ts=function(e,t){ns(e,t,Vr)},ns=function(e,t,n){n(e,t.element());var o=_r(t.element());R(o,function(e){t.getByDom(e).each(Jc)})},os=function(e,t,n,o){var r=e.getSystem().build(o);Xc(e,r,n)},rs=function(e,t,n,o){var r=is(e);j(r,function(e){return Pn(o.element(),e.element())}).each(Qc)},is=function(e,t){return e.components()},us=function(t,e,n,r,o){var i=is(t);return B.from(i[r]).map(function(e){return rs(t,0,0,e),o.each(function(e){os(t,0,function(e,t){var n,o;o=t,Nr(n=e,r).fold(function(){Vr(n,o)},function(e){Hr(e,o)})},e)}),e})},as=xr({fields:[],name:"replacing",apis:Object.freeze({append:function(e,t,n,o){os(e,0,Vr,o)},prepend:function(e,t,n,o){os(e,0,Rr,o)},remove:rs,replaceAt:us,replaceBy:function(t,e,n,o,r){var i=is(t);return W(i,o).bind(function(e){return us(t,0,0,e,r)})},set:function(t,e,n,o){var r,i,u,a;es(t),r=function(){var e=H(o,t.getSystem().build);R(e,function(e){Zc(t,e)})},i=t.element(),u=Lr(i),a=qc(u).bind(function(t){var e=function(e){return Pn(t,e)};return e(i)?B.some(i):er(i,e)}),r(i),a.each(function(t){qc(u).filter(function(e){return Pn(e,t)}).fold(function(){Wc(t)},b)})},contents:is})}),cs=function(e){var t=void 0!==e.uid&&Me(e,"uid")?e.uid:li("memento");return{get:function(e){return e.getSystem().getByUid(t).getOrDie()},getOpt:function(e){return e.getSystem().getByUid(t).fold(B.none,B.some)},asSpec:function(){return qn({},e,{uid:t})}}},ss=function(e,t,n){var o=t.aria;o.update(e,o,n.get())},fs=function(t,e,n){e.toggleClass.each(function(e){n.get()?Li(t.element(),e):Mi(t.element(),e)})},ls=function(e,t,n){ps(e,t,n,!n.get())},ds=function(e,t,n){n.set(!0),fs(e,t,n),ss(e,t,n)},ms=function(e,t,n){n.set(!1),fs(e,t,n),ss(e,t,n)},ps=function(e,t,n,o){(o?ds:ms)(e,t,n)},gs=function(e,t,n){ps(e,t,n,t.selected)},hs=Object.freeze({onLoad:gs,toggle:ls,isOn:function(e,t,n){return n.get()},on:ds,off:ms,set:ps}),vs=Object.freeze({exhibit:function(e,t,n){return mr({})},events:function(e,t){var n,o,r,i=(n=e,o=t,r=ls,fr(function(e){r(e,n,o)})),u=pr(e,t,gs);return nr(Y([e.toggleOnExecute?[i]:[],[u]]))}}),ys=function(e){return{init:function(){var t=Fr(e);return{get:function(){return t.get()},set:function(e){return t.set(e)},clear:function(){return t.set(e)},readState:function(){return t.get()}}}}},bs=function(e,t,n){qr(e.element(),"aria-expanded",n)},ws=[qt("selected",!1),jt("toggleClass"),qt("toggleOnExecute",!0),Kt("aria",{mode:"none"},Ft("mode",{pressed:[qt("syncWithExpanded",!1),Ga("update",function(e,t,n){qr(e.element(),"aria-pressed",n),t.syncWithExpanded&&bs(e,t,n)})],checked:[Ga("update",function(e,t,n){qr(e.element(),"aria-checked",n)})],expanded:[Ga("update",bs)],selected:[Ga("update",function(e,t,n){qr(e.element(),"aria-selected",n)})],none:[Ga("update",b)]}))],xs=xr({fields:ws,name:"toggling",active:vs,apis:hs,state:ys(!1)});function Ss(o,r){var e=function(e){var t=r(e);if(t<=0||null===t){var n=ji(e,o);return parseFloat(n)||0}return t},i=function(r,e){return G(e,function(e,t){var n=ji(r,t),o=void 0===n?0:parseInt(n,10);return isNaN(o)?e:e+o},0)};return{set:function(e,t){if(!E(t)&&!t.match(/^[0-9]+$/))throw new Error(o+".set accepts only positive integer values. Value was "+t);var n=e.dom();zi(n)&&(n.style[o]=t+"px")},get:e,getOuter:e,aggregate:i,max:function(e,t,n){var o=i(e,n);return o<t?t-o:0}}}var Os,ks,Ts,Fs=Ss("height",function(e){var t=e.dom();return Jo(e)?t.getBoundingClientRect().height:t.offsetHeight}),Ds=function(e){return Fs.getOuter(e)},Cs=function(e,t){return Vn(t,e)},Is=function(e,t,n){return $o(e,function(e){return Hn(e,t)},n)},Es=function(e,t){return n=t,r=void 0===(o=e)?L.document:o.dom(),Rn(r)?B.none():B.from(r.querySelector(n)).map(Bn.fromDom);var n,o,r},Ls=function(e,t,n){return Ro(Hn,Is,e,t,n)},Bs=function(e,t,n){var o=X(e.slice(0,t)),r=X(e.slice(t+1));return j(o.concat(r),n)},Ms=function(e,t,n){var o=X(e.slice(0,t));return j(o,n)},As=function(e,t,n){var o=e.slice(0,t),r=e.slice(t+1);return j(r.concat(o),n)},_s=function(e,t,n){var o=e.slice(t+1);return j(o,n)},Ns=function(n){return function(e){var t=e.raw();return N(n,t.which)}},zs=function(e){return function(t){return Z(e,function(e){return e(t)})}},Hs=function(e){return!0===e.raw().shiftKey},Rs=function(e){return!0===e.raw().ctrlKey},Vs=(Os=Hs,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!Os.apply(null,e)}),Ps=function(e,t){return{matches:e,classification:t}},js=function(e,t,n,o){var r=e+t;return o<r?n:r<n?o:r},Us=function(e,t,n){return e<=t?t:n<=e?n:e},Gs=function(n,o,e,r){var t=Cs(n.element(),"."+o.highlightClass);R(t,function(t){z(r,function(e){return e.element()===t})||(Mi(t,o.highlightClass),n.getSystem().getByDom(t).each(function(e){o.onDehighlight(n,e),Ao(e,Mo())}))})},Ws=function(e,t,n,o){Gs(e,t,0,[o]),qs(e,t,n,o)||(Li(o.element(),t.highlightClass),t.onHighlight(e,o),Ao(o,Bo()))},qs=function(e,t,n,o){return Ai(o.element(),t.highlightClass)},Ks=function(e,t,n,o){var r=Cs(e.element(),"."+t.itemClass);return B.from(r[o]).fold(function(){return M.error("No element found with index "+o)},e.getSystem().getByDom)},Ys=function(t,e,n){return Es(t.element(),"."+e.itemClass).bind(function(e){return t.getSystem().getByDom(e).toOption()})},Js=function(t,e,n){var o=Cs(t.element(),"."+e.itemClass);return(0<o.length?B.some(o[o.length-1]):B.none()).bind(function(e){return t.getSystem().getByDom(e).toOption()})},Zs=function(n,t,e,o){var r=Cs(n.element(),"."+t.itemClass);return W(r,function(e){return Ai(e,t.highlightClass)}).bind(function(e){var t=js(e,o,0,r.length-1);return n.getSystem().getByDom(r[t]).toOption()})},Xs=function(t,e,n){var o=Cs(t.element(),"."+e.itemClass);return Oa(H(o,function(e){return t.getSystem().getByDom(e).toOption()}))},$s=Object.freeze({dehighlightAll:function(e,t,n){return Gs(e,t,0,[])},dehighlight:function(e,t,n,o){qs(e,t,n,o)&&(Mi(o.element(),t.highlightClass),t.onDehighlight(e,o),Ao(o,Mo()))},highlight:Ws,highlightFirst:function(t,n,o){Ys(t,n).each(function(e){Ws(t,n,o,e)})},highlightLast:function(t,n,o){Js(t,n).each(function(e){Ws(t,n,o,e)})},highlightAt:function(t,n,o,e){Ks(t,n,o,e).fold(function(e){throw new Error(e)},function(e){Ws(t,n,o,e)})},highlightBy:function(t,n,o,e){var r=Xs(t,n);j(r,e).each(function(e){Ws(t,n,o,e)})},isHighlighted:qs,getHighlighted:function(t,e,n){return Es(t.element(),"."+e.highlightClass).bind(function(e){return t.getSystem().getByDom(e).toOption()})},getFirst:Ys,getLast:Js,getPrevious:function(e,t,n){return Zs(e,t,0,-1)},getNext:function(e,t,n){return Zs(e,t,0,1)},getCandidates:Xs}),Qs=[At("highlightClass"),At("itemClass"),Va("onHighlight"),Va("onDehighlight")],ef=xr({fields:Qs,name:"highlighting",apis:$s}),tf=function(e,t,n){t.exists(function(t){return n.exists(function(e){return Pn(e,t)})})||_o(e,Lo(),{prevFocus:t,newFocus:n})},nf=function(){var r=function(e){return Kc(e.element())};return{get:r,set:function(e,t){var n=r(e);e.getSystem().triggerFocus(t,e.element());var o=r(e);tf(e,n,o)}}};(Ts=ks||(ks={})).OnFocusMode="onFocus",Ts.OnEnterOrSpaceMode="onEnterOrSpace",Ts.OnApiMode="onApi";var of=function(e,t,n,o,a){var c=function(t,n,e,o,r){var i,u,a=e(t,n,o,r);return(i=a,u=n.event(),j(i,function(e){return e.matches(u)}).map(function(e){return e.classification})).bind(function(e){return e(t,n,o,r)})},r={schema:function(){return e.concat([qt("focusManager",nf()),Kt("focusInside","onFocus",wt(function(e){return N(["onFocus","onEnterOrSpace","onApi"],e)?M.value(e):M.error("Invalid value for focusInside")})),Ga("handler",r),Ga("state",t),Ga("sendFocusIn",a)])},processKey:c,toEvents:function(i,u){var e=i.focusInside!==ks.OnFocusMode?B.none():a(i).map(function(n){return or(vo(),function(e,t){n(e,i,u),t.stop()})});return nr(e.toArray().concat([or(ro(),function(o,r){c(o,r,n,i,u).fold(function(){var t,n,e;t=o,n=r,e=Ns([32].concat([13]))(n.event()),i.focusInside===ks.OnEnterOrSpaceMode&&e&&Un(t,n)&&a(i).each(function(e){e(t,i,u),n.stop()})},function(e){r.stop()})}),or(io(),function(e,t){c(e,t,o,i,u).each(function(e){t.stop()})})]))}};return r},rf=function(e){var t=[jt("onEscape"),jt("onEnter"),qt("selector",'[data-alloy-tabstop="true"]'),qt("firstTabstop",0),qt("useTabstopAt",U(!0)),jt("visibilitySelector")].concat([e]),u=function(e,t){var n,o=e.visibilitySelector.bind(function(e){return Ls(t,e)}).getOr(t);return n=o,0<Fs.get(n)},n=function(t,n){var e,o,r,i;(e=t,o=n,r=Cs(e.element(),o.selector),i=V(r,function(e){return u(o,e)}),B.from(i[o.firstTabstop])).each(function(e){n.focusManager.set(t,e)})},a=function(t,e,n,o,r){return r(e,n,function(e){return u(t=o,n=e)&&t.useTabstopAt(n);var t,n}).fold(function(){return o.cyclic?B.some(!0):B.none()},function(e){return o.focusManager.set(t,e),B.some(!0)})},i=function(t,e,n,o){var r,i,u=Cs(t.element(),n.selector);return(r=t,i=n,i.focusManager.get(r).bind(function(e){return Ls(e,i.selector)})).bind(function(e){return W(u,l(Pn,e)).bind(function(e){return a(t,u,e,n,o)})})},o=U([Ps(zs([Hs,Ns([9])]),function(e,t,n,o){var r=n.cyclic?Bs:Ms;return i(e,0,n,r)}),Ps(Ns([9]),function(e,t,n,o){var r=n.cyclic?As:_s;return i(e,0,n,r)}),Ps(Ns([27]),function(t,n,e,o){return e.onEscape.bind(function(e){return e(t,n)})}),Ps(zs([Vs,Ns([13])]),function(t,n,e,o){return e.onEnter.bind(function(e){return e(t,n)})})]),r=U([]);return of(t,Qt.init,o,r,function(){return B.some(n)})},uf=rf($t("cyclic",U(!1))),af=rf($t("cyclic",U(!0))),cf=function(e){return"input"===Go(e)&&"radio"!==Yr(e,"type")||"textarea"===Go(e)},sf=function(e,t,n){return cf(n)&&Ns([32])(t.event())?B.none():(zo(e,n,xo()),B.some(!0))},ff=function(e,t){return B.some(!0)},lf=[qt("execute",sf),qt("useSpace",!1),qt("useEnter",!0),qt("useControlEnter",!1),qt("useDown",!1)],df=function(e,t,n){return n.execute(e,t,e.element())},mf=of(lf,Qt.init,function(e,t,n,o){var r=n.useSpace&&!cf(e.element())?[32]:[],i=n.useEnter?[13]:[],u=n.useDown?[40]:[],a=r.concat(i).concat(u);return[Ps(Ns(a),df)].concat(n.useControlEnter?[Ps(zs([Rs,Ns([13])]),df)]:[])},function(e,t,n,o){return n.useSpace&&!cf(e.element())?[Ps(Ns([32]),ff)]:[]},function(){return B.none()}),pf=function(e){var n=Fr(B.none());return en({readState:function(){return n.get().map(function(e){return{numRows:e.numRows(),numColumns:e.numColumns()}}).getOr({numRows:"?",numColumns:"?"})},setGridSize:function(e,t){n.set(B.some({numRows:U(e),numColumns:U(t)}))},getNumRows:function(){return n.get().map(function(e){return e.numRows()})},getNumColumns:function(){return n.get().map(function(e){return e.numColumns()})}})},gf=Object.freeze({flatgrid:pf,init:function(e){return e.state(e)}}),hf=function(t,n){return function(e){return"rtl"===vf(e)?n:t}},vf=function(e){return"rtl"===ji(e,"direction")?"rtl":"ltr"},yf=function(i){return function(e,t,n,o){var r=i(e.element());return Sf(r,e,t,n,o)}},bf=function(e,t){var n=hf(e,t);return yf(n)},wf=function(e,t){var n=hf(t,e);return yf(n)},xf=function(r){return function(e,t,n,o){return Sf(r,e,t,n,o)}},Sf=function(t,n,e,o,r){return o.focusManager.get(n).bind(function(e){return t(n.element(),e,o,r)}).map(function(e){return o.focusManager.set(n,e),!0})},Of=xf,kf=xf,Tf=xf,Ff=function(e){var t,n=e.dom();return!((t=n).offsetWidth<=0&&t.offsetHeight<=0)},Df=Er(["index","candidates"],[]),Cf=function(e,t,n){return If(e,t,n)},If=function(e,t,n,o){var r,i=l(Pn,t),u=o(Cs(e,n),Ff);return W(r=u,i).map(function(e){return Df({index:e,candidates:r})})},Ef=function(e,t){return W(e,function(e){return Pn(t,e)})},Lf=function(n,e,o,t){return t(Math.floor(e/o),e%o).bind(function(e){var t=e.row()*o+e.column();return 0<=t&&t<n.length?B.some(n[t]):B.none()})},Bf=function(r,e,i,u,a){return Lf(r,e,u,function(e,t){var n=e===i-1?r.length-e*u:u,o=js(t,a,0,n-1);return B.some({row:U(e),column:U(o)})})},Mf=function(i,e,u,a,c){return Lf(i,e,a,function(e,t){var n=js(e,c,0,u-1),o=n===u-1?i.length-n*a:a,r=Us(t,0,o-1);return B.some({row:U(n),column:U(r)})})},Af=[At("selector"),qt("execute",sf),Pa("onEscape"),qt("captureTab",!1),qa()],_f=function(t,n,e){Es(t.element(),n.selector).each(function(e){n.focusManager.set(t,e)})},Nf=function(r){return function(e,t,n,o){return Cf(e,t,n.selector).bind(function(e){return r(e.candidates(),e.index(),o.getNumRows().getOr(n.initSize.numRows),o.getNumColumns().getOr(n.initSize.numColumns))})}},zf=function(e,t,n,o){return n.captureTab?B.some(!0):B.none()},Hf=Nf(function(e,t,n,o){return Bf(e,t,n,o,-1)}),Rf=Nf(function(e,t,n,o){return Bf(e,t,n,o,1)}),Vf=Nf(function(e,t,n,o){return Mf(e,t,n,o,-1)}),Pf=Nf(function(e,t,n,o){return Mf(e,t,n,o,1)}),jf=U([Ps(Ns([37]),bf(Hf,Rf)),Ps(Ns([39]),wf(Hf,Rf)),Ps(Ns([38]),Of(Vf)),Ps(Ns([40]),kf(Pf)),Ps(zs([Hs,Ns([9])]),zf),Ps(zs([Vs,Ns([9])]),zf),Ps(Ns([27]),function(e,t,n,o){return n.onEscape(e,t)}),Ps(Ns([32].concat([13])),function(t,n,o,e){return(r=t,i=o,i.focusManager.get(r).bind(function(e){return Ls(e,i.selector)})).bind(function(e){return o.execute(t,n,e)});var r,i})]),Uf=U([Ps(Ns([32]),ff)]),Gf=of(Af,pf,jf,Uf,function(){return B.some(_f)}),Wf=function(e,t,n,i){var u=function(e,t,n){var o,r=js(t,i,0,n.length-1);return r===e?B.none():(o=n[r],"button"===Go(o)&&"disabled"===Yr(o,"disabled")?u(e,r,n):B.from(n[r]))};return Cf(e,n,t).bind(function(e){var t=e.index(),n=e.candidates();return u(t,t,n)})},qf=[At("selector"),qt("getInitial",B.none),qt("execute",sf),Pa("onEscape"),qt("executeOnMove",!1),qt("allowVertical",!0)],Kf=function(t,n,o){return(e=t,r=o,r.focusManager.get(e).bind(function(e){return Ls(e,r.selector)})).bind(function(e){return o.execute(t,n,e)});var e,r},Yf=function(t,n){n.getInitial(t).orThunk(function(){return Es(t.element(),n.selector)}).each(function(e){n.focusManager.set(t,e)})},Jf=function(e,t,n){return Wf(e,n.selector,t,-1)},Zf=function(e,t,n){return Wf(e,n.selector,t,1)},Xf=function(o){return function(e,t,n){return o(e,t,n).bind(function(){return n.executeOnMove?Kf(e,t,n):B.some(!0)})}},$f=function(e,t,n,o){return n.onEscape(e,t)},Qf=U([Ps(Ns([32]),ff)]),el=of(qf,Qt.init,function(e,t,n,o){var r=[37].concat(n.allowVertical?[38]:[]),i=[39].concat(n.allowVertical?[40]:[]);return[Ps(Ns(r),Xf(bf(Jf,Zf))),Ps(Ns(i),Xf(wf(Jf,Zf))),Ps(Ns([13]),Kf),Ps(Ns([32]),Kf),Ps(Ns([27]),$f)]},Qf,function(){return B.some(Yf)}),tl=Er(["rowIndex","columnIndex","cell"],[]),nl=function(e,t,n){return B.from(e[t]).bind(function(e){return B.from(e[n]).map(function(e){return tl({rowIndex:t,columnIndex:n,cell:e})})})},ol=function(e,t,n,o){var r=e[t].length,i=js(n,o,0,r-1);return nl(e,t,i)},rl=function(e,t,n,o){var r=js(n,o,0,e.length-1),i=e[r].length,u=Us(t,0,i-1);return nl(e,r,u)},il=function(e,t,n,o){var r=e[t].length,i=Us(n+o,0,r-1);return nl(e,t,i)},ul=function(e,t,n,o){var r=Us(n+o,0,e.length-1),i=e[r].length,u=Us(t,0,i-1);return nl(e,r,u)},al=[Pt("selectors",[At("row"),At("cell")]),qt("cycles",!0),qt("previousSelector",B.none),qt("execute",sf)],cl=function(t,n){n.previousSelector(t).orThunk(function(){var e=n.selectors;return Es(t.element(),e.cell)}).each(function(e){n.focusManager.set(t,e)})},sl=function(e,t){return function(n,o,i){var u=i.cycles?e:t;return Ls(o,i.selectors.row).bind(function(e){var t=Cs(e,i.selectors.cell);return Ef(t,o).bind(function(o){var r=Cs(n,i.selectors.row);return Ef(r,e).bind(function(e){var t,n=(t=i,H(r,function(e){return Cs(e,t.selectors.cell)}));return u(n,e,o).map(function(e){return e.cell()})})})})}},fl=sl(function(e,t,n){return ol(e,t,n,-1)},function(e,t,n){return il(e,t,n,-1)}),ll=sl(function(e,t,n){return ol(e,t,n,1)},function(e,t,n){return il(e,t,n,1)}),dl=sl(function(e,t,n){return rl(e,n,t,-1)},function(e,t,n){return ul(e,n,t,-1)}),ml=sl(function(e,t,n){return rl(e,n,t,1)},function(e,t,n){return ul(e,n,t,1)}),pl=U([Ps(Ns([37]),bf(fl,ll)),Ps(Ns([39]),wf(fl,ll)),Ps(Ns([38]),Of(dl)),Ps(Ns([40]),kf(ml)),Ps(Ns([32].concat([13])),function(t,n,o){return Kc(t.element()).bind(function(e){return o.execute(t,n,e)})})]),gl=U([Ps(Ns([32]),ff)]),hl=of(al,Qt.init,pl,gl,function(){return B.some(cl)}),vl=[At("selector"),qt("execute",sf),qt("moveOnTab",!1)],yl=function(t,n,o){return o.focusManager.get(t).bind(function(e){return o.execute(t,n,e)})},bl=function(t,n){Es(t.element(),n.selector).each(function(e){n.focusManager.set(t,e)})},wl=function(e,t,n){return Wf(e,n.selector,t,-1)},xl=function(e,t,n){return Wf(e,n.selector,t,1)},Sl=U([Ps(Ns([38]),Tf(wl)),Ps(Ns([40]),Tf(xl)),Ps(zs([Hs,Ns([9])]),function(e,t,n){return n.moveOnTab?Tf(wl)(e,t,n):B.none()}),Ps(zs([Vs,Ns([9])]),function(e,t,n){return n.moveOnTab?Tf(xl)(e,t,n):B.none()}),Ps(Ns([13]),yl),Ps(Ns([32]),yl)]),Ol=U([Ps(Ns([32]),ff)]),kl=of(vl,Qt.init,Sl,Ol,function(){return B.some(bl)}),Tl=[Pa("onSpace"),Pa("onEnter"),Pa("onShiftEnter"),Pa("onLeft"),Pa("onRight"),Pa("onTab"),Pa("onShiftTab"),Pa("onUp"),Pa("onDown"),Pa("onEscape"),qt("stopSpaceKeyup",!1),jt("focusIn")],Fl=of(Tl,Qt.init,function(e,t,n){return[Ps(Ns([32]),n.onSpace),Ps(zs([Vs,Ns([13])]),n.onEnter),Ps(zs([Hs,Ns([13])]),n.onShiftEnter),Ps(zs([Hs,Ns([9])]),n.onShiftTab),Ps(zs([Vs,Ns([9])]),n.onTab),Ps(Ns([38]),n.onUp),Ps(Ns([40]),n.onDown),Ps(Ns([37]),n.onLeft),Ps(Ns([39]),n.onRight),Ps(Ns([32]),n.onSpace),Ps(Ns([27]),n.onEscape)]},function(e,t,n){return n.stopSpaceKeyup?[Ps(Ns([32]),ff)]:[]},function(e){return e.focusIn}),Dl=uf.schema(),Cl=af.schema(),Il=el.schema(),El=Gf.schema(),Ll=hl.schema(),Bl=mf.schema(),Ml=kl.schema(),Al=Fl.schema(),_l=Or({branchKey:"mode",branches:Object.freeze({acyclic:Dl,cyclic:Cl,flow:Il,flatgrid:El,matrix:Ll,execution:Bl,menu:Ml,special:Al}),name:"keying",active:{events:function(e,t){return e.handler.toEvents(e,t)}},apis:{focusIn:function(t,n,o){n.sendFocusIn(n).fold(function(){t.getSystem().triggerFocus(t.element(),t.element())},function(e){e(t,n,o)})},setGridSize:function(e,t,n,o,r){Me(n,"setGridSize")?n.setGridSize(o,r):L.console.error("Layout does not support setGridSize")}},state:gf}),Nl=En.detect(),zl=function(e){return Nl.browser.isIE()?"text":e},Hl=function(e,t,n){var o,r,i,u,a,c=Nl.browser.isFirefox()&&Nl.browser.version.major<66;Nl.browser.isIE()||Nl.browser.isEdge()||c?(u=e,a=n,R(t,function(e){var t=zl(e);try{u.setData(t,a)}catch(e){}})):(r=t,i=n,(o=e).items.clear(),R(r,function(e){o.items.add(i,e)}))},Rl=function(e){return!C(e.setDragImage)},Vl=function(e,t){e.dropEffect=t},Pl=function(e){return e.event().raw().dataTransfer},jl=function(e,t){Vl(Pl(e),t)},Ul=En.detect(),Gl=function(e){var t=$r(e.element());return Pi(t,{position:"absolute",top:"-300px","max-width":"175px","max-height":"175px",overflow:"hidden"}),t},Wl=function(e,t,n){var o,r,i,u,a=Gl(n);Vr(t,a),o=e,r=a.dom(),i=n.x(),u=n.y(),Rl(o)&&o.setDragImage(r,i,u),L.setTimeout(function(){Ur(a)},0)},ql=function(n){var e=$r(n),t=H(["position","visibility"],function(e){return{name:e,value:Gi(n,e)}});Hr(n,e),Pi(n,{position:"fixed",visibility:"hidden"}),L.setTimeout(function(){R(t,function(t){t.value.fold(function(){return Wi(n,t.name)},function(e){return Vi(n,t.name,e)})}),Ur(e)},0)},Kl=function(e,t,n,o){var r,i,u,a,c,s;Rl(e)?Wl(e,n,t):Ul.browser.isEdge()?(r=t,i=n,u=o,a=Fr(B.none()),c=su(u,"drag",function(e){var t=e.x()+Math.max(r.x()+1,1),n=e.y()+Math.max(r.y()+1,1),o=a.get().getOrThunk(function(){var e=Gl(r);return a.set(B.some(e)),Pi(e,{position:"fixed",margin:"0",opacity:"0.6"}),qr(e,"role","presentation"),Vr(i,e),e});Pi(o,{left:t+"px",top:n+"px"})}),s=su(u,"dragend",function(e){a.get().each(Ur),c.unbind(),s.unbind()}),ql(u)):ql(o)},Yl=[Jt("type","text/plain"),qt("phoneyTypes",[]),Zt("effectAllowed","all",["copy","move","link","all","copyLink","linkMove","copyMove"]),Gt("getData"),Gt("getImageParent"),Gt("getImage"),Xt("canDrag",U(!0)),Xt("onDragstart",m),Xt("onDragover",m),Xt("onDragend",m),$t("instance",function(){return{exhibit:function(){return mr({attributes:{draggable:"true"}})},handlers:function(f){return nr([or(co(),f.onDragover),or(so(),f.onDragend),or(fo(),function(e,t){var o,r,i,u,n,a,c=t.event().target(),s=Pl(t);f.canDrag(e,c)?(o=e,r=c,n=u=s,a=(i=f).effectAllowed,n.effectAllowed=a,i.getData.each(function(e){var t=e(o),n=[i.type].concat(i.phoneyTypes);Hl(u,n,t)}),i.getImage.each(function(e){var t=e(o),n=i.getImageParent.fold(function(){return Mr(r).getOr(Zo())},function(e){return e(o)});Kl(u,t,n,r)}),f.onDragstart(e,t)):t.event().prevent()})])}}})],Jl=function(e,t){var n,o,r,i=t.event().raw().dataTransfer,u=(n=i,o=e.type,r=n.getData(zl(o)),F(r)?"":r),a=te(i.files);return qn({},t,{data:u,files:a})},Zl=Or({branchKey:"mode",branches:{drag:Yl,drop:[Jt("type","text/plain"),Zt("dropEffect","move",["copy","move","link","none"]),Va("onDrop"),Va("onDrag"),Va("onDragover"),Va("onDragenter"),Va("onDragleave"),$t("instance",function(){return{exhibit:function(){return mr({})},handlers:function(i){return nr([or(co(),function(e,t){t.stop(),jl(t,i.dropEffect),i.onDragover(e,t)}),or(lo(),i.onDragleave),or(go(),i.onDrag),or(mo(),function(e,t){var n=Pl(t);Vl(n,i.dropEffect),t.stop(),jl(t,i.dropEffect),i.onDragenter(e,t)}),or(po(),function(e,t){var n,o,r;t.stop(),jl(t,i.dropEffect),n=Pl(t),o=n.effectAllowed.toLowerCase(),r=n.dropEffect.toLowerCase(),("all"===o||"uninitialized"===o||On(o,r))&&i.onDrop(e,Jl(i,t))})])}}})]},name:"dragndrop",active:{exhibit:function(e,t){return t.instance.exhibit(e,t)},events:function(e){return e.instance.handlers(e)}}}),Xl=Object.freeze({exhibit:function(e,t){return mr({attributes:Le([{key:t.tabAttr,value:"true"}])})}}),$l=[qt("tabAttr","data-alloy-tabstop")],Ql=xr({fields:$l,name:"tabstopping",active:Xl}),ed=function(e,t){t.ignore||(Wc(e.element()),t.onFocus(e))},td=Object.freeze({focus:ed,blur:function(e,t){t.ignore||e.element().dom().blur()},isFocused:function(e){return t=e.element(),n=Lr(t).dom(),t.dom()===n.activeElement;var t,n}}),nd=Object.freeze({exhibit:function(e,t){var n=t.ignore?{}:{attributes:{tabindex:"-1"}};return mr(n)},events:function(n){return nr([or(vo(),function(e,t){ed(e,n),t.stop()})].concat(n.stopMousedown?[or(Xn(),function(e,t){t.event().prevent()})]:[]))}}),od=[Va("onFocus"),qt("stopMousedown",!1),qt("ignore",!1)],rd=xr({fields:od,name:"focusing",active:nd,apis:td}),id={AssetmanagerRoot:"tam-assetmanager-root",AssetmanagerModal:"tam-assetmanager-modal",AssetmanagerFullscreen:"tam-assetmanager-fullscreen",Checkbox:"tam-checkbox",CheckboxInput:"tam-checkbox-input",Checkbox__Input:"tam-checkbox__input",AssetmanagerAux:"tam-assetmanager-aux",MenuIcon:"tam-menu__icon",MenuLabel:"tam-menu__label",LocationIcon:"tam-location__icon",Location:"tam-location",NavbarContainer:"tam-navbar__main",LocationButton:"tam-location__button",LocationButtonLabel:"tam-location__button-label",LocationStarred:"tam-location--starred",LocationFiles:"tam-location--files",LocationSearchResult:"tam-location--search-result",LocationLabel:"tam-location__label",ButtonSelected:"tam-button--selected",Menu:"tam-menu",MenuHasIcons:"tam-menu--has-icons",Breadcrumb:"tam-breadcrumb",CheckboxIcons:"tam-checkbox__icons",CheckboxIconChecked:"tam-checkbox-icon__checked",CheckboxIconUnchecked:"tam-checkbox-icon__unchecked",AssetsHeaderTh:"tam-assets-header-th",AssetsHeaderButton:"tam-assets-header__button",DialogTitle:"tam-dialog__title",Button:"tam-button",ButtonIcon:"tam-button--icon",ButtonNaked:"tam-button--naked",DialogBody:"tam-dialog__body",ButtonSecondary:"tam-button--secondary",DialogFooter:"tam-dialog__footer",Dialog:"tam-dialog",DialogDialog:"tam-dialog__dialog",DialogHeader:"tam-dialog__header",DialogBackdrop:"tam-dialog__backdrop",Form:"tam-form",FormGroup:"tam-form-group",InputLabel:"tam-input-label",InputField:"tam-input-field",InputMsgError:"tam-input-msg--error",MenuSeparator:"tam-menu__separator",AssetActionMore:"tam-asset__action-more",Assets:"tam-assets",AssetsHidden:"tam-assets--hidden",AssetsContainer:"tam-assets-container",Grid:"tam-grid",List:"tam-list",Asset:"tam-asset",AssetBack:"tam-asset--back",AssetIconContainer:"tam-asset__icon-container",AssetMetadata:"tam-asset__metadata",AssetName:"tam-asset__name",AssetSize:"tam-asset__size",AssetDate:"tam-asset__date",AssetsHeaderButtonArrowDesc:"tam-assets-header__button-arrow-desc",AssetsHeaderThName:"tam-assets-header-th-name",AssetActionSelect:"tam-asset__action-select",AssetsHeader:"tam-assets-header",AssetThumbnailContainer:"tam-asset__thumbnail-container",Star:"tam-star",AssetActions:"tam-asset__actions",AssetActionPrimary:"tam-asset__action-primary",AssetFolder:"tam-asset--folder",AssetFile:"tam-asset--file",AssetSelected:"tam-asset--selected",Icon:"tam-icon",AssetIcon:"tam-asset__icon",AssetsHeaderButtonChevron:"tam-assets-header__button-chevron",AssetmanagerContainer:"tam-assetmanager-container",Assetmanager:"tam-assetmanager",AssetmanagerOpen:"tam-assetmanager-open",AssetmanagerHasToolbar:"tam-assetmanager-has-toolbar",MenuItem:"tam-menu__item",MenuSelected:"tam-menu--selected",MenuItemUnselected:"tam-menu--",MenuBackground:"tam-menu__background",MenuContainer:"tam-menu-container",MenuBackdrop:"tam-menu__backdrop",NavbarToolbarButton:"tam-navbar__toolbar-button",NavbarMainMode:"tam-navbar--main-mode",NavbarCopyMode:"tam-navbar--copy-mode",NavbarMoveMode:"tam-navbar--move-mode",NavbarSelectMode:"tam-navbar--select-mode",BreadcrumbSeparator:"tam-breadcrumb__separator",NavbarNavFilename:"tam-navbar-nav__filename",NavbarActions:"tam-navbar__actions",NavbarToolbar:"tam-navbar__toolbar",ButtonPrimary:"tam-button--primary",NavbarNav:"tam-navbar-nav",NavbarNavBack:"tam-navbar-nav__back",Navbar:"tam-navbar",Status:"tam-status",StatusError:"tam-status--error",StatusDismiss:"tam-status__dismiss",Notifications:"tam-notifications",PreviewContainer:"tam-preview-container",Preview:"tam-preview",PreviewImage:"tam-preview__image",PreviewIcon:"tam-preview__icon",PreviewVideo:"tam-preview__video",MenuItemSelected:"tam-menu__item--selected",MenuAccessory:"tam-menu__accessory",StaticValue:"tam-static-value",Details:"tam-details",Progressbar:"tam-progressbar",ProgressbarProgress:"tam-progressbar__progress",AssetmanagerBody:"tam-assetmanager-body",SearchExpanded:"tam-search--expanded",InputFieldSearchExpanded:"tam-input-field--search-expanded",InputFieldSearch:"tam-input-field--search",Search:"tam-search",SearchIcon:"tam-search__icon",SearchErrorMsg:"tam-search__error-msg",UploadDone:"tam-upload--done",UploadUploading:"tam-upload--uploading",UploadIdle:"tam-upload--idle",UploadLabel:"tam-upload__label",UploadIcon:"tam-upload__icon",Upload:"tam-upload",DropArea:"tam-droparea",DropAreaIcon:"tam-droparea__icon",DropAreaLabel:"tam-droparea__label",DropAreaShim:"tam-droparea__shim",InfiniteLoadingIndicator:"tam-assets__infinite-loading-indicator",Spinner:"tam-spinner",FocusStop:"tam-focus-stop",Wrap:"tam"},ud='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 11h6a1 1 0 0 1 0 2h-6v6a1 1 0 0 1-2 0v-6H5a1 1 0 0 1 0-2h6V5a1 1 0 0 1 2 0v6z"/></svg>',ad='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 6h-8l-2-2H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-2 8h-2v2a1 1 0 0 1-2 0v-2h-2a1 1 0 0 1 0-2h2v-2a1 1 0 0 1 2 0v2h2a1 1 0 0 1 0 2z"/></svg>',cd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 10.12V16a1 1 0 0 1-2 0v-5.88l-1.91 1.91a.75.75 0 0 1-1.06-1.06L12 7l3.97 3.97a.75.75 0 0 1-1.06 1.06L13 10.12z"/></svg>',sd='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><g id="asset-file-archive" fill="none" fill-rule="evenodd" stroke="none" stroke-width="1"><path id="Rectangle-5-Copy" fill="#000" fill-opacity=".2" d="M8,6 L37.4361148,6 C38.3276335,6 38.6509198,6.09282561 38.9768457,6.2671327 C39.3027716,6.4414398 39.5585602,6.69722837 39.7328673,7.0231543 C39.9071744,7.34908022 40,7.67236646 40,8.5638852 L40,31.4361148 C40,32.3276335 39.9071744,32.6509198 39.7328673,32.9768457 C39.5585602,33.3027716 39.3027716,33.5585602 38.9768457,33.7328673 C38.6509198,33.9071744 38.3276335,34 37.4361148,34 L2.5638852,34 C1.67236646,34 1.34908022,33.9071744 1.0231543,33.7328673 C0.697228371,33.5585602 0.441439796,33.3027716 0.267132704,32.9768457 C0.0928256111,32.6509198 4.01235366e-17,32.3276335 -6.90560205e-17,31.4361148 L0,14 L8,6 Z" transform="rotate(90 20 20)"/><path id="Rectangle-5-Copy-2" fill="#000" fill-opacity=".2" d="M28.5638852,-1.03584031e-16 L34,0 L26,8 L26,2.5638852 C26,1.67236646 26.0928256,1.34908022 26.2671327,1.0231543 C26.4414398,0.697228371 26.6972284,0.441439796 27.0231543,0.267132704 C27.3490802,0.0928256111 27.6723665,6.01853049e-17 28.5638852,-1.03584031e-16 Z" transform="rotate(-90 30 4)"/><path id="Path-3" fill="#000" d="M11,2 L10.2828427,7.02010101 C10.1473627,7.9684608 10.806332,8.84708652 11.7546918,8.98256648 C11.8359458,8.99417419 11.9179211,9 12,9 L12,9 C12.957988,9 13.7345908,8.22339724 13.7345908,7.2654092 C13.7345908,7.18333032 13.728765,7.10135495 13.7171573,7.02010101 L13,2 L11,2 Z" opacity=".2"/><rect id="Rectangle" width="2" height="3" x="10" y="10" fill="#000" opacity=".2"/><rect id="Rectangle-Copy" width="2" height="3" x="12" y="13" fill="#000" opacity=".2"/><rect id="Rectangle-Copy-2" width="2" height="3" x="10" y="16" fill="#000" opacity=".2"/><rect id="Rectangle-Copy-3" width="2" height="3" x="12" y="19" fill="#000" opacity=".2"/><rect id="Rectangle-Copy-4" width="2" height="3" x="10" y="22" fill="#000" opacity=".2"/></g></svg>',fd='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><g id="asset-file-audio" fill="none" fill-opacity=".2" fill-rule="evenodd" stroke="none" stroke-width="1"><path id="Rectangle-5-Copy" fill="#000" d="M8,6 L37.4361148,6 C38.3276335,6 38.6509198,6.09282561 38.9768457,6.2671327 C39.3027716,6.4414398 39.5585602,6.69722837 39.7328673,7.0231543 C39.9071744,7.34908022 40,7.67236646 40,8.5638852 L40,31.4361148 C40,32.3276335 39.9071744,32.6509198 39.7328673,32.9768457 C39.5585602,33.3027716 39.3027716,33.5585602 38.9768457,33.7328673 C38.6509198,33.9071744 38.3276335,34 37.4361148,34 L2.5638852,34 C1.67236646,34 1.34908022,33.9071744 1.0231543,33.7328673 C0.697228371,33.5585602 0.441439796,33.3027716 0.267132704,32.9768457 C0.0928256111,32.6509198 4.01235366e-17,32.3276335 -6.90560205e-17,31.4361148 L0,14 L8,6 Z" transform="rotate(90 20 20)"/><path id="Combined-Shape" fill="#000" d="M17,17.7 L17,25 L17,27.5 C17,28.8807119 15.8807119,30 14.5,30 C13.1192881,30 12,28.8807119 12,27.5 C12,26.1192881 13.1192881,25 14.5,25 L16,25 L16,16 L16,13 L26,10 L26,13 L26,23 L26,25.5 C26,26.8807119 24.8807119,28 23.5,28 C22.1192881,28 21,26.8807119 21,25.5 C21,24.1192881 22.1192881,23 23.5,23 L25,23 L25,15.3 L17,17.7 Z"/><path id="Rectangle-5-Copy-2" fill="#000" d="M28.5638852,-1.03584031e-16 L34,0 L26,8 L26,2.5638852 C26,1.67236646 26.0928256,1.34908022 26.2671327,1.0231543 C26.4414398,0.697228371 26.6972284,0.441439796 27.0231543,0.267132704 C27.3490802,0.0928256111 27.6723665,6.01853049e-17 28.5638852,-1.03584031e-16 Z" transform="rotate(-90 30 4)"/></g></svg>',ld='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><g id="asset-file-video" fill="none" fill-opacity=".2" fill-rule="evenodd" stroke="none" stroke-width="1"><path id="Rectangle-5-Copy" fill="#000" d="M8,6 L37.4361148,6 C38.3276335,6 38.6509198,6.09282561 38.9768457,6.2671327 C39.3027716,6.4414398 39.5585602,6.69722837 39.7328673,7.0231543 C39.9071744,7.34908022 40,7.67236646 40,8.5638852 L40,31.4361148 C40,32.3276335 39.9071744,32.6509198 39.7328673,32.9768457 C39.5585602,33.3027716 39.3027716,33.5585602 38.9768457,33.7328673 C38.6509198,33.9071744 38.3276335,34 37.4361148,34 L2.5638852,34 C1.67236646,34 1.34908022,33.9071744 1.0231543,33.7328673 C0.697228371,33.5585602 0.441439796,33.3027716 0.267132704,32.9768457 C0.0928256111,32.6509198 4.01235366e-17,32.3276335 -6.90560205e-17,31.4361148 L0,14 L8,6 Z" transform="rotate(90 20 20)"/><path id="Rectangle-5-Copy-2" fill="#000" d="M28.5638852,-1.03584031e-16 L34,0 L26,8 L26,2.5638852 C26,1.67236646 26.0928256,1.34908022 26.2671327,1.0231543 C26.4414398,0.697228371 26.6972284,0.441439796 27.0231543,0.267132704 C27.3490802,0.0928256111 27.6723665,6.01853049e-17 28.5638852,-1.03584031e-16 Z" transform="rotate(-90 30 4)"/><path id="Path" fill="#000" d="M24,19 L28,15 L28,25 L24,21 L24,24 C24,24.5522847 23.5522847,25 23,25 L13,25 C12.4477153,25 12,24.5522847 12,24 L12,16 C12,15.4477153 12.4477153,15 13,15 L23,15 C23.5522847,15 24,15.4477153 24,16 L24,19 Z"/></g></svg>',dd='<svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><g><path d="M34.872 9h-16.49l-.94-1.88c-.436-.872-.634-1.17-.918-1.447a2.115 2.115 0 0 0-.807-.5c-.376-.13-.73-.173-1.705-.173H3.908c-.688 0-1.214.118-1.646.35a2.18 2.18 0 0 0-.913.912C1.12 6.694 1 7.22 1 7.908v22.964c0 1.475.108 2.034.416 2.61.255.478.624.847 1.102 1.102.576.308 1.135.416 2.61.416h29.744c1.475 0 2.034-.108 2.61-.416a2.635 2.635 0 0 0 1.102-1.102c.308-.576.416-1.135.416-2.61V13.128c0-1.475-.108-2.034-.416-2.61a2.635 2.635 0 0 0-1.102-1.102C36.906 9.108 36.347 9 34.872 9zM19 8h15.872c1.783 0 2.43.186 3.082.534.652.349 1.163.86 1.512 1.512.348.652.534 1.299.534 3.082v17.744c0 1.783-.186 2.43-.534 3.082a3.635 3.635 0 0 1-1.512 1.512c-.652.348-1.299.534-3.082.534H5.128c-1.783 0-2.43-.186-3.082-.534a3.635 3.635 0 0 1-1.512-1.512C.186 33.302 0 32.655 0 30.872V7.908c0-.866.162-1.547.467-2.117a3.18 3.18 0 0 1 1.324-1.324C2.36 4.162 3.042 4 3.908 4h10.104c1.163 0 1.582.073 2.032.229.45.156.838.395 1.179.728.34.333.593.675 1.113 1.716L19 8z"/><path d="M22.293 19.707l-.005.005a1 1 0 0 1-1.415-.001L18 16.83V26h9a1 1 0 0 1 0 2H16V16.83l-2.873 2.88a1 1 0 0 1-1.415.002l-.005-.005a1 1 0 0 1 0-1.414L17 13l5.293 5.293a1 1 0 0 1 0 1.414z"/></g></svg>',md='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 11H7.83l4.882-4.882a.997.997 0 0 0-.002-1.413l-.003-.003a1 1 0 0 0-1.412.003L4 12l7.295 7.295a.998.998 0 0 0 1.41-1.41L7.83 13H19a1 1 0 0 0 0-2z"/></svg>',pd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18.168 5.445a1 1 0 0 1 1.664 1.11l-8 12a1 1 0 0 1-1.536.156L5.3 13.762a1 1 0 1 1 1.407-1.42l4.135 4.093 7.327-10.99z"/></svg>',gd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.667 9.217a.773.773 0 0 1 1.1.02c.303.313.311.818.02 1.141L12.56 14.76c-.31.32-.81.32-1.12 0l-4.227-4.382a.843.843 0 0 1 .02-1.14.773.773 0 0 1 1.1-.02l3.667 3.8 3.667-3.8z"/></svg>',hd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10.218 8.335a.773.773 0 0 1 .02-1.1.843.843 0 0 1 1.142-.02l4.382 4.227c.32.31.32.81 0 1.12L11.38 16.79a.843.843 0 0 1-1.141-.02.773.773 0 0 1-.02-1.1l3.8-3.667-3.8-3.667z"/></svg>',vd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17.251 8.157L13.421 12l3.83 3.843a.996.996 0 0 1-1.408 1.408L12 13.421l-3.843 3.83a.996.996 0 0 1-1.408-1.408L10.579 12l-3.83-3.843A.996.996 0 0 1 8.157 6.75L12 10.579l3.843-3.83a.996.996 0 0 1 1.408 1.408z" fill-rule="evenodd"/></svg>',yd='<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .86-2 1.91v13.176h2V2.91h12V1zm3 3.818c1.1 0 2 .86 2 1.91V20.09C21 21.14 20.1 22 19 22H8c-1.1 0-2-.86-2-1.91V6.728c0-1.05.9-1.909 2-1.909h11zm0 15.273V6.727H8v13.364h11z" fill-rule="nonzero"/></svg>',bd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6h3a1 1 0 0 1 0 2h-1v11a3 3 0 0 1-3 3H8a3 3 0 0 1-3-3V8H4a1 1 0 1 1 0-2h3V5a3 3 0 0 1 3-3h4a3 3 0 0 1 3 3v1zm-2 0V5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v1h6zm2 2H7v11a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V8zm-8 3a1 1 0 0 1 2 0v6a1 1 0 0 1-2 0v-6zm4 0a1 1 0 0 1 2 0v6a1 1 0 0 1-2 0v-6z"/></svg>',wd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 19v-2a1 1 0 0 1 2 0v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 2 0v2h12zm-7-5.414V4a1 1 0 0 1 2 0v9.586l2.293-2.293a1 1 0 0 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414L11 13.586z"/></svg>',xd='<svg id="media-droparea" viewBox="0 0 48 48" width="100%" height="100%"><<path d="M38.71,24.07 C43.89,24.44 48,28.72 48,34 C48,39.52 43.52,44 38,44 L12,44 C5.37,44 0,38.63 0,32 C0,25.81 4.69,20.72 10.7,20.07 C13.21,15.28 18.22,12 24,12 C31.28,12 37.35,17.19 38.71,24.07 Z M28,30 L34,30 L24,20 L14,30 L20,30 L20,38 L28,38 L28,30 Z" id="Shape" fill-rule="nonzero"></path></svg>',Sd='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g id="icon-dropbox" fill="none" fill-rule="evenodd"><path id="Shape" fill="#000" fill-rule="nonzero" d="M7,2 L1,6.10126582 L5.51415094,9.64556962 L12,5.69620253 L7,2 Z M1,13.0886076 L7.48584906,17.2405063 L12,13.5443038 L5.51415094,9.64556962 L1,13.0886076 Z M16.5660377,17.2405063 L23,13.1392405 L18.5377358,9.64556962 L12,13.5443038 L16.5660377,17.2405063 Z M23,6.10126582 L17.5660377,2 L12,5.69620253 L18.5377358,9.64556962 L23,6.10126582 Z M11.9990234,15.0235692 L7.48584906,18.7457109 L6,17.7726537 L6,19.0117846 L11.9990234,23 L17.9980469,19.0117846 L17.9980469,17.7726537 L16.5660377,18.7457109 L11.9990234,15.0235692 Z"/></g></svg>',Od='<svg viewBox="0 0 40 40"><g fill-rule="evenodd"><path d="M34 8v29.436c0 .892-.093 1.215-.267 1.54-.174.327-.43.583-.756.757-.326.174-.65.267-1.54.267H8.563c-.892 0-1.215-.093-1.54-.267a1.817 1.817 0 0 1-.757-.756c-.174-.326-.267-.65-.267-1.54V2.563c0-.892.093-1.215.267-1.54.174-.327.43-.583.756-.757C7.35.093 7.673 0 8.563 0H26l8 8z"/><path d="M26 5.436V0l8 8h-5.436c-.892 0-1.215-.093-1.54-.267a1.817 1.817 0 0 1-.757-.756c-.174-.326-.267-.65-.267-1.54z"/></g></svg>',kd='<svg viewBox="0 0 40 40"><g fill-rule="evenodd"><path d="M3.908 4h10.104c1.163 0 1.582.073 2.032.229.45.156.838.395 1.179.728.34.333.593.675 1.113 1.716L19 8H0v-.092c0-.866.162-1.547.467-2.117a3.18 3.18 0 0 1 1.324-1.324C2.36 4.162 3.042 4 3.908 4zM0 8h34.872c1.783 0 2.43.186 3.082.534.652.349 1.163.86 1.512 1.512.348.652.534 1.299.534 3.082v17.744c0 1.783-.186 2.43-.534 3.082a3.635 3.635 0 0 1-1.512 1.512c-.652.348-1.299.534-3.082.534H5.128c-1.783 0-2.43-.186-3.082-.534a3.635 3.635 0 0 1-1.512-1.512C.186 33.302 0 32.655 0 30.872V8z"/></g></svg>',Td='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g id="icon-googledrive" fill="none" fill-rule="evenodd"><path id="Shape" fill="#000" fill-rule="nonzero" d="M8.42436772,2.4 L1,15.509164 L4.05322951,21.0936453 L19.2798462,21.0905636 L23,14.758396 L15.4935951,2.41891532 L8.42436772,2.4 Z M2.82415905,15.5226597 L8.89214985,4.80670827 L10.6925054,7.94983867 L4.53227583,18.6469811 L2.82415905,15.5226597 Z M11.6096856,9.55105203 L14.1393435,13.9672469 L9.06706339,13.9666093 L11.6096856,9.55105203 Z M18.3674479,19.4966826 L5.89906679,19.499233 L8.18696988,15.5604904 L20.6772417,15.5649535 L18.3674479,19.4966826 Z M15.9762544,13.9674595 L10.265423,3.99738779 L14.5958614,4.01024596 L20.6533319,13.9679908 L15.9762544,13.9674595 Z"/></g></svg>',Fd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8 11h2a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1zm0 7h2a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1zm6 0h2a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1zm0-7h2a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1z"/></svg>',Dd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 13a1 1 0 0 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 0 0 0-2 1 1 0 0 0 0 2zm0-8a1 1 0 1 0 0-2 1 1 0 1 0 0 2zm4 4h12a1 1 0 0 0 0-2H8a1 1 0 0 0 0 2zm0 4h12a1 1 0 0 0 0-2H8a1 1 0 0 0 0 2zM7 8a1 1 0 0 0 1 1h12a1 1 0 0 0 0-2H8a1 1 0 0 0-1 1z"/></svg>',Cd='<svg width="30" height="30" xmlns="http://www.w3.org/2000/svg"><path d="M15 23.114l8.343 5.036-2.214-9.49 7.371-6.386-9.706-.823L15 2.5l-3.793 8.95-9.707.824 7.371 6.386-2.214 9.49z"/></svg>',Id='<svg viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill-rule="nonzero"/></svg>',Ed='<svg viewBox="0 0 24 24"><path d="M12 2.91h-2V1h2v1.91zm2 0V1h2v1.91h-2zm-6 0H6V1h2v1.91zm-4 0V3H2v-.09C2 1.86 2.9 1 4 1v1.91zM4 5v2H2V5h2zm0 4v2H2V9h2zm0 4v2.022H2V13h2zm15-8.182H8c-1.1 0-2 .86-2 1.91V20.09C6 21.14 6.9 22 8 22h11c1.1 0 2-.86 2-1.91V6.728c0-1.05-.9-1.909-2-1.909zm0 15.273H8V6.727h11v13.364z" fill-rule="nonzero"/></svg>',Ld='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.498 12.537a16.178 16.178 0 0 0 1.832 2.265C7.289 16.813 9.523 18 12 18c2.477 0 4.711-1.187 6.67-3.198A16.178 16.178 0 0 0 20.847 12a16.178 16.178 0 0 0-2.177-2.802C16.711 7.187 14.477 6 12 6 9.523 6 7.289 7.187 5.33 9.198A16.178 16.178 0 0 0 3.153 12c.095.155.21.335.345.537zm-2.385-.998c.13-.25.372-.665.724-1.19a18.159 18.159 0 0 1 2.06-2.547C6.2 5.438 8.908 4 12 4c3.092 0 5.8 1.438 8.103 3.802.79.812 1.478 1.68 2.06 2.547.352.525.594.94.724 1.19a1 1 0 0 1 0 .922c-.13.25-.372.665-.724 1.19a18.159 18.159 0 0 1-2.06 2.547C17.8 18.562 15.092 20 12 20c-3.092 0-5.8-1.438-8.103-3.802a18.159 18.159 0 0 1-2.06-2.547c-.352-.525-.594-.94-.724-1.19a1 1 0 0 1 0-.922zm12.065-3.363a2 2 0 1 0 2.646 2.646 4 4 0 1 1-2.646-2.646z"/></svg>',Bd='<svg viewBox="0 0 24 24"><path d="M12.19 3.734c.125-.292.315-.535.568-.729.253-.193.51-.322 1.256-.508L16 2v1.03l-1.744.437c-.565.14-.731.211-.89.333a.8.8 0 0 0-.259.33c-.08.185-.107.363-.107.946v13.848c0 .583.028.761.107.946a.8.8 0 0 0 .258.33c.16.122.326.192.891.333L16 20.97V22l-1.986-.497c-.747-.186-1.003-.315-1.256-.508a1.799 1.799 0 0 1-.569-.73c-.126-.292-.252-.292-.378 0a1.799 1.799 0 0 1-.57.73c-.252.193-.508.322-1.255.508L8 22v-1.03l1.744-.437c.565-.14.731-.211.89-.333a.8.8 0 0 0 .259-.33c.08-.185.107-.363.107-.946V5.076c0-.583-.028-.761-.107-.946a.8.8 0 0 0-.258-.33c-.16-.122-.326-.192-.891-.333L8 3.03V2l1.986.497c.747.186 1.003.315 1.256.508.253.194.443.437.569.73.126.292.252.292.378 0z" fill-rule="nonzero"/></svg>',Md='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.907 17.319a8 8 0 1 1 1.412-1.412c.013.011.026.023.038.036l4.35 4.35a1 1 0 0 1-1.414 1.414l-4.35-4.35a1.016 1.016 0 0 1-.036-.038zM11 17a6 6 0 1 0 0-12 6 6 0 0 0 0 12z"/></svg>',Ad='<svg width="30" height="30" xmlns="http://www.w3.org/2000/svg"><path d="M20.582 18.352h-1.174l-.417-.401a9.62 9.62 0 0 0 2.334-6.288A9.662 9.662 0 0 0 11.663 2 9.662 9.662 0 0 0 2 11.663a9.662 9.662 0 0 0 9.663 9.662 9.62 9.62 0 0 0 6.288-2.334l.401.417v1.174L25.785 28 28 25.785l-7.418-7.433zm-8.92 0a6.68 6.68 0 0 1-6.689-6.69 6.68 6.68 0 0 1 6.69-6.689 6.68 6.68 0 0 1 6.69 6.69 6.68 6.68 0 0 1-6.69 6.69z" fill-rule="nonzero"/></svg>',_d='<svg viewBox="0 0 24 24"><path d="M12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18zm-2.39-6.11L6.5 11.78l-1.06 1.06L9.61 17l8.95-8.95L17.5 7l-7.89 7.89z" fill-rule="evenodd"/></svg>',Nd='<svg viewBox="0 0 24 24"><path fill-rule="nonzero" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>',zd='<svg viewBox="0 0 24 24"><path d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z" fill-rule="nonzero"/></svg>',Hd='<svg viewBox="0 0 24 24"><path d="M12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18zm0-1a8 8 0 1 0 0-16 8 8 0 0 0 0 16z" fill-rule="evenodd"/></svg>',Rd='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 19v-2a1 1 0 0 1 2 0v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 2 0v2h12zM11 6.414L8.707 8.707a1 1 0 0 1-1.414-1.414l4-4a1 1 0 0 1 1.414 0l4 4a1 1 0 1 1-1.414 1.414L13 6.414V16a1 1 0 0 1-2 0V6.414z"/></svg>',Vd=Ac({name:"Icon",factory:function(e){return{dom:{tag:"span",classes:[id.Icon].concat(e.classes),innerHtml:e.iconHtml}}},configFields:[zt("iconHtml"),qt("classes",[])]}),Pd=Ac({name:"FileIcon",factory:function(e){return{dom:{tag:"span",classes:[id.AssetIcon].concat(e.classes),innerHtml:function(e){switch(e){case"directory":return kd;case"video":return ld;case"audio":return fd;case"archive":return sd;default:return Od}}(e.type)}}},configFields:[zt("type"),qt("classes",[])]}),jd=function(e,t,n){t.store.manager.onLoad(e,t,n)},Ud=function(e,t,n){t.store.manager.onUnload(e,t,n)},Gd=Object.freeze({onLoad:jd,onUnload:Ud,setValue:function(e,t,n,o){t.store.manager.setValue(e,t,n,o)},getValue:function(e,t,n){return t.store.manager.getValue(e,t,n)},getState:function(e,t,n){return n}}),Wd=Object.freeze({events:function(n,o){var e=n.resetOnDom?[ar(function(e,t){jd(e,n,o)}),cr(function(e,t){Ud(e,n,o)})]:[pr(n,o,jd)];return nr(e)}}),qd=function(){var e=Fr(null);return en({set:e.set,get:e.get,isNotSet:function(){return null===e.get()},clear:function(){e.set(null)},readState:function(){return{mode:"memory",value:e.get()}}})},Kd=function(){var i=Fr({}),u=Fr({});return en({readState:function(){return{mode:"dataset",dataByValue:i.get(),dataByText:u.get()}},lookup:function(e){return Ie(i.get(),e).orThunk(function(){return Ie(u.get(),e)})},update:function(e){var t=i.get(),n=u.get(),o={},r={};R(e,function(t){o[t.value]=t,Ie(t,"meta").each(function(e){Ie(e,"text").each(function(e){r[e]=t})})}),i.set(qn({},t,o)),u.set(qn({},n,r))},clear:function(){i.set({}),u.set({})}})},Yd=Object.freeze({memory:qd,dataset:Kd,manual:function(){return en({readState:function(){}})},init:function(e){return e.store.manager.state(e)}}),Jd=function(e,t,n,o){var r=t.store;n.update([o]),r.setValue(e,o),t.onSetValue(e,o)},Zd=[jt("initialValue"),At("getFallbackEntry"),At("getDataKey"),At("setValue"),Ga("manager",{setValue:Jd,getValue:function(e,t,n){var o=t.store,r=o.getDataKey(e);return n.lookup(r).fold(function(){return o.getFallbackEntry(r)},function(e){return e})},onLoad:function(t,n,o){n.store.initialValue.each(function(e){Jd(t,n,o,e)})},onUnload:function(e,t,n){n.clear()},state:Kd})],Xd=[At("getValue"),qt("setValue",b),jt("initialValue"),Ga("manager",{setValue:function(e,t,n,o){t.store.setValue(e,o),t.onSetValue(e,o)},getValue:function(e,t,n){return t.store.getValue(e)},onLoad:function(t,n,e){n.store.initialValue.each(function(e){n.store.setValue(t,e)})},onUnload:b,state:Qt.init})],$d=[jt("initialValue"),Ga("manager",{setValue:function(e,t,n,o){n.set(o),t.onSetValue(e,o)},getValue:function(e,t,n){return n.get()},onLoad:function(e,t,n){t.store.initialValue.each(function(e){n.isNotSet()&&n.set(e)})},onUnload:function(e,t,n){n.clear()},state:qd})],Qd=[Kt("store",{mode:"memory"},Ft("mode",{memory:$d,manual:Xd,dataset:Zd})),Va("onSetValue"),qt("resetOnDom",!1)],em=xr({fields:Qd,name:"representing",active:Wd,apis:Gd,extra:{setValueFrom:function(e,t){var n=em.getValue(t);em.setValue(e,n)}},state:Yd}),tm=U([jt("data"),qt("inputAttributes",{}),qt("inputStyles",{}),qt("tag","input"),qt("inputClasses",[]),Va("onSetValue"),qt("styles",{}),qt("eventOrder",{}),Nc("inputBehaviours",[em,rd]),qt("selectOnFocus",!0)]),nm=function(e){return qn({},(t=e,br([rd.config({onFocus:!1===t.selectOnFocus?b:function(e){var t=e.element(),n=qi(t);t.dom().setSelectionRange(0,n.length)}})])),Hc(e.inputBehaviours,[em.config({store:{mode:"manual",initialValue:e.data.getOr(void 0),getValue:function(e){return qi(e.element())},setValue:function(e,t){qi(e.element())!==t&&Ki(e.element(),t)}},onSetValue:e.onSetValue})]));var t},om=Ac({name:"Input",configFields:tm(),factory:function(e,t){return{uid:e.uid,dom:(n=e,{tag:n.tag,attributes:qn({type:"text"},n.inputAttributes),styles:n.inputStyles,classes:n.inputClasses}),components:[],behaviours:nm(e),eventOrder:e.eventOrder};var n}}),rm=["input","textarea"],im=function(e){var t=Go(e);return N(rm,t)},um=function(e,t){var n=t.getRoot(e).getOr(e.element());Mi(n,t.invalidClass),t.notify.each(function(t){im(e.element())&&qr(e.element(),"aria-invalid",!1),t.getContainer(e).each(function(e){Gr(e,t.validHtml)}),t.onValid(e)})},am=function(t,e,n,o){var r=e.getRoot(t).getOr(t.element());Li(r,e.invalidClass),e.notify.each(function(e){im(t.element())&&qr(t.element(),"aria-invalid",!0),e.getContainer(t).each(function(e){Gr(e,o)}),e.onInvalid(t,o)})},cm=function(t,e,n){return e.validator.fold(function(){return $u.pure(M.value(!0))},function(e){return e.validate(t)})},sm=function(t,n,e){return n.notify.each(function(e){e.onValidate(t)}),cm(t,n).map(function(e){return t.getSystem().isConnected()?e.fold(function(e){return am(t,n,0,e),M.error(e)},function(e){return um(t,n),M.value(e)}):M.error("No longer in system")})},fm=Object.freeze({markValid:um,markInvalid:am,query:cm,run:sm,isInvalid:function(e,t){var n=t.getRoot(e).getOr(e.element());return Ai(n,t.invalidClass)}}),lm=Object.freeze({events:function(t,e){return t.validator.map(function(e){return nr([or(e.onEvent,function(e){sm(e,t).get(m)})].concat(e.validateOnLoad?[ar(function(e){sm(e,t).get(b)})]:[]))}).getOr({})}}),dm=[At("invalidClass"),qt("getRoot",B.none),Wt("notify",[qt("aria","alert"),qt("getContainer",B.none),qt("validHtml",""),Va("onValid"),Va("onInvalid"),Va("onValidate")]),Wt("validator",[At("validate"),qt("onEvent","input"),qt("validateOnLoad",!0)])],mm=xr({fields:dm,name:"invalidating",active:lm,apis:fm,extra:{validation:function(n){return function(e){var t=em.getValue(e);return $u.pure(n(t))}}}}),pm=function(e,o){return function(n){e.getOpt(n).each(function(e){var t=o||mm.isInvalid(e)?Li:Mi;t(n.element(),id.SearchExpanded),t(e.element(),id.InputFieldSearchExpanded)})}},gm=function(n){return function(e,t){n.getOpt(e).each(rd.focus)}},hm=Ac({name:"SearchBox",factory:function(e){var n=cs({dom:{tag:"span",classes:[id.SearchErrorMsg],innerHtml:"Use at least 3 characters"}}),o=cs(om.sketch({inputAttributes:{type:"search",placeholder:"Search"},inputClasses:[id.InputField,id.InputFieldSearch],inputBehaviours:br([Ql.config({}),mm.config({invalidClass:"tam-invalid-input",notify:{onInvalid:function(t,e){r.getOpt(t).each(function(e){n.getOpt(t).fold(function(){as.append(e,n.asSpec())},b)})},onValid:function(e){r.getOpt(e).each(function(t){n.getOpt(e).each(function(e){as.remove(t,e)})})}},validator:{validate:function(e){var t=em.getValue(e);return 0===t.length||3<=t.length?ia(t):aa("You need to enter at least 3 characters")},validateOnLoad:!1}})])})),r=cs({dom:{tag:"div",classes:[id.Search]},components:[o.asSpec(),Vd.sketch({iconHtml:Md,classes:[id.SearchIcon]})],behaviours:pe(br([as.config({}),_l.config({mode:"special",onEnter:function(n){return o.getOpt(n).each(function(e){if(!1===mm.isInvalid(e)){var t=em.getValue(e);Yu(n,Vu(t))}}),B.some(!0)}}),Tr("searchbox-expanding",[or(no(),pm(o,!0)),or(oo(),pm(o,!1)),or(ao(),gm(o)),or(Yn(),gm(o))]),Tr("searchbox-input",[or(uo(),function(n){o.getOpt(n).each(function(e){var t=em.getValue(e);!1===mm.isInvalid(e)&&""===t&&Yu(n,Vu(t))})})])]),zc(e.searchBoxBehaviours)),apis:{setValue:function(e,t){o.getOpt(e).each(function(e){em.setValue(e,t)})},focus:function(e){o.getOpt(e).each(function(e){rd.focus(e)})}}});return r.asSpec()},configFields:[Nc("searchBoxBehaviours",[])],apis:{setValue:function(e,t,n){e.setValue(t,n)},focus:function(e,t){e.focus(t)}}}),vm=function(e){var t=function(e,t){t.stop(),No(e)},n=En.detect().deviceType.isTouch()?[or(Oo(),t)]:[or(ao(),t),or(Xn(),function(e,t){t.cut()})];return nr(Y([e.map(function(n){return or(xo(),function(e,t){n(e),t.stop()})}).toArray(),n]))},ym=Ac({name:"Button",factory:function(e){var t=vm(e.action),n=e.dom.tag,o=function(t){return Ie(e.dom,"attributes").bind(function(e){return Ie(e,t)})};return{uid:e.uid,dom:e.dom,components:e.components,events:t,behaviours:Vc(e.buttonBehaviours,[rd.config({}),_l.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:function(){if("button"!==n)return{role:o("role").getOr("button")};var e=o("type").getOr("button"),t=o("role").map(function(e){return{role:e}}).getOr({});return qn({type:e},t)}()},eventOrder:e.eventOrder}},configFields:[qt("uid",void 0),At("dom"),qt("components",[]),Rc("buttonBehaviours",[rd,_l]),jt("action"),jt("role"),qt("eventOrder",{})]}),bm=function(e,t){return function(e,t){if(void 0===e)throw new Error("Cannot intersperse undefined");if(e.length<=1)return e;var n=[];n.push(e[0]);for(var o=1;o<e.length;o++)n.push(t()),n.push(e[o]);return n}(e,function(){return t})},wm=Object.freeze({getCurrent:function(e,t,n){return t.find(e)}}),xm=[At("find")],Sm=xr({fields:xm,name:"composing",apis:wm}),Om="alloy.item-hover",km="alloy.item-focus",Tm=function(e){(Kc(e.element()).isNone()||rd.isFocused(e))&&(rd.isFocused(e)||rd.focus(e),_o(e,Om,{item:e}))},Fm=function(e){_o(e,km,{item:e})},Dm=U(Om),Cm=U(km),Im=[At("data"),At("components"),At("dom"),qt("hasSubmenu",!1),jt("toggling"),Rc("itemBehaviours",[xs,rd,_l,em]),qt("ignoreFocus",!1),qt("domModification",{}),Ga("builder",function(e){return{dom:e.dom,domModification:qn({},e.domModification,{attributes:qn({role:e.toggling.isSome()?"menuitemcheckbox":"menuitem"},e.domModification.attributes,{"aria-haspopup":e.hasSubmenu},e.hasSubmenu?{"aria-expanded":!1}:{})}),behaviours:Vc(e.itemBehaviours,[e.toggling.fold(xs.revoke,function(e){return xs.config(qn({aria:{mode:"checked"}},e))}),rd.config({ignore:e.ignoreFocus,stopMousedown:e.ignoreFocus,onFocus:function(e){Fm(e)}}),_l.config({mode:"execution"}),em.config({store:{mode:"memory",initialValue:e.data}}),Tr("item-type-events",[or(ko(),No),ir(Xn()),or(to(),Tm),or(So(),rd.focus)])]),components:e.components,eventOrder:e.eventOrder}}),qt("eventOrder",{})],Em=[At("dom"),At("components"),Ga("builder",function(e){return{dom:e.dom,components:e.components,events:nr([ur(So())])}})],Lm=U([gc({name:"widget",overrides:function(t){return{behaviours:br([em.config({store:{mode:"manual",getValue:function(e){return t.data},setValue:function(){}}})])}}})]),Bm=[At("uid"),At("data"),At("components"),At("dom"),qt("autofocus",!1),qt("ignoreFocus",!1),Rc("widgetBehaviours",[em,rd,_l]),qt("domModification",{}),Cc(Lm()),Ga("builder",function(n){var e=Oc(0,n,Lm()),t=kc("item-widget",n,e.internals()),o=function(e){return Tc(e,n,"widget").map(function(e){return _l.focusIn(e),e})},r=function(e,t){return cf(t.event().target())||n.autofocus&&t.setSource(e.element()),B.none()};return{dom:n.dom,components:t,domModification:n.domModification,events:nr([fr(function(e,t){o(e).each(function(e){t.stop()})}),or(to(),Tm),or(So(),function(e,t){n.autofocus?o(e):rd.focus(e)})]),behaviours:Vc(n.widgetBehaviours,[em.config({store:{mode:"memory",initialValue:n.data}}),rd.config({ignore:n.ignoreFocus,onFocus:function(e){Fm(e)}}),_l.config({mode:"special",focusIn:n.autofocus?function(e){o(e)}:kr(),onLeft:r,onRight:r,onEscape:function(e,t){return rd.isFocused(e)||n.autofocus?(n.autofocus&&t.setSource(e.element()),B.none()):(rd.focus(e),B.some(!0))}})])}})],Mm=Ft("type",{widget:Bm,item:Im,separator:Em}),Am=U([yc({factory:{sketch:function(e){var t=kt("menu.spec item",Mm,e);return t.builder(t)}},name:"items",unit:"item",defaults:function(e,t){return t.hasOwnProperty("uid")?t:qn({},t,{uid:li("item")})},overrides:function(e,t){return{type:t.type,ignoreFocus:e.fakeFocus,domModification:{classes:[e.markers.item]}}}})]),_m=U([At("value"),At("items"),At("dom"),At("components"),qt("eventOrder",{}),Nc("menuBehaviours",[ef,em,Sm,_l]),Kt("movement",{mode:"menu",moveOnTab:!0},Ft("mode",{grid:[qa(),Ga("config",function(e,t){return{mode:"flatgrid",selector:"."+e.markers.item,initSize:{numColumns:t.initSize.numColumns,numRows:t.initSize.numRows},focusManager:e.focusManager}})],matrix:[Ga("config",function(e,t){return{mode:"matrix",selectors:{row:t.rowSelector,cell:"."+e.markers.item},focusManager:e.focusManager}}),At("rowSelector")],menu:[qt("moveOnTab",!0),Ga("config",function(e,t){return{mode:"menu",selector:"."+e.markers.item,moveOnTab:t.moveOnTab,focusManager:e.focusManager}})]})),_t("markers",Na()),qt("fakeFocus",!1),qt("focusManager",nf()),Va("onHighlight")]),Nm=U("alloy.menu-focus"),zm=_c({name:"Menu",configFields:_m(),partFields:Am(),factory:function(e,t,n,o){return{uid:e.uid,dom:e.dom,markers:e.markers,behaviours:Hc(e.menuBehaviours,[ef.config({highlightClass:e.markers.selectedItem,itemClass:e.markers.item,onHighlight:e.onHighlight}),em.config({store:{mode:"memory",initialValue:e.value}}),Sm.config({find:B.some}),_l.config(e.movement.config(e,e.movement))]),events:nr([or(Cm(),function(t,n){var e=n.event();t.getSystem().getByDom(e.target()).each(function(e){ef.highlight(t,e),n.stop(),_o(t,Nm(),{menu:t,item:e})})}),or(Dm(),function(e,t){var n=t.event().item();ef.highlight(e,n)})]),components:t,eventOrder:e.eventOrder,domModification:{attributes:{role:"menu"}}}}}),Hm=function(n,o,r,e){return Ie(r,e).bind(function(e){return Ie(n,e).bind(function(e){var t=Hm(n,o,r,e);return B.some([e].concat(t))})}).getOr([])},Rm=function(e,t){var n={};re(e,function(e,t){R(e,function(e){n[e]=t})});var o=t,r=ue(t,function(e,t){return{k:e,v:t}}),i=ie(r,function(e,t){return[t].concat(Hm(n,o,r,t))});return ie(n,function(e){return Ie(i,e).getOr([e])})},Vm=function(){var i=Fr({}),u=Fr({}),a=Fr({}),c=Fr(B.none()),s=Fr({}),t=function(e){return Ie(u.get(),e)};return{setMenuBuilt:function(e,t){var n;u.set(qn({},u.get(),((n={})[e]={type:"prepared",menu:t},n)))},setContents:function(e,t,n,o){c.set(B.some(e)),i.set(n),u.set(t),s.set(o);var r=Rm(o,n);a.set(r)},expand:function(n){return Ie(i.get(),n).map(function(e){var t=Ie(a.get(),n).getOr([]);return[e].concat(t)})},refresh:function(e){return Ie(a.get(),e)},collapse:function(e){return Ie(a.get(),e).bind(function(e){return 1<e.length?B.some(e.slice(1)):B.none()})},lookupMenu:t,otherMenus:function(e){var t=s.get();return $(ne(t),e)},getPrimary:function(){return c.get().bind(function(e){return t(e).bind(function(e){return"prepared"===e.type?B.some(e.menu):B.none()})})},getMenus:function(){return u.get()},clear:function(){i.set({}),u.set({}),a.set({}),c.set(B.none())},isClear:function(){return c.get().isNone()}}},Pm=U("collapse-item"),jm=Ac({name:"TieredMenu",configFields:[Ua("onExecute"),Ua("onEscape"),ja("onOpenMenu"),ja("onOpenSubmenu"),Va("onCollapseMenu"),qt("highlightImmediately",!0),Pt("data",[At("primary"),At("menus"),At("expansions")]),qt("fakeFocus",!1),Va("onHighlight"),Va("onHover"),Ha(),At("dom"),qt("navigateOnHover",!0),qt("stayInDom",!1),Nc("tmenuBehaviours",[_l,ef,Sm,as]),qt("eventOrder",{})],apis:{collapseMenu:function(e,t){e.collapseMenu(t)},highlightPrimary:function(e,t){e.highlightPrimary(t)}},factory:function(a,e){var c,t,i=Fr(B.none()),u=function(o,r,e){return ie(e,function(e,t){var n=function(){return zm.sketch(qn({dom:e.dom},e,{value:t,items:e.items,markers:a.markers,fakeFocus:a.fakeFocus,onHighlight:a.onHighlight,focusManager:a.fakeFocus?(r=function(e){return ef.getHighlighted(e).map(function(e){return e.element()})},{get:r,set:function(t,e){var n=r(t);t.getSystem().getByDom(e).fold(b,function(e){ef.highlight(t,e)});var o=r(t);tf(t,n,o)}}):nf()}));var r};return t===r?{type:"prepared",menu:o.getSystem().build(n())}:{type:"notbuilt",nbMenu:n}})},s=Vm(),f=function(e){return em.getValue(e).value},l=function(e){return ie(a.data.menus,function(e,t){return J(e.items,function(e){return"separator"===e.type?[]:[e.data.value]})})},d=function(t,e){ef.highlight(t,e),ef.getHighlighted(e).orThunk(function(){return ef.getFirst(e)}).each(function(e){zo(t,e.element(),So())})},m=function(t,e){return Oa(H(e,function(e){return t.lookupMenu(e).bind(function(e){return"prepared"===e.type?B.some(e.menu):B.none()})}))},p=function(t,e,n){var o=m(e,e.otherMenus(n));R(o,function(e){Ni(e.element(),[a.markers.backgroundMenu]),a.stayInDom||as.remove(t,e)})},g=function(e,o){var r,t=(r=e,i.get().getOrThunk(function(){var n={},e=Cs(r.element(),"."+a.markers.item),t=V(e,function(e){return"true"===Yr(e,"aria-haspopup")});return R(t,function(e){r.getSystem().getByDom(e).each(function(e){var t=f(e);n[t]=e})}),i.set(B.some(n)),n}));re(t,function(e,t){var n=N(o,t);qr(e.element(),"aria-expanded",n)})},h=function(o,r,i){return B.from(i[0]).bind(function(e){return r.lookupMenu(e).bind(function(e){if("notbuilt"===e.type)return B.none();var t=e.menu,n=m(r,i.slice(1));return R(n,function(e){Li(e.element(),a.markers.backgroundMenu)}),Jo(t.element())||as.append(o,ru(t)),Ni(t.element(),[a.markers.backgroundMenu]),d(o,t),p(o,r,i),B.some(t)})})};(t=c||(c={}))[t.HighlightSubmenu=0]="HighlightSubmenu",t[t.HighlightParent=1]="HighlightParent";var v=function(r,i,u){void 0===u&&(u=c.HighlightSubmenu);var e=f(i);return s.expand(e).bind(function(o){return g(r,o),B.from(o[0]).bind(function(n){return s.lookupMenu(n).bind(function(e){var t=function(e,t,n){if("notbuilt"!==n.type)return n.menu;var o=e.getSystem().build(n.nbMenu());return s.setMenuBuilt(t,o),o}(r,n,e);return Jo(t.element())||as.append(r,ru(t)),a.onOpenSubmenu(r,i,t),u===c.HighlightSubmenu?(ef.highlightFirst(t),h(r,s,o)):(ef.dehighlightAll(t),B.some(i))})})})},o=function(t,n){var e=f(n);return s.collapse(e).bind(function(e){return g(t,e),h(t,s,e).map(function(e){return a.onCollapseMenu(t,n,e),e})})},n=function(n){return function(t,e){return Ls(e.getSource(),"."+a.markers.item).bind(function(e){return t.getSystem().getByDom(e).toOption().bind(function(e){return n(t,e).map(function(){return!0})})})}},r=nr([or(Nm(),function(t,e){var n=e.event().menu();ef.highlight(t,n);var o=f(e.event().item());s.refresh(o).each(function(e){return p(t,s,e)})}),fr(function(t,e){var n=e.event().target();t.getSystem().getByDom(n).each(function(e){0===f(e).indexOf("collapse-item")&&o(t,e),v(t,e,c.HighlightSubmenu).fold(function(){a.onExecute(t,e)},function(){})})}),ar(function(t,e){var n,o,r;(n=t,o=u(n,a.data.primary,a.data.menus),r=l(),s.setContents(a.data.primary,o,a.data.expansions,r),s.getPrimary()).each(function(e){as.append(t,ru(e)),a.onOpenMenu(t,e),a.highlightImmediately&&d(t,e)})})].concat(a.navigateOnHover?[or(Dm(),function(e,t){var n,o,r=t.event().item();n=e,o=f(r),s.refresh(o).bind(function(e){return g(n,e),h(n,s,e)}),v(e,r,c.HighlightParent),a.onHover(e,r)})]:[])),y={collapseMenu:function(t){ef.getHighlighted(t).each(function(e){ef.getHighlighted(e).each(function(e){o(t,e)})})},highlightPrimary:function(t){s.getPrimary().each(function(e){d(t,e)})}};return{uid:a.uid,dom:a.dom,markers:a.markers,behaviours:Hc(a.tmenuBehaviours,[_l.config({mode:"special",onRight:n(function(e,t){return cf(t.element())?B.none():v(e,t,c.HighlightSubmenu)}),onLeft:n(function(e,t){return cf(t.element())?B.none():o(e,t)}),onEscape:n(function(e,t){return o(e,t).orThunk(function(){return a.onEscape(e,t).map(function(){return e})})}),focusIn:function(t,e){s.getPrimary().each(function(e){zo(t,e.element(),So())})}}),ef.config({highlightClass:a.markers.selectedMenu,itemClass:a.markers.menu}),Sm.config({find:function(e){return ef.getHighlighted(e)}}),as.config({})]),eventOrder:a.eventOrder,apis:y,events:r}},extraApis:{tieredData:function(e,t,n){return{primary:e,menus:t,expansions:n}},singleData:function(e,t){return{primary:e,menus:Ee(e,t),expansions:{}}},collapseItem:function(e){return{value:ri(Pm()),meta:{text:e}}}}}),Um=Ss("width",function(e){return e.dom().offsetWidth}),Gm=function(e){return Um.get(e)},Wm=function(e){return Um.getOuter(e)},qm=function(t,e){return(n=e,Qo(n,function(e){if(!qo(e))return!1;var t=Yr(e,"id");return void 0!==t&&-1<t.indexOf("aria-owns")}).bind(function(e){var t=Yr(e,"id"),n=Lr(e);return Es(n,'[aria-owns="'+t+'"]')})).exists(function(e){return Km(t,e)});var n},Km=function(t,e){return n=e,r=U(!(o=function(e){return Pn(e,t.element())})),Qo(n,o,r).isSome()||qm(t,e);var n,o,r},Ym=Object.freeze({getCoupled:function(e,t,n,o){return n.getOrCreate(e,t,o)}}),Jm=[_t("others",xt(M.value,Dt()))],Zm=xr({fields:Jm,name:"coupling",apis:Ym,state:Object.freeze({init:function(e){var i={},t=U({});return en({readState:t,getOrCreate:function(n,o,r){var e=ne(o.others);if(e)return Ie(i,r).getOrThunk(function(){var e=Ie(o.others,r).getOrDie("No information found for coupled component: "+r)(n),t=n.getSystem().build(e);return i[r]=t});throw new Error("Cannot find coupled component: "+r+". Known coupled components: "+nt(e,null,2))}})}})}),Xm=Object.freeze({exhibit:function(e,t){return mr({classes:[],styles:t.useFixed?{}:{position:"relative"}})}}),$m=function(n,o){return{left:U(n),top:U(o),translate:function(e,t){return $m(n+e,o+t)}}},Qm=$m,ep=function(e,t){return void 0!==e?e:void 0!==t?t:0},tp=function(e){var t,n,o=e.dom().ownerDocument,r=o.body,i=(t=Bn.fromDom(o),(n=t.dom())===n.window&&t instanceof L.Window?t:Yo(t)?n.defaultView||n.parentWindow:null),u=o.documentElement,a=ep(i.pageYOffset,u.scrollTop),c=ep(i.pageXOffset,u.scrollLeft),s=ep(u.clientTop,r.clientTop),f=ep(u.clientLeft,r.clientLeft);return np(e).translate(c-f,a-s)},np=function(e){var t,n,o,r=e.dom(),i=r.ownerDocument,u=i.body,a=Bn.fromDom(i.documentElement);return u===r?Qm(u.offsetLeft,u.offsetTop):(t=e,n=a||Bn.fromDom(L.document.documentElement),$o(t,l(Pn,n)).isSome()?(o=r.getBoundingClientRect(),Qm(o.left,o.top)):Qm(0,0))},op=(En.detect().browser.isSafari(),function(e){var t=void 0!==e?e.dom():L.document,n=t.body.scrollLeft||t.documentElement.scrollLeft,o=t.body.scrollTop||t.documentElement.scrollTop;return Qm(n,o)}),rp=Er(["x","y","width","height","maxHeight","direction","classes","label","candidateYforTest"],[]),ip=Dr("position","left","top","right","bottom"),up=le([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]),ap=up.southeast,cp=up.southwest,sp=up.northeast,fp=up.northwest,lp=up.south,dp=up.north,mp=up.east,pp=up.west,gp=Dr("point","width","height"),hp=Dr("x","y","width","height"),vp=function(e,t,n,o){return{x:U(e),y:U(t),width:U(n),height:U(o),right:U(e+n),bottom:U(t+o)}},yp=function(o,e){return o.view(e).fold(U([]),function(e){var t=o.owner(e),n=yp(o,t);return[e].concat(n)})},bp=Object.freeze({view:function(e){return(e.dom()===L.document?B.none():B.from(e.dom().defaultView.frameElement)).map(Bn.fromDom)},owner:function(e){return Lr(e)}}),wp=function(o){var e,t,n,r,i=Bn.fromDom(L.document),u=op(i);return(e=o,n=(t=bp).owner(e),r=yp(t,n),B.some(r)).fold(l(tp,o),function(e){var t=np(o),n=P(e,function(e,t){var n=np(t);return{left:e.left+n.left(),top:e.top+n.top()}},{left:0,top:0});return Qm(n.left+t.left()+u.left(),n.top+t.top()+u.top())})},xp=function(){var e=L.window.innerWidth,t=L.window.innerHeight,n=Bn.fromDom(L.document),o=op(n);return vp(o.left(),o.top(),e,t)},Sp=le([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),Op=function(e,t,n,o,r,i){var u,a,c,s,f,l,d,m,p,g=t.x()-n,h=t.y()-o,v=r-(g+t.width()),y=i-(h+t.height()),b=B.some(g),w=B.some(h),x=B.some(v),S=B.some(y),O=B.none();return u=t.direction(),a=function(){return ip(e,b,w,O,O)},c=function(){return ip(e,O,w,x,O)},s=function(){return ip(e,b,O,O,S)},f=function(){return ip(e,O,O,x,S)},l=function(){return ip(e,b,w,O,O)},d=function(){return ip(e,b,O,O,S)},m=function(){return ip(e,b,w,O,O)},p=function(){return ip(e,O,w,x,O)},u.fold(a,c,s,f,l,d,m,p)},kp=function(e,t){var n=l(wp,t),o=e.fold(n,n,function(){var e=op();return wp(t).translate(-e.left(),-e.top())}),r=Wm(t),i=Ds(t);return vp(o.left(),o.top(),r,i)},Tp=Sp.relative,Fp=Sp.fixed,Dp=Dr("anchorBox","origin"),Cp=le([{fit:["reposition"]},{nofit:["reposition","deltaW","deltaH"]}]),Ip=function(e,z,H,R,V){var P=H.width(),j=H.height(),o=function(e,o,r,i){var t,n,u,a,c,s,f,l,d,m,p,g,h,v,y,b,w,x,S,O,k,T,F,D,C,I,E,L,B,M,A,_,N=e(z,H,R);return(n=P,u=j,a=V,d=(t=N).x(),m=t.y(),p=t.bubble().offset().left(),g=t.bubble().offset().top(),h=a.x(),v=a.y(),y=a.width(),b=a.height(),O=v<=(x=m+g),k=(S=h<=(w=d+p))&&O,T=w+n<=h+y&&x+u<=v+b,F=S?Math.min(n,h+y-w):Math.abs(h-(w+n)),D=O?Math.min(u,v+b-x):Math.abs(v-(x+u)),C=a.x()+a.width(),I=Math.max(a.x(),w),E=Math.min(I,C),B=U((L=O?x:x+(u-D))+D-v),M=U(v+b-L),c=t.direction(),f=s=M,l=B,A=c.fold(s,s,l,l,s,l,f,f),_=rp({x:E,y:L,width:F,height:D,maxHeight:A,direction:t.direction(),classes:{on:t.bubble().classesOn(),off:t.bubble().classesOff()},label:t.label(),candidateYforTest:x}),k&&T?Cp.fit(_):Cp.nofit(_,F,D)).fold(Cp.fit,function(e,t,n){return i<n||r<t?Cp.nofit(e,t,n):Cp.nofit(o,r,i)})};return G(e,function(e,t){var n=l(o,t);return e.fold(Cp.fit,n)},Cp.nofit(rp({x:z.x(),y:z.y(),width:H.width(),height:H.height(),maxHeight:H.height(),direction:ap(),classes:[],label:"none",candidateYforTest:z.y()}),-1,-1)).fold(m,m)},Ep=function(e,t,n,o){Wi(t,"max-height");var r,i={width:U(Wm(r=t)),height:U(Ds(r))};return Ip(o.preference(),e,i,n,o.bounds())},Lp=function(e,t,n){var o,r,i,u,a,c=function(e){return e+"px"},s=(o=n.origin(),r=t,o.fold(function(){return ip("absolute",B.some(r.x()),B.some(r.y()),B.none(),B.none())},function(e,t,n,o){return Op("absolute",r,e,t,n,o)},function(e,t,n,o){return Op("fixed",r,e,t,n,o)}));i=e,u={position:B.some(s.position()),left:s.left().map(c),top:s.top().map(c),right:s.right().map(c),bottom:s.bottom().map(c)},a=i.dom(),re(u,function(e,t){e.fold(function(){Ri(a,t)},function(e){Hi(a,t,e)})})},Bp=function(e,t){var n,o,r;n=e,o=Math.floor(t),r=Fs.max(n,o,["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"]),Vi(n,"max-height",r+"px")},Mp=U(function(e,t){Bp(e,t),Pi(e,{"overflow-x":"hidden","overflow-y":"auto"})}),Ap=Er(["bounds","origin","preference","maxHeightFunction"],[]),_p=function(e,t,n,o,r,i){var u,a,c,s,f,l=(u=i,a="maxHeightFunction",c=Mp(),void 0===u[a]?c:u[a]),d=e.anchorBox(),m=e.origin(),p=Ap({bounds:(s=m,f=r,f.fold(function(){return s.fold(xp,xp,vp)},function(e){return s.fold(e,e,vp)})),origin:m,preference:o,maxHeightFunction:l});Np(d,t,n,p)},Np=function(e,t,n,o){var r,i,u,a,c=Ep(e,t,n,o);Lp(t,c,o),r=t,i=c.classes(),Ni(r,i.off),_i(r,i.on),u=t,a=c,o.maxHeightFunction()(u,a.maxHeight())},zp=["valignCentre","alignLeft","alignRight","alignCentre","top","bottom","left","right"],Hp=function(){return t=e=0,n={},r=function(e){return Ie(n,e).getOr([])},o=function(e,t,n){var o=$(zp,n);return{offset:function(){return Qm(e,t)},classesOn:function(){return J(n,r)},classesOff:function(){return J(o,r)}}},{southeast:function(){return o(-e,t,["top","alignLeft"])},southwest:function(){return o(e,t,["top","alignRight"])},south:function(){return o(-e/2,t,["top","alignCentre"])},northeast:function(){return o(-e,-t,["bottom","alignLeft"])},northwest:function(){return o(e,-t,["bottom","alignRight"])},north:function(){return o(-e/2,-t,["bottom","alignCentre"])},east:function(){return o(e,-t/2,["valignCentre","left"])},west:function(){return o(-e,-t/2,["valignCentre","right"])}};var e,t,n,r,o},Rp=Dr("x","y","bubble","direction","label"),Vp=function(e){return e.x()},Pp=function(e,t){return e.x()+e.width()/2-t.width()/2},jp=function(e,t){return e.x()+e.width()-t.width()},Up=function(e,t){return e.y()-t.height()},Gp=function(e){return e.y()+e.height()},Wp=function(e,t){return e.y()+e.height()/2-t.height()/2},qp=function(e,t,n){return Rp(Vp(e),Gp(e),n.southeast(),ap(),"layout-se")},Kp=function(e,t,n){return Rp(jp(e,t),Gp(e),n.southwest(),cp(),"layout-sw")},Yp=function(e,t,n){return Rp(Vp(e),Up(e,t),n.northeast(),sp(),"layout-ne")},Jp=function(e,t,n){return Rp(jp(e,t),Up(e,t),n.northwest(),fp(),"layout-nw")},Zp=function(e,t,n){return Rp(Pp(e,t),Up(e,t),n.north(),dp(),"layout-n")},Xp=function(e,t,n){return Rp(Pp(e,t),Gp(e),n.south(),lp(),"layout-s")},$p=function(e,t,n){return Rp((o=e).x()+o.width(),Wp(e,t),n.east(),mp(),"layout-e");var o},Qp=function(e,t,n){return Rp((o=t,e.x()-o.width()),Wp(e,t),n.west(),pp(),"layout-w");var o},eg=function(){return[qp,Kp,Yp,Jp,Xp,Zp,$p,Qp]},tg=function(){return[Kp,qp,Jp,Yp,Xp,Zp,$p,Qp]},ng=function(e){return e},og=function(){return Wt("layouts",[At("onLtr"),At("onRtl")])},rg=function(t,e,n,o){var r=e.layouts.map(function(e){return e.onLtr(t)}).getOr(n),i=e.layouts.map(function(e){return e.onRtl(t)}).getOr(o);return hf(r,i)(t)},ig=[At("hotspot"),jt("bubble"),qt("overrides",{}),og(),Ga("placement",function(e,t,n){var o=t.hotspot,r=kp(n,o.element()),i=rg(e.element(),t,eg(),tg());return B.some(ng({anchorBox:r,bubble:t.bubble.getOr(Hp()),overrides:t.overrides,layouts:i,placer:B.none()}))})],ug=[At("x"),At("y"),qt("height",0),qt("width",0),qt("bubble",Hp()),qt("overrides",{}),og(),Ga("placement",function(e,t,n){var o=vp(t.x,t.y,t.width,t.height),r=rg(e.element(),t,eg(),tg());return B.some(ng({anchorBox:o,bubble:t.bubble,overrides:t.overrides,layouts:r,placer:B.none()}))})],ag={create:Dr("start","soffset","finish","foffset")},cg=le([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),sg=(cg.before,cg.on,cg.after,function(e){return e.fold(m,m,m)}),fg=le([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),lg={domRange:fg.domRange,relative:fg.relative,exact:fg.exact,exactFromRange:function(e){return fg.exact(e.start(),e.soffset(),e.finish(),e.foffset())},getWin:function(e){var t=e.match({domRange:function(e){return Bn.fromDom(e.startContainer)},relative:function(e,t){return sg(e)},exact:function(e,t,n,o){return e}});return Br(t)},range:ag.create},dg=function(e,t,n){var o,r,i=e.document.createRange();return o=i,t.fold(function(e){o.setStartBefore(e.dom())},function(e,t){o.setStart(e.dom(),t)},function(e){o.setStartAfter(e.dom())}),r=i,n.fold(function(e){r.setEndBefore(e.dom())},function(e,t){r.setEnd(e.dom(),t)},function(e){r.setEndAfter(e.dom())}),i},mg=function(e,t,n,o,r){var i=e.document.createRange();return i.setStart(t.dom(),n),i.setEnd(o.dom(),r),i},pg=function(e){return{left:U(e.left),top:U(e.top),right:U(e.right),bottom:U(e.bottom),width:U(e.width),height:U(e.height)}},gg=le([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),hg=function(e,t,n){return t(Bn.fromDom(n.startContainer),n.startOffset,Bn.fromDom(n.endContainer),n.endOffset)},vg=function(e,t){var r,n,o,i=(r=e,t.match({domRange:function(e){return{ltr:U(e),rtl:B.none}},relative:function(e,t){return{ltr:he(function(){return dg(r,e,t)}),rtl:he(function(){return B.some(dg(r,t,e))})}},exact:function(e,t,n,o){return{ltr:he(function(){return mg(r,e,t,n,o)}),rtl:he(function(){return B.some(mg(r,n,o,e,t))})}}}));return(o=(n=i).ltr()).collapsed?n.rtl().filter(function(e){return!1===e.collapsed}).map(function(e){return gg.rtl(Bn.fromDom(e.endContainer),e.endOffset,Bn.fromDom(e.startContainer),e.startOffset)}).getOrThunk(function(){return hg(0,gg.ltr,o)}):hg(0,gg.ltr,o)},yg=function(e,t,n){return t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom};var bg,wg,xg,Sg,Og,kg,Tg,Fg=(bg=Ko,wg="text",xg=function(e){return bg(e)?B.from(e.dom().nodeValue):B.none()},Sg=En.detect().browser,{get:function(e){if(!bg(e))throw new Error("Can only get "+wg+" value of a "+wg+" node");return Og(e).getOr("")},getOption:Og=Sg.isIE()&&10===Sg.version.major?function(e){try{return xg(e)}catch(e){return B.none()}}:xg,set:function(e,t){if(!bg(e))throw new Error("Can only set raw "+wg+" value of a "+wg+" node");e.dom().nodeValue=t}}),Dg=function(e){return Fg.get(e)},Cg=function(n,o,e,t,r){var i=function(e){var t=n.dom().createRange();return t.setStart(o.dom(),e),t.collapse(!0),t},u=Dg(o).length,a=function(e,t,n,o,r){if(0===r)return 0;if(t===o)return r-1;for(var i=o,u=1;u<r;u++){var a=e(u),c=Math.abs(t-a.left);if(n<=a.bottom){if(n<a.top||i<c)return u-1;i=c}}return 0}(function(e){return i(e).getBoundingClientRect()},e,t,r.right,u);return i(a)},Ig=function(t,n,o,r){var e=t.dom().createRange();e.selectNode(n.dom());var i=e.getClientRects();return ka(i,function(e){return yg(e,o,r)?B.some(e):B.none()}).map(function(e){return Cg(t,n,o,r,e)})},Eg=function(t,e,n,o){var r=t.dom().createRange(),i=_r(e);return ka(i,function(e){return r.selectNode(e.dom()),yg(r.getBoundingClientRect(),n,o)?Lg(t,e,n,o):B.none()})},Lg=function(e,t,n,o){return(Ko(t)?Ig:Eg)(e,t,n,o)},Bg=function(e){return(t=e,Fg.getOption(t)).filter(function(e){return 0!==e.trim().length||-1<e.indexOf("\xa0")}).isSome();var t},Mg=["img","br"],Ag=function(e){return Bg(e)||N(Mg,Go(e))},_g=function(e){return er(e,Ag)},Ng=function(e){return zg(e,Ag)},zg=function(e,i){var u=function(e){for(var t=_r(e),n=t.length-1;0<=n;n--){var o=t[n];if(i(o))return B.some(o);var r=u(o);if(r.isSome())return r}return B.none()};return u(e)},Hg=function(e,t){return t-e.left<e.right-t},Rg=function(e,t,n){var o=e.dom().createRange();return o.selectNode(t.dom()),o.collapse(n),o},Vg=function(t,e,n){var o=t.dom().createRange();o.selectNode(e.dom());var r=o.getBoundingClientRect(),i=Hg(r,n);return(!0===i?_g:Ng)(e).map(function(e){return Rg(t,e,i)})},Pg=function(e,t,n){var o=t.dom().getBoundingClientRect(),r=Hg(o,n);return B.some(Rg(e,t,r))},jg=function(e,t,n,o){var r=e.dom().createRange();r.selectNode(t.dom());var i=r.getBoundingClientRect();return function(e,t,n,o){var r=e.dom().createRange();r.selectNode(t.dom());var i=r.getBoundingClientRect(),u=Math.max(i.left,Math.min(i.right,n)),a=Math.max(i.top,Math.min(i.bottom,o));return Lg(e,t,u,a)}(e,t,Math.max(i.left,Math.min(i.right,n)),Math.max(i.top,Math.min(i.bottom,o)))},Ug=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(e,t,n,o){var r,i,u,a,c,s=(i=t,u=n,a=o,(c=Lr(r=e).dom().createRange()).setStart(r.dom(),i),c.setEnd(u.dom(),a),c),f=Pn(e,n)&&t===o;return s.collapsed&&!f}),Gg=function(e){var t=Bn.fromDom(e.anchorNode),n=Bn.fromDom(e.focusNode);return Ug(t,e.anchorOffset,n,e.focusOffset)?B.some(ag.create(t,e.anchorOffset,n,e.focusOffset)):function(e){if(0<e.rangeCount){var t=e.getRangeAt(0),n=e.getRangeAt(e.rangeCount-1);return B.some(ag.create(Bn.fromDom(t.startContainer),t.startOffset,Bn.fromDom(n.endContainer),n.endOffset))}return B.none()}(e)},Wg=function(e,t){var i,n,o,r,u=vg(i=e,t).match({ltr:function(e,t,n,o){var r=i.document.createRange();return r.setStart(e.dom(),t),r.setEnd(n.dom(),o),r},rtl:function(e,t,n,o){var r=i.document.createRange();return r.setStart(n.dom(),o),r.setEnd(e.dom(),t),r}});return o=(n=u).getClientRects(),0<(r=0<o.length?o[0]:n.getBoundingClientRect()).width||0<r.height?B.some(r).map(pg):B.none()},qg=Dr("element","offset"),Kg=le([{screen:["point"]},{absolute:["point","scrollLeft","scrollTop"]}]),Yg=function(e){return e.fold(function(e){return e},function(e,t,n){return e.translate(-t,-n)})},Jg=function(e){return e.fold(function(e){return e},function(e,t,n){return e})},Zg=function(e){return G(e,function(e,t){return e.translate(t.left(),t.top())},Qm(0,0))},Xg=function(e){var t=H(e,Jg);return Zg(t)},$g=Kg.screen,Qg=Kg.absolute,eh=function(e,t,n){var o,r,i,u=Lr(e.element()),a=op(u),c=(o=e,r=n,i=Br(r.root).dom(),B.from(i.frameElement).map(Bn.fromDom).filter(function(e){var t=Lr(e),n=Lr(o.element());return Pn(t,n)}).map(tp)).getOr(a);return Qg(c,a.left(),a.top())},th=function(e,t,n,o){var r=e,i=t,u=n,a=o;e<0&&(r=0,u=n+e),t<0&&(i=0,a=o+t);var c=$g(Qm(r,i));return B.some(gp(c,u,a))},nh=function(e,c,s,f,l){return e.map(function(e){var t,n,o,r=[c,e.point()],i=(t=function(){return Xg(r)},n=function(){return Xg(r)},o=function(){return e=H(r,Yg),Zg(e);var e},f.fold(t,n,o)),u=hp(i.left(),i.top(),e.width(),e.height()),a=rg(l,s,s.showAbove?[Yp,Jp,qp,Kp,Zp,Xp]:[qp,Kp,Yp,Jp,Xp,Xp],s.showAbove?[Jp,Yp,Kp,qp,Zp,Xp]:[Kp,qp,Jp,Yp,Xp,Zp]);return ng({anchorBox:u,bubble:s.bubble.getOr(Hp()),overrides:s.overrides,layouts:a,placer:B.none()})})},oh=Dr("element","offset"),rh=function(e,t){return Ko(e)?oh(e,t):function(e,t){var n=_r(e);if(0===n.length)return qg(e,t);if(t<n.length)return qg(n[t],0);var o=n[n.length-1],r=Ko(o)?Dg(o).length:_r(o).length;return qg(o,r)}(e,t)},ih=function(t,e){return e.getSelection.getOrThunk(function(){return function(){return e=t,B.from(e.getSelection()).filter(function(e){return 0<e.rangeCount}).bind(Gg);var e}})().map(function(e){var t=rh(e.start(),e.soffset()),n=rh(e.finish(),e.foffset());return lg.range(t.element(),t.offset(),n.element(),n.offset())})},uh=[jt("getSelection"),At("root"),jt("bubble"),og(),qt("overrides",{}),qt("showAbove",!1),Ga("placement",function(e,t,n){var o=Br(t.root).dom(),r=eh(e,0,t),i=ih(o,t).bind(function(e){return Wg(o,lg.exactFromRange(e)).orThunk(function(){var t=Bn.fromText("\ufeff");return Hr(e.start(),t),Wg(o,lg.exact(t,0,t,1)).map(function(e){return Ur(t),e})}).bind(function(e){return th(e.left(),e.top(),e.width(),e.height())})}),u=ih(o,t).bind(function(e){return qo(e.start())?B.some(e.start()):Mr(e.start())}).getOr(e.element());return nh(i,r,t,n,u)})],ah=[At("node"),At("root"),jt("bubble"),og(),qt("overrides",{}),qt("showAbove",!1),Ga("placement",function(r,i,u){var a=eh(r,0,i);return i.node.bind(function(e){var t=e.dom().getBoundingClientRect(),n=th(t.left,t.top,t.width,t.height),o=i.node.getOr(r.element());return nh(n,a,i,u,o)})})],ch=function(e){return e.x()+e.width()},sh=function(e,t){return e.x()-t.width()},fh=function(e,t){return e.y()-t.height()+e.height()},lh=function(e){return e.y()},dh=function(e,t,n){return Rp(ch(e),lh(e),n.southeast(),ap(),"link-layout-se")},mh=function(e,t,n){return Rp(sh(e,t),lh(e),n.southwest(),cp(),"link-layout-sw")},ph=function(e,t,n){return Rp(ch(e),fh(e,t),n.northeast(),sp(),"link-layout-ne")},gh=function(e,t,n){return Rp(sh(e,t),fh(e,t),n.northwest(),fp(),"link-layout-nw")},hh=[At("item"),og(),qt("overrides",{}),Ga("placement",function(e,t,n){var o=kp(n,t.item.element()),r=rg(e.element(),t,[dh,mh,ph,gh],[mh,dh,gh,ph]);return B.some(ng({anchorBox:o,bubble:Hp(),overrides:t.overrides,layouts:r,placer:B.none()}))})],vh=Ft("anchor",{selection:uh,node:ah,hotspot:ig,submenu:hh,makeshift:ug}),yh=function(e,t,n,o,r){var i,u=(i=n.anchorBox,Dp(i,t));_p(u,r.element(),n.bubble,n.layouts,o,n.overrides)},bh=function(t,e,n,o,r,i){var u=kt("positioning anchor.info",vh,o);Vi(r.element(),"position","fixed");var a=Gi(r.element(),"visibility");Vi(r.element(),"visibility","hidden");var c,s,f,l=e.useFixed?Fp(0,0,L.window.innerWidth,L.window.innerHeight):(s=tp((c=t).element()),f=c.element().dom().getBoundingClientRect(),Tp(s.left(),s.top(),f.width,f.height)),d=u.placement,m=i.map(function(r){return function(){return t=tp(e=r),n=Wm(e),o=Ds(e),vp(t.left(),t.top(),n,o);var e,t,n,o}}).or(e.getBounds);d(t,u,l).each(function(e){e.placer.getOr(yh)(t,l,e,m,r)}),a.fold(function(){Wi(r.element(),"visibility")},function(e){Vi(r.element(),"visibility",e)}),Gi(r.element(),"left").isNone()&&Gi(r.element(),"top").isNone()&&Gi(r.element(),"right").isNone()&&Gi(r.element(),"bottom").isNone()&&Gi(r.element(),"position").is("fixed")&&Wi(r.element(),"position")},wh=Object.freeze({position:function(e,t,n,o,r){var i=B.none();bh(e,t,n,o,r,i)},positionWithin:bh,getMode:function(e,t,n){return t.useFixed?"fixed":"absolute"}}),xh=[qt("useFixed",!1),jt("getBounds")],Sh=xr({fields:xh,name:"positioning",active:Xm,apis:wh}),Oh=function(e,t,n,o){var r=function(t,e,n,o){n.get().each(function(e){es(t)});var r=e.getAttachPoint(t);Zc(r,t);var i=t.getSystem().build(o);return Zc(t,i),n.set(i),i}(e,t,n,o);return t.onOpen(e,r),r},kh=function(t,n,o){o.get().each(function(e){es(t),Qc(t),n.onClose(t,e),o.clear()})},Th=function(e,t,n){return n.isOpen()},Fh=function(e,t,n){var o,r,i,u,a=t.getAttachPoint(e);Vi(e.element(),"position",Sh.getMode(a)),o=e,r="visibility",i=t.cloakVisibilityAttr,u="hidden",Gi(o.element(),r).fold(function(){Zr(o.element(),i)},function(e){qr(o.element(),i,e)}),Vi(o.element(),r,u)},Dh=function(e,t,n){var o;o=e.element(),z(["top","left","right","bottom"],function(e){return Gi(o,e).isSome()})||Wi(e.element(),"position"),function(e,t,n){if(Jr(e.element(),n)){var o=Yr(e.element(),n);Vi(e.element(),t,o)}else Wi(e.element(),t)}(e,"visibility",t.cloakVisibilityAttr)},Ch=Object.freeze({cloak:Fh,decloak:Dh,open:Oh,openWhileCloaked:function(e,t,n,o,r){Fh(e,t),Oh(e,t,n,o),r(),Dh(e,t)},close:kh,isOpen:Th,isPartOf:function(t,n,e,o){return Th(0,0,e)&&e.get().exists(function(e){return n.isPartOf(t,e,o)})},getState:function(e,t,n){return n.get()}}),Ih=Object.freeze({events:function(n,o){return nr([or(Fo(),function(e,t){kh(e,n,o)})])}}),Eh=[Va("onOpen"),Va("onClose"),At("isPartOf"),At("getAttachPoint"),qt("cloakVisibilityAttr","data-precloak-visibility")],Lh=xr({fields:Eh,name:"sandboxing",active:Ih,apis:Ch,state:Object.freeze({init:function(){var t=Fr(B.none()),e=U("not-implemented");return en({readState:e,isOpen:function(){return t.get().isSome()},clear:function(){t.set(B.none())},set:function(e){t.set(B.some(e))},get:function(e){return t.get()}})}})}),Bh=U("sink"),Mh=U(vc({name:Bh(),overrides:U({dom:{tag:"div"},behaviours:br([Sh.config({useFixed:!0})]),events:nr([ir(ro()),ir(Xn()),ir(ao())])})})),Ah=U("dismiss.popups"),_h=ft([qt("isExtraPart",U(!1)),Wt("fireEventInstead",[qt("event",Eo())])]),Nh=function(e){var n=kt("Dismissal",_h,e);return{channels:Ee(Ah(),{schema:ft([At("target")]),onReceive:function(t,e){Lh.isOpen(t)&&(Lh.isPartOf(t,e.target)||n.isExtraPart(t,e.target)||n.fireEventInstead.fold(function(){return Lh.close(t)},function(e){return Ao(t,e.event)}))}})}};(Tg=kg||(kg={}))[Tg.HighlightFirst=0]="HighlightFirst",Tg[Tg.HighlightNone=1]="HighlightNone";var zh,Hh,Rh=function(e,t){var n=e.getHotspot(t).getOr(t),o=e.getAnchorOverrides();return e.layouts.fold(function(){return{anchor:"hotspot",hotspot:n,overrides:o}},function(e){return{anchor:"hotspot",hotspot:n,overrides:o,layouts:e}})},Vh=function(e,t,n,o,r,i,u){var a,c,s,f,l,d,m,p,g,h,v=Rh(e,n);return(c=v,f=o,l=r,d=u,m=t,p=s=n,g=(0,(a=e).fetch)(p).map(m),h=Gh(s,a),g.map(function(e){return e.bind(function(e){return B.from(jm.sketch(qn({},l.menu(),{uid:li(""),data:e,highlightImmediately:d===kg.HighlightFirst,onOpenMenu:function(e,t){var n=h().getOrDie();Sh.position(n,c,t),Lh.decloak(f)},onOpenSubmenu:function(e,t,n){var o=h().getOrDie();Sh.position(o,{anchor:"submenu",item:t},n),Lh.decloak(f)},onEscape:function(){return rd.focus(s),Lh.close(f),B.some(!0)}})))})})).map(function(e){return e.fold(function(){Lh.isOpen(o)&&Lh.close(o)},function(e){Lh.cloak(o),Lh.open(o,e),i(o)}),o})},Ph=function(e,t,n,o,r,i,u){return Lh.close(o),$u.pure(o)},jh=function(e,t,n,o,r,i){var u=Zm.getCoupled(n,"sandbox");return(Lh.isOpen(u)?Ph:Vh)(e,t,n,u,o,r,i)},Uh=function(e,t,n){var o,r,i=Sm.getCurrent(t).getOr(t),u=Gm(e.element());n?Vi(i.element(),"min-width",u+"px"):(o=i.element(),r=u,Um.set(o,r))},Gh=function(t,e){return t.getSystem().getByUid(e.uid+"-"+Bh()).map(function(e){return function(){return M.value(e)}}).getOrThunk(function(){return e.lazySink.fold(function(){return function(){return M.error(new Error("No internal sink is specified, nor could an external sink be found"))}},function(e){return function(){return e(t)}})})},Wh=function(o,r,i){var t,e,n,u=(t=ri("aria-owns"),{id:U(t),link:function(e){qr(e,"aria-owns",t)},unlink:function(e){Zr(e,"aria-owns")}}),a=Gh(r,o);return{dom:{tag:"div",classes:o.sandboxClasses,attributes:{id:u.id(),role:"listbox"}},behaviours:Vc(o.sandboxBehaviours,[em.config({store:{mode:"memory",initialValue:r}}),Lh.config({onOpen:function(e,t){var n=Rh(o,r);u.link(r.element()),o.matchWidth&&Uh(n.hotspot,t,o.useMinWidth),o.onOpen(n,e,t),void 0!==i&&void 0!==i.onOpen&&i.onOpen(e,t)},onClose:function(e,t){u.unlink(r.element()),void 0!==i&&void 0!==i.onClose&&i.onClose(e,t)},isPartOf:function(e,t,n){return Km(t,n)||Km(r,n)},getAttachPoint:function(){return a().getOrDie()}}),Sm.config({find:function(e){return Lh.getState(e).bind(function(e){return Sm.getCurrent(e)})}}),(e={isExtraPart:U(!1)},n=Nh(e),Gc.config(n))])}},qh=U([At("dom"),At("fetch"),Va("onOpen"),Pa("onExecute"),qt("getHotspot",B.some),qt("getAnchorOverrides",U({})),qt("layouts",B.none()),Nc("dropdownBehaviours",[xs,Zm,_l,rd]),At("toggleClass"),qt("eventOrder",{}),jt("lazySink"),qt("matchWidth",!1),qt("useMinWidth",!1),jt("role")].concat([qt("sandboxClasses",[]),Rc("sandboxBehaviours",[Sm,Gc,Lh,em])])),Kh=U([hc({schema:[Ha()],name:"menu",defaults:function(e){return{onExecute:e.onExecute}}}),Mh()]),Yh=_c({name:"Dropdown",configFields:qh(),partFields:Kh(),factory:function(t,e,n,o){var r,i,u=function(e){Lh.getState(e).each(function(e){jm.highlightPrimary(e)})},a={expand:function(e){xs.isOn(e)||jh(t,function(e){return e},e,o,b,kg.HighlightNone).get(b)},open:function(e){xs.isOn(e)||jh(t,function(e){return e},e,o,b,kg.HighlightFirst).get(b)},isOpen:xs.isOn,close:function(e){xs.isOn(e)&&jh(t,function(e){return e},e,o,b,kg.HighlightFirst).get(b)}},c=function(e,t){return No(e),B.some(!0)};return{uid:t.uid,dom:t.dom,components:e,behaviours:Hc(t.dropdownBehaviours,[xs.config({toggleClass:t.toggleClass,aria:{mode:"expanded"}}),Zm.config({others:{sandbox:function(e){return Wh(t,e,{onOpen:function(){xs.on(e)},onClose:function(){xs.off(e)}})}}}),_l.config({mode:"special",onSpace:c,onEnter:c,onDown:function(e,t){if(Yh.isOpen(e)){var n=Zm.getCoupled(e,"sandbox");u(n)}else Yh.open(e);return B.some(!0)},onEscape:function(e,t){return Yh.isOpen(e)?(Yh.close(e),B.some(!0)):B.none()}}),rd.config({})]),events:vm(B.some(function(e){jh(t,function(e){return e},e,o,u,kg.HighlightFirst).get(b)})),eventOrder:qn({},t.eventOrder,(r={},r[xo()]=["disabling","toggling","alloy.base.behaviour"],r)),apis:a,domModification:{attributes:qn({"aria-haspopup":"true"},t.role.fold(function(){return{}},function(e){return{role:e}}),"button"===t.dom.tag?{type:(i="type",Ie(t.dom,"attributes").bind(function(e){return Ie(e,i)})).getOr("button")}:{})}}},apis:{open:function(e,t){return e.open(t)},expand:function(e,t){return e.expand(t)},close:function(e,t){return e.close(t)},isOpen:function(e,t){return e.isOpen(t)}}}),Jh=function(e){return eu(e)},Zh=function(e){return eu(e)},Xh=function(){return Vd.sketch({iconHtml:Nd,classes:[id.LocationIcon,id.Star]})},$h=Ac({name:"Label",factory:function(o){return o.action.fold(function(){return{dom:{tag:"span",classes:(e=o).classes},components:[Jh(e.text)].concat(e.starred?[Xh()]:[]),behaviours:pe(br([as.config({})]),zc(e.labelBehaviours))};var e},function(e){return t=o,n=e,ym.sketch({dom:{tag:"a",classes:[id.AssetName,id.FocusStop]},components:[{dom:{tag:"span"},components:[Jh(t.text)].concat(t.starred?[Xh()]:[])}],buttonBehaviours:pe(br([as.config({})]),zc(t.labelBehaviours)),action:n});var t,n})},configFields:[zt("text"),(zh="starred",Hh=!1,Kt(zh,Hh,Lt)),qt("classes",[]),Gt("action"),Nc("labelBehaviours",[])],apis:{setText:function(e,t,n,o){as.set(t,[Jh(n)].concat(o?[Xh()]:[]))}}}),Qh=function(e,t){Pn(e.element(),t.event().target())&&Ao(e,Fo())},ev={markers:{item:id.MenuItem,selectedItem:id.MenuItemUnselected,menu:id.Menu,selectedMenu:id.MenuSelected,backgroundMenu:id.MenuBackground},dom:{tag:"div",classes:[id.MenuContainer,id.MenuBackdrop]},tmenuBehaviours:br([Tr("events",[or(Yn(),Qh),or(ao(),Qh)])])},tv=function(){return!L.matchMedia("only screen and (min-width:767px)").matches},nv=function(o){return function(e,t,n){tv()&&t.getSystem().getByUid(o).each(function(e){Zr(e.element(),"style")})}},ov=function(r){return function(t,e,n){var o=Eu(n,r,Lu(e(),{}));Nu(t,e(),o,function(e){t({type:pa.SetViewType,payload:{viewType:r}}),t(Bu(e))})}},rv=function(e,t,n){return{type:"item",data:{meta:{text:t},value:n},dom:{tag:"div"},components:[Vd.sketch({iconHtml:e,classes:[id.MenuIcon]}),$h.sketch({text:t,classes:[id.MenuLabel]})]}},iv=function(e){var t;return t="starred"===e?"Starred":"Files",[{dom:{tag:"span",classes:[id.LocationButtonLabel]},components:[Jh(t)]},Vd.sketch({iconHtml:gd})]},uv=Ac({name:"BreadcrumbDropdown",factory:function(e){var o=ri("menu"),t="starred"===e.viewType?Vd.sketch({iconHtml:Cd,classes:[id.LocationIcon]}):Vd.sketch({iconHtml:kd,classes:[id.LocationIcon]}),n=cs(Yh.sketch({dom:{tag:"button",classes:[id.LocationButton]},components:iv(e.viewType),toggleClass:id.ButtonSelected,parts:{menu:ev},lazySink:e.lazySink,matchWidth:!0,dropdownBehaviours:br([Ql.config({})]),fetch:function(){return $u.pure(B.some(jm.singleData("basic-list",{uid:o,dom:{tag:"div",classes:[id.Menu,id.MenuHasIcons]},components:[zm.parts().items({})],items:[rv(kd,"Files","all"),rv(Nd,"Starred","starred")]})))},onExecute:function(e,t){var n=em.getValue(t);_o(e,o+"execute-event",{item:n})},onOpen:nv(o),sandboxBehaviours:br([Tr("dropdown-sandbox-events",[or(o+"execute-event",function(e,t){var n=t.event().item(),o=em.getValue(e);rd.focus(o),"all"===n.value?Yu(e,ov("all")):"starred"===n.value&&Yu(e,ov("starred")),Ao(e,Fo())})])])}));return{dom:{tag:"div",classes:[id.Location].concat("starred"===e.viewType?[id.LocationStarred]:[id.LocationFiles])},components:[t,n.asSpec()],behaviours:br([rd.config({onFocus:function(e){n.getOpt(e).each(rd.focus)}})])}},configFields:[At("viewType"),At("lazySink")]}),av=function(n){return function(t,e){j(e().fileState.files,function(e){return e.uuid===n}).each(function(e){t({type:"selectedFiles.select",payload:{file:e}})})}},cv=function(n){return function(t,e){j(e().fileState.files,function(e){return e.uuid===n}).each(function(e){t({type:"selectedFiles.unselect",payload:{uuid:e.uuid}})})}},sv=function(){return function(e,t){e({type:"selectedFiles.selectAll",payload:{files:t().fileState.files}})}},fv=function(i){return function(t,e,n){var o=ee(e().path.slice(0,i)).bind(function(e){return e.uuid}),r=Eu(n,e().viewType,Lu(e(),{parentUuid:o}));t({type:"selectedFiles.clear",payload:""}),Nu(t,e(),r,function(e){t({type:da.Slice,payload:{index:i}}),t(Bu(e))})}},lv=function(e,t){if(5===t.length)return t;if(e<=G(t,function(e,t){return e+t.width},0)){var n=t.slice(0,4).concat(t.slice(6));return G(n,function(e,t){return e+t.width},0)<=e?t.slice(0,4).concat(t.slice(6)):lv(e,t.slice(0,4).concat(t.slice(6)))}return t},dv=function(e,t,n){var o=t===n.length-1;return ym.sketch({dom:{tag:o?"span":"a",attributes:{href:"#"},classes:o?[]:[id.FocusStop]},components:[Zh(e.name)],action:function(e){o||Yu(e,fv(t+1))}})},mv={dom:{tag:"span",innerHtml:"..."}},pv=function(e,t,n){var o=bm([t[0],mv].concat(t.slice(1)),n),r=ou(Pc.sketch({dom:{classes:[id.Breadcrumb]},components:o}));Vr(e.element(),r.element());var i=Gm(e.element()),u=H(r.components(),function(e,t){return{component:e,width:Gm(e.element()),spec:o[t]}});return H(function(e,t){if(3===t.length)return t.slice(0,1);if(5===t.length)return t.slice(0,2).concat(t.slice(4));if(e<G(t,function(e,t){return e+t.width},0)){var n=t.slice(0,2).concat(t.slice(4));return G(n,function(e,t){return e+t.width},0)<=e?t.slice(0,2).concat(t.slice(4)):lv(e,t.slice(0,4).concat(t.slice(6)))}return t.slice(0,2).concat(t.slice(4))}(i,u),function(e){return e.spec})},gv=Vd.sketch({iconHtml:hd}),hv=Ac({name:"BreadCrumbs",factory:function(a){return{uid:a.uid,dom:{tag:"div",classes:[id.NavbarContainer]},behaviours:pe(br([rd.config({}),as.config({})]),zc(a.breadcrumbsBehaviours)),apis:{setItems:function(e,t,n){var o,r,i=0===t.length?[uv.sketch({viewType:n,lazySink:a.lazySink})]:[(o=pv(e,(r=t,[ym.sketch({dom:{tag:"a",classes:[id.FocusStop]},components:[Jh("Files")],action:function(e){Yu(e,fv(0))}})].concat(H(r,dv))),a.separator),{dom:{tag:"div",classes:[id.Breadcrumb]},components:o,behaviours:br([Ql.config({}),rd.config({onFocus:function(e){Q(e.components()).each(rd.focus)}}),_l.config({mode:"flow",allowVertical:!1,selector:"."+id.FocusStop}),as.config({})])})],u=function(){return as.set(e,i)};Kc(e.element()).fold(u,function(){u(),Q(e.components()).each(rd.focus)})}}}},configFields:[qt("separator",gv),Vt("components","no!!"),At("lazySink"),Nc("breadcrumbsBehaviours",[])],apis:{setItems:function(e,t,n,o){e.setItems(t,n,o)}}}),vv=function(t){return function(n,e){re(t,function(e,t){Mi(n,e)}),se(t,e).each(function(){return Li(n,t[e])})}},yv=function(e,t){var n=B.from(Yr(e,"id")).fold(function(){var e=ri("dialog-label");return qr(t,"id",e),e},m);qr(e,"aria-labelledby",n)};function bv(n,o){var r=null;return{cancel:function(){null!==r&&(L.clearTimeout(r),r=null)},schedule:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r=L.setTimeout(function(){n.apply(null,e),r=null},o)}}}var wv="data-initial-z-index",xv=function(e,t){var n;e.getSystem().addToGui(t),Mr((n=t).element()).each(function(t){Gi(t,"z-index").each(function(e){qr(t,wv,e)}),Vi(t,"z-index",ji(n.element(),"z-index"))})},Sv=function(e){Mr(e.element()).each(function(e){var t=Yr(e,wv);Jr(e,wv)?Vi(e,"z-index",t):Wi(e,"z-index"),Zr(e,wv)}),e.getSystem().removeFromGui(e)},Ov=le([{offset:["x","y"]},{absolute:["x","y"]},{fixed:["x","y"]}]),kv=function(t){return function(e){return e.translate(-t.left(),-t.top())}},Tv=function(t){return function(e){return e.translate(t.left(),t.top())}},Fv=function(n){return function(e,t){return G(n,function(e,t){return t(e)},Qm(e,t))}},Dv=function(e,t,n){return e.fold(Fv([Tv(n),kv(t)]),Fv([kv(t)]),Fv([]))},Cv=function(e,t,n){return e.fold(Fv([Tv(n)]),Fv([]),Fv([Tv(t)]))},Iv=function(e,t,n){return e.fold(Fv([]),Fv([kv(n)]),Fv([Tv(t),kv(n)]))},Ev=Ov.offset,Lv=Ov.absolute,Bv=Ov.fixed,Mv=function(e,t,n,o){return(r=e,i=t,u=r.element(),a=parseInt(Yr(u,i.leftAttr),10),c=parseInt(Yr(u,i.topAttr),10),isNaN(a)||isNaN(c)?B.none():B.some(Qm(a,c))).fold(function(){return n},function(e){return Bv(e.left()+o.left(),e.top()+o.top())});var r,i,u,a,c},Av=function(e,t,n,o,r,i){var u,a,c,s=Mv(e,t,n,o),f=Nv(e,t,s,r,i),l=Dv(s,r,i);return u=t,a=l,c=e.element(),qr(c,u.leftAttr,a.left()+"px"),qr(c,u.topAttr,a.top()+"px"),f.fold(function(){return{coord:Bv(l.left(),l.top()),extra:B.none()}},function(e){return{coord:e.output(),extra:e.extra()}})},_v=function(e,t){var n,o;n=t,o=e.element(),Zr(o,n.leftAttr),Zr(o,n.topAttr)},Nv=function(e,t,g,h,v){var n=t.getSnapPoints(e);return ka(n,function(e){var t,n,o,r,i,u,a,c,s,f,l,d,m,p=e.sensor();return(t=g,n=p,o=e.range().left(),r=e.range().top(),a=Cv(t,i=h,u=v),c=Cv(n,i,u),Math.abs(a.left()-c.left())<=o&&Math.abs(a.top()-c.top())<=r)?B.some({output:U((s=e.output(),f=g,l=h,d=v,m=function(o,r){return function(e,t){var n=o(f,l,d);return r(e.getOr(n.left()),t.getOr(n.top()))}},s.fold(m(Iv,Ov.offset),m(Cv,Ov.absolute),m(Dv,Ov.fixed)))),extra:e.extra}):B.none()})},zv=function(n,e,i,u,a,c){return e.fold(function(){var e,n,o,t=(e=i,n=c.left(),o=c.top(),e.fold(function(e,t){return Ov.offset(e+n,t+o)},function(e,t){return Ov.absolute(e+n,t+o)},function(e,t){return Ov.fixed(e+n,t+o)})),r=Dv(t,u,a);return Bv(r.left(),r.top())},function(t){var e=Av(n,t,i,c,u,a);return e.extra.each(function(e){t.onSensor(n,e)}),e.coord})},Hv=function(e,t,n){var o,r,i,u,a=t.getTarget(e.element());if(t.repositionTarget){var c=Lr(e.element()),s=op(c),f=(u=s,Ar(i=a).orThunk(function(){var e=Bn.fromTag("span");Hr(i,e);var t=Ar(e);return Ur(e),t}).map(function(e){return tp(e).translate(-u.left(),-u.top())}).getOrThunk(function(){return Qm(0,0)})),l=Gi(r=a,"left").bind(function(n){return Gi(r,"top").bind(function(t){return Gi(r,"position").map(function(e){return("fixed"===e?Bv:Ev)(parseInt(n,10),parseInt(t,10))})})}).getOrThunk(function(){var e=tp(r);return Lv(e.left(),e.top())}),d=zv(e,t.snaps,l,s,f,n),m=(o=f,d.fold(function(e,t){return{position:"absolute",left:e+"px",top:t+"px"}},function(e,t){return{position:"absolute",left:e-o.left()+"px",top:t-o.top()+"px"}},function(e,t){return{position:"fixed",left:e+"px",top:t+"px"}}));Pi(a,m)}t.onDrag(e,a,n)},Rv=Wt("snaps",[At("getSnapPoints"),Va("onSensor"),At("leftAttr"),At("topAttr"),qt("lazyViewport",function(){var e=op();return{x:e.left,y:e.top,width:U(L.window.innerWidth),height:U(L.window.innerHeight),bottom:U(e.top()+L.window.innerHeight),right:U(e.left()+L.window.innerWidth)}})]),Vv=Object.freeze({getData:function(e){return B.from(Qm(e.x(),e.y()))},getDelta:function(e,t){return Qm(t.left()-e.left(),t.top()-e.top())}}),Pv=[qt("useFixed",!1),At("blockerClass"),qt("getTarget",m),qt("onDrag",b),qt("repositionTarget",!0),Va("onDrop"),Rv,Ga("dragger",{handlers:function(a,c){return nr([or(Xn(),function(t,e){if(0===e.event().raw().button){e.stop();var n,o={drop:function(){i()},delayDrop:function(){u.schedule()},forceDrop:function(){i()},move:function(e){u.cancel(),c.update(Vv,e).each(function(e){Hv(t,a,e)})}},r=t.getSystem().build(Pc.sketch({dom:{styles:{left:"0px",top:"0px",width:"100%",height:"100%",position:"fixed","z-index":"1000000000000000"},classes:[a.blockerClass]},events:(n=o,nr([or(Xn(),n.forceDrop),or(eo(),n.drop),or($n(),function(e,t){n.move(t.event())}),or(Qn(),n.delayDrop)]))})),i=function(){Sv(r),a.snaps.each(function(e){_v(t,e)});var e=a.getTarget(t.element());a.onDrop(t,e)},u=bv(i,200);c.reset(),xv(t,r)}})])}})],jv=Object.freeze({getData:function(e){var t,n=e.raw().touches;return 1===n.length?(t=n[0],B.some(Qm(t.clientX,t.clientY))):B.none()},getDelta:function(e,t){return Qm(t.left()-e.left(),t.top()-e.top())}}),Uv=Pv,Gv=[qt("useFixed",!1),qt("getTarget",m),qt("onDrag",b),qt("repositionTarget",!0),qt("onDrop",b),Rv,Ga("dragger",{handlers:function(o,r){return nr([ur(Yn()),or(Jn(),function(t,e){e.stop(),r.update(jv,e.event()).each(function(e){Hv(t,o,e)})}),or(Zn(),function(t,e){o.snaps.each(function(e){_v(t,e)});var n=o.getTarget(t.element());r.reset(),o.onDrop(t,n)})])}})],Wv=Object.freeze({mouse:Uv,touch:Gv}),qv=Object.freeze({init:function(){var i=B.none(),e=U({});return en({readState:e,reset:function(){i=B.none()},update:function(r,e){return r.getData(e).bind(function(e){return t=r,n=e,o=i.map(function(e){return t.getDelta(e,n)}),i=B.some(n),o;var t,n,o})}})}}),Kv=Or({branchKey:"mode",branches:Wv,name:"dragging",active:{events:function(e,t){return e.dragger.handlers(e,t)}},extra:{snap:Er(["sensor","range","output"],["extra"])},state:qv}),Yv=U([At("lazySink"),jt("dragBlockClass"),qt("useTabstopAt",U(!0)),qt("eventOrder",{}),Nc("modalBehaviours",[_l]),Pa("onExecute"),Ua("onEscape")]),Jv={sketch:m},Zv=U([vc({name:"draghandle",overrides:function(e,t){return{behaviours:br([Kv.config({mode:"mouse",getTarget:function(e){return Is(e,'[role="dialog"]').getOr(e)},blockerClass:e.dragBlockClass.getOrDie(new Error("The drag blocker class was not specified for a dialog with a drag handle: \n"+nt(t,null,2)).message)})])}}}),gc({schema:[At("dom")],name:"title"}),gc({factory:Jv,schema:[At("dom")],name:"close"}),gc({factory:Jv,schema:[At("dom")],name:"body"}),vc({factory:Jv,schema:[At("dom")],name:"footer"}),hc({factory:{sketch:function(e,t){return qn({},e,{dom:t.dom,components:t.components})}},schema:[qt("dom",{tag:"div",styles:{position:"fixed",left:"0px",top:"0px",right:"0px",bottom:"0px"}}),qt("components",[])],name:"blocker"})]),Xv=_c({name:"ModalDialog",configFields:Yv(),partFields:Zv(),factory:function(r,e,t,o){var a=ri("alloy.dialog.busy"),c=ri("alloy.dialog.idle"),s=br([_l.config({mode:"special",onTab:function(){return B.some(!0)},onShiftTab:function(){return B.some(!0)}}),rd.config({})]),n=ri("modal-events"),i=qn({},r.eventOrder,{"alloy.system.attached":[n].concat(r.eventOrder["alloy.system.attached"]||[])});return{uid:r.uid,dom:r.dom,components:e,apis:{show:function(i){var e=r.lazySink(i).getOrDie(),u=Fr(B.none()),t=o.blocker(),n=e.getSystem().build(qn({},t,{components:t.components.concat([ru(i)]),behaviours:br([Tr("dialog-blocker-events",[or(c,function(e,t){Jr(i.element(),"aria-busy")&&(Zr(i.element(),"aria-busy"),u.get().each(function(e){return as.remove(i,e)}))}),or(a,function(e,t){qr(i.element(),"aria-busy","true");var n=t.event().getBusySpec();u.get().each(function(e){as.remove(i,e)});var o=n(i,s),r=e.getSystem().build(o);u.set(B.some(r)),as.append(i,ru(r)),r.hasConfigured(_l)&&_l.focusIn(r)})])])}));Zc(e,n),_l.focusIn(i)},hide:function(t){Mr(t.element()).each(function(e){t.getSystem().getByDom(e).each(function(e){Qc(e)})})},getBody:function(e){return Fc(e,r,"body")},getFooter:function(e){return Fc(e,r,"footer")},setIdle:function(e){Ao(e,c)},setBusy:function(e,t){_o(e,a,{getBusySpec:t})}},eventOrder:i,domModification:{attributes:{role:"dialog","aria-modal":"true"}},behaviours:Hc(r.modalBehaviours,[as.config({}),_l.config({mode:"cyclic",onEnter:r.onExecute,onEscape:r.onEscape,useTabstopAt:r.useTabstopAt}),Tr(n,[ar(function(e){var t,n,o;yv(e.element(),Fc(e,r,"title").element()),t=e.element(),n=Fc(e,r,"body").element(),o=B.from(Yr(t,"id")).fold(function(){var e=ri("dialog-describe");return qr(n,"id",e),e},m),qr(t,"aria-describedby",o)})])])}},apis:{show:function(e,t){e.show(t)},hide:function(e,t){e.hide(t)},getBody:function(e,t){return e.getBody(t)},getFooter:function(e,t){return e.getFooter(t)},setBusy:function(e,t,n){e.setBusy(t,n)},setIdle:function(e,t){e.setIdle(t)}}}),$v=[Nc("formBehaviours",[em])],Qv=function(e){return"<alloy.field."+e+">"},ey=function(r,e,t){return{uid:r.uid,dom:r.dom,components:e,behaviours:Hc(r.formBehaviours,[em.config({store:{mode:"manual",getValue:function(e){var t,n,o=(t=r,n=e.getSystem(),ie(t.partUids,function(e,t){return U(n.getByUid(e))}));return ie(o,function(e,t){return e().bind(function(e){var t,n=Sm.getCurrent(e);return t="missing current",n.fold(function(){return M.error(t)},M.value)}).map(em.getValue)})},setValue:function(n,e){re(e,function(t,e){Tc(n,r,e).each(function(e){Sm.getCurrent(e).each(function(e){em.setValue(e,t)})})})}}})]),apis:{getField:function(e,t){return Tc(e,r,t).bind(Sm.getCurrent)}}}},ty={getField:vi(function(e,t,n){return e.getField(t,n)}),sketch:function(e){var i,t=(i=[],{field:function(e,t){return i.push(e),n="form",o=Qv(e),r=t,{uiType:ec(),owner:n,name:o,config:r,validated:{}};var n,o,r},record:function(){return i}}),n=e(t),o=t.record(),r=H(o,function(e){return gc({name:e,pname:Qv(e)})});return Ec("form",$v,r,ey,n)}},ny=U([qt("prefix","form-field"),Nc("fieldBehaviours",[Sm,em])]),oy=U([vc({schema:[At("dom")],name:"label"}),vc({factory:{sketch:function(e){return{uid:e.uid,dom:{tag:"span",styles:{display:"none"},attributes:{"aria-hidden":"true"},innerHtml:e.text}}}},schema:[At("text")],name:"aria-descriptor"}),gc({factory:{sketch:function(e){var t=Fe(e,["factory"]);return e.factory.sketch(t)}},schema:[At("factory")],name:"field"})]),ry=_c({name:"FormField",configFields:ny(),partFields:oy(),factory:function(c,e,t,n){var o=Hc(c.fieldBehaviours,[Sm.config({find:function(e){return Tc(e,c,"field")}}),em.config({store:{mode:"manual",getValue:function(e){return Sm.getCurrent(e).bind(em.getValue)},setValue:function(e,t){Sm.getCurrent(e).each(function(e){em.setValue(e,t)})}}})]),r=nr([ar(function(e,t){var n,o,r,i,u,a=(n=e,o=["label","field","aria-descriptor"],r={},i=c.partUids,u=n.getSystem(),R(o,function(e){r[e]=u.getByUid(i[e])}),ie(r,U));a.field().each(function(n){var t=ri(c.prefix);a.label().each(function(e){qr(e.element(),"for",t),qr(n.element(),"id",t)}),a["aria-descriptor"]().each(function(e){var t=ri(c.prefix);qr(e.element(),"id",t),qr(n.element(),"aria-describedby",t)})})})]),i={getField:function(e){return Tc(e,c,"field")},getLabel:function(e){return Tc(e,c,"label")}};return{uid:c.uid,dom:c.dom,components:e,behaviours:o,events:r,apis:i}},apis:{getField:function(e,t){return e.getField(t)},getLabel:function(e,t){return e.getLabel(t)}}}),iy=function(e){return e.element()},uy=function(t){return function(e){return e&&""!==e?M.value(e):M.error(t)}},ay=/[<>:"\/\\|?*\x00-\x1F]/g,cy=function(t){return function(e){return e&&null===e.match(ay)?M.value(e):M.error(t)}},sy=function(e){return function(n,o){return G(e,function(e,t){return e.isError()?e:t(n,o)},M.value(n))}},fy=function(e,t,n,o){var r=Xv.parts().title({dom:{tag:"div",classes:[id.DialogTitle]},components:[Jh(e.title)]}),i=Xv.parts().close(ym.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonIcon,id.ButtonNaked]},action:function(e){o(e,"close")},components:[Vd.sketch({iconHtml:vd,classes:[]})],buttonBehaviours:br([Ql.config({})])})),u=Xv.parts().body({dom:{tag:"div",classes:[id.DialogBody]},components:t}),a=ae(e.buttons,function(e,t){return ym.sketch({dom:{tag:"button",classes:[id.Button].concat(!0===e.primary?[]:[id.ButtonSecondary])},components:[Jh(e.text)],action:function(e){o(e,t)},buttonBehaviours:br([Ql.config({})])})}),c=Xv.parts().footer({dom:{tag:"div",classes:[id.DialogFooter]},components:a}),s=ou(Xv.sketch({lazySink:e.lazySink,onEscape:function(e){return o(e,"close"),B.some(!0)},dom:{tag:"div",classes:[id.Dialog]},components:[{dom:{tag:"div",classes:[id.DialogDialog]},components:[{dom:{tag:"div",classes:[id.DialogHeader]},components:[r,i]},u,c]}],parts:{blocker:{dom:{tag:"div",styles:{position:"fixed"},classes:[id.Dialog,id.DialogBackdrop]}}}}));return Xv.show(s),n&&ty.getField(Xv.getBody(s).components()[0],"value").each(function(e){e.element().dom().focus()}),s},ly=function(e,t,n,o){mm.run(n).get(function(){mm.isInvalid(n)||(Xv.hide(t),e({action:"submit",value:o}))})},dy=function(e,u,a,c){void 0===c&&(c="");var s=cs(Pc.sketch({dom:{classes:[id.InputMsgError]}}));return $u.nu(function(r){var t=cs(ty.sketch(function(e){return{dom:{tag:"div",classes:[id.Form]},components:[e.field("value",ry.sketch({dom:{tag:"div",classes:[id.FormGroup]},components:[ry.parts().label({dom:{tag:"label",classes:[id.InputLabel]},components:[Jh(u)]}),ry.parts().field({factory:om,data:c,inputClasses:[id.InputField],inputBehaviours:br([Ql.config({})])}),s.asSpec()]}))],formBehaviours:br([_l.config({mode:"special",onEnter:function(t,e){return em.getValue(t).value.each(function(e){return ly(r,i,t,e)}),B.some(!0)}}),(n=a,t=s,o=c,mm.config({invalidClass:"tam-invalid-input",notify:{getContainer:function(e){return t.getOpt(e).map(iy)}},validator:{validate:function(e){var t=em.getValue(e).value;return $u.pure(n(t.getOr(""),o))},validateOnLoad:!1}}))])};var n,t,o})),i=fy(e,[t.asSpec()],!0,function(e,n){t.getOpt(i).each(function(t){em.getValue(t).value.each(function(e){"submit"!==n?(Xv.hide(i),r({action:n,value:e})):ly(r,i,t,e)})})})})},my=function(e){return"submit"===e.action&&0<e.value.length?B.some(e.value):B.none()},py=function(e,t){return dy({title:"Rename",lazySink:e,buttons:{submit:{text:"Submit",primary:!0},cancel:{text:"Cancel"}}},"New name",sy([uy("Filename cannot be empty."),cy("Incorrect filename.")]),t).map(my)},gy=function(e,t,r){return $u.nu(function(n){var o=fy({title:t,lazySink:e,buttons:{yes:{text:"Yes",primary:!0},no:{text:"No"}}},[{dom:{tag:"p"},components:[Jh(r)]}],!1,function(e,t){Xv.hide(o),n("yes"===t)})})},hy=function(e){return gy(e,"Delete item?","Are you sure you want to delete this item?")},vy=function(e){return gy(e,"Delete selected items?","Are you sure you want to delete the selected items?")},yy=function(o,r){return function(t,e,n){j(e().fileState.files,function(e){return e.uuid===o}).each(function(e){t(wy(r,[e]))})}},by=function(r){return function(e,t,n){var o=t().selectedFiles;e(wy(r,o)),e({type:"selectedFiles.clear",payload:{}})}},wy=function(e,t){return{type:ga.Push,payload:{operation:e,files:t}}},xy=function(r){return function(e){return function(t,n,o){(r?o.star:o.unstar)(e).get(function(e){return e.fold(Ou(t),function(e){return Hu(t,n,o)})})}}},Sy=xy(!0),Oy=xy(!1),ky=function(e,r){return function(t,n,o){o.rename(e,r).get(function(e){return e.fold(Ou(t),function(e){return Hu(t,n,o)})})}},Ty=function(){return function(e,t,n){e({type:"selectedFiles.clear",payload:""}),e({type:ga.Clear,payload:{}})}},Fy=function(){return function(f,l,d){l().clipboard.each(function(e){var t,n,o,r,i,u,a,c,s;"move"===e.operation?(i=f,u=l,a=d,c=H(e.files,function(e){return e.uuid}),s=function(e){e.fold(Ou(i),function(e){zu(i,u,a),Ty()(i,u,a)})},ee(u().path).bind(function(e){return e.uuid}).fold(function(){return a.move(c).get(s)},function(e){return a.move(c,e).get(s)})):(t=f,n=l,o=d,r=function(e){e.fold(Ou(t),function(e){zu(t,n,o),Ty()(t,n,o)})},Q(e.files).fold(function(){t(Su("Failed to copy file"))},function(t){ee(n().path).bind(function(e){return e.uuid}).fold(function(){return o.copy(t.uuid).get(r)},function(e){return o.copy(t.uuid,e).get(r)})}))})}},Dy=function(e){return function(t,n,o){t({type:"selectedFiles.clear",payload:""}),o.remove([e]).get(function(e){return e.fold(Ou(t),function(e){t({type:wu.Close,payload:{}}),zu(t,n,o)})})}},Cy=function(){return function(t,n,o){var e=H(n().selectedFiles,function(e){return e.uuid});t({type:"selectedFiles.clear",payload:""}),o.remove(e).get(function(e){return e.fold(Ou(t),function(e){return zu(t,n,o)})})}};function Iy(e,t){return By(L.document.createElement("canvas"),e,t)}function Ey(e){var t=Iy(e.width,e.height);return Ly(t).drawImage(e,0,0),t}function Ly(e){return e.getContext("2d")}function By(e,t,n){return e.width=t,e.height=n,e}function My(){return new(et.getOrDie("FileReader"))}var Ay={atob:function(e){return et.getOrDie("atob")(e)},requestAnimationFrame:function(e){et.getOrDie("requestAnimationFrame")(e)}};function _y(e){return e.naturalWidth||e.width}function Ny(e){return e.naturalHeight||e.height}var zy=window.Promise?window.Promise:function(){var i=function(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],f(e,n(r,this),n(a,this))},e=i.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(e){L.setTimeout(e,1)};function n(e,t){return function(){return e.apply(t,arguments)}}var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function u(n){var o=this;null!==this._state?e(function(){var e=o._state?n.onFulfilled:n.onRejected;if(null!==e){var t;try{t=e(o._value)}catch(e){return void n.reject(e)}n.resolve(t)}else(o._state?n.resolve:n.reject)(o._value)}):this._deferreds.push(n)}function r(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void f(n(t,e),n(r,this),n(a,this))}this._state=!0,this._value=e,c.call(this)}catch(e){a.call(this,e)}}function a(e){this._state=!1,this._value=e,c.call(this)}function c(){for(var e=0,t=this._deferreds;e<t.length;e++){var n=t[e];u.call(this,n)}this._deferreds=[]}function s(e,t,n,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=o}function f(e,t,n){var o=!1;try{e(function(e){o||(o=!0,t(e))},function(e){o||(o=!0,n(e))})}catch(e){if(o)return;o=!0,n(e)}}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(n,o){var r=this;return new i(function(e,t){u.call(r,new s(n,o,e,t))})},i.all=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a=Array.prototype.slice.call(1===e.length&&o(e[0])?e[0]:e);return new i(function(o,r){if(0===a.length)return o([]);var i=a.length;function u(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){u(t,e)},r)}a[t]=e,0==--i&&o(a)}catch(e){r(e)}}for(var e=0;e<a.length;e++)u(e,a[e])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(n){return new i(function(e,t){t(n)})},i.race=function(r){return new i(function(e,t){for(var n=0,o=r;n<o.length;n++)o[n].then(e,t)})},i}();function Hy(a){return new zy(function(e,t){var n=L.URL.createObjectURL(a),o=new L.Image,r=function(){o.removeEventListener("load",i),o.removeEventListener("error",u)};function i(){r(),e(o)}function u(){r(),t("Unable to load data of type "+a.type+": "+n)}o.addEventListener("load",i),o.addEventListener("error",u),o.src=n,o.complete&&i()})}function Ry(e){var t=e.split(","),n=/data:([^;]+)/.exec(t[0]);if(!n)return B.none();for(var o,r,i,u=n[1],a=t[1],c=Ay.atob(a),s=c.length,f=Math.ceil(s/1024),l=new Array(f),d=0;d<f;++d){for(var m=1024*d,p=Math.min(m+1024,s),g=new Array(p-m),h=m,v=0;h<p;++v,++h)g[v]=c[h].charCodeAt(0);l[d]=(o=g,new(et.getOrDie("Uint8Array"))(o))}return B.some((r=l,i={type:u},new(et.getOrDie("Blob"))(r,i)))}function Vy(e,o,r){return o=o||"image/png",L.HTMLCanvasElement.prototype.toBlob?new zy(function(t,n){e.toBlob(function(e){e?t(e):n()},o,r)}):(n=e.toDataURL(o,r),new zy(function(e,t){Ry(n).fold(function(){t("uri is not base64: "+n)},e)}));var n}function Py(e){return Hy(e).then(function(e){var t;t=e,L.URL.revokeObjectURL(t.src);var n=Iy(_y(e),Ny(e));return Ly(n).drawImage(e,0,0),n})}function jy(e,t,n){var o=t.type;function r(o,r){return e.then(function(e){return n=r,t=(t=o)||"image/png",e.toDataURL(t,n);var t,n})}return{getType:U(o),toBlob:function(){return zy.resolve(t)},toDataURL:function(){return n},toBase64:function(){return n.split(",")[1]},toAdjustedBlob:function(t,n){return e.then(function(e){return Vy(e,t,n)})},toAdjustedDataURL:r,toAdjustedBase64:function(e,t){return r(e,t).then(function(e){return e.split(",")[1]})},toCanvas:function(){return e.then(Ey)}}}function Uy(t){return(n=t,new zy(function(e){var t=My();t.onloadend=function(){e(t.result)},t.readAsDataURL(n)})).then(function(e){return jy(Py(t),t,e)});var n}function Gy(t,e){return Vy(t,e).then(function(e){return jy(zy.resolve(t),e,t.toDataURL())})}var Wy=function(e){return Uy(e)};function qy(e,t,n){var o=_y(e),r=Ny(e),i=t/o,u=n/r,a=!1;(i<.5||2<i)&&(i=i<.5?.5:2,a=!0),(u<.5||2<u)&&(u=u<.5?.5:2,a=!0);var c,s,f,l=(c=e,s=i,f=u,new zy(function(e){var t=_y(c),n=Ny(c),o=Math.floor(t*s),r=Math.floor(n*f),i=Iy(o,r),u=Ly(i);u.drawImage(c,0,0,t,n,0,0,o,r),e(i)}));return a?l.then(function(e){return qy(e,t,n)}):l}function Ky(t,n){return t.toCanvas().then(function(e){return function(e,t,n){var o=Iy(e.width,e.height),r=Ly(o),i=0,u=0;90!==(n=n<0?360+n:n)&&270!==n||By(o,o.height,o.width);90!==n&&180!==n||(i=o.width);270!==n&&180!==n||(u=o.height);return r.translate(i,u),r.rotate(n*Math.PI/180),r.drawImage(e,0,0),Gy(o,t)}(e,t.getType(),n)})}var Yy,Jy,Zy,Xy=function(){function e(e){this.littleEndian=!1,this._dv=new DataView(e)}return e.prototype.readByteAt=function(e){return this._dv.getUint8(e)},e.prototype.read=function(e,t){if(e+t>this.length())return null;for(var n=this.littleEndian?0:-8*(t-1),o=0,r=0;r<t;r++)o|=this.readByteAt(e+r)<<Math.abs(n+8*r);return o},e.prototype.BYTE=function(e){return this.read(e,1)},e.prototype.SHORT=function(e){return this.read(e,2)},e.prototype.LONG=function(e){return this.read(e,4)},e.prototype.SLONG=function(e){var t=this.read(e,4);return null===t?null:2147483647<t?t-4294967296:t},e.prototype.CHAR=function(e){var t=this.read(e,1);return null===t?"":String.fromCharCode(t)},e.prototype.STRING=function(e,t){return this.asArray("CHAR",e,t).join("")},e.prototype.SEGMENT=function(e,t){var n=this._dv.buffer;return void 0!==e&&void 0!==t?n.slice(e,e+t):void 0!==e?n.slice(e):n},e.prototype.asArray=function(e,t,n){for(var o=[],r=0;r<n;r++)o[r]=this[e](t+r);return o},e.prototype.length=function(){return this._dv?this._dv.byteLength:0},e}(),$y={274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},Qy={36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},eb={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},tb={513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"},nb={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},ob=function(){function e(e){if(this._offsets={tiffHeader:10,IFD0:null,IFD1:null,exifIFD:null,gpsIFD:null},this._reader=new Xy(e),this._idx=this._offsets.tiffHeader,65505!==this.SHORT(0)||"EXIF\0"!==this.STRING(4,5).toUpperCase())throw new Error("Exif data cannot be read or not available.");if(this._reader.littleEndian=18761===this.SHORT(this._idx),42!==this.SHORT(this._idx+=2))throw new Error("Invalid Exif data.");this._offsets.IFD0=this._offsets.tiffHeader+this.LONG(this._idx+=2),this._tiffTags=this.extractTags(this._offsets.IFD0,$y),"ExifIFDPointer"in this._tiffTags&&(this._offsets.exifIFD=this._offsets.tiffHeader+this._tiffTags.ExifIFDPointer,delete this._tiffTags.ExifIFDPointer),"GPSInfoIFDPointer"in this._tiffTags&&(this._offsets.gpsIFD=this._offsets.tiffHeader+this._tiffTags.GPSInfoIFDPointer,delete this._tiffTags.GPSInfoIFDPointer);var t=this.LONG(this._offsets.IFD0+12*this.SHORT(this._offsets.IFD0)+2);t&&(this._offsets.IFD1=this._offsets.tiffHeader+t)}return e.prototype.BYTE=function(e){return this._reader.BYTE(e)},e.prototype.SHORT=function(e){return this._reader.SHORT(e)},e.prototype.LONG=function(e){return this._reader.LONG(e)},e.prototype.SLONG=function(e){return this._reader.SLONG(e)},e.prototype.CHAR=function(e){return this._reader.CHAR(e)},e.prototype.STRING=function(e,t){return this._reader.STRING(e,t)},e.prototype.SEGMENT=function(e,t){return this._reader.SEGMENT(e,t)},e.prototype.asArray=function(e,t,n){for(var o=[],r=0;r<n;r++)o[r]=this[e](t+r);return o},e.prototype.length=function(){return this._reader.length()},e.prototype.UNDEFINED=function(e){return this.BYTE(e)},e.prototype.RATIONAL=function(e){return this.LONG(e)/this.LONG(e+4)},e.prototype.SRATIONAL=function(e){return this.SLONG(e)/this.SLONG(e+4)},e.prototype.ASCII=function(e){return this.CHAR(e)},e.prototype.TIFF=function(){return this._tiffTags},e.prototype.EXIF=function(){var e=null;if(this._offsets.exifIFD){try{e=this.extractTags(this._offsets.exifIFD,Qy)}catch(e){return null}if(e.ExifVersion&&Array.isArray(e.ExifVersion)){for(var t="",n=0,o=e.ExifVersion;n<o.length;n++){var r=o[n];t+=String.fromCharCode(r)}e.ExifVersion=t}}return e},e.prototype.GPS=function(){var e=null;if(this._offsets.gpsIFD){try{e=this.extractTags(this._offsets.gpsIFD,eb)}catch(e){return null}e.GPSVersionID&&Array.isArray(e.GPSVersionID)&&(e.GPSVersionID=e.GPSVersionID.join("."))}return e},e.prototype.thumb=function(){if(this._offsets.IFD1)try{var e=this.extractTags(this._offsets.IFD1,tb);if("JPEGInterchangeFormat"in e)return this.SEGMENT(this._offsets.tiffHeader+e.JPEGInterchangeFormat,e.JPEGInterchangeFormatLength)}catch(e){return null}return null},e.prototype.extractTags=function(e,t){var n=this,o={},r={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},i={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};if(e+2>n.length())return o;for(var u=n.SHORT(e),a=0;a<u;a++){var c=[],s=e+2+12*a,f=t[n.SHORT(s)];if(void 0!==f){var l=r[n.SHORT(s+=2)],d=n.LONG(s+=2),m=i[l];if(!m)throw new Error("Invalid Exif data.");if(s+=4,4<m*d&&(s=n.LONG(s)+n._offsets.tiffHeader),s+m*d>=n.length())throw new Error("Invalid Exif data.");if("ASCII"!==l){c=n.asArray(l,s,d);var p=1===d?c[0]:c;nb.hasOwnProperty(f)&&"object"!=typeof p?o[f]=nb[f][p]:o[f]=p}else o[f]=n.STRING(s,d).replace(/\0$/,"").trim()}}return o},e}(),rb=function(u){return(n=u,new zy(function(e){var t=My();t.onloadend=function(){e(t.result)},t.readAsArrayBuffer(n)})).then(function(e){try{var t=new Xy(e);if(65496!==t.SHORT(0))return zy.reject("Image was not a jpeg");var n=ib(t),o=n.filter(function(e){return"APP1"===e.name}),r={rawHeaders:n};if(!o.length)return zy.reject("Headers did not include required information");var i=new ob(o[0].segment);return r.tiff=i.TIFF(),r.exif=i.EXIF(),r.gps=i.GPS(),r.thumb=i.thumb(),r}catch(e){return zy.reject("Unsupported format or not an image: "+u.type+" (Exception: "+e.message+")")}});var n},ib=function(e){for(var t,n=[],o=2;o+2<=e.length();)if(65488<=(t=e.SHORT(o))&&t<=65495)o+=2;else{if(65498===t||65497===t)break;var r=e.SHORT(o+2)+2;65505<=t&&t<=65519&&n.push({hex:t,name:"APP"+(15&t),start:o,length:r,segment:e.SEGMENT(o,r)}),o+=r}return n},ub=function(e,t,n){return r=t,i=n,(o=e).toCanvas().then(function(e){return qy(e,r,i).then(function(e){return Gy(e,o.getType())})});var o,r,i},ab=function(e,t){return Ky(e,t)},cb=function(t){return t.toBlob().then(rb).then(function(e){switch(e.tiff.Orientation){case 6:return ab(t,90);case 3:return ab(t,180);case 8:return ab(t,270);default:return t}},function(){return t})},sb={},fb={exports:sb};Jy=sb,Zy=fb,Yy=void 0,function(e){"object"==typeof Jy&&void 0!==Zy?Zy.exports=e():"function"==typeof Yy&&Yy.amd?Yy([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=e()}(function(){return function i(u,a,c){function s(t,e){if(!a[t]){if(!u[t]){var n=!1;if(!e&&n)return n(t,!0);if(f)return f(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var r=a[t]={exports:{}};u[t][0].call(r.exports,function(e){return s(u[t][1][e]||e)},r,r.exports,i,u,a,c)}return a[t].exports}for(var f=!1,e=0;e<c.length;e++)s(c[e]);return s}({1:[function(e,t,n){var o,r,i=t.exports={};function u(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(t){if(o===setTimeout)return setTimeout(t,0);if((o===u||!o)&&setTimeout)return o=setTimeout,setTimeout(t,0);try{return o(t,0)}catch(e){try{return o.call(null,t,0)}catch(e){return o.call(this,t,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:u}catch(e){o=u}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var s,f=[],l=!1,d=-1;function m(){l&&s&&(l=!1,s.length?f=s.concat(f):d=-1,f.length&&p())}function p(){if(!l){var e=c(m);l=!0;for(var t=f.length;t;){for(s=f,f=[];++d<t;)s&&s[d].run();d=-1,t=f.length}s=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new g(e,t)),1!==f.length||l||c(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(e,l,t){(function(n){!function(e){var t=setTimeout;function o(){}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(e,this)}function r(n,o){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn(function(){var e=1===n._state?o.onFulfilled:o.onRejected;if(null!==e){var t;try{t=e(n._value)}catch(e){return void a(o.promise,e)}u(o.promise,t)}else(1===n._state?u:a)(o.promise,n._value)})):n._deferreds.push(o)}function u(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void c(t);if("function"==typeof n)return void f((o=n,r=e,function(){o.apply(r,arguments)}),t)}t._state=1,t._value=e,c(t)}catch(e){a(t,e)}var o,r}function a(e,t){e._state=2,e._value=t,c(e)}function c(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)r(e,e._deferreds[t]);e._deferreds=null}function s(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function f(e,t){var n=!1;try{e(function(e){n||(n=!0,u(t,e))},function(e){n||(n=!0,a(t,e))})}catch(e){if(n)return;n=!0,a(t,e)}}i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=new this.constructor(o);return r(this,new s(e,t,n)),n},i.all=function(e){var a=Array.prototype.slice.call(e);return new i(function(o,r){if(0===a.length)return o([]);var i=a.length;function u(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){u(t,e)},r)}a[t]=e,0==--i&&o(a)}catch(e){r(e)}}for(var e=0;e<a.length;e++)u(e,a[e])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(n){return new i(function(e,t){t(n)})},i.race=function(r){return new i(function(e,t){for(var n=0,o=r.length;n<o;n++)r[n].then(e,t)})},i._immediateFn="function"==typeof n?function(e){n(e)}:function(e){t(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},i._setImmediateFn=function(e){i._immediateFn=e},i._setUnhandledRejectionFn=function(e){i._unhandledRejectionFn=e},void 0!==l&&l.exports?l.exports=i:e.Promise||(e.Promise=i)}(this)}).call(this,e("timers").setImmediate)},{timers:3}],3:[function(c,e,s){(function(e,t){var o=c("process/browser.js").nextTick,n=Function.prototype.apply,r=Array.prototype.slice,i={},u=0;function a(e,t){this._id=e,this._clearFn=t}s.setTimeout=function(){return new a(n.call(setTimeout,window,arguments),clearTimeout)},s.setInterval=function(){return new a(n.call(setInterval,window,arguments),clearInterval)},s.clearTimeout=s.clearInterval=function(e){e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},s.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},s.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},s._unrefActive=s.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},s.setImmediate="function"==typeof e?e:function(e){var t=u++,n=!(arguments.length<2)&&r.call(arguments,1);return i[t]=!0,o(function(){i[t]&&(n?e.apply(null,n):e.call(null),s.clearImmediate(t))}),t},s.clearImmediate="function"==typeof t?t:function(e){delete i[e]}}).call(this,c("timers").setImmediate,c("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(e,t,n){var o=e("promise-polyfill"),r="undefined"!=typeof window?window:Function("return this;")();t.exports={boltExport:r.Promise||o}},{"promise-polyfill":2}]},{},[4])(4)}),fb.exports.boltExport;var lb,db,mb=function(e){return ra(function(t){e().then(function(e){return t(M.value(e))}).catch(function(e){return t(M.error(e))})})},pb=function(t){return mb(function(){return(e=t,Hy(e)).then(function(e){var t=e.naturalWidth,n=e.naturalHeight;return L.URL.revokeObjectURL(e.src),{width:t,height:n}});var e})},gb=["image/jpeg","image/png","image/gif"],hb=function(e,t){return Math.max(e.width/t.width,e.height/t.height)},vb=function(i,u){return pb(i).bindFuture(function(e){return 1<hb(e,u)?(t=i,r=hb(o=e,u),n={width:Math.round(o.width/r),height:Math.round(o.height/r)},mb(function(){return Wy(t).then(function(e){return ub(e,n.width,n.height)}).then(function(e){return e.toAdjustedBlob(t.type,9)})})):ua(i);var t,n,o,r})},yb=function(e){return ca(Wy(e).then(cb).then(function(e){return e.toBlob()}))},bb=function(e,t){return(n=e,o=t,o.map(function(e){return vb(n,{width:e,height:e})}).getOr(ia(n)).bindFuture(yb).bindFuture(function(t){return vb(t,{width:512,height:512}).mapResult(function(e){return{blob:t,thumbBlob:B.some(e)}})})).mapError(vu);var n,o},wb=function(e,t){return N(gb,e.type)?bb(e,t):ia({blob:e,thumbBlob:B.none()})},xb=104857600,Sb=function(e){var t=G(e,function(e,t){var n=e.errors,o=e.values;return t.fold(function(e){return{values:o,errors:n.concat([e])}},function(e){return{values:o.concat([e]),errors:n}})},{values:[],errors:[]});return 0<t.errors.length?M.error(t.errors):M.value(t.values)},Ob=function(e,t){return e=e.replace(/\/$/,"").replace(/^.*[\/\\]/g,""),t&&e.substr(e.length-t.length)===t&&(e=e.substr(0,e.length-t.length)),e},kb=function(e){var t=e.lastIndexOf(".");return-1!==t?e.substr(t):""},Tb={"image/gif":["gif"],"image/jpeg":["jpeg","jpg"],"image/png":["png"],"image/tiff":["tif","tiff"],"image/bmp":["bmp"]},Fb={"application/msword":["doc"],"application/vnd.ms-excel":["xls"],"application/vnd.ms-powerpoint":["ppt","pps"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/pdf":["pdf"],"application/rtf":["rtf"],"text/plain":["txt"],"application/x-iwork-keynote-sffkey":["key"],"application/x-iwork-pages-sffpages":["pages"],"application/x-iwork-numbers-sffnumbers":["numbers"]},Db={"audio/wav":["wav","wave"],"audio/mpeg":["mp3"],"audio/ogg":["ogg","oga","ogx","ogm","spx","opus"]},Cb={"video/mp4":["mp4","m4v"],"video/ogg":["ogv"],"video/webm":["webm"],"video/quicktime":["mov"]},Ib={"application/zip":["zip"]},Eb=function(t){return j(ne(Cb),function(e){return N(Cb[e],kb(t).substring(1).toLowerCase())})},Lb=Y(ce(Tb)),Bb=Y(ce(Fb)),Mb=Y(ce(Db)),Ab=Y(ce(Cb)),_b=Y(ce(Ib)),Nb=function(e){var t=kb(e).substring(1).toLowerCase(),n=function(t,e){return j(e,function(e){return e===t}).isSome()};return n(t,Lb)?B.some("image"):n(t,Bb)?B.some("document"):n(t,Mb)?B.some("audio"):n(t,Ab)?B.some("video"):n(t,_b)?B.some("archive"):B.none()},zb=function(e){switch(e){case"directory":return[];case"document":return Bb;case"audio":return Mb;case"video":return Ab;case"image":return Lb;case"archive":return _b}},Hb=function(e){switch(e){case"directory":return[];case"document":return ne(Fb);case"audio":return ne(Db);case"video":return ne(Cb);case"image":return ne(Tb);case"archive":return ne(Ib)}},Rb=function(e){var t=0<e.length?J(e,zb):Lb.concat(Bb,Mb,Ab,_b);return H(t,function(e){return"."+e})},Vb=function(e){return 0<e.length?J(e,Hb):ne(Tb).concat(ne(Fb),ne(Db),ne(Cb),ne(Ib))},Pb=function(e){var t,n,o;if(-1<e)for(o=["TB","GB","MB","KB","B"],t=0;t<o.length;t++)if((n=Math.pow(1024,4-t))<e)return Math.round(e/n)+" "+o[t];return""},jb=function(e,t,n,o){return xb<n?M.error('File too large: "'+t+'" maximum file size is: '+Pb(xb)):!1===(r=e,i=Nb(t),0<r.length?i.exists(function(e){return N(r,e)}):i.isSome())?M.error('Invalid file extension for file: "'+t+'"'):M.value(o);var r,i},Ub=function(t,e){return Sb(H(e,function(e){return jb(t,e.name,e.uploadSize,e)}))},Gb=function(e){return{name:e.name,downloadSize:0,uploadSize:e.size,getBlob:function(){return ua(e)},uuid:ri("w3cfile")}},Wb=function(e){return H(e,Gb)},qb=function(n,c,s){return function(i,t,u){var a=bu(t().path),e=H(te(n),function(r){return r.getBlob((n=r,o=i,function(e){var t=n.downloadSize+n.uploadSize;o(0===t?{type:va.UploadProgress,payload:{loaded:10,total:100,name:n.name,uuid:n.uuid}}:{type:va.UploadProgress,payload:{loaded:e,total:t,name:n.name,uuid:n.uuid}})})).mapError(yu).bindResult(function(e){return(t=c,n=r.name,o=e,jb(t,n,o.size,o)).mapError(vu);var t,n,o}).bindFuture(function(e){return wb(e,s)}).bindFuture(function(e){return u.upload({blob:e.blob,thumbBlob:e.thumbBlob,name:r.name,progress:(t=r,n=i,function(e){n({type:va.UploadProgress,payload:{loaded:t.downloadSize+e.loaded,total:t.downloadSize+e.total,name:e.name,uuid:t.uuid}})}),parent:a});var t,n});var n,o});ea(e).get(function(e){R(e,function(e){e.fold(Ou(i),b)}),zu(i,t,u)})}},Kb=function(e){try{var t=JSON.parse(e);return M.value(t)}catch(e){return M.error("Response was not JSON.")}};(db=lb||(lb={})).JSON="json",db.Blob="blob",db.Text="text",db.FormData="formdata",db.MultipartFormData="multipart/form-data";var Yb,Jb,Zb=function(t){return $u.nu(function(n){var e=new L.FileReader;e.onload=function(e){var t=e.target?e.target.result:new L.Blob([]);n(t)},e.readAsText(t)})},Xb=function(e){return $u.pure(e.response)},$b=function(e,t){switch(e){case lb.JSON:return Kb(t.response).fold(function(){return Xb(t)},$u.pure);case lb.Blob:return n=t,B.from(n.response).map(Zb).getOr($u.pure("no response content"));case lb.Text:default:return Xb(t)}var n},Qb=function(e){var t,n=(t=e.body,B.from(t).bind(function(e){switch(e.type){case lb.JSON:return B.some("application/json");case lb.FormData:return B.some("application/x-www-form-urlencoded; charset=UTF-8");case lb.MultipartFormData:return B.none();case lb.Text:default:return B.some("text/plain")}})),o=!0===e.credentials?B.some(!0):B.none(),r=function(e){switch(e){case lb.Blob:return"application/octet-stream";case lb.JSON:return"application/json, text/javascript";case lb.Text:return"text/plain";default:return""}}(e.responseType)+", */*; q=0.01",i=void 0!==e.headers?e.headers:{};return{contentType:n,responseType:function(e){switch(e){case lb.JSON:return B.none();case lb.Blob:return B.some("blob");case lb.Text:return B.some("text");default:return B.none()}}(e.responseType),credentials:o,accept:r,headers:i,progress:I(e.progress)?B.some(e.progress):B.none()}},ew=function(e){var n=new L.FormData;return re(e,function(e,t){n.append(t,e)}),n},tw=function(c){return ra(function(o){var r,i=new L.XMLHttpRequest;i.open(c.method,(r=c.url,B.from(c.query).map(function(e){var t=ae(e,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}),n=On(r,"?")?"&":"?";return 0<t.length?r+n+t.join("&"):r}).getOr(r)),!0);var n,e,t=Qb(c);n=i,(e=t).contentType.each(function(e){return n.setRequestHeader("Content-Type",e)}),n.setRequestHeader("Accept",e.accept),e.credentials.each(function(e){return n.withCredentials=e}),e.responseType.each(function(e){return n.responseType=e}),e.progress.each(function(t){return n.upload.addEventListener("progress",function(e){return t(e.loaded,e.total)})}),re(e.headers,function(e,t){return n.setRequestHeader(t,e)});var u,a=function(){var t,e,n;(t=c.url,e=c.responseType,n=i,$b(e,n).map(function(e){return{message:0===n.status?"Unknown HTTP error (possible cross-domain request)":"Could not load url "+t+": "+n.statusText,status:n.status,responseText:e}})).get(function(e){return o(M.error(e))})};i.onerror=a,i.onload=function(){var e;0!==i.status||(e=c.url,Sn(e,"file:",0))?i.status<100||400<=i.status?a():function(e,t){var n=function(){return ia(t.response)},o=function(e){return aa({message:e,status:t.status,responseText:t.responseText})};switch(e){case lb.JSON:return Kb(t.response).fold(o,ia);case lb.Blob:case lb.Text:return n();default:return o("unknown data type")}}(c.responseType,i).get(o):a()},(u=c.body,B.from(u).map(function(e){return e.type===lb.JSON?JSON.stringify(e.data):e.type===lb.FormData?ew(e.data):e.type===lb.MultipartFormData?ew(e.data):e})).fold(function(){return i.send()},function(e){i.send(e)})})},nw=function(){return e="",{type:lb.Text,data:e};var e},ow=function(e){return tw(qn({},e,{method:"get",body:nw()}))},rw=function(e,t){I(e.progress)&&e.progress(t)},iw=function(l){return ra(function(c){var s=function(e,t){c(M.error({message:e,status:t,responseText:""}))},f=function(e){s("Could not load url "+l.url,500)},t=function(e){var t,n=e.body,o=[],r=0,i=(t=e.headers,B.from(t.get("content-type")).map(function(e){return e.split(";")[0]}));if(rw(l,0),n){var u=n.getReader(),a=function(e){e.done?c(M.value(new L.Blob(o,{type:i.getOr("")}))):(o.push(e.value),r+=e.value.length,rw(l,r),u.read().then(a).catch(f))};u.read().then(a).catch(f)}else s("Failed to get response body",500)};L.fetch(l.url,{method:"get",headers:l.headers,credentials:l.credentials?"include":"omit"}).then(function(e){e.status<100||400<=e.status?s("Could not load url "+l.url,e.status):t(e)}).catch(f)})},uw=function(e){return se(Xe,"fetch").exists(I)?iw(e):(rw(t=e,0),ow({url:t.url,responseType:lb.Blob,headers:t.headers}).mapResult(function(e){return rw(t,e.size),e}));var t},aw=Fr(B.none()),cw=Fr(B.none()),sw=["https://www.googleapis.com/auth/drive.readonly"],fw=function(t){return ra(function(e){gapi.load("picker",function(){e(M.value(t))})})},lw=function(t,r){return(e=aw.get().getOrThunk(function(){var e=fa("https://apis.google.com/js/api.js",{}).mapError(function(e){return"failed_api_load"}).toLazy();return aw.set(B.some(e)),e}),ra(function(t){e.get(function(e){return t(e)})})).bindFuture(function(e){return n=t,o=r,ra(function(t){gapi.load("auth2",function(){cw.get().fold(function(){gapi.auth2.authorize({client_id:n,scope:o.join(" ")},function(e){e.error?t(M.error(e.error)):(cw.set(B.some(e.access_token)),t(M.value(e.access_token)))})},function(e){t(M.value(e))})})});var n,o}).bindFuture(fw);var e},dw=function(e){return B.from($e(["exportLinks","application/pdf"],e))},mw=function(e){return se(e,"size").getOr(0)},pw=function(t,n){var e,o=dw(n).orThunk(function(){return e=n,B.from("https://www.googleapis.com/drive/v3/files/"+e.id+"?alt=media");var e});return{name:(e=n,dw(e).fold(U(e.name),U(e.name+".pdf"))),downloadSize:mw(n),uploadSize:mw(n),getBlob:function(e){return e(0),uw({url:o.getOr(""),progress:e,headers:{Authorization:"Bearer "+t}})},uuid:ri("googledrive")}},gw=function(t){R(Vn(".picker"),function(e){return Vi(e,"z-index",String(t+1))})},hw=function(r,i,e,u,a){return(new google.picker.PickerBuilder).addView(google.picker.ViewId.DOCS).enableFeature(google.picker.Feature.NAV_HIDDEN).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setTitle("Pick a file to import to Tiny Drive").setOAuthToken(i).setDeveloperKey(e).setCallback(function(e){var t,n,o;"loaded"===e.action&&gw(r),e.action===google.picker.Action.PICKED&&(t=e.docs,n=function(e){return t=i,n=e.id,ow({url:"https://www.googleapis.com/drive/v3/files/"+n+"?fields=id,name,size,exportLinks,mimeType",responseType:lb.JSON,headers:{Authorization:"Bearer "+t}}).mapError(function(e){return e.message}).mapResult(function(e){return pw(t,e)});var t,n},o=H(t,n),ea(o)).get(function(e){Sb(e).fold(a,u)})})},vw=function(u){lw(u.clientId,sw).get(function(e){var t,n,o,r,i;e.fold(function(e){"popup_closed_by_user"===e?u.success([]):"failed_api_load"===e?u.failure(["Failed to load google drive api."]):u.failure(["Failed to authenticate against google drive."])},(t=u.zIndex,n=u.fileTypes,o=u.developerKey,r=function(e){return Ub(u.fileTypes,e).fold(u.failure,u.success)},i=u.failure,function(e){0===n.length||N(n,"document")?hw(t,e,o,r,i).build().setVisible(!0):hw(t,e,o,r,i).setSelectableMimeTypes(Vb(n).join(",")).build().setVisible(!0),gw(t)}))})},yw=Fr(B.none()),bw=function(t){return{name:t.name,downloadSize:t.bytes,uploadSize:t.bytes,getBlob:function(e){return uw({url:t.link,progress:e})},uuid:ri("googledrive")}},ww=function(t,e,n,o){var r;(r=e,yw.set(yw.get().fold(function(){return B.some(fa("https://www.dropbox.com/static/api/2/dropins.js",{id:"dropboxjs","data-app-key":r}).toLazy())},B.some)),yw.get()).each(function(e){e.get(function(e){e.fold(function(e){return o([e])},function(e){se(Xe,"Dropbox").fold(function(){return o(["Failed to get dropbox chooser"])},function(e){e.choose({success:function(e){Ub(t,H(e,bw)).fold(o,n)},cancel:function(){},linkType:"direct",extensions:Rb(t),multiselect:!0,folderselect:!1,sizeLimit:xb})})})})})},xw=Fr(B.none()),Sw=function(e,t,n){return{type:"item",data:{meta:{text:t},value:n},dom:{tag:"div"},components:[Vd.sketch({iconHtml:e,classes:[id.MenuIcon]}),$h.sketch({text:t,classes:[id.MenuLabel]})]}},Ow=function(t,n,o){return function(e){Yu(t,qb(e,n,o)),rd.focus(t)}},kw=function(n){return function(e){R(e,function(e){var t;Yu(n,(t=e,function(e){return e(Su(t))}))}),rd.focus(n)}},Tw=function(e,t,n,o){!function(e,t,n,o){xw.get().each(Ur);var r=Bn.fromHtml('<input type="file" multiple>');xw.set(B.some(r)),qr(r,"accept",Rb(e).join(",")),Pi(r,{opacity:"0",position:"fixed",top:"0",left:"0"}),su(r,"change",function(){Ub(e,Wb(r.dom().files)).fold(o,n)}),Vr(t,r),r.dom().click()}(n,e,Ow(t,n,o),kw(t))},Fw=Ac({name:"InsertDropdown",factory:function(e){var u=e.lazySink,a=e.maxImageDimension,c=e.fileTypes,s=e.googleDriveClientId,f=e.googleDriveDeveloperKey,l=e.dropboxAppKey,d=e.zIndex,o=ri("menu");return Yh.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonIcon],attributes:{title:"Upload/Create"}},components:[Vd.sketch({iconHtml:ud,classes:[]})],toggleClass:id.ButtonSelected,parts:{menu:ev},lazySink:u,dropdownBehaviours:br([Ql.config({})]),matchWidth:!0,fetch:function(){return $u.pure(B.some(jm.singleData("basic-list",{uid:o,dom:{tag:"div",classes:[id.Menu,id.MenuHasIcons]},components:[zm.parts().items({})],items:[Sw(Rd,"Upload file","upload")].concat((n=l,n.fold(function(){return[]},function(e){return[Sw(Sd,"Dropbox","dropbox")]})),(e=s,t=f,Ta(e,t,m).fold(function(){return[]},function(e){return[Sw(Td,"Google Drive","googledrive")]})),[Sw(ad,"Create folder","createFolder")])})));var e,t,n},onExecute:function(e,t){var n=em.getValue(t);_o(e,o+"execute-event",{item:n})},onOpen:nv(o),sandboxBehaviours:br([Tr("dropdown-sandbox-events",[or(o+"execute-event",function(e,t){var r=t.event().item(),i=em.getValue(e);u(e).each(function(e){var t,n,o;"upload"===r.value?Tw(e.element(),i,c,a):"dropbox"===r.value?ww((o={hotspot:i,maxImageDimension:a,dropboxAppKey:l,fileTypes:c}).fileTypes,o.dropboxAppKey.getOr(""),Ow(o.hotspot,o.fileTypes,o.maxImageDimension),kw(o.hotspot)):"googledrive"===r.value?vw({zIndex:(n={hotspot:i,maxImageDimension:a,googleDriveClientId:s,googleDriveDeveloperKey:f,fileTypes:c,zIndex:d}).zIndex,fileTypes:n.fileTypes,clientId:n.googleDriveClientId.getOr(""),developerKey:n.googleDriveDeveloperKey.getOr(""),success:Ow(n.hotspot,n.fileTypes,n.maxImageDimension),failure:kw(n.hotspot)}):"createFolder"===r.value&&(t=u,dy({title:"Create folder",lazySink:t,buttons:{submit:{text:"Submit",primary:!0},cancel:{text:"Cancel"}}},"Folder name",sy([uy("Folder name cannot be empty."),cy("Incorrect folder name.")])).map(my)).get(function(e){e.each(function(e){var r;Yu(i,(r=e,function(t,n,o){bu(n().path).fold(function(){o.mkdir(r).get(function(e){return e.fold(Ou(t),function(e){return zu(t,n,o)})})},function(e){o.mkdir(r,e).get(function(e){return e.fold(Ou(t),function(e){return zu(t,n,o)})})})}))}),rd.focus(i)})}),Ao(e,Fo())})])])})},configFields:[At("lazySink"),At("maxImageDimension"),At("dropboxAppKey"),At("googleDriveDeveloperKey"),At("googleDriveClientId"),At("fileTypes"),At("zIndex")]}),Dw=En.detect().browser,Cw=function(e,t){var n,o,r,i=L.URL.createObjectURL(e);n=i,o=t,r=Bn.fromHtml("<a>"),qr(r,"href",n),qr(r,"download",o),Vr(Zo(),r),r.dom().click(),Ur(r),L.URL.revokeObjectURL(i)},Iw=function(e,t){return Dw.isIE()||Dw.isEdge()?(n=e,o=t,void L.navigator.msSaveBlob(n,o)):Cw(e,t);var n,o},Ew=function(e,t){var n;(n=e,ra(function(e){var t=new L.XMLHttpRequest;t.open("GET",n,!0),t.responseType="blob",t.onload=function(){200===this.status&&e(M.value(this.response))},t.onerror=function(){e(M.error("Error loading url"))},t.send()})).get(function(e){e.each(function(e){return Iw(e,t)})})},Lw=function(o,r){return function(e,t,n){o.each(function(e){return Ew(e,r)}),e({type:Pu.DownloadFiles,payload:{}})}},Bw=function(e){return{type:Uu.InsertFiles,payload:{files:e}}},Mw=function(e,t,n){return{type:"item",data:{meta:{text:t},value:n},dom:{tag:"div"},components:[Vd.sketch({iconHtml:e,classes:[id.MenuIcon]}),$h.sketch({text:t,classes:[id.MenuLabel]})]}};(Jb=Yb||(Yb={})).Rename="rename",Jb.Download="download",Jb.Delete="delete",Jb.Star="star",Jb.Unstar="unstar";var Aw,_w,Nw,zw,Hw,Rw,Vw=Ac({name:"PreviewDropdown",factory:function(i){var o=ri("menu");return Yh.sketch({uid:i.uid,dom:{tag:"button",classes:[id.Button,id.ButtonSecondary,id.ButtonIcon],attributes:{title:"Actions"}},components:[Vd.sketch({iconHtml:Id})],toggleClass:id.ButtonSelected,parts:{menu:ev},lazySink:i.lazySink,matchWidth:!0,dropdownBehaviours:br([Ql.config({}),em.config({store:{mode:"memory",initialValue:i.file.starred}})]),fetch:function(e){var t=em.getValue(e);return $u.pure(B.some(jm.singleData("basic-list",{uid:o,dom:{tag:"div",classes:[id.Menu,id.MenuHasIcons]},components:[zm.parts().items({})],items:Y([[Mw(Bd,"Rename",Yb.Rename)],t?[Mw(zd,"Unstar",Yb.Unstar)]:[Mw(Nd,"Star",Yb.Star)],[Mw(wd,"Download",Yb.Download)],[Mw(bd,"Delete",Yb.Delete)]])})))},onExecute:function(e,t){var n=em.getValue(t);_o(e,o+"execute-event",{item:n})},onOpen:nv(o),sandboxBehaviours:br([Tr("dropdown-sandbox-events",[or(o+"execute-event",function(e,t){var n=t.event().item(),o=em.getValue(e);if(n.value===Yb.Rename){var r=kb(i.file.name);py(i.lazySink,Ob(i.file.name,r)).get(function(e){e.each(function(e){Yu(o,ky(i.file.uuid,e+r))}),rd.focus(o)})}else n.value===Yb.Download?(Yu(o,Lw(i.file.url,i.file.name)),rd.focus(o)):n.value===Yb.Delete?hy(i.lazySink).get(function(e){e?Yu(o,Dy(i.file.uuid)):rd.focus(o)}):n.value===Yb.Star?(Yu(o,Sy([i.file.uuid])),rd.focus(o)):n.value===Yb.Unstar&&(Yu(o,Oy([i.file.uuid])),rd.focus(o));Ao(e,Fo())})])])})},configFields:[At("uid"),At("lazySink"),At("file")],apis:{setStarred:function(e,t,n){em.setValue(t,n)}}}),Pw=function(){return ym.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonIcon,id.ButtonNaked],attributes:{title:"Close"}},buttonBehaviours:br([Ql.config({})]),components:[Vd.sketch({iconHtml:vd,classes:[]})],action:function(e){Yu(e,function(e,t,n){e({type:Pu.Exit,payload:{}})})}})},jw=function(){return ym.sketch({dom:{tag:"button",classes:[id.Button]},components:[Jh("Insert")],action:function(e){return Yu(e,function(e,t,n){e(Bw(t().preview.map(function(e){return[e.file]}).getOr([])))})},buttonBehaviours:br([Ql.config({})])})},Uw=function(e,t,n){return ym.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonNaked,id.ButtonIcon,id.NavbarToolbarButton,id.FocusStop],attributes:{title:e}},components:[Vd.sketch({iconHtml:t})],action:n})},Gw=function(t){return function(e){return Yu(e,t)}},Ww=function(e,t){return{dom:{tag:"div",classes:[id.NavbarActions]},components:[e.asSpec(),Fw.sketch({maxImageDimension:t.maxImageDimension,dropboxAppKey:t.dropboxAppKey,googleDriveClientId:t.googleDriveClientId,googleDriveDeveloperKey:t.googleDriveDeveloperKey,lazySink:t.lazySink,fileTypes:t.fileTypes,zIndex:t.zIndex})].concat(t.close?[Pw()]:[]),behaviours:br([rd.config({})])}},qw=function(e,t){return[e,{dom:{tag:"div",classes:[id.NavbarToolbar]},components:t,behaviours:br([_l.config({mode:"flow",allowVertical:!1,selector:"."+id.FocusStop}),Ql.config({})])},{dom:{tag:"div",classes:[id.NavbarActions]},components:[ym.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonSecondary]},buttonBehaviours:br([Ql.config({})]),components:[Jh("Unselect all")],action:Gw(function(e){e({type:"selectedFiles.clear",payload:""})})})]}]},Kw=function(e,t){return qw(t,[Uw("Star",Nd,Gw(function(e,t,n){var o=H(t().selectedFiles,function(e){return e.uuid});Sy(o)(e,t,n)})),Uw("Move",Ed,Gw(by("move"))),Uw("Download",wd,Gw(function(e,t,n){R(t().selectedFiles,function(t){return t.url.each(function(e){return Ew(e,t.name)})}),e({type:Pu.DownloadFiles,payload:{}})})),Uw("Delete",bd,function(t){vy(e.lazySink).get(function(e){e&&Yu(t,Cy())})})])},Yw=function(e){return[e,{dom:{tag:"div",classes:[id.NavbarActions]},components:[ym.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonPrimary]},components:[Jh("Place Here")],action:Gw(Fy()),buttonBehaviours:br([Ql.config({})])}),ym.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonSecondary]},components:[Jh("Cancel")],action:Gw(Ty()),buttonBehaviours:br([Ql.config({})])})],behaviours:br([rd.config({})])}]},Jw=function(e,t,n,o){return[{dom:{tag:"div",classes:[id.NavbarNav]},components:[ym.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonNaked,id.ButtonIcon,id.NavbarNavBack]},components:[Vd.sketch({iconHtml:md})],action:function(e){Yu(e,function(e,t,n){e({type:wu.Close,payload:{}})})},buttonBehaviours:br([Ql.config({})])}),t.asSpec()]},{dom:{tag:"div",classes:[id.NavbarActions]},components:(e.insert?[jw()]:[]).concat([Vw.sketch({uid:n,lazySink:e.lazySink,file:o.file})])}]},Zw=vv(((Aw={}).main=id.NavbarMainMode,Aw.copy=id.NavbarCopyMode,Aw.move=id.NavbarMoveMode,Aw.select=id.NavbarSelectMode,Aw.selectMixed=id.NavbarSelectMode,Aw.search=id.NavbarMainMode,Aw.preview=id.NavbarMainMode,Aw.none=id.NavbarMainMode,Aw)),Xw=function(e){var t=e.selectedFiles.length,n=0!==t&&z(e.selectedFiles,function(e){return"directory"===e.type});return e.preview.isSome()?"preview":0<t&&e.clipboard.isNone()?n?"selectMixed":"select":e.clipboard.isSome()?e.clipboard.fold(function(){return"main"},function(e){return"copy"===e.operation?"copy":"move"}):e.query.isSome()?"search":"main"},$w=function(e){return j(e.components(),function(e){return Ai(e.element(),id.NavbarActions)}).each(function(e){Q(e.components()).each(function(e){return Wc(e.element())})})},Qw=Ac({name:"NavBar",factory:function(l){var e,d=ri("preview"),m=cs(hv.sketch({separator:Vd.sketch({iconHtml:hd,classes:[id.BreadcrumbSeparator]}),lazySink:l.lazySink})),n=cs($h.sketch({text:""})),p=cs($h.sketch({text:"",classes:[id.NavbarNavFilename]})),g=cs(hm.sketch({})),h={dom:{tag:"div",classes:[id.Breadcrumb]},components:[n.asSpec()]},c=function(t,e,n,o){if("select"===e)as.set(t,Kw(l,h));else if("selectMixed"===e)as.set(t,(f=l,qw(h,[Uw("Move",Ed,Gw(by("move"))),Uw("Delete",bd,function(t){vy(f.lazySink).get(function(e){e&&Yu(t,Cy())})})])));else if("main"===e){var r=(c=l,s=g,[m.asSpec(),Ww(s,c)]);"search"===n?as.replaceAt(t,0,Q(r)):as.set(t,r)}else if("search"===e){var i=(u=g,a=l,[{dom:{tag:"div",classes:[id.NavbarContainer]},components:[{dom:{tag:"div",classes:[id.Location,id.LocationSearchResult]},components:[Vd.sketch({iconHtml:Ad,classes:[id.LocationIcon]}),{dom:{tag:"span",classes:[id.LocationLabel],innerHtml:"Search results"}}]}]},Ww(u,a)]);"main"===n?as.replaceAt(t,0,Q(i)):as.set(t,i)}else"move"===e?as.set(t,Yw(h)):"copy"===e?as.set(t,Yw(h)):"preview"===e&&o.each(function(e){return as.set(t,Jw(l,p,d,e))});var u,a,c,s,f};return{uid:l.uid,dom:{tag:"div",classes:[id.Navbar]},behaviours:pe(br([Ql.config({}),as.config({}),Gc.config({channels:(e={},e["channel.main"]=Ku(function(t,n){var e=n.state,o=Xw(n.state),r=Xw(n.oldState);Qw.setMode(t,o,r,e.preview),e.preview.each(function(e){Qw.setFileName(t,e.file.name,e.file.starred)}),"select"===o||"selectMixed"===o?Qw.setText(t,e.selectedFiles.length+" Selected"):"copy"!==o&&"move"!==o||e.clipboard.each(function(e){Qw.setText(t,function(e){var t=e.files.length,n=e.files[0].name;if("move"===e.operation)return 1===t?'Move "'+n+'"':"Move "+t+" Items";var o=e.files[0].name;return 1===t?'Copy "'+o+'"':"Copy "+t+" Items"}(e))}),m.getOpt(t).each(function(e){hv.setItems(e,n.state.path,n.state.viewType)}),g.getOpt(t).each(function(t){e.query.each(function(e){return hm.setValue(t,e)})})}),e)})]),zc(l.navBarBehaviours)),components:[],apis:{setBreadcrumbs:function(e,t,n){m.getOpt(e).each(function(e){hv.setItems(e,t,n)})},setMode:function(r,i,u,a){u!==i&&(Zw(r.element(),i),Kc(r.element()).fold(function(){c(r,i,u,a),"preview"===i&&$w(r)},function(o){m.getOpt(r).fold(function(){var t,e,n;c(r,i,u,a),t=r,n=o,"select"===(e=i)||"selectMixed"===e||("main"===e?g.getOpt(t).each(function(e){jn(e.element(),n)?hm.focus(e):m.getOpt(t).each(function(e){rd.focus(e)})}):"search"===e?g.getOpt(t).each(hm.focus):"move"===e||"copy"===e?$w(t):"preview"===e&&$w(t))},function(e){c(r,i,u,a),jn(e.element(),o)&&rd.focus(e)})}))},setText:function(e,t){n.getOpt(e).each(function(e){$h.setText(e,t)})},setFileName:function(e,t,n){p.getOpt(e).each(function(e){$h.setText(e,t,n)}),e.getSystem().getByUid(d).each(function(e){Vw.setStarred(e,n)})}}}},configFields:[Nc("navBarBehaviours",[]),At("lazySink"),At("dropboxAppKey"),At("maxImageDimension"),At("googleDriveDeveloperKey"),At("googleDriveClientId"),At("fileTypes"),Nt("zIndex"),Ht("insert"),Ht("close")],apis:{setBreadcrumbs:function(e,t,n,o){e.setBreadcrumbs(t,n,o)},setMode:function(e,t,n,o,r){e.setMode(t,n,o,r)},setText:function(e,t,n){e.setText(t,n)},setFileName:function(e,t,n,o){e.setFileName(t,n,o)}}}),ex=Ac({name:"Notifications",factory:function(e){return{dom:{tag:"div",classes:[id.Notifications]},components:[],behaviours:pe(br([as.config({})]),zc(e.notificationBehaviours)),apis:{setNotifications:function(e,t){var n=H(t,function(e){return n=e.data,e.status,t=e.text,{dom:{tag:"div",classes:[id.Status,id.StatusError]},components:[{dom:{tag:"p"},components:[Jh(t)]},ym.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonNaked,id.ButtonIcon,id.StatusDismiss]},components:[Vd.sketch({iconHtml:vd})],action:function(e){var t;Yu(e,(t={type:pu.Remove,payload:{uid:n.uid}},function(e){return e(t)}))}})],behaviours:br([as.config({})]),apis:{setNotifications:function(e,t){as.set(e,[])}}};var n,t});as.set(e,n)}}}},configFields:[Nc("notificationBehaviours",[])],apis:{setNotifications:function(e,t,n){e.setNotifications(t,n)}}}),tx=Object.freeze({events:function(r,i){return nr([ar(function(e){return n=e,t=i,o=H(r.events,function(t){return su(n.element(),t.native,function(e){n.getSystem().triggerEvent(t.simulated,n.element(),e)})}),void t.set(o);var n,t,o}),cr(function(){R(i.get(),function(e){e.unbind()})})])}}),nx=[(_w="events",Nw=lt([zt("native"),zt("simulated")]),ht(_w,_w,be(),dt(Nw)))],ox=xr({fields:nx,name:"allowbubbling",active:tx,state:ys([])}),rx=Ac({name:"Checkbox",factory:function(n){return ry.sketch({dom:{tag:"label",classes:[id.Checkbox].concat(n.classes)},components:[ry.parts().field({factory:{sketch:om.sketch},inputAttributes:{type:"checkbox"},inputClasses:[id.Checkbox__Input]}),ry.parts().label(ym.sketch({dom:{tag:"div",classes:[id.CheckboxIcons,id.FocusStop]},components:[Vd.sketch({iconHtml:n.checkedIcon,classes:[id.CheckboxIconChecked]}),Vd.sketch({iconHtml:n.uncheckedIcon,classes:[id.CheckboxIconUnchecked]})]}))],fieldBehaviours:br([rd.config({ignore:!0}),Tr("field-behaviours",[or(ao(),function(e,t){t.stop()}),fr(function(t,e){ry.getField(t).each(function(e){Jr(e.element(),"checked")?Zr(e.element(),"checked"):qr(e.element(),"checked","checked"),n.onCheckedChange(t)})})])])})},configFields:[qt("classes",[]),zt("checkedIcon"),zt("uncheckedIcon"),Rt("onCheckedChange")]}),ix=function(e,t,n){return{type:"item",data:{meta:{text:t},value:n},dom:{tag:"div"},components:[Vd.sketch({iconHtml:e,classes:[id.MenuIcon]}),$h.sketch({text:t,classes:[id.MenuLabel]})]}},ux=Ac({name:"ListTypeDropdown",factory:function(e){var o=ri("menu");return Yh.sketch({dom:{tag:"button",classes:[id.AssetsHeaderTh,id.AssetsHeaderButton,id.FocusStop]},components:[{dom:{tag:"span"},components:[Jh("list"===e.listType?"List":"Grid")]},Vd.sketch({iconHtml:gd,classes:[id.AssetsHeaderButtonChevron]})],toggleClass:id.ButtonSelected,parts:{menu:ev},lazySink:e.lazySink,matchWidth:!0,fetch:function(){return $u.pure(B.some(jm.singleData("basic-list",{uid:o,dom:{tag:"div",classes:[id.Menu,id.MenuHasIcons]},components:[zm.parts().items({})],items:[ix(Dd,"List","list"),ix(Fd,"Grid","grid")]})))},onExecute:function(e,t){var n=em.getValue(t);_o(e,o+"execute-event",{item:n})},onOpen:nv(o),sandboxBehaviours:br([Tr("dropdown-sandbox-events",[or(o+"execute-event",function(e,t){var n=t.event().item(),o=em.getValue(e);rd.focus(o),Yu(e,qu("grid"===n.value?"grid":"list")),Ao(e,Fo())})])])})},configFields:[At("listType"),At("lazySink")]}),ax=function(e,t){return void 0===t&&(t=[]),{dom:{tag:"div",classes:[id.AssetsHeaderTh].concat(t)},components:[e]}},cx=function(e,t){return ym.sketch({dom:{tag:"button",classes:[id.AssetsHeaderButton,id.FocusStop]},components:[{dom:{tag:"span"},components:[Jh(e)]},{dom:{tag:"span"}}],action:(n=Wu(t),function(e){Yu(e,n)}),buttonBehaviours:br([as.config({})])});var n},sx=function(t,n){return function(e){as.replaceAt(e,1,B.from(n?t:{dom:{tag:"span"}}))}},fx=Ac({name:"FileListHeader",factory:function(e){var t,n=e.lazySink,l=cs(rx.sketch({classes:[id.AssetActionSelect],onCheckedChange:function(e){Yu(e,function(e,t,n){t().fileState.files.length===t().selectedFiles.length?e({type:"selectedFiles.clear",payload:""}):sv()(e,t,n)})},checkedIcon:_d,uncheckedIcon:Hd})),d=cs(cx("Name","name")),m=cs(cx("Size","size")),p=cs(ym.sketch({dom:{tag:"button",classes:[id.AssetsHeaderButton]},components:[Jh("Location")]})),g=cs(cx("Last modified","date")),h=cs(ux.sketch({lazySink:n,listType:"list"}));return{uid:e.uid,dom:{tag:"header",classes:[id.AssetsHeader]},components:[ax(l.asSpec()),ax(d.asSpec(),[id.AssetsHeaderThName]),ax(m.asSpec()),ax(g.asSpec()),ax(h.asSpec())],behaviours:br([_l.config({mode:"flow",allowVertical:!1,selector:"."+id.FocusStop}),Ql.config({}),as.config({}),Gc.config({channels:(t={},t["channel.main"]=Ku(function(t,e){var n,o=0!==e.state.selectedFiles.length&&e.state.selectedFiles.length===e.state.fileState.files.length,r=e.state,i=r.sortOrder,u=r.sortBy,a=r.listType,c=r.viewType,s=(n=i,Vd.sketch({iconHtml:cd,classes:"desc"===n?[id.AssetsHeaderButtonArrowDesc]:[]}));"starred"===c||e.state.query.isSome()?as.replaceAt(t,2,B.some(ax(p.asSpec()))):as.replaceAt(t,2,B.some(ax(m.asSpec())));var f=function(){return as.set(t,"grid"===e.state.listType?[ax(d.asSpec(),[id.AssetsHeaderThName]),ax(h.asSpec())]:[ax(l.asSpec()),ax(d.asSpec(),[id.AssetsHeaderThName]),ax(m.asSpec()),ax(g.asSpec()),ax(h.asSpec())])};e.state.listType!==e.oldState.listType&&Kc(t.element()).fold(f,function(e){f(),h.getOpt(t).each(rd.focus)}),d.getOpt(t).each(sx(s,v(u,"name"))),m.getOpt(t).each(sx(s,v(u,"size"))),g.getOpt(t).each(sx(s,v(u,"date"))),h.getOpt(t).each(function(e){Gr(e.components()[0].element(),"list"===a?"List":"Grid")}),l.getOpt(t).each(function(e){ry.getField(e).each(function(e){e.element().dom().checked=o})})}),t)})])}},configFields:[At("lazySink")]}),lx=function(){return{type:"separator",dom:{tag:"div",classes:[id.MenuSeparator]},data:{},components:[]}},dx=function(e,t,n,o){return{type:"item",data:{value:o},dom:{tag:"div"},components:[Vd.sketch({iconHtml:e,classes:[id.MenuIcon]}),$h.sketch({text:t,classes:[id.MenuLabel]})]}},mx=Ac({name:"FileActions",factory:function(d){var o=ri("menu");return Yh.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonNaked,id.ButtonIcon,id.AssetActionMore,id.FocusStop]},components:[Vd.sketch({iconHtml:Id})],toggleClass:id.ButtonSelected,parts:{menu:ev},lazySink:d.lazySink,matchWidth:!0,fetch:function(){var e=Y([d.insert?[dx(pd,"Insert",0,"insert")]:[],"grid"===d.listType||tv()?[dx(Ld,"Preview",0,"preview")]:[]]),t=[0<e.length?e.concat([lx()]):[],d.file.starred?[dx(zd,"Unstar",0,"unstar")]:[dx(Nd,"Star",0,"star")],[dx(wd,"Download",0,"download")],[dx(Bd,"Rename",0,"rename")],[dx(yd,"Copy",0,"copy")],[dx(Ed,"Move",0,"move")],[lx()],[dx(bd,"Delete",0,"delete")]],n=[[dx(Bd,"Rename",0,"rename")],[dx(Ed,"Move",0,"move")],[lx()],[dx(bd,"Delete",0,"delete")]];return $u.pure(B.some(jm.singleData("basic-list",{uid:o,dom:{tag:"div",classes:[id.Menu,id.MenuHasIcons]},components:[zm.parts().items({})],items:Y("directory"===d.file.type?n:t)})))},onExecute:function(e,t){var n=em.getValue(t);_o(e,o+"execute-event",{item:n})},onOpen:nv(o),sandboxBehaviours:br([Tr("dropdown-sandbox-events",[or(o+"execute-event",function(e,t){var n,o,r,i,u,a,c,s=t.event().item(),f=em.getValue(e),l=function(e,t){Yu(e,t),rd.focus(f)};"insert"===s.value?l(e,(c=d.file.uuid,function(t,e,n){j(e().fileState.files,function(e){return e.uuid===c}).each(function(e){t(Bw([e]))})})):"delete"===s.value?hy(d.lazySink).get(function(e){e&&Yu(f,Dy(d.file.uuid)),rd.focus(f)}):"star"===s.value?l(e,Sy([d.file.uuid])):"unstar"===s.value?l(e,Oy([d.file.uuid])):"rename"===s.value?(n=d.lazySink,o=f,r=d.file,i=kb(r.name),u="directory"===r.type?r.name:Ob(r.name,i),a="directory"===r.type?"":i,py(n,u).get(function(e){e.each(function(e){Yu(o,ky(r.uuid,e+a))}),rd.focus(o)})):"copy"===s.value?l(e,yy(d.file.uuid,"copy")):"move"===s.value?l(e,yy(d.file.uuid,"move")):"download"===s.value?l(e,Lw(d.file.url,d.file.name)):"preview"===s.value&&l(e,Fu(d.file.uuid)),Ao(e,Fo())})])])})},configFields:[Rt("lazySink"),At("file"),At("listType"),Ht("insert")]}),px=function(e,t){var n=String(e);if(n.length<t)for(var o=0;o<t-n.length;o++)n="0"+n;return n},gx=function(e){return t="%Y-%m-%d %H:%M:%S",n=e,o="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),r="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),i="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),u="January February March April May June July August September October November December".split(" "),t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+n.getFullYear())).replace("%m",px(n.getMonth()+1,2))).replace("%d",px(n.getDate(),2))).replace("%H",""+px(n.getHours(),2))).replace("%M",""+px(n.getMinutes(),2))).replace("%S",""+px(n.getSeconds(),2))).replace("%I",""+((n.getHours()+11)%12+1))).replace("%p",n.getHours()<12?"AM":"PM")).replace("%B",""+u[n.getMonth()])).replace("%b",""+i[n.getMonth()])).replace("%A",""+r[n.getDay()])).replace("%a",""+o[n.getDay()])).replace("%%","%");var t,n,o,r,i,u},hx=function(e,t){var r,i;Yu(e,(r=t.file.uuid,i=t.file.name,function(t,e,n){var o=Eu(n,e().viewType,Lu(e(),{parentUuid:B.from(r)}));t({type:"selectedFiles.clear",payload:""}),Nu(t,e(),o,function(e){t({type:da.PushPathItem,payload:{pathItem:{name:i,uuid:B.from(r)}}}),t(Bu(e))})}))},vx=function(e,t){var r;t.insert&&Yu(e,(r=[t.file.uuid],function(e,t,n){var o=V(t().fileState.files,function(e){return N(r,e.uuid)});e(Bw(o))}))},yx=function(t){return function(e){return"directory"===t.file.type?hx(e,t):vx(e,t)}},bx=function(e){return{dom:{tag:"img",attributes:{src:e}}}},wx=function(e){return Pc.sketch({dom:{tag:"div",classes:[id.AssetThumbnailContainer]},components:[bx(e)]})},xx=function(e){return e.file.thumbUrl.fold(function(){return ym.sketch({dom:{tag:"div",classes:[id.AssetIconContainer]},components:[Pd.sketch({type:e.file.type})],action:yx(e)})},(t=yx(e),function(e){return ym.sketch({dom:{tag:"div",classes:[id.AssetThumbnailContainer]},components:[bx(e)],action:t})}));var t},Sx=function(e){return e.insert||"directory"===e.file.type},Ox=function(e){return Sx(e)?xx(e):(t=e).file.thumbUrl.fold(function(){return Pc.sketch({dom:{tag:"div",classes:[id.AssetIconContainer]},components:[Pd.sketch({type:t.file.type})]})},wx);var t},kx=function(e){return Sx(e)?(n=e,$h.sketch({text:n.file.name,starred:n.file.starred,classes:[id.AssetName,id.FocusStop],action:yx(n)})):(t=e,$h.sketch({text:t.file.name,starred:t.file.starred,classes:[id.AssetName,id.FocusStop]}));var t,n},Tx=Ac({name:"FileListItem",factory:function(t){var n,e,o,r,i,u,a,c=cs(mx.sketch({lazySink:t.lazySink,file:t.file,listType:t.listType,insert:t.insert})),s=cs(rx.sketch({classes:[id.AssetActionSelect],onCheckedChange:function(e){var o;Yu(e,(o=t.file.uuid,function(e,t,n){j(t().selectedFiles,function(e){return e.uuid===o}).fold(function(){return av(o)(e,t,n)},function(){return cv(o)(e,t,n)})}))},checkedIcon:_d,uncheckedIcon:Hd}));return{uid:t.uid,dom:{tag:"li",classes:[id.Asset].concat("directory"===t.file.type?[id.AssetFolder]:[]).concat("directory"!==t.file.type&&t.file.thumbUrl.isNone?[id.AssetFile]:[])},components:"grid"===t.listType?(i=t,u=s,a=c,[Ox(i),{dom:{tag:"div",classes:[id.AssetMetadata]},components:[u.asSpec(),kx(i),a.asSpec()]}]):(n=t,e=t.isSearching,o=s,r=c,[o.asSpec(),Ox(n),{dom:{tag:"div",classes:[id.AssetMetadata]},components:[kx(n),{dom:{tag:"span",classes:[id.AssetSize]},components:[Jh("starred"===n.viewType||e?n.file.path.getOr(""):Pb(n.file.size))]},{dom:{tag:"span",classes:[id.AssetDate]},components:[Zh(gx(n.file.modificationDate))]}]},{dom:{tag:"div",classes:[id.AssetActions]},components:Y(["directory"!==n.file.type?[ym.sketch({dom:{tag:"button",classes:[id.Button,id.ButtonSecondary,id.AssetActionPrimary,id.FocusStop]},components:[Jh("Preview")],action:function(e){return Yu(e,Fu(n.file.uuid))}})]:[],[r.asSpec()]])}]),behaviours:br([_l.config({mode:"flow",allowVertical:!1,selector:"."+id.FocusStop}),em.config({store:{mode:"memory",initialValue:t.file.uuid}}),rd.config({ignore:!0,onFocus:function(e){s.getOpt(e).each(rd.focus)}})]),apis:{selectFileListItem:function(e){s.getOpt(e).each(function(e){e.components()[0].element().dom().checked=!0}),Li(e.element(),id.AssetSelected)},deselectFileListItem:function(e){s.getOpt(e).each(function(e){e.components()[0].element().dom().checked=!1}),Mi(e.element(),id.AssetSelected)},focus:function(e){s.getOpt(e).each(function(e){ry.getLabel(e).each(rd.focus)})}}}},configFields:[zt("listType"),zt("viewType"),Ht("isSearching"),Ht("insert"),Pt("file",[zt("type"),zt("uuid"),zt("name"),Nt("size"),At("modificationDate"),At("starred"),At("url"),At("thumbUrl"),At("path")]),Rt("lazySink")],apis:{selectFileListItem:function(e,t){e.selectFileListItem(t)},deselectFileListItem:function(e,t){e.deselectFileListItem(t)},focus:function(e,t){e.focus(t)}}}),Fx=ri("backitem"),Dx=function(){return ym.sketch({dom:{tag:"li"},components:[{dom:{tag:"div",classes:[id.Asset,id.AssetBack]},components:[{dom:{tag:"div",classes:[id.AssetIconContainer]},components:[{dom:{tag:"span",classes:[id.AssetIcon],innerHtml:dd}}]},{dom:{tag:"div",classes:[id.AssetMetadata]},components:[{dom:{tag:"a",classes:[id.AssetName]},components:[{dom:{tag:"span"},components:[Jh("Move one folder up")]}]}]}]}],action:function(e){return Yu(e,function(e,t,n){fv(t().path.length-1)(e,t,n)})},buttonBehaviours:br([em.config({store:{mode:"memory",initialValue:Fx}})])})},Cx=function(t,n,o,r,i){return function(e){return Tx.sketch({lazySink:t,file:e,listType:n,viewType:o,isSearching:r,insert:i})}},Ix={set:nf().set,get:function(e){return Kc(e.element()).bind(function(e){return Ls(e,"li",U(!1))})}},Ex=Ac({name:"FileList",factory:function(u){var a=Fr("list"),o=cs({dom:{tag:"div",classes:[id.InfiniteLoadingIndicator]},components:[{dom:{tag:"div",classes:[id.Spinner]},components:[{dom:{tag:"div"}},{dom:{tag:"div"}},{dom:{tag:"div"}}]}],behaviours:br([rd.config({}),em.config({store:{mode:"memory",initialValue:"spinner"}})])}),c=cs({dom:{tag:"ul",classes:[id.Assets]},components:[],behaviours:br([as.config({}),_l.config({mode:"flow",selector:"li",focusManager:Ix}),Ql.config({})])}),s=function(t){return o.getOpt(t).each(function(e){return as.remove(t,e)})};return{uid:u.uid,dom:{tag:"div",classes:[id.AssetsContainer].concat("grid"===a.get()?id.Grid:id.List)},components:[fx.sketch({lazySink:u.lazySink}),c.asSpec()],behaviours:pe(br([xs.config({toggleClass:id.AssetsHidden,toggleOnExecute:!1}),ox.config({events:[{native:"scroll",simulated:"bubbled.scroll"}]}),Tr("events",[or("bubbled.scroll",function(e){var t,n;t=e.element(),(n=t.dom()).scrollTop+n.clientHeight+400>=n.scrollHeight&&Yu(e,Ru)})])]),zc(u.fileListBehaviours)),apis:{setFiles:function(e,o,t,n,r){var i=Y([n?[]:[Dx()],H(o,Cx(u.lazySink,a.get(),t,r,u.insert))]);c.getOpt(e).each(function(e){var n=function(e,n){return Q(e).fold(function(){return Q(n.components()).each(rd.focus)},function(t){return j(n.components(),function(e){return em.getValue(e)===t.uuid}).each(function(e){Tx.focus(e)})})};Kc(e.element()).fold(function(){s(e),as.set(e,i)},function(t){j(e.components(),function(e){return jn(e.element(),t)}).fold(function(){s(e),as.set(e,i),n(o,e)},function(t){s(e),as.set(e,i),j(e.components(),function(e){return em.getValue(e)===em.getValue(t)}).fold(function(){return n(o,e)},Tx.focus)})})})},appendFiles:function(e,t,n,o){var r=H(t,Cx(u.lazySink,a.get(),n,o,u.insert));c.getOpt(e).each(function(t){s(t),R(r,function(e){as.append(t,e)})})},setListMode:function(e,t){a.set(t);var n=e.element();"grid"===a.get()?(Mi(n,id.List),Li(n,id.Grid)):(Mi(n,id.Grid),Li(n,id.List))},selectFile:function(e,t){j(e.components()[1].components(),function(e){return em.getValue(e)===t.uuid}).each(function(e){return Tx.selectFileListItem(e)})},deselectFile:function(e,t){j(e.components()[1].components(),function(e){return em.getValue(e)===t.uuid}).each(function(e){return Tx.deselectFileListItem(e)})},hideList:function(e){return xs.on(e)},showList:function(e){return xs.off(e)},loading:function(e,n){c.getOpt(e).each(function(e){var t=Kc(e.element()).isSome();"done"!==n&&"reload"!==n&&("new"===n&&as.set(e,[]),as.append(e,o.asSpec()),t&&"append"!==n&&Q(e.components()).each(rd.focus))})}}}},configFields:[Nc("fileListBehaviours",[]),Ht("insert"),Rt("lazySink")],apis:{setFiles:function(e,t,n,o,r,i){e.setFiles(t,n,o,r,i)},appendFiles:function(e,t,n,o,r){e.appendFiles(t,n,o,r)},setListMode:function(e,t,n){e.setListMode(t,n)},selectFile:function(e,t,n){e.selectFile(t,n)},deselectFile:function(e,t,n){e.deselectFile(t,n)},hideList:function(e,t){e.hideList(t)},showList:function(e,t){e.showList(t)},loading:function(e,t,n){e.loading(t,n)}}}),Lx=Ac({name:"Droparea",factory:function(e){return{dom:{tag:"div",classes:[id.DropArea]},components:[Vd.sketch({iconHtml:xd,classes:[id.DropAreaIcon]}),$h.sketch({text:"Drop to upload here",classes:[id.DropAreaLabel]}),{dom:{tag:"div",classes:[id.DropAreaShim]}}]}},configFields:[]}),Bx=function(n,e){return ry.sketch({dom:{tag:"div",classes:[id.FormGroup]},components:[$h.sketch({text:e,classes:[id.InputLabel]}),ry.parts().field({factory:om,tag:"textarea",inputClasses:[id.InputField],inputBehaviours:br([Ql.config({}),Tr("upload",[or("focusout",function(e){var r,i,t=em.getValue(e);Yu(e,(r=n,i=t,function(t,n,o){t({type:wu.SetDescription,payload:{description:i}}),o.setMeta(r,{description:i,createdBy:B.none()}).get(function(e){return e.fold(Ou(t),function(){return zu(t,n,o)})})}))})])])})]})},Mx=function(e,t){return[{dom:{tag:"span",classes:[id.InputLabel]},components:[Jh(e)]},$h.sketch({text:t,classes:[id.StaticValue]})]},Ax=function(n){return{dom:{tag:"div",classes:[id.FormGroup]},components:Mx(n,""),behaviours:br([as.config({}),Sm.config({find:B.some}),em.config({store:{mode:"manual",getValue:b,setValue:function(e,t){as.set(e,Mx(n,t))}}})])}},_x=Ac({name:"PreviewForm",factory:function(n){return ty.sketch(function(e){return{dom:{tag:"aside",classes:[id.Details]},components:[{dom:{tag:"div",classes:id.Form},components:[e.field("description",Bx(n.file.uuid,"Description")),e.field("fileName",Ax("File name")),e.field("type",Ax("Type"))].concat((t=n.file,Nb(t.name).exists(function(e){return"image"===e||"video"===e})?[e.field("dimensions",Ax("Dimensions"))]:[]),[e.field("modificationDate",Ax("Modification date")),e.field("createdBy",Ax("Created by"))])}]};var t})},configFields:[At("file")],apis:{set:function(e,t,n,o,r){var i;em.setValue(t,{dimensions:r.getOr("Loading..."),createdBy:o.createdBy.getOr("N/A"),description:o.description,fileName:n.name,modificationDate:gx(n.modificationDate),type:(i=n.name,Nb(i).fold(U("File"),function(e){switch(e){case"image":return"Image file";case"document":return"Document file";case"audio":return"Audio file";case"video":return"Video file";case"archive":return"Archive file";default:return"Unknown file"}}))}),n.starred&&Q(t.components()).map(function(e){return e.components()[1]}).bind(function(e){return ee(e.components())}).each(function(e){$h.setText(e,n.name,n.starred)})}}}),Nx=function(e,t){var n=t.map(function(e){return e.width+" x "+e.height}).or(B.some("N/A"));Yu(e,Cu(n))},zx=function(e){var t;return{dom:{tag:"img",classes:[id.PreviewImage],attributes:{src:e}},eventOrder:(t={},t[Co()]=["allowbubbling","imagePreview"],t),behaviours:br([ox.config({events:[{native:"error",simulated:"bubbled.error"}]}),Tr("imagePreview",[ar(function(t){var o;(o=e,ra(function(e){var t=Bn.fromTag("img"),n=function(){Ur(t)};Kr(t,{src:o}),Pi(t,{position:"fixed",top:"0",left:"0",visibility:"hidden"}),su(t,"load",function(){e(M.value({width:t.dom().naturalWidth,height:t.dom().naturalHeight})),n()}),su(t,"error",function(){e(M.error("Could not load image")),n()}),Vr(Zo(),t)})).get(function(e){Nx(t,e.toOption())})})])])}},Hx=function(e){return{dom:{tag:"div",classes:[id.Asset,id.AssetFile]},components:[Pd.sketch({type:e,classes:[id.PreviewIcon]})]}},Rx=function(o){switch(Nb(o.name).getOrUndefined()){case"image":return o.url.map(function(e){return zx(e)});case"video":return o.url.map(function(e){return t=o.name,n=e,{dom:{tag:"video",classes:[id.PreviewVideo],attributes:{controls:"true"}},components:[{dom:{tag:"source",attributes:{src:n,type:Eb(t).getOr("")}},behaviours:br([ox.config({events:[{native:"error",simulated:"bubbled.error"}]})])}],behaviours:br([ox.config({events:[{native:"loadedmetadata",simulated:"bubbled.loadedmetadata"},{native:"error",simulated:"bubbled.error"}]}),Tr("videoPreview",[or("bubbled.loadedmetadata",function(e){var t=Ta(B.from(e.element().dom().videoWidth),B.from(e.element().dom().videoHeight),function(e,t){return{width:e,height:t}});Nx(e,t)})])])};var t,n});default:return B.none()}},Vx=Ac({name:"Preview",factory:function(t){var e,o=cs(_x.sketch({file:t.file}));return{uid:t.uid,dom:{tag:"div",classes:[id.PreviewContainer]},components:[Pc.sketch({dom:{tag:"div",classes:[id.Preview]},components:[Rx(t.file).getOrThunk(function(){return Hx(t.file.type)})],containerBehaviours:br([as.config({}),Tr("mediaPreview",[or("bubbled.error",function(e){as.replaceBy(e,U(!0),B.some(Hx(t.file.type))),Nx(e,B.none())})])])}),o.asSpec()],behaviours:br([Gc.config({channels:(e={},e["channel.main"]=Ku(function(e,n){o.getOpt(e).each(function(t){n.state.preview.each(function(e){_x.set(t,e.file,e.meta,e.dimensions)})})}),e)}),Tr("Preview",[ar(function(e){o.getOpt(e).each(function(e){_x.set(e,t.file,t.meta,B.none())})})])])}},configFields:[At("uid"),At("file"),At("meta")]}),Px=Ac({name:"ProgressBar",factory:function(e){return{dom:{tag:"div",classes:[id.Progressbar]},components:[{dom:{tag:"div",attributes:{style:"width: "+e.percent+"%"},classes:[id.ProgressbarProgress]},components:[]}],apis:{setPercent:function(e,t){zr(e.element()).each(function(e){Vi(e,"width",t+"%")})}},behaviours:zc(e.progressBehaviours)}},configFields:[Yt("percent",0),Nc("progressBehaviours",[])],apis:{setPercent:function(e,t,n){e.setPercent(t,n)}}}),jx=vv(((zw={}).done=id.UploadDone,zw.uploading=id.UploadUploading,zw.idle=id.UploadIdle,zw)),Ux=Ac({name:"Upload",factory:function(e){var r=Fr("idle"),n=cs($h.sketch({classes:[id.UploadLabel],text:""})),o=cs(Px.sketch({percent:0})),i=[n.asSpec(),o.asSpec()],u=[Vd.sketch({iconHtml:pd,classes:[id.UploadIcon]}),n.asSpec(),o.asSpec()];return{uid:e.uid,dom:{tag:"div",classes:[id.Upload]},components:[],behaviours:pe(br([as.config({})]),zc(e.uploadStatusBehaviours)),apis:{setText:function(e,t){n.getOpt(e).each(function(e){$h.setText(e,t)})},setStatus:function(e,t){var n,o;t!==r.get()&&(o=t,jx((n=e).element(),o),"uploading"===o?as.set(n,i):"idle"===o?as.set(n,[]):"done"===o&&as.set(n,u),r.set(t))},setProgress:function(e,t){o.getOpt(e).each(function(e){Px.setPercent(e,t)})}}}},configFields:[Nc("uploadStatusBehaviours",[])],apis:{setText:function(e,t,n){e.setText(t,n)},setStatus:function(e,t,n){e.setStatus(t,n)},setProgress:function(e,t,n){e.setProgress(t,n)}}}),Gx=function(e,t){var n=G(t,function(e,t){return e+t.loaded},0),o=G(t,function(e,t){return e+t.total},0);Ux.setStatus(e,"uploading"),Ux.setText(e,"Uploading: "+String(Math.round(n/o*100))+"%"),Ux.setProgress(e,Math.round(n/o*100))},Wx=function(e){Ux.setStatus(e,"done"),Ux.setText(e,"Upload completed."),Ux.setProgress(e,100)},qx=function(e,t,n){e.getSystem().getByUid(n).fold(function(){t.getOpt(e).each(function(e){as.append(e,Ux.sketch({uid:n,uploadStatusBehaviours:br([Tr("upload",[ar(function(e){Wx(e)})])])}))})},function(e){return Wx(e)})},Kx=function(e,n,t){e.getSystem().getByUid(t).each(function(t){n.getOpt(e).each(function(e){as.remove(e,t)})})},Yx=function(t,e,n,o){var r,i,u,a;e.preview.isNone()&&e.upload.lastUpdate.isSome()?0<e.upload.files.length?(r=t,i=e.upload.files,u=n,a=o,r.getSystem().getByUid(a).fold(function(){u.getOpt(r).each(function(e){as.append(e,Ux.sketch({uid:a,uploadStatusBehaviours:br([Tr("upload",[ar(function(e){Gx(e,i)})])])}))})},function(e){return Gx(e,i)})):e.upload.lastUpdate.fold(function(){return qx(t,n,o)},function(e){return 5e3<(new Date).getTime()-e.getTime()?Kx(t,n,o):qx(t,n,o)}):Kx(t,n,o)},Jx=function(e,t,n){var o,r,i=n.fileState.hash!==t.fileState.hash,u=n.listType!==t.listType,a=n.query.isSome(),c=0===n.path.length||a,s=(o=n.path,r=t.path,o.length===r.length&&Z(o,function(e,t){return n=e,o=r[t],n.name===o.name&&n.uuid.equals(o.uuid);var n,o}));if(i||u)if(Ex.setListMode(e,n.listType),s&&0<t.fileState.offset&&n.fileState.offset>t.fileState.offset){var f=n.fileState.files.slice(t.fileState.offset);Ex.appendFiles(e,f,n.viewType,a)}else Ex.setFiles(e,n.fileState.files,n.viewType,c,a)},Zx=function(e,t,n){var o,r,i,u,a,c;o=e,r=n,t.fileState.loading!==r.fileState.loading&&Ex.loading(o,r.fileState.loading),Jx(e,t,n),i=e,n.preview.fold(function(){return Ex.showList(i)},function(){return Ex.hideList(i)}),u=e,a=t,R((c=n).selectedFiles,function(e){return Ex.selectFile(u,e)}),R($(a.selectedFiles,c.selectedFiles),function(e){return Ex.deselectFile(u,e)})},Xx=Ac({name:"MainView",factory:function(o){var e,t,n,r,a=ri("preview"),i=ri("upload"),u=cs(Lx.sketch({})),c=cs(Pc.sketch({dom:{classes:[id.AssetmanagerContainer],styles:{}},components:[Qw.sketch({maxImageDimension:o.maxImageDimension,dropboxAppKey:o.dropboxAppKey,googleDriveDeveloperKey:o.googleDriveDeveloperKey,googleDriveClientId:o.googleDriveClientId,lazySink:o.lazySink,fileTypes:o.fileTypes,zIndex:o.zIndex,insert:o.close&&o.insert,close:o.close,navBarBehaviours:br([Tr("navbar",[ar(function(e){Qw.setMode(e,"main","none",B.none())})])])}),ex.sketch({notificationBehaviours:br([Gc.config({channels:(e={},e["channel.main"]=Ku(function(e,t){$(t.oldState.notifications,t.state.notifications)&&ex.setNotifications(e,t.state.notifications)}),e)})])}),Ex.sketch({insert:o.close&&o.insert,lazySink:o.lazySink,fileListBehaviours:br([Gc.config({channels:(t={},t["channel.main"]=Ku(function(e,t){return Zx(e,t.oldState,t.state)}),t)})])})],containerBehaviours:br([as.config({}),Zl.config({mode:"drop",onDragenter:function(e,t){u.getOpt(e).isNone()&&as.append(e,u.asSpec())},onDrop:function(t,e){u.getOpt(t).each(function(e){as.remove(t,e)});var n=Wb(e.files);Yu(t,qb(n,o.fileTypes,o.maxImageDimension))},onDragleave:function(t,e){Ai(e.event().target(),id.DropAreaShim)&&u.getOpt(t).each(function(e){as.remove(t,e)})}})])}));return{dom:{tag:"div",classes:(r=o.renderMode,Y([[id.Assetmanager,id.AssetmanagerOpen],"modal"===r?[id.AssetmanagerModal]:[],"fullscreen"===r?[id.AssetmanagerFullscreen]:[]])),styles:{"z-index":String(o.zIndex)}},components:[c.asSpec()],behaviours:pe(br([_l.config({mode:"cyclic"}),as.config({}),Gc.config({channels:(n={},n["channel.main"]=Ku(function(u,e){e.state.preview.fold(function(){return n=c,t=a,void(e=u).getSystem().getByUid(t).each(function(t){n.getOpt(e).each(function(e){as.remove(e,t)})});var e,n,t},function(e){var t,n,o,r,i;t=u,n=e.file,o=e.meta,r=c,i=a,t.getSystem().getByUid(i).fold(function(){r.getOpt(t).each(function(e){as.append(e,Vx.sketch({uid:i,file:n,meta:o}))})},b)}),0!==e.state.selectedFiles.length?xs.on(u):xs.off(u),Yx(u,e.state,c,i)}),n)}),xs.config({toggleClass:id.AssetmanagerHasToolbar,toggleOnExecute:!1})]),zc(o.mainViewBehaviours))}},configFields:[Yt("zIndex",1),Nc("mainViewBehaviours",[]),Rt("lazySink"),qt("styles",{}),qt("maxImageDimension",B.none()),At("dropboxAppKey"),At("googleDriveDeveloperKey"),At("googleDriveClientId"),At("fileTypes"),Ht("insert"),Ht("close"),(Hw="renderMode",Rw=["inline","fullscreen","modal"],ht(Hw,Hw,be(),Mt(Rw)))]}),$x=id.AssetmanagerBody,Qx=function(e){var t=e.raw();return void 0===t.touches||1!==t.touches.length?B.none():B.some(t.touches[0])},eS=function(n){var u=Fr(B.none()),o=bv(function(e){u.set(B.none()),n.triggerEvent(To(),e)},400),r=Le([{key:Yn(),value:function(n){return Qx(n).each(function(e){o.cancel();var t={x:U(e.clientX),y:U(e.clientY),target:n.target};o.schedule(n),u.set(B.some(t))}),B.none()}},{key:Jn(),value:function(e){return o.cancel(),Qx(e).each(function(i){u.get().each(function(e){var t,n,o,r;t=i,n=e,o=Math.abs(t.clientX-n.x()),r=Math.abs(t.clientY-n.y()),(5<o||5<r)&&u.set(B.none())})}),B.none()}},{key:Zn(),value:function(t){o.cancel();return u.get().filter(function(e){return Pn(e.target(),t.target())}).map(function(e){return n.triggerEvent(Oo(),t)})}}]);return{fireIfReady:function(t,e){return Ie(r,e).bind(function(e){return e(t)})}}},tS=function(e){var t,n;return 8===e.raw().which&&!N(["input","textarea"],Go(e.target()))&&(t=e.target(),!Ls(t,'[contenteditable="true"]',n).isSome())},nS=En.detect().browser.isFirefox(),oS=ft([Rt("triggerEvent"),qt("stopBackspace",!0)]),rS=function(t,e){var n,o,r,i,u=kt("Getting GUI events settings",oS,e),a=En.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],c=eS(u),s=H(a.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),function(e){return su(t,e,function(t){c.fireIfReady(t,e).each(function(e){e&&t.kill()}),u.triggerEvent(e,t)&&t.kill()})}),f=Fr(B.none()),l=su(t,"paste",function(t){c.fireIfReady(t,"paste").each(function(e){e&&t.kill()}),u.triggerEvent("paste",t)&&t.kill(),f.set(B.some(L.setTimeout(function(){u.triggerEvent(bo(),t)},0)))}),d=su(t,"keydown",function(e){u.triggerEvent("keydown",e)?e.kill():!0===u.stopBackspace&&tS(e)&&e.prevent()}),m=(n=t,o=function(e){u.triggerEvent("focusin",e)&&e.kill()},nS?fu(n,"focus",o):su(n,"focusin",o)),p=Fr(B.none()),g=(r=t,i=function(e){u.triggerEvent("focusout",e)&&e.kill(),p.set(B.some(L.setTimeout(function(){u.triggerEvent(yo(),e)},0)))},nS?fu(r,"blur",i):su(r,"focusout",i));return{unbind:function(){R(s,function(e){e.unbind()}),d.unbind(),m.unbind(),g.unbind(),l.unbind(),f.get().each(L.clearTimeout),p.get().each(L.clearTimeout)}}},iS=function(e,t){var n=Ie(e,"target").map(function(e){return e()}).getOr(t);return Fr(n)},uS=le([{stopped:[]},{resume:["element"]},{complete:[]}]),aS=function(e,o,t,n,r,i){var u,a,c,s,f=e(o,n),l=(u=t,a=r,c=Fr(!1),s=Fr(!1),{stop:function(){c.set(!0)},cut:function(){s.set(!0)},isStopped:c.get,isCut:s.get,event:U(u),setSource:a.set,getSource:a.get});return f.fold(function(){return i.logEventNoHandlers(o,n),uS.complete()},function(t){var n=t.descHandler();return wi(n)(l),l.isStopped()?(i.logEventStopped(o,t.element(),n.purpose()),uS.stopped()):l.isCut()?(i.logEventCut(o,t.element(),n.purpose()),uS.complete()):Mr(t.element()).fold(function(){return i.logNoParent(o,t.element(),n.purpose()),uS.complete()},function(e){return i.logEventResponse(o,t.element(),n.purpose()),uS.resume(e)})})},cS=function(t,n,o,e,r,i){return aS(t,n,o,e,r,i).fold(function(){return!0},function(e){return cS(t,n,o,e,r,i)},function(){return!1})},sS=function(e,t,n){var o,r,i=(o=t,r=Fr(!1),{stop:function(){r.set(!0)},cut:b,isStopped:r.get,isCut:U(!1),event:U(o),setSource:a("Cannot set source of a broadcasted event"),getSource:a("Cannot get source of a broadcasted event")});return R(e,function(e){var t=e.descHandler();wi(t)(i)}),i.isStopped()},fS=function(e,t,n,o,r){var i=iS(n,o);return cS(e,t,n,o,i,r)},lS=Dr("element","descHandler"),dS=function(e,t){return{id:U(e),descHandler:U(t)}};function mS(){var i={};return{registerId:function(o,r,e){re(e,function(e,t){var n=void 0!==i[t]?i[t]:{};n[r]=bi(e,o),i[t]=n})},unregisterId:function(n){re(i,function(e,t){e.hasOwnProperty(n)&&delete e[n]})},filterByType:function(e){return Ie(i,e).map(function(e){return ae(e,function(e,t){return dS(t,e)})}).getOr([])},find:function(e,t,n){var r=De(t)(i);return tr(n,function(e){return n=r,fi(o=e).fold(function(){return B.none()},function(e){var t=De(e);return n.bind(t).map(function(e){return lS(o,e)})});var n,o},e)}}}function pS(){var o=mS(),r={},i=function(o){var e=o.element();return fi(e).fold(function(){return e="uid-",t=o.element(),n=ri(ai+e),si(t,n),n;var e,t,n},function(e){return e})},u=function(e){fi(e.element()).each(function(e){delete r[e],o.unregisterId(e)})};return{find:function(e,t,n){return o.find(e,t,n)},filter:function(e){return o.filterByType(e)},register:function(e){var t=i(e);Me(r,t)&&function(e,t){var n=r[t];if(n!==e)throw new Error('The tagId "'+t+'" is already used by: '+ei(n.element())+"\nCannot use it for: "+ei(e.element())+"\nThe conflicting element is"+(Jo(n.element())?" ":" not ")+"already in the DOM");u(e)}(e,t);var n=[e];o.registerId(n,t,e.events()),r[t]=e},unregister:u,getById:function(e){return De(e)(r)}}}var gS,hS=function(n){var o=function(t){return Mr(n.element()).fold(function(){return!0},function(e){return Pn(t,e)})},r=pS(),s=function(e,t){return r.find(o,e,t)},e=rS(n.element(),{triggerEvent:function(u,a){return Ba(u,a.target(),function(e){return t=s,n=u,r=e,i=(o=a).target(),fS(t,n,o,i,r);var t,n,o,r,i})}}),i={debugInfo:U("real"),triggerEvent:function(t,n,o){Ba(t,n,function(e){fS(s,t,o,n,e)})},triggerFocus:function(a,c){fi(a).fold(function(){Wc(a)},function(e){Ba(vo(),a,function(e){var t,n,o,r,i,u;t=s,n=vo(),o={originator:U(c),kill:b,prevent:b,target:U(a)},i=e,u=iS(o,r=a),aS(t,n,o,r,u,i)})})},triggerEscape:function(e,t){i.triggerEvent("keydown",e.element(),t.event())},getByUid:function(e){return p(e)},getByDom:function(e){return g(e)},build:ou,addToGui:function(e){a(e)},removeFromGui:function(e){c(e)},addToWorld:function(e){t(e)},removeFromWorld:function(e){u(e)},broadcast:function(e){l(e)},broadcastOn:function(e,t){d(e,t)},broadcastEvent:function(e,t){m(e,t)},isConnected:U(!0)},t=function(e){e.connect(i),Ko(e.element())||(r.register(e),R(e.components(),t),i.triggerEvent(Do(),e.element(),{target:U(e.element())}))},u=function(e){Ko(e.element())||(R(e.components(),u),r.unregister(e)),e.disconnect()},a=function(e){Zc(n,e)},c=function(e){Qc(e)},f=function(n){var e=r.filter(wo());R(e,function(e){var t=e.descHandler();wi(t)(n)})},l=function(e){f({universal:U(!0),data:U(e)})},d=function(e,t){f({universal:U(!1),channels:U(e),data:U(t)})},m=function(e,t){var n=r.filter(e);return sS(n,t)},p=function(e){return r.getById(e).fold(function(){return M.error(new Error('Could not find component with uid: "'+e+'" in system.'))},M.value)},g=function(e){var t=fi(e).getOr("not found");return p(t)};return t(n),{root:U(n),element:n.element,destroy:function(){e.unbind(),Ur(n.element())},add:a,remove:c,getByUid:p,getByDom:g,addToWorld:t,removeFromWorld:u,broadcast:l,broadcastOn:d,broadcastEvent:m}},vS=function(e){var t,n=(t=ou(Pc.sketch({dom:{tag:"div"}})),hS(t));return Li(n.element(),id.AssetmanagerRoot),Li(n.element(),id.Wrap),e.fold(function(){return Li(Zo(),$x),ts(Zo(),n),M.value(n)},function(e){var t=Es(Zo(),e);return M.fromOption(t,"Failed to find target by selector: "+e).map(function(e){return ts(e,n),n})})};gS=function(e,t,n){var o,r,i,u,a,c,s,f,l,d,m=vS(t.target).getOrDie(),p=function(e){Mi(Zo(),$x),m.destroy(),n(e)},g=(o=Sa,l=t.fileTypes,r={fileState:{offset:0,complete:!0,loading:"done",files:[],hash:""},selectedFiles:[],sortBy:"name",sortOrder:"asc",upload:{lastUpdate:B.none(),files:[]},viewType:"all",listType:"list",notifications:[],path:[],clipboard:B.none(),preview:B.none(),query:B.none(),fileTypes:l},i=e,u=function(e,t,n){var o,r,i;n.type===Pu.Exit?p([]):n.type===Uu.InsertFiles?p(n.payload.files):(o="channel.main",r=e,i=t,m.broadcastOn([o],{state:r,oldState:i}))},c=a=r,s=function(e){a=o(c=a,e),u(a,c,e)},f=function(){return a},{dispatch:function(e){e(s,f,i)}}),h=su(Bn.fromDom(L.document),"mousedown",function(e){0===e.raw().button&&m.broadcastOn(["dismiss.popups"],{target:e.target()})}),v=(d=g,ou(Pc.sketch({dom:{tag:"div",styles:{position:"relative","z-index":"10000000000"},classes:[id.AssetmanagerAux]},containerBehaviours:br([Sh.config({useFixed:!0}),Tr("mainevents",[or("action",function(e,t){var n=t.event().data();d.dispatch(n)})])])})));m.add(v);var y,b,w=t.zIndex,x=t.maxImageDimension,S=t.googleDriveClientId,O=t.googleDriveDeveloperKey,k=t.dropboxAppKey,T=t.fileTypes,F=t.target,D=t.insert,C=t.close,I=t.fullscreen,E=Xx.sketch({lazySink:function(){return M.value(v)},zIndex:w,maxImageDimension:x,dropboxAppKey:k,googleDriveDeveloperKey:O,googleDriveClientId:S,fileTypes:T,insert:D,close:C,renderMode:(y=F.isSome(),b=I,y?"inline":b?"fullscreen":"modal"),mainViewBehaviours:br([Tr("mainevents",[ar(function(e){var t,n,o;g.dispatch(qu((n=z(t=T,function(e){return!1===N(["directory","image","video"],e)}),o=N(t,"video")||N(t,"image"),!n&&o?"grid":"list")))}),cr(function(){h.unbind()}),or("action",function(e,t){var n=t.event().data();g.dispatch(n)})])])});m.add(ou(E))},(0,sa()[la])(M.value(gS))}(window);