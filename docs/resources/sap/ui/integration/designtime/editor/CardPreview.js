/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/m/HBox","sap/m/Image","sap/m/ToggleButton","sap/ui/integration/widgets/Card","sap/ui/core/Core","sap/ui/dom/includeStylesheet","sap/ui/integration/util/CardMerger"],function(e,t,i,r,a,s,o,n){"use strict";var d=e.extend("sap.ui.integration.designtime.editor.CardPreview",{metadata:{library:"sap.ui.integration",properties:{settings:{type:"any"},card:{type:"object"}},aggregations:{cardPreview:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}},renderer:{apiVersion:2,render:function(e,t){if(t._getCurrentMode()==="None"){e.openStart("div",t);e.openEnd();return}e.openStart("div",t);e.class("sapUiIntegrationDTPreview");if(g()){e.class("sapUiIntegrationDTPreviewDark")}if(t.getSettings().preview.position&&(t.getSettings().preview.position==="top"||t.getSettings().preview.position==="bottom")){var i=s.getConfiguration().getLanguage().replaceAll("_","-");if(i.startsWith("ar")||i.startsWith("he")){e.class("sapUiIntegrationDTPreviewMarginForAlignTopAndBottomSpec")}else{e.class("sapUiIntegrationDTPreviewMarginForAlignTopAndBottom")}}e.openEnd();e.openStart("div",t.getId()+"-before");e.class("before");e.attr("tabindex","-1");e.style("z-index",t.getParent()._iZIndex+1);e.openEnd();e.close("div");e.renderControl(t._getCardPreview());e.openStart("div",t.getId()+"-after");e.attr("tabindex","-1");e.openEnd();e.close("div");if(t._getModes().indexOf("Live")>-1&&t._getModes().indexOf("Abstract")>-1){e.renderControl(t._getModeToggleButton())}}}});d.prototype.init=function(){this._oResourceBundle=s.getLibraryResourceBundle("sap.ui.integration");s.attachThemeChanged(function(){if(this.getDomRef()){if(g()){this.getDomRef().classList.add("sapUiIntegrationDTPreviewDark")}else{this.getDomRef().classList.remove("sapUiIntegrationDTPreviewDark")}}else{this.update()}}.bind(this))};d.prototype.destroy=function(){if(this._oModeToggleButton){this._oModeToggleButton.destroy()}if(this._oCardPreview){this._oCardPreview.destroy()}if(this._oImagePlaceholder){this._oImagePlaceholder.destroy()}if(this._oCardPlaceholder){this._oCardPlaceholder.destroy()}e.prototype.destroy.apply(this,arguments)};d.prototype.onAfterRendering=function(){var e=this.getAggregation("cardPreview"),t=this._getModes();if(t.indexOf("Live")>-1&&e&&e.getDomRef()&&e.getDomRef().getElementsByClassName("sapVizFrame")){window.setTimeout(function(){try{var t=e.getDomRef().getElementsByClassName("sapVizFrame")[0].id;var i=s.byId(t);if(i.getVizProperties()&&i.getVizProperties().legendGroup.layout.position==="bottom"&&i.getVizProperties().legendGroup.layout.alignment==="center"){e.getDomRef().getElementsByClassName("v-m-legend")[0].transform.baseVal[0].matrix.e=110}}catch(e){}},500)}};d.prototype._getCardPreview=function(){var e=null;if(this._getCurrentMode()==="Abstract"){if(this.getSettings().preview.src){e=this._getImagePlaceholder()}else{e=this._getCardPlaceholderPreview()}}else if(this._getCurrentMode()==="Live"){e=this._getCardRealPreview()}if(e){this.setAggregation("cardPreview",e);if(!this.getSettings().preview||this.getSettings().preview.scaled!==false){e.removeStyleClass("sapUiIntegrationDTPreviewScale");e.removeStyleClass("sapUiIntegrationDTPreviewScaleSpec");var t=s.getConfiguration().getLanguage().replaceAll("_","-");if(t.startsWith("ar")||t.startsWith("he")){e.addStyleClass("sapUiIntegrationDTPreviewScaleSpec")}else{e.addStyleClass("sapUiIntegrationDTPreviewScale")}}else{e.addStyleClass("sapUiIntegrationDTPreviewNoScale")}}return e};d.prototype._getCardPlaceholderPreview=function(){var e=this.getCard(),t;function i(t,i){return e.getManifestEntry(t)?i||"{bound}":null}var r=null;if(e.getManifestEntry("/sap.card/header")){var s=e.getManifestEntry("/sap.card/header/type");if(s&&s.toUpperCase()==="NUMERIC"){r={title:i("/sap.card/header/title"),type:"Numeric",subTitle:i("/sap.card/header/subTitle"),unitOfMeasurement:i("/sap.card/header/unitOfMeasurement"),mainIndicator:i("/sap.card/header/mainIndicator",{number:"{bound}",unit:"{bound}",trend:"{bound}",state:"{bound}"}),details:i("/sap.card/header/details"),sideIndicators:[i("/sap.card/header/sideIndicators/0",{title:"Deviation",number:"{bound}",unit:"{bound}"}),i("/sap.card/header/sideIndicators/1",{title:"Target",number:"{bound}",unit:"{bound}"})]}}else{r={title:i("/sap.card/header/title"),subTitle:i("/sap.card/header/subTitle"),status:i("/sap.card/header/status"),icon:i("/sap.card/header/icon",{src:"{bound}"})}}}var o=this.getParent().getCurrentSettings();t={"sap.app":{type:"card",id:e.getManifestEntry("/sap.app/id")+".abstractPreview"},"sap.card":{type:e.getManifestEntry("/sap.card/type")==="List"?"List":"Component",header:r,content:{maxItems:Math.min(o["/sap.card/content/maxItems"]||6,6),item:{title:{value:i("/sap.card/content/item/value")},icon:i("/sap.card/content/item/icon",{src:"{bound}"}),description:i("/sap.card/content/item/description"),info:{value:i("/sap.card/content/item/info")}}}}};if(!this._oCardPlaceholder){this._oCardPlaceholder=new a;this._oCardPlaceholder._setPreviewMode(true)}this._oCardPlaceholder.setManifest(t);this._oCardPlaceholder.refresh();return this._oCardPlaceholder};d.prototype.getTransformContentInfo=function(){return{transformStyle:"scale3d(0.4, 0.4, 1)",transformFactor:.4,transformOriginStyle:"0 0",widthStyle:"500px",heightStyle:"600px",zIndex:this.getParent()._iZIndex}};d.prototype._getCardRealPreview=function(){if(!this._oCardPreview){this._oCardPreview=new a;this._oCardPreview.setBaseUrl(this.getCard().getBaseUrl())}this._initalChanges=this._initalChanges||this._oCardPreview.getManifestChanges()||[];var e=this._initalChanges.concat([this.getParent().getCurrentSettings()]);this._oCardPreview.setManifestChanges(e);this._oCardPreview.setManifest(this.getCard()._oCardManifest._oManifest.getRawJson());this._oCardPreview.setHost(this.getCard().getHost());this._oCardPreview.refresh();this._oCardPreview.editor=this._oCardPreview.editor||{};this._oCardPreview.preview=this._oCardPreview.editor.preview=this;return this._oCardPreview};d.prototype._getImagePlaceholder=function(){var e=this.getSettings();if(e.preview.src){if(!this._oImagePlaceholder){var r=new t;r.addStyleClass("sapFCard");r.setWidth("500px");var a=this.getCard().getBaseUrl();if(!a&&typeof this.getCard().getManifest()==="string"){a=this.getCard().getManifest();a=a.substring(0,a.lastIndexOf("/")+1)}var s=a+"/"+e.preview.src;var o=new i({src:s});o.addStyleClass("sapUiIntegrationDTPreviewImg");o.setWidth("500px");o.setHeight("600px");r.addItem(o);this._oImagePlaceholder=r}}return this._oImagePlaceholder};d.prototype._getModes=function(){var e=this.getSettings();e.preview=e.preview||{};e.preview.modes=e.preview.modes||"Abstract";return e.preview.modes};d.prototype._getCurrentMode=function(){var e=this._getModes();if(!this._currentMode){switch(e){case"AbstractLive":case"Abstract":this._currentMode="Abstract";break;case"LiveAbstract":case"Live":this._currentMode="Live";break;default:this._currentMode="None"}}return this._currentMode};d.prototype._toggleCurrentMode=function(){var e=this._getModes();if(e.indexOf("Live")>-1&&e.indexOf("Abstract")>-1){this._currentMode=this._getCurrentMode()==="Abstract"?"Live":"Abstract"}};d.prototype._getModeToggleButton=function(){var e=s.getLibraryResourceBundle("sap.ui.integration");if(!this._oModeToggleButton){this._oModeToggleButton=new r;this._oModeToggleButton.setTooltip();this._oModeToggleButton.attachPress(function(){this._toggleCurrentMode();this.update()}.bind(this))}this._oModeToggleButton.removeStyleClass("sapUiIntegrationDTPreviewButton");this._oModeToggleButton.removeStyleClass("sapUiIntegrationDTPreviewButtonSpec");var t=s.getConfiguration().getLanguage().replaceAll("_","-");if(t.startsWith("ar")||t.startsWith("he")){this._oModeToggleButton.addStyleClass("sapUiIntegrationDTPreviewButtonSpec")}else{this._oModeToggleButton.addStyleClass("sapUiIntegrationDTPreviewButton")}var i=this._oModeToggleButton,a=this._getCurrentMode();if(a==="None"){i.setVisible(false)}if(a==="Abstract"){i.setIcon("sap-icon://media-play");i.setPressed(false);i.setTooltip(e.getText("CARDEDITOR_PREVIEW_BTN_LIVEPREVIEW"))}else if(a==="Live"){i.setIcon("sap-icon://media-pause");i.setPressed(true);i.setTooltip(e.getText("CARDEDITOR_PREVIEW_BTN_SAMPLEPREVIEW"))}return this._oModeToggleButton};d.prototype.update=function(){this.invalidate()};function g(e){e=e||window.getComputedStyle(document.body).backgroundColor;var t=/rgb\((\d+).*?(\d+).*?(\d+)\)/.exec(e);if(!t){return false}var i=parseInt(t[1]),r=parseInt(t[2]),a=parseInt(t[3]),s=(i*299+r*587+a*114)/1e3;return s<=128}d.prototype.onsaptabnext=function(e){if(e.target===this.getDomRef("before")){this.getDomRef("after").focus()}};d.prototype.onsaptabprevious=function(e){if(e.target===this.getDomRef("after")){this.getDomRef("before").focus()}};d.init=function(){var e=sap.ui.require.toUrl("sap.ui.integration.designtime.editor.css.CardPreview".replace(/\./g,"/")+".css");o(e);this.init=function(){}};d.init();return d});
//# sourceMappingURL=CardPreview.js.map