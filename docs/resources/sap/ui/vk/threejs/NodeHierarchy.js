/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","../Messages","../getResourceBundle","../NodeContentType","sap/base/util/uid","sap/base/assert","sap/base/Log"],function(e,t,r,n,o,i,a,s,d,c){"use strict";var u={equals:function(e,t){return e===t},contains:function(e,t){return e.indexOf(t)!==-1},startsWith:function(e,t){return e.indexOf(t)===0}};var f=e.extend("sap.ui.vk.threejs.NodeHierarchy",{metadata:{library:"sap.ui.vk"},_baseNodeProxyPool:new t(r),constructor:function(t){e.call(this);this._scene=t;this._nodeProxies=[]}});f.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;e.prototype.destroy.call(this)};f.prototype.getScene=function(){return this._scene};f.prototype.getSceneRef=function(){return this._scene.getSceneRef()};f.prototype.enumerateChildren=function(e,t,r,n){if(typeof e==="function"){n=r;r=t;t=e;e=undefined}var o=this.getChildren(e,r);if(n){o.forEach(t)}else{var i=this._baseNodeProxyPool.borrowObject();try{o.forEach(function(e){i.init(this,e);t(i);i.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(i)}}return this};f.prototype.enumerateAncestors=function(e,t,r){var n=this.getAncestors(e);if(r){n.forEach(t)}else{var o=this._baseNodeProxyPool.borrowObject();try{n.forEach(function(e){o.init(this,e);t(o);o.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(o)}}return this};f.prototype.createNodeProxy=function(e){var t=new n(this,e);this._nodeProxies.push(t);return t};f.prototype.destroyNodeProxy=function(e){var t=this._nodeProxies.indexOf(e);if(t>=0){this._nodeProxies.splice(t,1)[0].destroy()}return this};f.prototype.getChildren=function(e,t){if(typeof e==="boolean"){t=e;e=undefined}if(!e){e=this._scene.getSceneRef()}var r=[];if(t||!e.userData.closed){e.children.forEach(function(e){if(!e.private&&(e.geometry===undefined||!e.userData.skipIt)){r.push(e)}})}return r};f.prototype.getAncestors=function(e){var t=[];e.traverseAncestors(function(e){t.unshift(e)});if(t.length>0&&t[0]===this._scene.getSceneRef()){t.shift()}return t};f.prototype.findNodesByName=function(e){var t=[];if(e===undefined||e===null||e===""||jQuery.isEmptyObject(e)){this._scene.getSceneRef().children.forEach(function(e){e.traverse(function(e){if(!e.private&&!e.userData.skipIt){t.push(e)}})})}else{var r=u[e.predicate||"equals"];if(r===undefined){c.error(i().getText(o.VIT8.summary),o.VIT8.code,"sap.ui.vk.threejs.NodeHierarchy")}else if(!Array.isArray(e.value)&&typeof e.value!=="string"){c.error(i().getText(o.VIT6.summary),o.VIT6.code,"sap.ui.vk.threejs.NodeHierarchy")}else{var n=Array.isArray(e.value)?e.value:[e.value];if(!e.caseSensitive){for(var a in n){n[a]=n[a].toLowerCase()}}this._scene.getSceneRef().children.forEach(function(o){o.traverse(function(o){if(!o.private&&!o.userData.skipIt){var i=o.name||"";if(!e.caseSensitive){i=i.toLowerCase()}for(var a in n){if(r(i,n[a])){t.push(o);break}}}})})}}return t};f.prototype.findNodesByUsageIdPath=function(e,t,r){var n=[];function o(i,a,s){if(!i.userData.skipIt){if(a>=0){var d=t[a];if(d==="**"){d=t[++a];s=true}var c=d==="*";if(!c&&Array.isArray(i.userData.usageIds)){var u=i.userData.usageIds.find(function(t){return t.name===e});var f=u&&u.keys;var h=Array.isArray(d)?d:[d];if(Array.isArray(f)&&f.length===h.length){c=f.every(function(e){return h.some(function(t){return t.name===e.name&&t.value===e.value})})}}if(c){a++;if(a>=t.length){n.push(i);return}s=false}else if(!s){return}}else{a=0}}if(!i.userData.closed||r&&r.stepIntoClosedNodes){i.children.forEach(function(e){o(e,a,s)})}}o(r&&r.searchUnder||this._scene.getSceneRef(),-1,false);return n};f.prototype.createLayerProxy=function(e){return null};f.prototype.destroyLayerProxy=function(e){return this};f.prototype.getLayers=function(){return[]};f.prototype.getHotspotNodeIds=function(){return null};f.prototype.attachChanged=function(e,t,r){return this.attachEvent("changed",e,t,r)};f.prototype.detachChanged=function(e,t,r){return this.detachEvent("changed",e,t,r)};f.prototype.fireChanged=function(e,t,r){return this.fireEvent("changed",e,t,r)};f.prototype.attachNodeCreated=function(e,t,r){return this.attachEvent("nodeCreated",e,t,r)};f.prototype.detachNodeCreated=function(e,t,r){return this.detachEvent("nodeCreated",e,t,r)};f.prototype.fireNodeCreated=function(e,t,r){return this.fireEvent("nodeCreated",e,t,r)};f.prototype.attachNodeRemoving=function(e,t,r){return this.attachEvent("nodeRemoving",e,t,r)};f.prototype.detachNodeRemoving=function(e,t,r){return this.detachEvent("nodeRemoving",e,t,r)};f.prototype.fireNodeRemoving=function(e,t,r){return this.fireEvent("nodeRemoving",e,t,r)};f.prototype.attachNodeReplaced=function(e,t,r){return this.attachEvent("nodeReplaced",e,t,r)};f.prototype.detachNodeReplaced=function(e,t,r){return this.detachEvent("nodeReplaced",e,t,r)};f.prototype.fireNodeReplaced=function(e,t,r){return this.fireEvent("nodeReplaced",e,t,r)};f.prototype.attachNodeUpdated=function(e,t,r){return this.attachEvent("nodeUpdated",e,t,r)};f.prototype.detachNodeUpdated=function(e,t,r){return this.detachEvent("nodeUpdated",e,t,r)};f.prototype.fireNodeUpdated=function(e,t,r){return this.fireEvent("nodeUpdated",e,t,r)};f.prototype.createNode=function(e,t,r,n,o){var c=this.getScene().getSceneBuilder();var u=null;if(c){o=o||{};o.name=o.name||t;o.sid=o.sid||s();u=c.createNode(o);if(!e){e=u.parent}}else{if(!e){e=this._scene.getSceneRef()}u=new THREE.Group;u.name=t;e.add(u)}var f=e.children.indexOf(r);d(e.children[e.children.length-1]===u,i().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(f>=0){e.children.splice(f,0,e.children.pop())}if(n){u._vkSetNodeContentType(n)}else{u._vkSetNodeContentType(a.Regular)}if(o&&c){switch(u._vkGetNodeContentType()){case a.Annotation:o.node=u;o.nodeId=u._vkPersistentId();c.createAnnotation(o);break;case a.Background:c.setParametricContent(o.sid,o.parametricContent);break;default:}}this.fireNodeCreated({nodeRef:u,nodeId:u});this.fireChanged();return u};f.prototype.getNodeContentType=function(e){if(e==null){return a.Regular}var t=e._vkGetNodeContentType();if(!t){t=a.Regular}return t};f.prototype.createNodeCopy=function(e,t,r,n){if(!t){t=this._scene.getSceneRef()}var o=t.children.indexOf(n);var a=e.clone(true);a.name=r;t.add(a);d(t.children[t.children.length-1]===a,i().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(o>=0){t.children.splice(o,0,t.children.pop())}this.fireNodeCreated({nodeRef:a,nodeId:a});this.fireChanged();return a};f.prototype.removeNode=function(e){var t=[].concat(e);t.forEach(function(e){if(e&&e.parent){this.fireNodeRemoving({nodeRef:e,nodeId:e});e.parent.remove(e)}}.bind(this));var r=this.getScene().getSceneBuilder();if(r){t.forEach(r.removeNode,r)}this.fireChanged();return this};return f});
//# sourceMappingURL=NodeHierarchy.js.map