/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../thirdparty/three","sap/ui/base/ManagedObject","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","../LeaderLineMarkStyle"],function(e,t,r,a,s,i){"use strict";var n=t.extend("sap.ui.vk.threejs.Thrustline",{metadata:{library:"sap.ui.vk",properties:{node:{type:"object"},renderOrder:{type:"int",defaultValue:0},depthTest:{type:"boolean",defaultValue:true},principleAxis:{type:"object",defaultValue:new THREE.Vector3(0,0,0)},material:{type:"object"},items:{type:"object[]"},segments:{type:"object[]"}}}});n.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this._needUpdateMeshes=false};n.prototype.setNode=function(e){if(e instanceof THREE.Object3D){this.setProperty("node",e,true);this._needUpdateMeshes=true}return this};n.prototype.setRenderOrder=function(e){this.setProperty("renderOrder",e,true);this._needUpdateMeshes=true;return this};n.prototype.setDepthTest=function(e){this.setProperty("depthTest",e,true);this._needUpdateMeshes=true;return this};n.prototype.setMaterial=function(e){if(e instanceof THREE.Material){this.setProperty("material",e,true);this._needUpdateMeshes=true}return this};n.prototype.setItems=function(e){this.setProperty("items",e,true);this._needUpdateMeshes=true;return this};n.prototype.setSegments=function(e){this.setProperty("segments",e,true);this._needUpdateMeshes=true;return this};n.prototype._updateMeshes=function(e){var t=this.getNode();var i=this.getMaterial();var n=this.getDepthTest();var o=this.getRenderOrder();var p=i&&i.userData.lineStyle?i.userData.lineStyle:{};var l=p.width;var d=p.dashPatternScale;if(p.widthCoordinateSpace===3){l=l?l*e.y:1;d=d?d*e.y:1}l=l||1;p.haloWidth=p.haloWidth||0;p.endCapStyle=p.endCapStyle||0;this.getSegments().forEach(function(e){if(e.polylineMesh){t.remove(e.polylineMesh);e.polylineMesh=null}if(e.haloMesh){t.remove(e.haloMesh);e.haloMesh=null}var h=[];for(var u=0,y=e.ratios.length;u<y;u++){h.push(new THREE.Vector3)}var c=new r;c.setVertices(h);var f=p.endCapStyle||h.length>2?1:0;var v=(f&&p.endCapStyle===0?1:0)|(f&&p.endCapStyle===0?2:0);if(p.haloWidth>0){var m=new a({color:16777215,lineColor:16777215,linewidth:l*(p.haloWidth*2+1),dashCapStyle:p.endCapStyle,segmentCapStyle:f,trimStyle:v,transparent:true,depthTest:n});var M=new s(c,m);M.matrixAutoUpdate=false;M.renderOrder=o;M.userData.skipIt=true;e.haloMesh=M;t.add(M)}var E=new a({color:16777215,lineColor:i.color,linewidth:l,dashCapStyle:p.endCapStyle,segmentCapStyle:f,trimStyle:v,dashPattern:p.dashPattern||[],dashScale:d||1,transparent:true,depthTest:n,polygonOffset:true,polygonOffsetFactor:-4});var g=new s(c,E);g.matrixAutoUpdate=false;g.renderOrder=o;g.userData.skipIt=true;e.polylineMesh=g;t.add(g)})};var o=new THREE.Matrix4,p=new THREE.Matrix4,l=new THREE.Vector3,d=new THREE.Vector3,h=new THREE.Vector3,u=new THREE.Vector3;n.prototype._update=function(e,t,r){var a=this.getNode();if(!a||!a.visible){return}if(this._needUpdateMeshes){this._needUpdateMeshes=false;this._updateMeshes(r)}o.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);p.copy(o);var s=t instanceof THREE.PerspectiveCamera?t.near:undefined;var i=this.getItems();l.copy(this.getPrincipleAxis()).normalize();this.getSegments().forEach(function(e){var t=e.polylineMesh;if(t){var a=t.geometry;var n=i[e.startItemIndex];var o=(new THREE.Vector3).copy(n.boundPoints[e.startBoundIndex]).applyMatrix4(n.target.matrixWorld);var y=i[e.endItemIndex];var c=(new THREE.Vector3).copy(y.boundPoints[e.endBoundIndex]).applyMatrix4(y.target.matrixWorld);d.copy(c).sub(o);h.copy(l).multiplyScalar(d.dot(l));u.copy(d).sub(h);var f=a.vertices;var v=[];for(var m=0,M=e.ratios.length;m<M;m++){v.push(m);var E=e.ratios[m];var g=f[m];g.copy(o);d.copy(h).multiplyScalar(E.x);g.add(d);d.copy(u).multiplyScalar(E.y);g.add(d)}a._updateVertices(v);t.material.resolution.copy(r);t.computeLineDistances(p,r,s)}var S=e.haloMesh;if(S){S.material.resolution.copy(r);S.computeLineDistances(p,r,s)}})};return n});
//# sourceMappingURL=Thrustline.js.map