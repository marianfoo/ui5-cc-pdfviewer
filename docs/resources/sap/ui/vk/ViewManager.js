/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Element","./Core","./Scene","sap/ui/core/Core"],function(e,t,i,n){"use strict";var a=e.extend("sap.ui.vk.ViewManager",{metadata:{library:"sap.ui.vk",interfaces:["sap.ui.vk.IViewManager"],properties:{allowAutoPlayAnimation:{type:"boolean",defaultValue:true},autoAdvanceViewTimeout:{type:"int",defaultValue:1e3}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},animationPlayer:{type:"sap.ui.vk.AnimationPlayer"}}},constructor:function(i,n){e.apply(this,arguments);t.observeLifetime(this);t.observeAssociations(this)}});a.prototype._setScene=function(e){if(this._scene!==e){this._scene=e;if(this._scene){var t=e.getInitialView();if(t){this.activateView(t)}}}return this};a.prototype.getScene=function(){return this._scene};a.prototype.getActiveView=function(){return this._activeView};a.prototype.getNextView=function(e,t){var i=this.getScene();if(!t){t=i.findViewGroupByView(e)}var n;var a=-1;if(!t){n=i.getViews();a=n.indexOf(e)}else{n=t.getViews();a=t.indexOfView(e)}if(a<0){return undefined}else if(a>=n.length-1){return undefined}a++;return n[a]};a.prototype._setContent=function(e){var t=null;if(e&&e instanceof i){t=e}this._setScene(t)};a.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};a.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};a.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};a.prototype.activateView=function(e,t){return this._activateView(e,null,!this.getAllowAutoPlayAnimation(),false,t)};a.prototype.playViewGroup=function(e,t){this._cancelPlayingViewGroup=false;if(e===this.getActiveView()){var i=n.byId(this.getAnimationPlayer());if(i){if(i.getTime()>=i.getTotalDuration()){i.setTime(0)}}return this._autoPlay(e,t,false,true)}this._activateView(e,t,false,true);return this};a.prototype.stopPlayingViewGroup=function(){this._cancelPlayingViewGroup=true;var e=n.byId(this.getAnimationPlayer());if(e){e.stop()}};a.prototype._autoPlay=function(e,i,a,o){var r=t.getEventBus();var s=n.byId(this.getAnimationPlayer());var u=function(){if(this._cancelPlayingViewGroup){return}var t=this.getNextView(e,i);if(t){this._activateView(t,i,a,o)}else{r.publish("sap.ui.vk","procedureFinished")}}.bind(this);var c=function(e,t,i){if(i.source!==s){return}if(i.stopped){r.unsubscribe("sap.ui.vk","animationPlayStateChanged",c,this);if(i.endOfAnimation){u()}}};var p=function(){var t=e.getAutoPlayAnimation();if(o){if(s&&e.hasAnimation()&&t){r.subscribe("sap.ui.vk","animationPlayStateChanged",c,this)}else{setTimeout(function(){u()},this.getAutoAdvanceViewTimeout())}}if((!a||o)&&e.hasAnimation()&&t){if(s){s.play()}else{}}}.bind(this);p()};a.prototype._activateView=function(e,i,a,o,r){var s=n.byId(this.getAnimationPlayer());if(s){s.stop()}this._cancelPlayingViewGroup=false;var u=this;return new Promise(function(n,s){var c=t.getEventBus();u._activeView=e;var p=function(t,r,s){c.unsubscribe("sap.ui.vk","readyForAnimation",p,u);if(s.view!==e){return}if(u._cancelPlayingViewGroup){return}u._autoPlay(e,i,a,o,true);n({view:s.view});return};c.subscribe("sap.ui.vk","readyForAnimation",p,u);c.publish("sap.ui.vk","activateView",{source:u,view:e,notAnimateCameraChange:r,playViewGroup:o})})};return a});
//# sourceMappingURL=ViewManager.js.map