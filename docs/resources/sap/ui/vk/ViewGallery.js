/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/IconPool","./library","./Core","sap/m/Slider","./ViewGalleryRenderer","./getResourceBundle","./ViewGalleryThumbnail","sap/m/HBox","sap/m/VBox","sap/m/FormattedText","sap/m/FlexItemData","sap/m/Image","sap/m/ScrollContainer","sap/m/Button","sap/m/ToggleButton","sap/m/Toolbar","sap/m/Popover","sap/m/Title","sap/m/SelectList","sap/m/ToolbarSpacer","sap/ui/model/json/JSONModel","sap/ui/core/dnd/DropInfo","sap/ui/core/dnd/DragInfo","sap/base/Log"],function(e,t,i,s,n,o,r,a,l,p,c,h,d,u,g,m,_,f,v,V,w,y,S,I,T){"use strict";var b=e.extend("sap.ui.vk.ViewGallery",{metadata:{library:"sap.ui.vk",properties:{showAnimationTimeSlider:{type:"boolean",defaultValue:true},showToolbar:{type:"boolean",defaultValue:true},showThumbnailContainer:{type:"boolean",defaultValue:true},selectedViewIndex:{type:"int",defaultValue:-1},selectedViewGroupIndex:{type:"int",defaultValue:-1},enableViewReordering:{type:"boolean",defaultValue:false},transparency:{type:"float",defaultValue:1},enabled:{type:"boolean",defaultValue:true}},associations:{animationPlayer:{type:"sap.ui.vk.AnimationPlayer"},contentConnector:{type:"sap.ui.vk.ContentConnector"},host:{type:"sap.ui.vk.ViewportBase"},viewManager:{type:"sap.ui.vk.ViewManager"}},aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},container:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"},animationTimeSlider:{type:"sap.m.Slider",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{item:"sap.ui.core.Control"}},viewOrderChange:{parameters:{view:"sap.ui.vk.View",viewIndex:"int"}}}},constructor:function(t,i){e.apply(this,arguments);s.observeAssociations(this)}});b.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}var i=this;window.addEventListener("resize",function(){i.resizeToolbarSpacer()},true);this._scene=null;this._vkScene=null;this._viewItems=[];this._viewManager=null;this._host=null;this._cdsLoader=null;this._selectedGroupIndex=-1;this._previousOrientationVertical=false;this._playingAnimation=true;this._draggedModelView={};this._animationPlayer=null;this._manualTimeChange=false;t.addIcon("landscape-text","vk-icons","vk-icons","e019");t.addIcon("portrait-text","vk-icons","vk-icons","e01a");this.oModel=new y;if(this.getShowThumbnailContainer()){this.createThumbnailContainer()}if(this.getShowToolbar()){this.createToolbar()}if(this.getShowAnimationTimeSlider()){this.setAggregation("animationTimeSlider",new n);this._attachAnimationTimeSlider(this.getAnimationTimeSlider())}s.getEventBus().subscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);s.getEventBus().subscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this)};b.prototype.exit=function(){s.getEventBus().unsubscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);s.getEventBus().unsubscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this);this.setScene(null)};b.prototype.onSetViewManager=function(e){this._viewManager=e};b.prototype.onUnsetViewManager=function(e){this._viewManager=null};b.prototype._getSelectedViewGroup=function(){var e=this.getSelectedViewGroupIndex();var t;if(this._vkScene){var i=this._vkScene.getViewGroups();if(e>=0&&e<i.length){t=i[e]}}return t};b.prototype._getSelectedView=function(){var e;var t=this.getSelectedViewIndex();var i=this._getViews();if(i&&t>=0&&t<i.length){e=i[t]}return e};b.prototype._getViewGroups=function(){var e;if(this._vkScene){e=this._vkScene.getViewGroups()}return e};b.prototype._getViews=function(){var e=this._getSelectedViewGroup();var t;if(e){t=e.getViews()}else if(this._vkScene){t=this._vkScene.getViews()}return t};b.prototype._getViewIndex=function(e){var t=-1;var i=this._getViews();if(Array.isArray(i)){t=i.indexOf(e)}return t};b.prototype._getViewAnimationDuration=function(e){e=e||this._getSelectedView();var t;if(e){var i=e.getPlaybacks();if(Array.isArray(i)&&i.length){t=i.reduce(function(e,t){return e+t.getDuration()},0)}}return t};b.prototype.setVisible=function(t){if(e.prototype.setVisible){e.prototype.setVisible.call(this,t)}this.setDescription()};b.prototype.resizeToolbarSpacer=function(){if(this.getDomRef()){var e=this._nextItemButton.getDomRef().getBoundingClientRect().width;e+=this._playButton.getDomRef().getBoundingClientRect().width;e+=this._previousItemButton.getDomRef().getBoundingClientRect().width;var t=this.toolbar.getDomRef().getBoundingClientRect().width;var i=e/t*100;var s=50-i;this._toolbarSpacer.setWidth(s+"%")}};b.prototype.onAfterRendering=function(){this.resizeToolbarSpacer();if(document.getElementById("body")){var e=window.getComputedStyle(document.getElementById("body"));var t=e.getPropertyValue("background-color");var i;var s=this.getDomRef();if(t){if(t.indexOf("a")===-1){i=t.replace("rgb","rgba").replace(")",", "+this.getTransparency()+")");s.style.backgroundColor=i}else{var n=new RegExp("([^,]*)$");i=t.replace(n," "+this.getTransparency()+")");s.style.backgroundColor=i}}if(this.toolbar){var o=this.toolbar.getDomRef();o.style.backgroundColor="rgba(0, 0, 0, 0)"}}if(this._host&&this._host.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes()}if(this.getDomRef()){var r=this.getDomRef();if(!this.getEnabled()){var a=function(e){var t=e.children;for(var i=0;i<t.length;i++){t[i].tabIndex=-1;a(t[i])}};a(r);this.addStyleClass("sapVizKitViewGalleryDisabled")}else{this.removeStyleClass("sapVizKitViewGalleryDisabled")}}};b.prototype.setShowAnimationTimeSlider=function(e){this.setProperty("showAnimationTimeSlider",e);if(e){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setAggregation("animationTimeSlider",new n);this._attachAnimationTimeSlider(this.getAnimationTimeSlider())}else{this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.destroyAggregation("animationTimeSlider")}this._setupAnimationSlider()};b.prototype.getAnimationTimeSlider=function(){return this.getAggregation("animationTimeSlider")};b.prototype.destroyToolbar=function(){this.destroyAggregation("toolbar")};b.prototype.destroyThumbnailContainer=function(){this.destroyAggregation("container")};b.prototype.createThumbnailContainer=function(){var e=this;this._hbox=new l;if(this.getEnableViewReordering()){this._hbox.addDragDropConfig(new S({dropEffect:sap.ui.core.dnd.DropEffect.Move,dropPosition:sap.ui.core.dnd.DropPosition.On,targetAggregation:"items",drop:function(t){var i=t.getParameter("droppedControl");e.reorderViews(i);e.fireViewOrderChange({view:e._draggedModelView,viewIndex:e._viewItems.indexOf(i)})}}));this._hbox.getMetadata().getAggregation().dnd.droppable=true}this._scrollContainer=new u(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true,content:[this._hbox]});this._scrollContainer.addStyleClass("sapVizKitViewGalleryScrollContainer");this.setAggregation("container",this._scrollContainer)};b.prototype.reorderViews=function(e){var t=this._modelViews.indexOf(this._draggedModelView);this._modelViews.splice(t,1);var i=this._viewItems.indexOf(e);this._modelViews.splice(i,0,this._draggedModelView);this._refreshItems()};b.prototype.createToolbar=function(){var e=this;this.toolbar=new _({design:sap.m.ToolbarDesign.Auto});this.setAggregation("toolbar",this.toolbar);this._previousItemButton=new g(this.getId()+"-previousItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://close-command-field",tooltip:r().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(t){var i=e.getSelectedViewIndex();if(i>0){e.setSelectedItem(e._viewItems[i-1])}}});this._nextItemButton=new g(this.getId()+"-nextItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://open-command-field",tooltip:r().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(t){var i=e.getSelectedViewIndex();if(i>=0&&i+1<e._viewItems.length){e.setSelectedItem(e._viewItems[i+1])}}});this._viewGroupSelector=new f({showHeader:false,contentWidth:"20%",placement:sap.m.PlacementType.Top,horizontalScrolling:false,verticalScrolling:false,content:[new u({horizontal:false,vertical:true,content:[this._procedureList=new V({width:"100%",itemPress:function(t){e._clearUI();var i=this.indexOfItem(t.getParameter("item"));e.setSelectedViewGroupIndex(i)}})]})]});this._playButton=new m(this.getId()+"-playButton",{type:sap.m.ButtonType.Transparent,pressed:false,icon:"sap-icon://media-play",visible:true,tooltip:r().getText("STEP_NAV_PLAYMENU_PLAY"),press:function(e){this._setPlayState(e.getSource().getPressed());if(e.getSource().getPressed()){this._playProcedure()}else{this._pauseAnimation()}}.bind(this)});this._stepCount=new v({textAlign:sap.ui.core.TextAlign.Right,level:"H5",titleStyle:"H5"});this._currentGroupTitle=new v({text:r().getText("STEP_NAV_PROCEDURES"),tooltip:r().getText("STEP_NAV_PROCEDURES"),level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentGroupTitle");this._separatorTitle=new v({width:5/1920*100+"%",level:"H5",titleStyle:"H5"});this._currentStepTitle=new v({level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentStepTitle");this._currentGroupTitle.addEventDelegate({ontap:function(){this._viewGroupSelector.openBy(this._currentGroupTitle)}.bind(this)});this._toolbarSpacer=new w;this.toolbar.addContent(this._currentGroupTitle).addContent(this._separatorTitle).addContent(this._currentStepTitle).addContent(new w).addContent(this._stepCount).addContent(this._toolbarSpacer).addContent(this._previousItemButton).addContent(this._playButton).addContent(this._nextItemButton)};b.prototype._setPlayState=function(e){if(this.getAggregation("toolbar")){this._playButton.setPressed(e);if(e){this._playButton.setIcon("sap-icon://media-pause");this._playButton.setTooltip(r().getText("STEP_NAV_PLAYMENU_PAUSE"))}else{this._playButton.setIcon("sap-icon://media-play");this._playButton.setTooltip(r().getText("STEP_NAV_PLAYMENU_PLAY"))}}};b.prototype._createStepDescriptionBoxes=function(){this._stepDescription=new p({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionToolbar=new _({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-up-arrow",press:function(e){this._toggleViewDescription()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionIcon sapVizKitViewGalleryStepDescriptionIconTransform"),new w,this._stepDescriptionOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/landscape-text",press:function(e){this._toggleOrientation()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionOrientationIcon")],layoutData:new h({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionToolbar"),this._stepDescriptionScroll=new u({horizontal:false,vertical:true,content:[this._stepDescriptionText=new c({visible:true}).addStyleClass("sapVizKitViewGalleryStepDescriptionText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionScroll")]}).addStyleClass("sapVizKitViewGalleryStepDescription");this._stepDescription.vitId="VIT-StepDescription";this._stepDescriptionVertical=new l({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionVerticalScroll=new u({horizontal:false,vertical:true,content:[this._stepDescriptionVerticalText=new c({visible:false}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalScroll"),this._stepDescriptionVerticalToolbar=new _({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionVerticalIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-right-arrow",press:function(e){this._toggleViewDescriptionVertical()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalIcon sapVizKitViewGalleryStepDescriptionIconTransform"),this._stepDescriptionVerticalOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/portrait-text",press:function(e){this._toggleOrientation()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalOrientationIcon")],layoutData:new h({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalToolbar")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVertical");this._stepDescriptionVertical.vitId="VIT-StepDescriptionVertical"};b.prototype.adjustStepDescriptionBoxes=function(){if(this._stepDescription.getDomRef()){var e=this.getDomRef().getBoundingClientRect().height;var t=this._stepDescription.getDomRef().id;var i=this._stepDescriptionVertical.getDomRef().id;document.getElementById(t).style.bottom=e+"px";document.getElementById(i).style.bottom=e+"px";var s=this._host.getDomRef().getBoundingClientRect().height;document.getElementById(i).style.height=s-e+"px"}};b.prototype._toggleOrientation=function(){if(this._stepDescriptionToolbar.getVisible()){this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;if(this._stepDescriptionText.getVisible()){this._stepDescriptionVerticalText.setVisible(true)}this._stepDescriptionText.setVisible(false)}else{this._stepDescriptionToolbar.setVisible(true);this._previousOrientationVertical=false;if(this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionText.setVisible(true)}this._stepDescriptionVerticalToolbar.setVisible(false);this._stepDescriptionVerticalText.setVisible(false)}this._stepDescription.rerender();this._stepDescriptionVertical.rerender();if(this._host&&this._host.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes()}};b.prototype._toggleViewDescription=function(){if(!this._stepDescriptionText.getVisible()){this._stepDescriptionText.setVisible(true);this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}else{this._stepDescriptionText.setVisible(false);this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}this._stepDescriptionText.rerender()};b.prototype._toggleViewDescriptionVertical=function(){if(!this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}else{this._stepDescriptionVerticalText.setVisible(false);this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}this._stepDescriptionVerticalText.rerender()};b.prototype._getHBox=function(){return this._hbox};b.prototype._playProcedure=function(){this._manualTimeChange=false;if(this._viewManager){var e=this._getSelectedView();if(!e){var t=this._getViews();if(t&&t.length){e=t[0]}}if(e){this._viewManager.playViewGroup(e,this._getSelectedViewGroup())}}};b.prototype._pauseAnimation=function(){if(this._viewManager){this._viewManager.stopPlayingViewGroup()}};b.prototype.setPlayingAnimation=function(e){this._playingAnimation=e};b.prototype.onSetAnimationPlayer=function(e){this._animationPlayer=e;e.attachTimeChanged(this._onAnimationPlayerTimeChanged,this);e.attachStateChanged(this._onAnimationPlayerStateChanged,this);this._setupAnimationSlider()};b.prototype.onUnsetAnimationPlayer=function(e){e.detachTimeChanged(this._onAnimationPlayerTimeChanged,this);e.detachStateChanged(this._onAnimationPlayerStateChanged,this);this._animationPlayer=null};b.prototype._setupAnimationSlider=function(){var e=this.getAnimationTimeSlider();if(e&&this._animationPlayer){var t=this._getViewAnimationDuration();if(t){e.setMax(t);e.setStep(t/100);e.setValue(this._animationPlayer.getTime())}}};b.prototype._onAnimationPlayerTimeChanged=function(e){var t=e.getParameter("time");var i=this.getAnimationTimeSlider();if(i){i.setValue(t)}};b.prototype._onAnimationPlayerStateChanged=function(e){var t=e.getParameter("playing");this._setPlayState(t)};b.prototype._onProcedureFinished=function(e){this._setPlayState(false)};b.prototype.setScene=function(e){if(e&&e.loaders){for(var t=0;t<e.loaders.length;t++){var i=e.loaders[t];if(i.getMetadata&&i.getMetadata().getName()==="sap.ui.vk.threejs.ContentDeliveryService"){if(this._cdsLoader){this._cdsLoader.detachLoadingFinished(this._handleCdsViewGroupUpdate,this)}this._cdsLoader=i;this._cdsLoader.attachLoadingFinished(this._handleCdsViewGroupUpdate,this);break}else if(i.requestViewGroup){this._loader=i;break}}}if(e==null&&this._cdsLoader){this._cdsLoader.detachLoadingFinished(this._handleCdsViewGroupUpdate,this);this._cdsLoader=null}this._vkScene=e;this._refreshProcedures();this._resetCurrentView()};b.prototype._onViewActivated=function(e,t,i){var s;var n=i.view;var o=this._getViewGroups();if(o&&o.length>0){var r=o[this.getSelectedViewGroupIndex()];if(r&&r.getViewGroupId()!=n.viewGroupId){for(var a=0;a<o.length;a++){if(o[a].getViewGroupId()===n.viewGroupId){for(var l=0;l<o[a].getViews().length;l++){if(o[a].getViews()[l]===n){s=l;this.setSelectedViewGroupIndex(a,s);break}}}}}else{for(var p=0;r&&p<r.getViews().length;p++){if(r.getViews()[p]===n){s=p;this.viewActivated(s,n);break}}}}};b.prototype.onSetHost=function(e){if(e.getContent()){var t=function(t){var i=e.getContent();for(var s=0;s<i.length;s++){if(i[s].vitId==t){return s}}};e.removeContent(t("VIT-StepDescription"));e.removeContent(t("VIT-StepDescriptionVertical"))}this._createStepDescriptionBoxes();e.addContent(this._stepDescription);e.addContent(this._stepDescriptionVertical);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);this._attachAnimationTimeSlider(this.getAnimationTimeSlider())};b.prototype.onUnsetHost=function(e){this._detachAnimationTimeSlider(this.getAnimationTimeSlider())};b.prototype._attachAnimationTimeSlider=function(e){if(!e){return}e.attachChange(this._onSliderValueChange,this);e.attachLiveChange(this._onSliderValueLiveChange,this)};b.prototype._detachAnimationTimeSlider=function(e){if(!e){return}e.detachChange(this._onSliderValueChange,this);e.detachLiveChange(this._onSliderValueLiveChange,this)};b.prototype._onSliderValueLiveChange=function(e){var t=e.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==t){this._animationPlayer.setTime(t)}};b.prototype._onSliderValueChange=function(e){var t=e.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==t){this._animationPlayer.setTime(t)}};b.prototype._refreshProcedures=function(e){if(this.getAggregation("toolbar")){this._procedureList.removeAllItems()}this._modelViews=null;var t=this._getViewGroups();if(t&&t.length>0){this._selectedGroupIndex=0;var i=0;t.forEach(function(t){if(this.getAggregation("toolbar")){this._procedureList.addItem(new sap.ui.core.Item({key:t.getViewGroupId(),text:t.getName()}))}if(e&&t.getViewGroupId()===e){this._selectedGroupIndex=i}i++}.bind(this));this._modelViews=this._getViews();if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(t[this._selectedGroupIndex].getName()).setTooltip(t[this._selectedGroupIndex].getName())}}else if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(r().getText("STEP_NAV_PROCEDURES"))}this._refreshItems()};b.prototype.refresh=function(e){this.setScene(e)};var D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRm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";b.prototype._clearUI=function(){if(this.getAggregation("toolbar")){this._currentStepTitle.setText("");this._separatorTitle.setText("");this._viewGroupSelector.close();this._nextItemButton.setEnabled(false);this._previousItemButton.setEnabled(false);this._stepCount.setText("");if(this._stepDescriptionText){this._stepDescriptionText.setHtmlText("")}if(this._stepDescriptionVerticalText){this._stepDescriptionVerticalText.setHtmlText("")}}if(this.getAggregation("container")){this._hbox.destroyItems()}this._viewItems=[];if(this._stepDescriptionToolbar){this._stepDescriptionToolbar.setVisible(false)}if(this._stepDescriptionVerticalToolbar){this._stepDescriptionVerticalToolbar.setVisible(false)}};b.prototype._refreshItems=function(){this._clearUI();var e=this;if(this._modelViews){var t=function(e){this.setSelectedItem(e.getSource())}.bind(this);this._modelViews.forEach(function(i){var s=true;var n=i.name||i.getName&&i.getName();var o=new a({alt:n,densityAware:false,tooltip:n,viewGallery:this,source:i.thumbnailData||D,press:function(s){o.detachBrowserEvent("mouseenter",function(t){e.startAnimate()});o.setSource(i.thumbnailData||D);clearInterval(s.getSource().interval);t(s)},layoutData:new h({shrinkFactor:0})});var r=function(t,n){var r=t.width/n;var a=t.height;var l=n;var p=a;var c=document.createElement("canvas");var h=c.getContext("2d");var d=[];c.width=l;c.height=p;for(var u=0;u<r;u++){var g=l*u;h.clearRect(0,0,l,p);h.drawImage(t,g,0,l,p,0,0,l,p);d.push(c.toDataURL())}e.startAnimate=function(){if(s){s=false;o.detachBrowserEvent("mouseenter",function(t){e.startAnimate()});var t=0;var i=function(){if(t<r){o.setSource(d[t]);t++}else{o.setSource(d[0]);t=0}};o.interval=setInterval(function(){i()},250)}};o.attachBrowserEvent("mouseenter",function(t){e.startAnimate()});o.attachBrowserEvent("mouseout",function(t){s=true;o.attachBrowserEvent("mouseenter",function(t){e.startAnimate()});clearInterval(o.interval);o.setSource(i.thumbnailData)})};if(i.animatedThumbnailData!==undefined){var l=document.createElement("img");l.onload=function(){r(l,i.tileWidth)};l.src=i.animatedThumbnailData}if(this.getEnableViewReordering()){o.addDragDropConfig(new I({dragStart:function(){e._draggedModelView=i}}));o.getMetadata().dnd.draggable=true}o.data("modelView",i);this._viewItems.push(o);if(this.getAggregation("container")){this._hbox.addItem(o)}if(this._hbox.getItems().length===1){o.data("help-id","vit-view-thumbnail",true)}}.bind(this));this.rerender()}};b.prototype.setSelectedItem=function(e){if(e.getCustomData().length>0){var t=e.getCustomData()[0].getValue();if(this._viewManager){this._viewManager.activateView(t)}}return this};b.prototype.setDescription=function(){if(!this._selectedItem){return}if(!this.getVisible()){this._stepDescription.setVisible(false);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVertical.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);return}if(this._selectedItem.getCustomData().length>0){var e=this._selectedItem.getCustomData()[0].getValue();var t=e.getDescription();if(t){if(this._previousOrientationVertical===false){this._stepDescription.setVisible(true);this._stepDescriptionToolbar.setVisible(true);this._stepDescriptionVerticalToolbar.setVisible(false)}else{this._stepDescriptionVertical.setVisible(true);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true}}else if(this._previousOrientationVertical===true){this._stepDescriptionVertical.setVisible(false)}else{this._stepDescription.setVisible(false);this._previousOrientationVertical=false}if(t!=null){this._stepDescriptionText.setHtmlText(t);this._stepDescriptionVerticalText.setHtmlText(t)}}};b.prototype.viewActivated=function(e){if(this._selectedItem){if(this.getSelectedViewIndex()!==e){this._selectedItem.removeStyleClass("selected")}}this._selectedItem=this._viewItems[e];if(!this._selectedItem){return this}if(this.getAggregation("toolbar")){var t=r().getText("VIEWS_TITLE_WITH_COUNT",[e+1,this._viewItems.length]);this._stepCount.setText(t);var i=this._selectedItem!==this._viewItems[0]&&this._viewItems.length>1;var s=this._selectedItem!==this._viewItems[this._viewItems.length-1]&&this._viewItems.length>1;var n=this._selectedItem.getCustomData().length>0&&this._selectedItem.getCustomData()[0].getValue().getPlaybacks().length>0;this._previousItemButton.setEnabled(i);this._nextItemButton.setEnabled(s);this._playButton.setEnabled(n||s)}this._selectedItem.addStyleClass("selected");if(this._isScrollingNecessary(this._selectedItem.getDomRef(),this._scrollContainer.getDomRef())){this._scrollContainer.scrollToElement(this._selectedItem,500)}if(this._selectedItem.getCustomData().length>0){var o=this._selectedItem.getCustomData()[0].getValue();var a=o.getPlaybacks();var l=this.getAnimationTimeSlider();if(l){if(!a||a.length===0){l.setEnabled(false);l.setValue(0)}else{l.setEnabled(true)}}var p=o.name||o.getName&&o.getName();if(this.getAggregation("toolbar")){this._separatorTitle.setText("/");this._currentStepTitle.setText(p).setTooltip(p)}}this.setDescription();this.fireSelectionChange({item:this._selectedItem});this._setupAnimationSlider();return this};b.prototype.getSelectedItem=function(){return this._selectedItem};b.prototype.getSelectedViewIndex=function(){for(var e=0;e<this._viewItems.length;e++){if(this._viewItems[e]===this.getSelectedItem()){return e}}return-1};b.prototype.setSelectedViewIndex=function(e){if(this._viewItems.length>e){this.setSelectedItem(this._viewItems[e])}};b.prototype.getSelectedViewGroupIndex=function(){return this._selectedGroupIndex};b.prototype.setSelectedViewGroupIndex=function(e,t){var i=this._getViewGroups();if(i&&i.length>e){this._selectedGroupIndex=e;if(t==null){t=0}this._currentGroupTitle.setText(i[e].getName()).setTooltip(i[e].getName());this._separatorTitle.setVisible(true);this._modelViews=this._getViews();if(!this._modelViews||this._modelViews.length===0){var s=i[e].getViewGroupId();var n=i[e].sceneId;var o=this;if(this._loader&&this._loader.requestViewGroup){this._loader.requestViewGroup(n,s,false).then(function(e){o._refreshItems();o.setSelectedViewIndex(t)}).catch(function(e){T.error(e)})}else if(this._cdsLoader){this._cdsLoader.loadViewGroup(n,s).then(function(e){o._refreshItems();o.setSelectedViewIndex(t)})}}else{this._refreshItems();this.setSelectedViewIndex(t)}}};b.prototype._isScrollingNecessary=function(e,t){if(e&&t){var i=e.getBoundingClientRect();return i.left<0||i.right>t.clientWidth}return false};b.prototype._setContent=function(e){if(this._bIsBeingDestroyed){return}var t=e&&e.getMetadata&&e.getMetadata().getName();var i=t==="sap.ui.vk.threejs.Scene"||t==="sap.ui.vk.svg.Scene";this.setScene(i?e:null);if(i&&e.builders){for(var s=0;s<e.builders.length;s++){e.builders[s]._fireThumbnailLoaded=function(e){var t=null;for(var i=0;i<this._viewItems.length;i++){if(this._viewItems[i].data("modelView")==e.modelView){t=this._viewItems[i];break}}if(t){t.setSource(e.modelView.thumbnailData)}}.bind(this)}}this._attachAnimationTimeSlider(this.getAnimationTimeSlider())};b.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);e.attachContentChangesStarted(this._onContentChangesStarted,this);e.attachContentLoadingFinished(this._handleCdsViewGroupUpdate,this);this._setContent(e.getContent())};b.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentChangesStarted(this._onContentChangesStarted,this);e.detachContentLoadingFinished(this._handleCdsViewGroupUpdate,this);e.detachContentReplaced(this._onContentReplaced,this)};b.prototype._onContentChangesStarted=function(e){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setScene(null)};b.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};b.prototype._handleCdsViewGroupUpdate=function(e){var t=e.getParameter("currentViewGroupId");if(this._modelViews&&this._modelViews.length){this._refreshItems()}else{this._refreshProcedures(t)}this._resetCurrentView()};b.prototype._resetCurrentView=function(){if(this._viewManager){var e=this._viewManager.getActiveView();if(e&&this._viewItems){for(var t=0;t<this._viewItems.length;t++){var i=this._viewItems[t];var s=i.getCustomData()[0].getValue();if(s===e){if(this._selectedItem!==i){this.viewActivated(t);break}}}}if(this._selectedGroupIndex!==-1){var n=this._getViewGroups();if(n&&n.length){this._procedureList.setSelectedKey(n[0].getViewGroupId())}}}};return b});
//# sourceMappingURL=ViewGallery.js.map