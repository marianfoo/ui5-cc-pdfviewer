/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../getResourceBundle","../thirdparty/three","./Gizmo","./MoveToolGizmoRenderer","./CoordinateSystem","./GizmoPlacementMode","./AxisColours","../AnimationTrackType","sap/base/assert","sap/base/Log"],function(e,t,i,r,o,a,n,s,l,d){"use strict";var h=i.extend("sap.ui.vk.tools.MoveToolGizmo",{metadata:{library:"sap.ui.vk"}});h.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._createEditingForm(e().getText("TOOL_UNITS_MM"),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3;this._moveDelta=new THREE.Vector3;this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene;var t=new THREE.DirectionalLight(16777215,.5);t.position.set(1,3,2);this._sceneGizmo.add(t);this._sceneGizmo.add(new THREE.AmbientLight(16777215,.5));this._gizmo=new THREE.Group;this._touchAreas=new THREE.Group;this._sceneGizmo.add(this._gizmo);this._coordinateSystem=o.World;this._placementMode=a.Default;this._nodes=[];this._matViewProj=new THREE.Matrix4;this._gizmoSize=96;function r(e,t,i){var r=96,o=1,a=24,n=4,s=48;e.multiplyScalar(1/r);var l=new THREE.MeshLambertMaterial({color:t,transparent:true});var d=new THREE.CylinderBufferGeometry(o,o,r-a,4);var h=(new THREE.Matrix4).makeBasis(new THREE.Vector3(e.y,e.z,e.x),e,new THREE.Vector3(e.z,e.x,e.y));h.setPosition(e.clone().multiplyScalar((r-a)*.5));d.applyMatrix4(h);var c=new THREE.Mesh(d,l);c.matrixAutoUpdate=false;c.userData.color=t;var m=new THREE.CylinderBufferGeometry(0,n,a,12,1);h.setPosition(e.clone().multiplyScalar(r-a*.5));m.applyMatrix4(h);var u=new THREE.Mesh(m,l);u.matrixAutoUpdate=false;c.add(u);var p=new THREE.CylinderGeometry(s*.5,s*.5,s,12,1);p.applyMatrix4(h);var f=new THREE.CylinderGeometry(s*.5,s*.2,s,12,1);h.setPosition(e.clone().multiplyScalar(r*.5));p.merge(f,h);i.add(new THREE.Mesh(p,l));return c}function s(e,t,i){var r=new Float32Array(9);r[e]=r[t+6]=1;r[e+3]=r[t+3]=.5;var o=(new THREE.Vector3).setComponent(e,.333);var a=(new THREE.Vector3).setComponent(t,.333);var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3,o,a,o.clone().add(a));n.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));var s=new THREE.MeshBasicMaterial({color:16776960,opacity:.5,transparent:true,visible:false,side:THREE.DoubleSide});var l=new THREE.Mesh(n,s);l.matrixAutoUpdate=false;l.userData.colors=r;var d=new THREE.BufferGeometry;var h=new Float32Array(9);h[e]=h[e+3]=h[t+3]=h[t+6]=.333;d.setAttribute("position",new THREE.Float32BufferAttribute(h,3));d.setAttribute("color",new THREE.Float32BufferAttribute(r,3));var c=new THREE.Line(d,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));c.matrixAutoUpdate=false;l.add(c);var m=new THREE.Geometry;m.vertices.push(new THREE.Vector3,o,a,o.clone().add(a));m.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(2,1,3));i.add(new THREE.Mesh(m,new THREE.MeshBasicMaterial({side:THREE.DoubleSide})));return l}this._gizmo.add(r(new THREE.Vector3(1,0,0),n.x,this._touchAreas));this._gizmo.add(r(new THREE.Vector3(0,1,0),n.y,this._touchAreas));this._gizmo.add(r(new THREE.Vector3(0,0,1),n.z,this._touchAreas));this._gizmo.add(s(1,2,this._touchAreas));this._gizmo.add(s(2,0,this._touchAreas));this._gizmo.add(s(0,1,this._touchAreas));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var l=new THREE.Geometry;l.vertices.push(new THREE.Vector3,new THREE.Vector3);this._line=new THREE.LineSegments(l,new THREE.LineBasicMaterial);this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line)};h.prototype.hasDomElement=function(){return true};h.prototype.resetValues=function(){this._value.setScalar(0)};h.prototype.setCoordinateSystem=function(e){this._coordinateSystem=e;var t=e===o.Screen;var i=this._gizmo.children,r=this._touchAreas.children;i[2].visible=i[3].visible=i[4].visible=!t;r[2].visible=r[3].visible=r[4].visible=!t;this._axisTitles.children[2].visible=!t;this._gizmoIndex=this._handleIndex=-1};h.prototype.show=function(e,t){this._viewport=e;this._tool=t;this._nodes.length=0;this._updateSelection(e._viewStateManager);var i=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:i},true)};h.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false)};h.prototype.getGizmoCount=function(){if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){return this._nodes.length}else{return this._nodes.length>0?1:0}};h.prototype.getTouchObject=function(e){if(this._nodes.length===0){return null}this._updateGizmoObjectTransformation(this._touchAreas,e,true);return this._touchAreas};var c=[1,2,4,6,5,3];h.prototype.highlightHandle=function(e,t){var i;for(i=0;i<3;i++){var r=this._gizmo.children[i];var o=c[e]&1<<i;var a=o?16776960:r.userData.color;r.material.color.setHex(a);r.material.opacity=o||t?1:.35;r.children[0].material.color.setHex(a);r.children[0].material.opacity=o||t?1:.35;var n=this._axisTitles.children[i];n.material.color.setHex(a);n.material.opacity=o||t?1:.35}for(i=3;i<6;i++){var s=this._gizmo.children[i];s.material.visible=i===e;var l=s.children[0].geometry.attributes.color;l.copyArray(i===e?[1,1,0,1,1,0,1,1,0]:s.userData.colors);l.needsUpdate=true;s.children[0].material.opacity=i===e||t?1:.35}};h.prototype.selectHandle=function(e,t){this._gizmoIndex=t;this._handleIndex=e;if(this._tool.getAutoResetValues()){this.resetValues()}this._viewport.setShouldRenderFrame()};h.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._moveDelta.setScalar(0);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(e){var t=e.node;e.matOrigin=t.matrixWorld.clone();e.originLocal=t.position.clone();e.origin=(new THREE.Vector3).setFromMatrixPosition(t.matrixWorld);if(t.parent){e.matParentInv=(new THREE.Matrix4).getInverse(t.parent.matrixWorld)}else{e.matParentInv=new THREE.Matrix4}})};h.prototype._printEventInfo=function(e,t,i,r,o){d.debug(e+" is fired:"+" x = "+t+"; y = "+i+"; z = "+r);o.forEach(function(e){d.debug("Node: "+e.node.name);if(e.offsetToRest){d.debug("offsetToRest: [ "+e.offsetToRest[0]+", "+e.offsetToRest[1]+", "+e.offsetToRest[2]+" ] ")}else{d.debug("offsetToRest: null")}if(e.offsetToPrevious){d.debug("offsetToPrevious: [ "+e.offsetToPrevious[0]+", "+e.offsetToPrevious[1]+", "+e.offsetToPrevious[2]+" ] ")}else{d.debug("offsetToPrevious: null")}if(e.absolute){d.debug("absolute: [ "+e.absolute[0]+", "+e.absolute[1]+", "+e.absolute[2]+" ] ")}else{d.debug("absolute: null")}if(e.world){d.debug("world: [ "+e.world[0]+", "+e.world[1]+", "+e.world[2]+" ] ")}else{d.debug("world: null")}if(e.restDifference){d.debug("restDifference: [ "+e.restDifference[0]+", "+e.restDifference[1]+", "+e.restDifference[2]+" ] ")}else{d.debug("restDifference: null")}if(e.restDifferenceInCoordinates){d.debug("restDifferenceInCoordinates: [ "+e.restDifferenceInCoordinates[0]+", "+e.restDifferenceInCoordinates[1]+", "+e.restDifferenceInCoordinates[2]+" ] ")}else{d.debug("restDifferenceInCoordinates: null")}})};h.prototype._getOffsetToRestInCoordinateSystem=function(e,t,i){if(i===o.World){return t.toArray()}else if(i===o.Custom){var r=(new THREE.Matrix4).extractRotation(this._gizmo.matrixWorld);var a=(new THREE.Matrix4).getInverse(r);return t.clone().applyMatrix4(a).toArray()}else if(i===o.Local){var n=(new THREE.Matrix4).extractRotation(e.matrixWorld);var s=(new THREE.Matrix4).getInverse(n);return t.clone().applyMatrix4(s).toArray()}else if(i===o.Screen){var l=this._viewport.getRenderer().getSize(new THREE.Vector2);var d=this._viewport.getCamera().getCameraRef();var h=(new THREE.Vector4).copy(this._gizmo.position).applyMatrix4(this._matViewProj);var c=(new THREE.Matrix3).setFromMatrix4(d.matrixWorld);var m=(new THREE.Matrix3).getInverse(c);var u=t.clone().applyMatrix3(m);var p=2*h.w/(d.projectionMatrix.elements[0]*l.width);var f=2*h.w/(d.projectionMatrix.elements[5]*l.height);return[u.x/p,u.y/f,0]}};h.prototype._getNodesProperties=function(){var e=[];this._nodes.forEach(function(t){var i=t.node;var r={};r.node=i;var a=this._getEffectiveParent(i);var n=new THREE.Matrix4;if(a===i.parent){var l=this._viewport._viewStateManager.getRelativeTransformation(i);r.offsetToRestInParent=l.translation.slice();if(i.parent){n=(new THREE.Matrix4).extractRotation(i.parent.matrixWorld)}r.offsetToPreviousInParent=r.offsetToRestInParent.slice();var d;if(this._playback){d=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(i,s.Translate,this._playback);if(d){r.offsetToPreviousInParent[0]-=d[0];r.offsetToPreviousInParent[1]-=d[1];r.offsetToPreviousInParent[2]-=d[2]}}var h=this._viewport._viewStateManager.getRestTransformation(i);var c=[h.translation[0],h.translation[1],h.translation[2]];if(d){c[0]+=d[0];c[1]+=d[1];c[2]+=d[2]}var m=new THREE.Quaternion;var u=new THREE.Vector3;var p=new THREE.Vector3;i.matrix.decompose(p,m,u);var f=(new THREE.Matrix4).makeTranslation(-c[0],-c[1],-c[2]);var _=(new THREE.Matrix4).makeTranslation(-h.translation[0],-h.translation[1],-h.translation[2]);if(u.x===0||u.y===0||u.z===0){u.x=1;u.y=1;u.z=1}var v=(new THREE.Matrix4).makeScale(1/u.x,1/u.y,1/u.z);var E=(new THREE.Matrix4).makeRotationFromQuaternion(m.inverse());var g=v.clone().multiply(E).multiply(f).multiply(i.matrix);g.decompose(p,m,u);r.offsetToPrevious=p.toArray();var x=v.multiply(E).multiply(_).multiply(i.matrix);x.decompose(p,m,u);r.offsetToRest=p.toArray()}else{if(i.userData.skipUpdateJointNode){this._viewport._viewStateManager._setJointNodeOffsets(i,s.Translate)}if(i.userData&&i.userData.offsetTranslation){r.offsetToRestInParent=i.userData.offsetTranslation.slice()}else{r.offsetToRestInParent=[0,0,0]}r.offsetToPreviousInParent=r.offsetToRestInParent.slice();if(i.userData.skipUpdateJointNode){i.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();i.userData.skipUpdateJointNode=true}var y=this._viewport._viewStateManager.getRestTransformationUsingJoint(i);var w=new THREE.Vector3;var T=new THREE.Vector3(y.scale[0],y.scale[1],y.scale[2]);var R=new THREE.Quaternion(y.quaternion[0],y.quaternion[1],y.quaternion[2],y.quaternion[3]);if(i.userData.offsetScale){T.x*=i.userData.offsetScale[0];T.y*=i.userData.offsetScale[1];T.z*=i.userData.offsetScale[2]}if(i.userData.offsetQuaternion){var z=new THREE.Quaternion(i.userData.offsetQuaternion[0],i.userData.offsetQuaternion[1],i.userData.offsetQuaternion[2],i.userData.offsetQuaternion[3]);R.multiply(z)}var M=(new THREE.Matrix4).makeRotationFromQuaternion(R);var H=(new THREE.Matrix4).makeTranslation(y.translation[0],y.translation[1],y.translation[2]);var S=a.matrixWorld.clone().multiply(H).multiply(M).scale(T);var b=(new THREE.Matrix4).getInverse(S).multiply(i.matrixWorld);b.decompose(w,R,T);r.offsetToPrevious=w.toArray();r.offsetToRest=w.toArray()}var P=this._viewport._viewStateManager.getTransformation(i);r.absolute=[P.translation[0],P.translation[1],P.translation[2]];var I=this._viewport._viewStateManager.getTransformationWorld(i);r.world=I.translation;var D;if(this._nodeUserDataMap){D=this._nodeUserDataMap.get(i)}if(D&&D.initialTranslation){r.restDifference=[P.translation[0]-D.initialTranslation[0],P.translation[1]-D.initialTranslation[1],P.translation[2]-D.initialTranslation[2]];if(this._coordinateSystem===o.Parent){r.restDifferenceInCoordinates=r.restDifference.slice()}else{var V=new THREE.Vector3(r.restDifference[0],r.restDifference[1],r.restDifference[2]).applyMatrix4(n);r.restDifferenceInCoordinates=this._getOffsetToRestInCoordinateSystem(i,V,this._coordinateSystem)}}e.push(r)}.bind(this));return e};h.prototype.endGesture=function(){this._line.visible=false;var e=this._getNodesProperties();var t=this._moveDelta.clone();if(this._coordinateSystem===o.Custom){var i=(new THREE.Matrix4).extractRotation(this._gizmo.matrixWorld);var r=(new THREE.Matrix4).getInverse(i);t.applyMatrix4(r)}delete this._beginValue;this._nodes.forEach(function(e){var t=e.node;if(t.userData){delete t.userData.skipUpdateJointNode}this._viewport._viewStateManager._setJointNodeOffsets(t,s.Translate)}.bind(this));this._tool.fireMoved({x:t.x,y:t.y,z:t.z,nodesProperties:e});this._printEventInfo("Event 'moved'",t.x,t.y,t.z,e)};h.prototype._setOffset=function(e,t){if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){var i=this._nodes[t];var r=i.node;var a=this._getEffectiveParent(r);if(this._coordinateSystem===o.Parent&&a){r=a}var n=(new THREE.Matrix4).getInverse(r.matrixWorld);var s=(new THREE.Vector3).setFromMatrixScale(r.matrixWorld);var l=i.origin.clone().applyMatrix4(n);e=i.origin.clone().add(e).applyMatrix4(n).sub(l).multiply(s)}else if(this._coordinateSystem===o.Screen){var d=this._viewport.getRenderer().getSize(new THREE.Vector2);var h=this._gizmo.position.clone().applyMatrix4(this._matViewProj);var c=this._gizmo.position.clone().add(e).applyMatrix4(this._matViewProj);e.set(Math.round((c.x-h.x)*.5*d.width),Math.round((c.y-h.y)*.5*d.height),0)}var m=this._getNodesProperties();var u=e.clone();if(this._coordinateSystem===o.Custom){var p=(new THREE.Matrix4).extractRotation(this._gizmo.matrixWorld);var f=(new THREE.Matrix4).getInverse(p);u.applyMatrix4(f)}if(this._tool.fireEvent("moving",{x:u.x,y:u.y,z:u.z,nodesProperties:m},true)){this._printEventInfo("Event 'moving'",u.x,u.y,u.z,m);this._move(e);if(this._coordinateSystem===o.Screen){e.set((new THREE.Vector3).setFromMatrixColumn(this._matOrigin,0).normalize().dot(e),(new THREE.Vector3).setFromMatrixColumn(this._matOrigin,1).normalize().dot(e),0)}else if(this._coordinateSystem===o.Custom){var _=this._getAnchorPoint();if(_){var v=(new THREE.Matrix4).getInverse(_.matrixWorld);var E=(new THREE.Vector3).setFromMatrixScale(_.matrixWorld);var g=_.position.clone().applyMatrix4(v);e.copy(_.position.clone().add(e).applyMatrix4(v).sub(g).multiply(E))}}this._line.geometry.vertices[0].setScalar(0).sub(e);this._line.geometry.verticesNeedUpdate=true;this._line.geometry.computeBoundingBox();e.set(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));e.multiplyScalar(1/Math.max(e.x,e.y,e.z));this._line.material.color.setRGB(e.x,e.y,e.z);this._line.visible=true}};h.prototype._move=function(e){this._value.addVectors(this._beginValue,e);this._moveDelta.copy(e);this._nodes.forEach(function(e){var t=e.node;if(!t.userData){t.userData={}}t.userData.skipUpdateJointNode=true});if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){this._nodes.forEach(function(t){var i=t.node;var r=this._getEffectiveParent(i);var a=null;if(this._coordinateSystem===o.Parent&&r){a=this._extractBasis(r.matrixWorld)}else{a=this._extractBasis(i.matrixWorld)}var n=t.origin.clone();n.add(a[0].multiplyScalar(e.x)).add(a[1].multiplyScalar(e.y)).add(a[2].multiplyScalar(e.z));i.matrixWorld.setPosition(n);i.matrix.multiplyMatrices(t.matParentInv,i.matrixWorld);i.position.setFromMatrixPosition(i.matrix);i.matrixWorldNeedsUpdate=true}.bind(this))}else{if(this._coordinateSystem===o.Screen){var t=this._viewport.getRenderer().getSize(new THREE.Vector2);var i=this._viewport.getCamera().getCameraRef();var r=(new THREE.Vector4).copy(this._gizmo.position).applyMatrix4(this._matViewProj);var a=e.x*2*r.w/(i.projectionMatrix.elements[0]*t.width);var n=e.y*2*r.w/(i.projectionMatrix.elements[5]*t.height);e.setFromMatrixColumn(i.matrixWorld,0).multiplyScalar(a);e.add((new THREE.Vector3).setFromMatrixColumn(i.matrixWorld,1).multiplyScalar(n))}this._gizmo.position.setFromMatrixPosition(this._matOrigin).add(e);if(this._coordinateSystem===o.Custom){var s=this._getAnchorPoint();if(s){s.position.copy(this._gizmo.position)}}this._nodes.forEach(function(t){if(!t.ignore){var i=t.node;i.matrixWorld.setPosition(t.origin.clone().add(e));i.matrix.multiplyMatrices(t.matParentInv,i.matrixWorld);i.position.setFromMatrixPosition(i.matrix);i.matrixWorldNeedsUpdate=true}})}this._viewport.setShouldRenderFrame()};h.prototype.move=function(e,t,i){this.beginGesture();if(this._coordinateSystem===o.Custom){var r=new THREE.Vector3(e,t,i);var a=(new THREE.Matrix4).extractRotation(this._gizmo.matrixWorld);r.applyMatrix4(a);e=r.x;t=r.y;i=r.z}this._move(new THREE.Vector3(e,t,i||0))};h.prototype.getValue=function(){return this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3?this._value.getComponent(this._handleIndex):0};h.prototype.setValue=function(e){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){this.beginGesture();this._move((new THREE.Vector3).setComponent(this._handleIndex,e-this._value.getComponent(this._handleIndex)));this.endGesture()}};h.prototype.expandBoundingBox=function(e){if(this._viewport){this._expandBoundingBox(e,this._viewport.getCamera().getCameraRef(),true)}};h.prototype._updateSelection=function(e){i.prototype._updateSelection.call(this,e);if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(e,this._viewport)}};h.prototype.handleSelectionChanged=function(e){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);var t=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:t},true);this._gizmoIndex=this._handleIndex=-1}};h.prototype._getSelectionCenter=function(e){i.prototype._getSelectionCenter.apply(this,arguments);var t=this;function r(e,t,i,r){var o=i/2;var a=r/2;e.project(t);e.x=e.x*o+o;e.y=-(e.y*a)+a;return e}function o(e,t,i,r){var o=i/2;var a=r/2;e.x=(e.x-o)/o;e.y=-(e.y-a)/a;e.unproject(t);return e}function n(e,i,r){var a=new THREE.Vector3(t._gizmoSize,t._gizmoSize,0);var n=new THREE.Vector3(i-t._gizmoSize,t._gizmoSize,0);var s=new THREE.Vector3(i-t._gizmoSize,r-t._gizmoSize,0);var l=new THREE.Vector3(t._gizmoSize,r-t._gizmoSize,0);var d=[o(a,e,i,r),o(n,e,i,r),o(s,e,i,r),o(l,e,i,r)];return d[0].add(d[1]).add(d[2]).add(d[3]).multiplyScalar(.25)}if(this._placementMode===a.OnScreen){var s=this._viewport.getDomRef().getBoundingClientRect();var l=s.width;var d=s.height;var h=this._viewport.getCamera().getCameraRef();var c=r(e.clone(),h,l,d);var m=c.clone();var u=[m.x<this._gizmoSize&&m.setX(t._gizmoSize)||m.x>l-this._gizmoSize&&m.setX(l-t._gizmoSize),m.y<this._gizmoSize&&m.setY(t._gizmoSize)||m.y>d-this._gizmoSize&&m.setY(d-t._gizmoSize)].some(function(e){return e!==false})&&e.copy(o(m,h,l,d));return c.z>1&&e.copy(n(h,l,d))||u||e}else if(this._placementMode===a.ObjectCenter&&this._nodes.length===1){var p=new THREE.Vector3;if(this._nodes[0].node.userData.boundingBox){this._nodes[0].node.userData.boundingBox.getCenter(p)}else{var f=new THREE.Box3;f.expandByObject(this._nodes[0].node);f.getCenter(p)}e.copy(p.applyMatrix4(this._nodes[0].node.matrixWorld))}};h.prototype._updateGizmoTransformation=function(e,t){var i=this._updateGizmoObjectTransformation(this._gizmo,e,true);this._updateAxisTitles(this._axisTitles,this._gizmo,t,this._gizmoSize+18,i);this._line.scale.setScalar(1/(this._gizmoSize*i))};h.prototype._getEditingFormPosition=function(){var e=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex,true);var t=(new THREE.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return t.clone().multiplyScalar((this._gizmoSize+18)*e).add(this._gizmo.position).applyMatrix4(this._matViewProj)};h.prototype.render=function(){l(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var e=this._viewport.getRenderer(),t=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);e.clearDepth();for(var i=0,r=this.getGizmoCount();i<r;i++){this._updateGizmoTransformation(i,t);e.render(this._sceneGizmo,t)}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex)};return h});
//# sourceMappingURL=MoveToolGizmo.js.map