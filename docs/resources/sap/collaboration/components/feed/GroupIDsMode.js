/*
* ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
*/
sap.ui.define(["sap/base/Log","sap/base/util/isEmptyObject","sap/ui/thirdparty/jquery","./Mode","sap/collaboration/components/utils/PendingRequestsUtil"],function(e,t,jQuery,o,r){"use strict";var i=o.extend("sap.collaboration.components.feed.GroupIDsMode",{constructor:function(e){o.apply(this,[e]);this._oPendingRequestsUtil=new r;this._iOpenGroupRequests;this._aGroupsToLoad;this.oResult;this._oList.setModel(this._oViewDataModel)}});i.prototype.start=function(e){if(!this._oCommonUtil.isArrayOfStrings(e)){var t="The feedSources' data object is invalid.";this._oFeedController.logError(t);throw new Error(t)}if(e.length===0){this._oFeedController.disableGroupFeed();return}e=e.filter(function(t,o){return e.indexOf(t)===o&&t.trim()!==""});this._oViewDataModel.setProperty("/groups",[]);this._oViewDataModel.setProperty("/groupSelected/Id",undefined);this._iOpenGroupRequests=0;this._aGroupsToLoad=jQuery.merge([],e);this._oList.bindItems({path:"/groups",template:this._oListItemTemplate});this._oGroupSelectPopover.setBusyIndicatorDelay(0).setBusy(true);this._fillGroupInfo()};i.prototype.onBatchCompleted=function(e){this._oJamModel.setUseBatch(false);if(this._iOpenGroupRequests===0){if(this._oGroupSelectPopover!==undefined){this._oGroupSelectPopover.setBusy(false)}}};i.prototype.stop=function(){this._oPendingRequestsUtil.abortAll()};i.prototype.getAddPostPath=function(){var e=this._oViewDataModel.getProperty("/groupSelected/Id");return"/Groups('"+e+"')/FeedEntries"};i.prototype.displayFeedSourceSelectorPopover=function(e){this._oGroupSelectPopover.openBy(e)};i.prototype.onGroupSelected=function(e){var t=e.getSource().getSelectedItem().getBindingContext().getObject();this._oViewDataModel.setProperty("/groupSelected",t);this._oViewDataModel.setProperty("/feedEndpoint","/Groups('"+t.Id+"')/FeedEntries");this._oGroupSelectPopover.close()};i.prototype._fillGroupInfo=function(){var o=10;var r=0;var i=0;var s=0;var a=20;this._oJamModel.setUseBatch(true);var n="$filter=Id eq '";for(var p=0,u=this._aGroupsToLoad.length;p<u;p++){if(!(p%a==0)){n=n.concat(" or Id eq '"+this._aGroupsToLoad[p].replace(/'/g,"''")+"'")}else{n=n.concat(this._aGroupsToLoad[p].replace(/'/g,"''")+"'")}s++;if(s===a||p+1===u){this._iOpenGroupRequests++;var d;this._loadGroups(n,r).done(function(o,r){d=this._oCommonUtil.getODataResult(o);if(!t(d)){if(d.length!=undefined){var i=this._aGroupsToLoad.indexOf(d[0].Id);for(var s=0,a=d.length;s<a;s++){this._oViewDataModel.setProperty("/groups/"+i,d[s]);i++}}else{this._oViewDataModel.setProperty("/groups/"+this._aGroupsToLoad.indexOf(d.Id),d)}}this._iOpenGroupRequests--;if(this._iOpenGroupRequests===0){if(this._oViewDataModel.getProperty("/groups/").length===0){this._oFeedController.disableGroupFeed();e.warning("No group information was retrieved for the current user.")}else{this._oFeedController.enableGroupFeed();var n=this._oViewDataModel.getProperty("/groups/");n=n.filter(function(e){return e!==undefined&&e!==null});this._oViewDataModel.setProperty("/groups/",n);this._oViewDataModel.setProperty("/groupSelected",n[0]);this._oViewDataModel.setProperty("/feedEndpoint","/Groups('"+n[0].Id+"')/FeedEntries")}}}.bind(this));i++;s=0;n="$filter=Id eq '"}if(i==o){r++;i=0}}};i.prototype._loadGroups=function(e,t){if(!this.isJamServiceAvailable()){return}var o=this;var r=jQuery.Deferred();var i="/Groups/";var s={urlParameters:e+"&$select=Id,Name,WebURL",success:function(e,t){r.resolveWith(o,[e,t])},error:function(e){r.rejectWith(o,[e]);o._oFeedController.logError("The group information was not retrieved.")},batchGroupId:t};var a=this._oJamModel.read(i,s);this._oPendingRequestsUtil.add(a);var n=r.promise(a);n.always(function(){this._oPendingRequestsUtil.remove(a)});return n};return i});
//# sourceMappingURL=GroupIDsMode.js.map