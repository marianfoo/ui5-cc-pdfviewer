/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./SearchUrlParserInav2","./SearchHelper","./i18n","sap/m/MessageBox"],function(e,r,t,a){function i(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function n(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}}function s(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function o(e,r,t){if(r)s(e.prototype,r);if(t)s(e,t);Object.defineProperty(e,"prototype",{writable:false});return e}var l=i(e);var u=i(t);var c=a["Icon"];function f(e,r,t){if(t){return r?r(e):e}if(!e||!e.then){e=Promise.resolve(e)}return r?e.then(r):e}function d(e,r,t){if(t){return r?r(e()):e()}try{var a=Promise.resolve(e());return r?a.then(r):a}catch(e){return Promise.reject(e)}}var m=function(){function e(r){n(this,e);this.model=r.model;this.urlParserInav2=new l(r)}o(e,[{key:"parse",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var a=this;return d(function(){if(!a.model.config.isSearchUrl(r.getHashFromUrl())){return Promise.resolve(undefined)}return r.hasher.hasChanged()?f(a.model.initBusinessObjSearch(),function(){var e=r.getUrlParameters();if($.isEmptyObject(e)){return undefined}if(e.datasource||e.searchterm){if(!e.datasource||a.isJson(e.datasource)){return a.urlParserInav2.parseUrlParameters(e)}}e=a.model.config.parseSearchUrlParameters(e);if(e.datasource&&!a.isJson(e.datasource)&&e.searchterm){a.parseSimplifiedUrlParameters(e)}else{a.parseUrlParameters(e)}a.model.setProperty("/searchTermPlaceholder",a.model.calculatePlaceholder());a.model.calculateSearchButtonStatus();if(t){a.model._firePerspectiveQuery({deserialization:true})}}):Promise.resolve(undefined)})}},{key:"isJson",value:function e(r){return r.indexOf("{")>=0&&r.indexOf("}")>=0}},{key:"parseSimplifiedUrlParameters",value:function e(r){if(r.top){var t=parseInt(r.top,10);this.model.setTop(t,false)}var a=this.model.sinaNext.createFilter();a.setSearchTerm(r.searchterm);var i=this.model.sinaNext.getDataSource(r.datasource);if(!i){i=this.model.sinaNext.allDataSource}a.setDataSource(i);this.model.setProperty("/uiFilter",a);this.model.setDataSource(a.dataSource,false,false)}},{key:"parseUrlParameters",value:function e(r){if(r.top){var t=parseInt(r.top,10);this.model.setTop(t,false)}var i;if(r.filter){var n=JSON.parse(r.filter);try{i=this.model.sinaNext.parseFilterFromJson(n)}catch(e){i=this.model.sinaNext.createFilter();if(n.searchTerm){i.setSearchTerm(n.searchTerm)}a.show(u.getText("searchUrlParsingErrorLong")+"\n("+e.toString()+")",{icon:c.ERROR,title:u.getText("searchUrlParsingError"),actions:["OK"]})}this.model.setProperty("/uiFilter",i);this.model.setDataSource(i.dataSource,false,false)}}},{key:"render",value:function e(){return this.renderFromParameters(this.model.getTop(),this.model.getProperty("/uiFilter"),true)}},{key:"renderFromParameters",value:function e(r,t,a){var i={top:r,filter:a?encodeURIComponent(JSON.stringify(t.toJson())):JSON.stringify(t.toJson())};return this.model.config.renderSearchUrl(i)}}]);return e}();return m})})();
//# sourceMappingURL=SearchUrlParser.js.map