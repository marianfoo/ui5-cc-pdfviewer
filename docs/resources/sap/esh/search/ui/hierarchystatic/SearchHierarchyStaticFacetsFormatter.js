/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./SearchHierarchyStaticFacet"],function(e){function t(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function a(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var n=t(e);function u(){}function o(e,t){if(!t){return e&&e.then?e.then(u):Promise.resolve()}}function c(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}function f(e,t){var r=e();if(r&&r.then){return r.then(t)}return t(r)}function s(e,t,r){if(r){return t?t(e()):e()}try{var i=Promise.resolve(e());return t?i.then(t):i}catch(e){return Promise.reject(e)}}var h=function(){function e(t){r(this,e);this.model=t;this.facetMap={}}a(e,[{key:"getHierarchyDefinitionDataSource",value:function e(t){var r=this.model.sinaNext.dataSources;for(var i=0;i<r.length;++i){var a=r[i];if(a.type!==this.model.sinaNext.DataSourceType.BusinessObject){continue}if(!a.isHierarchyDefinition){continue}if(t===a.hierarchyName){return a}}}},{key:"getFacetAttributes",value:function e(t){var r=t.query.filter.dataSource.attributesMetadata;var i=[];for(var a=0;a<r.length;++a){var n=r[a];if(!n.isHierarchy){continue}if(n.hierarchyDisplayType!==t.sina.HierarchyDisplayType.StaticHierarchyFacet){continue}var u=this.getHierarchyDefinitionDataSource(n.hierarchyName);if(!u){continue}i.push({attributeId:n.id,dataSource:u})}return i}},{key:"getFacet",value:function e(t,r,i,a){var u=this;return s(function(){var e=u.facetMap[i.attributeId];return c(f(function(){if(!e){var a=t.query.filter.dataSource.getAttributeMetadata(i.attributeId);e=new n({model:r,attributeId:i.attributeId,dataSource:i.dataSource,filter:r.getProperty("/uiFilter"),title:a.label});u.facetMap[i.attributeId]=e;return o(e.initAsync())}},function(){e.position=a;e.filter=r.getProperty("/uiFilter");e.updateNodesFromHierarchyNodePaths(t.hierarchyNodePaths);return c(e.mixinFilterNodes(),function(){return e})}))})}},{key:"getFacets",value:function e(t){if(!this.model.config.FF_staticHierarchyFacets){return Promise.resolve([])}var r=this.getFacetAttributes(t);var i=[];for(var a=0;a<r.length;++a){var n=r[a];var u=this.getFacet(t,this.model,n,100+a);i.push(u)}return Promise.all(i)}},{key:"destroy",value:function e(){for(var t in this.facetMap){var r=this.facetMap[t];r["delete"]()}this.facetMap={}}},{key:"handleDataSourceChanged",value:function e(){this.destroy()}}]);return e}();return h})})();
//# sourceMappingURL=SearchHierarchyStaticFacetsFormatter.js.map