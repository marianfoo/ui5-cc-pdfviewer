/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/library","sap/ui/layout/HorizontalLayout","sap/ui/core/Control","sap/ui/vk/MapContainer","sap/ui/vk/ContainerContent","sap/ui/vbm/GeoMap","sap/ui/vbm/Container","sap/ui/vbm/Containers","sap/ui/vbm/Spot","sap/ui/vbm/Spots"],function(t,e,i,n,a,o,r,s,p,l,h,c){function m(t){"@babel/helpers - typeof";return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}var u=i["ButtonType"];var f=a.extend("sap.esh.search.ui.controls.SearchResultMap",{renderer:{apiVersion:2,render:function t(e,i){i.loadObjects();e.openStart("div",i);e["class"]("sapUshellSearchResultMap");e.openEnd();if(i.mapContainer){e.renderControl(i.myMapContainer)}else{e.renderControl(i.myMap)}e.close("div")}},metadata:{aggregations:{_map:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}},init:function t(){var e={MapProvider:[{name:"OPENSTREETMAP",type:"",description:"",tileX:"256",tileY:"256",maxLOD:"19",copyright:"Â© openstreetmap",Source:[{id:"s1",url:"http://a.tile.openstreetmap.org/{LOD}/{X}/{Y}.png"},{id:"s2",url:"http://b.tile.openstreetmap.org/{LOD}/{X}/{Y}.png"},{id:"s3",url:"http://c.tile.openstreetmap.org/{LOD}/{X}/{Y}.png"}]}],MapLayerStacks:[{name:"DEFAULT",MapLayer:{name:"Open Street Map Layer",refMapProvider:"OPENSTREETMAP",opacity:"1",colBkgnd:"RGB(255,255,255)"}}]};try{this.mapContainer=new o;this.containerContent=new r}catch(t){}this.geoMap=new s(this.getId()+"-sapUshellSearchGeoMap",{legendVisible:false,scaleVisible:false,refMapLayerStack:"DEFAULT",mapConfiguration:{parts:[{path:"/config/mapProvider"}],formatter:function t(i){if(i!==undefined&&m(i)==="object"&&i.name&&i.name.length>0){e.MapProvider.push(i);e.MapLayerStacks[0].MapLayer.refMapProvider=i.name}return e}}});if(this.mapContainer&&this.containerContent){var i=new r("",{content:this.geoMap});this.myMapContainer=new o("",{content:[i],showRectangularZoom:true,showHome:true,showFullScreen:false,showSettings:false,showSelection:false});this.myMap=this.myMapContainer.getContent()[0].getAggregation("content");this.setAggregation("_map",this.myMapContainer)}else{this.setAggregation("_map",this.geoMap);this.myMap=this.getAggregation("_map")}},deg2rad:function t(e){return Math.PI*e/180},getSpotList:function t(){var i=new l;var a=this.getModel().getProperty("boResults");var o=0;var r,s,h,c,m,f,g,d,y,L,v;for(var M=0;M<a.length;M++){r=a[M];s={};if(!r.geoJson){continue}if(typeof r.geoJson.value==="string"){s=JSON.parse(r.geoJson.value)}else{s.coordinates=r.geoJson.value.coordinates}h=r.geoJson.label;if(h==="LOC_4326"||h==="LOCATION"||h===undefined){h=r.title}if(h==="LOC_4326"||h==="LOCATION"||h===undefined){for(var b=0;b<r.itemattributes.length;b++){if(r.itemattributes[b].isTitle===true){h=r.itemattributes[b].value;break}}}if(h===undefined||typeof h!=="string"){h="unlabeled location"}else{h=h.replace(/<[^>]*>/g,"")}c=s.coordinates;if(!c||c.length===0){continue}m=c[0];f=c[1];if(isNaN(f)||isNaN(m)){continue}this.iNrLocations++;if(this.iNrLocations===1){d=m;y=m;L=f;v=f}else{if(m<d){d=m}if(m>y){y=m}if(f<L){L=f}if(f>v){v=f}}this.minLon=d;this.maxLon=y;this.minLat=L;this.maxLat=v;var w=new e({text:h});var C=new e({icon:"sap-icon://map",type:u.Emphasized});var S=new n({content:[C,w]});g=new p("",{position:m+";"+f+";0",item:S,alignment:"6"});i.addItem(g)}this.iNrLocations=o;if(o===0){i=this.getSpotList2()}return i},getSpotList2:function t(){var i=this.getModel().getProperty("origBoResults").elements;var a=new l;var o=0;var r,s,h,c,m,f,g;var d,y,L,v;var M=0;for(var b in i){if(!Object.prototype.hasOwnProperty.call(i,b)){continue}r=i[b];if(!r.LOC_4326){continue}s=r.LOC_4326;for(var w in r){if(!Object.prototype.hasOwnProperty.call(r,w)){continue}var C=r[w];h="";var S=false;if(C.$$MetaData$$){var x=C.$$MetaData$$.presentationUsage;if(x&&typeof x.length!=="undefined"){for(var O=0;O<x.length;O++){if(x[O]=="Title"){h=C.value;h=h.replace(/<[^>]*>/g,"");S=true;break}}}}if(S){break}}c=null;try{c=JSON.parse(s.value).coordinates}catch(t){}if(!c||c.length===0){continue}this.iNrLocations++;m=c[0];f=c[1];if(isNaN(f)||isNaN(m)){continue}M++;if(M===1){d=m;y=m;L=f;v=f}else{if(m<d){d=m}if(m>y){y=m}if(f<L){L=f}if(f>v){v=f}}this.minLon=d;this.maxLon=y;this.minLat=L;this.maxLat=v;var N=new e({text:h});var E=new e({icon:"sap-icon://map",type:u.Emphasized});var P=new n({content:[E,N]});g=new p("",{position:m+";"+f+";0",item:P,alignment:"6"});a.addItem(g)}this.iNrLocations=o;return a},loadObjects:function e(){var i=this.getSpotList();t.debug("++++++");t.debug("number of locations: "+this.iNrLocations);this.myMap.removeAllVos();this.myMap.addVo(i);var n=this.getModel().getProperty("config").parseUrlParameters();for(var a in n){if(a==="box"&&n[a]!=="false"){this.showBoundariesAndCenter()}}},setVisualFrame:function t(){var e={minLon:this.minLon*.5,maxLon:this.maxLon*1.2,minLat:this.minLat*.8,maxLat:this.maxLat*1.2,minLOD:1,maxLOD:10,maxFraction:.5};this.myMap.setVisualFrame(e)},showBoundariesAndCenter:function t(){var e=new c({items:[new h("",{type:"Error",text:"center",position:this.centerLon+" ;  "+this.centerLat+";0"}),new h("",{type:"Error",text:"TLeft",position:this.minLon+" ;  "+this.maxLat+";0"}),new h({type:"Error",text:"TRight",position:this.maxLon+" ;  "+this.maxLat+";0"}),new h({type:"Error",text:"BLeft",position:this.minLon+" ;  "+this.minLat+";0"}),new h({type:"Error",text:"BRight",position:this.maxLon+" ;  "+this.minLat+";0"})]});this.myMap.addVo(e)},resizeMap:function t(){var e=$(".sapUshellSearchResultListsContainer").parent().parent().height();e=.85*e;var i="".concat(e,"px");var n=document.querySelectorAll('[id$="-sapUshellSearchGeoMap"]')[0].id;sap.ui.getCore().byId(n).setHeight(i);var a=$(".sapUshellSearchResultListsContainer").parent().parent().width();var o="".concat(a,"px");sap.ui.getCore().byId(n).setWidth(o)},onAfterRendering:function t(){this.resizeMap();window.onresize=this.resizeMap}});return f})})();
//# sourceMappingURL=SearchResultMap.js.map