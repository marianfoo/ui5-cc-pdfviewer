/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../i18n","sap/base/Log","sap/m/Button","sap/m/Title","sap/m/List","sap/m/CustomListItem","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/ActionSheet","sap/m/Link","sap/m/Label","sap/m/VBox","sap/m/library","sap/ui/core/Control","./SearchFacetDialog","./SearchGroupHeaderListItem","./SearchFacet","./SearchFacetPieChart","./SearchFacetBarChart","../SearchFacetDialogModel","../sinaNexTS/providers/abap_odata/UserEventLogger"],function(e,t,a,r,n,i,o,s,l,c,d,f,u,v,p,g,h,S,b,m,y){function B(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function F(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=T(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var r=0;var n=function(){};return{s:n,n:function(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,o=false,s;return{s:function(){a=a.call(e)},n:function(){var e=a.next();i=e.done;return e},e:function(e){o=true;s=e},f:function(){try{if(!i&&a.return!=null)a.return()}finally{if(o)throw s}}}}function T(e,t){if(!e)return;if(typeof e==="string")return x(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return x(e,t)}function x(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,r=new Array(t);a<t;a++){r[a]=e[a]}return r}var w=B(e);var C=u["ButtonType"];var I=u["ListSeparators"];var A=u["PlacementType"];var U=B(p);var D=B(g);var M=B(h);var P=B(S);var L=B(b);var j=B(m);var H=y["UserEventType"];var O=v.extend("sap.esh.search.ui.controls.SearchFacetTabBar",{renderer:{apiVersion:2,render:function e(u,v){var p,g;var h=v.getAggregation("items");if(h.length===0){return}var S=function e(t,a){return function(){var e;var r=$(v.getDomRef()).closest(".sapUshellSearchFacetTabBar")[0];var n=sap.ui.getCore().byId($(r).attr("id"));var i=v.getModel();var o=new j({searchModel:i});o.initBusinessObjSearch().then(function(){var r,s,l;o.setData(i.getData());o.config=i.config;o.sinaNext=i.sinaNext;if(n!==null&&n!==void 0&&(r=n.getBindingContext())!==null&&r!==void 0&&r.getObject()["dimension"]){e=n.getBindingContext().getObject()["dimension"]}if(e===((s=i.config)===null||s===void 0?void 0:s.dimensionNameSpace_Description)&&(l=i.config)!==null&&l!==void 0&&l.openSpaceShowMoreDialog){var c;return(c=i.config)===null||c===void 0?void 0:c.openSpaceShowMoreDialog(e,i)}o.prepareFacetList();var d=new U("".concat(i.config.id,"-SearchFacetDialog"),{selectedAttribute:e,selectedTabBarIndex:t,tabBarItems:a});d.setModel(o);d.setModel(i,"searchModel");var f=v.getParent().getParent().getParent().getParent();f.oFacetDialog=d;d.open();i.eventLogger.logEvent({type:H.FACET_SHOW_MORE,referencedAttribute:e})})}};u.openStart("div",v);u.attr("tabindex","0");u.attr("aria-label",w.getText("filterBy"));u["class"]("sapUshellSearchFacetTabBar");u.openEnd();var b=v.getBindingContext().getObject()["dimension"];var m=v.getBindingContext().getObject()["dataType"];var y=v.getBindingContext().getObject()["title"];var B;var T=v.getModel();var x=T.getPersonalizationStorageInstance().getItem("search-facet-panel-chart-state");if(x&&Object.prototype.toString.call(x)==="[object Array]"){var O=F(x),N;try{for(O.s();!(N=O.n()).done;){var _=N.value;if(_.dimension===b){B=_;break}}}catch(e){O.e(e)}finally{O.f()}}var R=[];var E=[];var k=null;var V=0;if(B&&B.buttonIndex){var z=B.buttonIndex;V=parseInt(z,10)}if(m!=T.sinaNext.AttributeType.String){V=0}v.getBindingContext().getObject()["chartIndex"]=V;var W=new a("",{icon:h[V].getIcon(),type:C.Transparent});var G=0;var Z=F(h),q;try{for(Z.s();!(q=Z.n()).done;){var J=q.value;var K=J.getContent()[0];if(K instanceof M||K instanceof P||K instanceof L){k=new a("",{text:J.getText(),icon:J.getIcon(),press:function e(t){v.storeClickedTabInformation(t);v.setProperty("selectedButtonParameters",t.getParameters())}});k.data("facet-view",J.getText(),true);k.data("facet-view-index",""+G,true);k.data("dimension",b,true);R.push(k);E.push(K)}G++}}catch(e){Z.e(e)}finally{Z.f()}var Q=new l("",{showCancelButton:false,buttons:R,placement:A.Bottom,cancelButtonPress:function e(){t.info("sap.m.ActionSheet: cancelButton is pressed")},afterClose:function e(){window.setTimeout(function(){var e=v.getFocusDomRef().getAttribute("data-facet-dimension");var t=$(".sapUshellSearchFacetTabBarButton");for(var a=0;a<t.length;a++){var r=t[a];var n=r.parentNode.parentNode.getAttribute("data-facet-dimension");if(n===e){r.focus();break}}},100);t.info("=====================");t.info("sap.m.ActionSheet: closed")}});Q.data("facet-dimension",b,true);W.addStyleClass("sapUshellSearchFacetTabBarButton");var X=h[V].getText();var Y=w.getText("displayAs",[X]);W.setTooltip(Y);W.attachPress(function(){Q.openBy(W)});W.onAfterRendering=function(){$(W.getDomRef()).attr("aria-label",w.getText("dropDown"))};if(v.getProperty("headerText")){var ee,te,ae;var re=new n("",{});re.setShowNoData(false);re.setShowSeparators(I.None);re.data("sap-ui-fastnavgroup","false",true);var ne=false;var ie=T.getProperty("/uiFilter/rootCondition");if(ie.hasFilters()){ne=true;if(T.filterWithoutFilterByConditions()){ne=false}if(typeof T.config.hasSpaceFiltersOnly==="function"){if(T.config.hasSpaceFiltersOnly(ie)===true){ne=false}}}else{ne=false}var oe=new a("",{icon:"sap-icon://clear-filter",tooltip:w.getText("resetFilterButton_tooltip"),type:"Transparent",enabled:ne,press:function e(){T.eventLogger.logEvent({type:H.CLEAR_ALL_FILTERS});T.resetFilterByFilterConditions(true)}});if(T!==null&&T!==void 0&&(ee=T.config)!==null&&ee!==void 0&&ee.searchInAttibuteFacetPostion[b]){oe.addStyleClass("sapUshellSearchFilterByResetButtonHidden")}else{oe.addStyleClass("sapUshellSearchFilterByResetButton")}oe.onAfterRendering=function(){$(v.getDomRef()).attr("aria-label",w.getText("resetFilterButton_tooltip"))};var se=new r("",{text:v.getProperty("headerText")});var le=new s;var ce=new o("",{content:[se,le,oe]});ce.data("sap-ui-fastnavgroup","false",true);re.setHeaderToolbar(ce);if((te=T.config)!==null&&te!==void 0&&te.FF_facetPanelUnifiedHeaderStyling&&b===((ae=T.config)===null||ae===void 0?void 0:ae.dimensionNameSpace_Description)){re.setVisible(false)}else{re.addStyleClass("sapUshellSearchFilterByHeaderList")}re.onAfterRendering=function(){$(".sapUshellSearchFilterByHeaderList").find("ul").attr("tabindex","-1");$(".sapUshellSearchFilterByHeaderList").find("div").attr("tabindex","-1")};u.renderControl(re)}var de=new i({content:E[V]});de.setModel(v.getModel(),"facets");de.addStyleClass("sapUshellSearchFacetList");var fe;if(m===T.sinaNext.AttributeType.String){fe=new D("",{title:y,button:W})}else{fe=new D("",{title:y})}fe.data("facet-dimension",b,true);if((p=T.config)!==null&&p!==void 0&&p.searchInAttibuteFacetPostion[b]){var ue;if((ue=T.config)!==null&&ue!==void 0&&ue.FF_facetPanelUnifiedHeaderStyling){var ve;if(b===((ve=T.config)===null||ve===void 0?void 0:ve.dimensionNameSpace_Description)){}else{fe.addStyleClass("sapUshellSearchFacetTabBarHeader");fe.addStyleClass("sapUshellSearchFacetTabBarHeaderHidden")}}else{fe.addStyleClass("sapUshellSearchFacetTabBarHeader");fe.addStyleClass("sapUshellSearchFacetTabBarHeaderHidden")}}else{fe.addStyleClass("sapUshellSearchFacetTabBarHeader")}var pe=w.getText("showMore");if(b===((g=T.config)===null||g===void 0?void 0:g.dimensionNameSpace_Description)){pe=w.getText("showMoreDwcSpace")}var ge=new c("",{text:pe,press:S(V,h).bind(v)});ge.setModel(v.getModel("i18n"));ge.addStyleClass("sapUshellSearchFacetShowMoreLink");var he=new d("",{text:""});he.addStyleClass("sapUshellSearchFacetInfoZeile");var Se=new f("",{items:[he,ge]});var be=new i({content:Se,visible:{parts:[{path:"/uiFilter/dataSource"}],formatter:function e(t){var a=v.getModel();return t.type!==a.sinaNext.DataSourceType.Category}}});be.addStyleClass("sapUshellSearchFacetShowMoreItem");var me=new n("",{showSeparators:I.None,items:[fe,de,be]});me.data("sap-ui-fastnavgroup","false",true);me.setModel(v.getModel());u.renderControl(me);h[V].addContent(E[V]);u.close("div")}},metadata:{properties:{eshRole:"string",headerText:"string",selectedButtonParameters:{type:"object",defaultValue:null}},aggregations:{items:{type:"sap.m.IconTabFilter",multiple:true}}},constructor:function e(t,a){v.prototype.constructor.call(this,t,a)},getSearchFacetTabBarAndDimensionById:function e(t){var a={};a.index=0;var r=document.getElementById(t);var n=r.dataset.facetView;var i=r.dataset.facetViewIndex;var o=$("#"+t).parent()[0];var s=o.dataset.facetDimension;var l=$(".sapUshellSearchFacetTabBar");for(var c=0;c<l.length;c++){var d=$(".sapUshellSearchFacetTabBar .sapUshellSearchFacetTabBarHeader")[c];var f=d.dataset.facetDimension;if(f===s){a.index=c;a.control=sap.ui.getCore().byId(l[c].id);a.view=n;a.buttonIndex=i;a.dimension=s;break}}return a},storeClickedTabInformation:function e(t){var a=t.getSource()["sId"];var r=this.getSearchFacetTabBarAndDimensionById(a);var n=r.control.getModel();var i=n.getPersonalizationStorageInstance().getItem("search-facet-panel-chart-state");var o=r.dimension;var s=r.control;var l=r.view;var c=r.buttonIndex;var d=s.getBindingContext().getObject()["dimension"];var f=t.getParameter("id");var u=[];var v={};v.tabId=a;v.buttonId=f;v.buttonIndex=c;v.dimension=d;v.view=l;u.push(v);if(i&&Object.prototype.toString.call(i)==="[object Array]"){var p=F(i),g;try{for(p.s();!(g=p.n()).done;){var h=g.value;if(h.dimension!==o){u.push(h)}}}catch(e){p.e(e)}finally{p.f()}}n.getPersonalizationStorageInstance().setItem("search-facet-panel-chart-state",u);s.getBindingContext().getObject()["chartIndex"]=c}});return O})})();
//# sourceMappingURL=SearchFacetTabBar.js.map