/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../sinaNexTS/sina/DataSourceType","./SuggestionType","./SinaObjectSuggestionFormatter","../flp/BackendSystem","../flp/FrontendSystem"],function(e,t,n,r,i){function s(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function u(e,t,n){if(t)a(e.prototype,t);if(n)a(e,n);Object.defineProperty(e,"prototype",{writable:false});return e}function c(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}var l=e["DataSourceType"];var g=s(t);var f=t["Type"];var h=s(n);var v=s(r);var y=s(i);function d(e,t,n){if(n){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}var p=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function S(e,t,n){if(!e.s){if(n instanceof m){if(n.s){if(t&1){t=n.s}n=n.v}else{n.o=S.bind(null,e,t);return}}if(n&&n.then){n.then(S.bind(null,e,t),S.bind(null,e,2));return}e.s=t;e.v=n;var r=e.o;if(r){r(e)}}}var m=function(){function e(){}e.prototype.then=function(t,n){var r=new e;var i=this.s;if(i){var s=i&1?t:n;if(s){try{S(r,1,s(this.v))}catch(e){S(r,2,e)}return r}else{return this}}this.o=function(e){try{var i=e.v;if(e.s&1){S(r,1,t?t(i):i)}else if(n){S(r,1,n(i))}else{S(r,2,i)}}catch(e){S(r,2,e)}};return r};return e}();function b(e){return e instanceof m&&e.s&1}function T(e,t,n){var r=-1,i,s;function o(a){try{while(++r<e.length&&(!n||!n())){a=t(r);if(a&&a.then){if(b(a)){a=a.v}else{a.then(o,s||(s=S.bind(null,i=new m,2)));return}}}if(i){S(i,1,a)}else{i=a}}catch(e){S(i||(i=new m),2,e)}}o();return i}function w(e,t,n){if(typeof e[p]==="function"){var r=function e(r){try{while(!(s=i.next()).done&&(!n||!n())){r=t(s.value);if(r&&r.then){if(b(r)){r=r.v}else{r.then(e,a||(a=S.bind(null,o=new m,2)));return}}}if(o){S(o,1,r)}else{o=r}}catch(e){S(o||(o=new m),2,e)}};var i=e[p](),s,o,a;r();if(i["return"]){var u=function e(t){try{if(!s.done){i["return"]()}}catch(e){}return t};if(o&&o.then){return o.then(u,function(e){throw u(e)})}u()}return o}if(!("length"in e)){throw new TypeError("Object is not iterable")}var c=[];for(var l=0;l<e.length;l++){c.push(e[l])}return T(c,function(e){return t(c[e])},n)}function C(e,t){return e&&e.then?e.then(t):t(e)}function D(e,t,n){if(n){return t?t(e()):e()}try{var r=Promise.resolve(e());return t?r.then(t):r}catch(e){return Promise.reject(e)}}var j=function(){function e(t){o(this,e);c(this,"suggestionFormatter",new h);c(this,"transactionSuggestions",[]);this.model=t.model;this.suggestionHandler=t.suggestionHandler;this.suggestionLimit=sap.ui.Device.system.phone?5:7;this.sinaNext=this.model.sinaNext;this.suggestionQuery=this.sinaNext.createSuggestionQuery();this.transactionsDS=this.sinaNext.createDataSource({id:"CD$ALL~ESH_TRANSACTION~",label:"Transactions",type:l.BusinessObject});this.suggestionStartingCharacters=this.model.config.suggestionStartingCharacters}u(e,[{key:"abortSuggestions",value:function e(){this.suggestionQuery.abort()}},{key:"getUrl",value:function e(t){var n="#Shell-startGUI?sap-ui2-tcode="+t;var r=v.getSystem(this.model);if(r&&!r.equals(y.getSystem())){n="#Shell-startGUI?sap-system=sid(".concat(r.id,")&sap-ui2-tcode=").concat(t)}return n}},{key:"getSuggestions",value:function e(t){var n=this;return D(function(){var e;if(!n.model.config.searchBusinessObjects){return Promise.resolve([])}var r=n.model.getDataSource();var i=n.model.userCategoryManager;var s=(i===null||i===void 0?void 0:i.isFavActive())&&(i===null||i===void 0?void 0:(e=i.getCategory("MyFavorites"))===null||e===void 0?void 0:e.includeApps);if(r!==n.model.allDataSource&&r!==n.model.appDataSource&&!(r===n.model.favDataSource&&s)){return Promise.resolve([])}t=t.clone();var o=t.searchTerm;if(o.toLowerCase().indexOf("/n")===0||o.toLowerCase().indexOf("/o")===0){o=o.slice(2);t.searchTerm=o}n.transactionSuggestions=[];if(o.length<n.suggestionStartingCharacters){return Promise.resolve([])}n.prepareSuggestionQuery(t);return d(n.suggestionQuery.getResultSetAsync(),function(e){var r=e.items;return C(w(r,function(e){var r={uiSuggestionType:f.Transaction,dataSource:n.transactionsDS,position:g.properties.Transaction.position,key:e.object.attributesMap.TCODE.value,searchTerm:t.searchTerm,url:n.getUrl(e.object.attributesMap.TCODE.value),icon:"sap-icon://generate-shortcut",label:e.object.attributesMap.TCDTEXT.valueHighlighted,type:e.type,calculationMode:e.calculationMode,object:e.object,sina:e.sina};return d(sap.ushell.Container.getServiceAsync("CrossApplicationNavigation"),function(e){return d(e.isNavigationSupported([{target:{shellHash:r.url}}]),function(e){if(e[0].supported){n.suggestionFormatter.format(n,r)}})})}),function(){var e=n.suggestionHandler.getSuggestionLimit(f.Transaction);n.transactionSuggestions=n.transactionSuggestions.slice(0,e);return n.transactionSuggestions})})})}},{key:"addSuggestion",value:function e(t){this.transactionSuggestions.push(t)}},{key:"prepareSuggestionQuery",value:function e(t){this.suggestionQuery.resetResultSet();this.suggestionQuery.setFilter(t);this.suggestionQuery.setDataSource(this.transactionsDS);this.suggestionQuery.setTypes([this.sinaNext.SuggestionType.Object]);this.suggestionQuery.setCalculationModes([this.sinaNext.SuggestionCalculationMode.Data]);this.suggestionQuery.setTop(10)}}]);return e}();return j})})();
//# sourceMappingURL=TransactionSuggestionProvider.js.map