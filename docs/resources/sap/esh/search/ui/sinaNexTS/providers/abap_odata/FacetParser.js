/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../../sina/ComparisonOperator","../../sina/LogicalOperator","../../sina/SearchQuery","./typeConverter"],function(e,t,a,r){function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function s(e,t,a){if(t)u(e.prototype,t);if(a)u(e,a);Object.defineProperty(e,"prototype",{writable:false});return e}
/*!
   * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
   */var l=e["ComparisonOperator"];var o=t["LogicalOperator"];var n=a["SearchQuery"];var c=function(){function e(t){i(this,e);this.provider=t;this.sina=t.sina}s(e,[{key:"parse",value:function e(t,a){if(a.ValueHelp){this.prepareValueHelpFacet(t,a)}var r=[];if(!a.Facets||!a.Facets.results){return[]}for(var i=0;i<a.Facets.results.length;i++){var u=a.Facets.results[i];var s=u.Type;if(s==="DataSource"){r.push(this.parseDataSourceFacet(t,u))}else{if(t.filter.dataSource.type===t.sina.DataSourceType.Category||t.filter.dataSource.type===t.sina.DataSourceType.UserCategory){continue}r.push(this.parseChartFacet(t,u))}}return Promise.all(r)}},{key:"prepareValueHelpFacet",value:function e(t,a){var r=a.ValueHelp.results;var i=this.sina.getDataSource(t.filter.dataSource.id);var u=a.ValueHelpAttribute;var s=i.getAttributeMetadata(u);var l={Id:a.ValueHelpAttribute,Name:s.label,Type:"AttributeValue",Values:{results:[]}};var o=[];for(var n=0;n<r.length;n++){var c=r[n];o.push({Description:c.ValueFormatted,NumberOfObjects:c.NumberOfInstances,Type:"AttributeValue",ValueLow:c.Value,ValueLowFormatted:c.ValueFormatted,ValueHigh:"",ValueHighFormatted:""})}l.Values.results=o;a.Facets={};a.Facets.results=[];a.Facets.results[0]=l}},{key:"parseDataSourceFacet",value:function e(t,a){var r=t;if(t instanceof n){r=this.sina.createDataSourceQuery({dataSource:t.filter.dataSource,filter:t.filter.clone()})}var i=[];for(var u=0;u<a.Values.results.length;u++){var s=a.Values.results[u];var l=this.sina.getDataSource(s.ValueLow);if(!l){l=this.sina._createDataSource({type:this.sina.DataSourceType.Category,id:s.ValueLow,label:s.Description})}i.push(this.sina._createDataSourceResultSetItem({dataSource:l,dimensionValueFormatted:l.labelPlural,measureValue:s.NumberOfObjects,measureValueFormatted:s.NumberOfObjects.toString()}))}var o=this.sina._createDataSourceResultSet({title:t.filter.dataSource.label,items:i,query:r});if(t instanceof n){return r._setResultSet(o)}return o}},{key:"createAttributeFilterCondition",value:function e(t,a,i){if(i.Type==="AttributeRange"){var u=[];if(i.ValueLow&&i.ValueLow.length!==0){u.push(this.sina.createSimpleCondition({attribute:t,operator:l.Ge,value:r.odata2Sina(a.type,i.ValueLow)}))}if(i.ValueHigh&&i.ValueHigh.length!==0){u.push(this.sina.createSimpleCondition({attribute:t,operator:l.Le,value:r.odata2Sina(a.type,i.ValueHigh)}))}return this.sina.createComplexCondition({attributeLabel:a.label,valueLabel:i.Description,operator:o.And,conditions:u})}return this.sina.createSimpleCondition({attributeLabel:a.label,attribute:t,value:r.odata2Sina(a.type,i.ValueLow),valueLabel:i.Description})}},{key:"parseChartFacet",value:function e(t,a){var r=this.sina.getDataSource(t.filter.dataSource.id);var i=a.Id;var u=r.getAttributeMetadata(i);var s,l=t;if(t instanceof n){s=t.filter.clone();s.setDataSource(r);s.setRootCondition(t.filter.rootCondition.clone());l=this.sina.createChartQuery({filter:s,dimension:a.Id})}var o=[];for(var c=0;c<a.Values.results.length;c++){var p=a.Values.results[c];o.push(this.sina._createChartResultSetItem({filterCondition:this.createAttributeFilterCondition(i,u,p),dimensionValueFormatted:p.Description,measureValue:p.NumberOfObjects,measureValueFormatted:p.ValueLowFormatted}))}var f=this.sina._createChartResultSet({title:u.label,items:o,query:l});if(t instanceof n){return l._setResultSet(f)}return f}}]);return e}();var p={__esModule:true};p.FacetParser=c;return p})})();
//# sourceMappingURL=FacetParser.js.map