/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["sap/base/Log","./performancelogging/PerformanceLogger","sap/esh/search/ui/controls/SearchResultListSelectionHandler","./controls/SearchResultListItemNote"],function(e,t,i,a){function s(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function r(e,t,i){if(t)n(e.prototype,t);if(i)n(e,i);Object.defineProperty(e,"prototype",{writable:false});return e}function u(e,t,i){if(t in e){Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true})}else{e[t]=i}return e}var l=s(t);var c=s(a);function f(e,t,i){if(i){return t?t(e()):e()}try{var a=Promise.resolve(e());return t?a.then(t):a}catch(e){return Promise.reject(e)}}var d=function(){function t(i){o(this,t);u(this,"log",e.getLogger("sap.esh.search.ui.SearchConfiguration"));u(this,"urlParameterMetaData",{esDevConfig:{type:"object"},multiSelect:{type:"bool"},sinaProvider:{type:"string"},odataProvider:{type:"bool"},searchBusinessObjects:{type:"bool"},charts:{type:"bool"},maps:{type:"bool"},mapProvider:{type:"object"},newpie:{type:"bool"},personalizationStorage:{type:"string"},boSuggestions:{type:"bool"},_eshClickableObjectType:{type:"bool"},defaultSearchScopeApps:{type:"bool"},searchScopeWithoutAll:{type:"bool"},suggestionKeyboardRelaxationTime:{type:"int"},suggestionStartingCharacters:{type:"int"},resultViewTypes:{type:"string[]"},fallbackResultViewType:{type:"string"},enableMultiSelectionResultItems:{type:"bool"},updateUrl:{type:"bool"},renderSearchUrl:{type:"function",isSinaParameter:true},isSearchUrl:{type:"function"},beforeNavigation:{type:"function"},getCustomToolbar:{type:"function"},quickSelectDataSources:{type:"object"},initAsync:{type:"function"},layoutUseResponsiveSplitter:{type:"bool"},facetPanelWidthInPercent:{type:"int"},FF_facetPanelUnifiedHeaderStyling:{type:"bool"},FF_hierarchyBreadcrumbs:{type:"bool",isSinaParameter:true},FF_dynamicHierarchyFacetsInShowMore:{type:"bool"},searchBarDoNotHideForNoResults:{type:"bool"},pageSize:{type:"int"},FF_layoutWithoutPage:{type:"bool"},titleColumnName:{type:"string"},titleColumnWidth:{type:"string"},extendTableColumn:{type:"object"},searchInAttibuteFacetPostion:{type:"object"},cleanUpSpaceFilters:{type:"function"},setSearchInLabelIconBindings:{type:"function"},getSearchInFacetListMode:{type:"function"},checkAndSetSpaceIcon:{type:"function"},hasSpaceFiltersOnly:{type:"function"},showSpaceFacetInShowMoreDialog:{type:"function"},getSpaceFacetId:{type:"function"},bRecentSearches:{type:"bool"},bNoAppSearch:{type:"bool"},bResetSearchTermOnQuickSelectDataSourceItemPress:{type:"bool"},bPlaceHolderFixedValue:{type:"bool"},FF_bOptimizedQuickSelectDataSourceLabels:{type:"bool"},FF_optimizeForValueHelp:{type:"bool"},FF_errorMessagesAsButton:{type:"bool"},combinedResultviewToolbar:{type:"bool"},selectionChange:{type:"function"},metaDataJsonType:{type:"bool"},facetVisibility:{type:"bool"},defaultDataSource:{type:"string"},displayNoResultsPageBackButton:{type:"bool"},displayNoResultsPageSearchAllButton:{type:"bool"},displayFacetPanelInCaseOfNoResults:{type:"bool"},browserTitleOverwritten:{type:"bool"},isUshell:{type:"bool"},userDefinedDatasourcesMulti:{type:"bool"},FF_staticHierarchyFacets:{type:"bool"},FF_dynamicHierarchyFacets:{type:"bool"},usageCollectionService:{type:"object"},performanceLogger:{type:"object"},eshUseExtendedChangeDetection:{type:"bool"},tabStripsFormatter:{type:"function"},assembleSearchCountBreadcrumbs:{type:"function"},folderMode:{type:"bool",isSinaParameter:true},autoAdjustResultViewTypeInFolderMode:{type:"bool"},enableQueryLanguage:{type:"bool",isSinaParameter:true}});if(i&&Object.keys(i).length>0&&!i.isUshell){jQuery.extend(this,i)}else{this.readUshellConfiguration();this.readOutdatedUshellConfiguration()}if(i!==null&&i!==void 0&&i.isUshell){this.isUshell=true}else{this.isUshell=false}this.setDefaults();this.updateConfigFromUrlParameters();this.setModulePaths();this.createDefaultDataSourceConfig()}r(t,[{key:"setModulePaths",value:function e(){if(!this.modulePaths){return}for(var t=0;t<this.modulePaths.length;++t){var i=this.modulePaths[t];var a=i.urlPrefix.replace("${host}",window.location.protocol+"//"+window.location.host);jQuery.sap.registerModulePath(i.moduleName,a)}}},{key:"readUshellConfiguration",value:function e(){try{var t=window["sap-ushell-config"].renderers.fiori2.componentData.config.esearch;jQuery.extend(true,this,t)}catch(e){this.log.warning("Error while reading global ushell config: "+e.stack)}}},{key:"readOutdatedUshellConfiguration",value:function e(){try{var t=window["sap-ushell-config"].renderers.fiori2.componentData.config;if(typeof t.searchBusinessObjects!=="undefined"&&typeof this.searchBusinessObjects==="undefined"){if(t.searchBusinessObjects==="hidden"||t.searchBusinessObjects===false){this.searchBusinessObjects=false}else{this.searchBusinessObjects=true}}if(typeof t.enableSearch!=="undefined"&&typeof this.enableSearch==="undefined"){this.enableSearch=t.enableSearch}}catch(e){}}},{key:"setDefaults",value:function e(){if(typeof this.searchBusinessObjects==="undefined"){this.searchBusinessObjects=true}if(typeof this.odataProvider==="undefined"){this.odataProvider=false}if(typeof this.multiSelect==="undefined"){this.multiSelect=true}if(typeof this.charts==="undefined"){this.charts=true}if(typeof this.maps==="undefined"){this.maps=undefined}if(typeof this.mapProvider==="undefined"){this.mapProvider=undefined}if(typeof this.newpie==="undefined"){this.newpie=false}if(typeof this.dataSources==="undefined"){this.dataSources=[]}if(typeof this.enableSearch==="undefined"){this.enableSearch=true}if(typeof this.personalizationStorage==="undefined"){this.personalizationStorage="auto"}if(typeof this.boSuggestions==="undefined"){this.boSuggestions=false}if(typeof this._eshClickableObjectType==="undefined"){this._eshClickableObjectType=true}if(typeof this.defaultSearchScopeApps==="undefined"){this.defaultSearchScopeApps=false}if(typeof this.searchScopeWithoutAll==="undefined"){this.searchScopeWithoutAll=false}if(typeof this.suggestionKeyboardRelaxationTime==="undefined"){this.suggestionKeyboardRelaxationTime=400}if(typeof this.suggestionStartingCharacters==="undefined"){this.suggestionStartingCharacters=3}if(typeof this.resultViewTypes==="undefined"){this.resultViewTypes=["searchResultList","searchResultTable"]}if(typeof this.enableMultiSelectionResultItems==="undefined"){this.enableMultiSelectionResultItems=false}if(typeof this.updateUrl==="undefined"){this.updateUrl=true}if(typeof this.isSearchUrl==="undefined"){this.isSearchUrl=this.isSearchUrl}if(typeof this.beforeNavigation==="undefined"){this.beforeNavigation=this.beforeNavigation}if(typeof this.getCustomToolbar==="undefined"){this.getCustomToolbar=this.getCustomToolbar}if(typeof this.getCustomNoResultScreen==="undefined"){this.getCustomNoResultScreen=function(e,t){return null}}if(typeof this.quickSelectDataSources==="undefined"){this.quickSelectDataSources=[]}if(typeof this.initAsync==="undefined"){this.initAsync=this.initAsync}if(typeof this.pageSize==="undefined"){this.pageSize=10}if(typeof this.layoutUseResponsiveSplitter==="undefined"){this.layoutUseResponsiveSplitter=false}if(typeof this.facetPanelWidthInPercent==="undefined"){this.facetPanelWidthInPercent=25}if(typeof this.FF_facetPanelUnifiedHeaderStyling==="undefined"){this.FF_facetPanelUnifiedHeaderStyling=false}if(typeof this.FF_hierarchyBreadcrumbs==="undefined"){this.FF_hierarchyBreadcrumbs=false}if(typeof this.FF_dynamicHierarchyFacetsInShowMore==="undefined"){this.FF_dynamicHierarchyFacetsInShowMore=false}if(typeof this.FF_DWCO_REPOSITORY_EXPLORER_FOLDER==="undefined"){this.FF_DWCO_REPOSITORY_EXPLORER_FOLDER=false}if(typeof this.searchBarDoNotHideForNoResults==="undefined"){this.searchBarDoNotHideForNoResults=false}if(typeof this.FF_layoutWithoutPage==="undefined"){this.FF_layoutWithoutPage=true}if(typeof this.searchInAttibuteFacetPostion==="undefined"){this.searchInAttibuteFacetPostion={}}if(typeof this.extendTableColumn==="undefined"){this.extendTableColumn=undefined}if(typeof this.cleanUpSpaceFilters==="undefined"){this.cleanUpSpaceFilters=this.cleanUpSpaceFilters}if(typeof this.setSearchInLabelIconBindings==="undefined"){this.setSearchInLabelIconBindings=this.setSearchInLabelIconBindings}if(typeof this.getSearchInFacetListMode==="undefined"){this.getSearchInFacetListMode=this.getSearchInFacetListMode}if(typeof this.checkAndSetSpaceIcon==="undefined"){this.checkAndSetSpaceIcon=this.checkAndSetSpaceIcon}if(typeof this.hasSpaceFiltersOnly==="undefined"){this.hasSpaceFiltersOnly=this.hasSpaceFiltersOnly}if(typeof this.showSpaceFacetInShowMoreDialog==="undefined"){this.showSpaceFacetInShowMoreDialog=this.showSpaceFacetInShowMoreDialog}if(typeof this.getSpaceFacetId==="undefined"){this.getSpaceFacetId=this.getSpaceFacetId}if(typeof this.bRecentSearches==="undefined"){this.bRecentSearches=false}if(typeof this.bNoAppSearch==="undefined"){this.bNoAppSearch=false}if(typeof this.bResetSearchTermOnQuickSelectDataSourceItemPress==="undefined"){this.bResetSearchTermOnQuickSelectDataSourceItemPress=false}if(typeof this.bPlaceHolderFixedValue==="undefined"){this.bPlaceHolderFixedValue=false}if(typeof this.FF_bOptimizedQuickSelectDataSourceLabels==="undefined"){this.FF_bOptimizedQuickSelectDataSourceLabels=false}if(typeof this.FF_optimizeForValueHelp==="undefined"){this.FF_optimizeForValueHelp=false}if(typeof this.FF_errorMessagesAsButton==="undefined"){this.FF_errorMessagesAsButton=false}if(typeof this.combinedResultviewToolbar==="undefined"){this.combinedResultviewToolbar=false}if(typeof this.selectionChange==="undefined"){this.selectionChange=function(){}}if(typeof this.metaDataJsonType==="undefined"){this.metaDataJsonType=false}if(typeof this.facetVisibility==="undefined"){this.facetVisibility=undefined}if(typeof this.defaultDataSource==="undefined"){this.defaultDataSource=undefined}if(typeof this.displayNoResultsPageBackButton==="undefined"){this.displayNoResultsPageBackButton=false}if(typeof this.displayNoResultsPageSearchAllButton==="undefined"){this.displayNoResultsPageSearchAllButton=false}if(typeof this.displayFacetPanelInCaseOfNoResults==="undefined"){this.displayFacetPanelInCaseOfNoResults=false}if(typeof this.browserTitleOverwritten==="undefined"){this.browserTitleOverwritten=true}if(typeof this.userDefinedDatasourcesMulti==="undefined"){this.userDefinedDatasourcesMulti=false}if(typeof this.FF_staticHierarchyFacets==="undefined"){this.FF_staticHierarchyFacets=false}if(typeof this.FF_dynamicHierarchyFacets==="undefined"){this.FF_dynamicHierarchyFacets=true}if(typeof this.usageCollectionService==="undefined"){this.usageCollectionService=undefined}if(typeof this.performanceLogger==="undefined"){this.performanceLogger=new l}if(typeof this.tabStripsFormatter==="undefined"){this.tabStripsFormatter=function(e){return e}}if(typeof this.assembleSearchCountBreadcrumbs==="undefined"){this.assembleSearchCountBreadcrumbs=undefined}if(typeof this.folderMode==="undefined"){this.folderMode=false}if(typeof this.autoAdjustResultViewTypeInFolderMode==="undefined"){this.autoAdjustResultViewTypeInFolderMode=false}if(typeof this.enableQueryLanguage==="undefined"){this.enableQueryLanguage=false}this.dataSourceConfigurations={};this.dataSourceConfigurations_Regexes=[];if(this.dataSources){for(var t=0;t<this.dataSources.length;t++){var i=this.dataSources[t];if(i.id){this.dataSourceConfigurations[i.id]=i}else if(i.regex){var a=i.regexFlags||undefined;var s=new RegExp(i.regex,a);if(s){i.regex=s;this.dataSourceConfigurations_Regexes.push(i)}}else{var o="Following datasource configuration does neither include a valid id nor a regular expression, therefore it is ignored:\n"+JSON.stringify(i);this.log.warning(o)}}}this.dataSources=undefined;this.documentDataSource={searchResultListItem:"sap.esh.search.ui.controls.SearchResultListItemDocument"};this.dataSourceConfigurations.noteprocessorurl=this.dataSourceConfigurations.noteprocessorurl||{};this.dataSourceConfigurations.noteprocessorurl.searchResultListItem=this.dataSourceConfigurations.noteprocessorurl.searchResultListItem||new c;this.dataSourceConfigurations.noteprocessorurl.searchResultListSelectionHandler=this.dataSourceConfigurations.noteprocessorurl.searchResultListSelectionHandler||"sap.esh.search.ui.controls.SearchResultListSelectionHandlerNote"}},{key:"createDefaultDataSourceConfig",value:function e(){this.defaultDataSourceConfig={searchResultListItem:undefined,searchResultListItemControl:undefined,searchResultListItemContent:undefined,searchResultListItemContentControl:undefined,searchResultListSelectionHandler:i["getMetadata"]().getName(),searchResultListSelectionHandlerControl:i}}},{key:"updateConfigFromUrlParameters",value:function e(){var t=this.parseUrlParameters();for(var i in t){if(i==="demoMode"){this.searchBusinessObjects=true;this.enableSearch=true;continue}if(i==="resultViewTypes"){var a=t[i].split(",");a=a.filter(function(e){return e.length>0});this.resultViewTypes=a;continue}var s=this.urlParameterMetaData[i];if(!s){continue}var o=t[i];if(i==="esDevConfig"){var n=JSON.parse(o);Object.assign(this,n);if(this.id){var r=sap.ui.getCore().byId(this.id);var u=r["getMetadata"]().getProperties();var l=Object.getOwnPropertyNames(u);for(var c=0;c<l.length;c++){var f=l[c];if(typeof n[f]!=="undefined"){var d=u[f]._sMutator;r[d].apply(r,[n[f]])}}}continue}switch(s.type){case"bool":o=o==="true"||o==="";break;default:}this[i]=o}}},{key:"parseUrlParameters",value:function e(){if(!URLSearchParams){return{}}var t=new URLSearchParams(window.location.search);return Object.fromEntries(t.entries())}},{key:"parseSearchUrlParameters",value:function e(t){return t}},{key:"loadCustomModulesAsync",value:function e(){if(this._loadCustomModulesProm){return this._loadCustomModulesProm}var t;var i=[];for(var a in this.dataSourceConfigurations){t=this.loadCustomModulesForDataSourceIdAsync(a);i.push(t)}this._loadCustomModulesProm=Promise.all(i);return this._loadCustomModulesProm}},{key:"loadCustomModulesForDataSourcesAsync",value:function e(t,i){var a=this;return f(function(){var e=[];for(var s=0;s<t.length;s++){var o=Array.isArray(i)&&i.length>s&&i[s]||{};var n=a.loadCustomModulesForDataSourceAsync(t[s],o);e.push(n)}return Promise.all(e)})}},{key:"loadCustomModulesForDataSourceAsync",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};i=i||{};return this.loadCustomModulesForDataSourceIdAsync(t.id,i)}},{key:"loadCustomModulesForDataSourceIdAsync",value:function e(t,i){if(!t){return Promise.resolve()}this._dataSourceLoadingProms=this._dataSourceLoadingProms||{};var a=this._dataSourceLoadingProms[t];if(!a){var s=[{moduleAttrName:"searchResultListItem",controlAttrName:"searchResultListItemControl"},{moduleAttrName:"searchResultListItemContent",controlAttrName:"searchResultListItemContentControl"},{moduleAttrName:"searchResultListSelectionHandler",controlAttrName:"searchResultListSelectionHandlerControl"}];var o=this._prepareDataSourceConfigurationForDataSource(t,i);var n;var r=[];for(var u=0;u<s.length;u++){n=this._doLoadCustomModulesAsync(t,o,s[u].moduleAttrName,s[u].controlAttrName);r.push(n)}a=Promise.all(r);a._resolvedOrFailed=false;a.then(function(){a._resolvedOrFailed=true});this._dataSourceLoadingProms[t]=a}return a}},{key:"_doLoadCustomModulesAsync",value:function e(t,i,a,s,o,n){var r=this;return new Promise(function(e){if(i[a]&&(!i[s]||i[s]==r.defaultDataSourceConfig[s])){try{sap.ui.require([i[a].replace(/[.]/g,"/")],function(t){i[s]=t;e()})}catch(l){var u="Could not load custom module '"+i[a]+"' for data source with id '"+t+"'. ";u+="Falling back to default data source configuration.";r.log.warning(u);i[a]=o||r.defaultDataSourceConfig[a];i[s]=n||r.defaultDataSourceConfig[s];e()}}else{if(!i[s]){i[a]=o||r.defaultDataSourceConfig[a];i[s]=n||r.defaultDataSourceConfig[s]}e()}})}},{key:"getDataSourceConfig",value:function e(t){if(this._dataSourceLoadingProms&&this._dataSourceLoadingProms[t.id]&&!this._dataSourceLoadingProms[t.id]._resolvedOrFailed){return this.defaultDataSourceConfig}var i=this.dataSourceConfigurations[t.id];if(!i){i=this.defaultDataSourceConfig;this.dataSourceConfigurations[t.id]=i}return i}},{key:"_prepareDataSourceConfigurationForDataSource",value:function e(t,i){var a={};if(this.dataSourceConfigurations[t]){a=this.dataSourceConfigurations[t]}else{for(var s=0;s<this.dataSourceConfigurations_Regexes.length;s++){if(this.dataSourceConfigurations_Regexes[s].regex.test(t)){a=this.dataSourceConfigurations_Regexes[s];break}}}if(i&&i.isDocumentConnector){if(!a.searchResultListItem){a.searchResultListItem=this.documentDataSource.searchResultListItem}else{var o="Will attempt to load '"+a.searchResultListItem+"' instead of '"+this.documentDataSource.searchResultListItem+"' for data source '"+t+"'";this.log.warning(o)}}this.dataSourceConfigurations[t]=a;return a}},{key:"getSina",value:function e(){return{}}},{key:"renderSearchUrl",value:function e(t){return"#Action-search&/top="+t.top+"&filter="+t.filter}},{key:"isSearchUrl",value:function e(t){return t.indexOf("#Action-search")===0}},{key:"getCustomToolbar",value:function e(){return[]}},{key:"initAsync",value:function e(t){return}},{key:"beforeNavigation",value:function e(t){return}}]);return t}();return d})})();
//# sourceMappingURL=SearchConfiguration.js.map