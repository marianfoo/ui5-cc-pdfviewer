/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./error/ErrorHandler","./i18n","sap/ui/model/resource/ResourceModel","sap/esh/search/ui/controls/SearchFieldGroup","sap/esh/search/ui/SearchModel","sap/esh/search/ui/controls/SearchLayoutResponsive","sap/esh/search/ui/controls/SearchResultListContainer","sap/esh/search/ui/controls/SearchResultList","sap/esh/search/ui/controls/SearchResultTable","sap/esh/search/ui/controls/SearchResultGrid","sap/esh/search/ui/controls/SearchSpreadsheet","sap/esh/search/ui/controls/SearchNoResultScreen","sap/esh/search/ui/controls/SearchText","sap/esh/search/ui/controls/SearchLink","sap/esh/search/ui/controls/SearchCountBreadcrumbs","sap/esh/search/ui/controls/SearchResultListItem","sap/esh/search/ui/controls/CustomSearchResultListItem","sap/esh/search/ui/controls/SearchTileHighlighter","sap/esh/search/ui/controls/SearchFilterBar","sap/esh/search/ui/controls/SearchFacetFilter","sap/esh/search/ui/SearchHelper","sap/ui/core/Control","sap/ui/core/InvisibleText","sap/ui/core/Icon","sap/ui/core/IconPool","sap/ui/layout/VerticalLayout","sap/ui/model/BindingMode","sap/m/Button","sap/m/library","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/ToggleButton","sap/m/Bar","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/OverflowToolbarLayoutData","sap/m/OverflowToolbar","sap/m/ToolbarSeparator","sap/m/Label","sap/m/Text","sap/m/Column","sap/m/ColumnListItem","sap/m/CustomListItem","sap/m/ActionSheet","sap/m/FlexBox","sap/m/GenericTile","sap/m/TileContent","sap/m/ViewSettingsDialog","sap/m/ViewSettingsItem","sap/m/MessagePopover","sap/m/MessageItem","sap/m/HBox","sap/m/VBox","sap/f/GridContainer","sap/f/GridContainerSettings","sap/f/GridContainerItemLayoutData","sap/m/TablePersoController","./error/errors","./sinaNexTS/providers/abap_odata/UserEventLogger","sap/base/Log"],function(e,t,r,a,s,i,o,n,l,u,c,h,d,p,g,f,v,b,S,m,y,C,w,T,R,M,I,B,P,V,L,F,A,D,E,x,U,O,H,_,N,j,G,z,k,W,K,q,Q,J,X,Y,Z,ee,te,re,ae,se,ie,oe){function ne(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function le(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ue(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var a=0;var s=function(){};return{s:s,n:function(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,o=false,n;return{s:function(){r=r.call(e)},n:function(){var e=r.next();i=e.done;return e},e:function(e){o=true;n=e},f:function(){try{if(!i&&r.return!=null)r.return()}finally{if(o)throw n}}}}function ue(e,t){if(!e)return;if(typeof e==="string")return ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ce(e,t)}function ce(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,a=new Array(t);r<t;r++){a[r]=e[r]}return a}var he=ne(e);var de=ne(t);var pe=b["Highlighter"];var ge=P["ButtonType"];var fe=P["PlacementType"];var ve=P["OverflowToolbarPriority"];var be=P["ListMode"];var Se=P["ListType"];var me=P["PopinDisplay"];var ye=P["FlexJustifyContent"];var Ce=P["PopinLayout"];var we=ne(se);var Te=se["ProgramError"];var Re=ie["UserEventType"];var Me=C.extend("sap.esh.search.ui.SearchCompositeControl",{renderer:{apiVersion:2,render:function e(t,r){t.openStart("div",r);t.style("height","100%");t.style("width","100%");t.openEnd();var a=r.getAggregation("content");if(a){for(var s=0;s<a.length;s++){t.renderControl(a[s])}}t.close("div")}},metadata:{library:"sap.esh.search.ui",properties:{cssClass:{type:"string"},searchTerm:{type:"string",group:"Misc",defaultValue:""},searchOnStart:{type:"boolean",group:"Behavior",defaultValue:true},filterRootCondition:{type:"object",group:"Misc"},sinaConfiguration:{type:"object",group:"Misc"},dataSource:{type:"string",group:"Misc"},resultViewTypes:{type:"string[]",group:"Misc",defaultValue:["searchResultList","searchResultTable"]},resultViewType:{type:"string",group:"Misc",defaultValue:"searchResultList"},resultViewSettings:{settings:{resultViewTypes:"string[]",resultViewType:"string"},group:"Misc",defaultValue:{resultViewTypes:["searchResultList","searchResultTable"],resultViewType:"searchResultList"}},tabStripsFormatter:{type:"function",group:"Misc"},assembleSearchCountBreadcrumbs:{type:"function",group:"Misc"},folderMode:{type:"boolean",group:"Misc",defaultValue:false},autoAdjustResultViewTypeInFolderMode:{type:"boolean",group:"Misc",defaultValue:false},enableQueryLanguage:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{content:{singularName:"content",multiple:true}},events:{searchStarted:{},searchFinished:{}}},constructor:function e(t,a){var i=this;if(typeof t!=="string"&&t!==undefined&&a===undefined){a=t;t=a&&a.id}else if(typeof a==="undefined"){a={}}if(typeof t==="string"&&t.length>0){a.id=t}if(!t||t.length===0){t="eshComp"+"GenId_"+Me.eshCompCounter++;a.id=t}var o=new he({model:null});try{if(typeof t==="string"&&t.length>0&&typeof a.id!=="undefined"){if(t!==a.id){var n=new Error("Constructor of component 'sap.esh.search.ui.SearchCompositeControl' has failed\n\n"+"sId and mSettings.id are not the same. It is sufficient to set either 'id' (sId) or 'settings.id' (mSettings.id).");var l=new we.ESHUIConstructionError(n);o.onError(l)}}var u={};var c=Me.getMetadata().getProperties();var h=Me.getMetadata().getPropertyDefaults();for(var d in c){if(typeof a[d]==="undefined"){a[d]=h[d]}if(Object.keys(c).includes(d)){u[d]=a[d]}}C.prototype.constructor.call(this,t,u);this._oLogger=oe.getLogger("sap.esh.search.ui.SearchCompositeControl");this.addStyleClass("sapUshellSearchInputHelpPage");this.oFocusHandler=new y.SearchFocusHandler(this);try{var p=a["model"]||a.searchModel||this.getModel("searchModel");if(!p){p=new s({configuration:a});this.setModel(p,"searchModel")}p.isSearchCompositeControl=true;if(p.config.FF_optimizeForValueHelp){this.addStyleClass("sapUshellSearchInputHelpPageValueHelp")}p.focusHandler=this.oFocusHandler;o.setSearchModel(p);this.setModel(p);this.setModel(new r({bundle:de}),"i18n");p.config.performanceLogger.enterMethod({name:"createContent"},{isSearch:true});this.createContent();p.config.performanceLogger.leaveMethod({name:"createContent"})}catch(n){var g=this.getModel();if(g){g.config.performanceLogger.leaveMethod({name:"createContent"})}var f=new we.ESHUIConstructionError(n);o.onError(f)}var v=this.getModel();if(a.sinaConfiguration){var b,S;if(typeof((b=a)===null||b===void 0?void 0:(S=b.sinaConfiguration)===null||S===void 0?void 0:S.getLanguage)!=="function"){var m=function e(){return sap.ui.getCore().getConfiguration().getLanguage()};a.sinaConfiguration["getLanguage"]=m}}v.config.performanceLogger.enterMethod({name:"init search"},{isSearch:true});v.searchUrlParser.parse().then(function(){i.getModel().initAsync().then(function(){var e=i.getModel();if(i.getProperty("searchOnStart")&&!e.config.isUshell){e._firePerspectiveQuery()}if(e){e.config.performanceLogger.leaveMethod({name:"init search"})}})})}catch(n){o.onError(n)}},exit:function e(){if(this.oErrorPopover){this.oErrorPopover.destroy()}this.noResultScreen.destroy();if(this.oTablePersoController&&this.oTablePersoController.getTablePersoDialog()){this.oTablePersoController.getTablePersoDialog().destroy()}if(this!==null&&this!==void 0&&this.oSearchPage["oFacetDialog"]){this.oSearchPage["oFacetDialog"].destroy()}var t=this.getModel();t.unsubscribe("ESHSearchStarted",this.onAllSearchStarted,this);t.unsubscribe("ESHSearchFinished",this.onAllSearchFinished,this)},createContent:function e(){var t=this;this.oSearchFieldGroup=new a(this.getId()+"-searchInputHelpPageSearchFieldGroup");this.oSearchFieldGroup.setCancelButtonActive(false);this.oSearchFieldGroup.addStyleClass("sapUshellSearchInputHelpPageSearchFieldGroup");this.oSearchFieldGroup.input.setShowValueHelp(false);var r=this.getModel();r.setProperty("/inputHelp",this.oSearchFieldGroup.input);if(r.config.FF_optimizeForValueHelp){this.oSearchFieldGroup.setActionsMenuButtonActive(true);this.oSearchFieldGroup.setSelectQsDsActive(true)}if(r.config.FF_errorMessagesAsButton){this.oSearchFieldGroup.setMessagesButtonActive(true)}if(r!==null&&r!==void 0&&r.subscribe){if(!this.subscribeDone_SearchStarted){r.subscribe("ESHSearchStarted",this.onAllSearchStarted,this);this.subscribeDone_SearchStarted=true}if(!this.subscribeDone_SearchFinished){r.subscribe("ESHSearchFinished",this.onAllSearchFinished,this);this.subscribeDone_SearchFinished=true}}if(r){r.subscribe("ESHSearchFinished",function(){t.oSearchFieldGroup.input.setValue(r.getSearchBoxTerm())},this)}this.oSearchBar=new A(this.getId()+"-searchBar",{visible:{parts:[{path:"/count"},{path:"/facetVisibility"}],formatter:function e(t,a){var s;if(a){var i;return t!==0||(r===null||r===void 0?void 0:(i=r.config)===null||i===void 0?void 0:i.searchBarDoNotHideForNoResults)}return t!==0||(r===null||r===void 0?void 0:(s=r.config)===null||s===void 0?void 0:s.searchBarDoNotHideForNoResults)}},contentLeft:[this.assembleFilterButton(),this.assembleDataSourceTabBar()],contentRight:this.assembleResultViewButtonToolbar()});this.oSearchBar.addStyleClass("sapUshellSearchBar");if(r.config.FF_optimizeForValueHelp){this.oSearchBar.addStyleClass("sapUshellSearchBarValueHelp")}this.oFilterBar=new S;this.oSearchPage=this.createSearchPage(this.getId());this["addContent"](this.oSearchFieldGroup);var s=le(this.oSearchPage),i;try{for(s.s();!(i=s.n()).done;){var o=i.value;this["addContent"](o)}}catch(e){s.e(e)}finally{s.f()}},onAfterRendering:function e(){var t=this===null||this===void 0?void 0:this.getModel();if(t!==null&&t!==void 0&&t.subscribe){if(!this.subscribeDone_SearchStarted){t.subscribe("ESHSearchStarted",this.onAllSearchStarted,this);this.subscribeDone_SearchStarted=true}if(!this.subscribeDone_SearchFinished){t.subscribe("ESHSearchFinished",this.onAllSearchFinished,this);this.subscribeDone_SearchFinished=true}}},assembleFilterButton:function e(){var t=this;var r=this.getModel();var a=new F(this.getId()+"-searchBarFilterButton",{icon:R.getIconURI("filter"),tooltip:{parts:[{path:"/facetVisibility"}],formatter:function e(t){return t?de.getText("hideFacetBtn_tooltip"):de.getText("showFacetBtn_tooltip")}},pressed:{path:"/facetVisibility"},press:function e(r){var a=t.getModel();t.searchLayout.setProperty("animateFacetTransition",true);a.setFacetVisibility(r.getParameter("pressed"));t.searchLayout.setProperty("animateFacetTransition",false)},visible:{parts:[{path:"/businessObjSearchEnabled"},{path:"/count"}],formatter:function e(t,a){if(a===0){return false}return!sap.ui.Device.system.phone&&!r.config.FF_optimizeForValueHelp&&t}}});a.addStyleClass("searchBarFilterButton");return a},assembleSearchCountBreadcrumbs:function e(){var t,r;var a=this.getModel();var s;var i=a.getProperty("/count");if(a!==null&&a!==void 0&&(t=a.config)!==null&&t!==void 0&&t.assembleSearchCountBreadcrumbs){s=a.config.assembleSearchCountBreadcrumbs(a.getDataSource(),i)}else{s=new g("")}if(a!==null&&a!==void 0&&(r=a.config)!==null&&r!==void 0&&r.combinedResultviewToolbar){this.oSearchBar.addContentLeft(s);var o=new Z("",{items:[this.oSearchBar,this.oFilterBar]}).addStyleClass("sapElisaCombinedResultViewToolbar");o.addStyleClass("sapUiNoMarginBegin");o.addStyleClass("sapUiNoMarginEnd");return o}else{return s}},assembleCountBreadcrumbsHiddenElement:function e(){var t=new w("",{text:{parts:[{path:"/count"},{path:"/nlqSuccess"},{path:"/nlqDescription"}],formatter:function e(t,r,a){if(r){return a}if(typeof t!=="number"){return""}return de.getText("results_count_for_screenreaders",[t.toString()])}}});return t},assembleResultViewButtonToolbar:function e(){var t=this,r,a;var s=new B((this.getId()?this.getId()+"-":"")+"dataExportButton",{icon:"sap-icon://download",tooltip:"{i18n>exportData}",type:ge.Transparent,visible:{parts:[{path:"/count"},{path:"/tableColumns"}],formatter:function e(r,a){var s=t.getModel();if(s&&s.isHomogenousResult()&&r>0&&a.length>0){return true}else{return false}}},press:function e(){if(t.searchSpreadsheet===undefined){t.searchSpreadsheet=new c("ushell-search-spreadsheet")}t.searchSpreadsheet.onExport()}}).addStyleClass("sapUshellSearchTableDataExportButton");this.assembleResultViewSwitch();var i=new B("",{icon:"sap-icon://sort",tooltip:"{i18n>sortTable}",type:ge.Transparent,visible:{parts:[{path:"/count"},{path:"/sortableAttributes"}],formatter:function e(r,a){var s=t.getModel();if(s&&s.isHomogenousResult()&&r>0&&a.length>0){return true}else{return false}}},press:function e(){t.sortDialog.unbindAggregation("sortItems",false);t.sortDialog.bindAggregation("sortItems",{path:"/sortableAttributes",factory:function e(){return new Q("",{key:{path:"key"},text:{path:"name"},selected:{path:"selected"}})}});t.sortDialog.open()}});i.addStyleClass("sapUshellSearchTableSortButton");this.resultViewSwitch.addStyleClass("sapUshellSearchResultDisplaySwitch");var o=new O("",{visible:{parts:[{path:"/resultViewSwitchVisibility"},{path:"/count"}],formatter:function e(t,r){if(t===false||r===0){return false}else{return true}}}});var n=new B((this.getId()?this.getId()+"-":"")+"tablePersonalizeButton",{icon:"sap-icon://action-settings",tooltip:"{i18n>personalizeTable}",type:ge.Transparent,enabled:{parts:[{path:"/resultViewType"}],formatter:function e(t){return t==="searchResultTable"}},visible:{parts:[{path:"/count"},{path:"/tableColumns"}],formatter:function e(r,a){var s=t.getModel();if(s&&s.isHomogenousResult()&&r>0&&a.length>0){return true}else{return false}}},press:function e(){var r=t.getModel();var a="search-result-table-state-"+r.getDataSource().id;var s=t.oTablePersoController;s.getPersoService(a).getPersData().then(function(e){var t;if(typeof e==="undefined"||e===null){s.openDialog();return}var a=[];var i=e===null||e===void 0?void 0:(t=e.aColumns[0])===null||t===void 0?void 0:t.id;var o=i.substring(0,i.indexOf("TABLE_COLUMN_"));var n=r.getProperty("/tableColumns");if(r.config.extendTableColumn){n.forEach(function(e){var t;a.push({text:e.name,order:e.index,visible:e.index<7||e.attributeId===((t=r.config.extendTableColumn.column)===null||t===void 0?void 0:t.attributeId),id:o+e.key,group:null})})}else{n.forEach(function(e){a.push({text:e.name,order:e.index,visible:e.index<6,id:o+e.key,group:null})})}s.getTablePersoDialog().setInitialColumnState(a);s.openDialog()})}});n.addStyleClass("sapUshellSearchTablePersonalizeButton");var l=this.getModel();var u=[];var h=l===null||l===void 0?void 0:(r=l.config)===null||r===void 0?void 0:r.isUshell;if(h){var d=this.assembleShareButton();u=[s,i,n,d,o,this.resultViewSwitch]}else{u=[s,i,n,o,this.resultViewSwitch]}var p=l===null||l===void 0?void 0:(a=l.config)===null||a===void 0?void 0:a.getCustomToolbar();if((p===null||p===void 0?void 0:p.length)>0){p.push(new O("",{visible:{parts:[{path:"/resultViewSwitchVisibility"},{path:"/count"}],formatter:function e(t,r){return t&&r!==0}}}))}u=p.concat(u);return u},assembleShareButton:function e(){var t=this.getModel();var r=new sap.ushell.ui["footerbar"].AddBookmarkButton((this.getId()?this.getId()+"-":"")+"bookmarkButton",{width:"auto",beforePressHandler:function e(){var a={url:document.URL,title:t.getDocumentTitle(),icon:R.getIconURI("search")};r.setAppData(a)}});var a=new B((this.getId()?this.getId()+"-":"")+"emailButton",{icon:"sap-icon://email",text:de.getText("eMailFld"),width:"auto",press:function e(){sap.m.URLHelper.triggerEmail(null,t.getDocumentTitle(),document.URL)}});var s=new z((this.getId()?this.getId()+"-":"")+"shareActionSheet",{placement:fe.Bottom,buttons:[r,a]});this.addDependent(s);var i=new B((this.getId()?this.getId()+"-":"")+"shareButton",{icon:"sap-icon://action",tooltip:de.getText("shareBtn"),press:function e(){s.openBy(i)}});return i},assembleDataSourceTabBar:function e(){var t=this;var r=new D((this.getId()?this.getId()+"-":"")+"dataSourceTabBar",{expandable:false,stretchContentHeight:false,visible:{parts:[{path:"/facetVisibility"},{path:"/count"},{path:"/businessObjSearchEnabled"}],formatter:function e(t,r,a){return!t&&r>0&&a}},select:function e(a){var s=t.getModel();if(s.getDataSource()!==a.getParameter("item").getBindingContext().getObject()){s.setDataSource(a.getParameter("item").getBindingContext().getObject())}else{if(r["selectFired"]){r["selectFired"]=false}else{r["selectFired"]=true;r.fireSelect({item:a.getParameter("item")})}}}});this.tabBar=r;r.data("sap-ui-fastnavgroup","false",true);r.addStyleClass("searchTabStripBar");r.addStyleClass("searchTabStrips");r.addStyleClass("sapUiSmallMarginBegin");r.addStyleClass("sapUiNoMarginRight");r.setAriaTexts({headerLabel:de.getText("dataSources"),headerDescription:de.getText("dataSources")});r.bindAggregation("items",{path:"/tabStrips/strips",template:new E("",{key:"{id}",text:"{labelPlural}"})});r.addEventDelegate({onBeforeRendering:function e(){if(t.getModel().getProperty("/tabStrips")){if(r.getSelectedKey()!==t.getModel().getProperty("/tabStrips/selected").id){r.setSelectedKey(t.getModel().getProperty("/tabStrips/selected").id)}}}});return r},assembleResultViewSwitch:function e(){var t=this;if(this.resultViewSwitch!==undefined){return}this.resultViewSwitch=new V(this.getId()+"-ResultViewType",{selectedKey:"{/resultViewType}",visible:{parts:[{path:"/resultViewSwitchVisibility"},{path:"/count"}],formatter:function e(t,r){return t&&r!==0}},selectionChange:function e(r){var a=r.getParameter("item").getKey();t.setResultViewType(a)}});this.resultViewSwitch.bindAggregation("items",{path:"/resultViewTypes",factory:function e(t,r){var a=new L("",{visible:true});switch(r.getObject()){case"searchResultList":a.setIcon("sap-icon://list");a.setTooltip(de.getText("displayList"));a.setKey("searchResultList");break;case"searchResultTable":a.setIcon("sap-icon://table-view");a.setTooltip(de.getText("displayTable"));a.setKey("searchResultTable");break;case"searchResultGrid":a.setIcon("sap-icon://grid");a.setTooltip(de.getText("displayGrid"));a.setKey("searchResultGrid");break;default:a.setVisible(false)}return a}});this.resultViewSwitch.addStyleClass("sapUshellSearchresultViewSwitch")},isShowMoreFooterVisible:function e(){var t=this.getModel();return t.getProperty("/boCount")>t.getProperty("/boResults").length},assembleCenterArea:function e(t){var r=this;this.sortDialog=this.assembleSearchResultSortDialog();this.searchResultList=this.assembleSearchResultList();this.searchResultTable=this.assembleSearchResultTable(t);this.searchResultTable["addDelegate"]({onBeforeRendering:function e(){r.updateTableLayout()},onAfterRendering:function e(){var t=$(r.searchResultTable.getDomRef()).find("table > thead > tr:first");if(t){t.attr("aria-labelledby",r.countBreadcrumbsHiddenElement.getId())}}});this.searchResultGrid=this.assembleSearchResultGrid();this.appSearchResult=this.assembleAppSearch();this.showMoreFooter=this.assembleShowMoreFooter();var a=[this.sortDialog,this.searchResultList,this.searchResultTable,this.searchResultGrid,this.appSearchResult,this.showMoreFooter,this.countBreadcrumbsHiddenElement];return a},assembleSearchResultSortDialog:function e(){var t=this;var r=new q("",{sortDescending:{parts:[{path:"/orderBy"}],formatter:function e(t){return jQuery.isEmptyObject(t)||t.sortOrder==="DESC"}},confirm:function e(a){var s=a.getParameter("sortItem");var i=a.getParameter("sortDescending");var o=t.getModel();if(typeof s==="undefined"||s.getBindingContext().getObject().attributeId==="DEFAULT_SORT_ATTRIBUTE"){r.setSortDescending(true);o.resetOrderBy(true)}else{o.setOrderBy({orderBy:s.getBindingContext().getObject().attributeId,sortOrder:i===true?"DESC":"ASC"},true)}},cancel:function e(){},resetFilters:function e(){setTimeout(function(){r.setSortDescending(true);r.setSelectedSortItem("searchSortAttributeKeyDefault")},500)}});return r},assembleSearchResultGrid:function e(){var t=this.getModel();var r;if(typeof t.config.customGridView==="function"){r=t.config.customGridView()}else{var a=new te("",{rowSize:"11rem",columnSize:"11rem",gap:"0.5rem"});r=new u(this.getId()+"-ushell-search-result-grid",{layout:a,snapToRow:true})}if(!t.config.eshUseExtendedChangeDetection){r.bUseExtendedChangeDetection=false}r.bindProperty("visible",{parts:["/resultViewType","/count"],formatter:function e(t,r){return t==="searchResultGrid"&&r!==0}});r.addStyleClass("sapUshellSearchGrid");return r},assembleSearchResultTable:function e(t){var r=this;var a=this;var s=new l(t+"-ushell-search-result-table",{mode:{parts:[{path:"/multiSelectionEnabled"}],formatter:function e(t){return t===true?be.MultiSelect:be.None}},noDataText:"{i18n>noCloumnsSelected}",visible:{parts:[{path:"/resultViewType"},{path:"/count"}],formatter:function e(t,r){return t==="searchResultTable"&&r!==0}},popinLayout:Ce.GridLarge,rememberSelections:false,selectionChange:function e(){var t=r.getModel();t.updateMultiSelectionSelected()}});s.bindAggregation("columns",{path:"/tableColumns",factory:function e(r,s){var i=s.getObject();var o=new N(t+"-"+i.key,{header:new H("",{text:"{name}"}),visible:{parts:[{path:"index"},{path:"attributeId"}],formatter:function e(t,r){var s=a.getModel();if(s.config.extendTableColumn){return t<7||r===s.config.extendTableColumn.column.attributeId}return t<6}},width:"{width}"});return o}});s.bindItems({path:"/tableRows",factory:function e(t,r){return a.assembleTableItems(r)}});s.addEventDelegate({onAfterRendering:function e(){r.updatePersoServiceAndController();var t=$(r.getDomRef());t.find("table tbody tr").each(function(){var e=$(this);var t=sap.ui.getCore().byId(e.attr("id"));if(t){var r=t.getAriaLabelledBy();if($.inArray(a.countBreadcrumbsHiddenElement.getId(),r)===-1){t.addAriaLabelledBy(a.countBreadcrumbsHiddenElement)}}return false});t.find(".sapMListTblCell").each(function(){var e=$(this)[0];y.attachEventHandlersForTooltip(e)});t.find(".sapMListTblSubCntVal").each(function(){var e=$(this)[0];y.attachEventHandlersForTooltip(e)})}});return s},assembleTableItems:function e(t){var r=t.getObject();if(r.type==="footer"){return new G("",{visible:false})}return this.assembleTableMainItems(r,t.getPath())},assembleTableMainItems:function e(t,r){var a=this;var s=r+"/cells";var i=new j("",{selected:{path:"selected"}}).addStyleClass("sapUshellSearchTable");i.bindAggregation("cells",{path:s,factory:function e(t,r){if(r.getObject().isTitle){var s="";var i;var o=r.getObject().titleNavigation;if(o){s=o.getHref();i=o.getTarget()}var n=!!(s&&s.length>0);var l=new p("",{text:{path:"value"},enabled:n,press:function e(){var t=r.getObject().titleNavigation;if(t){t.performNavigation({trackingOnly:true})}}});l.setHref(s);var u=r.getObject().titleIconUrl;if(u){var c=new T("",{src:u});l.setAggregation("icon",c)}l.addStyleClass("sapUshellSearchResultListItem-MightOverflow");l.addStyleClass("sapUshellSearchTableTitleLink");if(i){l.setTarget(i)}var h=l;var g=r.getObject().titleInfoIconUrl;if(g){var f=new T("",{src:g,tooltip:de.getText("collectionShared")}).addStyleClass("sapUshellSearchTableTitleInfoIcon");if(!n){f.addStyleClass("sapUshellSearchTableTitleInfoIconDisabled")}h=new Y("",{items:[l,f]})}return h}if(r.getObject().isRelatedApps){var v=r.getObject().navigationObjects;var b=[];var S;var m=function e(t,r){r.performNavigation()};for(var y=0;y<v.length;y++){var C=v[y];S=new B("",{text:C.getText(),tooltip:C.getText()});S.attachPress(C,m);b.push(S)}var w=new B("",{icon:"sap-icon://action",press:function e(){var t=new z("",{buttons:b,placement:fe.Auto});t.openBy(w)}});w.addStyleClass("sapElisaSearchTableRelatedAppsButton");return w}if(r.getObject().isExtendTableColumnCell){var R=a.getModel();return R.config.extendTableColumn.bindingFunction(r.getObject())}var M=new d("",{text:{path:"value"},isForwardEllipsis4Whyfound:true}).addStyleClass("sapUshellSearchResultListItem-MightOverflow");if(r.getObject().icon){var I=new T("",{src:r.getObject().icon});M.setAggregation("icon",I)}return M}});return i},assembleShowMoreFooter:function e(){var t=this;var r=new B("",{text:"{i18n>showMore}",type:ge.Transparent,press:function e(){var r=t.getModel();r.setProperty("/focusIndex",r.getTop());var a=r.getTop()+r.pageSize;r.setTop(a);r.eventLogger.logEvent({type:Re.SHOW_MORE})}});r.addStyleClass("sapUshellResultListMoreFooter");var a=new k("",{visible:{parts:[{path:"/boCount"},{path:"/boResults"}],formatter:function e(t,r){return r.length<t}},justifyContent:ye.Center});a.addStyleClass("sapUshellResultListMoreFooterContainer");a.addItem(r);return a},assembleSearchResultList:function e(){var t=this;var r=new n("",{mode:be.None,width:"auto",showNoData:false,visible:{parts:[{path:"/resultViewType"},{path:"/count"}],formatter:function e(t,r){return t==="searchResultList"&&r!==0}}});r.bindItems({path:"/results",factory:function e(r,a){return t.assembleListItem(a)}});return r},assembleAppSearch:function e(){var t=this;var r=new te("",{rowSize:"5.5rem",columnSize:"5.5rem",gap:"0.25rem"});var a=new ee("",{layout:r,snapToRow:true,visible:{parts:[{path:"/count"}],formatter:function e(r){var a=t.getModel();return(a.isAppCategory()||a.isUserCategoryAppSearchOnlyWithoutBOs())&&r!==0}},items:{path:"/appResults",factory:function e(r,a){var s=t.getModel();if(s.isAppCategory()||s.isUserCategoryAppSearchOnlyWithoutBOs()){var i=a.getObject();var o=i.visualization;var n=s.uShellVisualizationInstantiationService;var l=n.instantiateVisualization(o);l.attachPress(function(){s.eventLogger.logEvent({type:Re.TILE_NAVIGATE,tileTitle:o.title,targetUrl:o.targetURL})});l.addEventDelegate({onAfterRendering:t.highlightTile});l.setActive(false,true);l.setLayoutData(new re(l.getLayout()));return l}return new _("",{text:""})}}});a.addStyleClass("sapUshellSearchGridContainer");var s=new B("",{text:"{i18n>showMore}",type:ge.Transparent,visible:{parts:[{path:"/appCount"},{path:"/appResults"}],formatter:function e(r,a){var s=t.getModel();return(s.isAppCategory()||s.isUserCategoryAppSearchOnlyWithoutBOs())&&a.length<r}},press:function e(){var r=t.getModel();var a=r.getTop()+r.pageSize;r.setProperty("/focusIndex",r.getTop());r.setTop(a);r.eventLogger.logEvent({type:Re.SHOW_MORE})}});s.addStyleClass("sapUshellResultListMoreFooter");var i=new M("",{width:"100%",visible:{parts:[{path:"/count"}],formatter:function e(r){var a=t.getModel();return(a.isAppCategory()||a.isUserCategoryAppSearchOnlyWithoutBOs())&&r!==0}},content:[a,s]});i.addStyleClass("sapUshellResultApps");return i},highlightTile:function e(t){var r;var a=(r=t["srcControl"])===null||r===void 0?void 0:r.getAggregation("content");if(a){var s=a.findAggregatedObjects(true,function(e){return e.isA("sap.m.GenericTile")||e.isA("sap.f.Card")});if(s.length===0&&a.getComponentInstance){s=a.getComponentInstance().findAggregatedObjects(true,function(e){return e.isA("sap.m.GenericTile")||e.isA("sap.f.Card")})}if(s.length>0){var i;var o=s[0];var n=new pe;n.setHighlightTerms((i=t["srcControl"])===null||i===void 0?void 0:i.getModel().getProperty("/uiFilter/searchTerm"));n.highlight(o)}}},assembleAppContainerResultListItem:function e(){var t=this;var r=this;var a=new te("",{rowSize:"5.5rem",columnSize:"5.5rem",gap:"0.25rem"});var s=new ee("",{layout:a,snapToRow:true,items:{path:"/appResults",factory:function e(r,a){var s=t.getModel();if(!s.isAppCategory()){var i=a.getObject();var o=i.visualization;var n=s.uShellVisualizationInstantiationService;var l=n.instantiateVisualization(o);l.attachPress(function(){var e=t.getModel();e.eventLogger.logEvent({type:Re.TILE_NAVIGATE,tileTitle:o.title,targetUrl:o.targetURL})});l.addEventDelegate({onAfterRendering:t.highlightTile});l.setActive(false,true);l.setLayoutData(new re(l.getLayout()));return l}return new _(r,{text:""})}}});s.addStyleClass("sapUshellSearchGridContainer");s.addEventDelegate({onAfterRendering:function e(){var t=this;var a=r.getModel();if(this.getDomRef().clientWidth===0){return}var s=this.getDomRef().clientWidth-176;var i=Math.floor(s/184);var o=this.getItems();var n=a.getProperty("/appCount");var l=a.getProperty("/boCount");if(o.length>i+1){var u=0,c=0;for(;c<o.length;c++){u=u+o[c].getDomRef().clientWidth+8;if(u>s){break}}var h=a.getProperty("/appResults");a.setProperty("/appResults",h.slice(0,c))}else{var d=o[o.length-1];if(n>i&&!d.hasStyleClass("sapUshellSearchResultListItemAppsShowMore")){var p=new W("",{tileContent:new K("",{content:new _("",{text:de.getText("showMoreApps")})}),press:function e(){var r=t.getModel();r.setDataSource(r.appDataSource)}});p.addStyleClass("sapUshellSearchResultListItemAppsShowMore");this.addItem(p);a.setProperty("/resultViewType","appSearchResult");a.setProperty("/resultViewType","searchResultList");a.setProperty("/boCount",0);a.setProperty("/boCount",l)}}}},s);var i=new G("",{content:s});i.addStyleClass("sapUshellSearchResultListItem");i.addStyleClass("sapUshellSearchResultListItemApps");i.addEventDelegate({onAfterRendering:function e(){var t=$(i.getDomRef());t.removeAttr("tabindex");t.removeAttr("role");t.attr("aria-hidden","true")}},i);return i},assembleResultListItem:function e(t){var r=this.getModel();var a=r.config.getDataSourceConfig(t.dataSource);var s={dataSource:t.dataSource,title:"{title}",titleDescription:"{titleDescription}",titleNavigation:"{titleNavigation}",type:"{dataSourceName}",imageUrl:"{imageUrl}",imageFormat:"{imageFormat}",imageNavigation:"{imageNavigation}",geoJson:"{geoJson}",attributes:{path:"itemattributes"},navigationObjects:{path:"navigationObjects"},selected:{path:"selected"},expanded:{path:"expanded"},positionInList:{path:"positionInList"},resultSetId:{path:"resultSetId"},layoutCache:{path:"layoutCache"},titleIconUrl:{path:"titleIconUrl"},titleInfoIconUrl:{path:"titleInfoIconUrl"}};var i;if(a.searchResultListItemControl){i=new a.searchResultListItemControl(s)}else if(a.searchResultListItemContentControl){s["content"]=new a.searchResultListItemContentControl;i=new v(s)}else{i=new f(s)}if(i.setCountBreadcrumbsHiddenElement){i.setCountBreadcrumbsHiddenElement(this.countBreadcrumbsHiddenElement)}var o=new G("",{content:i,type:Se.Inactive});o.addStyleClass("sapUshellSearchResultListItem");if(i.setParentListItem){i.setParentListItem(o)}return o},assembleListItem:function e(t){var r=t.getObject();if(r.type==="footer"){return new G}else if(r.type==="appcontainer"){return this.assembleAppContainerResultListItem()}return this.assembleResultListItem(r)},onAllSearchStarted:function e(){this.fireEvent("searchStarted")},onAllSearchFinished:function e(){var t=this.getModel();if(t.getProperty("/count")>0){var r;if(t!==null&&t!==void 0&&(r=t.config)!==null&&r!==void 0&&r.assembleSearchCountBreadcrumbs){var a;if(t!==null&&t!==void 0&&(a=t.config)!==null&&a!==void 0&&a.combinedResultviewToolbar){this.oSearchBar.removeContentLeft(2);this.oSearchBar.addContentLeft(t.config.assembleSearchCountBreadcrumbs(t.getDataSource(),t.getProperty("/count")))}else{this.oSearchResultListContainer.setCountBreadcrumbs(t.config.assembleSearchCountBreadcrumbs(t.getDataSource(),t.getProperty("/count")))}}}this.reorgTabBarSequence();this.chooseNoResultScreen();this.oFocusHandler.setFocus();var s=sap.ui.getCore().byId("viewPortContainer");if(s!==null&&s!==void 0&&s.switchState){s.switchState("Center")}this.fireEvent("searchFinished")},updatePersoServiceAndController:function e(){var t=this.getModel();var r=t.getDataSource().id;var a="search-result-table-state-"+r;var s="".concat(this.getId(),"-ushell-search-result-table");var i=sap.ui.getCore().byId(s);if(i instanceof l){if(!this.oTablePersoController){var o=t.getPersonalizationStorageInstance();var n=t.config.isUshell?"sap.ushell.renderers.fiori2.search.container":"";this.oTablePersoController=new ae("",{table:i,persoService:o.getPersonalizer(a),componentName:n}).activate();this.oTablePersoController.refresh()}if(this.oTablePersoController&&this.oTablePersoController.getPersoService().getKey()!==a||this.resultTableMode!=i.getMode()){this.oTablePersoController.setPersoService(t.getPersonalizationStorageInstance().getPersonalizer(a));this.oTablePersoController.refresh();this.resultTableMode=i.getMode()}}},updateTableLayout:function e(){var t=this;if(this.searchResultTable&&this.oTablePersoController){var r=this.getModel();var a=r.getDataSource().id;var s="search-result-table-state-".concat(a);this.oTablePersoController.getPersoService(s).getPersData().then(function(e){if(e&&e.aColumns){var r=e.aColumns;var a=0;for(var s=0;s<r.length;s++){if(r[s].id===undefined){break}var i=r[s].id.split("table-TABLE_COLUMN_").pop();var o=t._getUI5TableColumn("TABLE_COLUMN_"+i);if(o){o.setDemandPopin(false);if(r[s].visible){a++;o.setDemandPopin(true);o.setPopinDisplay(me.Inline);var n=12*a;o.setMinScreenWidth(n+"rem")}}}if(a<=3){t.searchResultTable.setFixedLayout(false)}else{t.searchResultTable.setFixedLayout(true)}}})}},_getUI5TableColumn:function e(t){var r=this.searchResultTable.getColumns();if(!Array.isArray(r)||r.length===0){return undefined}for(var a=0;a<r.length;a++){var s=r[a].getBindingContext().getObject();if(s["key"]===t){return r[a]}}return undefined},createSearchPage:function e(t){var r=this.getModel();this.oFilterBar.bindProperty("visible",{parts:[{path:"/facetVisibility"},{path:"/uiFilter/rootCondition"}],formatter:function e(t,a){var s=false;if(!t&&a&&a.hasFilters()){s=true}if(a&&r.filterWithoutFilterByConditions()){s=false}if(a&&typeof r.config.hasSpaceFiltersOnly==="function"){if(r.config.hasSpaceFiltersOnly(a)===true){s=false}}return s}});var a;if(r.config.FF_errorMessagesAsButton){}else{a=this.createFooter(this.getId());if(a){a.bindProperty("visible",{parts:[{path:"/errors/length"}],formatter:function e(t){var r=t>0?true:false;return r}})}}var s;if(r.config.combinedResultviewToolbar){s=[this.createSearchContainer(t)]}else{s=[this.oSearchBar,this.oFilterBar,this.createSearchContainer(t)]}if(a){s.push(a)}return s},createNoResultScreen:function e(t){var r=this;this.noResultScreen=new h("".concat(t,"-searchContainerResultsView-noResultScreen"),{isUshell:{path:"/config/isUshell"},dataSource:{path:"/uiFilter/dataSource"},appSearchDataSource:{path:"/appSearchDataSource"},searchBoxTerm:{parts:[{path:"/queryFilter/searchTerm"}],formatter:function e(t){return t}},visible:{parts:[{path:"/count"},{path:"/isBusy"},{path:"/firstSearchWasExecuted"}],formatter:function e(t,a,s){var i=t===0&&!a&&s;r._oLogger.debug('No result screen is visible: " '.concat(i,". count: ").concat(t,", isBusy: ").concat(a,", firstSearchWasExecuted: ").concat(s));return i}},toolbar:[new B({text:de.getText("noResultsPageBackButton"),visible:{path:"/config/displayNoResultsPageBackButton"},press:function e(){window.history.back()}}).addStyleClass("sapUiTinyMarginEnd"),new B({text:de.getText("noResultsPageSearchAllButton"),visible:{path:"/config/displayNoResultsPageSearchAllButton"},press:function e(){var t=r.getModel();t.resetTop();t.setSearchBoxTerm("",false);t.resetDataSource(false);t.resetAllFilterConditions(true)}})]});return this.noResultScreen},createSearchContainer:function e(t){this.countBreadcrumbsHiddenElement=this.assembleCountBreadcrumbsHiddenElement();this.centerArea=this.assembleCenterArea(t);this.oSearchResultListContainer=new o("".concat(t,"-searchContainerResultsView"),{centerArea:this.centerArea,countBreadcrumbs:this.assembleSearchCountBreadcrumbs(),noResultScreen:this.createNoResultScreen(t),countBreadcrumbsHiddenElement:this.countBreadcrumbsHiddenElement});var r=this.getModel();var a={resultListContainer:this.oSearchResultListContainer,searchIsBusy:{path:"/isBusy"},busyDelay:{path:"/busyDelay"},showFacets:{parts:[{path:"/count"},{path:"/facetVisibility"},{path:"/uiFilter/rootCondition"},{path:"/isBusy"},{path:"/config"}],formatter:function e(t,r,a,s,i){var o=true;if(!r){o=false}var n=a&&a.conditions&&a.conditions.length>0;if(t===0&&!i.displayFacetPanelInCaseOfNoResults&&!n&&!s){o=false}return o}},facetPaneResizable:r.config.layoutUseResponsiveSplitter,facetPanelWidthInPercent:r.config.facetPanelWidthInPercent,facets:new m("".concat(this.getId(),"-SearchFacetFilter")),combinedResultviewToolbar:r.config.combinedResultviewToolbar};this.searchLayout=new i("".concat(this.getId(),"-searchLayout"),a).addStyleClass("sapUshellSearchLayout");this.searchContainer=this.searchLayout;return this.searchContainer},createFooter:function e(t){var r=this;var a=this.getModel();this.oErrorPopover=new J(t+"-searchMessagePopover",{placement:fe.Top});this.oErrorPopover.setModel(a);a.setProperty("/messagePopoverControlId",this.oErrorPopover.getId());this.oErrorPopover.bindAggregation("items",{path:"/errors",factory:function e(){var t=new X("",{title:"{title}",description:"{description}"});return t}});var s=new B(this.getId()+"-searchErrorButton",{icon:R.getIconURI("alert"),text:{parts:[{path:"/errors/length"}],formatter:function e(t){return t}},visible:{parts:[{path:"/errors/length"}],formatter:function e(t){return t>0},mode:I.OneWay},type:ge.Emphasized,tooltip:de.getText("errorBtn"),press:function e(){if(r.oErrorPopover.isOpen()){r.oErrorPopover.close()}else{r.oErrorPopover.setVisible(true);r.oErrorPopover.openBy(s)}}});s["addDelegate"]({onAfterRendering:function e(){var t=r.getModel();if(!t.getProperty("/isErrorPopovered")){s.firePress();t.setProperty("/isErrorPopovered",true)}}});s.setLayoutData(new x("",{priority:ve.NeverOverflow}));var i=new U(this.getId()+"-searchFooter",{content:[s]});return i},chooseNoResultScreen:function e(){var t;var r=this.getModel();var a;if(typeof(r===null||r===void 0?void 0:(t=r.config)===null||t===void 0?void 0:t.getCustomNoResultScreen)==="function"){a=r.config.getCustomNoResultScreen(r.getDataSource(),r)}if(!a){a=this.oSearchResultListContainer.getAggregation("noResultScreen")}this.oSearchResultListContainer.setNoResultScreen(a)},reorgTabBarSequence:function e(){if(!this.tabBar){return}var t=new x("",{priority:ve.High});var r=new x("",{priority:ve.NeverOverflow});var a=this.tabBar.getContent();for(var s=0;s<a.length;s++){if(this.getModel().getProperty("/tabStrips/selected")===a[s].getBindingContext().getObject()){a[s].setLayoutData(r)}else{a[s].setLayoutData(t)}}},getResultViewTypes:function e(){var t=this.getModel();return t===null||t===void 0?void 0:t.getResultViewTypes()},setResultViewTypes:function e(t){var r=this.getModel();if(typeof t==="undefined"){throw Error("Search Result View Type Error In SearchCompositeControl:\n\n"+"The function parameter 'resultViewTypes' is mandatory.\n"+'Valid example: setResultViewTypes(["searchResultList"])')}else if(typeof r==="undefined"||typeof r.config==="undefined"){return this}this.setResultViewSettings({resultViewTypes:t,resultViewType:r.getResultViewType()});return this},getResultViewType:function e(){var t=this.getModel();return t===null||t===void 0?void 0:t.getResultViewType()},setResultViewType:function e(t){var r=this.getModel();if(typeof t==="undefined"){throw Error("Search Result View Type Error In SearchCompositeControl:\n\n"+"The function parameter 'resultlViewType' is mandatory.\n"+'Valid example: setResultViewType("searchResultList")')}else if(typeof r==="undefined"||typeof r.config==="undefined"){return this}this.setResultViewSettings({resultViewTypes:r.getResultViewTypes(),resultViewType:t});return this},getResultViewSettings:function e(){var t=this.getModel();if(t){return{resultViewTypes:t.getResultViewTypes(),resultViewType:t.getResultViewType()}}},setResultViewSettings:function e(t){var r=this.getModel();if(typeof t==="undefined"){throw Error("Search Result View Type Error In SearchCompositeControl:\n\n"+"The function parameter 'resultlViewSettings' is mandatory.\n"+'Valid example: setResultViewSettings({resultViewTypes: ["searchResultList", "searchResultTable"], resultViewType: "searchResultList"})')}else if(typeof r==="undefined"||typeof r.config==="undefined"){return this}if(typeof t.resultViewTypes==="undefined"||typeof t.resultViewType==="undefined"){throw Error("Search Result View Type Error In SearchCompositeControl:\n\n"+"One of properties of function parameter is undefined.\n"+'Valid example: setResultViewSettings({resultViewTypes: ["searchResultList", "searchResultTable"], resultViewType: "searchResultList"})')}r.calculateResultViewSwitchVisibility({resultViewTypes:t.resultViewTypes,resultViewType:t.resultViewType});this.showMoreFooter.setVisible(this.isShowMoreFooterVisible());r.enableOrDisableMultiSelection();r._firePerspectiveQuery();return this},getControllerName:function e(){return"sap.esh.search.ui.container.Search"},getCssClass:function e(){return this._cssClass},setCssClass:function e(t){if(t&&!this.hasStyleClass(t)){this._cssClass=t;this.addStyleClass(t)}return this},getDataSource:function e(){if(typeof this.getModel()!=="undefined"){var t=this.getModel();var r=t.getDataSource();return r.id}},setDataSource:function e(t,r,a){if(typeof this.getModel()!=="undefined"){var s=this.getModel();s.setDataSourceById(t,r,a)}return this},getSearchTerm:function e(){if(typeof this.getModel()!=="undefined"){var t=this.getModel();return t.getSearchBoxTerm()}return Me.getMetadata().getPropertyDefaults()["searchTerm"]},setSearchTerm:function e(t,r){if(typeof this.getModel()!=="undefined"){var a=this.getModel();a.setSearchBoxTerm(t,r)}return this},getFilterRootCondition:function e(){if(this.getModel()){var t=this.getModel();return t.getFilterRootCondition()}return Me.getMetadata().getPropertyDefaults()["filterRootCondition"]},setFilterRootCondition:function e(t,r){if(this.getModel()){var a=this.getModel();a.setFilterRootCondition(t,r)}return this},renderSearchUrlFromParameters:function e(t,r,a){var s=this.getModel();if(!s){throw new Te(null,"cannot construct URL because model is undefined")}return s.searchUrlParser.renderFromParameters(t,r,a)}});Me.eshCompCounter=0;return Me})})();
//# sourceMappingURL=SearchCompositeControl.js.map