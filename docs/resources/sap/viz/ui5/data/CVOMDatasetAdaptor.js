/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/viz/ui5/controls/common/utils/Constants","sap/ui/model/Sorter","sap/ui/thirdparty/jquery","sap/base/util/deepEqual"],function(t,e,jQuery,a){"use strict";function n(t){return Object.prototype.toString.call(t)==="[object Array]"}function i(t,e,n,i,r){var s={dataset:null,context:null};if(!n||n.length===0){return s}var o=[],u=[],d=[],f=[],l=[];jQuery.each(t,function(t,e){if(e.getAxis()===1){o.push({def:e,adapter:e._getAdapter()})}else if(e.getAxis()===2){u.push({def:e,adapter:e._getAdapter()})}else{throw new Error("currently, only axis 1 and 2 are supported")}});jQuery.each(e,function(t,e){d.push({def:e,adapter:e._getAdapter()});f.push([])});function p(t,e,n){var i=t.length,r,s;if(i===0){return 0}r=[];for(s=0;s<i;s++){r.push(t[s].adapter(n))}for(s=0,i=e.length;s<i;s++){if(a(e[s],r)){return s}}e.push(r);return e.length-1}var h=[];var g=[];jQuery.each(n,function(t,e){var a=p(o,h,e);var n=p(u,g,e);for(var i=0;i<d.length;i++){var r=d[i].adapter(e);if(o.length===0&&u.length===0){if(f[i][0]===undefined){f[i][0]=[]}f[i][0].push(r)}else{(f[i][n]=f[i][n]||[])[a]=r}}if(o.length===0&&u.length===0){a=t}(l[n]||(l[n]=[]))[a]=e});var v=h.length;var m=Math.max(g.length,1);for(var c=0;c<m;c++){for(var _=0;_<d.length;_++){var y=f[_][c];if(!y){y=f[_][c]=[]}if(y.length<v){y[v-1]=undefined}}if(!l[c]){l[c]=[]}if(!l[c].length<v){l[c][v]=undefined}}var T={};if(o.length>0){if(T.analysisAxis===undefined){T.analysisAxis=[]}var A={index:1,data:[]};for(var _=0;_<o.length;_++){var x=[];for(var c=0;c<h.length;c++){x[c]=h[c][_]}A.data.push({name:o[_].def.getName(),values:x})}T.analysisAxis.push(A)}if(u.length>0){if(T.analysisAxis===undefined){T.analysisAxis=[]}var A={index:2,data:[]};for(var _=0;_<u.length;_++){var x=[];for(var c=0;c<g.length;c++){x[c]=g[c][_]}A.data.push({name:u[_].def.getName(),values:x})}T.analysisAxis.push(A)}if(d.length>0){T.measureValuesGroup=[];for(var _=0;_<d.length;_++){if(!T.measureValuesGroup[d[_].def.getGroup()-1]){T.measureValuesGroup[d[_].def.getGroup()-1]={index:d[_].def.getGroup(),data:[]}}T.measureValuesGroup[d[_].def.getGroup()-1].data.push({name:d[_].def.getName(),values:f[_]})}for(var _=0,D=T.measureValuesGroup.length;_<D;_++){if(T.measureValuesGroup[_]===undefined){throw new Error("Measure Group "+(_+1)+" is missing.")}}}s.dataset=r?new sap.viz.data.CrosstableDataset:new sap.viz.api.data.CrosstableDataset;s.dataset.data(T);if(i){s.dataset.info(i)}s.context=l;return s}function r(t,a){var n=t&&t.value||t,i=a&&a.value||a;return e.defaultComparator(n,i)}function s(e,a,i,s,o,u){var d={dataset:null,context:null};var f=["_context_row_number"];if(i){if(!n(i)){i=[i]}for(var l=0;l<i.length;++l){var p=i[l];var h=!(p.showInTooltip===false);if(p.id){p=p.id}f.push({id:p,showInTooltip:h})}}var g=[],v=[],m=[],c={metadata:{fields:[]},context:f,data:[]},_=[];jQuery.each(e,function(t,e){g.push({def:e,vAdapter:e._getAdapter(),dAdapter:e._getDisplayValueAdapter()});var a=e.getDataType();var n=e.getSorter();var i={id:e.getIdentity()||e.getName(),name:e.getName()||e.getIdentity(),semanticType:"Dimension",dataType:a,inResult:e._getInResult(),timeUnitType:e._getTimeUnit()};if(n&&typeof n==="object"){var s={bDescending:n.bDescending};s.fnComparator=function(t,e){var a={value:t&&t.v||t,displayValue:t&&t.d},i={value:e&&e.v||e,displayValue:e&&e.d};var s=n.fnComparator&&typeof n.fnComparator==="function"?n.fnComparator:r;return s(a,i)};i["sorter"]=s}c.metadata.fields.push(i)});jQuery.each(a,function(t,e){v.push({def:e,adapter:e._getAdapter()});var a={id:e.getIdentity()||e.getName(),name:e.getName()||e.getIdentity(),semanticType:"Measure"};a.formatString=e.getFormat();if(e.getUnit()){a.unit=e.getUnit()}a.unitBinding=e._getUnitBinding();var n=e.getRange();if(n&&n.length){a.min=n[0];a.max=n[1]}c.metadata.fields.push(a)});if(o){if(o.bEnabled){c.metadata.options={pagination:{mode:o.sMode,ratio:o.thumbRatio}}}}if(!s||s.length===0){d.dataset=new sap.viz.api.data.FlatTableDataset(c);return d}if(o&&(!u||o.sMode==="reset")){u=[]}jQuery.each(s,function(e,a){if(!c.data[e]){c.data[e]=[]}for(var n=0;n<g.length;n++){var i=g[n].vAdapter(a);if(i instanceof Date){i=i.getTime()}var r=g[n].dAdapter(a);c.data[e].push(r.enableDisplayValue?{v:i,d:r.value}:i)}for(var s=0;s<v.length;s++){var i=v[s].adapter(a);c.data[e].push(i);var d=v[s].def._getUnitBinding();if(d){var f=a.getProperty(d);f=f&&f.trim&&f.trim();if(f){if(m[s]){if(m[s]==="*"||m[s]!==f||o&&u[s]!==f){throw t.ERROR_MESSAGE.MULTIPLEUNITS}}else{m[s]=f;if(o&&!u[s]){u[s]=f}}}}}_[e]=a});d.context=_;c.metadata.fields.filter(function(t){return t.semanticType==="Measure"}).forEach(function(t,e){if(t.unitBinding&&m[e]){t.unit=m[e];delete t.unitBinding}});d.dataset=new sap.viz.api.data.FlatTableDataset(c);return d}var o=function(){this._oCVOMDataset=null;this._aContext=null;this._sDatasetType=null;this._pagingUnit=null};o.prototype.getDataset=function(e){if(this._sDatasetType===e.type&&this._oCVOMDataset){return this._oCVOMDataset}this.invalidate();this._sDatasetType=e.type;var a=null;if(this._sDatasetType===t.DATASET_TYPES.FLATTABLEDATASET){a=s(e.dimensions,e.measures,e.contexts,e.dataContexts,e.pagingOption,this._pagingUnit)}else{a=i(e.dimensions,e.measures,e.dataContexts,e.additionalInfo,this._sDatasetType==t.DATASET_TYPES.CROSSTABLEDATASET?false:true)}this._oCVOMDataset=a.dataset;this._aContext=a.context;return this._oCVOMDataset};o.prototype.findContext=function(e){if(this._sDatasetType===t.DATASET_TYPES.FLATTABLEDATASET){if(this._aContext&&typeof e==="object"&&e._context_row_number!==undefined){return this._aContext[e._context_row_number]}}else{if(this._aContext&&typeof e==="object"){return this._aContext[e.dii_a2]&&this._aContext[e.dii_a2][e.dii_a1]}}return null};o.prototype.invalidate=function(){this._oCVOMDataset=null;this._aContext=null};return o},true);
//# sourceMappingURL=CVOMDatasetAdaptor.js.map