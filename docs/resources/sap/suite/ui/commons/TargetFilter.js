/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/m/library","sap/ui/comp/library","sap/ui/core/Control","sap/m/ComboBox","sap/m/Popover","sap/m/Link","sap/m/StandardListItem","sap/ui/core/delegate/ItemNavigation","sap/m/Button","sap/m/SelectDialog","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Element","sap/m/Text","sap/m/Bar","sap/ui/model/Sorter","sap/ui/Device","sap/m/Label","sap/m/List","sap/m/ScrollContainer","sap/m/HBox","sap/m/VBox","sap/ui/comp/variants/VariantManagement","sap/m/GroupHeaderListItem","sap/ui/core/Item","sap/ui/events/KeyCodes","sap/base/Log","./TargetFilterRenderer"],function(jQuery,t,e,i,s,a,r,n,o,l,h,d,u,g,p,c,_,m,f,v,C,S,y,T,F,I,b,w,L,x){"use strict";var P=s.extend("sap.suite.ui.commons.TargetFilter",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null}},aggregations:{columns:{type:"sap.suite.ui.commons.TargetFilterColumn",multiple:true,singularName:"column"},_countDisplay:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_quad0:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_quad1:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_quad2:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_quad3:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},measureColumn:{type:"sap.suite.ui.commons.TargetFilterMeasureColumn",multiple:false}},associations:{selectedColumns:{type:"sap.suite.ui.commons.TargetFilterColumn",multiple:true,singularName:"selectedColumn"}},events:{search:{},filterChange:{},cancel:{}}}});var k=a.extend("sap.suite.ui.commons.TargetFilterComboBox",{metadata:{properties:{popoverPlacement:{type:"sap.m.PlacementType",group:"Misc",defaultValue:"Bottom"}}},_createPopover:function(){var t=new r({showHeader:false,placement:this.getPopoverPlacement(),offsetX:0,offsetY:0,initialFocus:this,bounce:false});t.addStyleClass("TFComboBox");this._decoratePopover(t);return t},renderer:"sap.m.ComboBoxRenderer"});var A=n.extend("sap.suite.ui.commons.TargetFilterLink",{metadata:{properties:{count:{type:"int"},key:{type:"string"}}},onmouseover:function(t){if(this.$()[0].scrollWidth>this.$().innerWidth()){this.firePress()}},renderer:"sap.m.LinkRenderer"});var E=o.extend("sap.suite.ui.commons.TargetFilterListItem",{metadata:{properties:{index:{type:"int"},key:{type:"string"}}},ontap:function(t){if(!jQuery(t.target).hasClass("sapMCbMarkChecked")){this.setSelected(!this.getSelected());this.informList("Select",!this.getSelected())}this.firePress()},onkeyup:function(t){if(t.which===w.ENTER||t.which===w.SPACE){this.firePress()}},renderer:"sap.m.StandardListItemRenderer"});var R=s.extend("sap.suite.ui.commons.TargetFilterLinksCloud",{metadata:{properties:{index:{type:"int"}},aggregations:{links:{cardinality:"0..n",type:"sap.suite.ui.commons.TargetFilterLink"}}},init:function(){var t=this;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");this._oOthersLink=new A(this.getId()+"-others-link",{text:"+000 "+t._oRb.getText("TARGETFILTER_MORE_TEXT"),press:function(){var e=t.getParent();var i=Object.getOwnPropertyNames(e._oFilters);var s=0;for(var a=0;a<i.length;a++){if(!e._oFilters[i[a]].linkId){delete e._oFilters[i[a]];s++}}this.setCount(this.getCount()-s);e.fireFiltersChanged()}});this._oOthersLink.addStyleClass("sapSuiteUiTFOthersLine");this._oOthersLink.setEmphasized(true).setSubtle(false);this._oOthersLink.setCount=function(e){this.setProperty("count",e,true);if(e>0){this.$().removeClass("Hidden");this.setText("+"+e+" "+t._oRb.getText("TARGETFILTER_MORE_TEXT"))}else{this.$().addClass("Hidden")}}},exit:function(){this._oOthersLink.destroy()},_setFontSizes:function(t){var e=["Large","Medium","Small","Smallest"];var i=jQuery.unique(t.map(function(t){return t.getCount()}));switch(i.length){case 1:for(var s=0;s<t.length;s++){t[s].addStyleClass(e[1])}break;case 2:for(var s=0;s<t.length;s++){if(i[0]===t[s].getCount()){t[s].addStyleClass(e[1])}else{t[s].addStyleClass(e[2])}}break;default:var a=Math.min.apply(null,i);var r=Math.max.apply(null,i);for(var s=0;s<t.length;s++){var n=Math.floor(3.99*(r-t[s].getCount())/(r-a));t[s].addStyleClass(e[n])}}},renderer:function(t,e){var i=e.getLinks();t.write("<div");t.writeControlData(e);t.addClass("sapSuiteUiTFLinksCloud");t.writeClasses();t.write(">");e._setFontSizes(i);for(var s=0;s<i.length;s++){if(!!i[s].getText()){t.renderControl(i[s])}}e._oOthersLink.addStyleClass("Quad"+e.getIndex()).addStyleClass("Hidden");t.renderControl(e._oOthersLink);t.write("</div>")},updateVisibleLinks:function(){var t=this.getParent();var e=this.$().find(".sapSuiteUiTFLine:not(.Hidden)");var i=0;var s=Object.getOwnPropertyNames(t._oFilters);for(var a=0;a<s.length;a++){delete t._oFilters[s[a]].linkId}e.each(function(){var e=sap.ui.getCore().byId(this.id);var s=t._oFilters[e.getKey()];if(s){e.setEmphasized(true).setSubtle(false);s.linkId=e.getId();i++}else{e.setEmphasized(false).setSubtle(true)}});this._oOthersLink.setCount(s.length-i)},onAfterRendering:function(){if(this.getLinks().length!==0){this.drawCloudCircle();this.updateVisibleLinks()}},drawCloudCircle:function(){var t=sap.ui.getCore().getConfiguration().getRTL();var e=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFOuterCircle").width()/2))-5;var i=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFCentralCircle").outerWidth()/2));var s=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFOuterCont").outerHeight()/2));var a=jQuery("html").hasClass("sapUiMedia-Std-Phone");var r=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFBox").outerHeight()));var n=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFBox").outerWidth()));if(!a){n+=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFBox.Quad0").css("right")))}var o=8;this.initQuadArea(e-o,s,i+o,r,n,o);var l=this;var h=this.getIndex();var d=(h===0||h===3)!==t?"left":"right";var u=h===0||h===1?"bottom":"top";var g=this.getLinks();for(var p=0;p<g.length;p++){var c=g[p].$();if(c.length>0){var _=c[0].scrollWidth;if(g.length<=5&&this.isCompact()){var m=[0,2,[1,3][p],[1,2,3][p],[0,1,2,3][p],[0,1,2,3,4][p]][g.length];if(c.width()>this._bgArea[m].width){c.width(this._bgArea[m].width)}this._bgArea[m].placed.push(c)}else if(g.length<=3&&!this.isCompact()){var m=[0,1,[0,2][p],[0,1,2][p]][g.length];if(c.width()>this._bgArea[m].width){c.width(this._bgArea[m].width)}this._bgArea[m].placed.push(c)}else{var f=48;if(g[p].getText().length<3){_=Math.ceil(g[p].getText().length*f/3)}c.width(_);var v=c.outerWidth();var C=-1;var S=1e3;var y=-1;var T=0;for(var F=0;F<l._bgArea.length;F++){var I=l._bgArea[F].width-v;if(I>=0&&I<S){S=I;C=F}if(I<0&&I<T){T=I;y=F}}if(C!==-1){this._bgArea[C].placed.push(c);this._bgArea[C].width-=v}else if(y!==-1&&l._bgArea[y].width>=f){if(c.width()>this._bgArea[y].width){c.width(this._bgArea[y].width)}v=c.outerWidth();this._bgArea[y].width-=v;this._bgArea[y].placed.push(c)}else{c.addClass("Hidden")}}}}for(var F=0;F<this._bgArea.length;F++){var b=this._bgArea[F].start;var w=this._bgArea[F].placed.length;var L=Math.max(0,this._bgArea[F].width);for(var x=0;x<w;x++){var P=2*L/w;var k=this._bgArea[F].placed[x];k.css(u,this._bgArea[F].offset+"px");k.css(d,b+"px");b+=k.outerWidth()+Math.ceil(P*Math.random())}}this.initItemNavigation()},onsappageup:function(){var t=this.oItemNavigation.getFocusedIndex()-this.oItemNavigation.iPageSize;if(t<0||!this.oItemNavigation.getItemDomRefs()[t]){for(var e=0;e<this.oItemNavigation.getItemDomRefs().length;e++){if(this.oItemNavigation.getItemDomRefs()[e]){this.oItemNavigation.setFocusedIndex(e);jQuery.grep(this.oItemNavigation.getItemDomRefs(),function(t){return t})[0].focus();return}}}},initItemNavigation:function(){var t=this.getIndex();var e=this.getDomRef();var i=this.getLinks();if(i){var s=new Array(i.length);if(this._bgArea){var a=t===0||t===1?this._bgArea.reverse():this._bgArea;a.forEach(function(e){var i=e.placed;if(i){i=t===1||t===2?i.reverse():i;i.forEach(function(t){s.push(t)})}})}if(!this.oItemNavigation){this.oItemNavigation=new l;this.addDelegate(this.oItemNavigation)}this.oItemNavigation.setRootDomRef(e);this.oItemNavigation.setItemDomRefs(s);this.oItemNavigation.setCycling(false);this.oItemNavigation.setPageSize(5)}},isCompact:function(){return this.$().closest(".sapUISizeCompact").length>0},initQuadArea:function(t,e,i,s,a,r){var n=jQuery("html").hasClass("sapUiMedia-Std-Phone");if(e<0){e=0}var o=this.isCompact()?5:3;this._bgArea=new Array(o);var l=(e-r-s)/o;var h=s;for(var d=0;d<o;d++){var u=i*i-h*h;var g=(u>0?Math.ceil(parseFloat(Math.sqrt(u))):0)+r;this._bgArea[d]={start:g,width:(n?t:Math.ceil(parseFloat(Math.sqrt(t*t-(h+l)*(h+l)))))-g,offset:h,placed:[]};h+=Math.ceil(l)}}});var Q=s.extend("sap.suite.ui.commons.TargetFilterQuadrant",{metadata:{properties:{index:{type:"int"}},aggregations:{linkClouds:{multiple:true,type:"sap.suite.ui.commons.TargetFilterLinksCloud"},dialog:{multiple:true,type:"sap.m.SelectDialog"}},events:{filtersChanged:{}}},init:function(){var t=this;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");this._oFilters={};this._assignedFilters=[];this._oFilterCb=new k(this.getId()+"-cb",{selectionChange:function(){t.setColumn(this.getSelectedKey(),true)}});this._oValueHelpBtn=new h(this.getId()+"-btn",{icon:"sap-icon://search",press:function(){t.fnShowValueHelper()}});this.addLinkCloud(new R(this.getId()+"-links"));this._oSelectDialog=new d(this.getId()+"-browser",{multiSelect:true,liveChange:function(e){var i=e.getParameter("value");var s=e.getParameter("itemsBinding");var a=[];try{if(i!==undefined&&i.length){a.push(new u(t._oColumn.getPath(),t._oColumn.getType().getName()==="String"?g.Contains:g.EQ,t._oColumn.getType().parseValue(i,"string")))}s.filter(a)}catch(e){L.warning("'"+i+"' is not valid "+t._oColumn.getType().getName(),this);this.removeAllItems()}},confirm:function(e){var i=e.getParameter("selectedContexts");t._oFilters={};for(var s in t.oSelectedDialogSaveItems){if(t.oSelectedDialogSaveItems[s]){t._oFilters[s]={filter:new u(t._oColumn.getPath(),g.EQ,s),text:t._oColumn.getType().formatValue(s,"string")}}}t.oSelectedDialogSaveItems={};t.fireFiltersChanged();t.getLinkClouds()[0].updateVisibleLinks()},cancel:function(e){t.oSelectedDialogSaveItems={}}});this.addAggregation("dialog",this._oSelectDialog)},hasFilters:function(){return Object.getOwnPropertyNames(this._oFilters).length!==0},hasFilter:function(t){return this._oFilters.hasOwnProperty(t)},getFiltersSet:function(){var t=[];var e=Object.getOwnPropertyNames(this._oFilters);for(var i=0;i<e.length;i++){t.push({key:e[i],text:this._oFilters[e[i]].text})}return t},getFilters:function(){var t=[];var e=Object.getOwnPropertyNames(this._oFilters);for(var i=0;i<e.length;i++){t.push(this._oFilters[e[i]].filter)}if(t.length){return new u(t,false)}},filter:function(t){this._assignedFilters=t;this._oFilters={};var e=this.getLinkClouds()[0].getBinding("links");e.filter(this._assignedFilters)},removeFilter:function(t){var e=this._oFilters[t];if(e.linkId){sap.ui.getCore().byId(e.linkId).setEmphasized(false).setSubtle(true)}else{this.getLinkClouds()[0]._oOthersLink.setCount(this.getLinkClouds()[0]._oOthersLink.getCount()-1)}delete this._oFilters[t];this.fireFiltersChanged()},setProperty:function(e,i,s){p.prototype.setProperty.apply(this,arguments);if(e==="index"){if(i===0||i===1){this._oFilterCb.setPopoverPlacement(t.VerticalPreferedTop).addStyleClass("sapSuiteTFCBTop")}else{this._oFilterCb.setPopoverPlacement(t.VerticalPreferedBottom)}if(i===0||i===3){this._oFilterCb.addStyleClass("sapSuiteTFCBArrowBeforeVal")}this.getLinkClouds()[0].setIndex(i)}},setColumn:function(t,i){this._oColumn=sap.ui.getCore().byId(t);if(this._oColumn){if(!i){this._oFilterCb.setSelectedKey(t)}var s=this.getParent();var a=this;var n=new A({key:"{"+this._oColumn.getPath()+"}",text:{path:this._oColumn.getPath(),type:this._oColumn.getType()},count:{path:s.getMeasureColumn().getPath()},press:function(t){if(this.$()[0].scrollWidth>this.$().innerWidth()){var i=this;var s=this.getParent().getParent().getId();if(sap.ui.getCore().byId(s+"-popover"))a._selectPopover.destroy();a._selectPopover=new r(s+"-popover",{title:sap.ui.getCore().byId(s+"-cb").getValue(),content:[new c({text:this.getText(),wrapping:true}).addStyleClass("sapSuiteUiTFPopoverText")],footer:[new _({contentRight:[new h({text:a._oRb.getText(this.getEmphasized()?"TARGETFILTER_BUTTON_DESELECT":"TARGETFILTER_BUTTON_SELECT"),type:"Emphasized",press:function(){a.toggleLinkSelection(i);a._selectPopover.close()}}),new h({text:a._oRb.getText("TARGETFILTER_BUTTON_CANCEL"),press:function(){a._selectPopover.close()}})]})],placement:e.PlacementType.Vertical,afterClose:function(t){if(t)t.getSource().destroy()}}).addStyleClass("sapSuiteUiTFPopover");a._selectPopover.openBy(this);a._selectPopover.$().attr("role","alert").removeAttr("aria-label");return}a.toggleLinkSelection(this)}});n.addStyleClass("sapSuiteUiTFLine");n.addStyleClass("Quad"+this.getIndex());this.getLinkClouds()[0].bindAggregation("links",{path:"/"+s.getEntitySet(),parameters:{select:this._oColumn.getPath()+","+s.getMeasureColumn().getPath()},template:n,length:this._oColumn.getLength(),sorter:[new m(s.getMeasureColumn().getPath(),true),new m(this._oColumn.getPath(),false)],filters:this._assignedFilters});var o=this.hasFilters();this._oFilters={};if(o){this.fireFiltersChanged()}}else{this.getLinkClouds()[0].removeAllLinks()}},toggleLinkSelection:function(t){if(this._oFilters[t.getKey()]){delete this._oFilters[t.getKey()];t.setEmphasized(false).setSubtle(true)}else{this._oFilters[t.getKey()]={filter:new u(this._oColumn.getPath(),g.EQ,t.getKey()),linkId:t.getId(),text:t.getText()};t.setEmphasized(true).setSubtle(false)}this.fireFiltersChanged()},fnShowValueHelper:function(){var t=this.getParent();var e=this;var i=" "+e._oRb.getText("TARGETFILTER_ENTRIES_TEXT");this._oSelectDialog.bindAggregation("items",{path:"/"+t.getEntitySet(),parameters:{select:this._oColumn.getPath()+","+t.getMeasureColumn().getPath()},sorter:[new m(t.getMeasureColumn().getPath(),true),new m(this._oColumn.getPath(),false)],filters:this._assignedFilters,factory:function(s,a){var r=new E({key:{path:e._oColumn.getPath()},title:{type:e._oColumn.getType(),path:e._oColumn.getPath()},description:{path:t.getMeasureColumn().getPath(),formatter:function(t){return t+i}},selected:e.fnSelectDialogItemSelection(a),press:function(t){e.oSelectedDialogSaveItems[this.getProperty("key")]=this.getSelected()}});return r}});this._oSelectDialog.setTitle(this._oColumn.getTitle()),this._oSelectDialog.open()},oSelectedDialogSaveItems:{},fnSelectDialogItemSelection:function(t){var e=t.getProperty(this._oColumn.getPath());if(this.oSelectedDialogSaveItems[e]===undefined){this.oSelectedDialogSaveItems[e]=this.hasFilter(e)}return this.oSelectedDialogSaveItems[e]},rebindColumns:function(){var t=this.getParent();this._oFilterCb.removeAllItems();for(var e=0;e<t.getColumns().length;e++){var i=t.getColumns()[e];var s=new b({key:i.getId(),text:i.getTitle()});this._oFilterCb.addItem(s)}if(t.getSelectedColumns()&&t.getSelectedColumns()[this.getIndex()]){this.setColumn(t.getSelectedColumns()[this.getIndex()])}else if(t.getColumns()[this.getIndex()]){this.setColumn(t.getColumns()[this.getIndex()].getId())}else{this.setColumn()}},exit:function(){if(this.oItemNavigation){this.removeDelegate(this.oItemNavigation);this.oItemNavigation.destroy()}this._oFilterCb.destroy();this._oValueHelpBtn.destroy()},renderer:function(t,e){var i=e.getIndex();t.write("<div");t.writeControlData(e);t.addClass("sapSuiteUiTFQuadrant");t.addClass("Quad"+i);t.writeClasses();t.write(">");t.write("<div");t.addClass("sapSuiteUiTFBox");t.addClass("Quad"+i);t.writeClasses();t.write(">");t.write("<div");t.addClass("sapSuiteUiTFParCont");t.addClass("Quad"+i);t.writeClasses();t.write(">");t.renderControl(e._oFilterCb);t.write("</div>");t.write("<div");t.addClass("sapSuiteUiTFValHel");t.addClass("Quad"+i);t.writeClasses();t.write(">");t.renderControl(e._oValueHelpBtn);t.write("</div>");t.write("</div>");t.write("<div");t.addClass("sapSuiteUiTFHorizontalLineBg");t.addClass("Quad"+i);t.writeClasses();t.write(">");t.write("<div");t.addClass("sapSuiteUiTFHorizontalLine");t.addClass("Quad"+i);t.writeClasses();t.write(">");t.write("</div>");t.write("</div>");t.renderControl(e.getLinkClouds()[0]);t.write("</div>")}});var V=s.extend("sap.suite.ui.commons.TargetFilterCountDisplay",{metadata:{aggregations:{counts:{multiple:true,type:"sap.suite.ui.commons.TargetFilterCount"}}},init:function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons")},renderer:function(t,e){t.write("<div");t.writeControlData(e);t.addClass("sapSuiteUiTFCentralLabel");t.writeClasses();t.write(">");if(e.getCounts().length){t.write(e.getCounts()[0].getCount())}t.write("</div>")},filter:function(t){this.getBinding("counts").filter(t);this.getParent()._oShowSelectedLink.setText(this._oRb.getText(this.getParent().iCountFilters>0?"TARGETFILTER_SHOW_SELECTED_TEXT":"TARGETFILTER_SHOW_ALL_TEXT"))}});var M=p.extend("sap.suite.ui.commons.TargetFilterCount",{metadata:{properties:{count:{type:"string"}},events:{countUpdated:{}}},setProperty:function(t,e,i){p.prototype.setProperty.apply(this,arguments);if(t==="count"){this.fireCountUpdated({})}}});P.prototype.init=function(){f.media.attachHandler(this.rerender,this,f.media.RANGESETS.SAP_STANDARD);this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var t=this;this._aQuadrants=[];this._aSelectionHistory=[];for(var e=0;e<4;e++){var i=new Q(this.getId()+"-quad"+e,{index:e,filtersChanged:function(){t._handleFiltersChange(this.getIndex())}});this._aQuadrants.push(i);this.setAggregation("_quad"+e,i)}this._aQuadrants[0].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){t._setVariantsFilterItems(0)}});this._aQuadrants[1].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){t._setVariantsFilterItems(1)}});this._aQuadrants[2].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){t._setVariantsFilterItems(2)}});this._aQuadrants[3].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){t._setVariantsFilterItems(3)}});this._oSearchBtn=new h(this.getId()+"-search",{icon:"sap-icon://initiative",press:function(){t.search()}}).addStyleClass("sapSuiteUiTFSearchBtn");this._oSettingsBtn=new h(this.getId()+"-master-settings-button",{icon:"sap-icon://action-settings"});this._oSelLstLbl=new v(this.getId()+"-selection-list-label",{text:this._oRb.getText("TARGETFILTER_YOUR_SELECTION_TEXT")+" (0)",labelFor:this.getId()+"-selection-list"}).addStyleClass("sapSuiteUiTFSelLstLbl");this._oSelLst=new C(this.getId()+"-selection-list",{mode:"Delete",delete:function(e){this.attachEventOnce("updateFinished",this.focus,this);var i=e.getParameter("listItem");t._aQuadrants[i.getIndex()].removeFilter(i.getKey())},growing:true});this._oScrollCont=new S(this.getId()+"-scrl-cntnr",{horizontal:false,vertical:true,height:"17rem",content:this._oSelLst}).addStyleClass("sapSuiteUiTFScroll");this._oShowSelLbl=new n(this.getId()+"-show-selected-label",{press:function(){t.search()}}).addStyleClass("sapSuiteUiTFShowSelLbl");this._oShowSelBox=new y(this.getId()+"-selection-box",{items:[this._oSearchBtn,this._oShowSelLbl]}).addStyleClass("sapSuiteUiTFShowSelBox");this._oRightPanel=new T(this.getId()+"-right-panel-box",{items:[this._oSelLstLbl,this._oScrollCont,this._oShowSelBox]}).addStyleClass("sapSuiteUiTFRightPanelBox");this._oCountDisplay=new V;this.setAggregation("_countDisplay",this._oCountDisplay);this._oShowSelectedLink=new n(this.getId()+"-show-selected-link",{text:this._oRb.getText("TARGETFILTER_SHOW_ALL_TEXT"),press:function(){t.search()}});this._oSavedFiltersSet={};this._oVariants={};this.oVariantManagement=new F({enabled:true,showExecuteOnSelection:true,showShare:true,save:function(e){t._oVariants.sSelectedId=e.getParameters().key;t._oVariants[e.getParameters().key]={links:t._getFiltersSet(),aQuadrantsHistory:[],aQuadrantsCBSelected:[]};for(var i=0;i<4;i++){t._oVariants[e.getParameters().key].aQuadrantsCBSelected.push(t._aQuadrants[i]._oColumn.getPath())}if(t._aSelectionHistory.length!==0){for(var i in t._aSelectionHistory){t._oVariants[e.getParameters().key].aQuadrantsHistory[i]=t._aSelectionHistory[i]}}},select:function(e){t._oVariants.sSelectedId=e.getParameters().key;t._oVariants[t._oVariants.sSelectedId].iQHIndex=0;var i=t._oVariants[t._oVariants.sSelectedId].aQuadrantsHistory;if(i.length!==0){t._oVariants.steps=[];for(var s in i){t._oVariants.steps[i[s]]=2}t._setVariantsFilterItems(i[0])}else{var a=t._oVariants[t._oVariants.sSelectedId].aQuadrantsCBSelected;for(var s=0;s<a.length;s++){t.setQuadCBoxItem(s,a[s])}var r=t._aSelectionHistory[0];if(t._aSelectionHistory.length!==0){t._aQuadrants[r]._oFilters={};t._aQuadrants[r].getLinkClouds()[0].updateVisibleLinks();t._handleFiltersChange(r)}}}});f.resize.attachHandler(this._calcWidthTargetWidthRPanel);this.addDelegate({onAfterRendering:function(e){t._calcWidthTargetWidthRPanel()}});this.data("sap-ui-fastnavgroup","true",true)};P.prototype._calcWidthTargetWidthRPanel=function(t){var e=1024;var i=16;var s=Math.min(3,Math.max(0,(parseInt(jQuery(".sapMFlexItem").css("width"))-e)/i));jQuery(".sapUiMedia-Std-Desktop .sapSuiteUiTFRightPanel").css("margin-left",s+"rem")};P.prototype._setVariantsFilterItems=function(t){if(this._oVariants.steps&&this._oVariants.steps[t]!==null){if(this._oVariants[this._oVariants.sSelectedId].iQHIndex>4||this._aQuadrants[t].getLinkClouds()[0].getLinks().length===0||this._oVariants[this._oVariants.sSelectedId].aQuadrantsHistory[this._oVariants[this._oVariants.sSelectedId].iQHIndex]!==t){return}switch(this._oVariants.steps[t]){case 2:this._oVariants.steps[t]=1;if(!this.setQuadCBoxItem(t,this._oVariants[this._oVariants.sSelectedId].aQuadrantsCBSelected[t])){this._setVariantsFilterItems(t)}break;case 1:this._oVariants.steps[t]=null;this._oVariants[this._oVariants.sSelectedId].iQHIndex++;var e=this._oVariants[this._oVariants.sSelectedId].links[this._oVariants[this._oVariants.sSelectedId].aQuadrantsCBSelected[t]];if(!e){break}this._aQuadrants[t]._oFilters={};var i=this._aQuadrants[t].getLinkClouds()[0].getLinks();for(var s in e){for(var a in i){if(i[a].getKey()===s){this._aQuadrants[t]._oFilters[s]={filter:new u(this._aQuadrants[t]._oColumn.getPath(),g.EQ,s),linkId:i[a].getId(),text:i[a].getText()};i[a].setEmphasized(true).setSubtle(false)}}}this._aQuadrants[t].getLinkClouds()[0].updateVisibleLinks();this._handleFiltersChange(t);break}}};P.prototype.setQuadCBoxItem=function(t,e){if(this._aQuadrants[t]._oColumn.getPath()===e){return false}var i={};var s=this._aQuadrants[t]._oFilterCb.getItems();for(var a=0;a<s.length;a++){i[sap.ui.getCore().byId(s[a].getKey()).getPath()]=s[a].getKey()}if(i[e]){this._aQuadrants[t].setColumn(i[e]);return true}return false};P.prototype.search=function(){this.fireSearch();this._oSavedFiltersSet=this._getFiltersSet();return this};P.prototype._getFiltersSet=function(){var t={};for(var e=0;e<this._aQuadrants.length;e++){var i=this._aQuadrants[e].getFiltersSet();var s={};for(var a=0;a<i.length;a++){s[i[a].key]={}}if(i.length){t[this._aQuadrants[e]._oColumn.getPath()]=s}}return t};P.prototype.getParameters=function(){return{}};P.prototype.getFilters=function(){var t=[];for(var e=0;e<this._aSelectionHistory.length;e++){var i=this._aQuadrants[this._aSelectionHistory[e]].getFilters();if(i){t.push(i)}}if(t.length){return[new u(t,true)]}else{return t}};P.prototype._handleFiltersChange=function(t){this.iCountFilters=0;var e=this._aSelectionHistory.indexOf(t);if(e===-1){this._aSelectionHistory.push(t)}else{this._aSelectionHistory.splice(this._aQuadrants[t].hasFilters()?e+1:e)}this._oSelLst.removeAllItems();for(var i=0;i<this._aSelectionHistory.length;i++){var s=this._aQuadrants[this._aSelectionHistory[i]].getFiltersSet();if(s.length){var a=new I({title:this._aQuadrants[this._aSelectionHistory[i]]._oColumn.getTitle(),upperCase:false});this._oSelLst.addItem(a);for(var r=0;r<s.length;r++){var a=new E({title:s[r].text,key:s[r].key,index:this._aSelectionHistory[i]});this._oSelLst.addItem(a);this.iCountFilters++}}}this._oSelLst.rerender();var s=this.getFilters();for(var i=0;i<this._aQuadrants.length;i++){e=this._aSelectionHistory.indexOf(i);if(e===-1&&t!==i){this._aQuadrants[i].filter(s)}}this._oCountDisplay.filter(s);this.fireFilterChange();var n=this._getFiltersSet();if(this.equalFiltersSet(n,this._oSavedFiltersSet)){this.fireCancel()}this._oSelLstLbl.setText(this._oRb.getText("TARGETFILTER_YOUR_SELECTION_TEXT")+" ("+this.iCountFilters+")")};P.prototype.equalFiltersSet=function(t,e){var i=Object.getOwnPropertyNames(t);var s=Object.getOwnPropertyNames(e);if(i.length!==s.length){return false}for(var a=0;a<i.length;a++){var r=i[a];if(!e.hasOwnProperty(r)||!this.equalFiltersSet(t[r],e[r])){return false}}return true};P.prototype._bindModel=function(){if(this._bBindModel){this._bBindModel=false;for(var t=0;t<this._aQuadrants.length;t++){this._aQuadrants[t].rebindColumns()}var e=this;this._oCountDisplay.bindAggregation("counts",{path:"/"+this.getEntitySet(),parameters:{select:this.getMeasureColumn().getPath()},length:1,template:new M({count:{path:this.getMeasureColumn().getPath(),type:this.getMeasureColumn().getType()},countUpdated:function(){e._oShowSelLbl.setText(e._oRb.getText(e.iCountFilters>0?"TARGETFILTER_SHOW_SELECTED_TEXT":"TARGETFILTER_SHOW_ALL_TEXT")+" ("+this.getCount()+")")}})})}};P.prototype._callMethodInManagedObject=function(t,e){if(e==="columns"||e==="entitySet"||e==="measureColumnName"){this._bBindModel=true}var i=Array.prototype.slice.call(arguments);return s.prototype[t].apply(this,i.slice(1))};P.prototype.setProperty=function(t,e,i){this._callMethodInManagedObject("setProperty",t,e,i);return this};P.prototype.insertAggregation=function(t,e,i,s){this._callMethodInManagedObject("insertAggregation",t,e,i,s);return this};P.prototype.addAggregation=function(t,e,i){this._callMethodInManagedObject("addAggregation",t,e,i);return this};P.prototype.removeAggregation=function(t,e,i){return this._callMethodInManagedObject("removeAggregation",t,e,i)};P.prototype.removeAllAggregation=function(t,e){return this._callMethodInManagedObject("removeAllAggregation",t,e)};P.prototype.destroyAggregation=function(t,e){this._callMethodInManagedObject("destroyAggregation",t,e);return this};P.prototype.onBeforeRendering=function(){this._bindModel()};P.prototype.onAfterRendering=function(){var t=this;this._oShowSelBox.$().attr("tabindex","0");this._oShowSelBox.addDelegate({onkeypress:function(e){if(e.which===w.ENTER||e.which===w.SPACE){t._oSearchBtn.firePress();e.preventDefault()}}});this._oShowSelLbl.$().attr("tabindex","-1");this._oSearchBtn.$().attr("tabindex","-1")};P.prototype.exit=function(){f.media.detachHandler(this.rerender,this,f.media.RANGESETS.SAP_STANDARD);this._oSearchBtn.destroy();this._oSettingsBtn.destroy();this._oSelLstLbl.destroy();this._oSelLst.destroy();this._oScrollCont.destroy();this._oShowSelLbl.destroy();this._oShowSelBox.destroy();this._oRightPanel.destroy();this._oShowSelectedLink.destroy()};return P});
//# sourceMappingURL=TargetFilter.js.map