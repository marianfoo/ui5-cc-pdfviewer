sap.ui.define(["sap/ui/thirdparty/jquery","sap/suite/ui/commons/library","sap/ui/core/Control","sap/ui/core/theming/Parameters","./TAccountPanel","sap/ui/core/IconPool","sap/ui/core/Icon","sap/m/Button","sap/base/security/encodeXML","sap/ui/core/Configuration","sap/ui/core/delegate/ItemNavigation","./TAccountUtils","sap/ui/core/ResizeHandler","sap/ui/thirdparty/bignumber"],function(jQuery,t,e,o,n,s,i,a,r,p,u,c,l,d){"use strict";var h=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var m=e.extend("sap.suite.ui.commons.taccount.TAccountGroup",{metadata:{library:"sap.suite.ui.commons",properties:{title:{type:"string",group:"Misc",defaultValue:null},collapsed:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{accounts:{type:"sap.suite.ui.commons.taccount.TAccount",multiple:true,singularName:"account"}},events:{}},renderer:{apiVersion:2,render:function(t,e){if(!e._bThemeApplied){return}t.openStart("div",e);t.class("sapSuiteUiCommonsAccountGroup");if(e.getCollapsed()){t.class("sapSuiteUiCommonsAccountGroupCollapsed")}t.attr("tabindex",0);t.attr("aria-label",e._getAriaText());t.openEnd();t.openStart("div").class("sapSuiteUiCommonsGroupHeader").openEnd();t.openStart("div").class("sapSuiteUiCommonsGroupHeaderExpandWrapper").openEnd();t.renderControl(e._getExpandCollapse());t.close("div");t.openStart("div").class("sapSuiteUiCommonsGroupHeaderFirst").openEnd();t.openStart("span").class("sapSuiteUiCommonsGroupHeaderTitle").openEnd().unsafeHtml(r(e.getTitle())).close("span");t.openStart("span").attr("id",e.getId()+"-sum").class("sapSuiteUiCommonsGrouptHeaderSUM").openEnd().text(e._getSumText()).close("span");t.openStart("div").attr("id"," ").class("sapSuiteUiCommonsGroupInfoIconWrapper").class("sapSuiteUiCommonsTAccountBaseInfoIconWrapper").attr("title",h.getText("TACCOUNT_SELECTED")).openEnd();t.openStart("span").class("sapSuiteUiCommonsInfoIcon").openEnd();t.text("!");t.close("span");t.close("div");t.close("div");t.openStart("div").class("sapSuiteUiCommonsGroupHeaderSecond").openEnd();t.renderControl(e._getExpandAllAccounts());t.renderControl(e._getCollapseAllAccounts());t.close("div");t.close("div");t.openStart("div").attr("id",e.getId()+"-content").class("sapSuiteUiCommonsAccountGroupContent").openEnd();e.getAccounts().forEach(function(e){t.renderControl(e)});t.close("div");t.close("div")}}});m.prototype.init=function(){sap.ui.getCore().attachThemeChanged(function(){this._bThemeApplied=true;this.invalidate()},this);this._bThemeApplied=sap.ui.getCore().isThemeApplied();if(!this._sResizeHandlerId){this._sResizeHandlerId=l.register(this,this._adjustUI.bind(this))}};m.prototype.exit=function(){if(this._oIconExpand){this._oIconExpand.destroy()}if(this._oIconCollapse){this._oIconCollapse.destroy()}if(this._sResizeHandlerId){l.deregister(this._sResizeHandlerId);this._sResizeHandlerId=""}};m.prototype.onBeforeRendering=function(){this._bRendered=false;this._oSum=null;this._iColumnCount=-1};m.prototype.onAfterRendering=function(){this._adjustUI();this._bRendered=true;var t=this.getParent();if(t&&this._hasPanelParent(t)&&t._bRendered){t._recalculate()}if(this.getCollapsed()){this.$("content").hide()}};m.prototype.reset=function(){this._oSum=null};m.prototype.updateBindingContext=function(){this.reset();return e.prototype.updateBindingContext.apply(this,arguments)};m.prototype._hasPanelParent=function(t){return(t||this.getParent())instanceof n};m.prototype._getExpandCollapse=function(){var t=this.getCollapsed(),e=this._getExpandAltText(!t);if(!this._oArrowDown){this._oArrowDown=new i({src:t?"sap-icon://navigation-right-arrow":"sap-icon://navigation-down-arrow",alt:e,tooltip:e,press:function(){this._expandCollapse()}.bind(this)})}return this._oArrowDown};m.prototype._getExpandAltText=function(t){return(t?h.getText("TACCOUNT_COLLAPSE"):h.getText("TACCOUNT_EXPAND"))+" "+h.getText("TACCOUNT_GROUP_TITLE")};m.prototype._expandCollapse=function(){var t=this.getCollapsed(),e=this._getExpandAltText(t);this._getExpandCollapse().setTooltip(e);this._getExpandCollapse().setAlt(e);this._getExpandCollapse().setSrc(t?"sap-icon://navigation-down-arrow":"sap-icon://navigation-right-arrow");this.setProperty("collapsed",!t);this._bIsExpanding=true;this.$("content")[t?"show":"hide"]("medium",function(){this._bIsExpanding=false}.bind(this));this.$()[!t?"addClass":"removeClass"]("sapSuiteUiCommonsAccountGroupCollapsed")};m.prototype._expandCollapseAllAccounts=function(t){this.getAccounts().forEach(function(e){e.setCollapsed(!!t)})};m.prototype._getExpandAllAccounts=function(){if(!this._oIconExpand){this._oIconExpand=new a({icon:"sap-icon://expand-all",type:"Transparent",tooltip:h.getText("TACCOUNT_EXPAND"),press:this._expandCollapseAllAccounts.bind(this,false)}).addStyleClass("sapSuiteUiCommonsGroupHeaderIcon")}return this._oIconExpand};m.prototype._getCollapseAllAccounts=function(){if(!this._oIconCollapse){this._oIconCollapse=new a({icon:"sap-icon://collapse-all",type:"Transparent",tooltip:h.getText("TACCOUNT_COLLAPSE"),press:this._expandCollapseAllAccounts.bind(this,true)}).addStyleClass("sapSuiteUiCommonsGroupHeaderIcon")}return this._oIconCollapse};m.prototype._getSum=function(t){var e=this.getAccounts(),o=new d("0"),n="",s=true;if(!this._oSum||t){for(var i=0;i<e.length;i++){var a=e[i];if(n&&n!==a.getMeasureOfUnit()){s=false;break}n=a.getMeasureOfUnit();o=o.plus(a._getSum())}this._oSum={sum:o,measure:n,correct:s}}return this._oSum};m.prototype._getSumText=function(){var t=this._getSum();var e=this.getParent();if(t&&t.correct){var o=c.formatCurrency(t.sum,t.measure,e instanceof n?e.getMaxFractionDigits():0);return(t.sum>0?h.getText("TACCOUNT_CREDIT"):h.getText("TACCOUNT_DEBIT"))+": "+o+" "+r(t.measure)}return"-"};m.prototype._getAriaText=function(){return h.getText("TACCOUNT_GROUP_TITLE")+" "+(this.getTitle()?r(this.getTitle())+" ":"")+this._getSumText()};m.prototype._adjustUI=function(){var t=320,e=16,o=t+e;var n=this.$("content"),s=n.width(),i=Math.max(Math.ceil(s/o)-1,1);if(i===this._iColumnCount){return}if(this._bIsExpanding||this._bRendered&&this.getCollapsed()){return}var a=jQuery('<div id="'+this.getId()+'-content" class="sapSuiteUiCommonsAccountGroupContent"></div>'),r=Array.apply(null,Array(i)).map(Number.prototype.valueOf,0);var p=this.$().find(".sapSuiteUiCommonsAccount"),u=0;this._iColumnCount=i;this._iDivs=[];var c='<div class="sapSuiteUiCommonsAccountGroupDroppingArea"><div class="sapSuiteUiCommonsAccountGroupDroppingAreaInner">'+'</div><div class="sapSuiteUiCommonsAccountGroupDroppingAreaInnerBall"></div><div class="sapSuiteUiCommonsAccountGroupDroppingAreaInnerText">'+h.getText("TACCOUNT_DROP_HERE")+"</div></div>";for(var l=0;l<i;l++){var d='<div class="sapSuiteUiCommonsAccountGroupColumn">'+c+"</div>",m=jQuery(d);a.append(m);this._iDivs.push(m)}for(var l=0;l<p.length;l++){var C=jQuery(p[l]),_=C.height(),g=this._iDivs[u];var f=Number.MAX_VALUE,A=0;for(var v=0;v<i;v++){var S=r[v];if(S<f){f=S;A=v}}var g=this._iDivs[A];C.detach().appendTo(g);jQuery(c).appendTo(g);r[A]+=_}n.detach();this.$().append(a);this._setupDroppable()};m.prototype._setupDroppable=function(){var t=function(t){var e=jQuery(t);return e.hasClass("sapSuiteUiCommonsTAccountDropZoneTop")?e.parent().prev():e.parent().next()};var e=function(t,e){var o=e.draggable,n=o.next();if(n[0]!==t[0]){n.detach().insertAfter(t);o.detach().insertAfter(t)}else{o.detach().insertBefore(t)}t.removeClass("sapSuiteUiCommonsAccountGroupDroppingAreaActiveSide");o.css("left","0px");o.css("top","0px")};var o=this.$().find(".sapSuiteUiCommonsAccountGroupDroppingArea");o.droppable({scope:this.getId()+"-content",tolerance:"pointer",activeClass:"sapSuiteUiCommonsAccountGroupDroppingAreaActive",hoverClass:"sapSuiteUiCommonsAccountGroupDroppingAreaActive",drop:function(t,o){var n=jQuery(this);e(n,o)}});var n=this.$().find(".sapSuiteUiCommonsTAccountDropZoneBottom, .sapSuiteUiCommonsTAccountDropZoneTop");n.droppable({scope:this.getId()+"-content",tolerance:"pointer",drop:function(t,o){var n=jQuery(this);n=n.hasClass("sapSuiteUiCommonsTAccountDropZoneTop")?n.parent().prev():n.parent().next();e(n,o)},over:function(e,o){t(this).addClass("sapSuiteUiCommonsAccountGroupDroppingAreaActiveSide")},out:function(e,o){t(this).removeClass("sapSuiteUiCommonsAccountGroupDroppingAreaActiveSide")}})};m.prototype._valueChanged=function(t,e){if(this._oSum){if(e){this._oSum.sum=this._oSum.sum.minus(t)}else{this._oSum.sum=this._oSum.sum.plus(t)}this.$("sum").text(this._getSumText());var o=this.getParent();if(this._hasPanelParent(o)){o._valueChanged(t,e)}}};m.prototype._measureChanged=function(t){if(this._oSum){if(this._oSum.measure===t&&!this._oSum.correct){this._recalculate();return}if(this._oSum.measure!==t&&this._oSum.correct){var e=this.getParent();this._oSum.correct=false;if(this._hasPanelParent(e)){e._setInvalid()}}this.$("sum").text(this._getSumText())}};m.prototype._recalculate=function(){this._oSum=this._getSum(true);this.$("sum").text(this._getSumText());var t=this.getParent();if(this._hasPanelParent(t)){t._recalculate()}};m.prototype._hasPanelParent=function(t){return(t||this.getParent())instanceof n};m.prototype.invalidate=function(){this._bRendered=false;e.prototype.invalidate.apply(this,arguments)};return m});
//# sourceMappingURL=TAccountGroup.js.map