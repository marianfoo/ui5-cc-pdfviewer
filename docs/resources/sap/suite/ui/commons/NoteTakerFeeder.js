/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/commons/library","sap/ui/core/Control","sap/ui/commons/Button","sap/ui/commons/Label","sap/ui/commons/ListBox","sap/ui/commons/TextField","sap/ui/commons/TextArea","sap/ui/commons/FileUploader","sap/suite/ui/commons/NoteTakerCard","sap/ui/commons/Link","sap/ui/core/ListItem","sap/base/util/deepEqual","sap/ui/events/KeyCodes","./NoteTakerFeederRenderer"],function(jQuery,t,e,o,s,i,a,n,d,l,u,h,r,p,T){"use strict";var g=e.extend("sap.suite.ui.commons.NoteTakerFeeder",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{body:{type:"string",group:"Data",defaultValue:null},title:{type:"string",group:"Data",defaultValue:null},tags:{type:"object",group:"Misc",defaultValue:[]},thumbUp:{type:"boolean",group:"Misc",defaultValue:null},thumbDown:{type:"boolean",group:"Misc",defaultValue:null},attachmentUploadUrl:{type:"string",group:"Misc",defaultValue:null},attachmentName:{type:"string",group:"Misc",defaultValue:"attachment"}},aggregations:{bodyArea:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},titleInput:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},fileUploader:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},tagInput:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{addNote:{parameters:{title:{type:"string"},body:{type:"string"},timestamp:{type:"object"},thumbUp:{type:"boolean"},thumbDown:{type:"boolean"},attachmentFilename:{type:"string"}}},attachmentSelect:{parameters:{filename:{type:"string"}}},attachmentUploadComplete:{parameters:{response:{type:"string"}}},attachmentDelete:{parameters:{filename:{type:"string"}}},attachmentClick:{parameters:{filename:{type:"string"}}}}}});g.prototype.init=function(){this._rb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");this._selectedTags=[];this._bTagPopupOpen=false;var t=this;this._oAddButton=new o({id:this.getId()+"-add-button",text:this._rb.getText("NOTETAKERFEEDER_BUTTON_ADD_TEXT"),tooltip:this._rb.getText("NOTETAKERFEEDER_BUTTON_ADD_TOOLTIP"),press:function(){t._handleAdd()}});this._oAddButton.addStyleClass("sapSuiteUiCommonsNoteTakerFeederHeaderAddButton");this._oTagList=new i({id:this.getId()+"-tagListBox",visibleItems:10,width:"100%",height:"194px",select:function(e){t._handleListSelect(e)}});this._oTagInput=new a({id:this.getId()+"-inputTag",liveChange:function(e){t._handleTagInputLive(e)}});this.setAggregation("tagInput",this._oTagInput);this._oTagInput.onsapdown=function(e){e.preventDefault();e.stopPropagation();jQuery("#"+t.getId()+"-tagListBox li:eq(0)").focus()};this._oCancelTagButton=new o({id:this.getId()+"-cancel-tags-button",text:this._rb.getText("NOTETAKERFEEDER_BUTTON_CANCEL_TAGS"),tooltip:this._rb.getText("NOTETAKERFEEDER_BUTTON_CANCEL_TAGS_TOOLTIP"),press:function(){t._toggleTagPopup()}});this._oCancelTagButton.addStyleClass("sapSuiteUiCommonsNoteTakerFeederCancelTagButton");this._oCancelTagButton.onfocusout=function(e){t._oTagInput.focus()};this._oAddTagButton=new o({id:this.getId()+"-add-tags-button",text:this._rb.getText("NOTETAKERFEEDER_BUTTON_ADD_TAGS"),tooltip:this._rb.getText("NOTETAKERFEEDER_BUTTON_ADD_TAGS_TOOLTIP"),press:function(){t._handleAddTag(t._oTagInput.getValue());t._oTagButton.rerender();t._toggleTagPopup()}});this._oTagButton=new o({id:this.getId()+"-tag-button",tooltip:this._rb.getText("NOTETAKERFEEDER_BUTTON_TAG_TOOLTIP"),press:function(){t._toggleTagPopup()}});this._oTagButton.addStyleClass("sapSuiteUiCommonsNoteTakerFeederTagButton");this._oTitle=new a({id:this.getId()+"-title-field",placeholder:this._rb.getText("NOTETAKERFEEDER_PLACEHOLDER_HEADER")+"...",maxLength:50});this.setAggregation("titleInput",this._oTitle);this._oBody=new n({id:this.getId()+"-body-field",placeholder:this._rb.getText("NOTETAKERFEEDER_PLACEHOLDER_BODY")+"...",required:true,liveChange:function(e){t._setAddButtonEnabled(e.mParameters["liveValue"],null)}});this.setAggregation("bodyArea",this._oBody);this._oThumbUpButton=new o({id:this.getId()+"-thumb-up-button",press:function(e){t._handleThumbUpButtonPress()},tooltip:this._rb.getText("NOTETAKERFEEDER_BUTTON_THUMB_UP_TOOLTIP")});this._oThumbUpButton.addStyleClass("sapSuiteUiCommonsNoteTakerFeederThumbUpButton");this._oThumbDownButton=new o({id:this.getId()+"-thumb-down-button",press:function(e){t._handleThumbDownButtonPress()},tooltip:this._rb.getText("NOTETAKERFEEDER_BUTTON_THUMB_DOWN_TOOLTIP")});this._oThumbDownButton.addStyleClass("sapSuiteUiCommonsNoteTakerFeederThumbDownButton");this._oFileUploader=new d({id:this.getId()+"-attach",uploadOnChange:false,name:this.getAttachmentName(),change:function(e){t._disableAddAttachBtn();var o=e.getParameter("newValue");t._oAttachmentLink.setText(o);t._oAttachmentLink.rerender();t._handleAddAttachUI();var s={};s.filename=o;t.fireAttachmentSelect(s);t._oTitle.focus()},uploadComplete:function(e){t._handleUploadComplete(e)}});this._oFileUploader.onfocusin=function(e){t._oTitle.focus()};this._oFileUploader.oBrowse.setText("");this.setAggregation("fileUploader",this._oFileUploader);this._oAddAttachButton=new o({id:this.getId()+"-attach-button",press:function(e){(t._oFileUploader.getId()+"-fu"?window.document.getElementById(t._oFileUploader.getId()+"-fu"):null).click()},tooltip:t._rb.getText("NOTETAKER_BUTTON_ATTACH_TOOLTIP")});this._oAddAttachButton.addStyleClass("sapSuiteUiCommonsNtAttachIcon");this._oAttachmentLoadingLabel=new s({id:this.getId()+"-loading-label",text:this._rb.getText("NOTETAKERFEEDER_LABEL_ATTACHMENT_LOADING")+"..."});this._oDeleteAttachButton=new o({id:this.getId()+"-delete-attach-button",lite:true,press:function(e){t._handleDeleteAttachUI();var o={filename:t._oFileUploader.getName()};t.fireAttachmentDelete(o)},tooltip:this._rb.getText("NOTETAKERFEEDER_BUTTON_DELETE_ATTACHMENT")});this._oAttachmentLink=new u({id:this.getId()+"-attachmentLink",tooltip:this._rb.getText("NOTETAKERFEEDER_LINK_ATTACHMENT_TOOLTIP"),press:function(e){var o={filename:t._oFileUploader.getName()};t.fireAttachmentClick(o)},width:"200px"});this._oRequiredLbl=new s({required:true}).addStyleClass("sapSuiteRequiredLbl")};g.prototype.exit=function(){this._oAddButton.destroy();this._oTitle.destroy();this._oBody.destroy();this._oTagButton.destroy();this._oTagList.destroy();this._oTagInput.destroy();this._oCancelTagButton.destroy();this._oAddTagButton.destroy();this._oThumbUpButton.destroy();this._oThumbDownButton.destroy();this._oFileUploader.destroy();this._oAddAttachButton.destroy();this._oAttachmentLoadingLabel.destroy();this._oDeleteAttachButton.destroy();this._oAttachmentLink.destroy();this._oRequiredLbl.destroy()};g.prototype._handleAdd=function(){if(this.getBody()){var t={};t.title=this.getTitle();t.body=this.getBody();t.timestamp=this._getTimestamp();t.tags=this._selectedTags;t.thumbUp=this.getThumbUp();t.thumbDown=this.getThumbDown();t.attachmentFilename=this._oFileUploader.getValue();this.setTitle("");this.setBody("");this.setThumbDown(false);this.setThumbUp(false);this._oFileUploader.setValue("");this._enableAddAttachBtn();this.fireAddNote(t);jQuery(this._oFileUploader.oFileUpload).show();this._handleClearTag()}else{this._setAddButtonEnabled(this.getBody())}};g.prototype._getTimestamp=function(){return new Date};g.prototype.setTitle=function(t){this._oTitle.setValue(t);return this};g.prototype.getTitle=function(){return jQuery(document.getElementById(this.getId()+"-title-field")).hasClass("sapSuiteUiCommonsPlaceholder")?"":this._oTitle.getValue()};g.prototype.setBody=function(t){this._oBody.setValue(t);return this};g.prototype.getBody=function(){return this._isBodyPlaceholderActive()?"":this._oBody.getValue()};g.prototype._applyPlaceholder=function(){jQuery("[data-placeholder]").focus(function(){var t=jQuery(this);if(t.hasClass("sapSuiteUiCommonsPlaceholder")){t.val("");t.removeClass("sapSuiteUiCommonsPlaceholder")}}).blur(function(){var t=jQuery(this);if(r(t.val(),"")||r(t.val(),t.attr("data-placeholder"))){t.addClass("sapSuiteUiCommonsPlaceholder");t.val(t.attr("data-placeholder"))}}).blur()};g.prototype._isBodyPlaceholderActive=function(){return jQuery(document.getElementById(this.getId()+"-body-field")).hasClass("sapSuiteUiCommonsPlaceholder")};g.prototype._setAddButtonEnabled=function(t,e){var o=t!==null&&!this._isBodyPlaceholderActive()&&!/^\s*$/.test(t);if(o!==this._oAddButton.getEnabled()){this._oAddButton.setEnabled(o);if(!e){this._oAddButton.rerender()}}};g.prototype._adjustUploaderForIe=function(){this._oFileUploader.superOnkeydown=this._oFileUploader.onkeydown;this._oFileUploader.onkeydown=function(t){var e=t.keyCode,o=p;if(e!==o.SPACE&&e!==o.ENTER){this.superOnkeydown(t)}};jQuery(this._oFileUploader.oFilePath.getDomRef()).hide();jQuery(this._oFileUploader.oBrowse.getDomRef()).hide();jQuery(this._oAddAttachButton.getDomRef()).attr("tabindex","-1");var t=this;jQuery(this._oFileUploader.oFileUpload).attr("tabindex","0").attr("title",this._rb.getText("NOTETAKER_BUTTON_ATTACH_TOOLTIP")).on("focus",function(){this.hasFocus=true;jQuery(t._oAddAttachButton.getDomRef()).addClass("sapUiBtnStdFocus")}).on("focusout",function(){this.hasFocus=false;jQuery(t._oAddAttachButton.getDomRef()).removeClass("sapUiBtnStdFocus")}).on("hover",function(){jQuery(t._oAddAttachButton.getDomRef()).addClass("sapUiBtnStdFocus")},function(){if(!this.hasFocus){jQuery(t._oAddAttachButton.getDomRef()).removeClass("sapUiBtnStdFocus")}jQuery(t._oAddAttachButton.getDomRef()).removeClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")}).on("mousedown",function(){jQuery(t._oAddAttachButton.getDomRef()).addClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected").addClass("sapUiBtnAct")}).on("mouseup",function(){jQuery(t._oAddAttachButton.getDomRef()).removeClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")});jQuery(this._oFileUploader.oFileUpload).keydown(function(e){var o=p;if(e.keyCode===o.TAB){if(e.shiftKey){t._oThumbDownButton.focus()}else{t._oTitle.focus()}e.preventDefault();e.stopPropagation()}})};g.prototype._setAriaInfo=function(){jQuery(document.getElementById(this._oThumbUpButton.getId())).attr("aria-pressed",this.getThumbUp());jQuery(document.getElementById(this._oThumbDownButton.getId())).attr("aria-pressed",this.getThumbDown());jQuery(document.getElementById(this._oTitle.getId())).attr("aria-label",this._rb.getText("NOTETAKERFEEDER_PLACEHOLDER_HEADER"));jQuery(document.getElementById(this._oBody.getId())).attr("aria-label",this._rb.getText("NOTETAKERFEEDER_PLACEHOLDER_BODY"));jQuery(this._oFileUploader.oFileUpload).attr("aria-label",this._rb.getText("NOTETAKER_BUTTON_ATTACH_TOOLTIP"))};g.prototype.onAfterRendering=function(){this._applyPlaceholder();this._adjustPopupState();if(this._oFileUploader.getValue()){jQuery(document.getElementById(this.getId()+"-attachment-panel")).show();jQuery(document.getElementById(this.getId()+"-attachment-loading")).hide();jQuery(document.getElementById(this.getId()+"-attachment-delete")).show()}jQuery(document.getElementById(this._oFileUploader.getId())).addClass("sapSuiteUiCommonsNtfUploader");this._setAriaInfo();if(jQuery.browser.msie){this._adjustUploaderForIe()}};g.prototype.onBeforeRendering=function(){this._setAddButtonEnabled(this.getBody(),true);this._setThumbButtonsView()};g.prototype.getFormattedTags=function(){return l.prototype._getFormattedTags()};g.prototype._adjustPopupState=function(){if(this._bTagPopupOpen){jQuery(document.getElementById(this.getId()+"-selectTag-panel")).show()}};g.prototype._handleAddTag=function(t){this._selectedTags=[];var e=t.split(new RegExp("\\s+"));var o={};for(var s=0;s<e.length;s++){if(e[s].length!==0){o[e[s]]=0}}for(var i in o){this._selectedTags.push(i)}if(this._oTagButton){this._adjustTagButton()}};g.prototype._adjustTagButton=function(){if(this._selectedTags.length){this._oTagButton.setTooltip(this._rb.getText("NOTETAKERFEEDER_BUTTON_ADD_TAGS_SELECTED_TOOLTIP")+": "+this._selectedTags.join(" "));this._oTagButton.addStyleClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")}else{this._oTagButton.setTooltip(this._rb.getText("NOTETAKERFEEDER_BUTTON_TAG_TOOLTIP"));this._oTagButton.removeStyleClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")}};g.prototype._handleClearTag=function(){if(this._oTagInput){this._oTagInput.setValue("")}if(this._oTagList){this._oTagList.clearSelection()}this._selectedTags=[];if(this._oTagButton){this._adjustTagButton()}};g.prototype.setTags=function(t){this.setProperty("tags",t,true);return this};g.prototype._toggleTagPopup=function(){if(this._bTagPopupOpen){jQuery(document.getElementById(this.getId()+"-selectTag-panel")).slideToggle();this._focusDefaultControl();this._bTagPopupOpen=false}else{this._addTagsToListBox(this.getTags());jQuery(document.getElementById(this.getId()+"-selectTag-panel")).slideToggle();jQuery(document.getElementById(this.getId()+"-inputTag")).val(this._selectedTags.length===0?"":this._selectedTags.join(" ")+" ");this._oTagInput.focus();this._bTagPopupOpen=true}};g.prototype._focusDefaultControl=function(){this._oTagButton.focus()};g.prototype._handleTagInputLive=function(t){var e=t.getParameter("liveValue");var o=e.split(" ");var s=o[o.length-1];this._filterListBox(s)};g.prototype._filterListBox=function(t){if(t.length===0){this._addTagsToListBox(this.getTags());return}var e=jQuery.grep(this.getTags(),function(e){return e.indexOf(t)>=0});this._addTagsToListBox(e)};g.prototype._addTagsToListBox=function(t){var e=jQuery.map(t,function(t,e){return new h({text:t})});this._oTagList.setItems(e,true);this._oTagList.rerender()};g.prototype._handleListSelect=function(t){var e=t.getParameter("selectedItem").getText();var o=this._oTagInput.getValue();var s=o.split(" ");s.pop();if(s.length===0){this._oTagInput.setValue(e+" ")}else{this._oTagInput.setValue(s.join(" ")+" "+e+" ")}this._oTagList.setSelectedIndex(-1);this._oTagInput.focus()};g.prototype._setThumbButtonsView=function(){if(this.getThumbUp()){this._oThumbUpButton.addStyleClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")}else{this._oThumbUpButton.removeStyleClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")}if(this.getThumbDown()){this._oThumbDownButton.addStyleClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")}else{this._oThumbDownButton.removeStyleClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")}};g.prototype._handleThumbUpButtonPress=function(){this.setThumbUp(!this.getThumbUp());if(this.getThumbUp()){this.setThumbDown(false)}};g.prototype._handleThumbDownButtonPress=function(){this.setThumbDown(!this.getThumbDown());if(this.getThumbDown()){this.setThumbUp(false)}};g.prototype._disableAddAttachBtn=function(){this._oAddAttachButton.setEnabled(false);this._oAddAttachButton.removeStyleClass("sapSuiteUiCommonsNtAttachIcon");this._oAddAttachButton.addStyleClass("sapSuiteUiCommonsNtDsblAttachIcon");this._oAddAttachButton.setTooltip("");this._oAddAttachButton.rerender()};g.prototype._enableAddAttachBtn=function(){this._oAddAttachButton.setEnabled(true);this._oAddAttachButton.removeStyleClass("sapSuiteUiCommonsNtDsblAttachIcon");this._oAddAttachButton.addStyleClass("sapSuiteUiCommonsNtAttachIcon");this._oAddAttachButton.setTooltip(this._rb.getText("NOTETAKER_BUTTON_ATTACH_TOOLTIP"));this._oAddAttachButton.rerender();if(jQuery.browser.msie){jQuery(document.getElementById(this._oAddAttachButton.getId())).attr("tabindex","-1")}};g.prototype._handleAddAttachUI=function(){jQuery(this._oFileUploader.oFileUpload).hide();jQuery(document.getElementById(this.getId()+"-attachment-loading")).show("fast");jQuery(document.getElementById(this.getId()+"-body")).animate({height:"332px"},300);jQuery(document.getElementById(this.getId()+"-attachment-panel")).slideDown({duration:300,queue:false})};g.prototype._handleDeleteAttachUI=function(){jQuery(this._oFileUploader.oFileUpload).show();jQuery(document.getElementById(this.getId()+"-body")).animate({height:"352px"},300);jQuery(document.getElementById(this.getId()+"-attachment-delete")).hide("fast");jQuery(document.getElementById(this.getId()+"-attachment-panel")).hide({duration:300,queue:false});this._enableAddAttachBtn();this._oFileUploader.setValue("");this._oFileUploader.addStyleClass("sapSuiteUiCommonsNtfUploader");this._oAttachmentLink.setText("");this._oAddAttachButton.focus()};g.prototype.handleUploadResponse=function(t){};g.prototype._handleUploadComplete=function(t){jQuery(document.getElementById(this.getId()+"-attachment-loading")).hide("fast");jQuery(document.getElementById(this.getId()+"-attachment-delete")).show("fast");var e={response:t.getParameter("response")};this.fireAttachmentUploadComplete(e)};g.prototype.setAttachmentUploadUrl=function(t){this._oFileUploader.setUploadUrl(t);return this};g.prototype.getAttachmentUploadUrl=function(){return this._oFileUploader.getUploadUrl()};return g});
//# sourceMappingURL=NoteTakerFeeder.js.map