/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/commons/library","sap/ui/commons/RowRepeater","sap/ui/commons/SegmentedButton","sap/ui/commons/SearchField","sap/ui/commons/Button","sap/ui/base/ManagedObject","sap/ui/core/ResizeHandler","./ViewRepeaterRenderer"],function(jQuery,e,t,i,r,s,o,n,a,h){"use strict";var g=i.extend("sap.suite.ui.commons.ViewRepeater",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{itemMinWidth:{type:"int",group:"Misc",defaultValue:null},responsive:{type:"boolean",group:"Misc",defaultValue:false},defaultViewIndex:{type:"int",group:"Misc",defaultValue:0},showSearchField:{type:"boolean",group:"Misc",defaultValue:true},showViews:{type:"boolean",group:"Misc",defaultValue:true},external:{type:"boolean",group:"Misc",defaultValue:false},itemHeight:{type:"int",group:"Misc",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100%"}},aggregations:{views:{type:"sap.suite.ui.commons.RepeaterViewConfiguration",multiple:true,singularName:"view"}},associations:{externalRepresentation:{type:"sap.ui.core.Control",multiple:false}},events:{search:{parameters:{query:{type:"string"}}},changeView:{parameters:{oldViewIndex:{type:"int"},newViewIndex:{type:"int"},filterId:{type:"string"},sorterId:{type:"string"},page:{type:"int"}}}}}});g.prototype.init=function(){this._rb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");this.addStyleClass("suiteUiVr");i.prototype.init.call(this);this._oSegBtn=new r({id:this.getId()+"-segBtn"});this._repopulateViewSelector();this._oSearchField=new s({id:this.getId()+"-searchFld",enableFilterMode:true,enableListSuggest:false,search:function(e){this.fireSearch({query:e.getParameter("query")})}.bind(this)});this.attachFilter(function(e){this._currentFilterId=e.getParameter("filterId")});this.attachSort(function(e){this._currentSorterId=e.getParameter("sorterId")})};g.prototype.setDefaultViewIndex=function(e){this.setProperty("defaultViewIndex",e);this._selectDefaultView();return this};g.prototype._selectDefaultView=function(){var e=this.getDefaultViewIndex();if(e===this._currentViewIndex){return}var t=this.getViews()||[];if(t.length>0){if(e>=t.length){e=t.length-1}this.selectView(e);var i=this.getId()+"-"+t[e].getId()+"-triggerBtn";this._oSegBtn.setSelectedButton(i)}};g.prototype._repopulateViewSelector=function(){var e=this;var t=e._oSegBtn.removeAllAggregation("buttons",true);jQuery.each(t,function(e,t){t.destroy()});var i=this.getViews()||[];for(var r=0;r<i.length;r++){var s=i[r];if(s.getExternal()){var n=s.getExternalRepresentation();if(!n.getModel()){n.setModel(this.getModel())}}var a=new o({id:this.getId()+"-"+s.getId()+"-triggerBtn",text:s.getTitle()||(s.getIcon()?undefined:this._rb.getText("VIEWREPEATER_TAB_DEFAULT_NAME",[r+1])),icon:s.getIcon(),iconHovered:s.getIconHovered(),iconSelected:s.getIconSelected(),tooltip:s.getTooltip(),lite:true});e._oSegBtn.addButton(a);a.attachPress(s,function(t,i){e.selectView(i);e._oSegBtn.rerender()})}this._selectDefaultView()};g.prototype.setModel=function(e,t){n.prototype.setModel.call(this,e,t);this._repopulateViewSelector();return this};g.prototype.addView=function(e){this.addAggregation("views",e);this._repopulateViewSelector();return this};g.prototype.removeAllViews=function(){var e=this.removeAllAggregation("views");this._repopulateViewSelector();return e};g.prototype.insertView=function(e,t){this.insertAggregation("views",e,t);this._repopulateViewSelector();return this};g.prototype.removeView=function(e){var t=this.removeAggregation("views",e);this._repopulateViewSelector();return t};g.prototype.selectView=function(e){var t,i=0;switch(typeof e){case"number":{t=this.getViews()[e];i=e;break}case"object":{var r=this.getViews().length;for(var s=0;s<r;s++){if(e.getId()===this.getViews()[s].getId()){t=e;i=s;break}}}default:break}if(!t){return}var o=t.getResponsive();if(typeof o==="boolean"){this.setResponsive(o)}var n=t.getItemMinWidth();if(typeof n==="number"&&n>0&&n!==this.setItemMinWidth()){this.setItemMinWidth(n)}var a=t.getItemHeight();if(a!==this.getItemHeight()&&a>0){this.setItemHeight(a)}if(t.getNumberOfTiles()>0&&t.getNumberOfTiles()!==this.setNumberOfRows()){this.setNumberOfRows(t.getNumberOfTiles())}var h=t.getExternal();if(h===true){this.setExternal(true);this.setExternalRepresentation(t.getExternalRepresentation())}else{this.setExternal(false);this.setExternalRepresentation(null)}var g=this.getCurrentPage();var u=t.getPath();var d=t.getTemplate();if(u&&d){this.bindRows(u,d);this._applyFilter(this._currentFilterId);this._applySorter(this._currentSorterId)}if(this._currentViewIndex||i!==this._currentViewIndex){this.fireChangeView({newViewIndex:i,oldViewIndex:this._currentViewIndex,filterId:this._currentFilterId,sorterId:this._currentSorterId,page:g})}this._currentViewIndex=i;this._oView=t};g.prototype._applyFilter=function(e,t){if(e){if(!t){t=this.getBinding("rows")}var i=this.getFilters();var r;var s=i.length;for(var o=0;o<s;o++){if(i[o].getId()===e){r=i[o];break}}if(r){t.filter(r.getFilters())}}};g.prototype._applySorter=function(e,t){if(e){if(!t){t=this.getBinding("rows")}var i;var r=this.getSorters();var s=r.length;for(var o=0;o<s;o++){if(r[o].getId()===e){i=r[o];break}}if(i){t.sort(i.getSorter())}}};g.prototype.onBeforeRendering=function(){if(this.getResponsive()&&this.getShowMoreSteps()===0){if(!this._bInit){this.setNumberOfRows(0)}}else if(this._oView&&this._oView.getNumberOfTiles()>0&&this._oView.getNumberOfTiles()!==this.getNumberOfRows()&&!this.getResponsive()){this.setNumberOfRows(this._oView.getNumberOfTiles())}this._bInit=false};g.prototype._updateBodyPosition=function(){var e=jQuery("#"+this.getId()+">div.suiteUiVrViewSwHolder").outerHeight();var t=jQuery("#"+this.getId()+">div.sapUiRrPtb").outerHeight();var i=jQuery("#"+this.getId()+">div.sapUiRrStb").outerHeight();var r=jQuery("#"+this.getId()+">div.sapUiRrFtr").outerHeight();var s=jQuery(document.getElementById(this.getId()+"-body"));s.css("top",e+t+i+3+"px");s.css("bottom",r+"px")};g.prototype.onAfterRendering=function(){this._computeWidths(true);a.deregister(this._sResizeListenerId);if(this.getResponsive()){if(this.getShowMoreSteps()===0){jQuery("#"+this.getId()+">div.sapUiRrFtr").hide()}setTimeout(function(){this._sResizeListenerId=a.register(this.getId()+"-body"?window.document.getElementById(this.getId()+"-body"):null,jQuery.proxy(this._handleResize,this));if(this.getShowMoreSteps()===0){this._updateBodyPosition()}}.bind(this),100)}};g.prototype._handleResize=function(){if(!this.getDomRef()){return}this._computeWidths();if(this.getResponsive()&&this.getShowMoreSteps()===0){var e=jQuery(document.getElementById(this.getId()+"-body"));var t=e.height();var i=this._itemsPerRow;var r=Math.floor(t/(this.getItemHeight()+3));var s=r*i;if(s!==this.getNumberOfRows()){this._bInit=true;this.setNumberOfRows(s)}else{jQuery("#"+this.getId()+">div.sapUiRrFtr").show()}}};g.prototype._computeWidths=function(e){var t=this;var i=this.$();var r=t.getItemMinWidth();var s=this.getResponsive()===true?Math.floor(i.width()/r):1;var o=Math.floor(100/s);if(i.width()*o/100<r){s--;o=Math.floor(100/s)}if(e||t._height!==i.height()||t._itemsPerRow!==s){jQuery("#"+this.getId()+" .sapUiRrBody").css("width","100%");var n=100-s*o;var a;jQuery("#"+this.getId()+" .sapUiRrBody li").each(function(e){a=o;if(e%s<n){a++}jQuery(this).css("width",a+"%");jQuery(this).css("margin","0")});t._height=i.height();t._itemsPerRow=s;t._percentWidth=o}};g.prototype.startPagingAnimation=function(){a.deregister(this._sResizeListenerId);var e=sap.ui.getCore(),t=e.getRenderManager(),i=this.getId(),r=this.iPreviousPage,s=this.getCurrentPage(),o=this.getNumberOfRows(),n=(s-1)*o,h=this.getRows(),g=this._getRowCount()>o*s?o:this._getRowCount()-o*(s-1),u,d,l,p=this.getBinding("rows");var c,f=jQuery(i+"-page_"+r?window.document.getElementById(i+"-page_"+r):null),w=i+"-body"?window.document.getElementById(i+"-body"):null,m=jQuery(w);m.css("height",m.outerHeight()+"px");var v;if(sap.ui.getCore()&&sap.ui.getCore().getConfiguration()&&sap.ui.getCore().getConfiguration().getRTL()){v=s<r?"left":"right"}else{v=s<r?"right":"left"}if(p){this._bSecondPage=!this._bSecondPage;this.updateRows(true);h=this.getRows();n=(this._bSecondPage?1:0)*o}jQuery('<ul id="'+i+"-page_"+s+'" class="sapUiRrPage"></ul>').css("top",f.outerHeight(true)+"px").css(v,f.outerWidth(true)+"px").appendTo(w);var y=w.lastChild;var _=jQuery(y);var I=100-this._itemsPerRow*this._percentWidth;for(u=n,d=0;u<n+g;u++,d++){l=this._percentWidth;if(d%this._itemsPerRow<I){l++}jQuery('<li id="'+i+"-row_"+u+'" class="sapUiRrRow"></li>').css("width",l+"%").appendTo(y);c=y.lastChild;t.render(h[u],c)}if(v==="right"){f.animate({right:-f.outerWidth(true)},"slow");_.animate({right:0},"slow")}else{f.animate({left:-f.outerWidth(true)},"slow");_.animate({left:0},"slow")}m.animate({height:_.outerHeight(true)},"slow",jQuery.proxy(this.endPagingAnimation,this))};g.prototype.endPagingAnimation=function(){i.prototype.endPagingAnimation.call(this);this._sResizeListenerId=a.register(this.getId()+"-body"?window.document.getElementById(this.getId()+"-body"):null,jQuery.proxy(this._handleResize,this))};g.prototype.exit=function(){this._oSegBtn.destroy();this._oSearchField.destroy();a.deregister(this._sResizeListenerId)};return g});
//# sourceMappingURL=ViewRepeater.js.map