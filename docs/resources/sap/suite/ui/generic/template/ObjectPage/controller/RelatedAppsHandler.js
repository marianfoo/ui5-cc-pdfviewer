sap.ui.define(["sap/ui/base/Object","sap/base/util/extend"],function(t,e){"use strict";function n(t,e){function n(){return e.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.ObjectPage.view.fragments.RelatedAppsSheet",{buttonPressed:function(n){var a=n.getSource();var r=a.getBindingContext("buttons");var i=r.getProperty("link");var o=r.getProperty("param");var s=i.intent;var c=s.split("#")[1].split("-")[0];var p=s.split("-")[1].split("?")[0].split("~")[0];var l={semanticObject:c,action:p,parameters:o};e.oCommonUtils.fnProcessDataLossOrDraftDiscardConfirmation(function(){var n=t.getView().getBindingContext();e.oCommonEventHandlers.onRelatedAppNavigation(l,n)},Function.prototype,"LeaveApp")}},"buttons")}function a(t){var e=t.intent;var n=e.split("-")[0].split("#")[1];var a=e.split("-")[1].split("?")[0];return{link:t,semanticObject:n,action:a}}function r(r){var i=r.getSource();e.oServices.oApplication.performAfterSideEffectExecution(function(){var r=e.oServices.oApplication.getBusyHelper();var o=new Promise(function(o,s){var c=e.oServices.oApplication.getIntentPromise();var p=n();Promise.all([c,p]).then(function(n){var c=n[0];var p=c.semanticObject;var l=c.action;var v=n[1];var u=t.getView().getBindingContext();var f=u.getModel().getMetaModel();var m=u.getObject();var g=m.__metadata.type;var b=f.getODataEntityType(g);var d=b["com.sap.vocabularies.Common.v1.SemanticKey"];var O={};if(d&&d.length>0){for(var y=0;y<d.length;y++){var j=d[y].PropertyPath;if(!O[j]){O[j]=m[j]}}}else{for(var A in b.key.propertyRef){var h=b.key.propertyRef[A].name;if(!O[h]){O[h]=m[h]}}}var C=sap.ushell&&sap.ushell.Container;var x=C&&C.getService("CrossApplicationNavigation");if(!x){s();return}var S=e.oComponentUtils.getSettings();var k=S.relatedAppsSettings;var P;var E=k&&Object.keys(k).length>0;if(E){var R=[[{semanticObject:p}]];for(var U in k){if(U){R.push([{semanticObject:k[U].semanticObject}])}}P=x.getLinks(R)}else{var B=t.getOwnerComponent().getAppComponent();P=x.getLinks({semanticObject:p,params:O,ui5Component:B})}P.done(function(t){var n=[];var s=function(t){var e=a(t);n.push(e)};t.forEach(E?function(t){t[0].forEach(s)}:s);var c=function(t){return t.String};var u=b["com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"]||[];var f=u.map(c);b.property.forEach(function(t){var e=t["com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"]||[];f=f.concat(e.map(c))});n=n.filter(function(t){return t.semanticObject!==p||t.action!==l});n=n.filter(function(t){var e=t.semanticObject===p?"":t.semanticObject;var n=E&&k[e]&&k[e].semanticObjectAction;if(n){for(var a in n){if(n[a].action===t.action){return true}}return false}else{return f.indexOf(t.action)===-1}});n.sort(function(t,e){if(t.link.text<e.link.text){return-1}if(t.link.text>e.link.text){return 1}return 0});var m=v.getModel("buttons");var g=n.map(function(t){return{enabled:true,text:t.link.text,link:t.link,param:O}});if(g.length===0){g.push({enabled:false,text:e.oCommonUtils.getText("NO_RELATED_APPS")})}m.setProperty("/buttons",g);o();r.getUnbusy().then(v.openBy.bind(v,i))});P.fail(s)},s)});r.setBusy(o)},true)}return{getRelatedApps:r}}return t.extend("sap.suite.ui.generic.template.ObjectPage.controller.RelatedAppsHandler",{constructor:function(t,a){e(this,n(t,a))}})});
//# sourceMappingURL=RelatedAppsHandler.js.map