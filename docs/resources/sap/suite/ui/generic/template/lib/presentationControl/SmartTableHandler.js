sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/ui/dom/getFirstEditableInput","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper"],function(t,e,n,r,i){"use strict";function a(t,e,a,o){var u=o.getTable();var s=r.isMTable(u);var g=r.isUiTable(u);var l=r.isTreeTable(u);var c=g?"rows":"items";function f(){return u.getBinding(c)}function d(){return o.getTableBindingPath()}function v(){return u.getColumns()}function b(){var t=[];if(s){t=u.getSelectedContexts()}else if(g){var e=u.getPlugins().filter(function(t){return t.isA("sap.ui.table.plugins.SelectionPlugin")})[0];var n=e?e.getSelectedIndices():u.getSelectedIndices();if(n){var r;for(var i=0;i<n.length;i++){r=u.getContextByIndex(n[i]);if(r){t.push(r)}}}}return t}function p(){var t=f();if(!t){return null}if(l){var e=t.getLength()>0?t.getLength():0;var n=[];for(var r=0;r<e;r++){var i=t.getContextByIndex(r);n.push(i)}return n}return g?t.getContexts():t.getCurrentContexts()}function h(){return o.getModel()}function C(){var t=[];var e=o.getCustomData().find(function(t){return t.getKey()==="TemplateSortOrder"});var n=e&&e.getValue();if(n){n.split(", ").forEach(function(e){var n=e.split(" ");t.push({Property:n[0],Descending:n.length>1})})}return t}function I(){return u.getAggregation(c)}function T(){return e.setEnabledToolbarButtons(o)}function m(){return e.setEnabledFooterButtons(o)}function P(t){o.attachAfterVariantInitialise(function(){o.setCurrentVariantId(t)});o.setCurrentVariantId(t)}function x(){return u.getBindingInfo(c)}function S(t,e,n){t(n)}function B(e,n){var r=x();if(r&&r.binding){return new Promise(function(i,o){var u=function(t){r.binding.detachDataReceived(u);S(i,o,t)};r.binding.attachDataReceived(u);if(e){r.binding.refresh(e)}else{r.binding.refresh()}if(!n&&t.getView().getModel("ui").getProperty("/editable")){a.messagesRefresh()}})}else{return R()}}function R(){return new Promise(function(t,e){var n=function(r){o.detachBeforeRebindTable(n);var i=r.getParameters().bindingParams;var a=i.events.dataReceived||Function.prototype;var u=function(n){a.call(this,n);S(t,e,n)};i.events.dataReceived=u};o.attachBeforeRebindTable(n);o.rebindTable()})}function V(e){var n=t.getOwnerComponent();var r=n.getModel().getMetaModel();var i=[];var a=r.getODataEntitySet(n.getEntitySet())["Org.OData.Capabilities.V1.SortRestrictions"];if(a&&a.NonSortableProperties){i=a.NonSortableProperties.map(function(t){return t.PropertyPath})}var u=e.filter(function(t){return!i.includes(t.Property)});var s=o.getUiState();var g=s.getPresentationVariant();if(!g.SortOrder){g.SortOrder=C()}g.SortOrder=g.SortOrder.concat(u);s.setPresentationVariant(g);o.setUiState(s)}function y(t){if(s){var e=u.getItems().findIndex(function(e){return e.getBindingContextPath()===t});if(e>-1){u.scrollToIndex(e)}}}function w(t){var e=t.getPath();var n=-2;for(var r=0;n===-2;r++){var i=u.getContextByIndex(r);var a=i&&i.getPath();if(a===e){n=r}else if(!i){n=-1}}return n}function F(t){var e=u.getFirstVisibleRow();var n=u.getVisibleRowCount();var r=t.getPath();for(var i=0;i<n;i++){if(u.getContextByIndex(e+i).getPath()===r){return u.getRows()[i]}}}i.testable(F,"getGridTableRow");i.testable(w,"getGridTableRowIndexFromContext");function O(t){var e=t&&n(t.getDomRef());var i=e&&r.getUI5ControlForDomElement(e);r.focusUI5Control(i)}function D(t){if(s){var e=u.getItems();var n=e.find(function(e){return t.getPath()===e.getBindingContext().getPath()});if(n){setTimeout(function(){O(n)},0)}}else{var r=w(t);if(r!==-1){u.setFirstVisibleRow(r);setTimeout(function(){var e=F(t);O(e)},0)}}}function E(){return s?u.getGrowingThreshold():u.getThreshold()}function M(){return o.getDataStateIndicator()}function U(){return s}function A(){return o.getToolbar()}return{getBinding:f,getBindingPath:d,getSelectedContexts:b,getCurrentContexts:p,getVisibleProperties:v,getItems:I,getBindingInfo:x,getModel:h,setEnabledToolbarButtons:T,setEnabledFooterButtons:m,setCurrentVariantId:P,setCurrentTableVariantId:P,setCurrentChartVariantId:Function.prototype,refresh:B,rebind:R,applyNavigationSortOrder:V,scrollToSelectedItemAsPerChildContext:y,setFocusOnFirstEditableFieldInTableRow:D,getThreshold:E,getDataStateIndicator:M,getToolbar:A,isMTable:U}}return t.extend("sap.suite.ui.generic.template.lib.presentationControl.SmartTableHandler",{constructor:function(t,n,r,i){e(this,a(t,n,r,i))}})});
//# sourceMappingURL=SmartTableHandler.js.map