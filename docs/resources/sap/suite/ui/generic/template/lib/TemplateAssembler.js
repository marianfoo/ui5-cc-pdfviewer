sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/ui/core/mvc/View","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/lib/TemplateViewController","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/CRUDManager","sap/suite/ui/generic/template/lib/CommonUtils","sap/suite/ui/generic/template/lib/ComponentUtils","sap/suite/ui/generic/template/lib/CommonEventHandlers","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/support/lib/CommonMethods","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/base/util/deepExtend","sap/suite/ui/generic/template/lib/presentationControl/PresentationControlHandlerFactory","sap/suite/ui/generic/template/lib/info/InfoObjectHandler"],function(e,t,o,n,i,r,a,l,s,p,c,m,u,d,f,v){"use strict";var g=new u("lib.TemplateAssembler").getLogger();var C=Object.create(null);var R=Object.create(null);var h=function(e){var t=e.appComponent.getId();R[t]=e;return function(){delete R[t]}};function w(e){var t=e.getId();var o=R[t];return o}function y(e){return w(e.getAppComponent()).oTemplateContract.componentRegistry[e.getId()]}function T(e){while(e&&!(e instanceof o)){e=e.getParent()}return e}function A(e){while(e){var t=T(e);var o=t&&t.getController();var n=o&&o.getOwnerComponent();if(n instanceof r){var i=y(n);return i}else{e=n&&n.oContainer}}}function b(o,n,r){var a=C[o];if(a){return a}n=d({},n);r=d({},r);r.metadata=r.metadata||{};r.metadata.methods=r.metadata.methods||{};for(var l in r){if(typeof r[l]==="function"){var s=r.metadata.methods[l];if(!s){s={};r.metadata.methods[l]=s}s.public=s.public!==false;s.final=s.final||false;s.overrideExecution=s.overrideExecution||t.After}}r.metadata.methods.getExtensionAPI={public:true,final:true};r.getExtensionAPI=function(){var e=this.getView().getController();return e.extensionAPI};n.templateBaseExtension=e.extend(o+"BaseExtension",r);a=i.extend(o,n);C[o]=a;return a}function x(e){var t=e.methods.oControllerSpecification;return t?function(){var o=e.oComponent.getAppComponent();var i=w(o);var r=o.getTransactionController();var s=o.getNavigationController();var c={oComponentUtils:e.utils,oServices:{oTemplateCapabilities:{},oApplicationController:o.getApplicationController(),oTransactionController:r,oNavigationController:s,oDraftController:r.getDraftController(),oApplication:i.application,oViewDependencyHelper:i.oViewDependencyHelper}};e.viewRegistered.catch(function(t){g.debug(t.message);s.navigateToMessagePage({viewLevel:e.viewLevel,title:e.oTemplateContract.getText("ST_ERROR"),text:e.oTemplateContract.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:t.message})});e.oControllerUtils=c;var m=e.methods.oComponentData.templateName;var u=b(m,t.oControllerDefinition,t.oControllerExtensionDefinition);var d=new u;e.oController=d;var C=t.getMethods(c,d);d._templateEventHandlers=Object.freeze(C.handlers||{});d._templateFormatters=Object.freeze(C.formatters||{});d.extensionAPI=Object.freeze(C.extensionAPI||{});var R;d.onInit=function(){var t=d.getView();R=t.getId();g.info("Init view "+R+" of template "+m);if(o.isDestroyed()){g.info("Skip Init view as AppComponent is no longer active");return}c.oServices.oApplicationController.registerView(t);c.oServices.oDataLossHandler=i.oTemplateContract.oDataLossHandler;c.oCommonUtils=new l(d,c.oServices,c.oComponentUtils);c.oInfoObjectHandler=new v(d,c);c.oServices.oCRUDManager=new a(d,c.oComponentUtils,c.oServices,c.oCommonUtils,i.oTemplateContract.oBusyHelper);c.oCommonEventHandlers=new p(d,c.oComponentUtils,c.oServices,c.oCommonUtils);c.oServices.oPageLeaveHandler=i.oTemplateContract.oPageLeaveHandler;c.oServices.oPresentationControlHandlerFactory=new f(e.oController,c.oCommonUtils,c.oComponentUtils);var r=new n(t);e.oComponent.setModel(r,"_templPrivView");(C.onInit||Function.prototype)()};d.onExit=function(){i.oTemplateContract.oApplicationProxy.destroyView(R);(C.onExit||Function.prototype)();g.info("View "+R+" of template "+m+" exited")};return d}:Function.prototype}h=c.testableStatic(h,"TemplateComponent_RegisterAppComponent");return{getTemplateComponent:function(e,t,o){var n=t+".Component";o=o||{};o.init=function(){var t=this.getId();g.info("Init called for TemplateComponent "+t);var o=this.getComponentData();var i=o.registryEntry;var a=w(i.oAppComponent);var l=a.oTemplateContract;var p=a.oTemplateContract.mRoutingTree[i.route];i.viewRegistered=new Promise(function(e,t){i.fnViewRegisteredResolve=function(o){if(o){i.fnViewRegisteredResolve=Function.prototype;t(o)}else{delete i.fnViewRegisteredResolve;e()}}});i.oViewRenderedPromise=new Promise(function(e){i.fnViewRenderdResolve=e});i.oViewRenderedPromise.then(function(){m.setApplicationStatus(m.mApplicationStatus.RENDERED);m.publishEvent("elements","ViewRendered",{})});i.componentName=n;i.oComponent=this;i.aKeys=[];i.oTemplateContract=a.oTemplateContract;(r.prototype.init||Function.prototype).apply(this,arguments);i.utils=new s(this,i);i.methods=e(this,i.utils)||{};i.oGenericData={};i.mRefreshInfos=Object.create(null);i.bWithoutAssociationsRefresh=false;p.componentId=t;l.componentRegistry[t]=i;p.willBeDisplayed.then(l.oBusyHelper.setBusy.bind(null,i.viewRegistered,true,undefined,true));i.oApplication=a.application;i.createViewController=x(i);p.componentCreatedResolve(this);delete p.componentCreatedResolve;delete o.registryEntry;(i.methods.init||Function.prototype)();g.info("Init done for TemplateComponent "+t)};o.exit=function(){var e=this.getId();g.info("Exit called for TemplateComponent "+e);var t=y(this);var o=w(this.getAppComponent());var n=t.methods;(n.exit||Function.prototype)();t.utils.leaveApp(true);delete o.oTemplateContract.componentRegistry[e];(r.prototype.exit||Function.prototype).apply(this,arguments);g.info("Exit done for TemplateComponent "+e)};o.onBeforeRendering=function(){var e=this.getId();g.info("BeforeRendering called for TemplateComponent "+e);var t=y(this);(r.prototype.onBeforeRendering||Function.prototype).bind(this,t).apply(this,arguments);var o=t.methods;(o.onBeforeRendering||Function.prototype)();g.info("BeforeRendering done for TemplateComponent "+e)};o.onAfterRendering=function(){var e=this.getId();g.info("AfterRendering called for TemplateComponent "+e);var t=y(this);if(t.fnViewRenderdResolve&&!t.fnViewRegisteredResolve){t.fnViewRenderdResolve();delete t.fnViewRenderdResolve}(r.prototype.onAfterRendering||Function.prototype).bind(this,t).apply(this,arguments);var o=t.methods;(o.onAftereRendering||Function.prototype)();g.info("AfterRendering done for TemplateComponent "+e)};o.setIsRefreshRequired=function(e){if(e===this.getProperty("isRefreshRequired")){return}this.setProperty("isRefreshRequired",e);var t=y(this);if(e&&!t.oTemplateContract.oNavigationControllerProxy.isNavigating()){t.oTemplateContract.oNavigationObserver.getProcessFinished(true).then(function(){if(this.getProperty("isRefreshRequired")&&t.utils.isComponentActive()){t.utils.refreshBinding(true,{})}}.bind(this))}};o.onDeactivate=Function.prototype;return r.extend(n,o)},getRegisterAppComponent:function(){var e=h;h=null;return e},getExtensionAPIPromise:function(e){var t=A(e);if(!t){return Promise.reject()}return t.viewRegistered.then(function(){return t.oController.extensionAPI})},getExtensionAPI:function(e){var t=A(e);return t&&t.oController&&t.oController.extensionAPI}}});
//# sourceMappingURL=TemplateAssembler.js.map