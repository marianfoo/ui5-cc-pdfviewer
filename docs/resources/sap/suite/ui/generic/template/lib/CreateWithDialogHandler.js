sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/lib/MessageUtils","sap/base/util/extend","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/lib/CRUDHelper","sap/base/util/isEmptyObject","sap/ui/model/Context"],function(e,t,n,o,i,s,a,r,l){"use strict";function g(e,t,o){var l,g;function c(){return{aFilters:[{sPath:"fullTarget",sOperator:"StartsWith",oValue1:l.getBindingContext().getPath()},{sPath:"target",sOperator:"EQ",oValue1:"/"+t.getOwnerComponent().getEntitySet()}]}}function u(){var e=c(l);var t=sap.ui.getCore().getMessageManager().getMessageModel();if(e){var n=t.bindList("/",null,null,[e]);var o=n.getContexts();if(o.length){var i=[];for(var s in o){i.push(o[s].getObject())}sap.ui.getCore().getMessageManager().removeMessages(i)}}}function f(){l.close();l.setVisible(false);if(o.oComponentUtils.isDraftEnabled()){o.oServices.oCRUDManager.discardDraft(l.getBindingContext())}else{u(l);t.getView().getModel().deleteCreatedEntry(l.getBindingContext())}l.setBindingContext(null)}function C(){var i=false;var s;var a=l&&typeof l.getContent==="function"&&l.getContent()&&l.getContent()[0];var r=a?a.check():Promise.resolve();r.then(function(){var a=sap.ui.getCore().getMessageManager().getMessageModel().getData();i=a.some(function(e){return e.type==="Error"&&e.validation});if(!i&&o.oComponentUtils.isDraftEnabled()){var r=o.oComponentUtils.getCRUDActionHandler();s=c(l);r.handleCRUDScenario(1,d.bind(null,s))}else if(!i){o.oCommonEventHandlers.submitChangesForSmartMultiInput();s=c(l);var f=o.oServices.oCRUDManager.saveEntity(s);if(o.oComponentUtils.getViewLevel()===1){o.oServices.oApplicationController.executeSideEffects(g.getBindingContext(),[],[g.getTableBindingPath()])}f.then(function(){l.close();l.setVisible(false);if(e.oPresentationControlHandler){if(e.refreshModel){e.refreshModel()}else{o.oCommonUtils.refreshModel(e.oPresentationControlHandler.getEntitySet())}e.oPresentationControlHandler.refresh();n.showSuccessMessageIfRequired(o.oCommonUtils.getText("OBJECT_CREATED"),o.oServices)}else{o.oCommonUtils.refreshModel(g.getEntitySet());o.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(g).refresh();n.showSuccessMessageIfRequired(o.oCommonUtils.getContextText("ITEM_CREATED",g.getId()),o.oServices)}var t=o.oServices.oApplication.getBusyHelper();t.getUnbusy().then(function(){u(l);l.setBindingContext(null)})});var C={saveEntityPromise:f};o.oComponentUtils.fire(t,"AfterSave",C)}})}function d(i){var s=o.oServices.oCRUDManager.activateDraftEntity(l.getBindingContext(),i);s.then(function(t){if(t&&t.response&&t.response.statusCode==="200"){l.close();l.setVisible(false);l.setBindingContext(null);n.showSuccessMessageIfRequired(o.oCommonUtils.getText("OBJECT_CREATED"),o.oServices);e.oPresentationControlHandler.refresh()}},Function.prototype);var a={activationPromise:s};o.oComponentUtils.fire(t,"AfterActivate",a)}function p(e,t,n){g=o.oCommonUtils.getOwnerControl(t);g=i.isSmartTable(g)?g:g.getParent();var s=g.getParent().getBindingContext();n=r(n)?false:n;if(!n){var a=o.oServices.oCRUDManager.getDefaultValues(t,n);if(a instanceof Promise){var l=function(n){v(e,t,n[0],g,s)};a.then(l,l)}else{v(e,t,n,g,s)}}else{v(e,t,n,g,s)}}function v(t,n,i,s,r){var g=e.oSmartFilterbar;var c=r?s.getTableBindingPath():"/"+s.getEntitySet();var u=new sap.ui.model.json.JSONModel;l=t;l.setVisible(true);u.setProperty("/title",o.oCommonUtils.getContextText("CREATE_DIALOG_TITLE",s.getId()));l.setModel(u,"localModel");l.setEscapeHandler(f);if(o.oComponentUtils.isDraftEnabled()){o.oCommonEventHandlers.addEntry(n,false,g,i,false,true).then(function(e){o.oServices.oApplication.registerContext(e);l.setBindingContext(e);l.open()})}else{var C=a.createNonDraft(r,c,l.getModel(),i);l.setBindingContext(C);l.open()}}var d=s.testable(d,"fnActivateImpl");var u=s.testable(u,"fnRemoveOldMessageFromModel");var c=s.testable(c,"fnGetFilterForCurrentState");var v=s.testable(v,"openDialog");return{onCancelPopUpDialog:f,onSavePopUpDialog:C,createWithDialog:p}}return e.extend("sap.suite.ui.generic.template.lib.CreateWithDialogHandler",{constructor:function(e,t,n){o(this,g(e,t,n))}})});
//# sourceMappingURL=CreateWithDialogHandler.js.map