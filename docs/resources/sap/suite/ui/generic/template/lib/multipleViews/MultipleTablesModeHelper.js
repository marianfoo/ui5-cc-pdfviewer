sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/Filter","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/base/util/extend","sap/suite/ui/generic/template/js/StableIdHelper","sap/base/util/isEmptyObject"],function(e,t,r,n,a,i,l){"use strict";function o(e,t){if(Array.isArray(e)){var n=true;var a;for(var i=0;i<e.length;i++){var l=o(e[i],t);if(n){if(l===e[i]){continue}n=false;a=e.slice(0,i)}if(l){a.push(l)}}return n?e:a}if(e.aFilters){var p=o(e.aFilters,t);if(p===e.aFilters){return e}if(p.length===0){return null}if(p.length===1){return p[0]}return new r({filters:p,and:e.bAnd})}return t(e)}function p(e,r,a){var p;var s;var u;var c=new Promise(function(e){u=e});var m=r.oComponentUtils.getTemplatePrivateModel();var g=a.pathInTemplatePrivateModel+"/implementingHelper";var f=g+"/ignoredFilters";m.setProperty(g,{ignoredFilters:[]});var d=e.getOwnerComponent().getEntitySet();var v=r.oCommonUtils.getMetaModelEntityType(d);function S(){var e;for(var t in p){var r=p[t];var n=r.presentationControlHandler.getEntitySet();if(e&&e!==n){return true}e=n}return false}function b(e,t,r,n){if(r&&n){C(e,r)}var i=a.smartFilterBar;if(!i){return e}var l=i.getFilters();if(l.length===0){if(!n){m.setProperty(f,[]);t.implementingHelperAttributes.ignoredLabels=[]}return e}l=h(t,l,!n);return l.concat(e)}function y(e){var t,r;if(e.indexOf("/")!==-1){t=e.split("/");r=t.pop()}else{r=e}return r}function h(t,n,a){var i=t.presentationControlHandler;var l=i.getEntitySet();if(l===d){if(a){m.setProperty(f,[]);t.implementingHelperAttributes.ignoredLabels=[]}return n}var p=e.getOwnerComponent().getModel().getMetaModel();var s=r.oCommonUtils.getMetaModelEntityType(l);var u=a&&Object.create(null);var c=function(e){var t=e.sPath;var r=false;var n=y(t);var a=A(t,p,s);if(a){a.some(function(e){var t;if(e.name===n){var t=e["com.sap.vocabularies.UI.v1.Hidden"];r=!t||t.Bool!=="true";return true}return false})}if(r){return e}if(u){u[t]=true}return null};var g=o(n,c);if(u){var S=Object.keys(u);var b=S.map(function(e){var t=y(e);var r=A(e,p,v);var n=r&&r.find(function(e){return e.name===t});var a=n&&(n["sap:label"]||n["com.sap.vocabularies.Common.v1.Label"]&&n["com.sap.vocabularies.Common.v1.Label"].String)||t;return a});m.setProperty(f,b);t.implementingHelperAttributes.ignoredLabels=b}return g}function A(e,t,r){var n=e.split("/");for(var a=0;r&&a<n.length-1;a++){var i=n[a];var l=r.navigationProperty;var o=false;for(var p in l){if(l[p].name===i){o=true;break}}var s=o&&t.getODataAssociationEnd(r,i);r=s&&t.getODataEntityType(s.type)}return r&&r.property}function C(e,t){for(var r in t){var n=t[r];for(var a=e.length;a--;a>=0){if(JSON.stringify(e[a])===JSON.stringify(n)){e.splice(a,1);break}}}}function H(t){return{entityTypeProperty:r.oCommonUtils.getMetaModelEntityType(t.presentationControlHandler.getEntitySet()).property,dirtyState:0,controlStateWrapper:r.oCommonUtils.getControlStateWrapper(e.byId(i.getStableId({type:"ListReportTable",subType:"SmartTable",sQuickVariantKey:t.switchingKey}))),searchFieldWrapper:r.oCommonUtils.getControlStateWrapper(e.byId(i.getStableId({type:"ListReportAction",subType:"SearchField",sQuickVariantKey:t.switchingKey})))}}function E(e,t,r){p=e;for(var n in p){var i=p[n];i.implementingHelperAttributes=H(i);i.implementingHelperAttributes.controlStateWrapper.attachStateChanged(a.appStateChange);i.implementingHelperAttributes.searchFieldWrapper.attachStateChanged(a.appStateChange)}if(a.smartFilterBar){a.smartFilterBar.attachSearch(function(e){t(3)})}u()}function F(e,n){if(!n){return""}var a="";var i=p[n].text;if(e&&e.length>0){if((t.system.tablet||t.system.phone)&&!t.system.desktop){if(e.length>1){a=r.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_S_FORM",[e.join(", "),i])}else{a=r.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_S_FORM",[e[0],i])}}else if(e.length>1){a=r.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_L_FORM",[e.join(", "),i])}else{a=r.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_L_FORM",[e[0],i])}}return a}function I(e){var t=p[e];var r=t.implementingHelperAttributes.ignoredLabels||[];m.setProperty(f,r);a.adaptPresentationControl()}function L(e){s=e;c.then(function(){var t,r;if(e.controlStates){for(var n in p){p[n].implementingHelperAttributes.controlStateWrapper.setState(e.controlStates[p[n].presentationControlHandler.getId()]);p[n].implementingHelperAttributes.searchFieldWrapper.setState(e.controlStates[p[n].implementingHelperAttributes.searchFieldWrapper.getLocalId()])}}else{for(var n in p){t=p[n].presentationControlHandler;r=e.tableVariantIds[t.getId()];if(r){t.setCurrentVariantId(r)}}}I(e.selectedTab)});return e.selectedTab}function M(e){var t,r,n=Object.create(null);if(l(p)){return s}for(t in p){r=p[t].presentationControlHandler;n[r.getId()]=p[t].implementingHelperAttributes.controlStateWrapper.getState();if(p[t].implementingHelperAttributes.searchFieldWrapper.getLocalId()){n[p[t].implementingHelperAttributes.searchFieldWrapper.getLocalId()]=p[t].implementingHelperAttributes.searchFieldWrapper.getState()}}var a={selectedTab:e,controlStates:n};return a}function W(e){return e}function T(e){return{getState:function(){var e=Object.create(null);Object.values(p).forEach(function(t){e[t.implementingHelperAttributes.controlStateWrapper.getLocalId()]=t.implementingHelperAttributes.controlStateWrapper.getState();var r=t.implementingHelperAttributes.searchFieldWrapper;if(r.getLocalId()){e[r.getLocalId()]=r.getState()}});return{controlStates:e}},setState:function(e){if(e.controlStates){Object.values(p).forEach(function(t){t.implementingHelperAttributes.controlStateWrapper.setState(e.controlStates[t.implementingHelperAttributes.controlStateWrapper.getLocalId()]);t.implementingHelperAttributes.searchFieldWrapper.setState(e.controlStates[t.implementingHelperAttributes.searchFieldWrapper.getLocalId()])})}else{}},attachStateChanged:function(e){c.then(function(){Object.values(p).forEach(function(t){t.implementingHelperAttributes.controlStateWrapper.attachStateChanged(e);t.implementingHelperAttributes.searchFieldWrapper.attachStateChanged(e)})})}}}function O(e,t,r,n,a,i,l){var o=function(t){if(t===n&&i){l(e);return}var r=p[t];if(r.implementingHelperAttributes.dirtyState>0&&r.implementingHelperAttributes.dirtyState!==e){r.implementingHelperAttributes.dirtyState=3}else{r.implementingHelperAttributes.dirtyState=e}};if(t){if(a){t.forEach(o);return}o(t);return}for(var s in p){if(!r||r[p[s].presentationControlHandler.getEntitySet()]){o(s)}}}function U(){return"multi"}function _(e){var t=p[e];var r=t.implementingHelperAttributes.dirtyState;t.implementingHelperAttributes.dirtyState=0;return r}function P(e,t){for(var r in p){var n=p[r].presentationControlHandler;n.setCurrentTableVariantId(t);n.setCurrentChartVariantId(e)}}function V(e){var t=e.getEntitySet();for(var r in p){var n=p[r];var a=n.presentationControlHandler;if(a!==e&&a.getEntitySet()===t&&n.implementingHelperAttributes.dirtyState<2){n.implementingHelperAttributes.dirtyState+=2}}}var h=n.testable(h,"fnCleanupIrrelevantFilters");return{init:E,getDefaultShowCounts:S,getFiltersAdaptedFromItem:b,formatMessageStrip:F,onSelectedKeyChanged:I,getContentForIappState:M,getSelectedKeyAndRestoreFromIappState:L,getSFBVariantContentStateWrapper:W,getGeneralContentStateWrapper:T,refreshOperation:O,getMode:U,getRefreshMode:_,setControlVariant:P,refreshSiblingControls:V}}return e.extend("sap.suite.ui.generic.template.lib.multipleViews.MultipleTablesModeHelper",{constructor:function(e,t,r){a(this,p(e,t,r))}})});
//# sourceMappingURL=MultipleTablesModeHelper.js.map