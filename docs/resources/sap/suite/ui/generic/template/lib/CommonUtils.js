sap.ui.define(["sap/ui/base/Object","sap/ui/base/Event","sap/ui/core/mvc/ControllerExtension","sap/ui/model/Context","sap/ui/model/Filter","sap/m/Table","sap/m/MessageBox","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/generic/app/navigation/service/NavError","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/model/analytics/odata4analytics","sap/base/util/extend","sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/genericUtilities/ControlStateWrapperFactory","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/IconPool"],function(e,t,a,r,n,i,o,s,l,c,g,u,f,p,v,d,m,y,b,h,C){"use strict";var P="lib.CommonUtils";var S=sap.ui.getCore();var D=new f(P).getLogger();function A(e,t,r){var n;var s=new b(e);var f=Object.create(null);function y(e){var t;if(c.isSmartTable(e)){t=e.getCustomToolbar()}else if(c.isSmartChart(e)){t=e.getToolbar()}if(t){var a=N(t);if(a&&a.annotatedActionIds){f[e.getId()]=JSON.parse(atob(a.annotatedActionIds))}if(a&&a.deleteButtonId){f[e.getId()].push({ID:a.deleteButtonId,RecordType:"CRUDActionDelete"})}if(a&&a.multiEditButtonId){f[e.getId()].push({ID:a.multiEditButtonId,RecordType:"CRUDActionMultiEdit"})}}}function A(e){var t=e.getId();if(!f[t]){y(e)}return f[t]||[]}function E(t){var a,r,n;a=e.getOwnerComponent().getModel().getMetaModel();r=a.getODataEntitySet(t);n=a.getODataEntityType(r.entityType);return n}function O(a){t.oApplication.attachControlToParent(a,e.getView())}function I(t,a,r){var n="";var i=e.getView();var o=t.find(function(e){var t;var o=r&&function(a){r(e,a,t);t=a};if(c.isElementVisibleOnView(e,i,o)){if(a){var s=S.byId(e);if(c.isTable(s)){n=n||e;return false}}return true}});return o||n}function T(a,r,n,i){return t.oApplication.getDialogFragmentForView(e.getView(),a,r,n,i)}function x(a,r,n,i,o){return t.oApplication.getDialogFragmentForViewAsync(e.getView(),a,r,n,i,o)}var M;function B(t,a,r){var n=e.getOwnerComponent();M=M||n.getModel("i18n").getResourceBundle();return M.getText(t,a,r)}function w(e,t,a,r){var n=a||e,i=t&&t!="|"?e+"|"+t:n;var o=B(i,r,true);if(!o&&i!=n){o=B(n,r)}return o}function R(t,a,r,n){var i=e.getOwnerComponent();var o=a.indexOf("::"+i.getEntitySet()+"--")+2;var s=a.substring(o,a.lastIndexOf("::")),s=s.replace(/--/g,"|").replace(/::/g,"|");return w(t,s,r,n)}function F(e,t){var t=t||e.getSelectionBehavior();if(t==="DATAPOINT"){return{dataPoints:e.getSelectedDataPoints().dataPoints,count:e.getSelectedDataPoints().count}}else if(t==="CATEGORY"){return{dataPoints:e.getSelectedCategories().categories,count:e.getSelectedCategories().count}}else if(t==="SERIES"){return{dataPoints:e.getSelectedSeries().series,count:e.getSelectedSeries().count}}}function N(e){var t={};if(e instanceof sap.ui.core.Element){e.getCustomData().forEach(function(e){t[e.getKey()]=e.getValue()})}return t}function k(e){var a,r;var n=z(e);if(!c.isSmartTable(n)&&!c.isSmartChart(n)){n=n.getParent()}var i=t.oPresentationControlHandlerFactory.getPresentationControlHandler(n).getSelectedContexts();var o=n.getModel();G(i,o,n);a=A(n);for(var s=0;s<a.length;s++){r=a[s];V(r,o,i,n)}}function V(t,a,n,i){var o;if(t.RecordType==="CRUDActionDelete"){var s=H(a,n,i);r.getTemplatePrivateModel().setProperty("/listReport/deleteEnabled",s);o=Promise.resolve(s)}else if(t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){var l=a.getMetaModel();o=U(a,l,n,t.RecordType,t.Action,i)}else if(t.RecordType==="CRUDActionMultiEdit"){r.getTemplatePrivateModel().setProperty("/listReport/multiEditEnabled",n.filter(_).length>0)}var c=e.getView().byId(t.ID);if(c&&/generic\/controlProperties/.test(c.getBindingPath("enabled"))){o.then(j.bind(null,t.ID,"enabled"))}}function L(e){var a=Y(e);G(t.oPresentationControlHandlerFactory.getPresentationControlHandler(a).getSelectedContexts(),e.getModel(),a)}function j(e,t,a){var n=r.getTemplatePrivateModel();var i=n.getProperty("/generic/controlProperties/"+e);if(!i){i={};i[t]=a;n.setProperty("/generic/controlProperties/"+e,i)}else{n.setProperty("/generic/controlProperties/"+e+"/"+t,a)}}function U(e,t,a,r,n,i){var o,s,l,g;var u=false;if(r==="com.sap.vocabularies.UI.v1.DataFieldForAction"){o=t.getODataFunctionImport(n);l=o&&o["sap:action-for"];if(l&&l!==""&&l!==" "){if(a.length>0){g=o["sap:applicable-path"];if(g&&g!==""&&g!==" "){for(var f=0;f<a.length;f++){if(!a[f]||a[f].isTransient()){continue}s=e.getObject(a[f].getPath());if(s&&s[g]){u=true;break}}}else{u=true}}}else{u=true}}else if(r==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(Se(a).length>0){u=true}else if(c.isSmartChart(i)){return i.getChartAsync().then(function(){return i.getDrillStackFilters().length>0})}}return Promise.resolve(u)}function H(e,t,a){if(t.length===0){return false}var r=K(a);var n=r&&r.Deletable&&r.Deletable.Path;return t.some(function(t){var a=e.getObject(t.getPath()+"/DraftAdministrativeData");var r=!(a&&a.InProcessByUser&&!a.DraftIsProcessedByMe);return r&&!t.isTransient()&&!(n&&!e.getProperty(n,t))})}function K(e){var t=e.getModel()&&e.getModel().getMetaModel();var a=t&&t.getODataEntitySet(e.getEntitySet());var r=a&&a["Org.OData.Capabilities.V1.DeleteRestrictions"];return r}function _(e){var a=e.getModel();var r=a.getObject(e.getPath()+"/DraftAdministrativeData");var n=h.analyseContext(e);var i=t.oApplication.isObjectInEditMode(n.entitySet,n.key);if(!r&&!i){var o=a.getMetaModel().getODataEntitySet(h.analyseContext(e).entitySet);var s=o["Org.OData.Capabilities.V1.UpdateRestrictions"]&&o["Org.OData.Capabilities.V1.UpdateRestrictions"].Updatable;if(s){if(s.Path){return!!a.getProperty(s.Path,e)}else if(s.Bool!=="false"){return true}}else{return true}}}function G(t,a,n){var i=J(n);var o=r.getTemplatePrivateModel();var s=o.getProperty("/generic/listCommons/breakoutActionsEnabled");if(i){var l=e.byId("template::IconTabBar");var c="";if(l){c=l.getSelectedKey()}W(s,i,t,a,c,n)}o.setProperty("/generic/listCommons/breakoutActionsEnabled",s)}function W(e,t,a,r,n,i){var o;for(var s in t){o=true;var l=t[s].id+(n&&!t[s].determining?"-"+n:"");if(i&&i.getId().indexOf("AnalyticalListPage")>-1){o=!!e[l].enabled}if(t[s].requiresSelection){if(a.length>0){if(i&&c.isSmartChart(i)){if(t[s].filter==="chart"){o=true}}else if(i&&c.isSmartTable(i)){if(t[s].filter!=="chart"){o=true}}if(t[s].applicablePath!==undefined&&t[s].applicablePath!==""){o=false;for(var g=0;g<a.length;g++){var u="";var f=t[s].applicablePath.split("/");if(f.length>1){for(var p=0;p<f.length-1;p++){u+="/"+f[p]}}var v=r.getObject(a[g].getPath()+u);var d=f[f.length-1];if(v[d]===true){o=true;break}}}}else if(c.isSmartChart(i)){if(i.getId().indexOf("AnalyticalListPage")>-1?t[s].filter==="chart":true){if(i.getDrillStackFilters().length>0){o=true}else{o=false}}}else{if(t[s].filter!=="chart"){o=false}}}e[l]={enabled:o}}}function J(e){var t=r.getControllerExtensions();var a=N(e).sectionId;if(!a){return t&&t["Actions"]}else{return t&&t.Sections&&t.Sections[a]&&t.Sections[a].Actions}}function z(e){var t=e;while(t){if(t instanceof i||c.isUiTable(t)||c.isSmartTable(t)||c.isSmartChart(t)||c.isSmartList(t)){return t}t=t.getParent&&t.getParent()}return null}function Y(e){var t=e;while(t){if(c.isSmartTable(t)||c.isSmartChart(t)||c.isSmartList(t)){return t}t=t.getParent&&t.getParent()}return null}function q(a){if(!t.oApplication.checkEtags(a)){var r=e.getOwnerComponent();var n=r.getModel();var i=n.getMetaModel().getODataEntitySet(a);if(e.getMetadata().getName()==="sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"&&Q(n,i)){n.invalidateEntityType(i.entityType)}else{var o=function(e){return h.analyseContextPath(e,n).entitySet===a};n.invalidate(o)}var s=r.getId();var l=Object.create(null);l[s]=true;t.oApplication.refreshAllComponents(l);return true}return false}function Q(e,t){var a=new p.Model(p.Model.ReferenceByModel(e));var r=a.findQueryResultByName(t.name);var n=r&&r.getParameterization();return!!n}function Z(a,n,i){var o;if(r.isDraftEnabled()){o=t.oDraftController.isActiveEntity(a)?1:6}else{var s=e.getOwnerComponent();o=s.getModel("ui").getProperty("/editable")?6:1}if(i){t.oApplication.setObjectInEditMode(true)}r.navigateAccordingToContext(a,o,n)}function X(e){if(e instanceof l){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){o.show(B("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:B("ST_GENERIC_ERROR_TITLE")})}else{o.show(e.getErrorCode(),{title:B("ST_GENERIC_ERROR_TITLE")})}}}function $(a,r){ue(function(){n=t.oApplication.getNavigationHandler();var r={semanticObject:a.semanticObject,action:a.action};var i=n.mixAttributesAndSelectionVariant(a.parameters);if(typeof e.adaptNavigationParameterExtension==="function"){e.adaptNavigationParameterExtension(i,r)}he(a);t.oApplication.navigateExternal(a.semanticObject,a.action,i.toJSONString(),null,X)},Function.prototype,"LeaveApp")}function ee(t){var a=[],r,n,i;var o=e.getOwnerComponent();var s=o.getModel().getMetaModel();if(!t){return{}}var l=o.getAppComponent().getConfig().pages[0];if(!l){return{}}var c=function(e){i=s.getODataEntitySet(e.entitySet).entityType;n=s.getODataEntityType(i);r={};r={entitySet:e.entitySet,aKeys:s.getODataEntityType(i).key.propertyRef,navigationProperty:e.navigationProperty};for(var t=0,a=r.aKeys.length;t<a;t++){var o=0,l=n.property.length;for(o;o<l;o++){if(r.aKeys[t].name===n.property[o].name){r.aKeys[t].type=n.property[o].type;break}}}};var g=function(e,t){if(!t.pages){return a}for(var n=0,i=t.pages.length;n<i;n++){if(!t.pages[n]){break}if(e===t.pages[n].entitySet){c(t.pages[n]);a.splice(0,0,r);break}a=g(e,t.pages[n]);if(a.length>0){c(t.pages[n]);a.splice(0,0,r)}}return a};return g(t,l)}function te(e,t){var a,r,n,i;for(n=0,i=e.length;n<i;n++){if(e[n].navigationProperty){r+="/"+e[n].navigationProperty}else{r="/"+e[n].entitySet}for(var o=0,s=e[n].aKeys.length;o<s;o++){if(o===0){r+="(";a=""}else{a=","}switch(e[n].aKeys[o].type){case"Edm.Guid":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){r+=a+e[n].aKeys[o].name+"="+"guid'"+t.DraftAdministrativeData.DraftUUID+"'"}else{r+=a+e[n].aKeys[o].name+"="+"guid'"+t[e[n].aKeys[o].name]+"'"}break;case"Edm.Boolean":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){r+=a+e[n].aKeys[o].name+"="+false}else{r+=a+e[n].aKeys[o].name+"="+t[e[n].aKeys[o].name]}break;default:if(typeof t[e[n].aKeys[o].name]==="string"){r+=a+e[n].aKeys[o].name+"="+"'"+t[e[n].aKeys[o].name]+"'"}else{r+=a+e[n].aKeys[o].name+"="+t[e[n].aKeys[o].name]}break}if(o===s-1){r+=")"}}}return r}function ae(e,a,r,i){var o,s,l,c,g,u,f;var p={semanticObject:"",action:""};var v=e.getParameters();n=t.oApplication.getNavigationHandler();o=n.mixAttributesAndSelectionVariant({},a);for(c in v.semanticAttributesOfSemanticObjects){for(l in v.semanticAttributesOfSemanticObjects[c]){if(!o.getSelectOption(l)){o.addParameter(l,"")}}g=o.getPropertyNames();p.semanticObject=c;u=o.getSelectOptionsPropertyNames();f=o.getParameterNames();for(var d=0,m=g.length;d<m;d++){if(u.indexOf(g[d])<0&&f.indexOf(g[d])<0){delete v.semanticAttributesOfSemanticObjects[c][g[d]];o.removeSelectOption(g[d])}}if(c===v.semanticObject){var y=v.semanticAttributesOfSemanticObjects[""];for(var b=0,m=f.length;b<m;b++){o.removeParameter(f[b]);if(!(f[b]in y)){var h=v.semanticAttributesOfSemanticObjects[v.semanticObject][f[b]];h=typeof h==="undefined"||h===null?"":String(h);o.addParameter(f[b],h)}}o=n.mixAttributesAndSelectionVariant(v.semanticAttributesOfSemanticObjects[c],o.toJSONString());o=re(o,e.getSource(),i);r.adaptNavigationParameterExtension(o,p);s=o.toJSONString()}}delete v.semanticAttributes;n.processBeforeSmartLinkPopoverOpens(v,s)}function re(t,a,r){var n;var i=[];var o=e.getOwnerComponent().getEntitySet();if(!c.isSemanticObjectController(a)&&!c.isSmartTable(a)){var s=z(a)&&z(a).getParent();if(c.isSmartTable(s)){a=s;n=a.getEntitySet()}else{n=o}}else{n=a.getEntitySet()}i.push(n);var l=r&&r.oMultipleViewsHandler&&r.oMultipleViewsHandler.getMode&&r.oMultipleViewsHandler.getMode()==="multi";if(n!==o&&!l){i.push(o)}i.forEach(function(e){if(a){var r=a.getModel().getMetaModel();var n=r.getODataEntityType(r.getODataEntitySet(e).entityType);t.getPropertyNames().forEach(function(e){var a=r.getODataProperty(n,e);if(a&&(a["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"]&&a["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"].Bool!=="false"||a["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&a["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool!=="false")){t.removeSelectOption(e)}})}});return t}function ne(a,r){var n=function(e){for(var t=0;t<e.length;t++){r(e[t].name)}};var i=e.getView().getModel().getMetaModel();var o=i.getODataEntitySet(a,false);var s=i.getODataEntityType(o.entityType,false);n(s.key.propertyRef);var l=t.oDraftController.getDraftContext();if(l.isDraftEnabled(a)){n(l.getSemanticKey(a));r("IsActiveEntity");r("HasDraftEntity");r("HasActiveEntity")}}function ie(t,a,r,n){if(n&&r&&r.getAnalyticBindingPath&&r.getConsiderAnalyticalParameters()){try{var i=r.getAnalyticBindingPath();var o=t.getEntitySet();var s=t.getModel();var l=s.getMetaModel();var c=l.getODataEntitySet(o);var u=e.getOwnerComponent();var f=u.getAppComponent();var p=g.getParametersByEntitySet(f.getModel(),o);if(l.getODataEntityType(c.entityType)["sap:semantics"]!=="aggregate"){if(a){var v=a(c,p);i=v||i}}if(i){n(i)}}catch(e){D.warning("Mandatory parameters have no values")}}}function oe(e,a,r){for(var n=0;n<a.length;n++){var i=a[n];var o=i.lastIndexOf("/");var s;if(o<0){if(t.oApplication.getNavigationProperty(e,i)){s=i}else{continue}}else{s=i.substring(0,o)}if(r.indexOf(s)===-1){r.push(s)}}}function se(t,n,i){var o=t.getParameter("bindingParams"),s=t.getSource().getId();o.parameters=o.parameters||{};o.parameters.transitionMessagesOnly=r.getNoStateMessagesForTables();var l=function(e,t,r){if(n&&n[e]){var i=true;var o=function(){var r=arguments[0];if(!(r instanceof a)){throw new m(P,"Please provide a valid ControllerExtension in order to execute extension "+e)}if(!i){throw new m(P,"Extension "+e+" must be executed synchronously")}var n=Array.prototype.slice.call(arguments,1);t.apply(null,n)};n[e](o,r);i=false}};var c=function(a){if(!s||e.byId(s)===t.getSource()){o.filters.push(a)}};if(n.addTemplateSpecificFilters){n.addTemplateSpecificFilters(o.filters)}l("addExtensionFilters",c,s);var g=t.getSource();if(e.getMetadata().getName()!=="sap.suite.ui.generic.template.ObjectPage.view.Details"){ie(g,n.resolveParamaterizedEntitySet,i,n.setBindingPath)}var u=g.getEntitySet();var f=o.parameters.select&&o.parameters.select.split(",")||[];var p=o.parameters.expand&&o.parameters.expand.split(",")||[];var v=function(a,r){if(a&&(!r||e.byId(r)===t.getSource())){var n=a.split(",");n.forEach(function(e){if(e&&f.indexOf(e)===-1){f.push(e)}})}};if(n.isMandatoryFiltersRequired){ne(u,v)}l("ensureExtensionFields",v,s);(n.addNecessaryFields||Function.prototype)(f,v,u);oe(u,f,p);if(p.length>0){o.parameters.expand=p.join(",")}if(f.length>0){o.parameters.select=f.join(",")}}function le(e,t,a){if(!e){return B("DRAFT_OBJECT")}else if(t){return B(a?"LOCKED_OBJECT":"UNSAVED_CHANGES")}else{return""}}function ce(){return new Promise(function(e){var t;x("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var e=Array.prototype.slice.call(arguments,1);var t=arguments[0];if(!t){return""}if(e.length>0&&(e[0]===null||e[0]===undefined||e[0]==="")){if(e.length>3&&(e[3]===null||e[3]===undefined||e[3]==="")){return e.length>2&&(e[1]===null||e[1]===undefined||e[1]==="")?"":e[2]}else{return B(t,e[3])}}else{return B(t,e[0])}},closeDraftAdminPopover:function(){t.close()},formatDraftLockText:le},"admin").then(function(a){t=a;e(t)})})}function ge(e,a,r,n){return t.oDataLossHandler.performIfNoDataLoss(e,a,n,true,true)}function ue(e,a,n,i){n=n||"LeavePage";if(r.isDraftEnabled()){return t.oPageLeaveHandler.performAfterDiscardOrKeepDraft(e,a,n,i,false)}else{return t.oDataLossHandler.performIfNoDataLoss(e,a,n,i,false)}}function fe(e,a){a=d({busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},a);var n,i;var o=new Promise(function(e,t){n=e;i=t});var s=a.busy.set?function(){t.oApplication.getBusyHelper().setBusy(o,false,{actionLabel:a.sActionLabel});return e()}:e;var l=a.mConsiderObjectsAsDeleted?function(e){t.oApplication.prepareDeletion(a.mConsiderObjectsAsDeleted);return s()}:s;var c=function(){var e;if(r.isDraftEnabled()){e=l()}else{e=a.dataloss.popup?ue(l,i,null,a.dataloss.navigation?"LeavePage":"Proceed",true):l()}if(e instanceof Promise){e.then(n,i)}else{n(e)}};t.oApplication.performAfterSideEffectExecution(c,a.busy.check&&i);return o}function pe(e){var t=e.getId()+"-variant";var a=sap.ui.getCore().byId(t);var r=a.getDefaultVariantKey();return r===a.STANDARDVARIANTKEY?"":r}function ve(e){var t=e.getId()+"-variant";var a=sap.ui.getCore().byId(t);var r=a.getDefaultVariantKey();return r===a.STANDARDVARIANTKEY?"":r}function de(t){var a;var n=r.getTemplatePrivateModel();var i=e.getOwnerComponent();var o,s,l,g,u,f=[],p=[],d,m,y,b,h,C,P;var S,D;o=i.getAppComponent();s=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");l=n.getProperty("/generic/supportedIntents/");if(c.isSmartChart(t)){a=t.getToolbar()}else if(c.isSmartTable(t)){a=t.getCustomToolbar()}g=a.getContent();u=g.length;for(d=0;d<u;d++){m=N(g[d]);if(m.hasOwnProperty("SemanticObject")&&m.hasOwnProperty("Action")){y=m.SemanticObject;b=m.Action;h={semanticObject:y,action:b,ui5Component:o};f.push([h]);C=v({},h);C.bLinkIsSupported=false;p.push(C)}}if(f.length>0&&s){P=s.getLinks(f);P.done(function(e){l=n.getProperty("/generic/supportedIntents/");S=e.length;for(d=0;d<S;d++){if(e[d][0].length>0){p[d].bLinkIsSupported=true}y=p[d].semanticObject;b=p[d].action;D=n.getProperty("/generic/supportedIntents/"+y);if(!D){l[y]={};l[y][b]={visible:p[d].bLinkIsSupported}}else if(!D[b]){D[b]={visible:p[d].bLinkIsSupported}}else{D[b]["visible"]=p[d].bLinkIsSupported}}n.updateBindings()})}}function me(a,r){var n=r&&e.byId(r);var i=r&&!n?Promise.reject():new Promise(function(e,r){t.oApplication.performAfterSideEffectExecution(function(){var i=t.oApplication.getBusyHelper();if(i.isBusy()){r();return}if(n&&(!n.getVisible()||n.getEnabled&&!n.getEnabled())){r();return}var o=n?a(n):a();if(o instanceof Promise){o.then(e,r);i.setBusy(o)}else{e(o)}})});i.catch(Function.prototype);return i}function ye(e,a,n,i,o){var s,l={};if(!a){s=[]}else if(Array.isArray(a)){s=a}else{s=[a]}if(n){l.urlParameters=n}if(i&&i.bInvocationGroupingChangeSet){l.operationGrouping="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"}l.triggerChanges=r.isDraftEnabled();r.executeBeforeInvokeActionFromExtensionAPI(o);var c=t.oApplicationController.invokeActions(e,s,l);if(i&&i.bSetBusy){r.getBusyHelper().setBusy(c)}c.then(r.executeAfterInvokeActionFromExtensionAPI.bind(null,o));return c}function be(e){var a=t.oApplication.getChevronNavigationRefreshBehaviour(e);if(a!==Object.create(null)){t.oViewDependencyHelper.setRefreshBehaviour(a)}}function he(e){var a=t.oApplication.getComponentRefreshBehaviour(e);t.oViewDependencyHelper.setRefreshBehaviour(a)}function Ce(e,t){var a=t.getModel();var r=t.getPath().split("/")[1];var n=a.oData[r];if(e){var i=n&&n[e]&&n[e].__ref;var o=a.oData[i];return o}else{return n}}function Pe(t,a){if(t&&t.__metadata){var n=t.__metadata.edit_media;var i=t.__metadata.content_type;var o=n&&new URL(n);var s=o&&o.pathname;var l=C.getIconForMimeType(i);var c={url:s,fileType:i,icon:l};var g=r.getTemplatePrivateModel();var u=e.getOwnerComponent().getEntitySet();if(!g.getProperty("/generic/controlProperties/fileUploader")){g.setProperty("/generic/controlProperties/"+"fileUploader",{})}if(a){g.setProperty("/generic/controlProperties/"+"fileUploader/"+a,c)}else{g.setProperty("/generic/controlProperties/"+"fileUploader/"+u,c)}}}function Se(e){return e.filter(function(e){return!e||!e.isTransient()})}function De(t,a,r,n){var i=e.getOwnerComponent().getModel().getMetaModel();var o=g.getNavigationPropertyRelationship(i,t,a);var s=g.getNavigationPropertyRelationship(i,r,n);return o.relationship===s.relationship&&o.fromRole===s.toRole&&o.toRole===s.fromRole}function Ae(t){var a=t.getSource();return c.isButton(a)?a.data():sap.ui.getCore().byId(e.createId(N(a)["ActionId"])).data()}var G=u.testable(G,"fillEnabledMapForBreakoutActions");var z=u.testable(z,"getOwnerControl");var A=u.testable(A,"fnGetToolbarCustomData");var re=u.testable(re,"removePropertiesFromNavigationContext");return{getPositionableControlId:I,getMetaModelEntityType:E,getText:B,getSpecializedText:w,getContextText:R,getNavigationKeyProperties:ee,mergeNavigationKeyPropertiesWithValues:te,executeGlobalSideEffect:function(){if(r.isDraftEnabled()){var a=e.getView();var n=e.getOwnerComponent();var i=n.getAppComponent();var o=i.getForceGlobalRefresh();var s=n.getModel("ui");a.attachBrowserEvent("keydown",function(e){var n=e.target.type==="search";var i=e.target.type==="textarea";var l=e.target.id.indexOf("rowAction")>-1;var g=e.target.id.indexOf("ColumnListItem")>-1;if(e.keyCode===13&&e.ctrlKey!==true&&s.getProperty("/editable")&&!n&&!i&&!l&&!g){t.oApplication.addSideEffectPromise(new Promise(function(n,i){var s,l,g,u=false,f={draftRootContext:r.getMainComponentDetails().bindingContext,callPreparationOnDraftRoot:true};l=c.getControlWithFocus();while(l){if(c.isSmartField(l)){g=l.getBindingContext&&l.getBindingContext();if(g.isTransient&&g.isTransient()){return n()}}else if(c.isOverflowToolbar(l)||c.isButton(l)||c.isLink(l)||c.isMultiInputField(l)&&(l._sTypedInValue&&l._sTypedInValue.length>0)){u=true}else if(c.isSmartForm(l)){s=l;break}else if(c.isSmartTable(l)){break}l=l.getParent()}if(u){f={}}g=g||l&&l.getBindingContext&&l.getBindingContext()||a.getBindingContext();var p=s?s.check():Promise.resolve();p.then(function(){setTimeout(function(){var a=t.oApplicationController.executeSideEffects(g,null,null,o,f);a.then(function(){n();setTimeout(function(){var t=document.getElementById(e.target.id);if(t){t.focus()}})},i)})})}))}})}},setEnabledToolbarButtons:k,setEnabledFooterButtons:L,fillEnabledMapForBreakoutActions:G,getBreakoutActions:J,getSelectionPoints:F,getDeleteRestrictions:K,getSmartTableDefaultVariant:pe,getSmartChartDefaultVariant:ve,setPrivateModelControlProperty:j,removePropertiesFromNavigationContext:re,navigateFromListItem:Z,navigateExternal:$,semanticObjectLinkNavigation:ae,getCustomData:function(e){var t=e.getSource().getCustomData();var a={};for(var r=0;r<t.length;r++){a[t[r].getKey()]=t[r].getValue()}return a},getCustomDataText:function(e){return new Promise(function(t,a){e.getCustomData().forEach(function(e){var a=e.getKey();if(a==="text"){var r=e.getBinding("value");var n=!r&&e.getBindingInfo("value");if(!r&&!n){t(e.getValue());return}var i=function(e){var a=e.getSource();a.detachChange(i);t(a.getExternalValue());return};if(r){if(!r.isInitial()){t(r.getExternalValue());return}r.attachChange(i)}else{n.events={change:i};for(var o=0;o<n.parts.length;o++){n.parts[o].targetType="string"}}}})})},onBeforeRebindTableOrChart:se,formatDraftLockText:le,showDraftPopover:function(e,t){ce().then(function(a){var r=a.getModel("admin");r.setProperty("/IsActiveEntity",e.getProperty("IsActiveEntity"));r.setProperty("/HasDraftEntity",e.getProperty("HasDraftEntity"));a.bindElement({path:e.getPath()+"/DraftAdministrativeData"});if(a.getBindingContext()){a.openBy(t)}else{a.getObjectBinding().attachDataReceived(function(){a.openBy(t)})}})},getContentDensityClass:function(){return t.oApplication.getContentDensityClass()},attachControlToView:O,getDialogFragment:T,getDialogFragmentAsync:x,fnProcessDataLossOrDraftDiscardConfirmation:ue,processDataLossTechnicalErrorConfirmation:ge,securedExecution:fe,getOwnerControl:z,getOwnerPresentationControl:Y,refreshModel:q,getElementCustomData:N,triggerAction:function(a,r,n,i){t.oDataLossHandler.performIfNoDataLoss(function(){t.oCRUDManager.callAction({functionImportPath:n.Action,contexts:a,sourceControlHandler:i,label:n.Label,operationGrouping:""}).then(function(a){if(a&&a.length>0){var n=a[0];if(n.response&&n.response.context&&(!n.actionContext||n.actionContext&&n.response.context.getPath()!==n.actionContext.getPath())){t.oApplication.getBusyHelper().getUnbusy().then(t.oViewDependencyHelper.setMeToDirty.bind(null,e.getOwnerComponent(),r))}else if(n.context&&(!n.actionContext||n.actionContext&&n.context.getPath()!==n.actionContext.getPath())){t.oApplication.getBusyHelper().getUnbusy().then(t.oViewDependencyHelper.setMeToDirty.bind(null,e.getOwnerComponent(),r))}}})},Function.prototype,"Proceed",undefined,false)},checkToolbarIntentsSupported:de,executeIfControlReady:me,invokeActionsForExtensionAPI:ye,isContextEditable:_,setExternalChevronRefreshBehaviour:be,setComponentRefreshBehaviour:he,getStreamData:Ce,setStreamData:Pe,getControlStateWrapper:s.getControlStateWrapper,filterActiveContexts:Se,checkInverseNavigation:De,getCustomDataFromEvent:Ae,getControlStateWrapperById:s.getControlStateWrapperById}}return e.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(e,t,a){v(this,A(e,t,a))}})});
//# sourceMappingURL=CommonUtils.js.map