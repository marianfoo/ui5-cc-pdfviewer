sap.ui.define(["sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library","sap/base/util/extend","sap/suite/ui/generic/template/genericUtilities/controlHelper"],function(e,t,n,r,a){"use strict";var o=n.LayoutType;var i=2;var l=["begin","mid","end"];var u=["fullScreen","exitFullScreen","closeColumn"];var s=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function f(e){return l[e]?e:i}function v(e){return l[f(e)]+"ColumnPages"}function c(e){for(var t=0;t<l.length;t++){e(s[t],v(t))}}function d(e){return s[f(e)]}function L(e){return l[f(e)]}function m(e){var t;if(e instanceof sap.ui.table.Table){t=e.getRows()}else if(e instanceof sap.m.Table||e instanceof sap.m.List){t=e.getItems()}return t}function C(e){var t=m(e);var n=t?t[0]:false;return n}function p(e){return e&&(Array.isArray(e.FCLLayout)?e.FCLLayout.sort()[0]:e.FCLLayout)||""}function y(e,n){var r=n.oTemplateContract;var i=r.oAppComponent.getFlexibleColumnLayout();var s=t.getInstanceFor(e,i);var m;var y;var g;var N=Object.create(null);var b=sap.ui.Device.system.phone?1:i.maxColumnsCount||3;var F=b>1&&i.initialColumnsCount===2;var T;var P=function(){var e=s.getDefaultLayouts();return[F?e.defaultTwoColumnLayoutType:e.defaultLayoutType,e.defaultTwoColumnLayoutType,e.defaultThreeColumnLayoutType]}();var h=i.displayNextObjectAfterDelete===true;function S(e){return e.fCLLevel===1||e.fCLLevel===2||e.level===0&&F}function R(e){if(e.fCLLevel===3||b===1||e.fCLLevel===0&&e.level>0){return 1}var t=i.initialColumnsCount||1;var n=Math.max(e.fCLLevel+1,t);return sap.ui.Device.system.tablet&&n>2?2:n}function x(e,t,n,r){var a=R(r);e.showBeginColumn=r.fCLLevel===0||a>1;e.showMidColumn=r.fCLLevel===1||a>1;e.showEndColumn=r.fCLLevel>1;if(a===1){e.target=t}else if(r.level===0){T=r.page.pages[0].entitySet;e.target=[t,T]}else{e.target=n.concat([t])}return v(r.fCLLevel)}function I(e,t){if(e===o.OneColumn&&F){return false}var n=t&&r.mRoutingTree[t];var a=n&&n.defaultLayoutType;if(a){return e===a}return e===P[0]||e===P[1]||e===P[2]}function E(e,t,a){var o=r.mRoutingTree[a];return o.componentCreated.then(function(r){return n.activateOneComponent(t,e,r)})}function A(e){var t=n.getCurrentIdentity();if(!t){return null}var a={};var o=true;for(var i=t.treeNode;o;i=r.mRoutingTree[i.parentRoute]){var l=i.fCLLevel;var u=L(l);a[u]={route:i.sRouteName,path:e?"-":i.getPath(2,t.keys),isVisible:l>2||m.columnsVisibility[u+"Column"]};o=l===1||l===2;e=false}return a}function V(e,t){var a=A(e.isNonDraftCreate);if(!a){return Promise.resolve()}var o=[];var i=t||a;for(var l in i){if(i[l]){var u=a[l];if(u.isVisible){o.push(E(e,u.path,u.route))}else{var s=r.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");var f=r.mRoutingTree[u.route];var v=s===f.level?2:3+U(y);n.setVisibilityOfRoute(u.route,v)}}}return Promise.all(o).then(n.afterActivation)}function M(){return!(m.columnsVisibility.beginColumn?m.columnsVisibility.midColumn:m.columnsVisibility.midColumn&&m.columnsVisibility.endColumn)}function w(e){if(!m&&!e){return}var t=s.getCurrentUIState();var a=n.getCurrentIdentity();var i=a&&a.treeNode;if(a&&y!==t.layout){var f=I(t.layout,i.sRouteName)?null:t.layout;n.navigateByExchangingQueryParam("FCLLayout",f);return}var v=!e&&{};var c=false;l.forEach(function(e){var n=e+"Column";if(v){var a=m&&m.columnsVisibility[n]!==t.columnsVisibility[n];v[e]=a;c=c||a}if(e!=="begin"){var o={};u.forEach(function(e){o[e]=t.actionButtonsInfo[n][e]!==null});r.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/"+e+"ActionButtons",o)}});m=t;if(a){var d=M();var L=i.level-(i.fCLLevel===2&&!m.columnsVisibility.endColumn);var C=L-(L>1&&!d)-(m.columnsVisibility.endColumn&&m.columnsVisibility.beginColumn&&L>2);r.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",d);r.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",L);r.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",C)}var p=n.getActiveComponents();p.forEach(function(e){var t=N[e];var n=y;var a=r.componentRegistry[e];if(n===o.ThreeColumnsMidExpanded){var i=r.mRoutingTree[a.route];if(i.fCLLevel===0){n=o.ThreeColumnsEndExpanded}}if(t!==n){N[e]=n;if(t){a.utils.layoutChanged()}}});if(c||e){return V(e||n.getActivationInfo(),v)}}var B=false;function D(t){for(var a=t.treeNode;a.fCLLevel===1||a.fCLLevel===2;){a=r.mRoutingTree[a.parentRoute];n.prepareHostView(a)}if(F&&t.treeNode.level===0){var i=r.mRoutingTree[T];n.prepareHostView(i)}var l=function(){if(S(t.treeNode)){y=k(t);if(!y){switch(t.treeNode.fCLLevel){case 0:var a=s.getNextUIState(0).columnsVisibility;if(a.midColumn){y=P[1]}else{y=P[0];n.navigateByExchangingQueryParam("FCLLayout",y)}break;case 1:y=P[1];break;case 2:y=P[2];break;default:}}}else{y=t.treeNode.fCLLevel===0?P[0]:o.EndColumnFullScreen}e.setLayout(y);e.setAutoFocus(false);if(t.treeNode.fCLLevel===1||t.treeNode.fCLLevel===2){var i=s.getCurrentUIState();if(i.columnsVisibility.midColumn){var l=1-i.columnsVisibility.beginColumn;for(var u=t.treeNode;u.fCLLevel>l;){u=r.mRoutingTree[u.parentRoute];t.componentsDisplayed[u.sRouteName]=1;u.display()}}}};if(B){l();return Promise.resolve()}return s.whenReady().then(function(){B=true;l()})}function O(e){return w(e)}function k(e){return p(e.appStates)||e.treeNode.defaultLayoutType||P[f(e.treeNode.fCLLevel)]}function H(e,t,n){if(!I(t,n)){e.FCLLayout=t}}function U(e){return e===o.EndColumnFullScreen||e===o.MidColumnFullScreen}function j(e){return e===o.ThreeColumnsBeginExpandedEndHidden||e===o.ThreeColumnsMidExpandedEndHidden}function G(e,t,r,a){var o={treeNode:e,keys:t,appStates:a};var i=n.getApplicableStateForIdentityAddedPromise(o);r.push(i)}function Q(e,t,n,a){H(e,n,t.sRouteName);var o=[];if(!j(n)){G(t,a,o,e)}if(!U(n)){for(var i=t;i.fCLLevel>0;){i=r.mRoutingTree[i.parentRoute];G(i,a,o,e)}}return Promise.all(o)}function q(e){return U(y)?J(e.fCLLevel):e.defaultLayoutType||s.getNextUIState(e.fCLLevel).layout}function K(e,t){var n=t.treeNode.fCLLevel===1&&e&&e.treeNode.parentRoute===t.treeNode.sRouteName&&e.treeNode.fCLLevel===2?m.actionButtonsInfo.endColumn.closeColumn:q(t.treeNode);return Q(t.appStates,t.treeNode,n,t.keys)}function z(e,t,n){var r;if(e.treeNode.fCLLevel===t.treeNode.fCLLevel){r=y}else if(e.treeNode.fCLLevel===2){r=m.actionButtonsInfo.endColumn.closeColumn}else{r=q(t.treeNode)}return Q(n,t.treeNode,r,t.keys)}function J(e){if(e===0){return o.OneColumn}else if(e===1){return o.MidColumnFullScreen}else if(e===2){return o.EndColumnFullScreen}else{return""}}function W(e,t){var a=r.mRoutingTree[e];if(!S(a)){return null}var o=g||a.defaultLayoutType||s.getNextUIState(a.fCLLevel).layout;H(t,o,e);g=null;if(U(o)){return null}var i=[];for(var l=a.fCLLevel;l>0;l--){var u=a.parentRoute;i.push(n.addUrlParameterInfoForRoute(u,t));a=r.mRoutingTree[u]}return Promise.all(i)}function X(e,t){if(e.treeNode.fCLLevel===0||e.treeNode.fCLLevel===3){return true}var n=k(e);var r=k(t);return U(n)===U(r)}function Y(e,t,o){var i=function(){r.oApplicationProxy.performAfterSideEffectExecution(function(){var i=L(e.fCLLevel);var l=m.actionButtonsInfo[i+"Column"][t];var u=o?r.mRoutingTree[e.parentRoute]:e;var s=n.getCurrentIdentity();var f=Object.create(null);if(t==="fullScreen"||t==="exitFullScreen"){r.oApplicationProxy.setNextFocus(function(){var e=t==="fullScreen"?"exitFullScreen":"fullScreen";var n=r.componentRegistry[s.treeNode.componentId];setTimeout(function(){a.focusControl(n.oController.createId(e))})})}var v=Q(f,u,l,s.keys);var c=v.then(function(){n.navigateToIdentity({treeNode:u,keys:u===s.treeNode?s.keys:s.keys.slice(0,u.level+1),appStates:f})});r.oBusyHelper.setBusy(c)},true)};if(o){var l=r.oNavigationControllerProxy.getCurrentIdentity();if(l.treeNode.isDraft&&l.treeNode.level===1){r.oPageLeaveHandler.performAfterDiscardOrKeepDraft(i,Function.prototype,"LeavePage")}else{r.oDataLossHandler.performIfNoDataLoss(i,Function.prototype,"LeavePage")}}else{i()}}function Z(e){return{onCloseColumnPressed:Y.bind(null,e,"closeColumn",true),onFullscreenColumnPressed:Y.bind(null,e,"fullScreen",false),onExitFullscreenColumnPressed:Y.bind(null,e,"exitFullScreen",false)}}r.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function $(t){y=s.getNextUIState(t).layout;e.setLayout(y)}function _(){return!M()}function ee(e,t){var a=0;for(var o in t){var i=r.mRoutingTree[o];if(i.level>=e.viewLevel&&t[o]===1){if(i.level===e.viewLevel){a=i.fCLLevel}t[o]=5+(i.level>e.viewLevel)}}$(a);var l=n.oRouter.getTargets();var u=d(a);l.display(u)}function te(e,t){if(!S(t)){return}var n=J(t.fCLLevel);if(I(n,t.sRouteName)){return}e.FCLLayout=n}function ne(e,t,n){if(n&&n.appStates&&n.appStates.FCLLayout){e.FCLLayout=n.appStates.FCLLayout}else{delete e.FCLLayout}}function re(e,t){if(e.page.defaultLayoutTypeIfExternalNavigation&&!I(e.page.defaultLayoutTypeIfExternalNavigation,e.sRouteName)){t.FCLLayout=e.page.defaultLayoutTypeIfExternalNavigation}else{delete t.FCLLayout}}function ae(e){return e.treeNode.fCLLevel==0||e.treeNode.fCLLevel==3||U(k(e))}function oe(e){return!ae(e)}function ie(){return b}function le(e,t){if(!F){return}var r=false;var a=s.getNextUIState(0).columnsVisibility;if(a.midColumn){var i=n.getCurrentIdentity();var l=i&&i.treeNode;r=l&&l.level===0&&p(i.appStates)!==o.OneColumn}if(r){if(e){t(e)}else{n.navigateByExchangingQueryParam("FCLLayout",o.OneColumn)}}}function ue(){return h}function se(){return F}function fe(e,t){if(a.isSmartTable(e)){e=e.getTable()}else if(a.isSmartList(e)){e=e.getList()}var n=C(e);le(n,t)}function ve(e){if(e>2){g=""}else{g=J(e)}}function ce(e){var t={};if(e.fCLLevel===1||e.fCLLevel===2){t.oActionButtonHandlers=Z(e)}if(e.level===0){t.handleDataReceived=se&&se()?fe:Function.prototype;t.isListAndFirstEntryLoadedOnStartup=se}t.isNextObjectLoadedAfterDelete=ue;return t}function de(e){var t=e||U(y);for(var a=e||n.getCurrentIdentity().treeNode;a;a=!t&&a.fCLLevel&&r.mRoutingTree[a.parentRoute]){var o={aggregation:v(a.fCLLevel)};r.oNavigationHost.hidePlaceholder(o)}}e.attachStateChange(w.bind(null,false));return{hidePlaceholder:de,adaptRoutingInfo:x,createMessagePageTargets:c,displayMessagePage:ee,handleBeforeRouteMatched:D,handleRouteMatched:O,areIdentitiesLayoutEquivalent:X,getAppStatesPromiseForNavigation:K,getSpecialDraftCancelPromise:z,getFCLAppStatesPromise:W,adaptBreadCrumbUrlParameters:te,adaptPreferredLayout:ne,isAppTitlePrefered:_,hasIdentityFullscreenLayout:ae,hasNavigationMenuSelfLink:oe,getMaxColumnCountInFCL:ie,isNextObjectLoadedAfterDelete:ue,getFclProxy:ce,isListAndFirstEntryLoadedOnStartup:se,setStoredTargetLayoutToFullscreen:ve,adaptAppStatesForExternalNavigation:re}}return e.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(e,t){r(this,y(e,t))}})});
//# sourceMappingURL=FlexibleColumnLayoutHandler.js.map