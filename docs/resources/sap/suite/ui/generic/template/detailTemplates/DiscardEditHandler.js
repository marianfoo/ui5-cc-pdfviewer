sap.ui.define(["sap/ui/base/Object","sap/base/util/extend"],function(e,t){"use strict";function n(e,t,n,i){var o=t.oComponentUtils.isDraftEnabled();var r=t.oComponentUtils.getCRUDActionHandler();var a=t.oServices.oApplication.getBusyHelper();var c=e.getView();var s=c.getModel("ui");var l=t.oComponentUtils.getTemplatePrivateModel();var u=l.setProperty.bind(l,"/objectPage/cancelEnabled");var f;var p;var v=false;var g=false;var d;var m;if(o&&t.oComponentUtils.getViewLevel()!==1){m=Function.prototype}function C(){m();d=null;m=null}function y(){g=false;if(v){f.close()}else{C()}}function P(e,n){if(!p){p=t.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.DiscardEditPopover",{onDiscardConfirm:function(){if(!v||g){return}d();u(true)},beforeClose:function(){v=false;if(!g){C()}},afterClose:function(){u(true)}},"discard",function(e,t){t.setProperty("/placement",sap.m.PlacementType.Top)})}p.then(function(t){v=true;f=t;var i=f.getModel("discard");i.setProperty("/isCreate",n);u(false);f.openBy(e)})}function h(){if(o){var n=c.getBindingContext();return t.oServices.oApplication.getNavigateAfterDraftCancelPromise(n).then(function(n){return function(){t.oServices.oViewDependencyHelper.setRootPageToDirty();t.oServices.oViewDependencyHelper.unbindChildren(e.getOwnerComponent());t.oServices.oApplication.invalidatePaginatorInfo();n()}})}return Promise.resolve(function(){if(s.getProperty("/createMode")){var n=e.getOwnerComponent().getModel("_templPrivGlobal");var i=n.getProperty("/generic/FCL");return i&&i.highestViewLevel===1?t.oServices.oNavigationController.navigateToRoot():t.oServices.oNavigationController.navigateBack()}})}function D(){return new Promise(function(e){if(o){var n=c.getBindingContext();var i=n.getPath();r.hasValidationMessageOnDetailsViews().then(function(n){var o=t.oServices.oApplication.getIsDraftModified(i)||n;e(o)})}else{e(t.oComponentUtils.isComponentDirty())}})}function A(){if(o){var e=c.getBindingContext();var t=e.getObject();var n=t.hasOwnProperty("HasActiveEntity")&&!e.getProperty("IsActiveEntity")&&!e.getProperty("HasActiveEntity");return n}return s.getProperty("/createMode")}function b(e,n){if(m){return Promise.reject()}if(!(t.oComponentUtils.isComponentActive()&&s.getProperty("/editable"))){return Promise.reject()}var i=new Promise(function(i,r){m=r;var s=h();var l=function(){if(e&&a.isBusy()){C();return}var r=function(){g=true;var e=s.then(function(e){var r=function(){m=i;e();y();if(n){t.oServices.oApplication.setNextFocus(n)}};var a;if(o){a=t.oServices.oCRUDManager.discardDraft(c.getBindingContext()).then(r);a.catch(y)}else{r()}t.oComponentUtils.cancelEdit(a);return a});a.setBusy(e)};D().then(function(t){if(e&&t){d=r;P(e,A())}else{r()}})};t.oServices.oApplication.performAfterSideEffectExecution(l)});i.catch(Function.prototype);return i}return{discardEdit:b}}return e.extend("sap.suite.ui.generic.template.detailTemplates.DiscardEditHandler",{constructor:function(e,i,o,r){t(this,n(e,i,o,r))}})});
//# sourceMappingURL=DiscardEditHandler.js.map