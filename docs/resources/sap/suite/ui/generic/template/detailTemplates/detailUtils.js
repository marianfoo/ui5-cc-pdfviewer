sap.ui.define(["sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/core/UIComponent","sap/ui/core/routing/HashChanger","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/extensionAPI/NavigationController","sap/suite/ui/generic/template/lib/MessageButtonHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/detailTemplates/DiscardEditHandler","sap/suite/ui/generic/template/detailTemplates/PaginatorButtonsHelper","sap/suite/ui/generic/template/ObjectPage/extensionAPI/DraftTransactionController","sap/suite/ui/generic/template/ObjectPage/extensionAPI/NonDraftTransactionController","sap/m/DraftIndicator"],function(e,t,n,a,o,r,i,s,l,u,c,p,g){"use strict";var d=new e("detailTemplates.detailUtils").getLogger();var v=sap.m.DraftIndicatorState;var f=new a({path:"persistent",operator:o.EQ,value1:false});function m(e,t,n){function a(){var e=t.getTemplatePrivateModel();e.setProperty("/objectPage",{displayMode:0,headerInfo:{objectTitle:"",objectSubtitle:""},cancelEnabled:true})}function o(a,o){if(!t.isDraftEnabled()){var r=e.getModel("ui");var i=t.getTemplatePrivateModel();var s=r.getProperty("/createMode");i.setProperty("/objectPage/displayMode",s?4:1)}(n.onComponentActivate||Function.prototype)(a,o)}function r(t){var a=e.getModel("_templPrivGlobal");a.setProperty("/generic/draftIndicatorState",v.Clear);(n.applyHeaderContextToSmartTablesDynamicColumnHide||Function.prototype)(t)}function i(){n.navigateUp()}function s(e){return n.getMessageFilters(e)}function l(e){return n.getScrollFunction&&n.getScrollFunction(e)}function u(){return{callAlways:true}}return{init:a,onActivate:o,getTitle:t.getTitle,updateBindingContext:r,navigateUp:i,getMessageFilters:s,getScrollFunction:l,getStatePreserverSettings:u}}function C(e,a,o){var v;var m;function C(){var e=t.getRouterFor(o);return e?e.getHashChanger():n.getInstance()}function b(e){var t=!a.oComponentUtils.isDraftEnabled();if(t||!e){var n=o.getView().getModel("ui");n.setProperty("/editable",e)}}function h(){a.oServices.oApplication.onBackButtonPressed()}function B(){var t=a.oServices.oApplication.getLinksToUpperLayers();var n=a.oComponentUtils.getViewLevel();var o;if(a.oComponentUtils.isDraftEnabled()){var r=a.oComponentUtils.getTemplatePrivateModel();o=r.getProperty("/objectPage/displayMode")}else{o=1}e.navigateUp=t[n-1].navigate.bind(null,o,false);var i=e.aBreadCrumbs;var s=i?i.length:0;for(var l=0;l<s;l++){var u=i[l];var c=t[l+1];c.adaptBreadCrumbLink(u);var p={id:u.getId(),navigate:c.navigate.bind(null,o,true)};a.oInfoObjectHandler.initializeLinkInfoObject(p)}}function P(e){var t=e.getBindingContext();var n=C().getHash();return a.oServices.oApplicationController.propertyChanged(n,t)}function y(){e.navigateUp()}function H(e){var t=a.oServices.oApplication.getBusyHelper();var n=o.getView().getModel("ui");var r=P(e).then(function(e){y()},function(){t.getUnbusy().then(function(e){a.oCommonUtils.processDataLossTechnicalErrorConfirmation(function(){y();n.setProperty("/enabled",true)},Function.prototype,v.state)})});t.setBusy(r)}function U(e){var t=e.getSource();var n=a.oComponentUtils.getCRUDActionHandler();n.handleCRUDScenario(2,H.bind(null,t))}var S;function M(t,n){S=S||new u(o,a,e,v.state);return S.discardEdit(t,n)}function F(){var e=a.oServices.oApplication.getBusyHelper();if(e.isBusy()){return}v.state.messageButtonHelper.toggleMessagePopover()}function T(e){return v.state.messageButtonHelper&&v.state.messageButtonHelper.getMessageFilters(e)}function I(){var e;return function(){e=e||new i(a,o,v.state);return e}}function w(){var e;return function(){if(!e){var t=a.oComponentUtils.isDraftEnabled()?p:g;e=new t(a,o,v.state)}return e}}function A(e){m.handleShowNextObject(e)}function j(){m.switchToNextObject()}function x(e){m.handleShowPrevObject(e)}var C=l.testable(C,"getHashChangerInstance");var B=l.testable(B,"adaptLinksToUpperLevels");v={onInit:function(t,n){if(!t||t.footerBar){var i=a.oComponentUtils.isODataBased();v.state.messageButtonHelper=new s(a,n||{controller:o},i);if(!a.oComponentUtils.isDraftEnabled()){var l=o.getOwnerComponent().getModel("ui");var u=l.bindProperty("/editable");var p=sap.ui.getCore().getMessageManager();var g=p.getMessageModel();u.attachChange(function(){if(!u.getValue()){var e=v.state.messageButtonHelper.getContextFilter(false);var t=g.bindList("/",null,null,[e,f]);var n=t.getContexts();var a=n.map(function(e){return e.getObject()});p.removeMessages(a)}})}a.oServices.oTemplateCapabilities.oMessageButtonHelper=v.state.messageButtonHelper;v.state.onCancel=M}if(!t||t.paginatorButtons){m=new c(v,o,a,e)}e.getScrollFunction=function(e){var t=a.oCommonUtils.getPositionableControlId(e);return t&&r.focusControl.bind(null,t)}},handlers:{handleShowNextObject:A,handleShowPrevObject:x,onShowMessages:F,applyAndUp:U,onSave:function(){d.error("Save for this floorplan not implemented yet")},onBack:h},extensionAPI:{getNavigationControllerFunction:I,getTransactionControllerFunction:w},fclInfo:{isContainedInFCL:false},state:{},onComponentActivate:function(e,t){if(v.state.messageButtonHelper){v.state.messageButtonHelper.adaptToContext(e)}B();if(m){m.computeAndSetVisibleParamsForNavigationBtns()}},utils:{switchToNextObject:j}};e.navigateUp=y;e.setEditable=b;e.getMessageFilters=T;var D=a.oComponentUtils.getFclProxy();if(D.oActionButtonHandlers){v.handlers.fclActionButtonHandlers=D.oActionButtonHandlers;v.fclInfo.isContainedInFCL=true}return v}return{getComponentBase:m,getControllerBase:C}});
//# sourceMappingURL=detailUtils.js.map