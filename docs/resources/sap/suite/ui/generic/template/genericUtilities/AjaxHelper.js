sap.ui.define(["sap/ui/util/XMLHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeError"],function(e,t,r){"use strict";var s="genericUtilities.AjaxHelper";var a={ERROR:"error",PARSING_ERROR:"parsing error",DATA_TYPE_NOT_SUPPORTED:"data type not supported",SUCCESS:"success"};var n={};var u="GET";var o=["text","json","xml","plain"];n.ajax=function(e){if(!e||typeof e!=="object"){throw new r(s,"send a valid setting object to call ajax")}var n=(e&&e.async)===undefined?true:e.async;var o=e.type||u;var R=e.url;if(!R||typeof R!=="string"){throw new r(s,"Provide a proper url to make AJAX call")}var v=p(e.data);var x=o===u;if(v&&x){R=R+"?"+v}t.testable(c,"handelResponse");t.testable(p,"encodeData");t.testable(f,"parseJson");t.testable(l,"parseXML");var g=new XMLHttpRequest;if(n){var E=new Promise(function(t,r){g.addEventListener("load",s);g.addEventListener("error",a);g.addEventListener("abort",u);g.open(o,R,n);g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");x?g.send():g.send(v);function s(s){var a=c(s,e);if(a.success){return t(a)}return r(a)}function a(e){r(i(e))}function u(e){r(d(e))}});return E}else{var T;g.addEventListener("load",function t(r){T=c(r,e)});g.addEventListener("error",function e(t){T=i(t)});g.addEventListener("abort",function e(t){T=d(t)});g.open(o,R,n);g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");try{x?g.send():g.send(v)}catch(e){T={};T.statusCode=g.status;T.request=g;T.success=false;T.textStatus=a.ERROR;T.error=e}return T}};n.getJSON=function(e){return new Promise(function(t,r){n.ajax({url:e,async:true,dataType:"json"}).then(function(e){t(e.data)}).catch(function(e){r(e.error)})})};n.sjax=function(e){if(e.async){throw new r(s,"AjaxHelper.sjax should not be called with async flag set")}e.async=false;return this.ajax(e)};n.syncGetJSON=function(e){return n.sjax({url:e,dataType:"json"})};function c(e,t){var r=e.target.status;var s={};var n=t.dataType;var u=r>=200&&r<300||r===304;if(u){if(n){switch(n){case"json":s=f(e.target.responseText);break;case"xml":s=l(e.target.responseText);break;case"text":s.data=e.target.responseText;break;default:s.success=false;s.textStatus=a.ERROR;s.error=a.DATA_TYPE_NOT_SUPPORTED}}else{var c=e.target.getResponseHeader("content-type");if(c){var i=c.split("/")[1].split(";")[0];if(o.indexOf(i)+1){n=i;s.request=e.target;switch(n){case"json":s=f(e.target.responseText);break;case"xml":s=l(e.target.responseText);break;default:s.data=e.target.responseText;break}}else{s.success=false;s.textStatus=a.ERROR;s.error=a.DATA_TYPE_NOT_SUPPORTED}}}}else{s.success=false;s.textStatus=a.ERROR;s.error=e.target.statusText||a.ERROR}s.request=e.target;s.statusCode=e.target.status;s.success=s.success!==false;if(s.success){s.textStatus=a.SUCCESS}return s}function i(e){var t={};t.statusCode=e.target.status;t.request=e.target;t.success=false;t.textStatus=a.ERROR;t.error=e.target.statusText||a.ERROR;return t}function d(e){var t={};t.statusCode=e.target.status;t.request=e.target;t.success=false;t.textStatus="aborted";return t}function f(e){var t={};try{t.data=e===""?undefined:JSON.parse(e)}catch(e){t.success=false;t.textStatus=a.PARSING_ERROR;t.error=e}return t}function l(t){var r={};var s=e.parse(t);if(s.parseError.errorCode!==0){r.success=false;r.textStatus=a.PARSING_ERROR;r.error=s.parseError.reason;return r}r.data=s;return r}function p(e){var t;if(e){t=typeof e=="string"?e:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}return t}return n});
//# sourceMappingURL=AjaxHelper.js.map