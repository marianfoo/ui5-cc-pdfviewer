sap.ui.define(["sap/ui/base/Object","sap/ui/model/Context","sap/ui/model/odata/AnnotationHelper","sap/ui/model/json/JSONModel","sap/base/util/each"],function(e,t,a,r,n){"use strict";var i=e.extend("sap.suite.ui.generic.template.js.QuickTemplates.AnnotationHelper");i.TITLE_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.Badge/Title/Value","com.sap.vocabularies.UI.v1.HeaderInfo/Title/Value","com.sap.vocabularies.UI.v1.Identification/0/Value"];i.HEADLINE_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.Badge/HeadLine/Value","com.sap.vocabularies.Communication.v1.Contact/role","com.sap.vocabularies.UI.v1.HeaderInfo/Description/Value","com.sap.vocabularies.UI.v1.Identification/0/Value","com.sap.vocabularies.UI.v1.Identification/1/Value"];i.IMAGEURL_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.Badge/ImageUrl/Value","com.sap.vocabularies.UI.v1.HeaderInfo/ImageUrl/Value"];i.ICONURL_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.Badge/TypeImageUrl/Value"];i.TYPENAME_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.HeaderInfo/TypeName/Value","com.sap.vocabularies.Common.v1.SemanticObject/String"];i._getAnnotationItem=function(e,t,a,r){if(e&&t&&a){var n=e.getProperty(t);if(r&&n&&n[a]){var i=n[a];return i[r]}return n?n[a]:null}return undefined};i.getAnnotationItemForVocabulary=function(e,t){if(t){var a=t.split("/");return i._getAnnotationItem(e,a[0],a.length>1?a[1]:null,a.length>2?a[2]:null)}return undefined};i.getAnnotationFirstItemFromVocabularies=function(e,t,a){var r=null;if(t&&Array.isArray(t)){for(var n=0;!r&&n<t.length;++n){r=i.getAnnotationItemForVocabulary(e,t[n]);if(a&&r&&i._isEqualValues(a,r)){r=null}}}return r};i._resolveBadgeImgUrl=function(e){return i.getAnnotationFirstItemFromVocabularies(e,i.IMAGEURL_ANNO_HEURISTIC)};i._resolveBadgeIconUrl=function(e){var t=i.getAnnotationFirstItemFromVocabularies(e,i.ICONURL_ANNO_HEURISTIC);if(!t){t="sap-icon://form"}return t};i._resolveBadgeTitle=function(e){return i.getAnnotationFirstItemFromVocabularies(e,i.TITLE_ANNO_HEURISTIC)};i._resolveBadgeTypeName=function(e){return i.getAnnotationFirstItemFromVocabularies(e,i.TYPENAME_ANNO_HEURISTIC)};i._resolveBadgeHeadline=function(e,t){return i.getAnnotationFirstItemFromVocabularies(e,i.HEADLINE_ANNO_HEURISTIC,t)};i._getAnnotationObject=function(e){if(e){var t={};if(e.Label){t.Path=e.Label.Path||e.Label}else if(e.Value){t.Path=e.Value.Path||e.Value}else if(e.String){t.String=e.String}else if(e.Path){t.Path=e.Path}else{t.String=e}return t}return undefined};i._isEqualValues=function(e,t){if(e&&t){if(e.String&&t.String){return e.String===t.String}if(e.Value&&t.Value){return e.Value.Path===t.Value.Path}if(e.Label&&t.Label){return e.Label.Path===t.Label.Path}}return false};i._createBadgeContext=function(e,a,n,o,u){var l=new r;var g=new t(l,"/");var c={};var v=i._getAnnotationObject(e);var s=i._getAnnotationObject(a);if(v&&v.String&&v.String.toLowerCase().indexOf("sap-icon://")<0){c.ImageUrl=v}else{c.TypeImageUrl=s||v}c.Title=i._getAnnotationObject(n);c.TypeName=i._getAnnotationObject(o);c.SubTitle=i._getAnnotationObject(u);l.setData(c);return g};i.resolveBadgeTarget=function(e){if(e){var t=i._resolveBadgeImgUrl(e);var a=i._resolveBadgeIconUrl(e);var r=i._resolveBadgeTitle(e);var n=i._resolveBadgeTypeName(e);var o=i._resolveBadgeHeadline(e,r);return i._createBadgeContext(t,a,r,n,o)}return undefined};i.resolveFieldGroupTarget=function(e){var t=i._getFacetOfType(e,"FieldGroup");if(t){return a.resolvePath(e.getModel().createBindingContext(e.getPath()+"/"+t.index+"/Target"))}return null};i.resolveLineItemTarget=function(e){var t=i._getFacetOfType(e,"LineItem");if(t){return a.resolvePath(e.getModel().createBindingContext(e.getPath()+"/"+t.index+"/Target"))}return null};i.resolveFieldGroupFacet=function(e){var t=i._getFacetOfType(e,"FieldGroup");if(t){return e.getPath()+"/"+t.index}return undefined};i.resolveLineItemFacet=function(e){var t=i._getFacetOfType(e,"LineItem");if(t){return e.getPath()+"/"+t.index}return undefined};i.getTooltip=function(e){var t="";if(e.String){t=e.String}return t};i._getFacetOfType=function(e,t){var a=e.getObject();var r=-1;var i=null;if(Array.isArray(a)){n(a,function(e,a){if(a.Target&&a.Target.AnnotationPath&&a.Target.AnnotationPath.indexOf(t)>=0){r=e;i=a}})}if(r>=0){return{facet:i,index:r}}return undefined};i.getAllPropertyPathsFromFacet=function(e,t){var r=i.createFormatterInterface(e);var o=e.getModel().getMetaModel();var u=i.getMetaDataForContext(e);var l=i.getMetaModelContextForFacetType(r,u.entityType.namespace+"."+u.entityType.name,t);var g=a.resolvePath(l);var c=o.getProperty(g);var v=c.Data||c;var s=[];if(v&&Array.isArray(v)){n(v,function(e,t){if(t.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&t.Value&&t.Value.Path){s.push(t.Value.Path)}})}return s};i.getMetaModelContextForFacetType=function(e,a,r){var i=e.getModel()||e.getModel(0);var o=i.getODataEntityType(a);var u=["QuickCreate","QuickView"];var l="";var g=null;var c=null;for(var v=0;v<u.length;v++){l="com.sap.vocabularies.UI.v1."+u[v]+"Facets";if(o[l]){c=o[l];break}}if(c){var s=-1;if(Array.isArray(c)){n(c,function(e,t){if(t.Target&&t.Target.AnnotationPath&&t.Target.AnnotationPath.indexOf(r)>=0){s=e}})}if(s>=0){g=new t(i,o.$path+"/"+l+"/"+s+"/Target")}}return g};i.formatExpandBindingPathForHeaderObject=function(e,t){var a=i.getNavigationPathsFromFacet(e,t,"FieldGroup");return i.formatExpandPaths(a)};i.getMetaDataForContext=function(e){var t=e.getModel().getMetaModel();var a=t.getODataEntityType(e.getObject().__metadata.type);var r=null;var i=t.getProperty(t.getODataEntityContainer(true)).entitySet;n(i,function(t,a){if(a.entityType===e.getObject().__metadata.type){r=a.name}});var o=t.getODataEntitySet(r);return{entityType:a,entitySet:o}};i.getNavigationPathsUsingAnnotationHeuristics=function(e,r){var n={};var o=e.getModel().getMetaModel();if(e&&e.getObject()){n=i.getMetaDataForContext(e)}else if(r){n.entityType=o.getODataEntityType(r)}var u={};if(n&&n.entityType){var l=i.TITLE_ANNO_HEURISTIC.concat(i.HEADLINE_ANNO_HEURISTIC);var g=0;for(;g<l.length;g++){var c=new t(o,n.entityType.$path+"/"+l[g]);var v=a.getNavigationPath(c);if(v){v=v.replace(/[{}]/g,"");if(v){u[v]=""}}}}return Object.keys(u)};i.getNavigationPathsFromFacet=function(e,r,o){var u=e.getModel()||e.getModel(0);var l=i.getMetaModelContextForFacetType(e,r,o);if(!l){return[]}var g=a.resolvePath(l);var c=u.getProperty(g);var v={};var s="/";if(c.Data){s+="Data/"}var f=c.Data||c;if(f&&Array.isArray(f)){n(f,function(e,r){if(r.RecordType=="com.sap.vocabularies.UI.v1.DataField"&&r.Value&&r.Value.Path){var n=new t(u,g+s+e+"/Value");var i=a.getNavigationPath(n);i=i.replace(/[{}]/g,"");if(i){v[i]=""}}})}return Object.keys(v)};i.getLineItemsNavPropertyName=function(e,t){var r=i.getMetaModelContextForFacetType(e,t,"LineItem");if(r){var n=a.getNavigationPath(r);n=n.replace(/[{}]/g,"");return n}return undefined};i.formatBindingPathForLineItems=function(e,t,a){var r=i.getLineItemsNavPropertyName(e,t);if(arguments.length===2){a=false}if(a){var n=i.getNavigationPathsFromFacet(e,t,"LineItem");if(n&&n.length>0){return"{path: '"+r+"', parameters : {expand:'"+i.formatExpandPaths(n)+"'}}"}}return"{path: '"+r+"'}"};i.formatExpandPaths=function(e){var t="";for(var a=0;a<e.length;a++){t+=e[a];if(a<e.length-1){t+=","}}return t};i.createFormatterInterface=function(e){var t=e.getModel().getMetaModel().getMetaContext(e.getPath());var a={getModel:function(){return e.getModel().getMetaModel()},getContext:function(){return t},getPath:function(){return t.getPath()}};return a};i.formatBindingPathForLineItems.requiresIContext=true;i.getMetaModelContextForFacetType.requiresIContext=true;i.formatExpandBindingPathForHeaderObject.requiresIContext=true;i.resolveFieldGroupTarget.requiresIContext=true;i.resolveLineItemTarget.requiresIContext=true;i.resolveLineItemFacet.requiresIContext=true;i.resolveFieldGroupFacet.requiresIContext=true;i.resolveBadgeTarget.requiresIContext=true;return i},true);
//# sourceMappingURL=AnnotationHelper.js.map