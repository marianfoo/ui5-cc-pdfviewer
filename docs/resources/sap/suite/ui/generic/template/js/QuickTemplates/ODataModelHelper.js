sap.ui.define(["sap/ui/base/Object","./AnnotationHelper","sap/ui/model/odata/AnnotationHelper","sap/ui/model/Context","sap/base/util/each"],function(e,t,r,i,n){"use strict";var a=e.extend("sap.suite.ui.generic.template.js.QuickTemplates.ODataModelHelper");a.createKeyFromPath=function(e,t,r){try{var i=a.parseEntityKeysFromContextPath(e);var u=a.getKeyInfoForEntitySet(t,r);if(u.entitySet===i.entitySet&&i.keys.length===u.keys.length){if(e.startsWith("/")){return e.substring(1)}return e}var o=""+u.entitySet+"(";n(u.keys,function(e,t){if(!t.mapped){n(i.keys,function(e,r){if(r.property===t.property&&r.type===t.type){t.value=r.value;t.mapped=true;return false}return true})}if(!t.mapped){n(i.keys,function(e,r){var i=r.property.toLowerCase();var n=t.property.toLowerCase();if(n.indexOf(i)>=0&&r.type===t.type){t.value=r.value;t.mapped=true;return false}return true})}if(!t.mapped){n(i.keys,function(e,r){if(r.property===t.property){if(r.type==="Edm.String"&&t.type!=="Edm.String"){t.value=r.value.substring(1,r.value.length-1)}else if(r.type!=="Edm.String"&&t.type==="Edm.String"){t.value="'"+r.value+"'"}else{t.value=r.value}t.mapped=true;return false}return true})}if(!t.mapped){n(i.keys,function(e,r){if(r.type===t.type){t.value=r.value;t.mapped=true;return false}return true})}o+=t.property+"="+t.value;if(e<u.keys.length-1){o+=","}});o+=")";return o}catch(t){if(e&&e.startsWith("/")){return e.substring(1)}return e}};function u(e){return!isNaN(parseFloat(e))&&isFinite(e)}a.parseEntityKeysFromContextPath=function(e){var t=e;var r={entitySet:"",keys:[]};if(!t){return r}if(t.startsWith("/")){t=t.substring(1)}var i=t.split("(");if(i.length>1){r.entitySet=i[0];var a=i[1].split(")")[0];if(a){var o=a.split(",");n(o,function(e,t){if(t){var i=t.split("=");var n={};if(i.length==1){n.value=i[0];n.property=""}else if(i.length==2){n.property=i[0];n.value=i[1]}if(n.value){if(n.value.indexOf("guid")==0&&n.value.length==42){n.type="Edm.Guid"}else if(n.value.charAt(0)==="'"&&n.value.charAt(n.value.length-1)==="'"){n.type="Edm.String"}else if(n.value=="true"||n.value=="false"){n.type="Edm.Boolean"}else if(u(n.value)){n.type="Edm.Int"}else{n.type=""}r.keys.push(n)}}})}}return r};a.getKeyInfoForEntitySet=function(e,t){var r={entitySet:"",keys:[]};var i={};if(e&&t){var u=e.getODataEntitySet(t);r.entitySet=u.name;var o=e.getODataEntityType(u.entityType);n(o.key.propertyRef,function(e,t){i[t.name]="1"});n(o.property,function(e,t){if(i[t.name]){var n={property:t.name,value:a.getDefaultKeyValueForProperty(t),type:t.type.indexOf("Edm.Int")>=0?"Edm.Int":t.type};r.keys.push(n)}})}return r};a.getDefaultKeyValueForProperty=function(e){if(e.name.indexOf("IsActive")>=0&&e.type==="Edm.Boolean"){return"true"}else{switch(e.type){case"Edm.String":{return"''"}case"Edm.Guid":{return"guid'00000000-0000-0000-0000-000000000000'"}case"Edm.Boolean":{return"false"}default:{if(e.type.indexOf("Int")>=0){return"0"}return"''"}}}};a.initializeObjectProperties=function(e,r,i){var o=[];var f=e.getModel().getKey(e.getObject());var s=e.getModel().oData[f];if(s){o.push(s)}var l=e.getModel().mChangedEntities[f];if(l){o.push(l)}var p=t.getMetaDataForContext(e);var y=0;if(r&&Array.isArray(r)){n(r,function(t,r){var n=r.split("/");var o=n[0];var f=null;if(n.length>1){f=n.slice(1).join("/")}if(u(o)&&f){a.initializeObjectProperties(e,[f],i);return}y=0;var l=false;if(p.entityType.navigationProperty){for(;y<p.entityType.navigationProperty.length;y++){if(p.entityType.navigationProperty[y].name===o){l=true;break}}}if(l&&!s[o]){var v=e.getModel().createEntry(e.getPath()+"/"+o,i);s[o]={__deferred:{}};a.restoreNavigationPropertyReferences(e,o,v);if(f){a.initializeObjectProperties(v,[f],i)}}})}};a.restoreLineItemReferences=function(e,i){var n=t.createFormatterInterface(i);var u=t.getMetaModelContextForFacetType(n,e,"LineItem");if(u){var o=r.getNavigationPath(u);o=o.replace(/[{}]/g,"");a.restoreNavigationPropertyReferences(i,o)}};a.restoreNavigationPropertyReferences=function(e,t,r){if(!t){return}if(!e.getObject()){return}var i=e.getModel().getMetaModel();var a=e.getModel().getKey(e.getObject());var u=e.getModel().oData[a];var o=i.getODataEntityType(u.__metadata.type);var f=i.getODataAssociationEnd(o,t);var s=null;var l=i.getProperty(i.getODataEntityContainer(f.type)).entitySet;n(l,function(e,t){if(t.entityType===f.type){s=t.name}});if(!u[t]){u[t]={}}if(u[t].__list){u[t].__list=[]}var p=function(e){if(u[t].__deferred){delete u[t].__deferred}if(f.multiplicity==="*"){if(!u[t].__list){u[t].__list=[]}u[t].__list.push(e)}else{u[t].__ref=e}};if(!r){var y=Object.keys(e.getModel().oData);n(y,function(e,t){if(t.indexOf(s)>=0){p(t)}})}else{var v=r.getPath().substring(1);p(v)}};a.findObjects=function(){var e,t,r;if(arguments.length===3){e=arguments[0];t=arguments[1];r=arguments[2]}else if(arguments.length==2){t=arguments[0];r=arguments[1]}var i=r.key||undefined,n=r.matchCallback||undefined,u=r.noMatchCallback||undefined,o=r.maxNestedLevel||3;var f=true;if(!o){o=3}if(!a.findObjects._recursionCount){a.findObjects._recursionCount=0}a.findObjects._recursionCount++;if(a.findObjects._recursionCount>o){a.findObjects._recursionCount--;return}var s=function(e){var t=Object.prototype.toString.call(e);return t==="[object Array]"||t==="[object Object]"};var l=Object.prototype.hasOwnProperty.bind(t);if(t){for(var p in t){if(l(p)){var y=s(t[p]);if(t[p]&&y){t[p].__nestedKey=p}f=true;if(p===i&&n){f=n(e,t,t[p])}else if(u){f=u(e,t,t[p])}if(f&&y){a.findObjects(t,t[p],{key:i,matchCallback:n,noMatchCallback:u,maxNestedLevel:o})}if(t[p]&&y){delete t[p].__nestedKey}}}}a.findObjects._recursionCount--};return a},true);
//# sourceMappingURL=ODataModelHelper.js.map