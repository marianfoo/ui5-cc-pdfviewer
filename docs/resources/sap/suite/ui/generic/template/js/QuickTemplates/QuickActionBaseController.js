sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","./AnnotationHelper","sap/base/util/each"],function(e,t,r,i){"use strict";var n=e.extend("sap.suite.ui.generic.template.js.QuickTemplates.QuickActionBaseController",{onInit:function(){if(!this._bIsInitialized){this._bIsInitialized=true;this.oComponent=this.getOwnerComponent()||this.getView().getViewData().component;var e=this.getView();e.setModel(this.oComponent.getModel());this.sEntitySet=this.oComponent.getEntitySet();this.oDraftController=this.oComponent.getTransactionController().getDraftController();this.bDraftEnabled=this.oDraftController.getDraftContext().isDraftEnabled(this.sEntitySet);var t=this.getView().getModel().getMetaModel();this.oEntitySetMeta=t.getODataEntitySet(this.sEntitySet);this.oEntityTypeMeta=t.getODataEntityType(this.oEntitySetMeta.entityType);this.oSmartFieldEventDelegate={onAfterRendering:function(e){this._onSmartFieldAfterRendering(e)}.bind(this)}}},_onMetaModelLoaded:function(){},_onSmartFieldAfterRendering:function(e){},onBeforeRendering:function(){if(!this._bMetaDataInit){this._bMetaDataInit=true;this.getView().getModel().getMetaModel().loaded().then(this._onMetaModelLoaded.bind(this),this.onError.bind(this))}this.setBusy(false)},setBusy:function(e){if(this.getView().getModel("ui")){this.getView().getModel("ui").setProperty("/busy",e);this.getView().getModel("ui").updateBindings()}},bindView:function(e){var t=this._getFormatterInterface(e);var i=r.formatExpandBindingPathForHeaderObject(t,this.oEntityTypeMeta.namespace+"."+this.oEntityTypeMeta.name);this.oContext=e;this.getView().bindElement({path:e.getPath(),parameters:{expand:i}})},onError:function(e){this.setBusy(false);if(e.message){this._showErrorMessage(e)}else if(e.response){this._showErrorMessage(e.response)}else{this._showErrorMessage({message:this.formatI18NMessage("QuickAction_Generic_Error")})}},onSmartFieldsCreated:function(e){var t=e.getParameters()[0];if(t&&typeof t.addEventDelegate==="function"){t.removeEventDelegate(this.oSmartFieldEventDelegate);t.addEventDelegate(this.oSmartFieldEventDelegate)}},formatI18NMessage:function(){if(arguments&&arguments[0]){var e=arguments[0];var t=this.getView().getModel("i18n").getResourceBundle();if(arguments.length>1){var r=Array.prototype.slice.call(arguments);return t.getText(e,r.splice(1,arguments.length-1))}return t.getText(e)}return arguments},_getFormatterInterface:function(e){var t=e?e:this.getView().getBindingContext();return r.createFormatterInterface(t)},_setBindingContext:function(e){this.getView().setBindingContext(e);this.setBusy(false)},_showErrorMessage:function(e){var r=e.response||e;var i=r.message;if(r.statusText){i=r.statusText}if(r&&r.responseText){try{var n=JSON.parse(r.responseText);var o=this._getErrorDetail(n);i=o&&o.length>0?o:i}catch(e){}}t.show(i,{icon:t.Icon.ERROR,title:this.formatI18NMessage("QuickAction_Error_Popover"),actions:[t.Action.OK]})},_displaySeverity:function(e){var t;switch(e){case"error":t="Error_Severity_Error";break;case"abort":t="Error_Severity_Abort";break;case"warning":t="Error_Severity_Warning";break;case"info":t="Error_Severity_Info";break;case"termination":t="Error_Severity_Termination";break;case"success":t="Error_Severity_Success";break}return t},_getErrorDetail:function(e){var t="";if(e&&e.error&&e.error.message){if(e.error.innererror&&e.error.innererror.errordetails&&e.error.innererror.errordetails.length>0){i(e.error.innererror.errordetails,function(e,r){t+=r.message+"\n"})}else if(e.error.message.value){t=e.error.message.value}}return t}});return n},true);
//# sourceMappingURL=QuickActionBaseController.js.map