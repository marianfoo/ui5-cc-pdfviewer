sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/lib/multipleViews/MultipleViewsHandler","sap/base/util/extend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/model/analytics/odata4analytics","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/base/util/each","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser"],function(e,t,r,a,n,i,o,l,u,s){"use strict";var c="AnalyticalListPage.controller.MultipleViewsHandler";var g=new l(c).getLogger();function m(e,a,l){var m;var f;var p;var d;var y;var S=a.getOwnerComponent().getModel();function v(){if(!m){return}m.updateCounts()}function P(e,t){if(!m){return}m.onRebindContentControl(e,t)}function b(e,t){if(!m){return null}return C(e,t)}function h(e,t){return e.filter(function(e){if(e.name===t){return e}})}function C(t,r){var a="";var n=new o.Model(o.Model.ReferenceByModel(S));var l=n.findQueryResultByName(t.name);var c=new o.QueryResultRequest(l);var m=l&&l.getParameterization();var f=e.oSmartFilterbar&&e.oSmartFilterbar.getAnalyticalParameters();if(f&&f.length>0){var p=e.oSmartFilterbar&&e.oSmartFilterbar.getUiState({allFilters:false});var d=p?JSON.stringify(p.getSelectionVariant()):"{}";var y=new i(d)}if(m){var v;c.setParameterizationRequest(new o.ParameterizationRequest(m));if(y.getParameterNames){var P=y.getParameterNames();P.forEach(function(e){v=y.getParameter(e);c.getParameterizationRequest().setParameterValue(e,v)})}else{u(y.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){v=this.PropertyValueFrom.PropertyPath.split("/");c.getParameterizationRequest().setParameterValue(v[v.length-1],this.PropertyValueFrom.String,this.PropertyValueTo.String)}else{v=this.PropertyName.PropertyPath.split("/");c.getParameterizationRequest().setParameterValue(v[v.length-1],this.PropertyValue.String)}})}var b;if(y.getParameterNames){b=y.getParameterNames()}else{b=y&&y.Parameters&&y.Parameters.map(function(e){return e&&e.PropertyName&&e.PropertyName.PropertyPath})}var C=s.getParametersByEntitySet(S,t.name);if(C.entitySetName){var V=s.getPropertyOfEntitySet(S,C.entitySetName);var I=C.parameters.filter(function(e){return!b.includes(e)});for(var T=0;T<I.length;T++){v=I[T].split("/");var w=v[v.length-1];var F=h(V,w);var R=false;if(F.length>0){var E=F[0];R=E.type==="Edm.String"&&E["sap:parameter"]==="optional"}if(R){c.getParameterizationRequest().setParameterValue(w,"")}}}}try{a=c.getURIToQueryResultEntitySet()}catch(e){l=c.getQueryResult();a="/"+l.getEntitySet().getQName();g.error("getEntitySetPathWithParameters","binding path with parameters failed - "+e||e.message)}return a}function V(e,t){return m?m.formatMessageStrip(e,t):""}function I(){if(m){var e=m.getSelectedKey();var t=m.getContentForIappState(e);return{state:t}}return null}function T(e){if(!m){return a.getOwnerComponent().getEntitySet()===e}return m.hasEntity(e)}function w(e){return m&&m.formatItemTextForMultipleView(e)}function F(e){if(m){m.restoreFromIappState(e);O()}}function R(){return m&&m.determineSortOrder()}function E(e,t,r){if(!m){return false}m.refreshOperation(e,t,r);return true}function K(){return!!(f&&f.enableAutoBinding)}function A(){return d}function M(e,t,r){if(!m){return}m.setControlVariant(e,t,r)}function Q(e){if(!m){return}if(e.selectedQuickVariantSelectionKey){m.setSelectedKey(e.selectedQuickVariantSelectionKey)}}function k(){if(!p){return null}return p==="single"?"tableViewData":"tableTabData"}function H(){return m.getSelectedKey()}function N(e){return m.setSelectedKey(e)}function B(t){var r=t.getParameter("itemContexts")&&t.getParameter("itemContexts")[0];l.oCommonEventHandlers.onListNavigate(t,e,r)}function O(){if(p==="multi"){var r=m.getSelectedKey();var n=t.getStableId({type:"ALPTable",subType:"SmartTable",sQuickVariantKey:r});var i=t.getStableId({type:"ALPChart",subType:"SmartChart",sQuickVariantKey:r});e.oSmartTable=a.byId(n);e.oSmartChart=a.byId(i)}}function z(e){if(p==="multi"){m.refreshSiblingControls(e)}}function q(e){var r=t.getStableId({type:"ALPTable",subType:"SmartTable",sQuickVariantKey:e});var n=t.getStableId({type:"ALPChart",subType:"SmartChart",sQuickVariantKey:e});var i=a.byId(r);return l.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(i||a.byId(n))}function L(){if(!f){return null}var t=Object.create(null);var r=p==="single"&&function(){return l.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(e.oSmartTable)};for(var a in f.variants){var n=f.variants[a].key||a;t[n]=r||q.bind(null,n)}return t}function U(e){if(m){m.registerKeyChange(e)}}function x(){return m&&m.getMode()}function D(){if(!y){y=new Promise(function(e){var r;if(p==="multi"){var n=t.getStableId({type:"QuickVariantSelectionX",subType:"IconTabBar"});r=a.byId(n)}else{var i=t.getStableId({type:"QuickVariantSelection",subType:"SegmentedButton"});var o=t.getStableId({type:"QuickVariantSelection",subType:"VariantSelect"});r=a.byId(i)||a.byId(o)}e(r)})}return y}function j(){return m?m.getInitializationPromise():Promise.resolve()}(function(){var t=l.oComponentUtils.getSettings();var i=t.quickVariantSelectionX;var o=t.quickVariantSelection;if(i&&o){throw new n(c,"Defining both QuickVariantSelection and QuickVariantSelectionX in the manifest is not allowed.")}f=i||o;if(i){d=i.enableAutoBinding;if(d===null||d===undefined){i.enableAutoBinding=true}}if(!f){return}p=i?"multi":"single";var u={mode:p,manifestSettings:f,pathInTemplatePrivateModel:"/alp/multipleViews",presentationControlHandler:o&&l.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(e.oSmartTable),getPresentationControlHandler:i&&q,getSwitchingControlAsync:D,smartFilterBar:e.oSmartFilterbar,resolveParameterizedEntitySet:C,getSearchValue:function(){return e.oSmartFilterbar.getBasicSearchValue()},appStateChange:function(){if(m){O()}},isDataToBeShown:function(){return true},adaptRefreshRequestMode:function(e){return e},refreshModelOnTableRefresh:true,adaptPresentationControl:O};m=new r(a,l,u);D().then(O)})();return{onDataRequested:v,refreshOperation:E,onRebindContentControl:P,formatMessageStrip:V,getContentForIappState:I,restoreFromIappState:F,formatItemTextForMultipleView:w,getEnableAutoBinding:K,getOriginalEnableAutoBinding:A,determineSortOrder:R,setControlVariant:M,handleStartUpObject:Q,onDetailsActionPress:B,getSelectedKeyPropertyName:k,getSelectedKey:H,setSelectedKey:N,hasEntitySet:T,refreshSiblingControls:z,resolveParameterizedEntitySet:b,getMode:x,resolveParameterizedEntitySetforAggregatedService:C,getKeyToPresentationControlHandler:L,registerKeyChange:U,getInitializationPromise:j}}return e.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.MultipleViewsHandler",{constructor:function(e,t,r){a(this,m(e,t,r))}})});
//# sourceMappingURL=MultipleViewsHandler.js.map