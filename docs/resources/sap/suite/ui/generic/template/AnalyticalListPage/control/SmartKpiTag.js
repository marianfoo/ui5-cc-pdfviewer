sap.ui.define(["sap/ui/core/Control","sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiTagController","sap/suite/ui/generic/template/AnalyticalListPage/util/KpiUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/KpiAnnotationHelper","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/ui/comp/odata/ODataModelUtil","sap/suite/ui/generic/template/AnalyticalListPage/control/KpiProvider","sap/suite/ui/generic/template/listTemplates/listUtils","sap/ui/Device","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/model/Filter","sap/ui/model/json/JSONModel","sap/ui/core/Locale","sap/m/ResponsivePopover","sap/m/MessageStrip","sap/ui/core/format/NumberFormat","sap/m/library","sap/ui/core/library","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/m/GenericTag","sap/m/ObjectNumber","sap/ui/events/KeyCodes"],function(e,t,i,r,a,s,o,n,l,p,h,u,c,g,f,d,_,P,y,v,m,S,T){"use strict";var b=new v("AnalyticalListPage.control.SmartKpiTag");var I=b.getLogger();var C=b.Level;var E="Target",K="Maximize",F="Minimize";return m.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.SmartKpiTag",{metadata:{designTime:true,interfaces:["sap.m.IOverflowToolbarContent"],properties:{entitySet:{type:"string",defaultValue:"",bindable:false},qualifier:{type:"string",defaultValue:"",bindable:false},modelName:{type:"string",defaultValue:undefined,bindable:false},groupId:{type:"string",defaultValue:"AlpKpiGroup",bindable:false},smartFilterId:{type:"string",defaultValue:undefined,bindable:false},shortDescription:{type:"string",defaultValue:"",bindable:"bindable"},enabled:{type:"boolean",defaultValue:true,bindable:false},error:{type:"boolean",defaultValue:false,bindable:false},errorType:{type:"sap.ui.core.MessageType",defaultValue:y.MessageType.Error},errorMessage:{type:"string",defaultValue:"",bindable:"bindable"},kpivalue:{type:"string",defaultValue:"",bindable:"bindable"},kpiunit:{type:"string",defaultValue:"",bindable:"bindable"},indicator:{type:"sap.m.ValueColor",defaultValue:undefined}},events:{beforeRebindFilterableKPI:{}}},renderer:{},_isPercent:false,_unScaledValue:"",_sUnitofMeasure:"",_relativeToProperties:[],_bStopDataLoad:true,bSearchTriggred:false,init:function(){I.setLevel(C.WARNING,this)},_initCompositeSupport:function(e){i.addToKpiList(e,this)},propagateProperties:function(){e.prototype.propagateProperties.apply(this,arguments);this._initialiseMetadata()},_initialiseMetadata:function(){o.handleModelInit(this,this._onMetaDataInit)},_setDeferredGroups:function(){if(!this._oModel){return}var e=this._oModel.getDeferredGroups();var t=this.getGroupId();if(e.indexOf(t)<0){e.push(t);this._oModel.setDeferredGroups(e)}},_onMetaDataInit:function(){var e=this.getModelName();if(!e){this._oModel=this.getModel()}else{this._oModel=this.getModel(e)}this._setDeferredGroups();this._oModel.getMetaModel().loaded().then(function(){this.kpiProvider=new n(this);if(!this.kpiProvider){this._kpiErrorHandler({},false);this._updateKpiList(true);return}this.kpiSettings=this.kpiProvider.getConfig();if(!this.kpiSettings){I.error("KPI Error details: incorrect KPI configuration");this._updateKpiList(true);return}var e=this.getSmartFilterId();if(e){if(e&&!this._oSmartFilter){this._oSmartFilter=this._findControl(e);this._oSmartFilter.attachSearch(function(e){this.bSearchTriggred=true;this._createFilterableKpi()}.bind(this));this._oSmartFilter.attachFilterChange(function(e){if(!this._oSmartFilter.isLiveMode()&&!this._oSmartFilter.isDialogOpen()){this.setEnabled(false)}}.bind(this));if(this._oSmartFilter.isInitialised()){this._createFilterableKpi()}else{this._oSmartFilter.attachInitialized(this._createFilterableKpi,this)}}}else{this._createGlobalKpi()}}.bind(this))},_handleFilterableKpiInGoMode:function(e){var t=true;if(!this._oSmartFilter.isLiveMode()){if(!this.bSearchTriggred){this.setProperty("visible",false);t=false}else{var i=this.getProperty("errorMessage");if(i!=="KPI_AUTHORIZATION_ISSUE"&&i!=="KPI_DEFAULT_PV_ERROR_MESSAGE"){this.setProperty("visible",true)}}}return t},_createFilterableKpi:function(e){if(!this._handleFilterableKpiInGoMode(e)){return}try{this._updateKpiList(false);this.setBusy(true);var t=false;if(this.getEntitySet()===this._oSmartFilter.getEntitySet()){t=true;if(!a.checkManditoryFieldsFilled(this._oSmartFilter).bIsMandatoryFilter){this._mandatoryfieldsErrorHandler(false,false,true);return}}var o=this.kpiSettings,n=o.selectOptions,p=l.getSelectionVariantParameterNamesWithoutNavigation(o.parameters),c=this._oSmartFilter.getUiState(),g=c.getProperty("selectionVariant"),f=g?g.SelectOptions:undefined,d=g?g.Parameters:undefined,_=this._oSmartFilter.getFilterData(true),P=new h(g),y=new h,v=[],m,S,T,b,C=false,E,K,F=this._oModel.getMetaModel(),M=F.getODataEntitySet(this.getEntitySet()),D=F.getODataEntityType(M.entityType),V=o.entitySet["Org.OData.Capabilities.V1.FilterRestrictions"],O=V["RequiredProperties"];if(f){for(var R=0;R<f.length;R++){S=f[R].PropertyName;T=f[R].Ranges;var k=F.getODataProperty(D,S),L=k&&a.isPropertyNonFilterable(M,k.name);if(L||a.isPropertyHidden(k)){continue}if(k){if(T){for(var N=0;N<T.length;N++){if(T[N].Sign==="I"||T[N].Sign==="E"){if(T[N].Low!==undefined){b=i.getFilter(T[N],f[R],S);if(this._checkKPIMandatoryFields(O,S)){if(!b.value1){this._mandatoryfieldsErrorHandler(false,false,true);return}}if(k!==null&&k["type"]==="Edm.DateTime"){if(b.value1&&!(b.value1.indexOf("Z")===b.value1.length-1)){b.value1=b.value1.split("T")[0]+"T00:00:00Z"}if(b.value2&&!(b.value2.indexOf("Z")===b.value2.length-1)){b.value2=b.value2.split("T")[0]+"T00:00:00Z"}}y.addSelectOption(b.path,b.sign,b.operator,b.value1,b.value2)}}}}}}}if(d){for(var R=0;R<d.length;R++){E=d[R];S=E.PropertyName;K=E.PropertyValue;var w=r.checkMandatoryParameter(this._oModel,M,S);if(w){if(!K){this._mandatoryfieldsErrorHandler(false,false,true);return}}if(K!==y.getParameter(S)){if(S&&K&&K!==""){var A=r.checkParameterizedEntitySet(this._oModel,M,S);if(A){if(r.checkForDateTimeParameter(this._oModel,this.getEntitySet(),S)){if(K&&!(K.indexOf("Z")===K.length-1)){K=K.split("T")[0]+"T00:00:00Z"}}y.addParameter(S,K)}}}}}if(n){for(var R=0;R<n.length;R++){m=n[R];S=m.PropertyName.PropertyPath;T=m.Ranges;var k=F.getODataProperty(D,S),L=k&&a.isPropertyNonFilterable(M,k.name);if(L){continue}if(k&&_&&_[S]===undefined){C=true;if(!y.getSelectOption(S)){for(var N=0;N<T.length;N++){if(T[N].Sign.EnumMember===s.SelectionRangeSignType+"/I"||T[N].Sign.EnumMember===s.SelectionRangeSignType+"/E"){if(T[N].Low!==undefined){b=i.getFilter(T[N],m);if(this._checkKPIMandatoryFields(O,S)){if(!b.value1){this._mandatoryfieldsErrorHandler(true,false,false);return}}y.addSelectOption(b.path,b.sign,b.operator,b.value1,b.value2)}}}}}}}if(p){for(var R=0;R<p.length;R++){E=p[R];S=E.PropertyName&&E.PropertyName.PropertyPath;K=P.getParameter(S)||E.PropertyValue.String;var w=r.checkMandatoryParameter(this._oModel,M,S);if(w){if(!K){this._mandatoryfieldsErrorHandler(true,false,false);return}}if(_&&_["$Parameter."+S]===undefined){C=true;if(!y.getParameter(S)){if(S&&K&&K!==""){y.addParameter(S,K)}}}}}if(!t||!C){if(!a.checkManditoryFieldsFilled(this._oSmartFilter).bIsMandatoryFilter){this._mandatoryfieldsErrorHandler(false,false,true);return}}this.fireBeforeRebindFilterableKPI({selectionVariant:y,entityType:M.entityType});var H=y.getSelectOptionsPropertyNames();for(var R=0;R<H.length;R++){m=y.getSelectOption(H[R]);for(var x=0;x<m.length;x++){T=m[x];if(T.Sign==="I"||T.Sign==="E"){if(T.Low!==undefined){b=i.getFilter(T,null,H[R]);v.push(new u(b))}}}}this._filterableKPISelectionVariant=y;var U=r.resolveParameterizedEntitySet(this._oModel,o.entitySet,y);this._applyFiltersToKpi.apply(this,[y,v,U])}catch(e){this._updateKpiList(true);I.error("KPI Error details: "+e)}},_createGlobalKpi:function(){try{this._updateKpiList(false);this.setBusy(true);var e=this.kpiSettings;var t=e.selectOptions,a,s,o=[];if(t){for(var n=0;n<t.length;n++){a=t[n];for(var l=0;l<a["Ranges"].length;l++){s=a["Ranges"][l];if(s.Low){o.push(new u(i.getFilter(s,a)))}}}}var p=r.resolveParameterizedEntitySet(this._oModel,e.entitySet,e.selectionVariant);this._applyFiltersToKpi.apply(this,[e.selectionVariant,o,p])}catch(e){this._updateKpiList(true);I.error("KPI Error details: "+e)}},_applyFiltersToKpi:function(e,t,i){this._relativeToProperties=[];var r=this.kpiSettings;var s=r.dataPoint,o;var n=this.getGroupId();this._getCriticalityRefProperties(s);this._oConfig={path:i,filterable:this.getSmartFilterId()?true:false,properties:{value:r.props.value,valueFormat:r.dataPoint.ValueFormat,title:r.props.title,unitOfMeasure:r.props.unitOfMeasure,isInteger:r.dataPoint.Value&&a.isInteger(r.dataPoint.Value.EdmType)?true:false}};this._oConfig.properties.shortDescription=r.props.shortDescription;this._checkForPercent(this._oConfig.properties.unitOfMeasure);if(this._relativeToProperties.length!==0){o=this._relativeToProperties.indexOf(this._oConfig.properties.value)===-1?[this._oConfig.properties.value].concat(this._relativeToProperties).join(","):this._relativeToProperties}else{o=[this._oConfig.properties.value]}if(this._oConfig){this._oModel.read(this._oConfig.path,{async:true,filters:t,urlParameters:{$select:o,$top:1},success:this._kpiSuccessHandler.bind(this),error:this._kpiErrorHandler.bind(this),groupId:n})}if(this.getSmartFilterId()){this._updateKpiList(!this._bStopDataLoad)}else{this._updateKpiList(true)}},_updateKpiList:function(e){Promise.resolve().then(function(){this._updateKpiListAsync(e)}.bind(this))},_updateKpiListAsync:function(e){var t=this.getGroupId();i.updateKpiList(this,e);if(!e){return}var r=i.getKpiList(this.getModelName(),t);for(var a in r){if(!r[a].bProcessed){return}}this._oModel.submitChanges({groupId:t})},_checkKPIMandatoryFields:function(e,t){if(e&&t){for(var i=0;i<e.length;i++){if(e[i].PropertyPath===t){return true}}}},_mandatoryfieldsErrorHandler:function(e,t,i){this._kpiErrorHandler({},e,t,i);this._updateKpiList(true)},_checkKpiCriticality:function(){var e=this.kpiSettings;var t=e.dataPoint;var i;e.criticalityNotDefined=false;if(e.criticality){if(e.criticality.criticalityPath){i=e.criticality.criticalityPath;this._oConfig.criticality={criticalityPath:e.criticality.criticalityPath}}else if(e.criticality.criticalityType){i=this._getCriticalityFromEnum(e.criticality.criticalityType);this._oConfig.criticality={criticalityType:e.criticality.criticalityType}}}else if(e.criticalityCalculation){var r=e.criticalityCalculation.improveDirection,a=e.criticalityCalculation.toleranceHigh,s=e.criticalityCalculation.toleranceLow,o=e.criticalityCalculation.deviationLow,n=e.criticalityCalculation.deviationHigh;var l=[];if(this.getError()||this.getSmartFilterId()&&this._checkCriticalityCalculationForNumber(t.CriticalityCalculation,r)){this._mCriticalityIndicator="None"}else{l.push(this._getPathForIndicatorParts(a));l.push(this._getPathForIndicatorParts(s));l.push(this._getPathForIndicatorParts(o));l.push(this._getPathForIndicatorParts(n));l.push({path:"/"+e.props.value});i={parts:l,formatter:function(e,t,i,r,l){var p=t?t:s,h=e?e:a,u=i?i:o,c=r?r:n;p=p&&Number(p);h=h&&Number(h);u=u&&Number(u);c=c&&Number(c);l=l&&Number(l);return this._getImproveDirection(p,h,u,c,l)}.bind(this)};this._oConfig.criticalityCalculation={improveDirection:e.criticalityCalculation.improveDirection,toleranceLow:e.criticalityCalculation.toleranceLow,toleranceHigh:e.criticalityCalculation.toleranceHigh,deviationLow:e.criticalityCalculation.deviationLow,deviationHigh:e.criticalityCalculation.deviationHigh}}}else{e.criticalityNotDefined=true}this._oConfig.criticalityProps={criticalityIndicator:i,relativeProperties:this._relativeToProperties}},_getCriticalityRefProperties:function(e){var t=e.CriticalityCalculation;var i=e.Criticality;if(i&&i.Path&&this._relativeToProperties.indexOf(i.Path)===-1){this._relativeToProperties.push(i.Path)}else if(t){if(t.DeviationRangeLowValue&&t.DeviationRangeLowValue.Path&&this._relativeToProperties.indexOf(t.DeviationRangeLowValue.Path)===-1){this._relativeToProperties.push(t.DeviationRangeLowValue.Path)}if(t.DeviationRangeHighValue&&t.DeviationRangeHighValue.Path&&this._relativeToProperties.indexOf(t.DeviationRangeHighValue.Path)===-1){this._relativeToProperties.push(t.DeviationRangeHighValue.Path)}if(t.ToleranceRangeLowValue&&t.ToleranceRangeLowValue.Path&&this._relativeToProperties.indexOf(t.ToleranceRangeLowValue.Path)===-1){this._relativeToProperties.push(t.ToleranceRangeLowValue.Path)}if(t.ToleranceRangeHighValue&&t.ToleranceRangeHighValue.Path&&this._relativeToProperties.indexOf(t.ToleranceRangeHighValue.Path)===-1){this._relativeToProperties.push(t.ToleranceRangeHighValue.Path)}}},_kpiSuccessHandler:function(e,t){this.setProperty("error",false);this.setProperty("errorMessage","");if(this.kpiProvider.kpiConfig.bIsKpiAnnotaion&&!this.kpiProvider.kpiConfig.hasOwnProperty("navigation")||this.kpiProvider.kpiConfig.oDefaultPV===false){this._kpiErrorHandler(t)}try{var i=e.results[0];if(!i){throw"no data"}}catch(e){this.setProperty("errorType",y.MessageType.Warning);var r=this.getModel("i18n").getResourceBundle();this.setProperty("errorMessage",r.getText("KPI_NO_DATA"));I.warning("KPI error details: "+r.getText("KPI_NO_DATA"));return this._kpiErrorHandler(t,false,true,false)}this.setBusy(false);this._checkKpiCriticality();var a=new c;a.setData(i);this.setModel(a);this._setKpiName();this._setKpiValue();this._setKpiIndicator();this._setKpiStatus(this.getIndicator());this._setTooltipForKPI();if(!this.getEnabled()){this.setEnabled(true)}},_setKpiValue:function(){var e=new S({number:{path:"/"+this._oConfig.properties.value,formatter:function(e){this._isPercent=this._oConfig.properties.isPercent;this._unScaledValue=_.getFloatInstance({maxFractionDigits:3,groupingEnabled:true,showScale:false},new g(sap.ui.getCore().getConfiguration().getLanguage())).format(e);return this._oConfig.properties.isPercent?i.formatNumberForPresentation(e,this._getNumberOfFractionalDigits(),true):i.formatNumberForPresentation(e,this._getNumberOfFractionalDigits())}.bind(this)}});if(this._oConfig.properties.unitOfMeasure){this._oConfig.properties.unitOfMeasure.hasOwnProperty("Path")?e.bindProperty("unit",{path:"/"+this._oConfig.properties.unitOfMeasure.Path}):e.setProperty("unit",this._oConfig.properties.unitOfMeasure.String||this._oConfig.properties.unitOfMeasure)}this.setValue(e)},_setKpiStatus:function(e){switch(e){case"Good":this.setStatus("Success");this.getValue().setState("Success");break;case"Error":this.setStatus("Error");this.getValue().setState("Error");break;case"Critical":this.setStatus("Warning");this.getValue().setState("Warning");break;default:this.setStatus("None");this.getValue().setState("None");break}this.setDesign("StatusIconHidden")},_kpiErrorHandler:function(e,t,i,r){this._resetKpiValue();var a=this.getModel("i18n").getResourceBundle();if(e.statusCode==="401"||e.statusCode==="403"||e.authorizationError){this.setProperty("visible",false);this.setProperty("errorMessage",a.getText("KPI_AUTHORIZATION_ISSUE"));I.warning("KPI error details: "+a.getText("KPI_AUTHORIZATION_ISSUE"));return}if(this.kpiProvider.kpiConfig.oDefaultPV===false){this.setProperty("visible",false);this.setProperty("errorMessage",a.getText("KPI_DEFAULT_PV_ERROR_MESSAGE"));I.warning("KPI error details: "+a.getText("KPI_DEFAULT_PV_ERROR_MESSAGE"));return}if(t){this.setProperty("errorMessage",a.getText("REQUIRED_VH_FIELDS_OVERLAY_MESSAGE"));I.error("KPI error details: "+a.getText("REQUIRED_VH_FIELDS_OVERLAY_MESSAGE"));this.setStatus("Error")}else if(r){this.setProperty("errorType",y.MessageType.Information);this.setProperty("errorMessage",a.getText("KPI_INFO_FOR_MISSING_MANDATE_FILTPAR"));I.info("KPI error details: "+a.getText("KPI_INFO_FOR_MISSING_MANDATE_FILTPAR")," ",this);this.setStatus("Information")}else if(this.kpiProvider.kpiConfig.bIsKpiAnnotaion&&!this.kpiProvider.kpiConfig.hasOwnProperty("navigation")){I.warning("KPI error details: "+a.getText("KPI_DRILLDOWN_NAVIGATION_MESSAGE"));this.setStatus("Warning");if(!i){return}}this.setBusy(false);if(!t&&!this.getProperty("errorMessage")){this.setProperty("errorMessage",a.getText("KPI_GENERIC_ERROR_MESSAGE"));this.setStatus("Error")}if(e&&e.statusCode&&e.message){I.error("KPI error details: "+e.statusCode+" "+e.message)}this._setKpiName();this.setProperty("error",true);if(!this.getEnabled()){this.setEnabled(true)}},_resetKpiValue:function(){this.setValue(new S({number:"",unit:""}));this._isPercent=false;this._unScaledValue=""},_setKpiIndicator:function(){if(this._oConfig&&this._oConfig.criticalityProps){var e=this._oConfig.criticalityProps.criticalityIndicator;if(typeof e==="string"){this.setIndicator(e)}else if(typeof e==="object"){this.bindProperty("indicator",e)}}this.setDesign("StatusIconHidden")},_checkCriticalityCalculationForNumber:function(e,t){if(t===K){if(e.DeviationRangeLowValue&&!e.DeviationRangeLowValue.Path||e.ToleranceRangeLowValue&&!e.ToleranceRangeLowValue.Path){return true}}else if(t===F){if(e.DeviationRangeHighValue&&!e.DeviationRangeHighValue.Path||e.ToleranceRangeHighValue&&!e.ToleranceRangeHighValue.Path){return true}}else if(t===E){if(e.ToleranceRangeLowValue&&!e.ToleranceRangeLowValue.Path||e.ToleranceRangeHighValue&&!e.ToleranceRangeHighValue.Path){return true}}},_setKpiName:function(){if(!this.kpiSettings||!this.kpiSettings.props||!this.kpiSettings.props.title){return this.setProperty("shortDescription","")}var e=this.kpiSettings.props.title;if(e===undefined||typeof e!=="string"){e=""}var t=this._oConfig&&this._oConfig.properties.shortDescription?this._oConfig.properties.shortDescription:e;if(t){if(t.indexOf(">")>0){this.bindProperty("shortDescription",{path:t,formatter:function(e){return this._getKpiTagTitle(e)}.bind(this)})}else{this.setProperty("shortDescription",this._getKpiTagTitle(t))}}this.setText(this.getShortDescription())},_getPathForIndicatorParts:function(e){if(Number(e)||!e){return{path:"/dummy"}}return e},_getKpiTagTitle:function(e){return this.getShortDescription()?this.getShortDescription():this._getNameFromHeuristic(e)},_getCriticalityFromEnum:function(e){return this.kpiProvider.getCriticalityFromEnum(e)},_getNumberOfFractionalDigits:function(){var e=0;if(!this._oConfig.properties.isInteger){e=this._oConfig.properties.valueFormat&&this._oConfig.properties.valueFormat.NumberOfFractionalDigits.Int;if(e!=0){e=1}}return e},_getImproveDirection:function(e,t,i,r,a){return this.kpiProvider.getImproveDirection(e,t,i,r,a)},_onMouseClick:function(e){if(this.kpiSettings){this._displayKpiErrorPopOverOrCard(e)}else{I.error("KPI error details - Incorrect KPI configuration. Unable to open card")}},_displayKpiErrorPopOverOrCard:function(e){if(this.getError()){if(this._oPopoverDialog){this._oPopoverDialog.getContent()[0].setProperty("text",this.getProperty("errorMessage"));this._oPopoverDialog.getContent()[0].mAggregations._text.setProperty("text",this.getProperty("errorMessage"));this._oPopoverDialog.getContent()[0].setProperty("type",this.getProperty("errorType"));this._oPopoverDialog.openBy(this)}else{this._oPopoverDialog=this._getResponsivePopOver(this.getErrorMessage());this._oPopoverDialog.openBy(this)}}else{t.openKpiCard(e)}},_getResponsivePopOver:function(e){if(this._oPopoverDialog){return this._oPopoverDialog}var t=p.system.phone?true:false;var i=new f({showHeader:t,placement:P.PlacementType.Auto,content:[new d({text:e,showIcon:true,type:this.getProperty("errorType")})]}).addStyleClass("sapSmartTemplatesAnalyticalListPageErrorPopOver");i.setShowCloseButton(t);return i},_onKeyUp:function(e){if(this.kpiSettings&&e.which===T.ENTER||e.which===T.SPACE){this._displayKpiErrorPopOverOrCard(e)}else{I.error("KPI error details - Incorrect KPI configuration. Unable to open card")}},_checkForPercent:function(e){if(e&&e.hasOwnProperty("String")){this._oConfig.properties.unitOfMeasure=e.String?e.String:""}if(e&&e.hasOwnProperty("Path")&&this._relativeToProperties.indexOf(e.Path)===-1){this._relativeToProperties.push(e.Path)}this._oConfig.properties.isPercent=e&&e.hasOwnProperty("String")?e.String==="%":false},_getNameFromHeuristic:function(e){var t=e.split(/\s/);return t.length===1?this._getNameFromSingleWordHeuristic(e):this._getNameFromMultiWordHeuristic(t)},_getNameFromSingleWordHeuristic:function(e){return e.substr(0,3).toUpperCase()},_getNameFromMultiWordHeuristic:function(e){var t=[];t.push(e[0].charAt(0));t.push(e[1].charAt(0));if(e.length>=3){t.push(e[2].charAt(0))}return t.join("").toUpperCase()},getFilterableKPISelectionVariant:function(){return this._filterableKPISelectionVariant},_findControl:function(e){var t,i;if(e){t=sap.ui.getCore().byId(e);if(!t){i=this._getView();if(i){t=i.byId(e)}}}return t},_getView:function(){if(!this._oView){var e=this.getParent();while(e){if(e instanceof sap.ui.core.mvc.View){this._oView=e;break}e=e.getParent()}}return this._oView},exit:function(){this._relativeToProperties=[]},getToolTipForUndefinedIndicator:function(){if(this.kpiSettings.criticalityNotDefined){return"NONE"}else{return"NEUTRAL"}},_setTooltipForKPI:function(){var e=this.getValue();if(e===null){return}var t=this._isPercent?e.getNumber()+" "+e.getUnit():this._unScaledValue+" "+e.getUnit();var i=this.getIndicator();var r="KPI_TOOLTIP_"+(i?i.toUpperCase():this.getToolTipForUndefinedIndicator());var a=this.getModel("i18n").getResourceBundle();var s;var o=a.getText(r,[this.kpiSettings&&this.kpiSettings.props?this.kpiSettings.props.title:"",t]);if(this.kpiSettings&&this.kpiSettings.props){s=this.kpiSettings.props.title}if(s&&s.indexOf(">")>0){this.bindProperty("tooltip",{path:s,formatter:function(e){this._oConfig.properties.title=e;this.kpiSettings.props.title=e;return a.getText(r,[e,t])}.bind(this)})}else{this.setTooltip(o)}if(this.getError()){r=this.getErrorType()=="Error"?"KPI_DETERMINING_ERROR":"KPI_DETERMINING_WARNING"}this._ariaLabel=a.getText(r,[this.kpiSettings&&this.kpiSettings.props?this.kpiSettings.props.title:"",t])},onAfterRendering:function(){setTimeout(function(){this.detachBrowserEvent("click",this._onMouseClick).attachBrowserEvent("click",this._onMouseClick);this.detachBrowserEvent("keyup",this._onKeyUp).attachBrowserEvent("keyup",this._onKeyUp)}.bind(this),1)},getSmartKpiConfig:function(){return this._oConfig},getOverflowToolbarConfig:function(){return{canOverflow:true}},setShortDescription:function(e){this.setProperty("shortDescription",this._getNameFromHeuristic(e))},setEnabled:function(e){this.setProperty("enabled",e,true);if(e){this.removeStyleClass("sapSmartTemplatesAnalyticalListPageKpiTagDisable")}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageKpiTagDisable")}}})},true);
//# sourceMappingURL=SmartKpiTag.js.map