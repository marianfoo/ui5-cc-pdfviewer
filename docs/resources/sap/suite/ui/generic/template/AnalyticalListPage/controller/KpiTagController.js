sap.ui.define(["sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiCardController","sap/ui/model/json/JSONModel","sap/ui/core/library","sap/ui/Device","sap/m/ResponsivePopover","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(e,t,a,i,n,r){"use strict";var o=new r("AnalyticalListPage.controller.KpiTagController").getLogger();var s,l;l=a.mvc.ViewType;var p={_kpiCards:[],init:function(e){var a=this;a.oState=e;a.oGenericModel=new t;var i={header:"Some Header",title:"Some Title",titleUrl:"",icon:"sap-icon://camera"};a.oGenericModel.setData(i);if(s===undefined){s=sap.ui.getCore().loadLibrary("sap.ovp",{async:true})}},openKpiCard:function(e){var t=this;var a;if(typeof e.currentTarget!="undefined"){a=sap.ui.getCore().byId(e.currentTarget.id)}else{a=e.getSource()}s.then(function(){t.createPopover(function(){t._openCard(a)}.bind(t,a),a)})},_openCard:function(e){var t=this;setTimeout(function(){t._kpiCards[e.getQualifier()].openBy(e)},0)},handleKpiPress:function(e){this.openKpiCard(e)},createPopover:function(a,r){var s=this;var p=r.getQualifier();var d=s.oState.oController.getOwnerComponent();var g=d.getKeyPerformanceIndicators();var c;for(var u in g){if(g[u].hasOwnProperty("qualifier")&&g[u].qualifier===p){c=g[u];break}}if(!c){o.error("KPI settings not found with qualifier.");return}var v=d.getAppComponent().getManifestEntry("/sap.app/crossNavigation/outbounds/"+c.detailNavigation);var f=d.getModel(c.model);f.getMetaModel().loaded().then(function(){var o=this;var s=new t;var d=arguments[0];o._oCardController=new e;var g=o.oState.oController.getOwnerComponent();var c=g.getModel(d.model);var u=c.getMetaModel();var f=u.getODataEntitySet(d.entitySet);d.metaModel=u;s.setData(d);var C=r.getFilterableKPISelectionVariant();sap.ui.core.mvc.View.create({preprocessors:{xml:{bindingContexts:{entityType:u.createBindingContext(u.getODataEntityType(f.entityType,true)),entitySet:u.createBindingContext(u.getODataEntitySet(d.entitySet,true))},models:{entitySet:u,entityType:u,parameter:s},dataModel:c,settings:s,preprocessorsData:g.getComponentData().preprocessorsData}},type:l.XML,viewName:"sap.suite.ui.generic.template.AnalyticalListPage.view.KpiCardSizeM",height:"100%"}).then(function(e){var s=r.kpiSettings.kpiPropertyPath;e.data({kpiTitle:r.getSmartKpiConfig().properties.title,qualifierSettings:d});if(s.selectionPresentationVariantPath){e.data({dataPointPath:s.dataPointPath,selectionPresentationVariantPath:s.selectionPresentationVariantPath})}else{e.data({kpiAnnotationPath:s.kpiAnnotationPath})}if(d.filterable){e.data({mergedSelectionVariant:C})}else{e.data({selectionVariant:r.kpiSettings.selectionVariant})}e.setModel(g.getModel(d.model));var l=new t;var c={visible:d.detailNavigation?true:false};if(r.kpiSettings.navigation){c.target=r.kpiSettings.navigation.semanticObject;c.action=r.kpiSettings.navigation.action;c.parameters=JSON.stringify({EvaluationId:r.kpiSettings.navigation.kpiId})}else if(d.detailNavigation&&v){c.target=v.semanticObject;c.action=v.action;c.parameters=JSON.stringify(v.parameters?v.parameters:{})}else{c.visible=false}l.setData(c);e.setModel(l,"detailNavigation");if(typeof o._kpiCards[p]!="undefined"){o._kpiCards[p].destroy()}o._kpiCards[p]=new n;var u=i.system.phone?true:false;o._kpiCards[p].setShowHeader(u);if(!u){o._kpiCards[p].addStyleClass("sapSmartTemplatesAnalyticalListPageKpiCardStyle")}o._kpiCards[p].setPlacement("Auto");o._kpiCards[p].addContent(e);o._oKpiCardController=e.getController();o._oKpiCardController._assignSmartTemplateDependencies(o.oState.oTemplateUtils,o.oState.oController);o.oState.oController.getView().addDependent(o._kpiCards[p]);a()})}.bind(this,c))},onExit:function(){if(this._oKpiCard){this._oKpiCard.destroy()}},_setModel:function(e){this._oKpiCard.setModel(e)}};return p});
//# sourceMappingURL=KpiTagController.js.map