sap.ui.define(["sap/ui/comp/odata/MetadataAnalyser","sap/ui/base/Object","sap/ui/model/Context","sap/suite/ui/generic/template/AnalyticalListPage/util/OperationCode","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/ui/core/format/DateFormat","sap/ui/model/odata/AnnotationHelper","sap/ui/events/KeyCodes","sap/ui/comp/odata/FiscalFormat"],function(e,t,r,a,i,n,o,l,u){"use strict";var s=t.extend("sap.suite.ui.generic.template.AnalyticalListPage.util.FilterUtil");s.createTitle=function(e,t){var r;if(!e){return t}if(t instanceof Date){return e}if(e.indexOf(":")!==-1){e=e.substring(0,e.indexOf(":"))}if(e.indexOf(t)===-1){r=e+" ("+t+")"}else{r=e}return r};s._updateVisualFilterAria=function(e){var t=e.getItems()[1].getItems()[0];var r=t.getParentProperty();var a=t.getModel("i18n").getResourceBundle();var i=a.getText("VIS_FILTER_ITEM_ARIA");if(t.getIsMandatory()){i+=" "+a.getText("VIS_FILTER_MANDATORY_PROPERTY_ARIA",r)}i+=" "+a.getText("VIS_FILTER_DIALOG_NAVIGATE_ARIA")+" "+a.getText("VIS_FILTER_ACCESS_FIELDS_ARIA");e.getItems()[2].setText(i)};s.getAllMandatoryFilters=function(t,r){var a=new e(t);var i=a.getEntityTypeNameFromEntitySetName(r);var n=a.getFieldsByEntityTypeName(i);var o=[];for(var l in n){var u=n[l];if(u.requiredFilterField){o.push(u.name)}}return o};s.getAllMandatoryFiltersMapping=function(e,t){var r=[],a=[],i=false;for(var n=0;n<e.length;n++){i=true;for(var o=0;o<t.length;o++){if(e[n]===t[o].valueListProperty){r.push(t[o]);i=false;break}}if(i){a.push(e[n])}}var l={aMappedFilterList:r,aMappingMissingFilterList:a};return l};s.checkFilterHasValueFromSelectionVariant=function(e,t){return e.some(function(e){if(e.PropertyName.PropertyPath===t){return true}})};s.checkFilterHasValueFromSmartFilterBar=function(e,t){return e.some(function(e){if(e.getName()===t){return true}})};s.checkFilterHasValueFromSelectionVariantOrSmartFilterBar=function(e,t,r,a){var i=r&&s.checkFilterHasValueFromSelectionVariant(r,e);if(!i){i=s.checkFilterHasValueFromSmartFilterBar(a.getFiltersWithValues(),t)}return i};s.readProperty=function(e,t){var r=0,a=typeof t==="string"?t.split("."):[];while(r<a.length){if(!e){return undefined}e=e[a[r++]]}return e};s.executeFunction=function(e,t,r){var a=0,i,n=typeof t==="string"?t.split("."):[];while(a<n.length){if(!e){return undefined}i=e;e=e[n[a++]]}return typeof e==="function"?e.apply(i,r):undefined};s.createTitleFromCode=function(e){var t=s.readProperty(e,"value1"),r=s.readProperty(e,"value2"),i=s.readProperty(e,"operation"),n;if(!t||!i||!a[i]){return undefined}if(r&&i!=="EQ"){n=t+a[i].code+r}else if(a[i].position==="last"){n=t+a[i].code}else if(a[i].position==="mid"){n=a[i].code+t+a[i].code}else{n=a[i].code+t}if(e.exclude){n="!("+n+")"}return n};s.formatFiltersLink=function(e){var t=this.getModel("i18n"),r=t.getResourceBundle();return e?r.getText("VISUAL_FILTER_FILTERS_WITH_COUNT",[e]):r.getText("VISUAL_FILTER_FILTERS")};s.getBooleanValue=function(e,t){if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t};s.getPrimitiveValue=function(e){var t;if(e){if(e.String){t=e.String}else if(e.Bool){t=s.getBooleanValue(e)}else if(e.EnumMember){t=e.EnumMember.split("/")[1]}else{t=s.getNumberValue(e)}}return t};s.getNumberValue=function(e){if(e){var t=Object.keys(e)[0];return e&&t&&["String","Int","Decimal","Double","Single"].indexOf(t)!==-1?Number(e[t]):undefined}};s.getPathOrPrimitiveValue=function(e){if(e){return e.Path?"{path:'"+e.Path+"'}":s.getPrimitiveValue(e)}else{return""}};s.isFilterDiff=function(e,t){if(Array.isArray(e)!=Array.isArray(t)){return true}if(Array.isArray(e)){return this.isFilterListDiff(e,t)}else{return this.isFilterObjDiff(e,t)}};s.isFilterObjDiff=function(e,t){if(!e||!t){return true}for(var r in e){if(r=="aFilters"){if(this.isFilterListDiff(e.aFilters,t.aFilters)){return true}}else if(e[r]!=t[r]){return true}}return false};s.convertLocalDatetoUTCDate=function(e){var t=new Date(e.valueOf()+e.getTimezoneOffset()*60*1e3);return new Date(t.setHours(0,0,0))};s.getDateInMedium=function(e){return e instanceof Date?n.getDateInstance({style:"medium"}).format(e):undefined};s.getDateTimeInMedium=function(e){return e instanceof Date?n.getDateTimeInstance({style:"medium"}).format(e):undefined};s.isDefaultVariantSelected=function(e){var t=e.oSmartFilterbar.getSmartVariant();return t&&t.getCurrentVariantId()===t.getDefaultVariantKey()};s.isFilterListDiff=function(e,t){if(!e||!t){return true}if(e.length!=t.length){return true}for(var r=0;r<e.length;r++){var a=e[r];var i=t[r];if(this.isFilterObjDiff(a,i)){return true}}return false};s.getTextArrangement=function(e,t,r){var a,i=e?e:t,n=e&&t?e+" ("+t+")":i;if(t!=="__IS_OTHER__"&&t!=="Other"){switch(r){case sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionAndId:a=n;break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionOnly:a=e?e:"";break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.idAndDescription:a=e&&t?t+" ("+e+")":i;break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.idOnly:a=t?t:"";break;default:a=n;break}}else{a=e}return a};s.getTooltipForValueHelp=function(e,t,r,a,i){var n="";if(i){if(!a){n=r.getText("DP_WITHOUT_SELECTIONS",t)}else{n=r.getText("DP_SINGLE_SELECTED",[t,a])}return n}if(!a){n=e?r.getText("VALUE_HELP",t):r.getText("DROPDOWN_WITHOUT_SELECTIONS",t)}else{if(!e){n=r.getText("DROPDOWN_WITH_SELECTIONS",[t,a])}else{n=a===1?r.getText("VH_SINGLE_SELECTED",[t,a]):r.getText("VH_MULTI_SELECTED",[t,a])}}return n};s.getPropertyNameDisplay=function(e,t,r,a,i){var n=a?a.getResourceBundle():undefined,o=e.getMetaModel(),l=o.getODataEntityType(o.getODataEntitySet(t).entityType),u=o.getODataProperty(l,r);if(!u){return r}var s=u["com.sap.vocabularies.Common.v1.Label"]&&u["com.sap.vocabularies.Common.v1.Label"].String?u["com.sap.vocabularies.Common.v1.Label"].String:u["sap:label"];var f=u["com.sap.vocabularies.Common.v1.QuickInfo"]&&u["com.sap.vocabularies.Common.v1.QuickInfo"].String?u["com.sap.vocabularies.Common.v1.QuickInfo"].String:u["sap:quickinfo"];if(i&&f){return f}if(s){if(s.match(/{@i18n>.+}/gi)&&n){s=n.getText(s.substring(s.indexOf(">")+1,s.length-1))}return s}else{return r}};s.getUnitFieldText=function(e,t,r){var a=e.getMetaModel(),i=a.getODataEntityType(a.getODataEntitySet(t).entityType),n=a.getODataProperty(i,r),o=n["com.sap.vocabularies.Common.v1.Text"]&&n["com.sap.vocabularies.Common.v1.Text"].Path?n["com.sap.vocabularies.Common.v1.Text"].Path:n["sap:text"];return o};s.IsNavigationProperty=function(e,t,r){var a=e.getMetaModel(),i=a.getODataEntityType(a.getODataEntitySet(t).entityType);var n=i["navigationProperty"];var o=false;if(r.indexOf("/")!==-1){for(var l=0;l<n.length;l++){if(n[l].name===r.split("/")[0]){o=true;break}}}return o};s.getKeysForNavigationEntitySet=function(e,t,r){if(r){var a=e.getODataEntitySet(t),i=e.getODataEntityType(a.entityType),n=e.getODataAssociationEnd(i,r),o=e.getODataEntityType(n.type),l=this.readProperty(o,"key.propertyRef");if(l&&l.length>1){return l||null}else{return null}}else{return null}};s.isPropertyNonFilterable=function(e,t){if(!e||!t){return false}var r=e[i.FilterRestrictions];var a=r&&r.NonFilterableProperties;if(a){for(var n=0;n<a.length;n++){if(a[n].PropertyPath===t){return true}}}return false};s.getVisualFilterSelectFields=function(e,t,r,a,i,n,o){var l=[e,t];if(t!=r){if(l.indexOf(r)===-1){l.push(r)}}if(a){if(l.indexOf(a)===-1){l.push(a);if(o&&l.indexOf(o)===-1){l.push(o)}}}if(i&&Array.isArray(i)){i.forEach(function(e){if(l.indexOf(e)===-1){l.push(e)}})}if(n){n.forEach(function(e){if(l.indexOf(e.name)===-1){l.push(e.name)}})}return l};s.getFilterDialogMode=function(e){return e.getProperty("/alp/filterDialogMode")};s.getFilterMode=function(e){return e.getProperty("/alp/filterMode")};s.isVisualFilterLazyLoaded=function(e){if(!e.getLazyLoadVisualFilter()){return false}var t=this.getFilterDialogMode(e.getModel("_templPriv"));if(t==="compact"){return true}else if(t==="visual"){return false}var r=this.getFilterMode(e.getModel("_templPriv"));if(r==="compact"){return true}return false};s.formatStringDate=function(e,t,r){if(e!==""){if(t==="Line"){var a=n.getDateInstance({format:"MMMdd"});var i=n.getDateInstance({format:"YYYY"});var o=e&&a.parse(e);var l=e&&i.parse(e);if(r){return i.format(l)}else{return a.format(o)}}else{var u=n.getDateInstance({pattern:"yyyyMMdd"});var f=e&&u.parse(e);return s.getDateInMedium(f)}}return e};s.formatStringDateYearMonth=function(e,t,r){if(e!==""){var a=e;var i="-";var o=4;var l=[a.slice(0,o),i,a.slice(o)].join("");var u=new Date(l);if(t==="Line"){var s=n.getDateTimeInstance({format:"Y"});var f=n.getDateTimeInstance({format:"MMM"});if(r){return s.format(u)}else{return f.format(u)}}else{var c=n.getDateTimeInstance({format:"YYYYMMM"});return c.format(u)}}return e};s.formatStringDateYearQuarter=function(e,t,r){if(e!==""){var a=parseInt(e.substr(0,4),10),i=e.substr(4),o=parseInt(i,10)*3-2,l=o-1,u=new Date(a,l);if(t==="Line"){var s=n.getDateTimeInstance({format:"QQQ"});if(r){return a}else{return s.format(u)}}else{var s=n.getDateTimeInstance({format:"YYYYQ"});return s.format(u)}}return e};s.formatStringDateYearWeek=function(e,t,r){if(e!==""){var a=parseInt(e.substr(0,4),10),i=e.substr(4),o=1+(parseInt(i,10)-1)*7,l=new Date(a,0,o);var u=n.getDateTimeInstance({format:"Y"}),s=n.getDateTimeInstance({format:"www"});if(t==="Line"){if(r){return u.format(l)}else{return s.format(l)}}else{var f=s.format(l).concat(" ",u.format(l));return f}}return e};s.formatStringFiscalYearPeriod=function(e,t,r){if(e!==""){var a,i,n=1,o=1e3,l=1e4,u=parseInt(e,10);if(u<l){a=u;i=n}else{a=Math.floor(u/o);i=u%o}if(t==="Line"){if(r){return a.toString()}else{return i.toString()}}else{var s=i.toString().concat(" ",a.toString());return s}}return e};s.getResolvedDimensionValue=function(e){return e===null||e===""?null:e.toString()};s.isPropertyHidden=function(e){var t=false;if(e){var r=e["com.sap.vocabularies.UI.v1.Hidden"];t=r?r.Bool==="true":false}return t};s.isInteger=function(e){return e.toUpperCase().indexOf("EDM.INT")!=-1?true:false};s.onKeyUpVisualFilter=function(e){if(e.keyCode===l.F4){var t=sap.ui.getCore().byId(e.target.id),r,a;if(t){var i=t.getMetadata().getElementName();switch(i){case"sap.m.Button":if(this.isF4Enabled){r=t}break;case"sap.m.HeaderContainerItemContainer":var n=t.getItem();if(n){a=n.getId().replace("FilterItemContainer","ValueHelpButton");r=this.getF4ButtonId(a)}break;case"sap.m.CustomListItem":a=t.getId().replace("FilterItemContainer","ValueHelpButton");r=this.getF4ButtonId(a);break;default:break}}else{if(e.target.id.length>0){a=e.target.id.replace("FilterItemMicroChart","ValueHelpButton")}else{a=e.target.parentElement.id.replace("FilterItemMicroChart","ValueHelpButton")}a=a.slice(0,a.indexOf("-innerChart"));r=this.getF4ButtonId(a)}if(r&&this.isF4Enabled(r)){r.firePress()}}};s.onKeyDownVisualFilter=function(e,t){if(t.keyCode===l.ENTER){if(t.ctrlKey||t.metaKey){e.search();t.stopPropagation()}}};s.getF4ButtonId=function(e){var t=sap.ui.getCore().byId(e);return t};s.isF4Enabled=function(e){if(e.data("isF4Enabled")){if(e.getVisible()&&e.getEnabled()){return true}}return false};s.isAlreadyInParameter=function(e,t){return e&&e.some(function(e){return e.localDataProperty===t})};s.checkManditoryFieldsFilled=function(e){if(e){var t=e.determineMandatoryFilterItems(),r=e.getFiltersWithValues(),a=0;var i={aMandatoryFilter:[],bIsMandatoryFilter:true};if(t.length){if(!r.length||r.length<t.length){i.bIsMandatoryFilter=false}if(!e.validateMandatoryFields()){for(var n=0;n<t.length;n++){for(var o=0;o<r.length;o++){if(r[o].getName()===t[n].getName()){a++}else if(r[o].getMandatory()){i.aMandatoryFilter.push(t[n].getLabel())}}}i.bIsMandatoryFilter=a===t.length;if(t.length===1){i.aMandatoryFilter.push(t[0].getLabel())}}}if(i.bIsMandatoryFilter){var l=e.verifySearchAllowed.apply(e,arguments);if(l.hasOwnProperty("error")||l.hasOwnProperty("mandatory")){i.bIsMandatoryFilter=false}}}return i};s.getParameter=function(e){var t="$Parameter.";if(e.indexOf(t)>-1){e=e.substring(t.length)}return e};return s},true);
//# sourceMappingURL=FilterUtil.js.map