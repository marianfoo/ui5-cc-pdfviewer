sap.ui.define(["sap/m/HeaderContainer","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/ui/comp/odata/ODataModelUtil","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/VisualFilterProvider","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/model/Filter","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/ui/comp/odata/MetadataAnalyser","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/m/VBox","sap/m/Button","sap/m/Title","sap/suite/ui/generic/template/AnalyticalListPage/controller/DropDownController","sap/suite/ui/generic/template/AnalyticalListPage/controller/DynamicDateRangeController","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroBar","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroLine","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroDonut","sap/ui/model/json/JSONModel","sap/ui/core/CustomData","sap/m/Text","sap/m/OverflowToolbarLayoutData","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/model/SimpleType","sap/ui/core/library","sap/m/library","sap/m/DatePicker","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/core/InvisibleText","sap/suite/ui/generic/template/js/StableIdHelper","sap/base/util/deepExtend","sap/m/DynamicDateRange"],function(t,e,i,r,a,n,o,s,l,p,u,g,d,f,h,c,m,y,v,_,F,C,P,I,M,V,S,T,L,D,b,A,w,x,E){"use strict";var O=new b("AnalyticalListPage.visualfilterbar.SmartVisualFilterBar").getLogger();var B="Donut";var R="Line";var N="Bar";var H=S.extend("sap.ui.model.DimensionFilterType",{formatValue:function(t){return t},parseValue:function(t){return t},validateValue:function(t){}});var U=t.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",{metadata:{designTime:true,properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},config:{type:"object",group:"Misc",defaultValue:null},persistencyKey:{type:"string",group:"Misc",defaultValue:null},lazyLoadVisualFilter:{type:"boolean",group:"Misc",defaultValue:true},displayCurrency:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},allFiltersAsInParameters:{type:"boolean",group:"Misc",defaultValue:true},associateValueListsCalled:{type:"boolean",group:"Misc",defaultValue:false},filterSettings:{type:"object",group:"Misc",defaultValue:null}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},events:{filterChange:{},Initialized:{},onFilterItemAdded:{}}},renderer:{}});U.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this,arguments)}var e=document.body.classList.contains("sapUiSizeCozy");this._cellItemHeightNorth=e?"3rem":"2rem";this._cellItemHeightSouth=e?"9.9rem":"7.5rem";V.system.phone?this._cellItemHeightSouth="9rem":"";this._cellHeight=e?"12rem":"11rem";this._cellWidth="20rem";this.labelHeight=2;this.compHeight=e?9.9:7.9;this.cellHeightPadding=1;this.cellHeight=this.labelHeight+this.compHeight+this.cellHeightPadding+"rem";this.cellWidth=320;this._dialogFilters={};this._compactFilters={};this._oVariantConfig={};this.setModel(new F,"_visualFilterConfigModel");if(e){if(V.system.phone){this.setOrientation("Vertical");this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozyPhone")}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozy")}}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBar")}};U.prototype.propagateProperties=function(){t.prototype.propagateProperties.apply(this,arguments);this._initMetadata()};U.prototype._initMetadata=function(){if(!this.bIsInitialised){i.handleModelInit(this,this._onMetadataInit)}};U.prototype._onMetadataInit=function(){var t=this.getModel();if(t.mMetadataUrlParams&&t.mMetadataUrlParams["sap-value-list"]==="none"){this._smartFilterContext.attachEvent("valueListAnnotationLoaded",function(t){this._initiateVisualFilterLoad()}.bind(this))}else{this._smartFilterContext.attachInitialized(this._initiateVisualFilterLoad,this)}};U.prototype._initiateVisualFilterLoad=function(){if(this.bIsInitialised){return}this._annoProvider=this._createVisualFilterProvider();if(!this._annoProvider){return}this._oMetadataAnalyser=this._annoProvider.getMetadataAnalyser();this.bIsInitialised=true;this._updateFilterBar()};U.prototype._createVisualFilterProvider=function(){var t=this.getModel();var e=this.getEntitySet();if(!t||!e){return null}return new r(this)};U.prototype._getBasicGroupTitle=function(){return this.getModel("i18n").getResourceBundle().getText("VIS_FILTER_GRP_BASIC_TITLE")};U.prototype._getFieldGroupForProperty=function(t,e){return this._annoProvider?this._annoProvider._getFieldGroupForProperty(t,e):undefined};U.prototype._getGroupList=function(){return this._annoProvider?this._annoProvider.getGroupList():[]};U.prototype._getGroupMap=function(){return this._annoProvider?this._annoProvider.getGroupMap():{}};U.prototype._getMeasureMap=function(){return this._annoProvider?this._annoProvider.getMeasureMap():{}};U.prototype._getDimensionMap=function(){return this._annoProvider?this._annoProvider.getDimensionMap():{}};U.prototype.setSmartFilterContext=function(t){this._smartFilterContext=t};U.prototype._updateFilterBar=function(){var t=this._getAnnotationSettings();if(t&&t.filterList){var e=this._convertSettingsToConfig(t)}else{e={filterCompList:[]};this.getModel("_visualFilterConfigModel").setData(e);return}var i=this._getVariantConfig();if(i&&i.config){e.filterCompList.forEach(function(t){if(i.config[t.component.properties.parentProperty]){x(t,i.config[t.component.properties.parentProperty])}});this._oVariantConfig=e}this.unbindAggregation("content",true);this.getModel("_visualFilterConfigModel").setData(e);this.bindAggregation("content",{path:"_visualFilterConfigModel>/filterCompList",factory:function(t,e){var i=e.getProperty("component"),r=i?i.properties:undefined,a=this._resolveChartType(i?i.type:undefined);return this._createHeaderItems(e.sPath,a,r)}.bind(this),filters:new o("shownInFilterBar",M.EQ,true)});this.attachBrowserEvent("keyup",u.onKeyUpVisualFilter.bind(u));this.attachBrowserEvent("keydown",u.onKeyDownVisualFilter.bind(u,this._smartFilterContext));this.fireInitialized()};U.prototype._createHeaderItems=function(t,e,i){var r=this._createFilterItemOfType(e,i,true);r.data("isDialogFilterItem","false");var a=i.selectFilters&&i.selectFilters.SelectOptions,n=r.getInParameters(),s=[],l=this;if(n&&n.length>0){n.forEach(function(t){s.push({path:"_filter>/"+t.localDataProperty})})}r.addCustomData(new C({key:"sPath",value:t}));if(i.stringdate){r.addCustomData(new C({key:"stringdate",value:i.stringdate}))}if(l.getEntitySet()===r.getEntitySet()){var p=l._smartFilterContext.determineMandatoryFilterItems();if(p&&p.length>0){p.forEach(function(t){if(!t.data("isCustomField")){s.push({path:"_filter>/"+t.getName()})}})}}r.bindProperty("dimensionFilter",{path:"_filter>/"+r.getParentProperty(),type:new H});r.bindProperty("measureField",{path:"_visualFilterConfigModel>"+t+"/component/properties/measureField"});r.bindProperty("sortOrder",{path:"_visualFilterConfigModel>"+t+"/component/properties/sortOrder"});r.bindProperty("unitField",{path:"_visualFilterConfigModel>"+t+"/component/properties/measureField",formatter:function(){var t=l._getMeasureMap();var e=t[this.getEntitySet()][this.getMeasureField()];return e?e.fieldInfo.unit:""}});if(s&&s.length>0){r.bindProperty("dimensionFilterExternal",{parts:s,formatter:function(){var t=this.getInParameters()||[];var e=this.getParentProperty();var i,r;if(l.getEntitySet()===this.getEntitySet()){var n=l._smartFilterContext.determineMandatoryFilterItems();n.forEach(function(e){var i=e.getName();var r=t&&t.some(function(t){return t.localDataProperty===i});if(i.indexOf("$Parameter")===-1&&!r){t.push({localDataProperty:i,valueListProperty:i})}})}if(!(l.getEntitySet()===this.getEntitySet()&&l._smartFilterContext.getAnalyticBindingPath()!=="")&&(l._smartFilterContext.getAnalyticBindingPath()===""||l._smartFilterContext.getAnalyticBindingPath().indexOf("P_DisplayCurrency")!=-1)){var s=this.getMeasureField();var p=l.getModel();var d=p.getMetaModel();var f=d.getODataEntityType(l._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var h=d.getODataEntitySet(this.getEntitySet());var c=d.getODataProperty(f,s);var m=l.getProperty("displayCurrency");var y=c&&c[g.ISOCurrency];if(m&&y){var v=y.Path;for(var _=t.length-1;_>-1;_--){var F=t[_].valueListProperty;var C=t[_].localDataProperty;if(F===v){var P=l._smartFilterContext.getFilterData();if(!P[C]){r=d.getODataProperty(f,v);var I=r&&u.isPropertyNonFilterable(h,r.name);if(!I){i=new o({aFilters:[new o({path:v,operator:"EQ",value1:m,value2:undefined})],and:false})}}break}}}}if(this._chart instanceof sap.suite.ui.microchart.InteractiveDonutChart){this._inParameterFilterList=new o({aFilters:[],bAnd:true})}return l._getFiltersForFilterItem(t,e,i,v,a,this._inParameterFilterList)}})}else if(a&&a.length>0){var f=new o({aFilters:[],bAnd:true});for(var h in a){var c=a[h];f=this.fnAddSelectOptionsToFilters(c,f)}r.setProperty("dimensionFilterExternal",f)}if(r.attachFilterChange){r.attachFilterChange(this._onFilterChange,this)}if(r.attachTitleChange){r.attachTitleChange(this._onTitleChange,this)}var m=this._createTitleToolbar(i,r),y=new d({height:this._cellItemHeightNorth,items:[m]});var v=new d({height:this._cellItemHeightSouth,items:[r],visible:{path:"_visualFilterConfigModel>"+t+"/showChartOverlay",formatter:function(t){return!t}}});var _=r.getParentProperty();if(i.isParameter){_=u.getParameter(_)}var F="visualFilterBarInvisibleText"+_;F=this.getView().sId+"--"+F;var P=new A({id:F});if(this.getAriaLabelledBy().indexOf(F)===-1){this.addAriaLabelledBy(F)}F=this.getView().sId+"--"+w.getStableId({type:"VisualFilterBar",subType:"FilterItemContainer",sProperty:_});var I=new d({id:F,fieldGroupIds:["headerBar"],height:this._cellHeight,width:this.cellWidth+16+"px",items:[y,v,P]});y.addStyleClass("sapSmartTemplatesAnalyticalListPageVFTitle");v.addStyleClass("sapSmartTemplatesAnalyticalListPageVFChart");this.fireOnFilterItemAdded(r);return I};U.prototype.fnAddSelectOptionsToFilters=function(t,e){var i=new o({aFilters:[],bAnd:false});var r=this,a=t.PropertyName&&t.PropertyName.PropertyPath;t.Ranges.forEach(function(t){var e=t.Low&&t.Low.String,n=t.Sign&&t.Sign.EnumMember&&t.Sign.EnumMember.split("/")[1],o=t.Option&&t.Option.EnumMember&&t.Option.EnumMember.split("/")[1],s=t.High&&t.High.String;var l=r._getSelectOptionFilters(a,e,s,o,n);i.aFilters.push(l)});e.aFilters.push(i);return e};U.prototype._getAnnotationSettings=function(){return this._annoProvider?this._annoProvider.getVisualFilterConfig():null};U.prototype._convertSettingsToConfig=function(t,e){var i={filterCompList:[]};var r=this._getGroupList();var a={};for(var n=0;n<r.length;n++){var o=r[n];for(var s=0;s<o.fieldList.length;s++){var l=o.fieldList[s];a[l.name]={name:o.name,label:o.label}}}var p=this._getGroupMap();var u=p["_BASIC"];var d=[];if(u&&u.fieldList){for(var n=0;n<u.fieldList.length;n++){d.push(u.fieldList[n].name)}}var f=this._getMeasureMap(),h=t.filterList,c={};for(var n=0;n<h.length;n++){var m=h[n];var y=m.dimension.field;var v=f[m.collectionPath][m.measure.field];var _=false;if(v.fieldInfo[g.ISOCurrency]){_=true}var F={shownInFilterBar:m.selected,component:{type:m.type,properties:{sortOrder:m.sortOrder,measureField:m.measure.field,parentProperty:m.parentProperty?m.parentProperty:undefined}}};if(m.stringdate){F.component.properties.stringdate=m.stringdate}if(!e){var C={shownInFilterDialog:m.selected||d.indexOf(y)!=-1,group:a[m.parentProperty],component:{properties:{selectFilters:m.selectionVariant?m.selectionVariant:undefined,scaleFactor:m.scaleFactor,numberOfFractionalDigits:m.numberOfFractionalDigits,filterRestriction:m.filterRestriction,lazyLoadVisualFilter:this.getLazyLoadVisualFilter(),width:this.cellWidth+"px",height:this.compHeight+"rem",entitySet:m.collectionPath?m.collectionPath:this.getEntitySet(),dimensionField:y,dimensionFieldDisplay:m.dimension.fieldDisplay,dimensionFilter:m.dimensionFilter,unitField:v?v.fieldInfo.unit:"",isCurrency:_,isParameter:m.isParameter,isDropDown:m.isDropDown,isMandatory:m.isMandatory,outParameter:m.outParameter?m.outParameter:undefined,inParameters:m.inParameters?m.inParameters:undefined,textArrangement:m.displayBehaviour,chartQualifier:m.chartQualifier?m.chartQualifier:undefined,dimensionFieldIsDateTime:m.dimensionFieldIsDateTime,dimensionFieldIsDateTimeOffset:m.dimensionFieldIsDateTimeOffset,activeVisualFilters:false}}};x(F,C);i.filterCompList.push(F)}else{c[m.parentProperty]=F}}return e?c:i};U.prototype._setVariantModified=function(){if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true)}};U.prototype._checkMandatoryFilters=function(){var t=this._smartFilterContext.getFilterData();var e=this._smartFilterContext.determineMandatoryFilterItems();var i=false;for(var r=0;r<e.length;r++){if(t[e[r].getName()]===undefined){if(t._CUSTOM["sap.suite.ui.generic.template.customData"][e[r].getName()]===undefined){i=true;break}}}if(i){this._smartFilterContext.showAdaptFilterDialog("group")}};U.prototype._onFilterChange=function(t){this._setVariantModified();this.fireFilterChange();this._checkMandatoryFilters()};U.prototype._getFiltersForFilterItem=function(t,e,i,r,a,n){var s={},l=[],p=[],u=new o({aFilters:[],bAnd:true});if(t&&t.length>0){var g=function(t){t.sPath=h};for(var d=t.length-1;d>-1;d--){var f=t[d].localDataProperty,h=t[d].valueListProperty;if(a){for(var c=0;c<a.length;c++){var m=a[c];var y=m.PropertyName&&m.PropertyName.PropertyPath;if(p.indexOf(y)===-1){if(y===e){u=this.fnAddSelectOptionsToFilters(m,u);p.push(y)}else{var v=this._smartFilterContext.determineFilterItemByName(y);if(v&&(v.getVisibleInFilterBar()||v.getPartOfCurrentVariant())){var _=this._smartFilterContext.getFilters([y]);if(_&&_.length||l.indexOf(y)!==-1){continue}else{u=this.fnAddSelectOptionsToFilters(m,u);p.push(y)}}else{u=this.fnAddSelectOptionsToFilters(m,u);p.push(y)}}}}}if(f!==e&&l.indexOf(f)===-1){var v=this._smartFilterContext.determineFilterItemByName(f);if(v&&(v.getVisibleInFilterBar()||v.getPartOfCurrentVariant())){s=this._smartFilterContext.getFilters([f]);if(s&&s.length>0){if(s[0].aFilters){s[0].aFilters.forEach(g.bind(this))}else{g(s[0])}l.push(f);u.aFilters.push(s[0]);if(n){n.aFilters.push(s[0])}}}}}if(i){u.aFilters.push(i)}}else{if(a&&a.length){for(var c=0;c<a.length;c++){var m=a[c];u=this.fnAddSelectOptionsToFilters(m,u)}}}return u};U.prototype._getSelectOptionFilters=function(t,e,i,r,a){if(a==="E"){if(r!==M.EQ){O.error("Exclude sign is supported only with EQ operator");return}else{r=M.NE;a="I"}}if(r==="CP"){r=M.Contains;if(e.indexOf("*")!==-1){var n=e.indexOf("*");var s=e.lastIndexOf("*");if(n>-1){if(n===0&&s!==e.length-1){r=M.EndsWith;e=e.substring(1,e.length)}else if(n!==0&&s===e.length-1){r=M.StartsWith;e=e.substring(0,e.length-1)}else{e=e.substring(1,e.length-1)}}}}var l=new o({path:t,sign:a,operator:r,value1:e,value2:i});return l};U.prototype._createTitleToolbar=function(t,i){var r=this.getModel("@i18n");var a=i.getTitle(r);var n=new h({text:a.titleMD,titleStyle:T.TitleLevel.H6});if(i.getProperty("isMandatory")){n.addStyleClass("sapSmartTemplatesAnalyticalListPageRequired")}var o=new h({text:a.titleUnitCurr.length>1?"| "+a.titleUnitCurr:"",titleStyle:T.TitleLevel.H6,width:a.titleUnitCurr.length>1?"4.15rem":"0rem"});n.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleText");o.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleText");var p=this._smartFilterContext.determineFilterItemByName(t.parentProperty).getControl();this._smartFilterContext.ensureLoadedValueHelp(t.parentProperty);if(p){var g=u.getPropertyNameDisplay(this.getModel(),i.getEntitySet(),i.getDimensionField(),r),d=this.getModel("i18n").getResourceBundle(),y=p.getShowValueHelp&&p.getShowValueHelp()&&!t.dimensionFieldIsDateTimeOffset,v=p.getMetadata&&p.getMetadata().getName()==="sap.m.DateTimePicker",_=this.getFilterSettings()&&this.getFilterSettings().dateSettings?this.getFilterSettings().dateSettings:null,F=p instanceof D,P=false,M=null;if(t.isParameter){O=u.getParameter(i.getParentProperty())}else{O=i.getParentProperty()}if(!F&&p instanceof E&&_&&Object.keys(_).length>0&&i.getFilterRestriction()==="single"){if(_.useDateRange){P=true}else if(!_.useDateRange&&(_.selectedValues||_.fields&&Object.keys(_.fields).length>0&&!_.fields[O])){P=true;var V=this.getSmartFilterBarControlOptions(O);M=m.createDynamicDateRange(V)}}var S="";if(F&&!v){S="sap-icon://appointment-2"}else if(P){S="sap-icon://check-availability"}var b=t.isDropDown?"sap-icon://slim-arrow-down":"",A=y?"sap-icon://value-help":S||b,x,O,B;B=this.getView().sId+"--"+w.getStableId({type:"VisualFilterBar",subType:"ValueHelpButton",sProperty:O});var R=new f({id:B,text:{path:"_filter>/"+i.getParentProperty(),formatter:function(t){var e=i.getFilterRestriction();x=0;if(t){if(e==="single"&&!P){x=1}else{if(typeof t==="object"){if(t.value){x++}if(t.items&&t.items.length){x+=t.items.length}if(t.ranges&&t.ranges.length){x+=t.ranges.length}}else{x++}}}return x?"("+x+")":""}},icon:y||t.isDropDown||F||P?A:"",customData:[new C({key:"isF4Enabled",value:y||t.isDropDown||F||P?true:false})],visible:{path:"_filter>/"+i.getParentProperty(),formatter:function(e){if(y||t.isDropDown||F&&!v||P){return true}else{if(!e){return false}if(typeof e==="object"){if(e instanceof Date){return true}return e.value||e.items&&e.items.length||e.ranges&&e.ranges.length?true:false}return true}}},enabled:{path:"_visualFilterConfigModel>"+i.data("sPath")+"/showChartOverlay",formatter:function(t){return!t}},press:function(r){if(y){if(p.getParent().getParent()===null){this._smartFilterContext.addAggregation("dependents",p.getParent())}if(!this.getAssociateValueListsCalled()){this.setAssociateValueListsCalled(true);this._smartFilterContext.attachEventOnce("valueListAnnotationLoaded",function(){p.fireValueHelpRequest()});this._smartFilterContext.associateValueLists()}else{p.fireValueHelpRequest()}}else if(t.isDropDown){var a=this._isDimensionFieldFilterable(this.getModel(),t.entitySet,t.dimensionField),n=this.getModel("visualFilter")||this.getModel();c.createDropdown(r.getSource(),i,n,g,t,a)}else if(F&&!v){}else if(P){m.openDynamicDateRange(r.getSource(),i)}else{e.launchAllFiltersPopup(R,i,r.getSource().getModel("i18n"))}}.bind(this),layoutData:new I({priority:L.OverflowToolbarPriority.NeverOverflow}),tooltip:{path:"_filter>/"+i.getParentProperty(),formatter:function(){return u.getTooltipForValueHelp(y,g,d,x,F||P)}},ariaHasPopup:T.aria.HasPopup.Dialog})}var N=new s({design:L.ToolbarDesign.Transparent,width:this.cellWidth+"px",content:[n,o,new l,R,M]});N.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleToolbar");return N};U.prototype._isDimensionFieldFilterable=function(t,e,i){var r=t.getMetaModel(),a=r.getODataEntitySet(e),n=r.getODataEntityType(a.entityType),o=r.getODataProperty(n,i);return o["sap:filterable"]===undefined?true:o["sap:filterable"]};U.prototype.getTitleByFilterItemConfig=function(t,e,i){var r=t.component.properties;var a=r.entitySet;var n=this.getModel();var o=this.getModel("@i18n");if(!n){return""}var s=u.getPropertyNameDisplay(n,a,r.measureField,o);var l=u.getPropertyNameDisplay(n,a,r.dimensionField,o);if(!e){e=""}if(!i){i=""}var p=this.getModel("i18n").getResourceBundle();var g=p.getText("VIS_FILTER_TITLE_MD",[s,l]);var d=i+" "+e;d=d.trim();var f={titleMD:g,titleUnitCurr:d};return f};U.prototype._updateVisualFilterAria=function(t,e,i){var r=t.getItems();var a=this.getModel("i18n").getResourceBundle();var n=a.getText("VIS_FILTER_ITEM_ARIA");var o=r[0].getItems()[0].getContent()[0];var s=r[0].getItems()[0].getContent()[1];n+=" "+(s.getText().length>0?o.getText()+s.getText():o.getText());if(e.getProperty("isMandatory")){n+=" "+a.getText("VIS_FILTER_MANDATORY_PROPERTY_ARIA_LABEL")}if(i==="true"){n+=" "+a.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE")+" "+e._chart.getProperty("errorMessage");n+=" "+a.getText("VIS_FILTER_BAR_NAVIGATE_ARIA")}else{n+=" "+a.getText("VIS_FILTER_BAR_NAVIGATE_ARIA")+" "+a.getText("VIS_FILTER_ACCESS_FIELDS_ARIA")}r[r.length-1].setText(n)};U.prototype._onTitleChange=function(t){var e=t.getSource().getParent().getParent();var i=e.getItems()[e.getItems().length-2].getItems()[0];if(i.data("sOverlay")!=="true"){var r=e.getItems()[0].getItems()[0].getContent()[0];var a=e.getItems()[0].getItems()[0].getContent()[1];var n=this.getModel("i18n");var o=this.getModel("@i18n");if(!n){return""}var s=n.getResourceBundle();if(t.getSource().getProperty("isMandatory")){r.addStyleClass("sapSmartTemplatesAnalyticalListPageRequired")}var l=t.getSource().getTitle(o);r.setText(l.titleMD);var p=l.titleUnitCurr==""?l.titleQuickInfo||l.titleMD:s.getText("VIS_FILTER_TITLE_MD_WITH_UNIT_CURR",[l.titleQuickInfo||l.titleMD,l.titleUnitCurr]);r.setTooltip(p);a.setText(l.titleUnitCurr.length>0?"| "+l.titleUnitCurr:"");a.setTooltip("");var u=l.titleUnitCurr.split(" ");if(l.titleUnitCurr==""){a.setVisible(false)}else{a.setVisible(true);var g=u.length>1?"4.15rem":"2.4rem";a.setWidth(g)}}this._updateVisualFilterAria(e,i,i.data("sOverlay"))};U.prototype._getSupportedFilterItemList=function(){if(!this._supportedFilterItemList){this._supportedFilterItemList=[{type:"Bar",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroBar",iconLink:"sap-icon://horizontal-bar-chart",textKey:"VISUAL_FILTER_CHART_TYPE_BAR"},{type:"Donut",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroDonut",iconLink:"sap-icon://donut-chart",textKey:"VISUAL_FILTER_CHART_TYPE_Donut"},{type:"Line",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroLine",iconLink:"sap-icon://line-charts",textKey:"VISUAL_FILTER_CHART_TYPE_Line"}]}return this._supportedFilterItemList};U.prototype._getSupportedFilterItemMap=function(){if(!this._supportedFilterItemMap){this._supportedFilterItemMap={};var t=this._getSupportedFilterItemList();for(var e=0;e<t.length;e++){var i=t[e];this._supportedFilterItemMap[i.type]=i}}return this._supportedFilterItemMap};U.prototype._resolveChartType=function(t){var e=this._getSupportedFilterItemMap();var i=e[t];if(!i){var r;for(r in e){i=e[r];break}O.error('Could not resolve the filter component type: "'+t+'", falling back to '+r);t=r}return t};U.prototype._createFilterItemOfType=function(t,e,i){var r;var a=w.getStableId({type:i?"VisualFilterBar":"VisualFilterDialog",subType:"FilterItemMicroChart",sProperty:e.parentProperty});a=this.getView().sId+"--"+a;if(t===N){r=new y(a,e)}else if(t===R){r=new v(a,e)}else if(t===B){r=new _(a,e)}r.setSmartFilterId(this.getSmartFilterId());r.setModel(this.getModel("i18n"),"i18n");r.setModel(this.getModel("_templPriv"),"_templPriv");if(!this._smartFilterContext.isDialogOpen()){r.setModel(this.getModel("_filter"),"_filter");r.setModel(this.getModel("_visualFilterConfigModel"),"_visualFilterConfigModel")}r.setModel(this.getModel());var n=this.getModel("visualFilter");if(n){r.setModel(n,"visualFilter")}return r};U.prototype.getConfig=function(t){var e=this.getModel("_visualFilterConfigModel").getData(),i={};if(!e){return{filterCompList:[]}}var r=0;var a=sap.ui.getCore().byFieldGroupId("headerBar");for(var n=0;n<e.filterCompList.length;n++){var o=e.filterCompList[n];if(t){i[o.component.properties.parentProperty]={shownInFilterBar:o.shownInFilterBar,shownInFilterDialog:o.shownInFilterDialog,component:{type:o.component.type,properties:{measureField:o.component.properties.measureField,sortOrder:o.component.properties.sortOrder,parentProperty:o.component.properties.parentProperty}}}}else{if(!o.shownInFilterBar){continue}var s=a[r];if(!s){O.error("The configured selected filter bar items do not correspond to the actual filter bar items.  Could be an error during initialization, e.g. a chart class not found");return{filterCompList:[]}}r++;if(s._chart){var l=s;o.component.properties=l.getP13NConfig()}}}return t?i:e};U.prototype.setSmartVariant=function(t){this.setAssociation("smartVariant",t);if(t){var e=new a({type:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",keyName:"persistencyKey"});e.setControl(this)}this._oVariantManagement=this._getVariantManagementControl(t);if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(e);this._oVariantManagement.initialise(this._variantInitialised,this);this._oVariantManagement.attachSave(this._onVariantSave,this)}else if(t){if(typeof t==="string"){O.error("Variant with id="+t+" cannot be found")}else if(t instanceof sap.ui.core.Control){O.error("Variant with id="+t.getId()+" cannot be found")}}else{O.error("Missing SmartVariant")}};U.prototype._getVariantManagementControl=function(t){var e=null;if(t){e=typeof t=="string"?sap.ui.getCore().byId(t):t;if(e&&!(e instanceof n)){O.error("Control with the id="+t.getId?t.getId():t+" not of expected type");return null}}return e};U.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD"}};U.prototype._onVariantSave=function(){if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant={config:this.getConfig(true)}}};U.prototype.applyVariant=function(t,e){this._oCurrentVariant=t;if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant=null}if(this._oCurrentVariant&&this._oCurrentVariant.config&&this._oCurrentVariant.config.filterCompList){this._oCurrentVariant.config=null}if(this._oCurrentVariant&&this._oCurrentVariant.config==null){var i=this._getAnnotationSettings();if(i&&i.filterList){this._oCurrentVariant.config=this._convertSettingsToConfig(i,true)}}this._updateFilterBar();if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(false)}};U.prototype._getVariantConfig=function(){return this._oCurrentVariant};U.prototype.fetchVariant=function(){if(!this._oCurrentVariant||this._oCurrentVariant=="STANDARD"){var t=this._getAnnotationSettings();if(t&&t.filterList){this._oCurrentVariant={config:this._convertSettingsToConfig(t,true)};return this._oCurrentVariant}else{return{config:null}}}return{config:this.getConfig(true)}};U.prototype._getStandardVariantConfig=function(){var t=this._getAnnotationSettings();var e=this._convertSettingsToConfig(t);return e};U.prototype.updateVisualFilterBindings=function(t,e){if(e){for(var i in this.filterChartList){var r=this.filterChartList[i];if(r._chart){r._updateBinding();r._bAllowBindingUpdateOnPropertyChange=t===true}}}else{var a=sap.ui.getCore().byFieldGroupId("headerBar");for(var i=0;i<a.length;i++){if(a[i]._chart){a[i]._updateBinding();a[i]._bAllowBindingUpdateOnPropertyChange=t===true}}}};U.prototype.getView=function(){if(!this._oView){var t=this.getParent();while(t){if(t instanceof sap.ui.core.mvc.View){this._oView=t;break}t=t.getParent()}}return this._oView};U.prototype.addVisualFiltersToBasicArea=function(t){var e=x({},this.getModel("_visualFilterConfigModel").getData()),i=t&&t.constructor===Array&&t.length?t.length:0,r=0;if(!e){O.error("Could not add filter to basic area. No config found!");return false}else if(!i){O.error("Improper parameter passed. Pass an array of properties.");return false}else{for(var a=0;a<e.filterCompList.length;a++){var n=e.filterCompList[a];if(t.indexOf(u.readProperty(n.component.properties.parentProperty))!==-1&&!n.shownInFilterBar){n.shownInFilterBar=true;n.shownInFilterDialog=true;r++}}if(r){this.getModel("_visualFilterConfigModel").setData(e);return true}else{O.info("Filters already present in visual filter basic area");return false}}};U.prototype.getSmartFilterBarControlOptions=function(t){var e=this._smartFilterContext.getAggregation("filterGroupItems").filter(function(e){return e.getName()===t})[0];return e.getControl().getOptions()};return U},true);
//# sourceMappingURL=SmartVisualFilterBar.js.map