sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/genericUtilities/FeError"],function(t,e,a){"use strict";var i="AnalyticalListPage.util.AnnotationHelper";var n=new e(i).getLogger();var r=t.extend("sap.suite.ui.generic.template.AnalyticalListPage.util.AnnotationHelper");r.getDetailEntitySet=function(t){var e=t.getObject();var a=t.getModel();var i=a.getProperty("/metaModel");return i.createBindingContext(i.getODataEntitySet(e,true))};r.resolveMetaModelPath=function(t){var e=t.getObject();var a=t.getModel();var i=a.getProperty("/metaModel");return i.createBindingContext(e)};r.createWorkingContext=function(t){var e=t.getObject(),n=e.settings,o=t.getModel(),s=o.getProperty("/metaModel"),l=s.getODataEntitySet(e.entitySet),c=s.getODataEntityType(l.entityType),u=n.uniqueHierarchyNodeIDForTreeTable,f="",p={};f=c.$path+"/com.sap.vocabularies.UI.v1.SelectionPresentationVariant"+(n&&n.qualifier?"#"+n.qualifier:"");p.selectionPresentationVariant=s.getObject(f);p.selectionPresentationVariantQualifier=f.split("#")[1]||"";p.selectionPresentationVariantPath=f;if(u&&e.templateSpecific.tableSettings.type==="TreeTable"&&c&&c.hasOwnProperty("property")&&c.property.length){var h=[],g="",m=c.property;for(var v=0;v<m.length;v++){if(m[v].hasOwnProperty("sap:hierarchy-node-for")){g=m[v]["sap:hierarchy-node-for"];break}}for(var v=0;v<m.length;v++){var P=m[v].name!==u&&m[v].name!==g;if(!m[v].hasOwnProperty("com.sap.vocabularies.Analytics.v1.Measure")){if(m[v].hasOwnProperty("sap:attribute-for")&&P){if(m[v]["sap:attribute-for"]!==u&&m[v]["sap:attribute-for"]!==g){h.push(m[v]["name"])}}else if(P){h.push(m[v]["name"])}}}p.ignoredFields=h.toString()}f=r.getAnnotationfromSPV(c,f,p.selectionPresentationVariant,p.selectionPresentationVariantPath,n?n.qualifier:"","PresentationVariant");p.presentationVariant=s.getObject(f);p.presentationVariantPath=f;p.presentationVariantQualifier=f.split("#")[1]||"";p.initialExpansionLevel=p.presentationVariant&&p.presentationVariant.InitialExpansionLevel&&p.presentationVariant.InitialExpansionLevel.Int;if(n.qualifier&&!p.presentationVariant){var b=new a(i,"Error in manifest.json: Not SelectionPresentationVariant or PresentationVariant found for qualifier: "+n.qualifier,"./manifest.json");throw b}if(p.presentationVariant&&p.presentationVariant.Visualizations){p.presentationVariant.Visualizations.forEach(function(t){var e="/"+t.AnnotationPath.slice(1);if(e.indexOf("com.sap.vocabularies.UI.v1.LineItem")>-1){f=c.$path+e;p.lineItem=s.getObject(f);p.lineItemPath=f;p.lineItemQualifier=f.split("#")[1]||"";p.lineItemCriticality=r._resolveLineItemCriticality(p.lineItem,p.lineItemQualifier)}if(!n.chartPresentationQualifier&&e.indexOf("com.sap.vocabularies.UI.v1.Chart")>-1){f=c.$path+e;p.chart=s.getObject(f);p.chartPath=f;p.chartQualifier=f.split("#")[1]||""}})}if(!p.lineItem){f=c.$path+"/com.sap.vocabularies.UI.v1.LineItem";p.lineItem=s.getObject(f);p.lineItemPath=f;p.lineItemQualifier="";p.lineItemCriticality=r._resolveLineItemCriticality(p.lineItem,p.lineItemQualifier)}if(n&&n.chartPresentationQualifier){var I=c.$path+"/com.sap.vocabularies.UI.v1.PresentationVariant"+"#"+n.chartPresentationQualifier;var y=s.getObject(I);if(!y){var b=new a(i,"Error in manifest.json: No PresentationVariant found for qualifier: "+n.chartPresentationQualifier,"./manifest.json");throw b}if(y&&!y.Visualizations){var b=new a(i,"Error: No Visualizations found in PresentationVariant for chartPresentationVariantQualifier: "+n.chartPresentationQualifier,"./manifest.json");throw b}else{y.Visualizations.forEach(function(t){var e="/"+t.AnnotationPath.slice(1);if(e.indexOf("com.sap.vocabularies.UI.v1.Chart")>-1){f=c.$path+e;p.chart=s.getObject(f);p.chartPath=f;p.chartPresentationVariantQualifier=n.chartPresentationQualifier;p.chartQualifier=f.split("#")[1]||""}});if(!p.chart){var b=new a(i,"Error: No chart annotations found with chartPresentationVariantQualifier "+n.chartPresentationQualifier,"./manifest.json");throw b}}}if(!n.chartPresentationQualifier&&!p.chart){f=c.$path+"/com.sap.vocabularies.UI.v1.Chart";p.chart=s.getObject(f);p.chartPath=f;p.chartQualifier=""}p.tableChartTabs=[];var A,V,v,d,O;V=e&&e.manifest&&e.manifest["sap.ui.generic.app"]&&e.manifest["sap.ui.generic.app"].pages&&e.manifest["sap.ui.generic.app"].pages[0].component&&e.manifest["sap.ui.generic.app"].pages[0].component.settings&&e.manifest["sap.ui.generic.app"].pages[0].component.settings.quickVariantSelectionX&&e.manifest["sap.ui.generic.app"].pages[0].component.settings.quickVariantSelectionX.variants;for(v in V){O={};A="";d={};d.key=V[v].key;d.variantAnnotationPath=V[v].annotationPath;d.variantQualifier=d.variantAnnotationPath.split("#")[1]||"";if(!!V[v].entitySet){d.entitySet=V[v].entitySet;l=s.getODataEntitySet(d.entitySet);if(l){c=s.getODataEntityType(l.entityType)}else{continue}}O=c[d.variantAnnotationPath];if(O&&O.PresentationVariant){var j;if(O.PresentationVariant.Path){var C=O.PresentationVariant.Path.split("@")[1];j=C&&c[C];d.presentationVariantQualifier=C.split("#")[1]||""}else{j=O.PresentationVariant}A=j.Visualizations&&j.Visualizations[0].AnnotationPath}else if(O&&O.Visualizations){A=O.Visualizations[0].AnnotationPath}if(A){var L="/"+A.slice(1);if(A.indexOf("com.sap.vocabularies.UI.v1.Chart")>-1){d.smartControl="chart";d.chartAbsolutePath=c.$path+L}else if(A.indexOf("com.sap.vocabularies.UI.v1.LineItem")>-1){d.smartControl="table";f=c.$path+L;d.lineItem=s.getObject(f);d.lineItemPath=f;d.lineItemQualifier=f.split("#")[1]||""}}if(!(d.chartAbsolutePath||d.lineItemPath)){f=c.$path+"/com.sap.vocabularies.UI.v1.LineItem";d.lineItem=s.getObject(f);d.lineItemPath=f;d.lineItemQualifier=""}d.controlQualifier=A&&A.split("#")[1]||"";p.tableChartTabs.push(d)}o.setProperty("/workingContext",p);return"/workingContext"};r.hasDeterminingActionsForALP=function(t,e,a,i){if(a&&i&&i["sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"]&&r._hasCustomDeterminingActionsInALP(a,i["sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"]["sap.ui.generic.app"])){return true}for(var n=0;n<t.length;n++){if((t[n].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t[n].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")&&t[n].Determining&&t[n].Determining.Bool==="true"){return true}}for(var n=0;n<e.length;n++){if((e[n].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e[n].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")&&e[n].Determining&&e[n].Determining.Bool==="true"){return true}}return false};r.hasGlobalActionsForALP=function(t,e,a,i){if(a&&i&&i["sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"]&&this._hasCustomGlobalActions(a,i["sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"]["sap.ui.generic.app"])){return true}return false};r.getAreaShrinkRatio=function(t,e,a,i){var n=r.hasGlobalActionsForALP(t,e,a,i);if(n){return"0:3:0.7"}else{return"0:3:0.1"}};r._hasCustomDeterminingActionsInALP=function(t,e){if(e&&e[t]){var a=e[t];if(a.Actions){for(var i in a.Actions){if(a.Actions[i].determining){return true}}}}return false};r._hasCustomGlobalActions=function(t,e){if(e&&e[t]){var a=e[t];if(a.Actions){for(var i in a.Actions){if(a.Actions[i].global){return true}}}}return false};r.getFilterableKPIs=function(t){var e=t.getModel();var a={};var i=t.getObject();a.filterableKPIs=[];a.globalKPIs=[];if(i){for(var n=0;n<Object.keys(i).length;n++){if(i[Object.keys(i)[n]]["filterable"]){a.filterableKPIs.push(i[Object.keys(i)[n]])}else{a.globalKPIs.push(i[Object.keys(i)[n]])}}}e.setProperty("/kpiContext",a);return"/kpiContext"};r.generateKPIToolbarId=function(t){for(var e=0;Object.keys(t).length;e++){if(t[Object.keys(t)[e]]["filterable"]){return"template::KPITagContainer::filterableKPIs"}else{return"template::KPITagContainer::globalKPIs"}}};r.generateKPITagID=function(t){return"template::KPITag::"+t.model+"::"+t.qualifier};r._resolveLineItemCriticality=function(t,e){if(t){var a;if(e){a=t["com.sap.vocabularies.UI.v1.Criticality#"+e]}else{a=t["com.sap.vocabularies.UI.v1.Criticality"]}if(!a){return""}else{return a.Path?'\\{"Path": "'+a.Path+'"\\}':'\\{"EnumMember": "'+a.EnumMember+'"\\}'}}else{n.error("Please add LineItem annotation for your application");return undefined}};r.getAnnotationfromSPV=function(t,e,a,i,n,r){if(a&&a[r]){e=a[r].Path||a[r].AnnotationPath||i+"/"+r;if(e.indexOf("@")===0){e=t.$path+"/"+e.substr(1)}}else{e=t.$path+"/com.sap.vocabularies.UI.v1."+r+(n?"#"+n:"")}return e};r.createSVAnnotation=function(t,e,a){var i=t.$path+"/com.sap.vocabularies.UI.v1.SelectionPresentationVariant"+(a?"#"+a:""),n=e.getObject(i),r=i;i=this.getAnnotationfromSPV(t,i,n,r,a,"SelectionVariant");var o=e.getObject(i);return o};return r},true);
//# sourceMappingURL=AnnotationHelper.js.map