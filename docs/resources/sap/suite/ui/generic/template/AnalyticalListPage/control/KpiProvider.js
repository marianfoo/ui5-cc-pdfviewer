sap.ui.define(["sap/suite/ui/generic/template/AnalyticalListPage/util/KpiUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/CriticalityUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(t,i,e,a){"use strict";var r=new a("AnalyticalListPage.controller.KpiProvider").getLogger();var n=function(t){this._getDataFromAnnotations(t)};n.prototype._getDataFromAnnotations=function(i){var a=this;var n=i._oModel;var o=n.getMetaModel();var l=o.getODataEntitySet(i.getEntitySet());if(!l){r.error("KPI error details - Incorrect entity set");return}var c=o.getODataEntityType(l.entityType);var s=i.getQualifier();var u,P,g,h;var p={};var f="com.sap.vocabularies.UI.v1.KPI#"+s;var v=c[f];if(v){if(v["DataPoint"]){h=this.getPathOrAnnotationPath(v["DataPoint"],true)}if(v["SelectionVariant"]){g=this.getPathOrAnnotationPath(v["SelectionVariant"],true)}if(v["ShortDescription"]){var y=t.getPrimitiveValue(v["ShortDescription"])}var m=v.ID;var C=v.Detail&&v.Detail.SemanticObject;var d=v.Detail&&v.Detail.DefaultPresentationVariant;var D=v.Detail&&v.Detail.Action;p.kpiAnnotationPath=f}else{var V="com.sap.vocabularies.UI.v1.SelectionPresentationVariant#"+s;p.selectionPresentationVariantPath=V;var A=c[V];if(!A){r.error("KPI error details - SelectionPresentationVariant does not have Path.");return}if(A.SelectionVariant){g=this.getPathOrAnnotationPath(A.SelectionVariant)}if(A.PresentationVariant){var S=this.getPathOrAnnotationPath(A.PresentationVariant)}if(!S){r.error("KPI error details - PresentationVariant does not have Path.");return}var I=c[S];var O=I&&I.Visualizations;if(O){O.forEach(function(t){if(t.AnnotationPath.indexOf("DataPoint")>0){h=a.getPathOrAnnotationPath(t)}})}}if(!h){r.error("KPI error details - DataPoint does not have Path.");return}P=c[h];if(!g){r.error("KPI error details - SelectionVariant does not have a path")}u=c[g];p.dataPointPath=h;p.selectionVariantPath=g;var k=P.Value.Path;var L=u&&u.SelectOptions,K=u&&u.Parameters;var _=o.getODataProperty(c,P.Value.Path);var E=t.getUnitofMeasure(n,_);var b=P.Title,M=t.getPrimitiveValue(b);if(M===undefined){M=""}this.kpiConfig={entityTypeProperty:_,props:{title:M,value:k,unitOfMeasure:E},entitySet:l,dataPoint:P,selectionVariant:u,selectOptions:L,parameters:K,kpiPropertyPath:p};if(v){this.kpiConfig.bIsKpiAnnotaion=true}if(C&&D&&m){this.kpiConfig.navigation={semanticObject:C.String,action:D.String,kpiId:m.String}}if(v&&!d){this.kpiConfig.oDefaultPV=false}if(y){this.kpiConfig.props.shortDescription=y}var T=e.readProperty(P,"Criticality"),U=T&&T.EnumMember?t.getPrimitiveValue(T):undefined,F=T&&T.Path?this._getCriticalityParameters(T):undefined;if(U){this.kpiConfig.criticality={criticalityType:U}}else if(F){this.kpiConfig.criticality={criticalityPath:F}}else{var w=!U&&e.readProperty(P,"CriticalityCalculation.ImprovementDirection.EnumMember")?t.getPrimitiveValue(P.CriticalityCalculation.ImprovementDirection):undefined;if(w){var H=this._getCriticalityParameters(P.CriticalityCalculation.ToleranceRangeLowValue),R=this._getCriticalityParameters(P.CriticalityCalculation.ToleranceRangeHighValue),j=this._getCriticalityParameters(P.CriticalityCalculation.DeviationRangeLowValue),x=this._getCriticalityParameters(P.CriticalityCalculation.DeviationRangeHighValue);this.kpiConfig.criticalityCalculation={improveDirection:w,toleranceLow:H,toleranceHigh:R,deviationLow:j,deviationHigh:x}}}};n.prototype._getCriticalityParameters=function(i){if(i){if(i.Path){return{path:"/"+i.Path}}else{return t.getPrimitiveValue(i)}}};n.prototype.getCriticalityFromEnum=function(t){return i.getCriticalityIndicatorFromEnum(t)};n.prototype.getConfig=function(){return this.kpiConfig};n.prototype.getImproveDirection=function(t,e,a,r,n){i.setVals(t,e,a,r,n);return i[this.kpiConfig.criticalityCalculation.improveDirection]()};n.prototype.getPathOrAnnotationPath=function(t,i){var e=i?t.Path:t.Path||t.AnnotationPath;if(/^@/.test(e)){e=e.slice(1)}return e};return n},true);
//# sourceMappingURL=KpiProvider.js.map