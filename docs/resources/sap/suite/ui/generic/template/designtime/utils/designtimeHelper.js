sap.ui.define(["sap/base/util/extend","sap/base/util/deepExtend","sap/base/util/merge"],function(e,t,r){"use strict";var n={};var i=[];var a=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("URLParsing");var o=a.parseParameters(document.location.search);function s(){var e=[];function t(t){if(n[t.getId()]){return}var r={};n[t.getId()]=r;r.designTimePromise=t.getMetadata().loadDesignTime(t);e.push(r.designTimePromise);r.designTimePromise.then(function(e){r.designTime=e})}function r(e){return!e||!e.id||n[e.id]?e:e.parentNode&&r(e.parentNode)}document.querySelectorAll(".sapUiXMLView").forEach(function(e){var n=sap.ui.getCore().byId(e.id);if(!n||!(n instanceof sap.ui.core.mvc.XMLView)||!(n.getController()instanceof sap.suite.ui.generic.template.lib.TemplateViewController)){return}i.push(n);n.findAggregatedObjects(true).forEach(t);e.addEventListener("DOMNodeInserted",function(e){var n=r(e.relatedNode);var i=n&&sap.ui.getCore().byId(n.id);if(i){i.findAggregatedObjects(true).forEach(t)}})});return Promise.all(e)}function g(e){return o[e]&&o[e][0].toLowerCase()}function c(e){var t=[e];while(!(e instanceof sap.ui.core.mvc.XMLView)){e=e.getParent();if(!e){return}t.push(e)}if(!(e.getController()instanceof sap.suite.ui.generic.template.lib.TemplateViewController)){return}return t}function u(e,t){return t===e||t.findAggregatedObjects&&t.findAggregatedObjects(true).includes(e)}function d(e,t){var r=Object.keys(n[e.sAncestorId].designTime.aggregations);return r.find(function(r){var n=e.oAncestor.getMetadata().getAggregation(r);var i=n&&n.get(e.oAncestor)||e.oAncestor.getAggregation(r);if(Array.isArray(i)){return i.find(u.bind(null,t))}else{return i&&u(t,i)}})}function f(e){if(e instanceof sap.ui.core.mvc.XMLView){return}var i=n[e.getId()];if(!i||i.designTimePromise&&!i.designTime){return}var a=t({},i.designTime);var o=c(e);if(!o){return}o.shift();o.pop();var s=o.map(function(e){return{oAncestor:e,sAncestorId:e.getId()}});s=s.filter(function(e){return n[e.sAncestorId]&&n[e.sAncestorId].designTime&&n[e.sAncestorId].designTime.aggregations});s.forEach(function(t){t.sAggregation=d(t,e)});i.pedigree=s.filter(function(e){return n[e.sAncestorId]&&n[e.sAncestorId].designTime.aggregations&&n[e.sAncestorId].designTime.aggregations[e.sAggregation]&&n[e.sAncestorId].designTime.aggregations[e.sAggregation].propagateMetadata});a=i.pedigree.reduce(function(t,i){return r(t,n[i.sAncestorId].designTime.aggregations[i.sAggregation].propagateMetadata(e,i.oAncestor))},a);return a}function l(e,t){var r=f(e);if(!r){return}var n=Object.create(null);if(r.actions&&typeof r.actions==="object"){n.actions=Object.create(null);for(var i in r.actions){n.actions[i]=t&&t.actions&&t.actions.includes(i)?r.actions[i]:null}}else{n.actions=r.actions}n.aggregations=Object.create(null);for(var a in r.aggregations){n.aggregations[a]={actions:Object.create(null)};for(var i in r.aggregations[a].actions){n.aggregations[a].actions[i]=t&&t.aggregations&&t.aggregations[a]&&t.aggregations[a].actions&&t.aggregations[a].actions.includes(i)?r.aggregations[a].actions[i]:null}}n.properties=Object.create(null);for(var o in e.getMetadata().getAllProperties()){n.properties[o]={ignore:!t||!t.properties||!t.properties.includes(o)||r.properties&&r.properties[o]&&r.properties[o].ignore}}return n}function p(e){return s().then(function(){var t={aggregations:{content:{propagateMetadata:function(t){return t.getMetadata().getElementName&&l(t,e[t.getMetadata().getElementName()])}}},tool:{start:function(e){var t=e.getParent().getAppComponent();t.uiAdaptationStarted()},stop:function(e){var t=e.getParent().getAppComponent();t.uiAdaptationStopped()}}};return i.reduce(function(t,n){return r(l(n,e[n.getMetadata().getElementName()]),t)},t)})}function m(e){return e.reduce(function(e,t){if(!t){return e}if(!e){return t}if(Array.isArray(t)!==Array.isArray(e)){return true}if(Array.isArray(e)){return e.concat(t)}else{for(var r in t){e[r]=m([e[r],t[r]])}return e}})}return{getMergedAllowList:m,getViewDesignTime:p,getRtaModeValue:g}});
//# sourceMappingURL=designtimeHelper.js.map