// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/library","sap/ui/thirdparty/jquery","sap/ushell/resources","sap/ushell/utils/WindowUtils","sap/ushell/components/HomepageManager"],function(e,t,i,jQuery,o,n,s){"use strict";var a=i.PlacementType;var r=function(){this.oEventBus=sap.ui.getCore().getEventBus();this.init=function(e){this.oModel=e}};r.prototype._activate=function(){this.oModel.setProperty("/tileActionModeActive",true);this.aOrigHiddenGroupsIds=this.getHomepageManager().getCurrentHiddenGroupIds(this.oModel);var e=sap.ui.getCore().byId("dashboardGroups");e.addLinksToUnselectedGroups();var t=sap.ui.getCore().byId("ActionModeBtn");if(t){t.setText(o.i18n.getText("exitEditMode"));if(t.setSelected){t.setSelected(true)}}this.oEventBus.publish("launchpad","actionModeActive")};r.prototype._deactivate=function(){this.oModel.setProperty("/tileActionModeActive",false);this.oEventBus.publish("launchpad","actionModeInactive",this.aOrigHiddenGroupsIds);var e=sap.ui.getCore().byId("TileActions");if(e!==undefined){e.destroy()}var t=sap.ui.getCore().byId("ActionModeBtn");if(t){t.setText(o.i18n.getText("activateEditMode"));if(t.setSelected){t.setSelected(false)}}};r.prototype.toggleActionMode=function(e,t,i){i=i||[];var o=i.filter(function(e){return e.getVisible()});var n={group:o[e.getProperty("/topGroupInViewPortIndex")],restoreLastFocusedTile:true};if(e.getProperty("/tileActionModeActive")){this._deactivate();var s=jQuery(".sapUshellTileContainerHeader[tabindex=0]");if(s.length){var a=jQuery(s[0]).closest(".sapUshellTileContainer");if(a.length){n.restoreLastFocusedTileContainerById=a[0].id}}}else{this._activate()}this.oEventBus.publish("launchpad","scrollToGroup",n)};r.prototype.activateGroupEditMode=function(e){var t=jQuery(e.getDomRef()).find(".sapUshellTileContainerContent");t.addClass("sapUshellTileContainerEditMode")};r.prototype.getHomepageManager=function(){if(!this.oHomepageManager){this.oHomepageManager=s.prototype.getInstance()}return this.oHomepageManager};r.prototype._filterActions=function(e,t){var i=t.getModel();var o=t.getParent().getBindingContext().getPath();if(i.getProperty(o+"/isGroupLocked")){["tileSettingsBtn","linkSettingsBtn","ConvertToTile","ConvertToLink","moveTile_action"].forEach(function(t){e=e.filter(function(e){return e.id!==t})})}if(this.getHomepageManager().getPersonalizableGroups().length<2){e=e.filter(function(e){return e.id!=="moveTile_action"})}return e};r.prototype._openActionsMenu=function(i){var n=i.getSource();var s=n.getBindingContext().getObject().object;var r=this.getHomepageManager().getTileActions(s);r=this._filterActions(r,n);jQuery(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");var l=jQuery(n.getDomRef()).find(".sapUshellTileActionLayerDiv");l.addClass("sapUshellTileActionLayerDivSelected");var c=[];r.forEach(function(i){if(!i.press&&!i.targetURL){e.warning("Invalid Tile action discarded: "+JSON.stringify(i));return}c.push(new t({text:i.text,icon:i.icon,press:this._handleActionPress.bind(this,i,n)}))}.bind(this));if(c.length===0){c.push(new t({text:o.i18n.getText("tileHasNoActions"),enabled:false}))}var d=n.getActionSheetIcon?n.getActionSheetIcon():undefined;if(!d){var p=sap.ui.getCore().byId(n.getId()+"-action-more");d=p||n}var u=sap.ui.getCore().byId("TileActions");if(!u){sap.ui.require(["sap/m/ActionSheet"],function(e){u=new e("TileActions",{placement:a.Bottom,afterClose:function(){jQuery(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");var e=sap.ui.getCore().getEventBus();e.publish("dashboard","actionSheetClose",n)}});this._openActionSheet(u,c,d)}.bind(this))}else{this._openActionSheet(u,c,d)}};r.prototype._openActionSheet=function(e,t,i){t=t||[];e.destroyButtons();t.forEach(function(t){e.addButton(t)});e.openBy(i)};r.prototype._handleActionPress=function(e,t){if(e.press){e.press(t)}else if(e.targetURL){if(e.targetURL.indexOf("#")===0){hasher.setHash(e.targetURL)}else{n.openURL(e.targetURL,"_blank")}}};return new r},true);
//# sourceMappingURL=ActionMode.js.map