//Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/EventHub","sap/ushell/Config","sap/ushell/utils/HttpClient","sap/base/util/ObjectPath"],function(e,t,r,a){"use strict";var n={};var s="/UI2/Fiori2LaunchpadHome";n.getData=function(){if(!this.oPageSetPromise){this.oPageSetPromise=new Promise(function(e,t){var n="PageSets('%2FUI2%2FFiori2LaunchpadHome')"+"?$expand=Pages/PageChipInstances/ChipInstanceBags/ChipInstanceProperties,"+"Pages/PageChipInstances/Chip"+"&$format=json";var s={"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0","Accept-Language":sap.ui.getCore().getConfiguration().getLanguage()||"",Accept:"application/json, text/plain"};var i=sap.ushell.Container.getUser().getLanguage();if(i){s["sap-language"]=i}var o=sap.ushell.Container.getLogonSystem();var u=o&&o.getClient();if(u){s["sap-client"]=u}var c=window["sap-ushell-config"].services&&window["sap-ushell-config"].services.PageBuilding||{};var l=(a.get("config.services.pageBuilding.baseUrl",c.adapter)||"").replace(/\/?$/,"/");var p=new r(l,{headers:s});p.get(n).then(function(t){e(this.parseData.bind(this)(t))}.bind(this)).catch(t)}.bind(this))}return this.oPageSetPromise};n.isImportEnabled=function(){return sap.ushell.Container.getServiceAsync("UserInfo").then(function(e){var t=e.getUser();var r=t.getImportBookmarksFlag();switch(r){case"done":case"dismissed":case"not_required":return false;case null:return this.getData().then(function(r){var a=!!r.length;var n=a?"pending":"not_required";t.setImportBookmarksFlag(n);e.updateUserPreferences();t.resetChangedProperty("importBookmarks");return a});default:return true}}.bind(this))};n.parseData=function(e){try{var r=JSON.parse(e.responseText);if(r&&r.d){r=r.d}var a=r.configuration&&JSON.parse(r.configuration)||{};var n=a.hiddenGroups||[];var i=r.Pages.results.filter(function(e){var t=e.scope==="PERSONALIZATION";var r=e.PageChipInstances.results.length>0;var a=n.indexOf(e.id)===-1;return t&&r&&a});var o=a.order||[];i.sort(function(e,t){if(o.indexOf(e.id)>o.indexOf(t.id)){return 1}if(o.indexOf(e.id)<o.indexOf(t.id)){return-1}return 0});var u=[];var c;var l=[];i.forEach(function(e){var t;if(e.layout){t=JSON.parse(e.layout)}var r={id:e.id,title:e.title,isLocked:e.isPersLocked==="X",isDefault:e.id===s,tileOrder:t&&t.order||[],linkOrder:t&&t.linkOrder||[],chips:e.PageChipInstances.results};if(r.isLocked){u.push(r)}else if(r.isDefault){c=r}else{l.push(r)}});if(!t.last("/core/home/disableSortedLockedGroups")){u.sort(function(e,t){return e.title.toLowerCase()<t.title.toLowerCase()?-1:1})}if(c){u=u.concat(c)}return u.concat(l)}catch(e){return null}};n.setImportEnabled=function(t){e.emit("importBookmarksFlag",!!t);sap.ushell.Container.getServiceAsync("UserInfo").then(function(e){var r=e.getUser();var a=t?null:"dismissed";r.setImportBookmarksFlag(a);e.updateUserPreferences();r.resetChangedProperty("importBookmarks")})};return n});
//# sourceMappingURL=MyHomeImport.js.map