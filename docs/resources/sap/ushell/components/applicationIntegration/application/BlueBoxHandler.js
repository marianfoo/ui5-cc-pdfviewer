// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/applicationIntegration/application/BlueBoxesCache","sap/ushell/components/applicationIntegration/application/Application","sap/ushell/components/container/ApplicationContainer","sap/ui/thirdparty/URI","sap/ui/thirdparty/jquery","sap/base/Log","sap/base/util/UriParameters","sap/base/security/encodeXML"],function(e,t,i,s,jQuery,a,p,r){"use strict";function n(){var s=this,a,p={isStateful:{handler:function(e,t){if(e&&(e.enabled===true||e===true)){return true}return false}},isGUI:{handler:function(e,t){if(e&&e.protocol==="GUI"){return true}return false}},isGUIStateful:{handler:function(e,t){return s.isCapUT(t,"isGUI")&&s.isCapUT(t,"isStateful")}},isFLP:{handler:function(e,t){return!s.isCapUT(t,"isGUI")&&s.isCapUT(t,"isStateful")}}},r={},n={},u={setup:function(e,t){},create:function(e,s,a,p){var n=new jQuery.Deferred,u,o;function l(){if(u){u["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);u["system-alias"]=e.getSystemAlias();o["sap-flp-params"]=u}sap.ui.getCore().getEventBus().publish("launchpad","appOpening",p);t.postMessageToIframeApp(e,"sap.ushell.services.appLifeCycle","create",o,true).then(function(){r[e].currentAppTarget=p;sap.ui.getCore().getEventBus().publish("sap.ushell","appOpened",p);n.resolve()})}s=i.prototype._checkNwbcUrlAdjustment(e,p.applicationType,s);o={sCacheId:a,sUrl:s,sHash:window.hasher.getHash()};if(s.indexOf("sap-iframe-hint=GUI")>0||s.indexOf("sap-iframe-hint=WDA")>0){var f=[];var c=i.prototype._getParamKeys(s,f);if(c.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.getAppStateData(c).then(function(e){u={};f.forEach(function(t,i){if(e[i][0]){u[t]=e[i][0]}});l()},function(){l()})})}else{u={};l()}}else{l()}return n.promise()},destroy:function(e,i){var s;sap.ushell.Container.setAsyncDirtyStateProvider(undefined);s=t.postMessageToIframeApp(e,"sap.ushell.services.appLifeCycle","destroy",{sCacheId:i},true);s.then(function(){sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",r[e].currentAppTarget);r[e].currentAppTarget=undefined});return s},store:function(e,i){var s;sap.ushell.Container.setAsyncDirtyStateProvider(undefined);s=t.postMessageToIframeApp(e,"sap.ushell.services.appLifeCycle","store",{sCacheId:i},true);s.then(function(){sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",r[e].currentAppTarget);r[e].currentAppTarget=undefined});return s},restore:function(e,i,s){var a;sap.ui.getCore().getEventBus().publish("launchpad","appOpening",s);a=t.postMessageToIframeApp(e,"sap.ushell.services.appLifeCycle","restore",{sCacheId:i,sUrl:s.url,sHash:window.hasher.getHash()},true);a.then(function(){r[e].currentAppTarget=s;sap.ui.getCore().getEventBus().publish("sap.ushell","appOpened",s)});return a}},o=[{service:"sap.ushell.services.appLifeCycle",action:"create"},{service:"sap.ushell.services.appLifeCycle",action:"destroy"}];this.init=function(i,s,p){e.init();t.init(this);a=p;if(s){n=jQuery.extend(true,n,s.supportedTypes)}};this.isStatefulContainerSupported=function(e){var t=this.isCapabilitySupported(e,"sap.ushell.services.appLifeCycle","create")&&this.isCapabilitySupported(e,"sap.ushell.services.appLifeCycle","destroy");return t};this.isKeepAliveSupported=function(e){var t=this.isCapabilitySupported(e,"sap.ushell.services.appLifeCycle","store")&&this.isCapabilitySupported(e,"sap.ushell.services.appLifeCycle","restore");return t};this.isIframeIsValidSupported=function(e){return this.isCapabilitySupported(e,"sap.ushell.appRuntime","iframeIsValid")};this.isIframeBusySupported=function(e){return this.isCapabilitySupported(e,"sap.ushell.appRuntime","iframeIsBusy")};this.mapCapabilities=function(e,t){this.setCapabilities(e,t)};this.getCapabilities=function(e){return r[e].oCapMap};this.isCapabilitySupported=function(e,t,i){if(r[e]&&r[e].oCapMap&&r[e].oCapMap[t]){return!!r[e].oCapMap[t][i]}return false};this.setCapabilities=function(e,t){var i;if(!r[e]){this.initBlueBoxBD(e)}if(!r[e].oCapMap){r[e].oCapMap={}}i=r[e].oCapMap;Object.keys(t).forEach(function(e){var s=t[e],a;if(!i[s.service]){i[s.service]={}}a=i[s.service];a[s.action]=true});if(!e.getIsStateful()&&this.isStatefulContainerSupported(e)){e.setIsStateful(true)}};this.removeCapabilities=function(e){if(r[e]){r[e].oCapMap={};e.setIsStateful(false)}};this.hasIFrame=function(e){if(e&&e._getIFrame){return true}return false};this.initBlueBoxBD=function(e){r[e]={BlueBox:e}};this.setAppCapabilities=function(e,t){if(!r[e]){this.initBlueBoxBD(e)}r[e].currentAppTarget=t;r[e].appCapabilities=t.appCapabilities;if(t.appCapabilities&&t.appCapabilities.statefulContainer===true){this.setCapabilities(e,o)}};this.forEach=function(e){var t;for(t in r){if(r.hasOwnProperty(t)){e(r[t].BlueBox)}}};this.isCapByTarget=function(e,t){if(e.appCapabilities===undefined){return false}if(p[t]&&e&&e.appCapabilities){return p[t].handler(e.appCapabilities)}return e.appCapabilities[t]||false};this.isCapUT=function(e,t){var i=r[e];if(i===undefined||i.appCapabilities===undefined){return false}if(p[t]&&i){return p[t].handler(i.appCapabilities,e)}return i.appCapabilities[t]||false};this.setStorageKey=function(e,t){if(!r[e]){this.initBlueBoxBD(e)}r[e].sStorageKey=t};this.getStorageKey=function(e){if(!r[e]){return undefined}return r[e].sStorageKey};this.getHandler=function(){return u};this._getBlueBoxCacheKey=function(t){return e.getBlueBoxCacheKey(t)};this.deleteStateFul=function(e){return this.delete(e)};this.getStateFul=function(t){return e.get(t)};this.destroyApp=function(e){a.postMessageToIframeApp("sap.ushell.services.appLifeCycle","destroy",{appId:e})};this.openApp=function(e){a.postMessageToIframeApp("sap.ushell.services.appLifeCycle","create",{appId:e,sHash:window.hasher.getHash()})};this.storeApp=function(e){a.postMessageToIframeApp("sap.ushell.services.appLifeCycle","store",{appId:e,sHash:window.hasher.getHash()})};this.restoreApp=function(e){a.postMessageToIframeApp("sap.ushell.services.appLifeCycle","restore",{appId:e,sHash:window.hasher.getHash()})};this.delete=function(t){e.remove(t)};this.get=function(t){return e.get(t)};this.getById=function(t){return e.getById(t)};this.set=function(t,i){e.add(t,i)}}return new n},true);
//# sourceMappingURL=BlueBoxHandler.js.map