// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ushell/components/tiles/utils","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/Log"],function(t,e,i,jQuery,n){"use strict";return t.extend("sap.ushell.components.tiles.action.ActionTile",{onInit:function(){var t=this.getView();var n=t.getViewData();var o=e.getResourceBundleModel();var r=n.chip;var a=e.getActionConfiguration(r);var g;var c=this;function s(t,e){var i=o.getResourceBundle(),n=i.getText("configuration.semantic_object")+":\n"+t+"\n\n"+i.getText("configuration.semantic_action")+":\n"+e;return n}t.setModel(o,"i18n");g=new i({config:a,displayText:s(a.semantic_object,a.semantic_action)});t.setModel(g);if(r.configurationUi.isEnabled()){r.configurationUi.setAsyncUiProvider(function(){return e.getConfigurationUi(c.getView(),"sap.ushell.components.tiles.action.Configuration").then(function(t){r.configurationUi.attachCancel(c.onCancelConfiguration.bind(null,t));r.configurationUi.attachSave(c.onSaveConfiguration.bind(null,t,s));return t})});t.byId("actionTile").setTooltip(o.getResourceBundle().getText("edit_configuration.tooltip"))}},onPress:function(t){var e=this.getView().getViewData().chip;if(e.configurationUi.isEnabled()){e.configurationUi.display()}},onSaveConfiguration:function(t,o){var r=jQuery.Deferred(),a=t.getModel(),g=a.getProperty("/tileModel"),c=t.getViewData().chip;function s(t){n.warning(t,null,"sap.ushell.components.tiles.action.ActionTile.controller");r.reject(t)}var l=e.checkTMInputOnSaveConfig(t);if(l){r.reject("mandatory_fields_missing");return r.promise()}var p=e.getResourceBundleModel().getResourceBundle();if(e.tableHasDuplicateParameterNames(a.getProperty("/config/rows"))){r.reject(p.getText("configuration.signature.uniqueParamMessage.text"))}else if(!e.tableHasInvalidSapPrelaunchOperationValue(a.getProperty("/config/rows"))){var u=JSON.stringify([{type:"split",source:"p1",target:["p2","p3"]},{type:"merge",source:["p4","p5"],target:"p6"}]);r.reject(p.getText("configuration.signature.invalidSapPrelaunchOperationsMessage.text",[u]))}else{var f=a.getProperty("/config/formFactorConfigDefault")?undefined:e.buildFormFactorsObject(a);var d=e.getMappingSignatureString(a.getProperty("/config/rows"),a.getProperty("/config/isUnknownAllowed"));var _=e.getMappingSignature(a.getProperty("/config/rows"),a.getProperty("/config/isUnknownAllowed"));var y={semantic_object:jQuery.trim(a.getProperty("/config/semantic_object"))||"",semantic_action:jQuery.trim(a.getProperty("/config/semantic_action"))||"",display_title_text:jQuery.trim(a.getProperty("/config/display_title_text"))||"",url:jQuery.trim(a.getProperty("/config/url"))||"",ui5_component:jQuery.trim(a.getProperty("/config/ui5_component"))||"",navigation_provider:jQuery.trim(a.getProperty("/config/navigation_provider")),navigation_provider_role:jQuery.trim(a.getProperty("/config/navigation_provider_role"))||"",navigation_provider_instance:jQuery.trim(a.getProperty("/config/navigation_provider_instance"))||"",target_application_id:jQuery.trim(a.getProperty("/config/target_application_id"))||"",target_application_alias:jQuery.trim(a.getProperty("/config/target_application_alias"))||"",transaction:{code:jQuery.trim(a.getProperty("/config/transaction/code"))},web_dynpro:{application:jQuery.trim(a.getProperty("/config/web_dynpro/application")),configuration:jQuery.trim(a.getProperty("/config/web_dynpro/configuration"))},target_system_alias:jQuery.trim(a.getProperty("/config/target_system_alias")),display_info_text:jQuery.trim(a.getProperty("/config/display_info_text")),form_factors:f,mapping_signature:d,signature:_};var m=c.bag.getBag("tileProperties");m.setText("display_title_text",y.display_title_text);c.writeConfiguration.setParameterValues({tileConfiguration:JSON.stringify(y)},function(){var l=e.getActionConfiguration(c,false);var p=e.getActionConfiguration(c,true);a=new i({config:l,tileModel:g});t.setModel(a);g.setData({config:p,displayText:o(p.semantic_object,p.semantic_action)},false);m.save(function(){n.debug("property bag 'tileProperties' saved successfully");r.resolve()},s)},s)}return r.promise()},onCancelConfiguration:function(t){var i=t.getViewData();var n=t.getModel();var o=n.getProperty("/tileModel");var r=i.chip;var a=e.getActionConfiguration(r,false);t.getModel().setData({config:a,tileModel:o},false)}})});
//# sourceMappingURL=ActionTile.controller.js.map