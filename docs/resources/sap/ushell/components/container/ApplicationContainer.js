// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/security/encodeXML","sap/base/util/deepEqual","sap/base/util/uid","sap/base/util/UriParameters","sap/m/MessagePopover","sap/m/Text","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/mvc/View","sap/ui/core/routing/History","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ushell/ApplicationType","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/resources","sap/ushell/System","sap/ushell/User","sap/ushell/utils","sap/ushell/utils/UrlParsing"],function(e,t,a,n,r,o,i,s,p,l,u,f,d,c,jQuery,g,m,h,y,v,C,I,b,_,P){"use strict";var A="sap.ushell.components.container.",S=A+"ApplicationContainer",E="sap.ushell.Container.dirtyState.",w="autoplay;battery;camera;display-capture;geolocation;gyroscope;magnetometer;microphone;midi;clipboard-write;clipboard-read;fullscreen;serial;",x,U,R,T=false,M=false,D=[],L=0,F=0;var O=["sap-ach","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url","sap-app-origin-hint"];function N(e){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(t){t.isUrlSupported(e.url).done(function(){e.promise.resolve({allowed:true,id:e.id})}).fail(function(){e.promise.resolve({allowed:false,id:e.id})})})}function H(e){var t={asyncURLHandler:he.prototype._adaptIsUrlSupportedResultForMessagePopover};if(o&&o.setDefaultHandlers){o.setDefaultHandlers(t)}y.emit("StepDone",e.stepName)}y.once("initMessagePopover").do(H);x=new _.Map;function V(e){return x.get(e.getId())}function j(){return U}function W(e){var t=new r(e).mParams,a=t["sap-xapp-state"],n;delete t["sap-xapp-state"];n={startupParameters:t};if(a){n["sap-xapp-state"]=a}return n}function k(e,t){return C.i18n.getText(e,t)}function q(){return new u({size:"2rem",src:"sap-icon://error",tooltip:he.prototype._getTranslatedText("an_error_has_occured")})}function B(t){var a=t.getAggregation("child"),n;if(a instanceof p){n=a.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");e.debug("unloading component "+n,null,S)}t.destroyAggregation("child")}function J(t,a,n){return new Promise(function(r){var o,i,l,u,d,c={},g,m;function h(e){e.setWidth(t.getWidth());e.setHeight(t.getHeight());e.addStyleClass("sapUShellApplicationContainer");t.setAggregation("child",e,true)}o=a.indexOf("?");if(o>=0){u=he.prototype._getParameterMap(a);c=u.startupParameters;a=a.slice(0,o)}if(a.slice(-1)!=="/"){a+="/"}if(/\.view\.(\w+)$/i.test(n)){l=/^SAPUI5=(?:([^/]+)\/)?([^/]+)\.view\.(\w+)$/i.exec(n);if(!l){e.error("Invalid SAPUI5 URL",n,S);r(he.prototype._createErrorControl());return}d=l[1];g=l[2];m=l[3].toUpperCase();if(d){g=d+"."+g}else{i=g.lastIndexOf(".");if(i<1){e.error("Missing namespace",n,S);return he.prototype._createErrorControl()}d=g.slice(0,i)}}else{d=n.replace(/^SAPUI5=/,"")}var y={};var v=d.replace(/\./g,"/");y[d]=a+v;sap.ui.loader.config({paths:y});he.prototype._destroyChild(t);if(g){if(t.getApplicationConfiguration()){c.config=t.getApplicationConfiguration()}f.create({id:t.getId()+"-content",type:m,viewData:c||{},viewName:g}).then(function(e){t.fireEvent("applicationConfiguration");h(e);r(e)})}else{e.debug("loading component "+d,null,S);var C=u?{startupParameters:u.startupParameters}:{startupParameters:{}};if(u&&u["sap-xapp-state"]){C["sap-xapp-state"]=u["sap-xapp-state"]}if(t.getApplicationConfiguration()){C.config=t.getApplicationConfiguration()}s.create({id:t.getId()+"-component",componentData:C,name:d}).then(function(e){t.fireEvent("applicationConfiguration",{configuration:e.getMetadata().getConfig()});var a=new p({id:t.getId()+"-content",component:e});h(a);r(a)})}})}function K(e,t){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,t)},0)}function z(t,a,n){var r=this,o,i={oControl:undefined,oPromise:undefined},l,u,f,d={startupParameters:{}},c,g=t.getComponentHandle(),m,h;function y(e){t.fireEvent("applicationConfiguration",{configuration:e.getMetadata().getConfig()});u=new p({id:t.getId()+"-content",component:e});u.setHeight(t.getHeight());u.setWidth(t.getWidth());u.addStyleClass("sapUShellApplicationContainer");t._disableRouterEventHandler=he.prototype._disableRouter.bind(r,e);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",t._disableRouterEventHandler);t.setAggregation("child",u,true);sap.ushell.Container.getServiceAsync("PluginManager").then(function(t){m=t.getPluginLoadingPromise("RendererExtensions");h=m&&m.state();if(h==="pending"){m.done(function(){he.prototype._publishExternalEvent("appComponentLoaded",{component:e})}).fail(function(){he.prototype._publishExternalEvent("appComponentLoaded",{component:e})})}if(h==="resolved"||h==="rejected"){he.prototype._publishExternalEvent("appComponentLoaded",{component:e})}});return u}l=a.indexOf("?");if(l>=0){f=he.prototype._getParameterMap(a);d={startupParameters:f.startupParameters};if(f["sap-xapp-state"]){d["sap-xapp-state"]=f["sap-xapp-state"]}a=a.slice(0,l)}if(t.getApplicationConfiguration()){d.config=t.getApplicationConfiguration()}if(a.slice(-1)!=="/"){a+="/"}he.prototype._destroyChild(t);c={id:t.getId()+"-component",name:n,componentData:d};e.debug("Creating component instance for "+n,JSON.stringify(c),S);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:n});if(g){var v=g.getInstance(c);i.oControl=y(v)}else{o=new jQuery.Deferred;var C={};var I=n.replace(/\./g,"/");C[I]=a;sap.ui.loader.config({paths:C});e.error("No component handle available for '"+n+"'; fallback to component.load()",null,S);s.create({id:t.getId()+"-component",name:n,manifest:false,componentData:d}).then(function(e){o.resolve(y(e))});i.oPromise=o.promise()}return i}function G(t){var a;if(t instanceof s&&typeof t.getRouter==="function"){a=t.getRouter();if(a&&typeof a.stop==="function"){e.info("router stopped for instance "+t.getId());a.stop()}}}function $(e){var t=document.createElement("a"),a=new r(e).get("sap-client"),n;t.href=e;n=t.protocol+"//"+t.host;return new I({alias:a?n+"?sap-client="+a:n,baseUrl:n,client:a||undefined,platform:"abap"})}function Q(e,t){var a=false,n=e.getDomRef(),r,o;if(e.getIframeWithPost()===true&&n&&n.getAttribute&&n.getAttribute("sap-iframe-app")=="true"){n=jQuery("#"+n.getAttribute("id")+"-iframe")[0]}if(n){r=g(e._getIFrameUrl(n)||window.location&&window.location.href||"");o=r.protocol()+"://"+r.host();a=t.source===n.contentWindow||t.origin===o}return a}function X(t,a,r){var o=JSON.stringify({type:"request",service:a,request_id:n(),body:{}});e.debug("Sending post message request to origin ' "+r+"': "+o,null,"sap.ushell.components.container.ApplicationContainer");t.postMessage(o,r)}function Y(){var e=this.getDomRef();if(!e||e.tagName!=="IFRAME"){if(this.getIframeWithPost()===true&&e&&e.getAttribute&&e.getAttribute("sap-iframe-app")=="true"){return jQuery("#"+e.getAttribute("id")+"-iframe")[0]}return null}return e}function Z(e){var t;if(e===undefined){e=this._getIFrame()}if(this.getIframeWithPost()===true){t=jQuery("#"+e.getAttribute("id").replace("-iframe","-form"))[0].action;if(t===undefined&&(new g).query(true).hasOwnProperty("sap-isolation-enabled")){t=e.src}}else{t=e.src}return t}function ee(t,a){var n=t&&t.getUi5ComponentName&&t.getUi5ComponentName(),r=a.data,o=typeof r==="string"&&r.indexOf("sap.ushell.appRuntime.iframeIsValid")>0;if(t&&!t.getActive()&&o!==true){e.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(r)+"' on inactive container '"+t.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return}if(typeof n==="string"){e.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(r)+"' on container of UI5 application '"+n+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return}var i={bPluginsStatusChecked:T,bKeepMessagesForPlugins:M,bApiRegistered:true};R(t,a,i);he.prototype._handlePostMessagesForPluginsPostLoading(t,a,i)}function te(t,a,n){var r,o;if(n.bApiRegistered!==false){return}sap.ushell.Container.getServiceAsync("PluginManager").then(function(n){if(T===false){T=true;r=n.getPluginLoadingPromise("RendererExtensions");o=r&&r.state();if(o==="pending"){M=true;r.always(function(){var t;M=false;e.debug("Processing post messages queue after 'RendererExtensions' plugins loaded, queue size is: "+D.length,null,"sap.ushell.components.container.ApplicationContainer");for(var a=0;a<D.length;a++){t=D[a];try{he.prototype._handleMessageEvent.call(t.that,t.oContainer,t.oMessage)}catch(t){e.error(t.message||t,null,"sap.ushell.components.container.ApplicationContainer")}}D=[]})}}if(M===true){D.push({index:L++,that:this,oContainer:t,oMessage:a})}})}function ae(){T=false;M=false;D=[];L=0}function ne(e,t){var a=e._getIFrame(),n=e.getApplicationType();if(_.isApplicationTypeEmbeddedInIframe(e.getApplicationType(n))&&a){var r=new g(e._getIFrameUrl(a));var o=r.protocol()+"://"+r.host();a.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),o);t.preventDefault()}}function re(e,t,a){e.openStart("div",t).accessibilityState(t).class("sapUShellApplicationContainer").style("height",t.getHeight()).style("width",t.getWidth()).openEnd();if(a){e.renderControl(a)}e.close("div")}function oe(e,t,a){if(_.isApplicationTypeEmbeddedInIframe(t)||_.isApplicationTypeEmbeddedInIframe(e.getFrameworkId())){var n=e.getTargetNavigationMode();a=he.prototype._adjustNwbcUrl(a,t,n,e.getIsStateful());_.localStorageSetItem(e.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL)}return a}function ie(e,t,a,n){var o,i=function(){var e=_.getParameterValueBoolean("sap-accessibility");if(e!==undefined){return e}return sap.ushell.Container.getUser().getAccessibilityMode()},s=function(){var t=new r(e)||{mParams:{}};if(t.mParams["sap-theme"]===undefined){return sap.ushell.Container.getUser().getTheme(b.prototype.constants.themeFormat.NWBC)}return undefined},p=function(){var t=false,a=new r(e)||{mParams:{}};t=sap.ui.getCore().getConfiguration().getStatistics()&&a.mParams["sap-statistics"]===undefined;return t},l=function(){var e=window.hasher&&window.hasher.getHash(),t="",a;if(e&&e.length>0&&e.indexOf("sap-iapp-state=")>0){a=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(a&&a.length===2){t=a[1]}}return t},u=function(){var e="";var t=!!jQuery("body.sapUiSizeCompact").length;var a=!!jQuery("body.sapUiSizeCozy").length;if(t===true){e="0"}else if(a){e="1"}return e};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";o=s();if(o){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(o)}if(a){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(a)}if(i()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X"}if(p()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true"}if(t==="TR"||t==="GUI"){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=2"}else if(n){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1"}var f=l();if(f&&f.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+f}var d=u();if(d&&d.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-touch="+d}var c=0;if(h.last("/core/shell/sessionTimeoutIntervalInMinutes")>0){c=h.last("/core/shell/sessionTimeoutIntervalInMinutes")}e+=e.indexOf("?")>=0?"&":"?";e+="sap-ushell-timeout="+c;return _.appendSapShellParam(e,t)}function se(e,t,a,n){var r=t.getAggregation("child"),o,i;if(!r||t._bRecreateChild){i=he.prototype._createUi5Component(t,a,n);if(i.oControl!==undefined){t._bRecreateChild=false;he.prototype._renderControlInDiv(e,t,i.oControl)}else{t.oDeferredControlCreation=new jQuery.Deferred;he.prototype._renderControlInDiv(e,t);i.oPromise.then(function(e){t._bRecreateChild=false;o=sap.ui.getCore().createRenderManager();o.renderControl(e);o.flush(jQuery("#"+t.getId())[0]);o.destroy();t.oDeferredControlCreation.resolve()})}}else{he.prototype._renderControlInDiv(e,t,r)}}function pe(e,t,n){var r=e.getProperty(t);if(a(r,n)){return}e.setProperty(t,n);e._bRecreateChild=true}function le(t,a,n,o,i){var s,p=true,l=false;localStorage.removeItem(a.globalDirtyStorageKey);a.oDeferredControlCreation=undefined;if(i&&i.indexOf("SAPUI5.Component=")===0&&n===m.URL.type){se(t,a,o,i.replace(/^SAPUI5\.Component=/,""));return}if(i&&i.indexOf("SAPUI5=")===0&&n===m.URL.type){he.prototype._renderControlInDiv(t,a,undefined,"open");a.oDeferredControlCreation=new jQuery.Deferred;he.prototype._createUi5View(a,o,i).then(function(e){var n,r=jQuery("#"+a.getId());if(r&&r.length>0){n=sap.ui.getCore().createRenderManager();n.renderControl(e);n.flush(jQuery("#"+a.getId())[0]);n.destroy()}else{t.renderControl(e)}a.oDeferredControlCreation.resolve()});he.prototype._renderControlInDiv(t,a,undefined,"close");return}e.debug('Not resolved as "SAPUI5.Component=" or "SAPUI5=" , '+"will attempt to load into iframe "+i);if(!a.getActive()){e.debug("Skipping rendering container iframe","Container '"+a.getId()+"' is inactive");return}try{o=a.getFrameSource(n,o)}catch(n){e.error(n.message||n,null,S);a.fireEvent("applicationConfiguration");t.renderControl(he.prototype._createErrorControl());return}if(sap.ushell.Container){s=he.prototype._getLogoutHandler(a);if(!s){if(_.isApplicationTypeEmbeddedInIframe(n)){s=he.prototype._logout.bind(null,a);x.put(a.getId(),s);sap.ushell.Container.attachLogoutEvent(s);sap.ushell.Container.addRemoteSystem(he.prototype._createSystemForUrl(o))}}else if(!_.isApplicationTypeEmbeddedInIframe(n)){sap.ushell.Container.detachLogoutEvent(s);x.remove(a.getId())}}o=he.prototype._checkNwbcUrlAdjustment(a,n,o);var u=new r(document.URL);if(u.has("sap-iframe-params")){var f=u.get("sap-iframe-params")||"",d=f.split(",");if(d.length>0){var c=new g(o);d.forEach(function(e){if(e&&e.length>0){if(u.has(e)){c.addQuery(e,u.get(e))}}});o=c.toString()}}if(n==="TR"){a.setProperty("iframePostAllParams",true,true)}if(u.get("sap-post")==="false"){p=false}else if(window.QUnit!==undefined){p=a.getIframeWithPost()}if(p===true&&a.getOpenWithPostByAppParam()===false){p=false}if(u.get("sap-post")==="true"){l=true}if(p===true&&(n==="NWBC"||n==="TR"||n==="WDA")||l===true){a.setProperty("iframeWithPost",true,true);a.oDeferredRenderer=new jQuery.Deferred;o=he.prototype._filterURLParams(o);var y=[];var v=he.prototype._getParamKeys(o,y);he.prototype._generateRootElementForIFrame(t,a,true);if(v.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.getAppStateData(v).then(function(e){var n;var r=jQuery("#"+a.getId());if(r.length>0){n=sap.ui.getCore().createRenderManager();he.prototype._buildHTMLElements(n,a,e,y,o);n.flush(r[0]);n.destroy()}else{he.prototype._buildHTMLElements(t,a,e,y,o)}setTimeout(a.oDeferredRenderer.resolve,0)},function(e){he.prototype._buildHTMLElements(t,a,undefined,y,o);setTimeout(a.oDeferredRenderer.resolve,0)})})}else{he.prototype._buildHTMLElements(t,a,undefined,y,o);setTimeout(a.oDeferredRenderer.resolve,0)}he.prototype._generateRootElementForIFrame(t,a,false);return}if(a.getFrameworkId&&a.getFrameworkId()==="UI5"&&a.getIsStateful&&a.getIsStateful()===true){a.setProperty("isIframeBusy",true,true)}a.fireEvent("applicationConfiguration");t.openStart("iframe",a).accessibilityState(a).attr("src",o).attr("title",C.i18n.getText("AppilcationContainer.IframeTitle")).attr("sap-iframe-idx",++F).class("sapUShellApplicationContainer").style("height",a.getHeight()).style("width",a.getWidth());if(h.last("/core/shell/enableFeaturePolicyInIframes")===true){t.attr("allow",w)}t.openEnd().close("iframe")}function ue(e){var t=new g(e);t=t.removeSearch(O);return t.toString()}function fe(e,t){var a=[],n;if(e.indexOf("sap-intent-param=")>0){n=/(?:sap-intent-param=)([^&/]+)/.exec(e);if(n&&n.length===2){a.push([n[1]]);t.push("sap-intent-param-data")}}if(e.indexOf("sap-xapp-state=")>0){n=/(?:sap-xapp-state=)([^&/]+)/.exec(e);if(n&&n.length===2){a.push([n[1]]);t.push("sap-xapp-state-data")}}if(e.indexOf("sap-iapp-state=")>0){n=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(n&&n.length===2){a.push([n[1]]);t.push("sap-iapp-state-data")}}return a}function de(e,t,a,n,o){var i=t.getId()+"-form",s="",p=false;if(a===undefined){a=[]}a.push([sap.ushell.Container.getFLPUrl(true)]);n.push("sap-flp-url");a.push([t.getSystemAlias()]);n.push("system-alias");var l="";var u={};n.forEach(function(e,t){if(a[t][0]){u[e]=a[t][0]}});var f=o;l=JSON.stringify(u);var d={};if(t.getIframePostAllParams()===true){d=new r(o);s=ce(t,d,false);if(s!==""){o=ge(o,d)}}t.fireEvent("applicationConfiguration");e.openStart("form").attr("id",i).attr("method","post").attr("name",i).attr("target",t.getId()+"-iframe").attr("action",o).style("display","none").openEnd();e.voidStart("input").attr("name","sap-flp-params").attr("value",l).voidEnd();if(t.getIframePostAllParams()===true){ce(t,d,true,e)}e.close("form");var c=t.sId;if(t.hasStyleClass("sapUShellApplicationContainerIframeHidden")){p=true;t.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false)}t.sId+="-iframe";e.openStart("iframe",t).attr("name",t.getId()).accessibilityState(t).attr("sap-orig-src",f).attr("title",C.i18n.getText("AppilcationContainer.IframeTitle")).attr("sap-iframe-idx",++F).class("sapUShellApplicationContainer").style("height",t.getHeight()).style("width",t.getWidth());if(h.last("/core/shell/enableFeaturePolicyInIframes")===true){e.attr("allow",w.replaceAll(";"," "+new g(o).origin()+";"))}e.openEnd().close("iframe");t.sId=c;if(p){t.toggleStyleClass("sapUShellApplicationContainerIframeHidden",true)}}function ce(e,t,a,n){var r="";var o="";if(t.has("sap-iframe-hint")){r=t.get("sap-iframe-hint")}var i=t.mParams;if(e.getApplicationType()==="TR"||r==="GUI"){var s,p;for(s in i){if(s==="sap-iframe-hint"||s==="sap-keep-alive"){continue}p=i[s][0];if(a===true){n.voidStart("input").attr("name",s).attr("value",p).voidEnd()}else{o+="*"}}}return o}function ge(e,t){var a=t.get("sap-iframe-hint"),n=t.get("sap-keep-alive"),r=new g(e).query("");if(typeof a==="string"){r.addSearch("sap-iframe-hint",a)}if(typeof n==="string"){r.addSearch("sap-keep-alive",n)}return r.toString()}function me(e,t,a){if(a){e.openStart("div",t).attr("sap-iframe-app","true").class("sapUShellApplicationContainer").style("height",t.getHeight()).style("width",t.getWidth()).openEnd()}else{e.close("div")}}var he=l.extend(S,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:A+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"},openWithPostByAppParam:{defaultValue:true,type:"boolean"},iframeWithPost:{defaultValue:false,type:"boolean"},beforeAppCloseEvent:{type:"object"},extendedInfo:{type:"object"},systemAlias:{defaultValue:"",type:"string"},iframePostAllParams:{defaultValue:false,type:"boolean"},isKeepAlive:{defaultValue:false,type:"boolean"},frameworkId:{defaultValue:"",type:"string"},iframeReusedForApp:{defaultValue:false,type:"boolean"},isIframeValidTime:{defaultValue:{time:0},type:"object"},isIframeBusy:{defaultValue:false,type:"boolean"}},events:{applicationConfiguration:{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,t=this;if(sap.ushell.Container){e=he.prototype._getLogoutHandler(t);if(e){sap.ushell.Container.detachLogoutEvent(e);x.remove(t.getId())}}localStorage.removeItem(t.globalDirtyStorageKey);if(t._unloadEventListener){removeEventListener("unload",t._unloadEventListener)}if(t._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",t._disableRouterEventHandler)}if(t._storageEventListener){removeEventListener("storage",t._storageEventListener)}if(t._messageEventListener){removeEventListener("message",t._messageEventListener)}he.prototype._destroyChild(t);if(l.exit){l.exit.apply(t)}},setHandleMessageEvent:function(e){R=e},init:function(){var t=this;t.globalDirtyStorageKey=E+n();t._unloadEventListener=t.exit.bind(t);addEventListener("unload",t._unloadEventListener);t._storageEventListener=function(a){var n=t.getApplicationType();if(a.key===t.globalDirtyStorageKey&&a.newValue===sap.ushell.Container.DirtyState.PENDING&&_.isApplicationTypeEmbeddedInIframe(n)){var r=t._getIFrame();if(r){e.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");var o=new g(t._getIFrameUrl(r));var i=o.protocol()+"://"+o.host();r.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),i)}}};addEventListener("storage",t._storageEventListener);t._messageEventListener=he.prototype._handleMessageEvent.bind(null,t);addEventListener("message",t._messageEventListener)},onAfterRendering:function(){var e=this;this.rerender=function(){};if(c.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto")}if(this.oDeferredRenderer){this.oDeferredRenderer.done(function(){var t=document.getElementById(e.getId()+"-form");if(t){t.submit()}})}},renderer:{apiVersion:2,render:function(t,a){var n=a.getApplication(),r=a.launchpadData,o;if(!a.getVisible()){he.prototype._renderControlInDiv(t,a);return}if(a.bTestControl){he.prototype._renderControlInDiv(t,a,a.oTestControl)}else if(a.error){delete a.error;he.prototype._renderControlInDiv(t,a,he.prototype._createErrorControl())}else if(!n){he.prototype._render(t,a,a.getApplicationType(),a.getUrl(),a.getAdditionalInformation())}else if(!n.isResolvable()){he.prototype._render(t,a,n.getType(),n.getUrl(),"")}else if(r){he.prototype._render(t,a,r.applicationType,r.Absolute.url.replace(/\?$/,""),r.applicationData)}else{e.debug("Resolving "+n.getUrl(),null,S);n.resolve(function(t){e.debug("Resolved "+n.getUrl(),JSON.stringify(t),S);a.launchpadData=t;he.prototype._destroyChild(a)},function(e){var t=n.getMenu().getDefaultErrorHandler();if(t){t(e)}he.prototype._destroyChild(a);a.error=e});o=new i({text:he.prototype._getTranslatedText("loading",[n.getText()])});he.prototype._destroyChild(a);a.setAggregation("child",o);he.prototype._renderControlInDiv(t,a,o)}}}});he.prototype.getFrameSource=function(e,t){if(!Object.prototype.hasOwnProperty.call(m.enum,e)){throw new Error("Illegal application type: "+e)}return t};he.prototype.setUrl=function(e){pe(this,"url",e)};he.prototype.setAdditionalInformation=function(e){pe(this,"additionalInformation",e)};he.prototype.setApplicationType=function(e){pe(this,"applicationType",e)};he.prototype.createPostMessageRequest=function(e,t){var a=Date.now().toString();return{type:"request",request_id:a,service:e,body:t}};he.prototype.setNewTRApplicationContext=function(e){var t=new jQuery.Deferred,a=this._getIFrame(),n,r,o=this;if(!a){return t.promise().reject({message:"Expected an existing TR application application frame but found none."})}function i(){if(r){r["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);r["system-alias"]=o.getSystemAlias();n["sap-flp-params"]=r}var e=o.createPostMessageRequest("sap.its.startService",n);o.postMessageToIframe(e,a,true).then(function(){t.resolve()}).catch(function(e){t.reject({eventData:e,message:"Failed to change application context."})})}e=_.appendSapShellParam(e);e=he.prototype._filterURLParams(e);n={url:e};if(this.getIframeWithPost&&this.getIframeWithPost()===true){var s=[];var p=he.prototype._getParamKeys(e,s);if(p.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.getAppStateData(p).then(function(e){r={};s.forEach(function(t,a){if(e[a][0]){r[t]=e[a][0]}});i()},function(e){i()})})}else{r={};i()}}else{i()}return t.promise()};he.prototype.postMessageToIframe=function(t,a,n){var r=this;var o=t.request_id;return new Promise(function(i,s){function p(a){var n={};try{if(typeof a.data==="string"&&a.data.indexOf("{")===0){try{n=JSON.parse(a.data)}catch(e){n={}}}else{return}if(!n.request_id||o!==n.request_id){return}if(n.status==="success"){i(n)}else{s(n)}window.removeEventListener("message",p)}catch(n){i();e.warning("Obtained bad response from framework in response to message "+t.request_id);e.debug("Underlying framework returned invalid response data: '"+a.data+"'")}}var l=JSON.stringify(t);e.debug("Sending postMessage "+l+" to application container '"+r.getId()+"'");var u=new g(r._getIFrameUrl(a));var f=u.protocol()+"://"+u.host();if(n){window.addEventListener("message",p,false);a.contentWindow.postMessage(l,f)}else{a.contentWindow.postMessage(l,f);i()}})};he.prototype.postMessageToCurrentIframe=function(e,t){if(t===undefined){t=false}var a=this._getIFrame();if(!a){if(t){return Promise.reject({message:"Expected opened iframe not found."})}return}return this.postMessageToIframe(e,a,t)};he.prototype.setNewApplicationContext=function(e,t){var a=this;var n=this["setNew"+e+"ApplicationContext"];if(!n){return Promise.reject({message:"Unsupported application type"})}var r=this._getIFrame();if(!r){return Promise.reject({message:"Expected an existing TR application application frame but found none."})}var o=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(o,r,true).then(function(){return n.call(a,t)},function(e){return Promise.reject({eventData:e,message:"Failed to change application context."})})};he.prototype.onApplicationOpened=function(e){var t=this.getIsStateful();if(!t){return Promise.resolve()}var a=this.getApplicationType();if(a==="TR"&&e!=="TR"){var n=this._getIFrame();if(!n){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."})}var r=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(r,n,false).catch(function(e){return Promise.reject({eventData:e,message:"Failed to change application context."})})}return Promise.resolve()};he.prototype.postMessageRequest=function(e,t){var a=this._getIFrame();if(!a){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."})}var n=this.createPostMessageRequest(e,t||{});return this.postMessageToIframe(n,a,false).catch(function(e){return Promise.reject({eventData:e,message:"Failed to post message."})})};he.prototype.sendBeforeAppCloseEvent=function(){var e=this.getBeforeAppCloseEvent&&this.getBeforeAppCloseEvent(),t;if(e&&e.enabled&&e.enabled===true){t=this.createPostMessageRequest("sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent",e.params);return this.postMessageToIframe(t,this._getIFrame(),true)}return undefined};he.prototype.getDeffedControlCreation=function(e){return this.oDeferredControlCreation?this.oDeferredControlCreation.promise():jQuery.Deferred().resolve().promise()};he.prototype._getCommunicationHandlers=j;he.prototype._adaptIsUrlSupportedResultForMessagePopover=N;he.prototype._getLogoutHandler=V;he.prototype._getParameterMap=W;he.prototype._getTranslatedText=k;he.prototype._createErrorControl=q;he.prototype._destroyChild=B;he.prototype._createUi5View=J;he.prototype._publishExternalEvent=K;he.prototype._createUi5Component=z;he.prototype._disableRouter=G;he.prototype._createSystemForUrl=$;he.prototype._isTrustedPostMessageSource=Q;he.prototype._handleMessageEvent=ee;he.prototype._logout=ne;he.prototype._renderControlInDiv=re;he.prototype._checkNwbcUrlAdjustment=oe;he.prototype._adjustNwbcUrl=ie;he.prototype._render=le;he.prototype._getParamKeys=fe;he.prototype._buildHTMLElements=de;he.prototype._buildHTMLForAllPostParams=ce;he.prototype._generateRootElementForIFrame=me;he.prototype._backButtonPressedCallback=X;he.prototype._getIFrame=Y;he.prototype._getIFrameUrl=Z;he.prototype._filterURLParams=ue;he.prototype._resetPluginsLoadIndications=ae;he.prototype._handlePostMessagesForPluginsPostLoading=te;return he},true);
//# sourceMappingURL=ApplicationContainer.js.map