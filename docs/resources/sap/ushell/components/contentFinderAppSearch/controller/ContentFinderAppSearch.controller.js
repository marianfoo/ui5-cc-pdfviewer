//Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ushell/ui/contentFinder/AppBox","sap/f/GridContainerItemLayoutData","sap/base/Log"],function(e,t,i,r,n,o){"use strict";return e.extend("sap.ushell.components.ContentFinderAppSearch.controller.ContentFinderAppSearch",{onAfterRendering:function(){this.oModel=this.getView().getModel();this.oBindingPath=this.getView().getBindingContext().getPath();if(this.oModel){this.byId("overflowToolbar").setVisible(true)}if(this.getOwnerComponent().getModel()){this.oParentContentFinderDialogModel=this.getOwnerComponent().getModel()}},onInit:function(){this._oFilters={}},handleBreakpointChanged:function(e){if(this.oParentContentFinderDialogModel&&this.oParentContentFinderDialogModel.getProperty("/currentPageIndex")===1){var t=e.getParameter("currentBreakpoint");this.oParentContentFinderDialogModel.setProperty("/currentBreakpoint",t)}},showPreview:function(e){if(this.oModel.getProperty(this.oBindingPath+"/type")==="tiles"){this.oModel.setProperty(this.oBindingPath+"/tilePreviewShown",e.getParameter("showPreview"))}else{this.oModel.setProperty(this.oBindingPath+"/cardPreviewShown",e.getParameter("showPreview"))}},_getGridContainer:function(){if(this.oModel){return this.byId(this.oModel.getProperty(this.oBindingPath+"/type")==="tiles"?"tileGridList":"cardGridList")}return this.byId("tileGridList")},onTileSearch:function(e){var r=e.getParameter("newValue");if(r){this._oFilters.oSearchFilter=new t({filters:[new t("appId",i.Contains,r),new t("title",i.Contains,r),new t("subtitle",i.Contains,r),new t("systemInfo",i.Contains,r)],and:false});this._applyFilters()}else{this.resetFilters(["oSearchFilter"])}},_applyFilters:function(){var e=this._getGridContainer();var i=e.getBinding("items");i.filter(new t({filters:Object.values(this._oFilters),and:true}),"Control");this._setSelectAllButton()},titleFormatter:function(e,t,i,r,n,o){var s=this._getGridContainer().getItems().length;var l=s===0;var a=this.getView().getModel("i18n");if(i){if(l){return a.getResourceBundle().getText("ContentFinder.AppBoxContainer.Title.NoSearchResult",i)}return a.getResourceBundle().getText("ContentFinder.AppBoxContainer.Title.SearchResult",[s,i])}if(r){if(n===0){return a.getResourceBundle().getText("ContentFinder.AppBoxContainer.Title.NoSelectedApp")}return a.getResourceBundle().getText("ContentFinder.AppBoxContainer.Title.SelectedApp",n)}if(o&&o!==a.getResourceBundle().getText("ContentFinder.CategoryTree.Row.AllTiles")&&o!==a.getResourceBundle().getText("ContentFinder.CategoryTree.Row.AllCards")){return o+" ("+s+")"}if(e==="tiles"){if(l){return a.getResourceBundle().getText("ContentFinder.AppBoxContainer.Title.NoTiles")}return a.getResourceBundle().getText("ContentFinder.AppBoxContainer.Title.AllTiles",s)}if(l){return a.getResourceBundle().getText("ContentFinder.AppBoxContainer.Title.NoCards")}return a.getResourceBundle().getText("ContentFinder.AppBoxContainer.Title.AllCards",s)},onAppBoxSelected:function(){var e=this.oModel.getProperty(this.oBindingPath+"/tiles").filter(function(e){return e.selected&&!e.disabled}).length;if(this.oParentContentFinderDialogModel){this.oParentContentFinderDialogModel.setProperty("/selectedAppCount",e)}this.oModel.setProperty(this.oBindingPath+"/selectedAppCount",e);this._setSelectAllButton()},onCardAppBoxPressed:function(e){this.getOwnerComponent().fireEvent("cardSelected",e)},onSelectAllPressed:function(e){var t=e.getParameter("pressed");var i=this._getGridContainer();i.getItems().forEach(function(e){if(!e.getDisabled()){e.setSelected(t)}});this.onAppBoxSelected();this._setSelectAllButton();var r=this.oModel.getProperty(this.oBindingPath+"/showSelectedPressed");if(!t&&r){this.byId("ShowSelectedToggleBtn").setPressed(false).firePress()}},onShowSelectedPressed:function(e){this._updateFiltersAfterShowSelectedChange(e.getParameter("pressed"))},_updateFiltersAfterShowSelectedChange:function(e){if(e){this.byId("AppBoxSearch").clear();this._oFilters.oSelectFilter=new t("selected",i.EQ,true);this._applyFilters()}else{this.resetFilters(["oSelectFilter","oSearchFilter"]);this.byId("AppBoxSearch").clear()}},_updateFiltersAfterSelectionChange:function(e){var r=e.isLeaf();var n=e.getTitle();var o=this.getView().getModel("i18n");var s=n===o.getResourceBundle().getText("ContentFinder.CategoryTree.Row.AllTiles")||n===o.getResourceBundle().getText("ContentFinder.CategoryTree.Row.AllCards");var l=this.getView().getModel();l.setProperty("/CurrentSelectedTreeNode",n);if(s||!r){this.resetFilters(["oCatalogFilter"])}else{var a=!!l.getProperty("/roles")[n];if(a){var d=l.getProperty("/roles")[n];this._oFilters.oCatalogFilter=new t({filters:d.map(function(e){return new t("catalogId",i.EQ,e)}),and:false})}else{this._oFilters.oCatalogFilter=new t("catalogId",i.EQ,n)}var h=this.byId("ShowSelectedToggleBtn");if(h.getPressed()){h.setPressed(false);this._updateFiltersAfterShowSelectedChange(false)}this._applyFilters()}this.byId("ContentFinderAppSearchDynamicSideContent").toggle()},_resetPreviews:function(){this.oModel.setProperty(this.oBindingPath+"/tilePreviewShown",false);this.oModel.setProperty(this.oBindingPath+"/cardPreviewShown",false);this.oModel.getProperty(this.oBindingPath+"/tiles").forEach(function(e){e.showPreview=false});this.oModel.getProperty(this.oBindingPath+"/cards").forEach(function(e){e.showPreview=false});this.oModel.refresh(true)},_setSelectAllButton:function(){var e=this._getGridContainer();var t=e.getItems().length;var i=e.getItems().filter(function(e){return e.getSelected()}).length;var r=t!==i;this.oModel.setProperty(this.oBindingPath+"/hasSelectables",r);this.oModel.setProperty(this.oBindingPath+"/appBoxCount",t)},_cardAppBoxFactory:function(e,t){var i=new n({columns:"{= ${showPreview} ? 2 : 1}",rows:"{= ${showPreview} ? 2 : 1}"});return new r({id:"ContentFinderAppBoxCard-"+e,appId:"{appId}",dataHelpId:"{dataHelpId}",disabled:"{disabled}",disablePreview:"{= !${showPreview} && ${/cardPreviewShown}}",gridGapSize:.75,icon:"{icon}",info:"{info}",launchUrl:"{launchUrl}",previewSize:"Large",posinset:"{posinset}",selectable:false,setsize:"{setsize}",showExtraInformation:true,showPreview:"{showPreview}",subtitle:"{subtitle}",systemInfo:"{systemInfo}",title:"{title}",type:"{type}",visible:"{visible}",previewShown:this.showPreview.bind(this),press:this.onCardAppBoxPressed.bind(this),layoutData:i})},resetFilters:function(e){var t=["oSearchFilter","oSelectFilter","oCatalogFilter"];if(!e){e=Object.keys(this._oFilters)}e.forEach(function(e){if(!t.includes(e)){o.error("Invalid filter provided. Skipping.",null,"sap.ushell.components.ContentFinderAppSearch.controller.ContentFinderAppSearch");return}delete this._oFilters[e]}.bind(this));this._applyFilters()}})});
//# sourceMappingURL=ContentFinderAppSearch.controller.js.map