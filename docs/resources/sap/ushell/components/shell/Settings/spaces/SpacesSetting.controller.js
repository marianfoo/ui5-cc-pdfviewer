// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ushell/EventHub","sap/ushell/Config","sap/ushell/resources","sap/ushell/utils"],function(e,s,t,r,o,a){"use strict";return e.extend("sap.ushell.components.shell.Settings.spaces.SpacesSetting",{onInit:function(){var e=this.getView().getViewData();this.oUserInfoService=e.UserInfo;var a=this.oUserInfoService.getUser();var i=r.last("/core/spaces/enabled");var n=r.last("/core/homeApp/enabled");var p=r.last("/core/spaces/myHome/enabled");var l=i&&p&&!n;var c=a.getShowMyHome();var d=a.getImportBookmarksFlag();var m=d!=="done"&&d!=="not_required";var h=new s({spaces:{visible:r.last("/core/spaces/configurable"),selected:i},hideEmptySpaces:{visible:i&&r.last("/core/spaces/hideEmptySpaces/enabled"),selected:r.last("/core/spaces/hideEmptySpaces/userEnabled")},showMyHome:{visible:l,selected:c},showMyHomeImport:{visible:l&&c&&m,selected:d==="pending"}});this.getView().setModel(h);this.getView().setModel(o.getTranslationModel(),"i18n");this.oImportBookmarksFlagListener=t.on("importBookmarksFlag").do(this._setMyHomeImportSelected.bind(this))},_setMyHomeImportSelected:function(e){var s=this.getView().getModel();s.setProperty("/showMyHomeImport/selected",e)},onExit:function(){this.oImportBookmarksFlagListener.off()},onSave:function(){var e=false;var s=false;var o=[];var i=this.getView().getModel();var n=this.oUserInfoService;var p=n.getUser();var l=r.last("/core/spaces/enabled");var c=i.getProperty("/spaces/selected");var d=r.last("/core/spaces/hideEmptySpaces/userEnabled");var m=i.getProperty("/hideEmptySpaces/selected");var h=p.getShowMyHome();var g=i.getProperty("/showMyHome/selected");var y=p.getImportBookmarksFlag()==="pending";var u=i.getProperty("/showMyHomeImport/selected");if(l!==c){p.setChangedProperties({propertyName:"spacesEnabled",name:"SPACES_ENABLEMENT"},l,c);s=true;e=true}if(h!==g){p.setShowMyHome(g);s=true;e=true}if(y!==u){var v=u?"pending":"dismissed";p.setImportBookmarksFlag(v);s=true;if(!e){t.emit("importBookmarksFlag",u)}}if(d!==m){var f=a.setHideEmptySpacesEnabled(m).catch(function(e){i.setProperty("/hideEmptySpaces/selected",d);return Promise.reject(e)});o.push(f)}if(!s&&!o.length){return Promise.resolve()}if(s){var S=new Promise(function(e,s){n.updateUserPreferences().done(function(){p.resetChangedProperty("spacesEnabled");p.resetChangedProperty("showMyHome");p.resetChangedProperty("importBookmarks");e()}).fail(function(e){i.setProperty("/spaces/selected",l);i.setProperty("/showMyHome/selected",h);p.resetChangedProperty("spacesEnabled");p.resetChangedProperty("showMyHome");p.resetChangedProperty("importBookmarks");s(e)})});o.push(S)}return Promise.all(o).then(function(){return{refresh:e,noHash:true}})},onCancel:function(){var e=this.getView().getModel();e.setProperty("/spaces/selected",r.last("/core/spaces/enabled"));e.setProperty("/showMyHome/selected",this.oUserInfoService.getUser().getShowMyHome());e.setProperty("/hideEmptySpaces/selected",r.last("/core/spaces/hideEmptySpaces/userEnabled"))}})});
//# sourceMappingURL=SpacesSetting.controller.js.map