// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/Config","sap/ui/Device","sap/ui/thirdparty/jquery"],function(t,e,jQuery){"use strict";var i=function(t){this.init(t)};i.prototype={settings:null,tileWidth:0,tileHeight:0,tileMargin:0,curTouchMatrixCords:null,tilesInRow:null,groupsList:null,item:null,matrix:null,tiles:null,collisionLeft:false,startGroup:null,currentGroup:null,endGroup:null,init:function(t){this.curTouchMatrixCords={column:null,row:null};this.endGroup=null;this.groupSwitched=false;this.item=null;this.matrix=null;this.tiles=null;this.collisionLeft=false;this.startArea=null;this.currentArea=null;this.endArea=undefined;this.startGroup=null;this.draggedTileDomRef=null;this.sDragStartGroupModelId=undefined;this.sDragTargetGroupModelId=undefined;this.currentGroup=null;this.groupsList=null;this.allGroups=null;this.settings=this.settings||t;jQuery.extend(this,this.settings);this.tileWidth=this.thisLayout.styleInfo.tileWidth;this.tileHeight=this.thisLayout.styleInfo.tileHeight;this.tileMargin=this.thisLayout.styleInfo.tileMarginWidth;this.aExcludedControlClass=this.aExcludedControlClass||[];this.reorderElementsCallback=this.reorderElementsCallback||function(){};this.rightToLeft=sap.ui.getCore().getConfiguration().getRTL();this.tabBarArrowCollisionRight=false;this.tabBarArrowCollisionLeft=false;this.collidedLinkAreas=[];this.intersectedLink=null;this.aLinksBoundingRects=[];this.intersectedLinkPlaceHolder=undefined;this.isLinkPersonalizationSupported=this.thisLayout.oLaunchPageService?this.thisLayout.oLaunchPageService.isLinkPersonalizationSupported():null;this.isLinkMarkerShown=false;this.bIsTabBarCollision=false},moveDraggable:function(t,e,i){var r=this.getCollisionObject(t,e,i),s;if(r){this._toggleAnchorItemHighlighting(false);if(r.collidedObjectType!=="TabBar"){this._toggleTabBarOverflowArrows(false);this.thisLayout.setOnTabBarElement(false);this._resetOverFlowButtonElements();this.bIsTabBarCollision=false}else{this.bIsTabBarCollision=true;this._toggleTabBarOverflowArrows(true);this.removePlaceHolders();this._handleTabBarCollision(t,i)}if(this.isLinkPersonalizationSupported&&r.collidedObjectType==="Group-link"){s=this._handleLinkAreaIntersection(r.collidedObject,t,e)}else if(r.collidedObjectType==="Group-tile"){s=this._handleTileAreaIntersection(r.collidedObject,t,e);this._toggleTileCloneHoverOpacity(false)}if(s||this.endAreaChanged){this.handlePlaceHolder(r.collidedObject)}}else{this._removeEmptyLinkAreaMark()}},_toggleAnchorItemHighlighting:function(t){if(this.targetGroup){this.targetGroup.classList.toggle("sapUshellAnchorItemDropCollision",t);this.targetGroup.firstElementChild.classList.toggle("sapUshellAnchorInnerMarker",t)}},removePlaceHolders:function(){this._removeLinkDropMarker();this._removeEmptyLinkAreaMark();this._handleChangedGroup(this.currentGroup)},handlePlaceHolder:function(t){if(this.endArea==="tiles"){if(this.endAreaChanged){this._removeLinkDropMarker()}this.handlePlaceholderChange()}else if(this.endArea==="links"&&this.intersectedLink){this._changeLinkPlaceholder(this.intersectedLink,t);if(this.endAreaChanged){this.handlePlaceholderChange()}}},switchLinkWithClone:function(t){if(t){this.intersectedLinkPlaceHolder=t.getDomRef().cloneNode(true);this.intersectedLinkPlaceHolder.id="sapUshellIntersectedLinkPlaceHolder";jQuery(t.getDomRef()).replaceWith(this.intersectedLinkPlaceHolder)}},_removeLinkDropMarker:function(){jQuery("#sapUshellLinkDropMarker").remove();this.isLinkMarkerShown=false},saveLinkBoundingRects:function(t){var e=sap.ui.getCore().byId(t.id);this.draggedLinkBoundingRects=e.getBoundingRects()},_getMarkerOffset:function(t,e){var i=jQuery(e.getDomRef()).find(".sapUshellLineModeContainer")[0].getBoundingClientRect().left,r=jQuery(e.getDomRef()).find(".sapUshellLineModeContainer")[0].getBoundingClientRect().top,s=this.rightToLeft?20:-1,n=this.rightToLeft?42:21,o=t[t.length-1].offset.x-i+t[t.length-1].width-s,a=t[this.rightToLeft?t.length-1:0].offset.x-i-n,l=t[this.rightToLeft?t.length-1:0].offset.y-r,h=t[this.rightToLeft?0:t.length-1].offset.y-r;if(jQuery("body.sapUiSizeCompact").length){l-=6;h-=6}if(this.rightToLeft){if(jQuery(e.getDomRef()).find(".sapUshellLineModeContainer")[0].getBoundingClientRect().right-t[t.length-1].offset.x-t[t.length-1].width<16){o=o-8}}else if(a<16){a=0}return{right:o,left:a,topLeft:l,topRight:h}},_changeLinkPlaceholder:function(t,e){var i=this.aLinksBoundingRects[t.link.getId()],r=i.left,s=i.topLeft,n=i.topRight,o=i.right;if(jQuery(e.getDomRef()).find("#sapUshellLinkDropMarker").length===0){this._removeLinkDropMarker();jQuery(e.getDomRef()).find(".sapUshellLinksInnerContainer").prepend(this.LinkDropMarker)}jQuery(this.LinkDropMarker).css({left:t.leftSide?r:o,top:t.leftSide?s:n});this.isLinkMarkerShown=true},showTilePlaceholder:function(t,e,i){var r,s=this.curTouchMatrixCords.row,n=this.curTouchMatrixCords.column;this.domRef=this.item.getDomRef()?this.item.getDomRef():this.domRef;jQuery(this.domRef).show();this.removeExcludedElementsFromMatrix(this.aExcludedControlClass);r=this.tiles||this.thisLayout.getGroupTiles(this.endGroup).slice(0);if(this.matrix[s]&&typeof this.matrix[s][n]==="object"){this.handleMatrixCollision(r,t,e,i);return}this._handleMoveOutOfBorders(r,t)},removeTilePlaceholder:function(){this.domRef=this.item.getDomRef()?this.item.getDomRef():this.domRef;var t=this.thisLayout.getGroupTiles(this.currentGroup);t=t.slice(0);if(this.startArea!=="links"&&t.indexOf(this.item)>-1){t.splice(t.indexOf(this.item),1)}if(!jQuery(this.domRef.parentNode).hasClass("sapUshellLinksInnerContainer")){jQuery(this.domRef).hide()}this.thisLayout.initGroupDragMode(this.endGroup);var e=this.thisLayout.organizeGroup(t);this.thisLayout.renderLayoutGroup(this.currentGroup,e)},handlePlaceholderChange:function(){var t=this.currentGroup,e=this.endGroup!==this.currentGroup,i=this.endAreaChanged&&this.endArea==="links",r=this.thisLayout.isTabBarActive()&&this.groupSwitched;this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0);this.matrix=this.thisLayout.organizeGroup(this.tiles);if(r){this.handleTabBarSwitch(t)}if(e){this._handleChangedGroup(t)}else if(i){this.removeTilePlaceholder()}if(!i){this.showTilePlaceholder(t,e,i)}},handleMatrixCollision:function(t,e,i,r){var s,n,o,a;s=this.matrix[this.curTouchMatrixCords.row][this.curTouchMatrixCords.column];n=t.indexOf(s);o=t.indexOf(this.item);if(this.rightToLeft){this.collisionLeft=!this.collisionLeft}if(o>-1&&o<n){s=t[n+1]}if(s===this.item){if(i||r){t.splice(t.indexOf(this.item),1)}this._handleTileReplace(t,e);return}a=this.changeTilesOrder(this.item,s,t,this.matrix);if(a&&!this.isLinkMarkerShown){this._handleTileReplace(a,e)}},handleTabBarSwitch:function(t){this._appendTargetGroupDomRefWithDraggedTile();if(!this.item.getDomRef()){this.endGroup.getInnerContainersDomRefs()[0].appendChild(this.draggedTileDomRef)}else{this.endGroup.getInnerContainersDomRefs()[0].appendChild(this.item.getDomRef())}this.currentGroup=this.endGroup;var e=this.thisLayout.getGroupTiles(t);this.thisLayout.initGroupDragMode(this.endGroup);var i=this.thisLayout.organizeGroup(e);this.thisLayout.renderLayoutGroup(t,i)},_handleMoveOutOfBorders:function(t,e){var i=this.findTileToPlaceAfter(this.matrix,t),r;if(t[i+1]==this.item){return}if(t[i+1]){r=t[i+1]}else if(this.currentGroup.getShowPlaceholder()){r=t[0]}var s=this.changeTilesOrder(this.item,r,t,this.matrix);if(s){this._handleTileReplace(s,e)}},_handleChangedGroup:function(t){var e=this.thisLayout.getGroupTiles(this.currentGroup),i;if(this.currentGroup===this.startGroup&&(this.startArea==="tiles"||this.intersectedLinkPlaceHolder)){e=e.slice(0);if(e.indexOf(this.item)>-1){e.splice(e.indexOf(this.item),1)}}if(this.startGroup===this.endGroup&&this.startArea==="tiles"){this.tiles.splice(this.tiles.indexOf(this.item),1)}i=this.item.getDomRef()||this.domRef;if(this.startArea==="links"&&!this.intersectedLinkPlaceHolder){this.switchLinkWithClone(this.item)}if(this.endArea==="tiles"){this.endGroup.getInnerContainersDomRefs()[0].appendChild(i)}if(!jQuery(i.parentNode).hasClass("sapUshellLinksInnerContainer")){jQuery(i).hide()}this.currentGroup=this.endGroup;this.thisLayout.initGroupDragMode(this.endGroup);var r=this.thisLayout.organizeGroup(e);this.thisLayout.renderLayoutGroup(t,r)},_handleTileReplace:function(t,e){this.reorderElementsCallback({currentGroup:e,endGroup:this.endGroup,tiles:t,item:this.item});this.reorderTilesView(t,this.endGroup);this.reorderTilesInDom();this.thisLayout.renderLayoutGroup(this.endGroup,this.matrix)},_getIntersectedLink:function(t,e,i){var r=jQuery(".sapUshellLinkTile")[0];if(!r){return}var s=t.getDomRef().querySelector(".sapUshellLineModeContainer").getBoundingClientRect(),n=!jQuery("body.sapUiSizeCompact").length,o=Math.floor((i-s.top)/(n?45:31)),a=this.collidedLinkAreas[t.getId()],l;if(this.rightToLeft){l=Math.floor((s.right-e)/20)}else{l=Math.floor((e-s.left)/20)}if(o<a.length&&a[o]&&l<a[o].length){return a[o][l]}else if(a.length){var h=a.length;if(o>=h){o=h-1}if(!this.collidedLinkAreas[t.getId()][o]){return}l=this.collidedLinkAreas[t.getId()][o].length;return this.collidedLinkAreas[t.getId()][o][l-1]}},_mapGroupLinks:function(t){var e=t.getId(),i,r,s=0;if(!this.collidedLinkAreas[e]||this.bElapseGroupLinksMap){this.bElapseGroupLinksMap=false;var n=t.getLinks(),o=[];this.collidedLinkAreas.push(t.getId());n.forEach(function(e){r=this._getLinkBoundingRects(e,t);r.forEach(function(r){if(r.offset.y>i){s++}i=r.offset.y;this._addLinkToHashMap(o,t,r,s,e)}.bind(this))}.bind(this));this.collidedLinkAreas[e]=o}},_getLinkBoundingRects:function(t,e){var i=t.getBoundingRects();if(this.item&&this.item.getId()===t.getId()){i=this.draggedLinkBoundingRects}if(i.length){this.aLinksBoundingRects[t.getId()]=this._getMarkerOffset(i,e)}return i},_addLinkToHashMap:function(t,e,i,r,s){if(!t[r]){t[r]=[]}for(var n=0;n<=(i.width+20)/20;n++){var o={link:s,leftSide:!this.rightToLeft};if(n>(i.width+20)/20/2){o.leftSide=this.rightToLeft}t[r].push(o)}},_isLinkAreaIntersection:function(t,e,i){var r=t.getInnerContainersDomRefs();if(r[1]){return this._isElementCollideByGivenCordinates(r[1],e,i)}return false},_isLinksEquals:function(t,e){if(!t||!e){return false}if(t.link.getId()!==e.link.getId()){return false}return t.link.leftSide===e.link.leftSide},_toggleTileCloneHoverOpacity:function(t){jQuery(".sapUshellTile-clone").toggleClass("sapUshellTileDragOpacity",t)},_handleLinkAreaIntersection:function(t,e,i){var r,s=false;if(this.isLinkPersonalizationSupported){this._toggleTileCloneHoverOpacity(true)}this._mapGroupLinks(t);this.matrix=this.matrix||this.thisLayout.organizeGroup(this.thisLayout.getGroupTiles(t));r=this._getIntersectedLink(t,e,i);if(r){s=this._isLinksEquals(this.intersectedLink,r);this.intersectedLink=r}else{this.removeTilePlaceholder()}this._markEmptyLinkArea(t);return s},_markEmptyLinkArea:function(t){if(!t.getLinks().length){jQuery(t.getDomRef()).find(".sapUshellLineModeContainer").addClass("sapUshellEmptyLinkAreaHover")}},_removeEmptyLinkAreaMark:function(){jQuery(".sapUshellLineModeContainer").removeClass("sapUshellEmptyLinkAreaHover")},reorderTilesInDom:function(){var t=this.item.getDomRef()?this.item.getDomRef():this.domRef,e=jQuery(t).index(),i=jQuery(t).closest(".sapUshellTilesContainer-sortable"),r=this.calcDestIndexInGroup(),s=jQuery(this.endGroup.getDomRef()).find(".sapUshellTilesContainer-sortable"),n=s.find(".sapUshellTile");if(this.startArea==="tiles"){i.find(n[e]).remove()}else if(!this.intersectedLinkPlaceHolder){this.switchLinkWithClone(this.item)}if(this.endArea!=="links"){n=s.find(".sapUshellTile");s[0].insertBefore(t,n[r])}},isLinkIntersected:function(){return this.intersectedLink!==undefined},calcDestIndexInGroup:function(){var t,e=0,i,r,s=false;for(i=0;i<this.matrix.length&&!s;i++){for(r=0;r<this.matrix[i].length;r++){if(this.matrix[i][r]!==undefined){if(this.item.sId!==this.matrix[i][r].sId){if(t!==this.matrix[i][r].sId){t=this.matrix[i][r].sId;e++}}else{s=true;break}}}}return e},layoutStartCallback:function(t){this.init();this.item=sap.ui.getCore().byId(t.id);this.tilesInRow=this.thisLayout.getTilesInRow();this.groupsList=this.thisLayout.getGroups();this.allGroups=this.thisLayout.getAllGroups();this.startGroup=this.currentGroup=this.item.getParent();this.groupSwitched=false;this.startArea=this.isLinkPersonalizationSupported&&this.item.getMode&&this.item.getMode()==="LineMode"?"links":"tiles";this.currentArea=this.startArea;this.thisLayout.initDragMode();if(this.isLinkPersonalizationSupported){this.LinkDropMarker=this._getLinkDropMarkerElement()}},_getLinkDropMarkerElement:function(){var t=document.createElement("DIV"),e=document.createElement("DIV"),i=document.createElement("DIV");t.setAttribute("id","sapUshellLinkDropMarker");e.setAttribute("id","sapUshellLinkDropMarkerDot");i.setAttribute("id","sapUshellLinkDropMarkerLine");t.appendChild(e);t.appendChild(i);return t},isAreaChanged:function(){return this.currentArea&&this.endArea?this.currentArea!==this.endArea:false},isOriginalAreaChanged:function(){return this.startArea&&this.endArea?this.startArea!==this.endArea:false},_getDestinationIndex:function(t){if(t==="links"){if(this.intersectedLink){var e=this.endGroup.getLinks().indexOf(this.intersectedLink.link),i=this.endGroup.getLinks().indexOf(this.item);if(this.intersectedLink.leftSide){e=this.rightToLeft?e+1:e-1}if(i<0||i>e){e=this.rightToLeft?e:e+1}return e}return this.endGroup.getLinks().length}return this._getDestinationTileIndex()},layoutEndCallback:function(){var t,e,i;this._removeLinkDropMarker();if(this.endArea!=="links"&&!this.tiles){return{tile:this.item}}e=this._getDragSourceGroup();if(!s.isTabBarActive()||!this.bIsTabBarCollision){this.targetGroup=""}i=this._getDestGroupObject(this.targetGroup);t={srcGroup:e,dstGroup:i,dstGroupData:this._getDropTargetGroup(),tile:this.item,dstTileIndex:this._getDestinationIndex(this.endArea),tileMovedFlag:true,srcArea:this.startArea,dstArea:this.bIsTabBarCollision?undefined:this.endArea};return t},_getDestGroupObject:function(t){return t?sap.ui.getCore().byId(t.getAttribute("id")):this.endGroup},_getDragSourceGroup:function(){var t;t=this.startGroup;if(this.thisLayout.isTabBarActive()&&this.groupSwitched===true){t={groupId:this.sDragStartGroupModelId}}return t},_getDropTargetGroup:function(){var t;if(this.thisLayout.isTabBarActive()&&this.thisLayout.isOnTabBarElement()){t={groupId:this.sDragTargetGroupModelId}}else{t=this.endGroup}return t},_getDestinationTileIndex:function(){var t,e;if(this.thisLayout.isTabBarActive()&&this.thisLayout.isOnTabBarElement()){t=this._getDropTargetGroup().groupId;e=this._getModelGroupById(t);return e.tiles.length}return this.tiles.indexOf(this.item)},compareArrays:function(t,e){if(t.length!==e.length){return false}for(var i=0;i<t.length;i++){if(t[i]!==e[i]){return false}}return true},reorderTilesView:function(t){this.tiles=t;this.matrix=this.thisLayout.organizeGroup(t)},changeTilesOrder:function(t,e,i,r){var s=i.slice(0),n=s.indexOf(t),o,a,l;if(n>-1){s.splice(n,1)}if(e){s.splice(s.indexOf(e),0,this.item)}else{s.push(t)}if(this.currentGroup==this.endGroup){if(this.compareArrays(i,s)){return false}o=this.thisLayout.organizeGroup(s);a=this.thisLayout.getTilePositionInMatrix(t,r);l=this.thisLayout.getTilePositionInMatrix(t,o);if(a.row==l.row&&a.col==l.col){return false}}this.tiles=s;this.currentGroup=this.endGroup;return s},setMatrix:function(t){this.matrix=t},findTileToPlaceAfter:function(t,e){var i=this.thisLayout.rightToLeft?0:this.curTouchMatrixCords.column,r=this.thisLayout.rightToLeft?1:-1,s=0,n,o,a,l=t[0].length;for(n=this.curTouchMatrixCords.row;n>=0;n--){for(o=i;o>=0&&o<l;o+=r){if(!t[n]||typeof t[n][o]!=="object"){continue}a=e.indexOf(t[n][o]);s=a>s?a:s}i=t[0].length-1}return s||e.length-1},_isElementCollideByGivenCordinates:function(t,e,i){var r=t.getBoundingClientRect(),s=false,n=false;if(r.height===0&&!t.classList.contains("sapUshellNoLinksAreaPresent")){r=t.parentNode.getBoundingClientRect()}s=r.right>=e&&r.left<=e;n=r.bottom>=i&&r.top<=i;return s&&n},_getMatrixCordinatesOfTouchedTile:function(t,e,i){var r=jQuery.extend({},this.curTouchMatrixCords),s=t.getInnerContainersDomRefs()[0].getBoundingClientRect();this.matrix=this.matrix||this.thisLayout.organizeGroup(this.thisLayout.getGroupTiles(t));var n=this.rightToLeft?s.right+-1*e:s.left*-1+e,o=(s.top*-1+i)/(this.tileHeight+this.tileMargin),a=n/(this.tileWidth+this.tileMargin);r={row:Math.floor(o),column:Math.floor(a)};return r},_getCollidedGroup:function(t,e){for(var i=0;i<this.groupsList.length;i++){var r=this.groupsList[i],s=r.getInnerContainersDomRefs();if(!s){continue}for(var n=0;n<s.length;n++){if(s[n]&&this._isElementCollideByGivenCordinates(s[n],t,e)){var o=!r.groupHasTiles();for(var a=this.groupsList.length-1;a>=i;a--){if(o){break}if(!this.groupsList[a].groupHasTiles()){var l=this.groupsList[a].$();if(!l.hasClass("sapUshellInDragMode")){continue}l.find(".sapUshellInner").removeAttr("style")}}return r}}}},_handleTileAreaIntersection:function(t,e,i){var r=this._getMatrixCordinatesOfTouchedTile(t,e,i);if(t===this.endGroup&&r.column===this.curTouchMatrixCords.column&&r.row===this.curTouchMatrixCords.row){return false}if(this.rightToLeft){this.collisionLeft=this.curTouchMatrixCords.column-r.column>0}else{this.collisionLeft=r.column-this.curTouchMatrixCords.column>0}if(r.column===this.curTouchMatrixCords.column){this.collisionLeft=false}jQuery.extend(this.curTouchMatrixCords,r);return true},_getGroupCollisionObject:function(t,e){var i,r;i=this._getCollidedGroup(t,e);if(!i||i.getIsGroupLocked()){return undefined}r=this._isLinkAreaIntersection(i,t,e);this.endGroup=i;if(!this.tiles){this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0)}this.endArea=r?"links":"tiles";this.endAreaChanged=this.isAreaChanged();this.currentArea=this.endArea;return{collidedObjectType:r?"Group-link":"Group-tile",collidedObject:i}},getCollisionObject:function(t,e){if(this.thisLayout.oTabBarItemClickTimer){clearTimeout(this.thisLayout.oTabBarItemClickTimer)}if(this.thisLayout.isTabBarActive()&&this._isTabBarCollision(e)){return{collidedObjectType:"TabBar"}}return this._getGroupCollisionObject(t,e)},_isTabBarScrollArea:function(t){var e=jQuery("#anchorNavigationBar").height()||0,i=jQuery("#anchorNavigationBar").offset(),r=i?i.top:0,s=e+r;return e>0&&t>s&&t<s+30},_cancelLongDropTimmer:function(){clearTimeout(this.thisLayout.oTabBarItemClickTimer)},_isTabBarCollision:function(t){var e=jQuery("#anchorNavigationBar").height()||0,i=jQuery("#anchorNavigationBar").offset(),r=i?i.top:0;return t<e+r&&t>r},_handleTabBarCollision:function(t,e){var i=this,r=this._getTabBarHoverItem(t,e),n,o,a,l,h;if(s.isTabBarActive()){this._toggleTileCloneHoverOpacity(true)}this.lastHighlitedTabItem=r;this.thisLayout.setOnTabBarElement(true);a=this._handleOverflowCollision(t);if(a){return}if(!r){return}this.targetGroup=r;this.sDragTargetGroupModelId=r.getAttribute("modelGroupId");n=this._getTabBarGroupIndexByModelId(this.sDragTargetGroupModelId);if(this.thisLayout.oTabBarItemClickTimer){clearTimeout(this.thisLayout.oTabBarItemClickTimer)}h=this._getModelGroupById(this._getDropTargetGroup().groupId);if(h.isGroupLocked){this._toggleTabBarOverflowArrows(false);this.thisLayout.setOnTabBarElement(false);this._resetOverFlowButtonElements();return}this._toggleAnchorItemHighlighting(true);if(!this.sDragStartGroupModelId){this.sDragStartGroupModelId=this.startGroup.getGroupId()}this.thisLayout.oTabBarItemClickTimer=setTimeout(function(){var t=i._getSelectedTabBarItem();if(i.lastHighlitedTabItem===t){return}i.draggedTileModelPath=i.item.getBindingContext().getPath();i._prepareDomForDragAndDrop();i.startGroup.removeAggregation("tiles",i.item,true);l=i.sDragStartGroupModelId===i.sDragTargetGroupModelId;i.item.getBindingContext().oModel.setProperty(i.draggedTileModelPath+"/draggedInTabBarToSourceGroup",l);i.groupSwitched=true;sap.ui.getCore().getEventBus().publish("launchpad","switchTabBarItem",{iGroupIndex:n});var e=i.thisLayout.getGroups();i.endGroup=e[0];i.bElapseGroupLinksMap=true},800);if(this.tiles===null&&this.endGroup){this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0)}o=jQuery(".sapUshellTabBarHoverOn");o.removeClass("sapUshellTabBarHoverOn");r.classList.add("sapUshellTabBarHoverOn");return true},_prepareDomForDragAndDrop:function(){if(e.system.tablet){var t=this.item.$().clone();var i=this.item.$();var r=i.parent();this.origItemId=i.attr("id");this.origItemDataSapUi=i.attr("data-sap-ui");i.removeAttr("id").removeAttr("data-sap-ui");i.hide();t.hide();jQuery("#dashboardGroups").parent().append(i);r.append(t);this.draggedTileDomRef=i.get(0)}else if(!this.draggedTileDomRef){this.draggedTileDomRef=this.item.getDomRef()}},_appendTargetGroupDomRefWithDraggedTile:function(){var t=this.endGroup.getInnerContainerDomRefs()?this.endGroup.getInnerContainerDomRefs()[0]:null;if(!this.item.getDomRef()){if(e.system.tablet){jQuery(this.draggedTileDomRef).attr("id",this.origItemId);jQuery(this.draggedTileDomRef).attr("data-sap-ui",this.origItemDataSapUi);jQuery(this.draggedTileDomRef).show()}if(t){t.appendChild(this.draggedTileDomRef)}}else{if(t){t.appendChild(this.item.getDomRef())}if(e.system.tablet){jQuery(this.item.getDomRef()).show()}}},_getSelectedTabBarItem:function(){return jQuery(".sapUshellAnchorItemSelected")[0]},_getTabBarGroupIndexByModelId:function(t){var e,i;for(e=0;e<this.allGroups.length;e++){i=this.allGroups[e].groupId;if(t===i){return e}}},_getModelGroupById:function(t){var e=this.thisLayout.getAllGroups(),i,r,s;for(i=0;i<e.length;i++){r=e[i];s=r.groupId;if(s===t){return r}}},_handleOverflowCollision:function(t){var e=sap.ui.getCore().byId("anchorNavigationBar"),i=this._calculateOverflowButtonSideCollision(t);if(i=="right"){if(!this.tabBarArrowCollisionRight){e._scrollToGroupByGroupIndex(e.anchorItems.length-1,5e3);this.tabBarArrowCollisionRight=true}return true}else if(i=="left"){if(!this.tabBarArrowCollisionLeft){e._scrollToGroupByGroupIndex(0,5e3);this.tabBarArrowCollisionLeft=true}return true}this._resetOverFlowButtonElements();return false},_calculateOverflowButtonSideCollision:function(t){var e=jQuery(".sapUshellAnchorRightOverFlowButton"),i=e.offset().left,r=jQuery(".sapUshellAnchorItemOverFlow"),s=r.offset().left,n=jQuery(".sapUshellAnchorLeftOverFlowButton"),o=n.offset().left,a=32,l=jQuery("#anchorNavigationBar"),h=l.offset().left;if(t>i&&t<s){return"right"}if(t>h&&t<o+a){return"left"}},_resetOverFlowButtonElements:function(){var t=e.system.tablet,i=jQuery(t?".sapUshellAnchorNavigationBarItemsScroll":".sapUshellAnchorNavigationBarItems");i.stop();this.tabBarArrowCollisionRight=false;this.tabBarArrowCollisionLeft=false},_toggleTabBarOverflowArrows:function(t){var e=jQuery(".sapUshellAnchorRightOverFlowButton"),i=jQuery(".sapUshellAnchorLeftOverFlowButton");i.toggleClass("sapUshellTabBarOverflowButton",t);e.toggleClass("sapUshellTabBarOverflowButton",t)},_getTabBarHoverItem:function(t,e){var i,r,s,n,o;r=jQuery(".sapUshellAnchorItem:not(.sapUshellShellHidden)").eq(0).offset().left;if(t-r<=0){return}i=Math.round((t-r)/10);if(i>=e.length){i=e.length-1}s=e[i];n=jQuery(".sapUshellAnchorItem");o=n[s];return o},removeExcludedElementsFromMatrix:function(t){if(!t.length){return}if(!this.matrix){return}var e=this.matrix.map(function(e){return e.map(function(e){var i=t.some(function(t){return e instanceof t});return i?undefined:e})});this.setMatrix(e)},setExcludedControl:function(t){if(t){this.aExcludedControlClass.push(t)}},setReorderTilesCallback:function(t){if(typeof t==="function"){this.reorderElementsCallback=t}}};var r=function(){};r.prototype={_initDeferred:jQuery.Deferred(),init:function(t){var e=function(){if(this.container&&this.container.id&&this.container.id.includes("destroyed")){return}var t=this.getStyleInfo(this.container);if(t.tileWidth>0){this.isInited=true;this.reRenderGroupsLayout();this.layoutEngine=new i({thisLayout:this});this._initDeferred.resolve();return}setTimeout(e,100)}.bind(this);this.cfg=t||this.cfg;this.minTilesinRow=2;this.container=this.cfg.container||document.getElementById("dashboardGroups");this.oTabBarItemClickTimer=new Date;this.bTabBarModeActive=false;this.bOnTabBarElement=false;if(sap.ushell.Container){sap.ushell.Container.getServiceAsync("LaunchPage").then(function(t){this.oLaunchPageService=t;e()}.bind(this))}else{e()}sap.ui.getCore().getEventBus().subscribe("launchpad","tabBarChange",this._onTabBarChange,this);return this.getInitPromise()},setOnTabBarElement:function(t){this.bOnTabBarElement=t},isOnTabBarElement:function(){return this.bOnTabBarElement},_onTabBarChange:function(t,e,i){if(i==="tabs"){this.bTabBarModeActive=true}else{this.bTabBarModeActive=false}},tabBarTileDropped:function(){if(this.oTabBarItemClickTimer){clearTimeout(this.oTabBarItemClickTimer)}},getInitPromise:function(){return this._initDeferred.promise()},getLayoutEngine:function(){return this.layoutEngine},getStyleInfo:function(e){var i=document.createElement("div"),r=e.getAttribute("id");e=r?document.getElementById(r):e;i.className="sapUshellTile";var s=t.last("/core/home/sizeBehavior");if(s==="Small"){i.classList.add("sapUshellSmall")}i.style.position="absolute";i.style.visibility="hidden";e.appendChild(i);var n=window.getComputedStyle(i);var o=window.getComputedStyle(e);var a={tileMarginHeight:parseFloat(n.marginBottom,10)+parseFloat(n.marginTop,10),tileMarginWidth:parseFloat(n.marginLeft,10)+parseFloat(n.marginRight,10),tileWidth:i.offsetWidth,tileHeight:i.offsetHeight,containerWidth:o.width?parseInt(o.width,10):e.offsetWidth};e.removeChild(i);return a},getGroups:function(){return this.cfg.getGroups()},getAllGroups:function(){return this.cfg.getAllGroups?this.cfg.getAllGroups():[]},isTabBarActive:function(){return this.cfg.isTabBarActive?this.cfg.isTabBarActive():false},getTilesInRow:function(){return this.tilesInRow},setTilesInRow:function(t){this.tilesInRow=t},checkPlaceForTile:function(t,e,i,r,s){if(typeof e[i.y]==="undefined"){e.push(new Array(e[0].length))}if(typeof e[i.y+1]==="undefined"){e.push(new Array(e[0].length))}if(typeof e[i.y][i.x]!=="undefined"){return false}var n=jQuery.extend({},i);if(s||t&&t.getLong&&!t.getLong()){return[n]}var o=[n];if(t&&t.getLong&&t.getLong()){if(i.x+1>=e[0].length||typeof e[n.y][n.x+1]!=="undefined"){return false}o.push({y:n.y,x:n.x+1})}return o},placeTile:function(t,e,i){for(var r=0;r<i.length;r++){e[i[r].y][i[r].x]=t}},getTilePositionInMatrix:function(t,e){for(var i=0;i<e.length;i++){for(var r=0;r<e[0].length;r++){if(e[i][r]===t){return{row:i,col:r}}}}return false},fillRowsInLine:function(t,e,i,r){if(!e.length){return 0}var s;for(var n=0;n<t[0].length&&e.length;n++){s=this.checkPlaceForTile(e[0],t,{x:n,y:i},r);if(s){this.placeTile(e[0],t,s);e.shift()}}},organizeGroup:function(t,e){var i=t.slice(0);var r=[];var s=0;r.push(new Array(e?Math.floor(this.tilesInRow/2):this.tilesInRow));while(i.length){this.fillRowsInLine(r,i,s,e);s++}if(this.rightToLeft){for(var n=0;n<r.length;n++){r[n].reverse()}}r=this.cleanRows(r);return r},cleanRows:function(t){var e=false;for(var i=t.length-1;i>0&&!e;i--){for(var r=0;r<t[i].length&&!e;r++){if(typeof t[i][r]==="object"){e=true}}if(!e){t.pop()}}return t},setGroupsLayout:function(t,e){if(t.getIsGroupLocked()&&e.length>0){var i=t.getDomRef().parentElement;t.getDomRef().style.width="";i.style.width="";i.style.display=""}},calcTilesInRow:function(t,e,i){var r=Math.floor(t/(e+i));r=r<this.minTilesinRow?this.minTilesinRow:r;return r},getGroupTiles:function(t){var e=t.getTiles();if(t.getShowPlaceholder()){e.push(t.oPlusTile)}return e},reRenderGroupsLayout:function(t){if(!this.isInited){return}var e=this.getStyleInfo(this.container);if(!e.tileWidth){return}this.styleInfo=e;this.tilesInRow=this.calcTilesInRow(e.containerWidth,e.tileWidth,e.tileMarginWidth);t=t||this.getGroups();for(var i=0;i<t.length;i++){if(t[i].getDomRef&&!t[i].getDomRef()){continue}var r=this.getGroupTiles(t[i]);var s=this.organizeGroup(r);this.setGroupsLayout(t[i],s)}},initDragMode:function(){this.initGroupDragMode(this.layoutEngine.currentGroup)},endDragMode:function(){var t=this.getGroups();for(var e=0;e<t.length;e++){var i=t[e].$();if(!i.hasClass("sapUshellInDragMode")){continue}i.removeClass("sapUshellInDragMode");var r=this.getGroupTiles(t[e]);for(var s=0;s<r.length;s++){r[s].$().removeAttr("style")}i.find(".sapUshellInner").removeAttr("style")}},initGroupDragMode:function(t){if(t.$().hasClass("sapUshellInDragMode")){return}var e=this.getGroupTiles(t);var i=this.organizeGroup(e);t.$().addClass("sapUshellInDragMode");this.renderLayoutGroup(t,i)},calcTranslate:function(t,e){var i=e*(this.styleInfo.tileWidth+this.styleInfo.tileMarginWidth);var r=t*(this.styleInfo.tileHeight+this.styleInfo.tileMarginHeight);if(this.layoutEngine.rightToLeft){i=-i}return{x:i,y:r}},renderLayoutGroup:function(t,e){var i;this.styleInfo=this.getStyleInfo(this.container);for(var r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++){if(i===e[r][s]){continue}else{i=e[r][s]}if(typeof i==="undefined"){break}}}}};var s=new r;return s},false);
//# sourceMappingURL=Layout.js.map