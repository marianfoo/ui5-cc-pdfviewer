// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/support/Plugin","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/Label","sap/m/Text","sap/m/MessageStrip","sap/m/FlexBox","sap/ui/model/resource/ResourceModel","sap/m/SearchField","sap/m/MessageBox","sap/base/util/isEmptyObject"],function(e,t,i,n,r,o,a,s,u,p,l,f,g){"use strict";var c=this,d,y=e.extend("sap.ushell.support.plugins.flpConfig.FlpConfigurationPlugin",{constructor:function(t){d=new p({bundleName:"sap/ushell/support/plugins/flpConfig/i18n/FlpConfigurationPlugin"});e.apply(this,["sapUiFlpConfigurationPlugin",d.getResourceBundle().getText("PLUGIN_NAME"),t]);this._oSupportStub=t;if(this.runsAsToolPlugin()){c=this;this._aEventIds=[this.getId()+"ReceiveData"]}else{this._aEventIds=[this.getId()+"RequestData"]}}});y.prototype.isToolPlugin=function(){return true};y.prototype.isAppPlugin=function(){return true};y.prototype.init=function(t){e.prototype.init.apply(this,arguments);if(this.runsAsToolPlugin()){var i;setTimeout(function(){c.requestData()},500);i=sap.ui.getCore().createRenderManager();i.write("<div id='"+this.getId()+"'</div>").flush(this.$().get(0));i.destroy()}else{}};y.prototype.exit=function(){e.prototype.exit.apply(this,arguments)};y.prototype.requestData=function(){this._oSupportStub.sendEvent(this.getId()+"RequestData",{eventData:{data:{}}})};y.prototype.onsapUiFlpConfigurationPluginRequestData=function(e){var t={};this.prepareForSending(window["sap-ushell-config"],t);this._oSupportStub.sendEvent(this.getId()+"ReceiveData",{eventData:{data:t}})};y.prototype.onsapUiFlpConfigurationPluginReceiveData=function(e){var t=this;this.flpConfig=e.getParameter("eventData").data;sap.ui.getCore().loadLibraries(["sap.ui.table"],{async:true}).then(function(){sap.ui.require(["sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/table/library"],function(e,i,n){var r=n.SelectionMode;t.getFlpConfigurationPluginUI(null,e,i,r)})})};function h(){var e=0,t=sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar").getSelectedKey(),i=sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar").getModel().getData();if(Array.isArray(i[t])){i[t].forEach(function(n,r){var o=C(i[t][r],t);if(e<o){e=o}});if(e>0){sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TreeTable"+t).expandToLevel(e-1)}else{f.error(new o({text:sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar").getModel("i18n").getResourceBundle().getText("MISSING_HIERARCHY_LEVEL")}))}}}function b(){var e=sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar").getSelectedKey();sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TreeTable"+e).collapseAll()}y.prototype.onPressSearchNewModel=function(e){var i,n,r,o,a,s,u,p,l,f=[],g={},c="",d={},y={},h=sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar").getModel("Full"),b=e.getParameter("query");if(!h){h=sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar").getModel().getData()}else{h=h.getData()}Object.keys(h).forEach(function(e){g[e]=0});if(b){for(var E in h){c=E;i=[];w(h[E],E,c,i,b);y[E]=i}Object.keys(y).forEach(function(e){o=y[e];for(var t=0;t<o.length;t++){a=o[t].split(".");s=[];for(var i=0;i<a.length;i++){if(!isNaN(parseInt(a[i],10))){s.push(parseInt(a[i],10))}else{s.push(a[i])}}for(var p=0;p<s.length;p+=2){u={property:""};u[s[0]]=[];if(isNaN(parseInt(s[p],10))){n=s.slice(0,p+1);if(!v(d,n)&&typeof v(d,s.slice(0,s.length-2))!=="object"){P(d,n,[u],s[0],n.length)}l=v(h,s.slice(0,p+2));if(l&&v(d,s.slice(0,p+2))){T(d,l.property,s.slice(0,p+2).toString()+",property")}else if(p!==s.length-2){f.push(s.slice(0,p+2).toString())}}}r=s.slice(0);P(d,s,{property:"",value:""},s[0],n.length);l=v(h,r);if(l){T(d,l.value,r.toString()+",value");T(d,l.property,r.toString()+",property")}}f.forEach(function(e){l=v(h,e.split(","));if(l&&v(d,e.split(","))){T(d,l.property,e+",property")}});f=[];if(d[e]&&Array.isArray(d[e][0][e])&&d[e][0][e].length===0){d[e]=d[e].splice(1)}});sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new t(d));sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new t(h),"Full");var x=0;Object.keys(g).forEach(function(e){p=e;if(d[p]&&Array.isArray(d[p])){d[p].forEach(function(e,t){var i=C(d[p][t],p);if(x<i){x=i}})}sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TreeTable"+e).expandToLevel(x-1);sap.ui.getCore().byId(e).setCount(I(d[e],e,0))})}else{Object.keys(g).forEach(function(e){sap.ui.getCore().byId(e).setCount(I(h[e],e,0))});sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new t(h))}};function C(e,t){var i=0;if(e[t]){e[t].forEach(function(e){var n=C(e,t);if(n>i){i=n}})}return i+1}function v(e,t){for(var i=0;i<t.length;i++){if(e){e=e[t[i]]}}return e}function I(e,t,i){if(Array.isArray(e)){e.forEach(function(e){if(e[t]){i=I(e[t],t,i)}else{i+=1}});return i}return undefined}function T(e,t,i){var n=i.split(",");for(var r=0;r<n.length-1;r++){e=e[n[r]]}e[n[n.length-1]]=t}function P(e,t,i,n,r){if(t.length===1){e[t[0]]=i}else{var o=t.shift();e[o]=P(typeof e[o]==="undefined"?{}:e[o],t,i,n,r)}if(e[n]&&e.property&&e.value){delete e.value;e.property=""}return e}function w(e,t,i,n,r){e.forEach(function(e,o){if(e[t]){i=i+"."+o+"."+t;i=w(e[t],t,i,n,r)}else if(e.property.indexOf(r)>-1){i=i+"."+o;n.push(i);i=i.substring(0,i.lastIndexOf("."))}});i=i.substring(0,i.lastIndexOf("."));if(isNaN(parseInt(i.substr(i.lastIndexOf(".")+1),10))){return i}return i.substring(0,i.lastIndexOf("."))}function E(e,t){if(typeof e!=="object"){return[{property:t,value:e}]}return Object.keys(e).map(function(i){var n={property:i};if(typeof e[i]==="object"&&Object.keys(e[i]).length!==0){n[t]=E(e[i],t);return n}if(!g(e[i])||typeof e[i]!=="object"){n.value=e[i]}else{n.value=""}return n})}y.prototype.prepareForSending=function(e,t){Object.keys(e).forEach(function(i){var n=e[i];switch(typeof n){case"object":if(n===null){t[i]=n;return}else if(Array.isArray(n)){t[i]=[]}else{t[i]={}}this.prepareForSending(e[i],t[i]);break;case"undefined":t[i]="undefined";return;case"function":return;default:t[i]=e[i];return}}.bind(this))};y.prototype.getNewConfigJSON=function(e){var t={};Object.keys(e).forEach(function(i){t[i]=E(e[i],i)});return t};y.prototype.getFlpConfigurationPluginUI=function(e,p,f,c){var y,C,v,T={};v=this.getNewConfigJSON(this.flpConfig);y=new t(v);for(var P in v){T[P]=I(v[P],P,0)}if(!sap.ui.getCore().byId("sap-ui-support-flpConfigurationPlugin-TabBar")){if(!v||g(v)){new s({text:d.getResourceBundle().getText("ERROR_MESSAGE"),type:"Warning",showIcon:true,showCloseButton:false}).placeAt(this.getId())}else{C=new n("sap-ui-support-flpConfigurationPlugin-TabBar",{headerMode:"Inline"});Object.keys(this.flpConfig).forEach(function(e,t){C.insertItem(new r(e,{key:e,text:e,count:T[e],content:[new p("sap-ui-support-flpConfigurationPlugin-TreeTable"+e,{rows:"{/"+e+"/}",selectionMode:c.None,enableCellFilter:true,extension:[new u({items:[new i({icon:"sap-icon://expand",text:"{i18n>EXPAND_BUTTON}",press:h}),new i({icon:"sap-icon://collapse",text:"{i18n>COLLAPSE_BUTTON}",press:b})]})],columns:[new f({label:new o({text:"{i18n>COLUMN_PROPERTY}"}),template:new a({text:"{property}"})}),new f({label:new o({text:"{i18n>COLUMN_VALUE}"}),template:new a({text:"{value}"})})]})]}),t)});var w=new l({search:this.onPressSearchNewModel});w.placeAt(this.getId());C.setModel(y);C.setModel(d,"i18n");C.placeAt(this.getId())}}};return y});
//# sourceMappingURL=FlpConfigurationPlugin.js.map