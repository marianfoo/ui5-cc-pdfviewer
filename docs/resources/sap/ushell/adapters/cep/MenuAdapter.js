// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/library","sap/ushell/utils/HttpClient","sap/base/Log","sap/ushell/Config"],function(e,t,n,i){"use strict";var r=e.ContentNodeType;var s="sap.ushell.adapters.cep.MenuAdapter";var a=function(e,i,r){if(r&&r.config&&r.config.serviceUrl&&r.config.siteId){this.httpClient=new t;this.serviceUrl=r.config.serviceUrl;this.siteId=r.config.siteId;this.oSiteDataPromise=this._doRequest(this.serviceUrl,this.siteId)}else{n.error("Invalid configuration provided.","",s)}};a.prototype.isMenuEnabled=function(){if(!i.last("/core/menu/enabled")){return Promise.resolve(false)}return this.getMenuEntries().then(function(e){return e.length>0})};a.prototype.getMenuEntries=function(){return this.oSiteDataPromise.then(this._getSpaces.bind(this)).then(this._buildMenuEntries.bind(this))};a.prototype.getContentNodes=function(){return this.oSiteDataPromise.then(this._getSpaces.bind(this)).then(this._buildContentNodes.bind(this))};a.prototype._buildMenuEntries=function(e){return e.filter(this._isSpaceNotEmpty.bind(null,"FLP menu")).map(function(e){var t={title:e.Descriptor.title||e.Id,"help-id":"Space-"+e.Id,description:e.Descriptor.description||"",icon:undefined,type:"IBN",target:{semanticObject:"Launchpad",action:"openFLPPage",parameters:[{name:"spaceId",value:e.Id},{name:"pageId",value:e.WorkPages.nodes[0].Id}],innerAppRoute:undefined},menuEntries:[]};var n=e.WorkPages.nodes.map(function(t){return{title:t.Descriptor.title||t.Id,"help-id":"Page-"+t.Id,description:t.Descriptor.description||"",icon:undefined,type:"IBN",target:{semanticObject:"Launchpad",action:"openFLPPage",parameters:[{name:"spaceId",value:e.Id},{name:"pageId",value:t.Id}],innerAppRoute:undefined},menuEntries:[]}});if(n.length>1){t.menuEntries=n}return t})};a.prototype._buildContentNodes=function(e){return e.filter(this._isSpaceNotEmpty.bind(null,"content nodes")).map(function(e){return{id:e.Id,label:e.Descriptor.title||e.Id,type:r.Space,isContainer:false,children:e.WorkPages.nodes.map(function(e){return{id:e.Id,label:e.Descriptor.title||e.Id,type:r.Page,isContainer:this._isTraditionalPage(e.Descriptor),children:[]}}.bind(this))}}.bind(this))};a.prototype.isWorkPage=function(e){return this.oSiteDataPromise.then(this._getSpaces.bind(this)).then(function(t){var n=t.flatMap(function(e){return e.WorkPages&&e.WorkPages.nodes||[]}).find(function(t){return t.Id===e});if(n){return!this._isTraditionalPage(n.Descriptor)}return false}.bind(this))};a.prototype._isTraditionalPage=function(e){if(e.pageType&&e.pageType.toLowerCase()===r.Page.toLowerCase()){return true}return false};a.prototype._doRequest=function(e,t){var i="{"+"Spaces("+'SiteId:"'+t+'"'+"){"+"nodes{"+"Id,"+'Descriptor(select:["/title"]),'+"WorkPages{"+"nodes{"+"Id,"+'Descriptor(select:["/title","/pageType","/description"])'+"}"+"}"+"}"+"}"+"}";return this.httpClient.get(e+"?query="+i,{headers:{"Content-Type":"application/json",Accept:"application/json","Accept-Language":sap.ui.getCore().getConfiguration().getLanguageTag()}}).then(function(e){if(e.status!==200){n.error(e.responseText,"",s);return Promise.reject("HTTP request to GraphQL service failed with status: "+e.status+" - "+e.statusText)}return JSON.parse(e.responseText||"{}")}).then(function(e){try{e.data.Spaces.nodes=e.data.Spaces.nodes.filter(function(e){return e.Id!=="default_space"})}catch(e){}return e})};a.prototype._getSpaces=function(e){if(e.data&&e.data.Spaces&&Array.isArray(e.data.Spaces.nodes)){return e.data.Spaces.nodes}n.warning("No spaces found for site-id: "+this.siteId,"",s);return[]};a.prototype._isSpaceNotEmpty=function(e,t){if(!t.WorkPages||!t.WorkPages.nodes||t.WorkPages.nodes.length===0){n.warning("FLP space "+t.Id+" without page omitted in "+e+".","",s);return false}return true};return a},false);
//# sourceMappingURL=MenuAdapter.js.map