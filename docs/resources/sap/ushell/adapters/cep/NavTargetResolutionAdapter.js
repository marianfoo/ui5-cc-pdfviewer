// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/services/_ClientSideTargetResolution/VirtualInbounds","sap/base/util/ObjectPath","sap/base/Log","sap/ushell/utils","sap/ui/thirdparty/jquery","sap/ushell/Container"],function(e,t,n,r,jQuery){;"use strict";var o=function(e,t,n){this.oAdapterConfiguration=n;this._addVirtualInboundsToApplications();this.sCsrfToken=""};o.prototype._addVirtualInboundsToApplications=function(){var n=t.create("config.applications",this.oAdapterConfiguration);var r=e.getInbounds();r.forEach(function(e){var t=e.semanticObject+"-"+e.action;n[t]=e.resolutionResult})};o.prototype._getIntentForService=function(e){return sap.ushell.Container.getServiceAsync("URLParsing").then(function(n){var r=n.parseShellHash(e);var o={semanticObject:r.semanticObject,semanticObjectAction:r.action,intentParameters:r.params,queryParameters:{siteId:t.get("sap.cf.config.siteId")||""}};return o})};o.prototype._fetchCsrfToken=function(){var e=this;if(e.sCsrfToken){return Promise.resolve(e.sCsrfToken)}return fetch(this.oAdapterConfiguration.config.navServiceUrl,{method:"HEAD",headers:{"x-csrf-token":"fetch","Accept-Language":sap.ui.getCore().getConfiguration().getLanguageTag()}}).then(function(t){e.sCsrfToken=t.headers.get("x-csrf-token");return e.sCsrfToken})};o.prototype.toPromise=function(e){var t=this;return function(n){var r=new jQuery.Deferred;e.call(t,n).then(r.resolve).catch(r.reject).finally(r.always);return r.promise()}};o.prototype.resolveHashFragment=function(e){return this.toPromise(this._resolveHashFragment).call(this,e)};o.prototype._resolveHashFragment=function(e){var t=this;return this._fetchCsrfToken().then(function(){return t._getIntentForService(e)}).then(function(e){var n=t.oAdapterConfiguration.config.navServiceUrl+"/resolve";return fetch(n,{method:"POST",headers:{"Content-Type":"application/json; utf-8",Accept:"application/json","x-csrf-token":t.sCsrfToken,"Accept-Language":sap.ui.getCore().getConfiguration().getLanguageTag()},body:JSON.stringify(e)}).then(function(e){if(e.ok===false){return Promise.reject(e.statusText)}return e.json()}).then(function(e){var t=e.value||e;var n=Array.isArray(t)?t[0].url:t.url;return{additionalInformation:"",url:n,applicationType:"URL",navigationMode:"newWindow"}})})};return o},false);
//# sourceMappingURL=NavTargetResolutionAdapter.js.map