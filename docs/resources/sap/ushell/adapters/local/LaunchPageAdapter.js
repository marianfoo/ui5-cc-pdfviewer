// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/View","sap/ushell/resources","sap/ui/model/resource/ResourceModel","sap/m/GenericTile","sap/m/ImageContent","sap/m/TileContent","sap/m/NumericContent","sap/m/library","sap/ui/core/ComponentContainer","sap/ui/thirdparty/datajs","sap/ui/core/library","sap/ushell/library","sap/ui/thirdparty/jquery","sap/ushell/Config","sap/ushell/utils","sap/base/Log","sap/ushell/utils/WindowUtils","sap/base/util/ObjectPath","sap/ui/Device"],function(e,t,i,r,n,s,o,a,l,p,u,c,jQuery,f,d,h,T,g,m){"use strict";var v=u.mvc.ViewType;var w=a.GenericTileMode;var y=c.AppType;function b(e){var t={};t[e.namespace.replace(/\./g,"/")]=e.path||".";sap.ui.loader.config({paths:t})}var C=function(a,u,c){var L=jQuery.extend(true,[],c.config.groups),_=c.config.catalogs||[],U=0,k=10,R=10,S=10,D,G,z,I;var P={};for(z=0;z<L.length;z++){if(L[z].isDefaultGroup===true){I=L[z];break}}if(!I&&L.length>0){I=L[0];I.isDefaultGroup=true}this.translationBundle=t.i18n;this.TileType={Tile:"tile",Link:"link",Card:"card"};if(!D&&c.config.pathToLocalizedContentResources){D=new i({bundleUrl:c.config.pathToLocalizedContentResources,bundleLocale:sap.ui.getCore().getConfiguration().getLanguage()});G=D.getResourceBundle()}function F(e){if(G){return G.getText(e)}return e}_.forEach(function(e){if(G){e.title=F(e.title)}e.tiles.forEach(function(e){e.getTitle=function(){return e.title};e.getChip=function(){return{getBaseChipId:function(){return e.chipId}}}})});L.forEach(function(e){if(G){e.title=F(e.title)}e.tiles.forEach(function(e){x(e,true)})});function V(){return 100*Math.random()<U}function j(){return 100*Math.random()<k}function M(){return R+S*Math.random()}function N(e,t){var i;for(i=0;i<e.tiles.length;i=i+1){if(t.id===e.tiles[i].id){return i}}return-1}function A(e,t){var i;for(i=0;i<e.length;i=i+1){if(t.id===e[i].id){return i}}return-1}function H(e){var t=new jQuery.Deferred;window.setTimeout(function(){t.resolve(e)},M());return t.promise()}function x(e,t){if(e.tileType!=="sap.ushell.ui.tile.DynamicTile"||!e.properties||!e.properties.serviceUrl){return}if(e.intervalTimer){window.clearInterval(e.intervalTimer);e.intervalTimer=undefined}if(t){var i=e.serviceRefreshInterval;if(i){i=i*1e3}else{i=1e4}e.intervalTimer=window.setInterval(function(){p.read(e.properties.serviceUrl+"?id="+e.id+"&t="+(new Date).getTime(),function(){h.debug("Dynamic tile service call succeed for tile "+e.id)},function(t){h.debug("Dynamic tile service call failed for tile "+e.id+", error message:"+t)})},d.sanitizeTimeoutDelay(i))}}this.getGroups=function(){var e=new jQuery.Deferred;window.setTimeout(function(){e.resolve(L.slice(0))},M());return e.promise()};this.getDefaultGroup=function(){var e=new jQuery.Deferred;e.resolve(I);return e.promise()};this.addGroup=function(e){var t=new jQuery.Deferred,i=V(),r=this;window.setTimeout(function(){if(!i){var n={id:"group_"+L.length,title:e,tiles:[]};L.push(n);t.resolve(n)}else{r.getGroups().done(function(e){t.reject(e)}).fail(function(){t.reject()})}},M());return t.promise()};this.getGroupTitle=function(e){return e.title};this.setGroupTitle=function(e,t){var i=new jQuery.Deferred,r=V();window.setTimeout(function(){if(!r){e.title=t;i.resolve()}else{H(e).done(function(e){i.reject(e.title)}).fail(function(){i.reject()})}},M());return i.promise()};this.getGroupId=function(e){return e.id};this.hideGroups=function(e){if(e&&L){for(var t=0;t<L.length;t++){if(e.indexOf(L[t].id)!==-1){L[t].isVisible=false}else{L[t].isVisible=true}}}return(new jQuery.Deferred).resolve()};this.isGroupVisible=function(e){return e&&(e.isVisible===undefined?true:e.isVisible)};this.moveGroup=function(e,t){var i=new jQuery.Deferred,r=V(),n=this;window.setTimeout(function(){if(!r){L.splice(t,0,L.splice(A(L,e),1)[0]);i.resolve()}else{n.getGroups().done(function(e){i.reject(e)}).fail(function(){i.reject()})}},M());return i.promise()};this.removeGroup=function(e){var t=new jQuery.Deferred,i=V(),r=this;window.setTimeout(function(){if(!i){L.splice(A(L,e),1);e.tiles.forEach(function(e){x(e,false)});t.resolve()}else{r.getGroups().done(function(e){t.reject(e)}).fail(function(){t.reject()})}},M());return t.promise()};this.resetGroup=function(e){var t=new jQuery.Deferred,i=V(),r=this;window.setTimeout(function(){if(!i){e.tiles.forEach(function(e){x(e,false)});e=jQuery.extend(true,{},c.config.groups[A(c.config.groups,e)]);L.splice(A(L,e),1,e);e.tiles.forEach(function(e){x(e,true)});t.resolve(e)}else{r.getGroups().done(function(e){t.reject(e)}).fail(function(){t.reject()})}},M());return t.promise()};this.isGroupRemovable=function(e){return e&&!e.isPreset};this.isGroupLocked=function(e){return e.isGroupLocked};this.isGroupFeatured=function(e){return e.isFeatured};this.getGroupTiles=function(e){return e.tiles};this.getLinkTiles=function(e){return e.links};this.getTileTitle=function(e){return e.title};this.getTileType=function(e){if(e.isLink){return this.TileType.Link}if(e.isCard){return this.TileType.Card}return this.TileType.Tile};this.getTileId=function(e){return e.id};this.getTileSize=function(e){return e.size};this.getTileTarget=function(e){var t;if(e.properties){t=e.properties.href||e.properties.targetURL}return e.target_url||t||""};this.isTileIntentSupported=function(e){if(e&&e.formFactor){var t=e.formFactor;var i=m.system;var r;if(i.desktop){r="Desktop"}else if(i.tablet){r="Tablet"}else if(i.phone){r="Phone"}if(t.indexOf(r)===-1){return false}}return true};this.isLinkPersonalizationSupported=function(e){if(e){return e.isLinkPersonalizationSupported}return true};this.getTileView=function(e){var t=new jQuery.Deferred,i=V(),r=this;if(j()){window.setTimeout(function(){if(!i){r._getTileView(e).done(function(e){t.resolve(e)})}else{t.reject()}},M())}else if(!i){r._getTileView(e).done(function(e){t.resolve(e)})}else{t.reject()}return t.promise()};this._getTileView=function(t){var i,n;var s="unknown error";var o=this.getTileType(t)==="link";var a=new jQuery.Deferred;var p=this;this._translateTileProperties(t);if(t.namespace&&t.path&&t.moduleType){b(t);if(t.moduleType==="UIComponent"){i=new l({component:sap.ui.getCore().createComponent({componentData:{properties:t.properties},name:t.moduleName}),height:"100%",width:"100%"});a.resolve(i)}else{e.create({viewName:t.moduleName,type:v[t.moduleType],viewData:{properties:t.properties},height:"100%"}).then(function(e){a.resolve(e)})}return a.promise()}else if(t.tileType){n=o?"Link":t.tileType;if(n){try{this._createTileInstance(t,n).done(function(e){i=e;p._handleTilePress(i);p._applyDynamicTileIfoState(i);a.resolve(i)});return a.promise()}catch(e){a.resolve(new r({header:e&&e.name+": "+e.message||this.translationBundle.getText("failedTileCreationMsg"),frameType:this._parseTileSizeToGenericTileFormat(t.size)}));return a.promise()}}else{s="TileType: "+t.tileType+" not found!"}}else{s="No TileType defined!"}a.resolve(new r({header:s,frameType:this._parseTileSizeToGenericTileFormat(t.size)}));return a.promise()};this._getCatalogTileViewAsync=function(t){var i=new jQuery.Deferred,n=this,s,o="unknown error",a,p,u=this.getTileType(t)==="link";this._translateTileProperties(t);if(t.namespace&&t.path&&t.moduleType){b(t);if(t.moduleType==="UIComponent"){a=new l({component:sap.ui.getCore().createComponent({componentData:{properties:t.properties},name:t.moduleName}),height:"100%",width:"100%"});i.resolve(a)}else{e.create({viewName:t.moduleName,type:v[t.moduleType],viewData:{properties:t.properties},height:"100%"}).then(function(e){i.resolve(e)})}return i.promise()}else if(t.tileType){p=u?"Link":t.tileType;if(p){try{s=this._createCatalogTileInstanceAsync(t,p);s.done(function(e){n._handleTilePress(e);n._applyDynamicTileIfoState(e);i.resolve(e)})}catch(e){i.resolve(new r({header:e&&e.name+": "+e.message||this.translationBundle.getText("failedTileCreationMsg"),frameType:this._parseTileSizeToGenericTileFormat(t.size)}))}}else{o="TileType: "+t.tileType+" not found!"}return i.promise()}o="No TileType defined!";i.resolve(new r({header:o,frameType:this._parseTileSizeToGenericTileFormat(t.size)}));return i.promise()};this._createTileInstance=function(e,t){var i,n=new jQuery.Deferred,a=this._getImageContent({src:e.properties.icon});a.addStyleClass("sapUshellFullWidth");switch(t){case"sap.ushell.ui.tile.DynamicTile":i=new r({header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:T.getLeanURL(e.properties.targetURL),tileContent:new s({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,unit:e.properties.numberUnit,content:new o({scale:e.properties.numberFactor,value:e.properties.numberValue,truncateValueTo:5,indicator:e.properties.stateArrow,valueColor:this._parseTileValueColor(e.properties.numberState),icon:e.properties.icon,width:"100%"})}),press:this._genericTilePressHandler.bind(this,e)});P[e.id]=i;n.resolve(i);break;case"sap.ushell.ui.tile.StaticTile":i=new r({mode:e.mode||(e.properties.icon?w.ContentMode:w.HeaderMode),header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:T.getLeanURL(e.properties.targetURL),tileContent:new s({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,content:a}),press:this._genericTilePressHandler.bind(this,e)});P[e.id]=i;n.resolve(i);break;case"Link":i=new r({mode:w.LineMode,subheader:e.properties.subtitle,header:e.properties.title,url:T.getLeanURL(e.properties.targetURL,e.properties.href),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});P[e.id]=i;n.resolve(i);break;default:var l=e.tileType.replace(/\./g,"/");sap.ui.require([l],function(){var t=g.get(e.tileType);i=new t(e.properties||{});P[e.id]=i;n.resolve(i)})}return n.promise()};this.getCardManifest=function(e){var t=JSON.parse(JSON.stringify(e.manifest));return t};this._createCatalogTileInstanceAsync=function(e,t){var i=new jQuery.Deferred,n,a=this._getImageContent({src:e.properties.icon});a.addStyleClass("sapUshellFullWidth");switch(t){case"sap.ushell.ui.tile.DynamicTile":n=new r({header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:T.getLeanURL(e.properties.targetURL),tileContent:new s({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,unit:e.properties.numberUnit,content:new o({scale:e.properties.numberFactor,value:e.properties.numberValue,truncateValueTo:5,indicator:e.properties.stateArrow,valueColor:this._parseTileValueColor(e.properties.numberState),icon:e.properties.icon,width:"100%"})}),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});break;case"sap.ushell.ui.tile.StaticTile":n=new r({mode:e.mode||(e.properties.icon?w.ContentMode:w.HeaderMode),header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:T.getLeanURL(e.properties.targetURL),tileContent:new s({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,content:a}),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});break;case"Link":n=new r({mode:w.LineMode,subheader:e.properties.subtitle,header:e.properties.title,url:T.getLeanURL(e.properties.targetURL,e.properties.href),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});break;default:t=e.tileType&&e.tileType.replace(/\./g,"/");sap.ui.require([t],function(t){n=new t(e.properties||{});i.resolve(n)})}i.resolve(n);return i.promise()};this._createCatalogTileInstance=function(e,t){var i,n,a,l=this._getImageContent({src:e.properties.icon});l.addStyleClass("sapUshellFullWidth");switch(t){case"sap.ushell.ui.tile.DynamicTile":i=new r({header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:T.getLeanURL(e.properties.targetURL),tileContent:new s({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,unit:e.properties.numberUnit,content:new o({scale:e.properties.numberFactor,value:e.properties.numberValue,truncateValueTo:5,indicator:e.properties.stateArrow,valueColor:this._parseTileValueColor(e.properties.numberState),icon:e.properties.icon,width:"100%"})}),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});break;case"sap.ushell.ui.tile.StaticTile":i=new r({mode:e.mode||(e.properties.icon?w.ContentMode:w.HeaderMode),header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:T.getLeanURL(e.properties.targetURL),tileContent:new s({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,content:l}),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});break;case"Link":i=new r({mode:w.LineMode,subheader:e.properties.subtitle,header:e.properties.title,url:T.getLeanURL(e.properties.targetURL,e.properties.href),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});break;default:n=e.tileType.replace(/\./g,"/");a=sap.ui.require(n);if(!a){if(!g.get(e.tileType)){h.error("FLP: local LaunchPageAdapter. The resource is used before being loaded: "+n);sap.ui.requireSync(n)}a=g.get(e.tileType)}i=new a(e.properties||{})}return i};this._genericTilePressHandler=function(e,t){if(t.getSource().getScope&&t.getSource().getScope()==="Display"){if(e.properties.targetURL){if(e.properties.targetURL[0]==="#"){hasher.setHash(e.properties.targetURL)}else{var i=f.last("/core/shell/enableRecentActivity")&&f.last("/core/shell/enableRecentActivityLogging");if(i){var r={title:e.properties.title,appType:y.URL,url:e.properties.targetURL,appId:e.properties.targetURL};sap.ushell.Container.getRenderer("fiori2").logRecentActivity(r)}T.openURL(e.properties.targetURL,"_blank")}}}};this._parseTileSizeToGenericTileFormat=function(e){return e==="1x2"?"TwoByOne":"OneByOne"};this._parseTileValueColor=function(e){var t=e;switch(e){case"Positive":t="Good";break;case"Negative":t="Critical";break}return t};this._applyDynamicTileIfoState=function(e){var t=e.onAfterRendering;e.onAfterRendering=function(){if(t){t.apply(this,arguments)}var e=this.getModel(),i,r,n;if(!e){return}i=e.getProperty("/data/display_info_state");r=this.getDomRef();n=r.getElementsByClassName("sapMTileCntFtrTxt")[0];switch(i){case"Negative":n.classList.add("sapUshellTileFooterInfoNegative");break;case"Neutral":n.classList.add("sapUshellTileFooterInfoNeutral");break;case"Positive":n.classList.add("sapUshellTileFooterInfoPositive");break;case"Critical":n.classList.add("sapUshellTileFooterInfoCritical");break;default:return}}};this._handleTilePress=function(e){if(typeof e.attachPress==="function"){e.attachPress(function(){if(typeof e.getTargetURL==="function"){var t=e.getTargetURL();if(t){if(t[0]==="#"){hasher.setHash(t)}else{T.openURL(t,"_blank")}}}})}};this._translateTileProperties=function(e){if(this.translationBundle&&G&&!e._isTranslated){var t=e.properties,i=e.keywords;t.title=F(t.title);t.subtitle=F(t.subtitle);t.info=F(t.info);if(i){for(var r=0;r<i.length;r++){i[r]=F(i[r])}}e._isTranslated=true}};this.refreshTile=function(){};this.setTileVisible=function(e,t){x(e,t)};this.addTile=function(e,t){if(!t){t=I}var i=new jQuery.Deferred,r=V(),n=this;window.setTimeout(function(){if(!r){var s=jQuery.extend(true,{title:"A new tile was added",size:"1x1"},e,{id:"tile_0"+e.chipId});t.tiles.push(s);x(s,true);i.resolve(s)}else{n.getGroups().done(function(e){i.reject(e)}).fail(function(){i.reject()})}},M());return i.promise()};this.removeTile=function(e,t){var i=new jQuery.Deferred,r=V(),n=this;window.setTimeout(function(){if(!r){e.tiles.splice(N(e,t),1);x(t,false);i.resolve()}else{n.getGroups().done(function(e){i.reject(e)}).fail(function(){i.reject()})}},M());return i.promise()};this.moveTile=function(e,t,i,r,n,s){var o=new jQuery.Deferred,a=V(),l=this;window.setTimeout(function(){if(!a){if(n===undefined){n=r}e.isLink=s?s===l.TileType.Link:e.isLink;r.tiles.splice(t,1);n.tiles.splice(i,0,e);o.resolve(e)}else{l.getGroups().done(function(e){o.reject(e)}).fail(function(){o.reject()})}},M());return o.promise()};this.getTile=function(){var e=new jQuery.Deferred;return e.promise()};this.getCatalogs=function(){var e=new jQuery.Deferred;_.forEach(function(t){window.setTimeout(function(){e.notify(t)},300)});window.setTimeout(function(){e.resolve(_)},1500);return e.promise()};this.isCatalogsValid=function(){return true};this.getCatalogError=function(){return};this.getCatalogId=function(e){return e.id};this.getCatalogTitle=function(e){return e.title};this.getCatalogTiles=function(e){var t=new jQuery.Deferred;window.setTimeout(function(){t.resolve(e.tiles)},M());return t.promise()};this.getCatalogTileId=function(e){if(e.chipId){return e.chipId}return"UnknownCatalogTileId"};this.getStableCatalogTileId=function(e){if(e.referenceChipId){return e.referenceChipId}if(e.chipId){return e.chipId}return"UnknownCatalogTileId"};this.getCatalogTileTitle=function(e){return e.title};this.getCatalogTileSize=function(e){return e.size};this.getCatalogTileViewControl=function(e){return this._getCatalogTileViewAsync(e)};this.getCatalogTileTargetURL=function(e){return e.properties&&e.properties.targetURL||null};this.getCatalogTilePreviewTitle=function(e){return e.properties&&e.properties.title||null};this.getCatalogTilePreviewInfo=function(e){return e.properties&&e.properties.info||null};this.getCatalogTilePreviewIndicatorDataSource=function(e){var t;if(e.properties&&e.properties.serviceUrl){t={path:e.properties.serviceUrl,refresh:e.properties.serviceRefreshInterval}}return t};this.getCatalogTilePreviewSubtitle=function(e){return e.properties&&e.properties.subtitle||null};this.getCatalogTilePreviewIcon=function(e){return e.properties&&e.properties.icon||null};this.getCatalogTileKeywords=function(e){return jQuery.merge([],jQuery.grep(jQuery.merge([e.title,e.properties&&e.properties.subtitle,e.properties&&e.properties.info],e&&e.keywords||[]),function(e){return e!==""&&e}))};this.getCatalogTileTags=function(e){return e&&e.tags||[]};this.addBookmark=function(e,t){var i=t||I,r=new jQuery.Deferred,n=V(),s=this,o=e.title,a=e.subtitle,l=e.info,p=e.url,u=this.isLinkPersonalizationSupported();window.setTimeout(function(){if(!n){var e={title:o,size:"1x1",chipId:"tile_0"+i.tiles.length,tileType:"sap.ushell.ui.tile.StaticTile",id:"tile_0"+i.tiles.length,isLinkPersonalizationSupported:u,keywords:[],properties:{icon:"sap-icon://time-entry-request",info:l,subtitle:a,title:o,targetURL:p}};i.tiles.push(e);x(e,true);r.resolve(e)}else{s.getGroups().done(function(e){r.reject(e)}).fail(function(){r.reject()})}},M());return r.promise()};this.updateBookmarks=function(e,t){var i=new jQuery.Deferred,r=0,n=this.getGroups();n.done(function(n){n.forEach(function(i){i.tiles.forEach(function(i){if(i.properties&&i.properties.targetURL===e){for(var n in t){if(t.hasOwnProperty(n)){i.properties[n]=t[n]}}var s=P[i.id];if(s!==undefined){s.setHeader(i.properties.title);s.setSubheader(i.properties.subtitle)}r++}})});i.resolve(r)});n.fail(function(){i.reject()});return i.promise()};this.deleteBookmarks=function(e){var t=new jQuery.Deferred;var i=0;var r,n,s,o;for(s=0;s<L.length;s++){r=L[s];for(o=r.tiles.length-1;o>=0;o--){n=r.tiles[o];if(n.properties.targetURL===e){r.tiles.splice(o,1);i++}}}t.resolve(i);return t.promise()};this.countBookmarks=function(e){var t=new jQuery.Deferred;var i=0;var r,n,s,o;for(s=0;s<L.length;s++){r=L[s];for(o=0;o<r.tiles.length;o++){n=r.tiles[o];if(n.properties.targetURL===e){i++}}}t.resolve(i);return t.promise()};this._getImageContent=function(e){return new n(e)};this.onCatalogTileAdded=function(){};this.getTileActions=function(e){return e&&e.actions||null};C.prototype._getCatalogTileIndex=function(){var e={};return Promise.resolve(e)};this.getCatalogTileNumberUnit=function(e){return e.properties?e.properties.numberUnit:undefined}};return C},false);
//# sourceMappingURL=LaunchPageAdapter.js.map