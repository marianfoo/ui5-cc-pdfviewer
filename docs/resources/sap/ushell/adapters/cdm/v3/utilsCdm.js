// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ui/thirdparty/jquery","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/util/merge","sap/base/util/deepEqual","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/ushell/utils/UrlParsing","sap/base/Log"],function(e,t,jQuery,a,i,r,s,n,o,p,u){"use strict";var l={};l.getMember=function(t,a){return e.getMember(t,a)};l.getNestedObjectProperty=function(t,a,i){return e.getNestedObjectProperty(t,a,i)};l.mapOne=function(e,r,n,p,u,l){var c=false;r=a({},r);n=a({},n);p=a({},p);u=a({},u);p=p||{};u=u||{};var m={};m.semanticObject=this.getMember(r,"semanticObject");m.action=this.getMember(r,"action");var f=t.getConfig(p);m.title=t.getTitle([undefined,f,r,n]);m.info=t.getInfo([undefined,f,r,n]);m.icon=t.getIcon([undefined,f,r,n]);m.subTitle=t.getSubTitle([undefined,f,r,n]);m.shortTitle=t.getShortTitle([undefined,f,r,n]);m.keywords=t.getKeywords([undefined,f,r,n]);m.numberUnit=t.getNumberUnit([undefined,f,undefined,undefined]);m.deviceTypes=this.getMember(n,"sap|ui.deviceTypes")||{};["desktop","tablet","phone"].forEach(function(e){if(Object.prototype.hasOwnProperty.call(this.getMember(r,"deviceTypes")||{},e)){m.deviceTypes[e]=r.deviceTypes[e]}if(!Object.prototype.hasOwnProperty.call(m.deviceTypes,e)){m.deviceTypes[e]=true}m.deviceTypes[e]=!!m.deviceTypes[e]}.bind(this));m.signature=this.getMember(r,"signature")||{};m.signature.parameters=this.getMember(m,"signature.parameters")||{};m.signature.additionalParameters=this.getMember(r,"signature.additionalParameters")||"allowed";var d=this.getMember(n,"sap|platform|runtime");m.resolutionResult=jQuery.extend(true,{},d);if(d){m.resolutionResult["sap.platform.runtime"]=jQuery.extend(true,{},d)}if(this.getMember(n,"sap|ui.technology")==="GUI"){m.resolutionResult["sap.gui"]=this.getMember(n,"sap|gui")}if(this.getMember(n,"sap|ui.technology")==="WDA"){m.resolutionResult["sap.wda"]=this.getMember(n,"sap|wda")}if(this.getMember(n,"sap|ui.technology")==="URL"){if(n["sap.url"]){m.resolutionResult["sap.platform.runtime"]=m.resolutionResult["sap.platform.runtime"]||{};m.resolutionResult.url=n["sap.url"].uri;m.resolutionResult["sap.platform.runtime"].url=n["sap.url"].uri}else if(d&&d.uri){m.resolutionResult["sap.platform.runtime"].url=d.uri;m.resolutionResult.url=d.uri}}if(!m.resolutionResult["sap.ui"]){m.resolutionResult["sap.ui"]={}}m.resolutionResult["sap.ui"].technology=this.getMember(n,"sap|ui.technology");m.resolutionResult.applicationType=this._formatApplicationType(m.resolutionResult,n);m.resolutionResult.systemAlias=m.resolutionResult.systemAlias||this.getMember(r,"systemAlias");m.resolutionResult.systemAliasSemantics="apply";m.resolutionResult.text=m.title;m.resolutionResult.appId=this.getMember(n,"sap|app.id");var g,h;var b=this.getMember(p,"vizConfig.sap|flp.indicatorDataSource");var y={};if(!i(u)){var v=this.getMember(u,"sap|app.type");if(v==="card"){c=true;y=s({},u,p.vizConfig)}else{y.componentName=this.getMember(u,"sap|ui5.componentName");var M=this.getMember(u,"sap|platform|runtime.componentProperties");if(M){y.componentProperties=M}if(this.getMember(u,"sap|platform|runtime.includeManifest")){y.componentProperties=y.componentProperties||{};y.componentProperties.manifest=s({},u,p.vizConfig);delete y.componentProperties.manifest["sap.platform.runtime"]}}}if(this.getMember(n,"sap|app.type")==="plugin"||this.getMember(n,"sap|flp.type")==="plugin"){return undefined}var O=this.getNestedObjectProperty([f,n,u],"sap|flp.tileSize");var T=this.getNestedObjectProperty([f,n,u],"sap|app.description");if(this.getMember(n,"sap|ui.technology")==="GUI"&&this.getMember(n,"sap|gui.transaction")){g=this.getMember(n,"sap|gui.transaction")}if(this.getMember(n,"sap|ui.technology")==="WDA"&&this.getMember(n,"sap|wda.applicationId")){g=this.getMember(n,"sap|wda.applicationId")}var R=this.getNestedObjectProperty([f,n,u],"sap|app.dataSources");if(this.getMember(n,"sap|app.id")){h=this.getMember(n,"sap|app.id")}var P=o.getContentProviderId(n)||"";m.tileResolutionResult={appId:h,title:m.title,subTitle:m.subTitle,icon:m.icon,size:O,info:m.info,keywords:m.keywords,tileComponentLoadInfo:y,indicatorDataSource:b,dataSources:R,description:T,runtimeInformation:d,technicalInformation:g,deviceTypes:m.deviceTypes,isCard:c,contentProviderId:P,numberUnit:m.numberUnit};var j=this.getMember(n,"sap|integration.urlTemplateId");var I=this.getTemplatePayloadFromSite(j,l);if(I){m.templateContext={payload:I,site:l,siteAppSection:n}}return m};l.getTemplatePayloadFromSite=function(e,t){if(!t||typeof e!=="string"){return null}var a=e.replace(/[.]/g,"|");return this.getMember(t.urlTemplates,a+".payload")};l._formatApplicationType=function(e,t){var a=e.applicationType;if(a){return a}var i=this.getMember(t,"sap|platform|runtime.componentProperties.self.name")||this.getMember(t,"sap|ui5.componentName");if(this.getMember(t,"sap|flp.appType")==="UI5"||this.getMember(t,"sap|ui.technology")==="UI5"){e.applicationType="SAPUI5";e.additionalInformation="SAPUI5.Component="+i;e.url=this.getMember(t,"sap|platform|runtime.componentProperties.url");e.applicationDependencies=this.getMember(t,"sap|platform|runtime.componentProperties");return"SAPUI5"}if(this.getMember(t,"sap|ui.technology")==="GUI"){e.applicationType="TR";e["sap.gui"]=this.getMember(t,"sap|gui");e.systemAlias=this.getMember(t,"sap|app.destination.name");return"TR"}if(this.getMember(t,"sap|ui.technology")==="WDA"){e.applicationType="WDA";e["sap.wda"]=this.getMember(t,"sap|wda");e.systemAlias=this.getMember(t,"sap|app.destination.name");return"WDA"}if(this.getMember(t,"sap|ui.technology")==="URL"){e.applicationType="URL";e.systemAlias=this.getMember(t,"sap|app.destination.name")}return"URL"};l.formatSite=function(e){var t=this;if(!e){return[]}var a=[];try{var i=Object.keys(e.applications||{}).sort();i.forEach(function(i){try{var r=e.applications[i];var s=this.getMember(r,"sap|app.crossNavigation.inbounds");if(s){var n=Object.keys(s).sort();n.forEach(function(i){var n=s[i];var p=t.mapOne(i,n,r,undefined,undefined,e);if(p){p.contentProviderId=o.getContentProviderId(r)||"";a.push(p)}})}}catch(e){u.error("Error in application "+i+": "+e,e.stack)}}.bind(this))}catch(e){u.error(e);u.error(e.stack);return[]}return a};l.toHashFromInbound=function(e){var t,a,i;t={target:{semanticObject:e.semanticObject,action:e.action},params:{}};a=r.get("signature.parameters",e)||{};Object.keys(a).forEach(function(e){if(a[e].filter&&Object.prototype.hasOwnProperty.call(a[e].filter,"value")&&(a[e].filter.format===undefined||a[e].filter.format==="plain")){t.params[e]=[a[e].filter.value]}if(a[e].launcherValue&&Object.prototype.hasOwnProperty.call(a[e].launcherValue,"value")&&(a[e].launcherValue.format===undefined||a[e].launcherValue.format==="plain")){t.params[e]=[a[e].launcherValue.value]}});i=p.constructShellHash(t);if(!i){return undefined}return i};l.toHashFromOutbound=function(e){var t,a,i;t={target:{semanticObject:e.semanticObject,action:e.action},params:{}};a=e.parameters||{};Object.keys(a).forEach(function(e){if(a.hasOwnProperty(e)&&typeof a[e].value==="object"){t.params[e]=[a[e].value.value]}});i=p.constructShellHash(t);if(!i){return undefined}return i};l.toHashFromVizData=function(e,t){var a,i;if(!e.target){return undefined}a=e.target;if(a.type==="URL"){return a.url}var r=a.appId;var s=a.inboundId;if(r&&s){var n=o.getInboundTarget(t,r,s);i={};if(n){i.semanticObject=n.semanticObject;i.action=n.action;i.parameters=a.parameters||{};i.parameters["sap-ui-app-id-hint"]={value:{value:r,format:"plain"}};i.appSpecificRoute=a.appSpecificRoute||""}}else if(a.semanticObject&&a.action){i=a}return l.toHashFromTarget(i)};l.toHashFromTarget=function(e){try{var t={};var a=r.get("parameters",e)||{};Object.keys(a).forEach(function(e){t[e]=Array.isArray(a[e].value.value)?a[e].value.value:[a[e].value.value]});var i={target:{semanticObject:e.semanticObject,action:e.action},params:t,appSpecificRoute:e.appSpecificRoute};return"#"+p.constructShellHash(i)}catch(e){return undefined}};l.toTargetFromHash=function(e){var t=p.parseShellHash(e);if(t!==undefined){var a=t.params||{};if(Object.keys(a).length>0){t.parameters=[];Object.keys(a).forEach(function(e){var i=Array.isArray(a[e])?a[e]:[a[e]];i.forEach(function(a){var i={name:e,value:a};t.parameters.push(i)})})}delete t.params}else{t={type:"URL",url:e}}return t};l.isSameTarget=function(e,t){var a;if(e.type!==t.type){return false}if(e.type==="URL"){a=e.url===t.url}else{a=e.semanticObject===t.semanticObject&&e.action===t.action&&e.appSpecificRoute===t.appSpecificRoute&&n(e.parameters,t.parameters)}return a};return l},false);
//# sourceMappingURL=utilsCdm.js.map