// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/_LaunchPage/modifyHome","sap/ushell/adapters/cdm/v3/_LaunchPage/readCatalogs","sap/m/library","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/utils/UrlParsing","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/components/tiles/utils","sap/ushell/adapters/cdm/v3/AdapterBase","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/navigationMode","sap/ushell/Config","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/Log"],function(e,t,i,r,n,o,s,a,l,u,f,d,c,p,jQuery,h,v,g){"use strict";var m=r.GenericTileMode;var T="sap.ushell.components.tiles.cdm.applauncher";var b="sap.ushell.components.tiles.cdm.applauncherdynamic";function S(r,S,R){u.call(this,r,S,R);Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("CommonDataModel")]).then(function(e){this.oURLParsingService=e[0];this.oCDMService=e[1]}.bind(this));this._getTileFromHashInContextOfSite=function(e,t,i){var r=new jQuery.Deferred,n=t[i];if(!n){n=e(i);t[i]=n}n.done(function(e){var t={tileIntent:i,tileResolutionResult:e};r.resolve(t)}).fail(function(e){r.reject("Hash '"+i+"' could not be resolved to a tile. "+e)});return r.promise()};this._getTileFromHash=function(e){var t=new jQuery.Deferred;sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(i){var r=i.resolveTileIntent.bind(i);this._getTileFromHashInContextOfSite(r,this._mCatalogTilePromises,e).done(t.resolve).fail(t.reject)}.bind(this));return t.promise()};this._getTileForUrl=function(e){var t={componentName:e.indicatorDataSource?b:T};return{tileIntent:"#",tileResolutionResult:{tileComponentLoadInfo:t,isCustomTile:false}}};this._prepareTileHash=function(e){var t={},i,r;if(this._isCatalogTile(e)){return e.tileIntent}if(this._isGroupTile(e)&&e.target){r=e.target.parameters||[];r.forEach(function(e){if(e.name&&e.value){t[e.name]=[e.value]}});i={target:{semanticObject:e.target.semanticObject,action:e.target.action},params:t,appSpecificRoute:e.target.appSpecificRoute};return"#"+s.constructShellHash(i)}return undefined};this.getDefaultGroup=function(){var e=new jQuery.Deferred,t;var i=this;if(!this._oDefaultGroup){t=this._ensureLoaded()}if(t){t.done(function(){e.resolve(i._oDefaultGroup)}).fail(function(t){e.reject("Failed to access default group. "+t)})}else{e.resolve(i._oDefaultGroup)}return e.promise()};this.addGroup=function(i){var r=new jQuery.Deferred,o,s,a=this;if(!this._isValidTitle(i)){return r.reject("No valid group title").promise()}s="Failed to add the group with title '"+i+"' to the homepage. ";this.oCDMService.getSite().done(function(s){o=n.generateUniqueId(e.getGroupIdsFromSite(s));t.addGroupToSite(s,t.createEmptyGroup(o,i));a.oCDMService.save().done(function(){delete a._ensureLoadedDeferred;r.resolve(s.groups[o],o)}).fail(function(e){r.reject(e)})}).fail(function(e){r.reject(s+e)});return r.promise()};this.setGroupTitle=function(i,r){var n=this,o=new jQuery.Deferred,s,a;if(typeof i!=="object"||!e.getGroupId(i)){return o.reject("Unexpected group value").promise()}if(!n._isValidTitle(r)){return o.reject("Unexpected oGroup title value").promise()}a="Failed to set new title for group with id '"+e.getGroupId(i)+"'. ";s=e.getGroupTitle(i);this.oCDMService.getSite().done(function(e){if(i){t.setGroupTitle(i,r)}n.oCDMService.save().done(function(){o.resolve()}).fail(function(e){g.error(e);o.reject(s)})}).fail(function(e){o.reject(s,a+e)});return o.promise()};this.hideGroups=function(i){var r=new jQuery.Deferred,n=this.oCDMService,o;if(i&&Array.isArray(i)){o="Failed to hide group. ";n.getSite().done(function(o){e.getGroupsArrayFromSite(o).forEach(function(r){var n=Array.prototype.indexOf.call(i,e.getGroupId(r))===-1;t.setGroupVisibility(r,n)});n.save().done(function(){r.resolve()}).fail(function(e){r.reject("Hiding of groups did not work as expected - "+e)})}).fail(function(e){r.reject(o+e)})}else{r.reject("Invalid input parameter aHiddenGroupIds. Please pass a valid input parameter.")}return r.promise()};this.moveGroup=function(i,r){var o=new jQuery.Deferred,s=this.oCDMService,a,l;if(!i||!e.getGroupId(i)||r<0){return o.reject("Unable to move groups - invalid parameters").promise()}l="Failed to move group with id '"+i.identification.id+"'. ";s.getSite().done(function(l){var u=e.getGroupIdsFromSite(l),f=e.getGroupId(i);if(!u){return o.reject("groupsOrder not found - abort operation of adding a group.")}else if(u.indexOf(f)===r){return o.resolve()}a=n.moveElementInsideOfArray(u,u.indexOf(f),r);if(!a){return o.reject("invalid move group operation - abort.")}t.setGroupsOrder(l,a);s.save().done(function(){o.resolve()}).fail(function(e){o.reject(e)});return undefined}).fail(function(e){o.reject(l+e)});return o.promise()};this.removeGroup=function(i){var r=new jQuery.Deferred,n=this.oCDMService,o,s;if(typeof i!=="object"){return r.reject("invalid group parameter").promise()}s=e.getGroupId(i);if(!s){return r.reject("group without id given").promise()}o="Failed to remove group with id '"+s+"'. ";n.getSite().done(function(e){t.removeGroupFromSite(e,i);n.save().done(function(){r.resolve()}).fail(function(e){r.reject(e)})}).fail(function(e){r.reject(o+e)});return r.promise()};this.resetGroup=function(i){var r=new jQuery.Deferred,n=this.oCDMService,o=[],s=this,a,l;if(typeof i==="object"&&e.getGroupId(i)){l=e.getGroupId(i);a="Failed to reset group with id '"+l+"'. ";n.getSite().done(function(a){jQuery.extend(true,o,e.getGroupsArrayFromSite(a));if(s.isGroupRemovable(i)===false){n.getGroupFromOriginalSite(l).done(function(i){if(typeof a==="object"&&e.getGroupFromSite(a,l)){t.overwriteGroup(a,i,l)}n.save().done(function(){r.resolve(i)}).fail(function(e){r.reject("Group could not be reset - "+e,o)})}).fail(function(e){r.reject("Group could not be reset - "+e,o)})}else{r.reject("Group could not be reset as it was created by the user",o)}}).fail(function(e){r.reject(a+e,[])})}return r.promise()};this.getLinkTiles=function(t){return e.getGroupLinks(t)};this.isLinkPersonalizationSupported=function(){return true};this._notifyTileAboutRefresh=function(e){if(typeof e.tileRefresh==="function"){e.tileRefresh()}};this.refreshTile=function(e){var t=this._mResolvedTiles[e.id];if(t){if(t.tileComponent){this._notifyTileAboutRefresh(t.tileComponent)}}};this._notifyTileAboutVisibility=function(e,t,i){if(typeof e.tileSetVisible==="function"&&i!==t){e.tileSetVisible(t)}};this.getTileView=function(e){var t=this;return new jQuery.Deferred(function(i){return t._getTileView(e,false).then(function(e){i.resolve(e)},function(t){var r="Tile with ID '"+e.id+"' could not be initialized"+(t?":\n"+t:".");g.error(r,null,e.tileType);i.reject(r)})}).promise()};this._getCatalogTileViewControl=function(e){var t=new jQuery.Deferred;if(typeof e!=="object"){var i="Invalid input parameter passed to _getCatalogTileView: "+e;g.error(i);return t.reject(i).promise()}return this._getTileUiComponentContainer(e,e,true)};this._createLinkInstance=function(e,t,i,r,n){var s,a,l,u=this.getTileSubtitle(e);var f=r;if(t===true){s=this.getCatalogTileTitle(e)}else{s=this.getTileTitle(e)}a=new f({mode:m.LineMode,subheader:u,header:s,url:o.getLeanURL(this.getTileTarget(e)),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});if(i){l=n.i18n.getText(i+"NavigationMode");a.setAriaLabel(l+" "+s+" "+u)}this._mResolvedTiles[e.id].linkTileControl=a;return a};this._genericTilePressHandler=function(e,t){var i;if(t.getSource().getScope&&t.getSource().getScope()==="Display"){i=this.getTileTarget(e);if(i){if(i[0]==="#"){hasher.setHash(i)}else{o.openURL(i,"_blank")}}}};this.addTile=function(e,t){var i=new jQuery.Deferred,r,n=this.oCDMService,o;if(!t){t=this._oDefaultGroup}if(e.contentProviderId){if(e.externalUrl){return this.addBookmark(this._getBookmarkDataForExtensionCatalogTile(e),t)}return i.reject("Extension Tile without URL").promise()}o=_();o.vizId=e.vizId;this._mResolvedTiles[o.id]={tileIntent:e.tileIntent,tileResolutionResult:e.tileResolutionResult,isLink:false};n.getSite().done(function(e){e.groups[t.identification.id].payload.tiles.push(o);n.save().done(function(){i.resolve(o)}).fail(function(e){i.reject(e)})}).fail(function(e){r="Failed to add tile with id '"+o.id+"' to group with id '"+t.identification.id+"'. ";i.reject(r+e)});return i.promise()};this._getBookmarkDataForExtensionCatalogTile=function(e){var t={title:e.tileResolutionResult.title,subtitle:e.tileResolutionResult.subTitle,icon:e.tileResolutionResult.icon,info:e.tileResolutionResult.info,url:e.externalUrl};if(e.tileResolutionResult.indicatorDataSource&&e.tileResolutionResult.indicatorDataSource.path){t.serviceUrl=e.tileResolutionResult.indicatorDataSource.path;t.serviceRefreshInterval=e.tileResolutionResult.indicatorDataSource.refresh}return t};this.removeTile=function(e,t,i){var r=this.oCDMService,n,o=new jQuery.Deferred,s=this;if(!e||typeof e!=="object"||!e.identification||!e.identification.id||!t||typeof t!=="object"||!t.id){return o.reject({},"Failed to remove tile. No valid input parameters passed to removeTile method.").promise()}n="Failed to remove tile with id '"+t.id+"' from group with id '"+e.identification.id+"'. ";r.getSite().done(function(a){var l,u;i=+i;try{l=a.groups[e.identification.id].payload}catch(t){o.reject(a.groups[e.identification.id],n)}u=s.getTileType(t)===s.TileType.Link?"links":"tiles";if(s.getTileType(t)===s.TileType.Link){i-=l.tiles.length}if(i>=0){l[u].splice(i,1)}else{l[u]=l[u].filter(function(e){return e.id!==t.id})}r.save().done(function(){o.resolve()}).fail(function(t){g.error(t);o.reject(a.groups[e.identification.id],t)})}).fail(function(e){o.reject({},n+e)});return o.promise()};this.moveTile=function(e,t,i,r,n,o){var s=new jQuery.Deferred,a=this.oCDMService,l=this,u;if(!e||h(e)||t===undefined||t<0||i===undefined||i<0||!r||!r.identification||!r.identification.id||!n||!n.identification||!n.identification.id){return s.reject("Invalid input parameters").promise()}u="Failed to move tile with id '"+e.id+"'. ";a.getSite().done(function(f){var d,c,p=l.getTileType(e)===l.TileType.Link?"links":"tiles";if(!o){o=l._mResolvedTiles[e.id].isLink?"link":"tile"}d=o==="link"?"links":"tiles";if(p!==d&&l._mResolvedTiles[e.id]){l._mResolvedTiles[e.id].isLink=o==="link"}if(d==="links"){i-=f.groups[n.identification.id].payload.tiles.length}if(p==="links"){t-=f.groups[r.identification.id].payload.tiles.length}if(r.identification.id===n.identification.id){if(t!==i||p!==d){c=f.groups[n.identification.id].payload;c[p].splice(t,1);c[d].splice(i,0,e)}else{return s.resolve(e).promise()}}else{f.groups[r.identification.id].payload[p].splice(t,1);f.groups[n.identification.id].payload[d].splice(i,0,e)}a.save().done(function(){s.resolve(e)}).fail(function(e){g.error(u+e);s.reject(u+e)});return undefined}).fail(function(e){g.error(u+e);s.reject(u+e)});return s.promise()};this._compareCatalogs=function(e,t){return(e.identification.title||"").toLowerCase()>(t.identification.title||"").toLowerCase()?1:-1};this.getCatalogs=function(){var e=this,t=new jQuery.Deferred,i=[];function r(e,t,i,r,n,o){var s=e.catalogs[t];if(n&&o){s.contentProviderId=n;o.catalogsMap[t]=s}i.push(s);r.notify(s)}sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(n){n.getSite().done(function(o){Object.keys(o.catalogs).forEach(function(e){r(o,e,i,t)});n.getExtensionSites().progress(function(n){var o=n.providerId;var s=n.site;var a=Promise.resolve(s);var l={sitePromise:a,site:s,catalogsMap:{}};Object.keys(s.catalogs).forEach(function(n){e._mContentProviders[o]=l;r(s,n,i,t,o,l)})}).done(function(r){r.filter(function(e){return!e.success}).forEach(function(e){i.push({identification:{id:e.providerId},contentProviderId:e.providerId,error:"The following content providers could not provide catalogs: "+e.providerId+(e.error?" -> "+e.error:"")})});t.resolve(i.sort(e._compareCatalogs))})})});return t.promise()};this._isStartableInbound=function(e){if(!e.semanticObject||!e.action){return false}var t=["Shell-plugin","Shell-bootConfig"];if(t.indexOf(e.semanticObject+"-"+e.action)>-1){return false}return true};this._isStartableVisualization=function(e,t){var i=v.get("signature.parameters",t);if(!i){return true}var r=v.get("parameters",f.getTarget(e));return Object.keys(i).every(function(e){var t=i[e];if(e==="sap-external-url"){return true}if(!t.filter||t.filter.format!=="plain"){return true}var n=t.filter.value;var o=v.get([e,"value","value"],r);if(n!==o){return false}return true})};this._isHiddenInbound=function(e){return!!e.hideLauncher};this._toHashFromInbound=function(e){var t=a.toHashFromInbound(e);if(!t){return undefined}return"#"+t};this._getExternalUrlFromInbound=function(e){return v.get("signature.parameters.sap-external-url.launcherValue.value",e)||null};this._toHashFromOutbound=function(e){var t=a.toHashFromOutbound(e);if(!t){return undefined}return"#"+t};this.getCatalogTiles=function(e){var t=this,i=new jQuery.Deferred;if(typeof e!=="object"||e===null){return i.reject("Invalid input parameter '"+e+"' passed to getCatalogTiles.").promise()}if(e.contentProviderId&&this._mContentProviders[e.contentProviderId]){this._mContentProviders[e.contentProviderId].sitePromise.then(function(r){y.call(t,e,r).done(i.resolve).fail(i.reject)},function(e){i.reject("Failed to get site: "+e)})}else{this.oCDMService.getSite().done(function(r){y.call(t,e,r).done(i.resolve).fail(i.reject)}).fail(function(e){i.reject("Failed to get site: "+e)})}return i.promise()};function y(t,i){var r=this,o=new jQuery.Deferred;setTimeout(function(){var s=(t.payload&&t.payload.viz||[]).reduce(function(o,s){var l,u,p,h,v,g,m,T,b,S,R,y,C,_,k,I,j;if(!s){return o}u=f.get(i,s);if(!u){return o}p=f.getTypeId(u);h=f.getType(i,p);l=f.getAppId(u);if(l){v=f.getAppDescriptor(i,l);if(!v){return o}g=e.getInbound(v,f.getTarget(u).inboundId);if(!g){return o}if(!r._isStartableInbound(g.inbound)||!r._isStartableVisualization(u,g.inbound)||r._isHiddenInbound(g.inbound)){return o}T=a.mapOne(g.key,g.inbound,v,u,h,i);if(!T||!T.tileResolutionResult){return o}_=T.resolutionResult.applicationType;k=T.resolutionResult.additionalInformation;j=c.last("/core/navigation/enableInPlaceForClassicUIs");I=j?j[_]:false;b=d.computeNavigationModeForHomepageTiles(_,k,I);S=f.getOutbound(u,g.inbound);m=r._toHashFromOutbound(S)}else{var D=f.getConfig(u);if(D===undefined){return o}T=a.mapOne(undefined,undefined,undefined,u,h,i);if(n.getMember(D,"sap|flp.target.type")==="URL"){C=n.getMember(D,"sap|flp.target.url")}}R=T.tileResolutionResult;R.navigationMode=b;if(!r._isFormFactorSupported(R)){return o}if(t.contentProviderId){C=r._getMember(v,"sap|app.crossNavigation.inbounds.Shell-launchURL.signature.parameters.sap-external-url.launcherValue.value")}y={id:s,vizId:s,tileIntent:C||m,tileResolutionResult:R,isCatalogTile:true};if(t.contentProviderId&&C){y.contentProviderId=t.contentProviderId;y.externalUrl=C}o.push(y);return o},[]);o.resolve(s)},0);return o.promise()}this.getCatalogError=function(e){if(e.error){return e.error}return undefined};this.getCatalogId=function(e){return i.getId(e)};this.getCatalogTitle=function(e){return i.getTitle(e)};this._isFailedCatalogTile=function(t){return!!(t&&this._mFailedResolvedCatalogTiles&&this._mFailedResolvedCatalogTiles[e.getTileId(t)])};this.getCatalogTileTitle=function(e){if(this._isGroupTile(e)){if(this._isFailedGroupTile(e)){return""}return this._mResolvedTiles[e.id].tileResolutionResult.title}if(this._isCatalogTile(e)){if(this._isFailedCatalogTile(e)){return undefined}return e.tileResolutionResult.title}return undefined};this.getCatalogTileSize=function(e){return e.tileResolutionResult.size||"1x1"};this.getCatalogTileViewControl=function(e){return this._getCatalogTileViewControl(e)};this.getCatalogTilePreviewSubtitle=function(e){if(this._isGroupTile(e)){return this.getTileSubtitle(e)}return e.tileResolutionResult&&e.tileResolutionResult.subTitle||""};this.getCatalogTilePreviewIcon=function(e){if(this._isGroupTile(e)){return this.getTileIcon(e)}return e.tileResolutionResult&&e.tileResolutionResult.icon||""};this.getCatalogTilePreviewInfo=function(e){if(this._isGroupTile(e)){return this.getTileInfo(e)}return e.tileResolutionResult&&e.tileResolutionResult.info||""};this.getCatalogTilePreviewIndicatorDataSource=function(e){return e.tileResolutionResult&&e.tileResolutionResult.indicatorDataSource};this.getCatalogTileKeywords=function(e){var t=[],i=e;if(!i){g.error("Could not find the Tile","sap.ushell.adapters.cdm.LaunchPageAdapter");return t}if(this._mResolvedTiles&&this._mResolvedTiles[e.id]){i=this._mResolvedTiles[e.id]}if(i&&i.tileResolutionResult&&Array.isArray(i.tileResolutionResult.keywords)){Array.prototype.push.apply(t,i.tileResolutionResult.keywords)}if(i&&i.tileResolutionResult&&i.tileResolutionResult.title){t.push(i.tileResolutionResult.title)}if(i&&i.tileResolutionResult&&i.tileResolutionResult.subTitle){t.push(i.tileResolutionResult.subTitle)}return t};this._visitBookmarks=function(e,t,i,r){var n;var o=s.parseShellHash(e);if(o){n=P(o)}else{n=w(e)}return this.oCDMService.getSite().then(function(e){var o=e.groups;var s=Object.keys(o).filter(function(e){return!o[e].payload.locked}).map(function(e){return o[e].payload.tiles.filter(function(e){return e.isBookmark&&e.vizType===i&&(e.contentProvider||"")===(r||"")&&I(n,e.target)})}).reduce(function(e,t){Array.prototype.push.apply(e,t);return e},[]);if(!t){return s.length}return jQuery.when(s.map(t)).then(function(){return s.length})})};this.addBookmark=function(e,t,i){var r=this;return new jQuery.Deferred(function(n){var o=r.oCDMService;jQuery.when(t||r.getDefaultGroup(),o.getSite()).done(function(t,a){var l,u,f=s.parseShellHash(e.url),d,c=false;if(!f){u=w(e.url);c=true}else{u=P(f)}l=C(e,u,i);if(c){d=new jQuery.Deferred;d.resolve(r._getTileForUrl(l))}else{d=r._getTileFromHash(e.url)}d.done(function(e){e.isLink=false;r._mResolvedTiles[l.id]=e;a.groups[t.identification.id].payload.tiles.push(l);o.save().done(function(){n.resolve(l)}).fail(function(e){n.reject(e)})}).fail(function(e){n.reject("Bookmark creation failed because: "+e)})}).fail(function(e){n.reject(e)})}).promise()};this.addCustomBookmark=function(e,t,i){var r=new jQuery.Deferred;Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("CommonDataModel")]).then(function(o){var s=o[0];var a=o[1];jQuery.when(t||this.getDefaultGroup(),a.getSite()).done(function(t,o){var l,u=s.parseShellHash(e.url),f=u===undefined;l=f?w(e.url):P(u);var d={id:n.generateUniqueId([]),vizType:e.vizType,title:e.title,subTitle:e.subtitle,icon:e.icon,info:e.info,numberUnit:e.numberUnit,target:l,indicatorDataSource:{path:e.serviceUrl,refresh:e.serviceRefreshInterval},vizConfig:e.vizConfig,isBookmark:true};if(i){d.contentProvider=i}this._resolveTileByVizId(d,o).done(function(e){e.isLink=false;this._mResolvedTiles[d.id]=e;o.groups[t.identification.id].payload.tiles.push(d);a.save().done(function(){r.resolve(d)}).fail(r.reject)}.bind(this)).fail(function(e){r.reject("Bookmark creation failed because: "+e)})}.bind(this)).fail(r.reject)}.bind(this));return r.promise()};this.countBookmarks=function(e,t){return this._visitBookmarks(e,undefined,undefined,t)};this.countCustomBookmarks=function(e){if(!e.vizType){return Promise.reject("countCustomBookmarks: Required parameter is missing: oIdentifier.vizType")}return new Promise(function(t,i){this._visitBookmarks(e.url,undefined,e.vizType,e.contentProviderId).done(t).fail(i)}.bind(this))};this.updateBookmarks=function(e,t,i,r){var n=this.oCDMService;var o=this._mResolvedTiles;function a(i){return new jQuery.Deferred(function(r){var n,a;var l;var u=false;var f={};if(t.url||t.url===""){n=s.parseShellHash(t.url);if(!n){a=w(t.url)}else{a=P(n)}}if(i.icon!==t.icon){f.icon=t.icon;u=true}if(i.title!==t.title){f.title=t.title;u=true}if(i.subTitle!==t.subtitle){f.subtitle=t.subtitle;u=true}if(t.url&&e!==t.url){f.targetURL=t.url;u=true}if(i.info!==t.info){f.info=t.info;u=true}k(i,t,a);if(u&&o[i.id]){l=o[i.id].tileComponent;if(l){l.tileSetVisualProperties(f)}}r.resolve(i)}).promise()}return this._visitBookmarks(e,a,i,r).then(function(e){return n.save().then(function(){return e})})};this.updateCustomBookmarks=function(e,t){if(!e.vizType){return Promise.reject("updateCustomBookmarks: Required parameter is missing: oIdentifier.vizType")}if(t.title===""){return Promise.reject("updateCustomBookmarks: The bookmark title cannot be an empty string")}if(t.url===""){return Promise.reject("updateCustomBookmarks: The bookmark url cannot be an empty string")}return new Promise(function(i,r){this.updateBookmarks(e.url,t,e.vizType,e.contentProviderId).done(i).fail(r)}.bind(this))};this.deleteBookmarks=function(e,t,i){var r=this.oCDMService;var n=s.parseShellHash(e);var o;if(n){o=P(n)}else{o=w(e)}return r.getSite().then(function(e){var n=e.groups;var s=Object.keys(n).map(function(e){var r=n[e].payload;var s=0;r.tiles=r.tiles.filter(function(e){if(e.isBookmark&&e.vizType===t&&(e.contentProvider||"")===(i||"")&&I(o,e.target)){++s;return false}return true});return s}).reduce(function(e,t){e+=t;return e},0);return r.save().then(function(){return s})})};this.deleteCustomBookmarks=function(e){if(!e.vizType){return Promise.reject("deleteCustomBookmarks: Required parameter is missing: oIdentifier.vizType")}return new Promise(function(t,i){this.deleteBookmarks(e.url,e.vizType,e.contentProviderId).done(t).fail(i)}.bind(this))};this.onCatalogTileAdded=function(e){};this._onTileSettingsSave=function(e,t){var i=new jQuery.Deferred,r,n,o,s,a,l,u;if(!e||!e.id||!t){return i.reject().promise()}n=t.oTitleInput.getValue();s=t.oSubTitleInput.getValue();o=t.oInfoInput.getValue();a=this.getTileTitle(e);l=this.getTileInfo(e);u=this.getTileSubtitle(e);if(a===n&&u===s&&l===o){return i.resolve().promise()}r={};if(a!==n){r.title=n;e.title=n}if(u!==s){r.subtitle=s;e.subTitle=s}if(l!==o){r.info=o;e.info=o}if(this._mResolvedTiles[e.id].tileComponent){this._mResolvedTiles[e.id].tileComponent.tileSetVisualProperties(r)}else if(this._mResolvedTiles[e.id].linkTileControl){if(r.title){this._mResolvedTiles[e.id].linkTileControl.setHeader(r.title)}if(r.subtitle){this._mResolvedTiles[e.id].linkTileControl.setSubheader(r.subtitle)}if(r.title||r.subtitle){this._mResolvedTiles[e.id].linkTileControl.rerender()}}sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(e){e.save().fail(function(e){g.error(e);i.reject("Could not save personalization changes: "+e)}).done(function(){i.resolve()})});return i.promise()};this.getTileActions=function(e){var t=[],i,r;if(this._isGroupTile(e)&&!this._isFailedGroupTile(e)){r=new p({config:{display_title_text:this.getTileTitle(e),display_subtitle_text:this.getTileSubtitle(e),display_info_text:this.getTileInfo(e)}});i=l.getTileSettingsAction(r,this._onTileSettingsSave.bind(this,e),this.getTileType(e));t.push(i)}return t};function C(e,t,i){var r=_(e,t);r.isBookmark=true;if(i){r.contentProvider=i}return r}function _(e,t){var i={id:n.generateUniqueId([])};k(i,e,t);return i}function k(e,t,i){t=jQuery.extend(true,{},t);if(i){e.target=i}if(t.title||t.title===""){e.title=t.title}if(t.icon||t.icon===""){e.icon=t.icon}if(t.subtitle||t.subtitle===""){e.subTitle=t.subtitle}if(t.info||t.info===""){e.info=t.info}if(t.numberUnit||t.numberUnit===""){e.numberUnit=t.numberUnit}if(t.dataSource){e.dataSource={};jQuery.extend(true,e.dataSource,t.dataSource);delete t.serviceUrl}else if(t.dataSource===null){delete e.dataSource;delete e.indicatorDataSource;delete t.serviceUrl}if((t.dataSource||e.dataSource)&&t.serviceUrlPath){e.indicatorDataSource={path:t.serviceUrlPath}}if(t.serviceUrl||t.serviceUrl===""){if(e.dataSource){g.warning("`serviceUrl` is marked for deprecation in the future."+"It is not the preferred means for defining a dynamic "+"tile's data source. Please use `oParameter.dataSource`");delete e.dataSource}e.indicatorDataSource={path:t.serviceUrl}}else if(t.serviceUrl===null&&!e.dataSource){delete e.indicatorDataSource}if(t.serviceRefreshInterval||t.serviceRefreshInterval===0){e.indicatorDataSource.refresh=t.serviceRefreshInterval}if(t.vizConfig){e.vizConfig=t.vizConfig}}function I(e,t){if(e&&t){if(e.url){return e.url===t.url}return e.semanticObject===t.semanticObject&&e.action===t.action&&j(e.parameters,t.parameters)&&e.appSpecificRoute===t.appSpecificRoute}return e===t}function j(e,t){var i,r;e=e||[];t=t||[];if(e.length===t.length){i=D(e);r=D(t);return i===r}return false}function D(e){return e.map(function(e){return e.name+e.value}).sort().join()}function w(e){return{url:e}}function P(e){var t={semanticObject:e.semanticObject,action:e.action,parameters:G(e.params)};if(e.appSpecificRoute){t.appSpecificRoute=e.appSpecificRoute}return t}function G(e){return Object.keys(e).map(function(t){var i=e[t]&&e[t][0];return{name:t,value:i||""}})}this._getSiteData=function(){var e=new jQuery.Deferred;sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(t){t.getSite().done(e.resolve).fail(e.reject)});return e.promise()};this._addDefaultGroup=function(i,r){var o=e.getDefaultGroup(i);if(!o){o=t.createDefaultGroup(n.generateUniqueId(e.getGroupIdsFromSite(r)));r=t.addGroupToSite(r,o,0);i=e.getGroupsArrayFromSite(r)}this._oDefaultGroup=o;return i}}S.prototype=u.prototype;return S},false);
//# sourceMappingURL=LaunchPageAdapter.js.map