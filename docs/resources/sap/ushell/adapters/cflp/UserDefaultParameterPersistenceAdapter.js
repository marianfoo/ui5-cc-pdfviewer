// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils/HttpClient","sap/ui/thirdparty/jquery","sap/base/Log","sap/base/util/ObjectPath"],function(e,jQuery,t,r){"use strict";var a=function(e,t,r){this.sBaseServicePath="/sap/opu/odata/UI2/INTEROP/";this.oConfig={};if(r&&r.userBaseServicePath!==undefined){this.oConfig.sBaseServicePath=r.userBaseServicePath}else{this.oConfig.sBaseServicePath=this.sBaseServicePath}this.oConfig.oHttpClientConfig={"sap-language":sap.ushell.Container.getUser().getLanguage(),"sap-client":sap.ushell.Container.getLogonSystem().getClient(),"sap-statistics":true,headers:{Accept:"application/json"},data:{}};this._mSystems={}};a.prototype.loadParameterValue=function(e,t){var r=new jQuery.Deferred;var a=this._isValidParameterName(e);if(a){this._getUserDefaultParameterContainer(t).done(function(t){var a=t.find(function(t){return t.id===e});if(a!==undefined){var s=JSON.parse(a.value);r.resolve(s)}else{r.reject("Parameter does not exist: "+e)}}).fail(function(e){r.reject(e)})}else{r.reject('Illegal Parameter Key. Parameter must be less than 40 characters and [A-Za-z0-9.-_]+ :"'+e+'"')}return r.promise()};a.prototype._createRequest=function(e){return{data:{PersContainerItems:e,appName:"",category:"P",component:"",id:"sap.ushell.UserDefaultParameter"},headers:{"content-type":"application/json",accept:"application/json"}}};a.prototype.saveParameterValue=function(e,t,r){var a=new jQuery.Deferred;var s=this._isValidParameterName(e);if(s){var i=this._getXHttpWrapper(r);this._getUserDefaultParameterContainer(r).done(function(r){var s=r.findIndex(function(t){return t.id===e});if(s>-1){r[s].value=JSON.stringify(t)}else{var n={category:"I",containerCategory:"P",containerId:"sap.ushell.UserDefaultParameter",id:e,value:JSON.stringify(t)};r.push(n)}i.post("PersContainers",this._createRequest(r)).then(a.resolve).catch(a.reject)}.bind(this)).fail(a.reject)}else{a.reject('Illegal Parameter Key. Parameter must be less than 40 characters and [A-Za-z0-9.-_]+ :"'+e+'"')}return a.promise()};a.prototype.deleteParameter=function(e,t){var r=new jQuery.Deferred;var a=this._isValidParameterName(e);if(a){var s=this._getXHttpWrapper(t);this._getUserDefaultParameterContainer(t).done(function(t){var a=t.findIndex(function(t){return t.id===e});if(a>-1){t.splice(a,1);s.post("PersContainers",this._createRequest(t)).then(r.resolve).catch(r.reject)}else{r.resolve()}}.bind(this)).fail(r.reject)}else{r.reject('Illegal Parameter Key. Parameter must be less than 40 characters and [A-Za-z0-9.-_]+ :"'+e+'"')}return r.promise()};a.prototype.getStoredParameterNames=function(e){var t=new jQuery.Deferred;this._getUserDefaultParameterContainer(e).done(function(e){var r=e.map(function(e){return e.id});r.sort();t.resolve(r)}).fail(function(e){t.reject(e)});return t.promise()};a.prototype._getXHttpWrapper=function(t){if(!this._mSystems[t.id]){this._mSystems[t.id]={}}if(!this._mSystems[t.id].oHttpWrapper){var r=t.getFullyQualifiedXhrUrl(this.oConfig.sBaseServicePath);this._mSystems[t.id].oHttpWrapper=new e(r,this.oConfig.oHttpClientConfig)}return this._mSystems[t.id].oHttpWrapper};a.prototype._isValidParameterName=function(e){var r=!!(typeof e==="string"&&e.length<=40&&/^[A-Za-z0-9.-_]+$/.exec(e));if(!r){t.error('Illegal Parameter Key. Parameter must be less than 40 characters and [A-Za-z0-9.-_]+ :"'+e+'"')}return r};a.prototype._getUserDefaultParameterContainer=function(e){var t=new jQuery.Deferred;var a;try{a=this._getXHttpWrapper(e)}catch(e){t.reject(e.message);return t.promise()}var s=this._mSystems[e.id];if(!s.oContainerCache){s.oContainerCache=t;var i=a.get("PersContainers(category='P',id='sap.ushell.UserDefaultParameter')?$expand=PersContainerItems");i.then(function(e){s.bDataReceived=true;var t=e.responseText?JSON.parse(e.responseText):{};var a=r.get("d.PersContainerItems.results",t)||[];s.oContainerCache.resolve(a)}).catch(function(e){if(e.status===404){s.oContainerCache.resolve([])}else{var t="Server error: "+e.statusText;s.oContainerCache.reject(t)}})}return s.oContainerCache.promise()};return a},false);
//# sourceMappingURL=UserDefaultParameterPersistenceAdapter.js.map