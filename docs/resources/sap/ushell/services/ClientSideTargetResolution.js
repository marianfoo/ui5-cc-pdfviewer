// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/extend","sap/ushell/ApplicationType","sap/ushell/Config","sap/ushell/navigationMode","sap/ushell/services/_ClientSideTargetResolution/Formatter","sap/ushell/services/_ClientSideTargetResolution/InboundIndex","sap/ushell/services/_ClientSideTargetResolution/InboundProvider","sap/ushell/services/_ClientSideTargetResolution/ParameterMapping","sap/ushell/services/_ClientSideTargetResolution/PrelaunchOperations","sap/ushell/services/_ClientSideTargetResolution/Search","sap/ushell/services/_ClientSideTargetResolution/StagedLogger","sap/ushell/services/_ClientSideTargetResolution/SystemContext","sap/ushell/services/_ClientSideTargetResolution/Utils","sap/ushell/services/_ClientSideTargetResolution/VirtualInbounds","sap/ushell/services/_ClientSideTargetResolution/XAppStateProcessing","sap/ushell/services/AppConfiguration","sap/ushell/TechnicalParameters","sap/ushell/utils","sap/ushell/utils/UrlParsing"],function(e,t,n,r,i,s,o,a,u,l,c,d,f,p,g,h,m,v,b,y,S,j){"use strict";function R(e,t,n,r){this._init.apply(this,arguments)}R.prototype._init=function(t,n,r,i){this._iLogId=0;if(!this._implementsServiceInterface(t)){e.error("Cannot get Inbounds","ClientSideTargetResolutionAdapter should implement getInbounds method","sap.ushell.services.ClientSideTargetResolution");return}this._oInboundProvider=new l(t.getInbounds.bind(t));this._oHaveEasyAccessSystemsDeferreds={userMenu:null,sapMenu:null};this._oServiceConfiguration=i;this._oAdapter=t};R.prototype._implementsServiceInterface=function(e){if(typeof e.getInbounds==="function"){return true}return false};R.prototype._extractInboundFilter=function(e){if(!this._oAdapter.hasSegmentedAccess){return undefined}if(typeof e!=="string"){return undefined}var t=e.indexOf("#")===0?e:"#"+e;var n=j.parseShellHash(t);if(!n||!n.semanticObject||!n.action){return undefined}return[{semanticObject:n.semanticObject,action:n.action}]};R.prototype.resolveHashFragment=function(e){var t=this,n=new jQuery.Deferred,r=this._oAdapter.resolveHashFragmentFallback&&this._oAdapter.resolveHashFragmentFallback.bind(this._oAdapter),i=this._extractInboundFilter(e);this._oInboundProvider.getInbounds(i).then(function(i){t._resolveHashFragment(e,r,i).done(function(e){return n.resolve(e)}).fail(n.reject.bind(n))},function(){n.reject.apply(n,arguments)});return n.promise()};R.prototype.resolveTileIntent=function(e){var t=this,n=new jQuery.Deferred,r=this._extractInboundFilter(e);this._oInboundProvider.getInbounds(r).then(function(r){t._resolveTileIntent(e,undefined,r).done(n.resolve.bind(n)).fail(n.reject.bind(n))},function(){n.reject.apply(n,arguments)});return n.promise()};R.prototype.resolveTileIntentInContext=function(e,t){var n,r=new jQuery.Deferred;n=u.createIndex(e.concat(m.getInbounds()));this._resolveTileIntent(t,undefined,n).done(r.resolve.bind(r)).fail(r.reject.bind(r));return r.promise()};R.prototype._resolveHashFragment=function(t,n,r){var i=this,s=new jQuery.Deferred,o=t.indexOf("#")===0?t:"#"+t,a=j.parseShellHash(o);if(a===undefined){e.error("Could not parse shell hash '"+t+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");return s.reject().promise()}a.formFactor=S.getFormFactor();this._getMatchingInbounds(a,r,{bExcludeTileInbounds:true}).fail(function(n){e.error("Could not resolve "+t,"_getMatchingInbounds promise rejected with: "+n,"sap.ushell.services.ClientSideTargetResolution");s.reject(n)}).done(function(r){var u;if(r.length===0){e.warning("Could not resolve "+t,"rejecting promise","sap.ushell.services.ClientSideTargetResolution");s.reject("Could not resolve navigation target");return}r=i._applySapNavigationScopeFilter(r,a);u=r[0];if(e.getLevel()>=e.Level.DEBUG){var l=function(e,t){return this[e]===undefined?"<undefined>":t};var c=function(e,t){return e==="_original"?undefined:l.call(this,e,t)};var d=JSON.stringify(u,c,"   ");e.debug("The following target will now be resolved",d,"sap.ushell.services.ClientSideTargetResolution")}i._resolveSingleMatchingTarget(u,n,o).done(function(e){s.resolve(e)}).fail(s.reject.bind(s))});return s.promise()};R.prototype._applySapNavigationScopeFilter=function(e,t){var r=t&&t.params&&t.params["sap-navigation-scope-filter"];if(!r){return e}var i=e.filter(function(e){var t=n.get("inbound.signature.parameters",e);var i=t&&t["sap-navigation-scope"];if(i){return r[0]===i.defaultValue.value}return undefined});return i.length>0?i:e};R.prototype._resolveSingleMatchingTarget=function(t,r,a){var u=this,l=new jQuery.Deferred,f=j.parseShellHash(a),p=[f.semanticObject,f.action].join("-"),g=(t.inbound.resolutionResult||{}).applicationType;var h;if(this._oAdapter.resolveSystemAlias){h=this._oAdapter.resolveSystemAlias.bind(this._oAdapter)}var m=!!t.inbound.templateContext;var y=i.getEasyAccessMenuResolver(p,g);if(y&&!m){y(f,t,h,i.WDA.enableWdaCompatibilityMode).then(function(e){var r=o.compute(n.get("inbound.resolutionResult.applicationType",t),(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(b.getCurrentApplication()||{}).applicationType,s.last("/core/navigation/enableInPlaceForClassicUIs"));S.shallowMergeObject(e,r);e.inboundPermanentKey=t.inbound.permanentKey||t.inbound.id;l.resolve(e)},function(e){l.reject(e)});return l.promise()}var R=this._getReservedParameters(t);c.mapParameterNamesAndRemoveObjects(t);sap.ushell.Container.getServiceAsync("AppState").then(function(s){v.mixAppStateIntoResolutionResultAndRename(t,s).done(function(t){var s=function(){return u._constructFallbackResolutionResult.call(u,t,r,a)};if(i[g]){s=i[g].generateResolutionResult}delete t.intentParamsPlusAllDefaults["sap-tag"];delete t.mappedIntentParamsPlusSimpleDefaults["sap-tag"];t.mappedDefaultedParamNames=t.mappedDefaultedParamNames.filter(function(e){return e!=="sap-tag"});var o=n.get("inbound.resolutionResult.url",t);d.executePrelaunchOperations(t,R["sap-prelaunch-operations"]).then(function(){return s(t,o,h)}).then(function(e){e.reservedParameters=R;e.inboundPermanentKey=t.inbound.permanentKey||t.inbound.id;return e}).then(function(n){e.debug("Intent was resolved to the following target",JSON.stringify(t.resolutionResult,null,3),"sap.ushell.services.ClientSideTargetResolution");S.shallowMergeObject(t.resolutionResult,n);l.resolve(t.resolutionResult)},function(e){if(typeof e==="string"&&e.indexOf("fallback:")>=0){u._constructFallbackResolutionResult.call(this,t,r,a).then(function(e){S.shallowMergeObject(t.resolutionResult,e);l.resolve(t.resolutionResult)},l.reject.bind(l))}else{l.reject(e)}})})});return l.promise()};R.prototype._getReservedParameters=function(e){var t=y.getParameters({injectFrom:"startupParameter"}).map(function(e){return e.name});var n=h.extractParameters(t,e.intentParamsPlusAllDefaults);y.getParameters({injectFrom:"inboundParameter"}).forEach(function(t){var r=t.name;var i=e.inbound&&e.inbound.signature&&e.inbound.signature.parameters;if(i&&Object.keys(i).length>0){var s=i[r];var o=s&&s.defaultValue&&s.defaultValue.hasOwnProperty("value");var a=s&&s.filter&&s.filter.hasOwnProperty("value");if(s&&(a||o)){if(o){n[r]=s.defaultValue.value}else{n[r]=s.filter.value}}else{delete n[r]}delete e.intentParamsPlusAllDefaults[r];var u=e.defaultedParamNames.indexOf(r);if(u>=0){e.defaultedParamNames.splice(u,1)}}});return n};R.prototype._resolveTileIntent=function(t,n,r){var i=this,s=new jQuery.Deferred,o=t.indexOf("#")===0?t:"#"+t,a=j.parseShellHash(o);if(a===undefined){e.error("Could not parse shell hash '"+t+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");return s.reject("Cannot parse shell hash").promise()}a.formFactor=S.getFormFactor();this._getMatchingInbounds(a,r,{bExcludeTileInbounds:false}).fail(function(n){e.error("Could not resolve "+t,"_getMatchingInbounds promise rejected with: "+n,"sap.ushell.services.ClientSideTargetResolution");s.reject(n)}).done(function(r){var a;if(r.length===0){e.warning("Could not resolve "+t,"no matching targets were found","sap.ushell.services.ClientSideTargetResolution");s.reject("No matching targets found");return}a=r[0];i._resolveSingleMatchingTileIntent(a,n,o).done(s.resolve.bind(s)).fail(s.reject.bind(s))});return s.promise()};R.prototype._resolveSingleMatchingTileIntent=function(t,s,a){var u=new jQuery.Deferred,l=(t.inbound.resolutionResult||{}).applicationType,d=this;var f;if(this._oAdapter.resolveSystemAlias){f=this._oAdapter.resolveSystemAlias.bind(this._oAdapter)}c.mapParameterNamesAndRemoveObjects(t);sap.ushell.Container.getServiceAsync("AppState").then(function(c){v.mixAppStateIntoResolutionResultAndRename(t,c).done(function(t){var c=function(){return d._constructFallbackResolutionResult.call(d,t,s,a)};if(i[l]){c=i[l].generateResolutionResult}delete t.intentParamsPlusAllDefaults["sap-tag"];delete t.mappedIntentParamsPlusSimpleDefaults["sap-tag"];t.mappedDefaultedParamNames=t.mappedDefaultedParamNames.filter(function(e){return e!=="sap-tag"});var p=n.get("inbound.resolutionResult.url",t);c(t,p,f).then(function(n){S.shallowMergeObject(t.resolutionResult,n);var i=r({},t.inbound.tileResolutionResult);i.startupParameters=t.effectiveParameters;i.navigationMode=t.resolutionResult.navigationMode;if(!i.navigationMode){i.navigationMode=o.getNavigationMode(t.resolutionResult)}u.resolve(i);e.debug("Tile Intent was resolved to the following target",JSON.stringify(i,null,3),"sap.ushell.services.ClientSideTargetResolution")},function(e){u.reject(e)})})});return u.promise()};R.prototype._constructFallbackResolutionResult=function(t,n,i){var s={},o;Object.keys(t.intentParamsPlusAllDefaults).forEach(function(e){if(Array.isArray(t.intentParamsPlusAllDefaults[e])){s[e]=t.intentParamsPlusAllDefaults[e]}});o=t.mappedDefaultedParamNames||t.defaultedParamNames;if(o.length>0){s["sap-ushell-defaultedParameterNames"]=[JSON.stringify(o)]}if(typeof n!=="function"){e.error("Cannot resolve hash fragment",i+" has matched an inbound that cannot be resolved client side and no resolveHashFragmentFallback method was implemented in ClientSideTargetResolutionAdapter","sap.ushell.services.ClientSideTargetResolution");return Promise.reject("Cannot resolve hash fragment: no fallback provided.")}e.warning("Cannot resolve hash fragment client side",i+" has matched an inbound that cannot be resolved client side. Using fallback logic","sap.ushell.services.ClientSideTargetResolution");return new Promise(function(e,o){n(i,r({},t.inbound),s).done(function(t){var n={};["applicationType","additionalInformation","url","applicationDependencies","text"].forEach(function(e){if(t.hasOwnProperty(e)){n[e]=t[e]}});e(n)}).fail(o.bind(null))})};R.prototype.getDistinctSemanticObjects=function(){var e=new jQuery.Deferred;this._oInboundProvider.getInbounds().then(function(t){var n={};t.getAllInbounds().forEach(function(e){if(typeof e.semanticObject==="string"&&e.semanticObject!=="*"&&!e.hideIntentLink&&e.semanticObject.length>0){n[e.semanticObject]=true}});e.resolve(Object.keys(n).sort())},function(){e.reject.apply(e,arguments)});return e.promise()};R.prototype.getLinks=function(n){var i,s=this,o,a,u,l=new jQuery.Deferred,c;if(arguments.length===1&&t(arguments[0])){i=arguments[0];c=r({},i);["action","semanticObject"].forEach(function(e){if(i.hasOwnProperty(e)){c[e]=i[e]}});if(c.appStateKey){c.params=c.params||{};c.params["sap-xapp-state"]=[c.appStateKey];delete c.appStateKey}}else if(arguments.length<=3){e.warning("Passing positional arguments to getLinks is deprecated","Please use nominal arguments instead","sap.ushell.services.ClientSideTargetResolution");o=arguments[0];a=arguments[1];u=arguments[2];c={semanticObject:o,params:a,ignoreFormFactor:u}}else{return l.reject("invalid arguments for getLinks").promise()}this._oInboundProvider.getInbounds().then(function(e){s._getLinks(c,e).done(l.resolve.bind(l)).fail(l.reject.bind(l))},function(){l.reject.apply(l,arguments)});return l.promise()};R.prototype._validateGetSemanticObjectLinksArgs=function(t){var n=t.semanticObject,r=t.action,i=!t.hasOwnProperty("action");if(typeof n!=="undefined"||i){if(typeof n!=="string"){e.error("invalid input for _getLinks","the semantic object must be a string, got "+Object.prototype.toString.call(n)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}if(i&&n.match(/^\s+$/)){e.error("invalid input for _getLinks","the semantic object must be a non-empty string, got '"+n+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}if(!i&&n.length===0){e.error("invalid input for _getLinks","the semantic object must not be an empty string, got '"+n+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}}if(typeof r!=="undefined"){if(typeof r!=="string"){e.error("invalid input for _getLinks","the action must be a string, got "+Object.prototype.toString.call(r)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action"}if(r.length===0){e.error("invalid input for _getLinks","the action must not be an empty string, got '"+r+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action"}}return undefined};R.prototype._getLinks=function(t,r){var i=t.semanticObject,s=t.action,o=t.params,a=!!t.withAtLeastOneUsedParam,u=!!t.treatTechHintAsFilter,l=t.ignoreFormFactor,c=t.hasOwnProperty("sortResultsBy")?t.sortResultsBy:"intent";if(t.hasOwnProperty("sortResultOnTexts")){e.warning("the parameter 'sortResultOnTexts' was experimental and is no longer supported","getLinks results will be sorted by '"+c+"'","sap.ushell.services.ClientSideTargetResolution")}var d={bExcludeTileInbounds:true};var f=this._validateGetSemanticObjectLinksArgs(t);if(t.tags){d.tags=t.tags}if(f){return(new jQuery.Deferred).reject(f).promise()}if(i==="*"){return jQuery.when([])}function p(e){var t=j.paramsToString(e);return t?"?"+t:""}var g=new jQuery.Deferred,m=S.getFormFactor(),v=j.parseParameters(p(o)),b={semanticObject:i===""?undefined:i,action:s,formFactor:l?undefined:m,params:v};if(u){b.treatTechHintAsFilter=true}this._getMatchingInbounds(b,r,d).done(function(r){var s={},o=r.map(function(e){var r=i||e.inbound.semanticObject,o="#"+r+"-"+e.inbound.action,u;if(r==="*"){return undefined}if(e.inbound.action==="*"){return undefined}if(e.inbound&&e.inbound.hasOwnProperty("hideIntentLink")&&e.inbound.hideIntentLink===true){return undefined}if(!s.hasOwnProperty(o)){s[o]={matchingInbound:e.inbound,count:1};if(e.inbound.signature.additionalParameters==="ignored"){u=h.filterObjectKeys(v,function(t){return t.indexOf("sap-")===0||e.inbound.signature.parameters.hasOwnProperty(t)},false)}else{u=v}if(a){var l=Object.keys(u).some(function(e){return e.indexOf("sap-")!==0});if(!l){s[o].hideReason="getLinks called with 'withAtLeastOneUsedParam = true', but the inbound had no business parameters defined.";return undefined}}var c=h.inboundSignatureMeetsParameterOptions(e.inbound.signature.parameters,t.paramsOptions||[]);if(!c){s[o].hideReason="inbound signature does not meet the requested parameter filter options";return undefined}var d={intent:o+p(u),text:e.inbound.title};if(e.inbound.icon){d.icon=e.inbound.icon}if(e.inbound.subTitle){d.subTitle=e.inbound.subTitle}if(e.inbound.shortTitle){d.shortTitle=e.inbound.shortTitle}var f=n.get("inbound.signature.parameters.sap-tag.defaultValue.value",e);if(f){d.tags=[f]}return d}s[o].count++;return undefined}).filter(function(e){return typeof e==="object"});if(c!=="priority"){o.sort(function(e,t){return e[c]<t[c]?-1:1})}if(o.length===0){e.debug("_getLinks returned no results")}else if(e.getLevel()>=e.Level.DEBUG){if(e.getLevel()>=e.Level.TRACE){var u=[];var l=[];o.forEach(function(e){var t=e.intent.split("?")[0];if(s[t].hideReason){l.push(["-",t+"("+s[t].hideReason+")\n"," text:",e.text+"\n"," full intent:",e.intent].join(" "))}else{u.push(["-",t,s[t].count>1?"("+(s[t].count-1)+" others matched)\n":"\n","text:",e.text+"\n","full intent:",e.intent].join(" "))}});e.debug("_getLinks filtered to the following unique intents:","\n"+u.join("\n"),"sap.ushell.services.ClientSideTargetResolution");e.debug("_getLinks would have also returned the following unique intents, but something prevented this:",l.join("\n"),"sap.ushell.services.ClientSideTargetResolution")}else{e.debug("_getLinks filtered to unique intents.","Reporting histogram: \n - "+Object.keys(s).join("\n - "),"sap.ushell.services.ClientSideTargetResolution")}}g.resolve(o)}).fail(g.reject.bind(g));return g.promise()};R.prototype._getMatchingInbounds=function(t,n,r){var i=this,s,o,u,l,c,d,g,h=new jQuery.Deferred;if(r){s=r.tags;d=r.bExcludeTileInbounds}if(e.getLevel()>=e.Level.DEBUG){u=++i._iLogId}p.begin(function(){function e(e){var t=e.action||(typeof e.action==="undefined"?"<any>":"<invalid-value>");var n=e.semanticObject||(typeof e.semanticObject==="undefined"?"<any>":"<invalid-value>");return j.constructShellHash({semanticObject:n,action:t,params:e.params})}var n=e(t);return{logId:u,title:"Matching Intent '"+n+"' to inbounds (form factor: "+(t.formFactor||"<any>")+")",moduleName:"sap.ushell.services.ClientSideTargetResolution",stages:["STAGE1: Find matching inbounds","STAGE2: Resolve references","STAGE3: Rematch with references","STAGE4: Sort matched targets"]}});c=t.semanticObject;o=t.action;this._oShellHash=t;l=s?n.getSegmentByTags(s):n.getSegment(c,o);if(d){g=l.filter(function(e){return!e.tileResolutionResult||!e.tileResolutionResult.isCustomTile})}else{g=l}var m=null;if(this._oAdapter.getContentProviderDataOriginsLookup){m=this._oAdapter.getContentProviderDataOriginsLookup.bind(this._oAdapter)}f.match(t,g,{},m,e.getLevel()>=e.Level.DEBUG).then(function(e){p.log(function(){return{logId:u,stage:1,prefix:"✘",lines:Object.keys(e.noMatchReasons||{}).map(function(t){return t+" "+e.noMatchReasons[t]})}});p.log(function(){var t=e.matchResults.map(function(e){return a.formatInbound(e.inbound)});return{logId:u,stage:1,prefix:t.length>0?"✅":"✘",lines:t.length>0?t:["No inbound was matched"]}});var t={};var n=false;var r=Object.keys(e.missingReferences);r.forEach(function(r){var i=Object.keys(e.missingReferences[r]);n=n||i.length>0;t[r]=i});r=r.filter(function(e){if(t[e].length>0){return true}delete t[e];return false});if(!n){p.log(function(){return{logId:u,stage:2,prefix:"✅",line:"No need to resolve references"}});return(new jQuery.Deferred).resolve({matchResults:e.matchResults,referencesToInclude:null}).promise()}r.forEach(function(e){p.log(function(){return{logId:u,stage:2,line:'@ Must resolve the following references with contentProviderId = "'+e+'":',prefix:"•",lines:t[e]}})});var i=new jQuery.Deferred;sap.ushell.Container.getServiceAsync("ReferenceResolver").then(function(e){var n=r.map(function(e){return this.getSystemContext(e)}.bind(this));return Promise.all(n).then(function(n){var i=r.map(function(r,i){return new Promise(function(s,o){e.resolveReferences(t[r],n[i]).done(s).fail(o)})});return Promise.all(i)})}.bind(this)).then(function(t){var n={matchResults:e.matchResults,referencesToInclude:{}};r.forEach(function(e,r){var i=t[r];n.referencesToInclude[e]=i;if(Object.keys(i).length>0){p.log(function(){return{logId:u,stage:2,line:'✅ resolved references with contentProviderId = "'+e+'" to the following values:',prefix:"•",lines:Object.keys(i).map(function(e){return e+": '"+i[e]+"'"})}})}});i.resolve(n)}).catch(function(e){p.log(function(){return{logId:u,stage:2,prefix:"❌",line:"Failed to resolve references: "+e}});h.resolve([])});return i.promise()}.bind(this)).then(function(e){var n,r,i=e.referencesToInclude;if(!i){p.log(function(){return{logId:u,stage:3,line:"rematch was skipped (no references to resolve)",prefix:"✅"}});return(new jQuery.Deferred).resolve(e).promise()}r=e.matchResults;n=r.map(function(e){return e.inbound});return f.match(t,n,i,m,0).then(function(e){p.log(function(){var t=e.matchResults||[];if(t.length>=1){return{logId:u,stage:3,line:"The following inbounds re-matched:",lines:t.map(function(e){return a.formatInbound(e.inbound)}),prefix:"✅"}}return{logId:u,stage:3,line:"No inbounds re-matched",prefix:"-"}});return e})}).then(function(e){var t=e.matchResults||[];if(t.length<=1){p.log(function(){return{logId:u,stage:4,line:"Nothing to sort"}});h.resolve(t);return}var n=f.sortMatchingResultsDeterministic(e.matchResults||[]);p.log(function(){var e=n.map(function(e){return a.formatInbound(e.inbound||{})+(e.matchesVirtualInbound?" (virtual)":"")+"\n[ Sort Criteria ] "+"\n * 1 * sap-priority: '"+e["sap-priority"]+"'"+"\n * 2 * Sort string: '"+e.priorityString+"\n * 3 * Deterministic blob: '"+f.serializeMatchingResult(e)+"'"});return{logId:u,stage:4,line:"Sorted inbounds as follows:",lines:e,prefix:".",number:true}});h.resolve(n)});return h.promise().then(function(e){p.end(function(){return{logId:u}});return e})};R.prototype._isIntentSupportedOne=function(e,t){var n=new jQuery.Deferred,r=j.parseShellHash(e);if(e==="#"){n.resolve(true);return n.promise()}if(r===undefined){return n.reject("Could not parse shell hash '"+e+"'").promise()}r.formFactor=S.getFormFactor();this._getMatchingInbounds(r,t,{bExcludeTileInbounds:true}).done(function(e){n.resolve(e.length>0)}).fail(function(){n.reject()});return n.promise()};R.prototype.isIntentSupported=function(e){var t=this,n=new jQuery.Deferred;this._oInboundProvider.getInbounds().then(function(r){t._isIntentSupported(e,r).done(n.resolve.bind(n)).fail(n.reject.bind(n))},function(){n.reject.apply(n,arguments)});return n.promise()};R.prototype._isIntentSupported=function(e,t){var n=this,r=new jQuery.Deferred,i={};r.resolve();function s(e,t){i[e]={supported:t}}var o=[];e.forEach(function(e){var i=n._isIntentSupportedOne(e,t);i.fail(function(e){o.push(e)});i.done(function(t){s(e,t)});r=jQuery.when(r,i)});var a=new jQuery.Deferred;r.done(function(){a.resolve(i)}).fail(function(){a.reject("One or more input intents contain errors: "+o.join(", "))});return a.promise()};R.prototype.getUserDefaultParameterNames=function(e){var t=this,n=new jQuery.Deferred;this._oInboundProvider.getInbounds().then(function(r){t._getUserDefaultParameterNames(r.getAllInbounds(),e).then(function(e){n.resolve(e)},function(e){n.reject("Cannot get user default parameters from inbounds: "+e)})},function(){n.reject.apply(n,arguments)});return n.promise()};R.prototype._getUserDefaultParameterNames=function(e,t){var n={simple:{},extended:{}};e=e.filter(function(e){if(e.contentProviderId===undefined&&t.id===""){return true}return e.contentProviderId===t.id});return sap.ushell.Container.getServiceAsync("ReferenceResolver").then(function(t){e.forEach(function(e){var r=e.signature&&e.signature.parameters||[];Object.keys(r).forEach(function(e){var i=r[e],s,o,a;if(i){if(i.filter&&i.filter.format==="reference"){a=i.filter.value}else if(i.defaultValue&&i.defaultValue.format==="reference"){a=i.defaultValue.value}if(typeof a==="string"){s=t.extractUserDefaultReferenceName(a);if(typeof s==="string"){n.simple[s]={}}o=t.extractExtendedUserDefaultReferenceName(a);if(typeof o==="string"){n.extended[o]={}}}}})});return n})};R.prototype.getEasyAccessSystems=function(r){var s={},o,u,l;r=r||"sapMenu";if(this._oHaveEasyAccessSystemsDeferreds[r]){return this._oHaveEasyAccessSystemsDeferreds[r].promise()}this._oHaveEasyAccessSystemsDeferreds[r]=new jQuery.Deferred;l=this._oHaveEasyAccessSystemsDeferreds[r];function c(e,t,n){if(!e){return false}var i=[e.semanticObject,e.action].join("-");return n[r][i]&&e.deviceTypes&&t!==undefined&&e.deviceTypes[t]}o=i.getEasyAccessMenuDefinitions().reduce(function(e,t){var n=t.easyAccessMenu.intent.split("-")[1];e[n]={appType:t.type,priority:t.easyAccessMenu.systemSelectionPriority};return e},{});u={userMenu:i.getEasyAccessMenuDefinitions().reduce(function(e,t){var n=t.easyAccessMenu.intent;e[n]=t.easyAccessMenu.showSystemSelectionInUserMenu;return e},{}),sapMenu:i.getEasyAccessMenuDefinitions().reduce(function(e,t){var n=t.easyAccessMenu.intent;e[n]=t.easyAccessMenu.showSystemSelectionInSapMenu;return e},{})};this._oInboundProvider.getInbounds().then(function(r){var i={};r.getAllInbounds().filter(function(e){return c(e,S.getFormFactor(),u)}).forEach(function(r){var u;if(t(r.signature.parameters["sap-system"])&&r.signature.parameters["sap-system"].hasOwnProperty("filter")){u=n.get("signature.parameters.sap-system.filter.value",r)}if(typeof u==="string"){var l=o[r.action].priority;var c=o[r.action].appType;if(!s[u]){i[u]=-1;s[u]={appType:{}}}if(i[u]<l){s[u].text=r.title;i[u]=l}s[u].appType[c]=true}else{e.warning("Cannot extract sap-system from easy access menu inbound: "+a.formatInbound(r),"This parameter is supposed to be a string. Got '"+u+"' instead.","sap.ushell.services.ClientSideTargetResolution")}});l.resolve(s)},function(){l.reject.apply(l,arguments)});return l.promise()};R.prototype.getSystemContext=function(e){var t=e===undefined?"":e;return new Promise(function(e,n){var r;this._oAdapter.resolveSystemAlias(t).done(function(t){r=g.createSystemContextFromSystemAlias(t);e(r)}).fail(function(e){n(e)})}.bind(this))};R.hasNoAdapter=false;return R},true);
//# sourceMappingURL=ClientSideTargetResolution.js.map