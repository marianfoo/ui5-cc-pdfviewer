// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/Device","sap/ui/thirdparty/jquery"],function(e,t,jQuery){"use strict";function s(s,i,n){var a=n&&n.config||{},r=[],o=false,u=false,l,c;window.oCustomProperties={};this.setLegalText=function(e){l=e;if(c){this.init(c.usageAnalyticsTitle,c.iAgree,c.iDisagree,c.remindMeLater)}};this.getLegalText=function(){return l};this.setTrackUsageAnalytics=function(t){var s=jQuery.Deferred();var i=sap.ushell.Container.getUser();var n=i.getTrackUsageAnalytics();sap.ushell.Container.getServiceAsync("UserInfo").then(function(a){if(n!==t){i.setTrackUsageAnalytics(t);var r=a.updateUserPreferences(i);r.done(function(){i.resetChangedProperty("trackUsageAnalytics");if(!u&&t){this.start()}else if(u&&t===false){window.swa.disable()}else if(u&&t){window.swa.enable()}s.resolve()}.bind(this));r.fail(function(t){i.setTrackUsageAnalytics(n);i.resetChangedProperty("trackUsageAnalytics");e.error(t);s.reject(t)})}else{s.resolve()}}.bind(this)).catch(function(){e.error("Getting UserInfo service failed.");s.reject("Getting UserInfo service failed.")});return s.promise()};this.showLegalPopup=function(){sap.ui.require(["sap/m/Text","sap/m/Dialog","sap/m/Button","sap/m/library"],function(e,s,i,n){var a=n.ButtonType;var r=new s("agreementMessageBox",{title:c.usageAnalyticsTitle,type:"Message",stretch:t.system.phone,buttons:[new i("remindMeLaterButton",{text:c.remindMeLater,press:function(){r.close()}}),new i("iAgreeButton",{text:c.iAgree,type:a.Emphasized,press:function(){this.setTrackUsageAnalytics(true);r.close()}.bind(this)}),new i("iDisagreeButton",{text:c.iDisagree,press:function(){this.setTrackUsageAnalytics(false);r.close()}.bind(this)})],afterClose:function(){r.destroy()},content:new e({text:l})}).addStyleClass("sapUshellUsageAnalyticsPopUp").addStyleClass("sapContrastPlus");r.open()}.bind(this))};this.systemEnabled=function(){if(!a.enabled||!a.pubToken||this.isSetUsageAnalyticsPermitted()&&!l){if(!a.pubToken){e.warning("No valid pubToken was found in the service configuration")}if(!l){e.warning("No Legal text message found.")}return false}return true};this.userEnabled=function(){var e=sap.ushell.Container.getUser();if(!this.systemEnabled()){return false}return e.getTrackUsageAnalytics()};this.start=function(){sap.ui.getCore().getEventBus().publish("sap.ushell.services.UsageAnalytics","usageAnalyticsStarted");this._initUsageAnalyticsLogging();u=true;window.swa.custom2={ref:sap.ui.getCore().getConfiguration().getLanguage()}};this.init=function(e,t,s,i){c={usageAnalyticsTitle:e,iAgree:t,iDisagree:s,remindMeLater:i};if(this.systemEnabled()&&!u){if(!this.isSetUsageAnalyticsPermitted()){this.start()}else if(l){if(this.userEnabled()===true){this.start()}else if(this.userEnabled()===null||this.userEnabled()===undefined){this.showLegalPopup()}}}};this.setCustomAttributes=function(e){var t,s="attribute",i,n="custom",a,r,o="customFunction";if(!this.userEnabled()&&this.isSetUsageAnalyticsPermitted()){return}for(t=1;t<6;t++){a=n.concat(t+4);if(window.swa[a]!==undefined){continue}i=s+t;if(e[i]===undefined){continue}if(jQuery.isFunction(e[i])){r=o+t;window[r]=e[i];window.swa[a]={ref:r}}else{window.swa[a]={ref:e[i]}}}};this.logCustomEvent=function(e,t,s){if(!this.userEnabled()&&this.isSetUsageAnalyticsPermitted()){return}if(!this._isAnalyticsScriptLoaded()){this._addDelayedEvent(e,t,s);return}if(s){s.unshift(t);s.unshift(e);window.swa.trackCustomEvent.apply(window.swa.trackCustomEvent,s)}else{window.swa.trackCustomEvent(e,t)}};window._trackingScriptsLoaded=function(){var e,t;o=true;for(e=0;e<r.length;e++){t=r[e];this.logCustomEvent(t.eventType,t.customEventValue,t.aAdditionalValues)}r=null};this._initUsageAnalyticsLogging=function(){if(window.swa===undefined){window.swa={}}window.swa.pubToken=a.pubToken;window.swa.baseUrl=a.baseUrl;window.swa.bannerEnabled=false;window.swa.loggingEnabled=true;window.swa.visitorCookieTimeout=63113852;window.swa.dntLevel=1;window.swa.trackerReadyCallback=window._trackingScriptsLoaded.bind(this);window.swa.clicksEnabled=a.logClickEvents!==false;window.swa.pageLoadEnabled=a.logPageLoadEvents!==false;this._handlingTrackingScripts()};this._handlingTrackingScripts=function(){var t=document,s=t.createElement("script"),i=t.getElementsByTagName("script")[0];s.onerror=function(){e.warning("SWA scripts not loaded!")};s.defer=true;s.async=true;s.src=window.swa.baseUrl+"js/privacy.js";i.parentNode.insertBefore(s,i)};this._isAnalyticsScriptLoaded=function(){return o};this.isSetUsageAnalyticsPermitted=function(){if(a.setUsageAnalyticsPermitted===undefined){return true}return a.setUsageAnalyticsPermitted};this._addDelayedEvent=function(e,t,s){var i={eventType:e,customEventValue:t,aAdditionalValues:s};r.push(i)}}s.hasNoAdapter=true;return s},true);
//# sourceMappingURL=UsageAnalytics.js.map