// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/Config","sap/m/ActionSheet","sap/m/library","sap/ui/events/PseudoEvents","sap/ushell/library","sap/ui/core/Control","sap/m/GenericTile","sap/ushell/services/_VisualizationInstantiation/VizInstanceRenderer","sap/ushell/resources","sap/m/VBox","sap/m/Button","sap/ui/core/Icon"],function(e,t,i,o,n,s,a,r,l,c,u,p){"use strict";var h=i.FrameType;var d=i.GenericTileScope;var f=i.LoadState;var g=i.TileSizeBehavior;var y=n.DisplayFormat;var m=s.extend("sap.ushell.ui.launchpad.VizInstance",{metadata:{library:"sap.ushell",properties:{title:{type:"string",defaultValue:"",bindable:true},subtitle:{type:"string",defaultValue:"",bindable:true},height:{type:"int",defaultValue:2},width:{type:"int",defaultValue:2},info:{type:"string",defaultValue:"",bindable:true},icon:{type:"sap.ui.core.URI",defaultValue:"",bindable:true},numberUnit:{type:"string",defaultValue:"",bindable:true},state:{type:"sap.m.LoadState",defaultValue:f.Loaded,bindable:true},sizeBehavior:{type:"sap.m.TileSizeBehavior",defaultValue:g.Responsive,bindable:true},editable:{type:"boolean",defaultValue:false,bindable:true},removable:{type:"boolean",defaultValue:true,bindable:true},active:{type:"boolean",defaultValue:false},targetURL:{type:"string"},indicatorDataSource:{type:"object",defaultValue:undefined},dataSource:{type:"object",defaultValue:undefined},keywords:{type:"string[]",defaultValue:[]},instantiationData:{type:"object",defaultValue:{}},contentProviderId:{type:"string",defaultValue:""},vizConfig:{type:"object"},supportedDisplayFormats:{type:"string[]",defaultValue:[y.Standard]},dataHelpId:{type:"string",defaultValue:""},vizRefId:{type:"string",defaultValue:""},displayFormat:{type:"string",defaultValue:y.Standard},preview:{type:"boolean",defaultValue:false}},defaultAggregation:"tileActions",aggregations:{content:{type:"sap.ui.core.Control",multiple:false},tileActions:{type:"sap.m.Button",forwarding:{getter:"_getTileActionSheet",aggregation:"buttons"}}},events:{press:{parameters:{scope:{type:"sap.m.GenericTileScope"},action:{type:"string"}}},beforeActionSheetOpen:{},afterActionSheetClose:{}}},renderer:r});m.prototype.init=function(){this._customTileActions=[];var e=new a({frameType:this._formatPlaceholderFrameType(this.getDisplayFormat()),state:this.getState()});this.setAggregation("content",e)};m.prototype.setDisplayFormat=function(e){this.setProperty("displayFormat",e);this._setSize();var t=this.getContent();if(t.isA("sap.m.GenericTile")){t.setFrameType(this._formatPlaceholderFrameType(e))}return this};m.prototype.setState=function(e){this.setProperty("state",e);var t=this.getContent();if(t.isA("sap.m.GenericTile")){t.setState(e)}return this};m.prototype.setEditable=function(e){this.setProperty("editable",e);this.setTileEditable(e);return this};m.prototype.setTileEditable=function(e){var t=e?d.ActionMore:d.Display;var i=this.getContent();if(i.isA("sap.m.GenericTile")){i.setScope(t)}return this};m.prototype._formatPlaceholderFrameType=function(e){this._setSize();switch(e){case y.Flat:return h.OneByHalf;case y.FlatWide:return h.TwoByHalf;case y.StandardWide:return h.TwoByOne;default:return h.OneByOne}};m.prototype.exit=function(){if(this._oActionModeButtonIconVBox){this._oActionModeButtonIconVBox.destroy()}if(this._oActionDivCenter){this._oActionDivCenter.destroy()}if(this._oActionSheet){this._oActionSheet.destroy()}if(this._oRemoveIconVBox){this._oRemoveIconVBox.destroy()}};m.prototype.getLayout=function(){return{columns:this.getWidth(),rows:this.getHeight()}};m.prototype.setContent=function(e){var t=this.getLayoutData();if(t&&t.isA("sap.f.GridContainerItemLayoutData")){t.setRows(this.getHeight());t.setColumns(this.getWidth());this.getParent().invalidate()}var i=this.getDataHelpId();var o=this.getVizRefId();if(i){e.data("help-id",i,true);e.data("tile-id",i,true)}else{e.data("tile-id",o,true)}this.setAggregation("content",e)};m.prototype._getTileActionSheet=function(){if(!this._oActionSheet){this._oActionSheet=new t;this._oActionSheet.attachAfterClose(this.fireAfterActionSheetClose.bind(this))}return this._oActionSheet};m.prototype._destroyCustomTileActions=function(){this._customTileActions.forEach(function(e){this.removeTileAction(e);e.destroy()}.bind(this));this._customTileActions=[]};m.prototype._addCustomTileActions=function(){if(this._oCustomTileActionsPromise){return this._oCustomTileActionsPromise}this._destroyCustomTileActions();var e=sap.ushell.Container.getRenderer();this._oCustomTileActionsPromise=e.getCustomTileActions(this).then(function(e){e.forEach(function(e){var t=new u(e);this._customTileActions.push(t);this.addTileAction(t)}.bind(this));this._oCustomTileActionsPromise=null}.bind(this));return this._oCustomTileActionsPromise};m.prototype._onActionMenuIconPressed=function(){if(this._oActionModeIcon){if(!this._getTileActionSheet().isOpen()){this.fireBeforeActionSheetOpen()}var t=e.last("/core/extension/enableTileColors");if(t){this._addCustomTileActions()}if(this.getTileActions().length===0){var i=new u({text:"{i18n>tileHasNoActions}",enabled:false});this.addTileAction(i);this.attachEventOnce("afterActionSheetClose",function(){this.removeTileAction(i)})}this._getTileActionSheet().openBy(this._oActionModeIcon)}};m.prototype.getFocusDomRef=function(){if(this.getEditable()){return this._oActionModeIcon&&this._oActionModeIcon.getFocusDomRef()}var e=this.getContent();var t=e.findAggregatedObjects(true,function(e){return e.isA("sap.m.GenericTile")||e.isA("sap.f.Card")});if(t.length){return t[0].getFocusDomRef()}if(this._oComponent&&this._oComponent.findAggregatedObjects){t=this._oComponent.findAggregatedObjects(true,function(e){return e.isA("sap.m.GenericTile")||e.isA("sap.f.Card")});if(t.length){return t[0].getFocusDomRef()}}return e.getFocusDomRef()};m.prototype.onclick=function(e){if(this._preventDefault(e)){this.firePress({scope:"Display",action:"Press"})}else if(this._oRemoveIconVBox&&this._oRemoveIconVBox.getDomRef().contains(e.target)){this.firePress({scope:"Actions",action:"Remove"})}else{this._onActionMenuIconPressed()}};m.prototype.onBeforeRendering=function(){var e=this.getDomRef();if(e){e.removeEventListener("keyup",this._fnKeyupHandler);e.removeEventListener("touchend",this._fnTouchendHandler)}};m.prototype.onAfterRendering=function(){var e=this.getDomRef();this._fnKeyupHandler=this.onkeyup.bind(this);this._fnTouchendHandler=this.onclick.bind(this);e.addEventListener("keyup",this._fnKeyupHandler,true);e.addEventListener("touchend",this._fnTouchendHandler,true)};m.prototype.onkeyup=function(e){if(this.getEditable()){if(o.events.sapdelete.fnCheck(e)||o.events.sapbackspace.fnCheck(e)){this.firePress({scope:"Actions",action:"Remove"})}if(o.events.sapspace.fnCheck(e)||o.events.sapenter.fnCheck(e)){this._preventDefault(e)}}};m.prototype._preventDefault=function(e){if(this.getEditable()){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false}return true};m.prototype.load=function(){return Promise.resolve()};m.prototype._setSize=function(){var e={};switch(this.getDisplayFormat()){case y.Flat:e.width=2;e.height=1;break;case y.FlatWide:e.width=4;e.height=1;break;case y.StandardWide:e.width=4;e.height=2;break;default:e.width=2;e.height=2;break}this.setWidth(e.width);this.setHeight(e.height)};m.prototype.getAvailableDisplayFormats=function(){var e;var t=this.getSupportedDisplayFormats();var i=this.getDisplayFormat();e=t.filter(function(e){return e!==i});var o=e.indexOf("compact");var n=this.getTitle();var s=this.getTargetURL();if(o>-1&&(!n||!s)){e.splice(o,1)}return e};m.prototype._getRemoveIconVBox=function(){if(!this._oRemoveIconVBox){var e=sap.ui.getCore().getLibraryResourceBundle("sap.m");var t=new p({id:this.getId()+"-action-remove",alt:e.getText("GENERICTILE_ACTIONS_ARIA_TEXT"),decorative:false,noTabStop:true,src:"sap-icon://decline",tooltip:l.i18n.getText("removeButtonTitle")}).addStyleClass("sapUshellTileDeleteIconInnerClass sapMPointer");this._oRemoveIconVBox=new c({items:[t]}).addStyleClass("sapUshellTileDeleteIconOuterClass sapUshellTileDeleteClickArea sapMPointer");this._oRemoveIconVBox.setParent(this)}return this._oRemoveIconVBox};m.prototype._getActionModeButtonIconVBox=function(){if(!this._oActionModeButtonIconVBox){var e=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._oActionModeIcon=new p({id:this.getId()+"-action-more",decorative:false,alt:e.getText("LIST_ITEM_NAVIGATION"),noTabStop:true,press:[this._onActionMenuIconPressed,this],src:"sap-icon://overflow",tooltip:l.i18n.getText("configuration.category.tile_actions")}).addStyleClass("sapUshellTileActionIconDivBottomInner sapMPointer");this._oActionModeButtonIconVBox=new c({items:[this._oActionModeIcon]}).addStyleClass("sapUshellTileActionIconDivBottom sapMPointer");this._oActionModeButtonIconVBox.setParent(this)}return this._oActionModeButtonIconVBox};return m});
//# sourceMappingURL=VizInstance.js.map