// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/util/ObjectPath","sap/base/Log"],function(jQuery,e,t){"use strict";var r=["value","extendedValue","noEdit","alwaysAskPlugin","_shellData","pluginData"];function n(e){this._oAdapter=e;this._oData={}}n.prototype._cleanseValue=function(e){var t=jQuery.extend(true,{},e);for(var n in t){if(t.hasOwnProperty(n)&&r.indexOf(n)<0){delete t[n]}}return t};n.prototype._getSystemContextPromise=function(e){if(!e){t.warning("UserDefaultParameterPersistence: The systemContext was not provided, using defaultSystemContext as fallback");return sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(e){return e.getSystemContext()})}return Promise.resolve(e)};n.prototype.loadParameterValue=function(r,n){var i=new jQuery.Deferred;this._getSystemContextPromise(n).then(function(n){var s=e.get([n.id,r],this._oData);if(s!==undefined){i.resolve(s)}else{this._oAdapter.loadParameterValue(r,n).done(function(s){var a=this._cleanseValue(s);e.set([n.id,r],a,this._oData);t.debug('[UserDefaults] Fetched "'+r+'" for SystemContext='+n.id+" from Persistence",JSON.stringify(a,null,2));i.resolve(a)}.bind(this)).fail(i.reject.bind(this))}}.bind(this));return i.promise()};n.prototype.saveParameterValue=function(r,n,i){var s=new jQuery.Deferred;var a;this._getSystemContextPromise(i).then(function(i){if(!n){return this.deleteParameter(r,i).done(s.resolve).fail(s.reject)}a=this._cleanseValue(n);if(n&&n.noStore===true){t.debug('[UserDefaults] Skipped Save "'+r+'" for SystemContext='+i.id,"noStore=true");return s.resolve()}t.debug('[UserDefaults] Saving "'+r+'" for SystemContext='+i.id+" to Persistence",JSON.stringify(a,null,2));e.set([i.id,r],a,this._oData);return this._oAdapter.saveParameterValue(r,a,i).done(s.resolve).fail(s.reject)}.bind(this));return s.promise()};n.prototype.deleteParameter=function(e,r){var n=new jQuery.Deferred;this._getSystemContextPromise(r).then(function(r){if(this._oData[r.id]){t.debug('[UserDefaults] Deleting "'+e+'" for SystemContext='+r.id+" from Persistence");delete this._oData[r.id][e]}return this._oAdapter.deleteParameter(e,r).done(n.resolve).fail(n.reject)}.bind(this));return n.promise()};n.prototype.getStoredParameterNames=function(e){var t=new jQuery.Deferred;this._getSystemContextPromise(e).then(function(e){this._oAdapter.getStoredParameterNames(e).done(function(e){e.sort();t.resolve(e)}).fail(t.reject.bind(t))}.bind(this));return t.promise()};n.hasNoAdapter=false;return n},true);
//# sourceMappingURL=UserDefaultParameterPersistence.js.map