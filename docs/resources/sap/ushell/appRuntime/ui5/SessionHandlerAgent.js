// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/appRuntime/ui5/AppRuntimePostMessageAPI","sap/ushell/appRuntime/ui5/AppRuntimeService","sap/ui/thirdparty/URI","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,s,i,jQuery){"use strict";function n(){this.init=function(){var t=this;e.registerCommunicationHandler("sap.ushell.sessionHandler",{oServiceCalls:{logout:{executeServiceCallFn:function(e){return t.handleLogoutEvent(e)}},extendSessionEvent:{executeServiceCallFn:function(e){return t.handleExtendSessionEvent(e)}}}});this.attachUserEvents();this.userActivityHandler()};this.handleLogoutEvent=function(){var e=new jQuery.Deferred,t=this;this.detachUserEvents();sap.ushell.Container.getFLPUrl(true).then(function(s){if(t.isSameDomain(s,document.URL)===false){sap.ushell.Container.logout().then(e.resolve,e.resolve)}else{e.resolve()}});return e.promise()};this.isSameDomain=function(e,t){var n,o,r=false;try{n=new s(e);o=new s(t);if(n.origin()===o.origin()){r=true}}catch(s){i.error("Check for same domain of iframe and FLP failed: "+e+" "+t,s,"sap.ushell.appRuntime.ui5.SessionHandlerAgent")}return r};this.handleExtendSessionEvent=function(){sap.ushell.Container.sessionKeepAlive();return(new jQuery.Deferred).resolve().promise()};this.attachUserEvents=function(){jQuery(document).on("mousedown.sessionTimeout mousemove.sessionTimeout",this.userActivityHandler.bind(this));jQuery(document).on("keyup.sessionTimeout",this.userActivityHandler.bind(this));jQuery(document).on("touchstart.sessionTimeout",this.userActivityHandler.bind(this))};this.detachUserEvents=function(){jQuery(document).off("mousedown.sessionTimeout mousemove.sessionTimeout");jQuery(document).off("keydown.sessionTimeout");jQuery(document).off("touchstart.sessionTimeout")};this.userActivityHandler=function(e){if(this.oUserActivityTimer!==undefined){return}var s=this;this.oUserActivityTimer=setTimeout(function(){t.sendMessageToOuterShell("sap.ushell.sessionHandler.notifyUserActive",{});s.oUserActivityTimer=undefined},1e3)}}var o=new n;return o});
//# sourceMappingURL=SessionHandlerAgent.js.map