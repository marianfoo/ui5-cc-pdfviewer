// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/ButtonRenderer","sap/m/library","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/ui/launchpad/ActionItem"],function(t,e,n,i,jQuery,a,o,s,l){"use strict";var r=n.ButtonType;var u=l.extend("sap.ushell.ui.footerbar.ContactSupportButton",{metadata:{library:"sap.ushell"},renderer:"sap.m.ButtonRenderer"});u.prototype.init=function(){if(l.prototype.init){l.prototype.init.apply(this,arguments)}this.setIcon("sap-icon://email");this.setText(o.i18n.getText("contactSupportBtn"));this.attachPress(this.showContactSupportDialog);this.setEnabled()};u.prototype.showContactSupportDialog=function(){sap.ui.require(["sap/ui/layout/form/SimpleForm","sap/ui/layout/form/SimpleFormLayout","sap/m/TextArea","sap/m/Input","sap/m/Link","sap/m/Label","sap/m/Text","sap/m/Dialog","sap/m/Button","sap/ushell/UserActivityLog"],function(t,e,n,a,l,u,h,p,d,c){var x="",g="",m="",C=[],f,b;b=function(){this.oDialog.removeContent(this.oBottomSimpleForm.getId());this.oBottomSimpleForm.destroy();if(this.oClientContext.navigationData.applicationInformation){x=this.oClientContext.navigationData.applicationInformation.applicationType;g=this.oClientContext.navigationData.applicationInformation.url;m=this.oClientContext.navigationData.applicationInformation.additionalInformation}C.push(new h({text:this.translationBundle.getText("loginDetails")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));C.push(new u({text:this.translationBundle.getText("userFld")}));C.push(new h({text:this.oClientContext.userDetails.fullName||""}));C.push(new u({text:this.translationBundle.getText("serverFld")}));C.push(new h({text:window.location.host}));if(this.oClientContext.userDetails.eMail&&this.oClientContext.userDetails.eMail!==""){C.push(new u({text:this.translationBundle.getText("eMailFld")}));C.push(new h({text:this.oClientContext.userDetails.eMail||""}))}C.push(new u({text:this.translationBundle.getText("languageFld")}));C.push(new h({text:this.oClientContext.userDetails.Language||""}));if(this.oClientContext.shellState==="app"||this.oClientContext.shellState==="standalone"){C.push(new h({text:""}));C.push(new h({text:this.translationBundle.getText("navigationDataFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));C.push(new u({text:this.translationBundle.getText("hashFld")}));C.push(new h({text:this.oClientContext.navigationData.navigationHash||""}));C.push(new h({text:""}));C.push(new h({text:this.translationBundle.getText("applicationInformationFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));C.push(new u({text:this.translationBundle.getText("applicationTypeFld")}));C.push(new h({text:x}));C.push(new u({text:this.translationBundle.getText("urlFld")}));C.push(new h({text:g}));C.push(new u({text:this.translationBundle.getText("additionalInfoFld")}));C.push(new h({text:m}))}this.oBottomSimpleForm=new t("technicalInfoBox",{layout:e.ResponsiveLayout,content:C}).addStyleClass("sapUshellTechnicalInfoBox");if(i.os.ios&&i.system.phone){this.oBottomSimpleForm.addStyleClass("sapUshellContactSupportFixWidth")}f=this.oBottomSimpleForm.onAfterRendering;this.oBottomSimpleForm.onAfterRendering=function(){f.apply(this,arguments);var t=jQuery(this.getDomRef());t.attr("tabIndex",0);setTimeout(function(){this.focus()}.bind(t),700)};this.oDialog.addContent(this.oBottomSimpleForm)}.bind(this);this._embedLoginDetailsInBottomForm=b;this.translationBundle=o.i18n;this.oClientContext=c.getMessageInfo();this.oLink=new l({text:this.translationBundle.getText("technicalDataLink")});this.oBottomSimpleForm=new t("bottomForm",{editable:false,content:[this.oLink]});this.sendButton=new d("contactSupportSendBtn",{text:this.translationBundle.getText("sendBtn"),type:r.Emphasized,enabled:true,press:function(){this.oSubjectInput.fireChange();this.oTextArea.fireChange();if(this.oSubjectInput.getValueState()!=="Error"&&this.oTextArea.getValueState()!=="Error"){sap.ushell.Container.getServiceAsync("SupportTicket").then(function(t){var e=this.oSubjectInput.getValue();var n=this.oTextArea.getValue();t.createTicket({subject:e,text:n,clientContext:this.oClientContext}).done(function(){sap.ushell.Container.getServiceAsync("Message").then(function(t){t.info(this.translationBundle.getText("supportTicketCreationSuccess"))}.bind(this))}.bind(this)).fail(function(){sap.ushell.Container.getServiceAsync("Message").then(function(t){t.error(this.translationBundle.getText("supportTicketCreationFailed"))}.bind(this))}.bind(this));this.oDialog.close()}.bind(this))}}.bind(this)});this.cancelButton=new d("contactSupportCancelBtn",{text:this.translationBundle.getText("cancelBtn"),press:function(){this.oDialog.close()}.bind(this)});var S=function(t){var e=t.getSource();if(!e.getValue()){if(e.getId()==="subjectInput"){e.setValueStateText(this.translationBundle.getText("subjectEmptyErrorMessage"))}if(e.getId()==="textArea"){e.setValueStateText(this.translationBundle.getText("txtAreaEmptyErrorMessage"))}e.setValueState("Error")}else{e.setValueState("None")}}.bind(this);this.oSubjectLabel=new u("subjectLabel",{text:this.translationBundle.getText("subjectLabel"),required:true});this.oSubjectInput=new a("subjectInput",{});this.oSubjectInput.attachLiveChange(S);this.oSubjectInput.attachChange(S);this.oTextAreaLabel=new u("textAreaLabel",{text:this.translationBundle.getText("txtAreaLabel"),required:true});this.oTextArea=new n("textArea",{rows:7});this.oTextArea.attachLiveChange(S);this.oTextArea.attachChange(S);this.oTopSimpleForm=new t("topForm",{editable:false,content:[this.oSubjectLabel,this.oSubjectInput,this.oTextAreaLabel,this.oTextArea],layout:e.ResponsiveGridLayout});this.oDialog=new p({id:"ContactSupportDialog",title:this.translationBundle.getText("contactSupportBtn"),contentWidth:"29.6rem",leftButton:this.sendButton,rightButton:this.cancelButton,initialFocus:"subjectInput",afterOpen:function(){jQuery("#textArea").on("focusout",function(){window.scrollTo(0,0)})},afterClose:function(){this.oDialog.destroy();if(window.document.activeElement&&window.document.activeElement.tagName==="BODY"){window.document.getElementById("meAreaHeaderButton").focus()}}.bind(this)}).addStyleClass("sapUshellContactSupportDialog").addStyleClass("sapContrastPlus");this.oSubjectInput.setPlaceholder(this.translationBundle.getText("subjectPlaceHolderHeader"));this.oTextArea.setPlaceholder(this.translationBundle.getText("txtAreaPlaceHolderHeader"));this.oLink.attachPress(b.bind(this));this.oDialog.addCustomData(new s({key:"aria-label",value:this.translationBundle.getText("ContactSupportArialLabel"),writeToDom:true}));this.oDialog.addContent(this.oTopSimpleForm);this.oDialog.addContent(this.oBottomSimpleForm);this.oDialog.open()}.bind(this))};u.prototype.setEnabled=function(e){if(!sap.ushell.Container){if(this.getEnabled()){t.warning("Disabling 'Contact Support' button: unified shell container not initialized",null,"sap.ushell.ui.footerbar.ContactSupportButton")}e=false}l.prototype.setEnabled.call(this,e)};return u});
//# sourceMappingURL=ContactSupportButton.js.map