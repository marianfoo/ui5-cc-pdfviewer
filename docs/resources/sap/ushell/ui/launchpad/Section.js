//Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/f/GridContainerItemLayoutData","sap/m/library","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/XMLComposite","sap/ui/events/KeyCodes","sap/ui/model/Filter","sap/ui/thirdparty/jquery","sap/ushell/resources","sap/ushell/ui/launchpad/ExtendedChangeDetection","sap/ushell/library","sap/f/dnd/GridDropInfo","sap/f/GridContainer","sap/ushell/ui/launchpad/section/CompactArea"],function(t,e,a,i,r,o,n,s,l,jQuery,u,p,d,g,f,h){"use strict";var c=i.TileSizeBehavior;var m=o.InvisibleMessageMode;var y=d.DisplayFormat;function v(t,e,a){if(!Array.isArray(e)||!e.length){return null}if(t&&t.getDomRef){t=t.getDomRef()}if(!t){return e[a?e.length-1:0]}function i(t,e){var a=t.left+t.right-e.left-e.right;var i=t.top+t.bottom-e.top-e.bottom;return a*a+i*i}function r(t){var e=t.querySelector(".sapMGTLineStyleHelper");return(e||t).getBoundingClientRect()}var o=r(t);var n=null;var s=0;var l;var u;var p;for(var d=e.length-1;d>=0;d--){u=e[d].getDomRef();if(u){l=r(u);if(!l.width&&!l.height){continue}if(a&&l.top>=o.top||!a&&l.bottom<=o.bottom){continue}p=i(l,o);if(!n||p<s){n=e[d];s=p}}}return n}var b=n.extend("sap.ushell.ui.launchpad.Section",{metadata:{library:"sap.ushell",properties:{editable:{type:"boolean",group:"Misc",defaultValue:false},dataHelpId:{type:"string",group:"Misc",defaultValue:""},default:{type:"boolean",group:"Misc",defaultValue:false},enableAddButton:{type:"boolean",group:"Behavior",defaultValue:true},enableDeleteButton:{type:"boolean",group:"Behavior",defaultValue:true},enableGridBreakpoints:{type:"boolean",group:"Appearance",defaultValue:false},enableGridContainerQuery:{type:"boolean",group:"Appearance",defaultValue:false},enableResetButton:{type:"boolean",group:"Behavior",defaultValue:true},enableShowHideButton:{type:"boolean",group:"Behavior",defaultValue:true},enableVisualizationReordering:{type:"boolean",group:"Behavior",defaultValue:false},noVisualizationsText:{type:"string",group:"Appearance",defaultValue:u.i18n.getText("Section.NoVisualizationsText")},title:{type:"string",group:"Appearance",defaultValue:""},showNoVisualizationsText:{type:"boolean",group:"Behavior",defaultValue:false},showSection:{type:"boolean",group:"Misc",defaultValue:true},showLinks:{type:"boolean",group:"Behavior",defaultValue:true},sizeBehavior:{type:"sap.m.TileSizeBehavior",group:"Misc",defaultValue:c.Responsive},gridContainerGap:{type:"string",group:"Appearance",defaultValue:"0.5rem"},gridContainerGapXS:{type:"string",group:"Appearance",defaultValue:"0.475rem"},gridContainerGapS:{type:"string",group:"Appearance",defaultValue:"0.475rem"},gridContainerGapM:{type:"string",group:"Appearance",defaultValue:"0.5rem"},gridContainerGapL:{type:"string",group:"Appearance",defaultValue:"0.5rem"},gridContainerGapXL:{type:"string",group:"Appearance",defaultValue:"0.5rem"},gridContainerRowSize:{type:"string",group:"Appearance",defaultValue:"5.25rem"},gridContainerRowSizeXS:{type:"string",group:"Appearance",defaultValue:"4.375rem"},gridContainerRowSizeS:{type:"string",group:"Appearance",defaultValue:"5.25rem"},gridContainerRowSizeM:{type:"string",group:"Appearance",defaultValue:"5.25rem"},gridContainerRowSizeL:{type:"string",group:"Appearance",defaultValue:"5.25rem"},gridContainerRowSizeXL:{type:"string",group:"Appearance",defaultValue:"5.25rem"},_duringDrag:{type:"boolean",group:"Behavior",defaultValue:false}},defaultAggregation:"visualizations",aggregations:{visualizations:{type:"sap.ui.core.Control",bindable:"bindable",multiple:true},defaultItems:{type:"sap.ui.core.Control",multiple:true,forwarding:{idSuffix:"--defaultArea",aggregation:"items",forwardBinding:false},dnd:true},flatItems:{type:"sap.ui.core.Control",multiple:true,forwarding:{idSuffix:"--flatArea",aggregation:"items",forwardBinding:false},dnd:true},compactItems:{type:"sap.ui.core.Control",multiple:true,forwarding:{idSuffix:"--compactArea",aggregation:"items",forwardBinding:false},dnd:true}},events:{add:{},delete:{},reset:{},titleChange:{},visualizationDrop:{parameters:{draggedControl:{type:"sap.ui.core.Control"},droppedControl:{type:"sap.ui.core.Control"},dropPosition:{type:"string"}}},areaDragEnter:{parameters:{originalEvent:{type:"sap.ui.base.Event"},dragControl:{type:"sap.ui.core.Control"},sourceArea:{type:"string"},targetArea:{type:"string"}}},sectionVisibilityChange:{parameters:{visible:{type:"boolean"}}},borderReached:{parameters:{event:{type:"jQuery.Event"}}}}},resourceModel:u.i18nModel});function C(e){for(var a in y){if(e.displayFormatHint===y[a]){return y[a]}}if(e.displayFormatHint&&e.displayFormatHint!=="tile"){t.error("DisplayFormat '"+e.displayFormatHint+"' not valid - 'standard' is used")}return y.Standard}function A(){return new l({path:"",caseSensitive:true,test:function(t){var e=C(t);return e===y.Standard||e===y.StandardWide}})}function I(){return new l({path:"",caseSensitive:true,test:function(t){var e=C(t);return e===y.Flat||e===y.FlatWide}})}function V(){return new l({path:"",caseSensitive:true,test:function(t){return C(t)===y.Compact}})}b.prototype.bindAggregation=function(a,i){if(a==="visualizations"){if(i.filters){t.error("bind visualizations with pre-existing filters is not implemented.")}var r=e(i);r.filters=A();n.prototype.bindAggregation.call(this,"defaultItems",r);var o=e(i);o.filters=I();n.prototype.bindAggregation.call(this,"flatItems",o);var s=e(i);s.filters=V();n.prototype.bindAggregation.call(this,"compactItems",s)}else{n.prototype.bindAggregation.call(this,a,i)}return this};b.prototype.getAllItems=function(){return this.getDefaultItems().concat(this.getFlatItems(),this.getCompactItems())};b.prototype.getVisualizations=function(){var t=this.getAllItems();t.sort(function(t,e){var a=t.getBindingContext().getPath();var i=parseInt(a.split("/").pop(),10);a=e.getBindingContext().getPath();var r=parseInt(a.split("/").pop(),10);return i<r?-1:1});return t};b.prototype.filterVisualizations=function(t){var e=t?new l({filters:[A(),t],and:true}):A();var a=t?new l({filters:[I(),t],and:true}):I();var i=t?new l({filters:[V(),t],and:true}):V();this.getBinding("defaultItems").filter(e);this.getBinding("flatItems").filter(a);this.getBinding("compactItems").filter(i)};b.prototype.indexOfVisualization=function(t){return this.getVisualizations().indexOf(t)};b.prototype.addVisualization=function(e,a){t.error("Section.prototype.addVisualization should not be called");return this.addAggregation("visualizations",e,a)};b.prototype.insertVisualization=function(e,a,i){t.error("Section.prototype.insertVisualization should not be called");return this.insertAggregation("visualizations",e,a,i)};b.prototype.removeVisualization=function(e,a){t.error("Section.prototype.removeVisualization should not be called");return this.removeAggregation("visualizations",e,a)};b.prototype.onBorderReached=function(t){var e;var a=t.getParameter("event");var i=a.keyCode;var r=a.type;var o=jQuery(a.target.firstElementChild).control(0);switch(i){case s.ARROW_UP:e=this.getClosestVizualization(o,true);break;case s.ARROW_DOWN:e=this.getClosestVizualization(o,false);break;case s.ARROW_LEFT:case s.ARROW_RIGHT:return;default:break}if(e){this._focusItem(this.getItemPosition(e));a.preventDefault()}else{this.fireBorderReached({event:t,section:this,direction:r==="sapnext"?"down":"up"})}};b.prototype.handleEmptyContentAreas=function(){var t=!!this.getDefaultItems().length,e=!!this.getFlatItems().length,a=!!this.getCompactItems().length,i=!t&&!a&&!e;this.oVBox.toggleStyleClass("sapUshellSectionNoVisualizations",i);this.oDefaultArea.toggleStyleClass("sapUshellSectionDefaultArea",t);this.oFlatArea.toggleStyleClass("sapUshellSectionFlatArea",e);var r=this.oVBox.getDomRef&&this.oVBox.getDomRef();if(r&&this.getEditable()&&this.getShowNoVisualizationsText()&&i){r.setAttribute("aria-describedBy",this.byId("noVisualizationsText").getId())}else if(r){r.removeAttribute("aria-describedBy")}};b.prototype.init=function(){this.oVBox=this.byId("content");this.oDefaultArea=this.byId("defaultArea");this.oFlatArea=this.byId("flatArea");this.oCompactArea=this.byId("compactArea");this.oNoVisualizationsText=this.byId("noVisualizationsText");this.oCompactArea.setVisible(true);var t=function(){var t=this.oVBox.getDomRef();if(t){var e;if(this.getTitle().trim()){e=u.i18n.getText("Section.Description",this.getTitle())}else{e=u.i18n.getText("Section.Description.EmptySectionTitle")}t.setAttribute("aria-label",e)}}.bind(this);this.oVBox.addEventDelegate({onBeforeRendering:function(){this.byId("title-edit").detachChange(t)}.bind(this),onAfterRendering:function(){var e=this.oVBox.getDomRef();if(this.getEditable()){e.setAttribute("tabindex","0")}t();e.setAttribute("role","group");this.byId("title-edit").attachChange(t)}.bind(this)});this.oDefaultArea.addEventDelegate({onAfterRendering:this.handleEmptyContentAreas.bind(this)});this.oFlatArea.addEventDelegate({onAfterRendering:this.handleEmptyContentAreas.bind(this)});this.oCompactArea.addEventDelegate({onAfterRendering:this.handleEmptyContentAreas.bind(this)});this.oDefaultArea.attachBorderReached(this.onBorderReached.bind(this));this.oFlatArea.attachBorderReached(this.onBorderReached.bind(this));this.oCompactArea.attachBorderReached(this.onBorderReached.bind(this));this._oInvisibleMessageInstance=r.getInstance();this._oDefaultItemsChangeDetection=new p("defaultItems",this,["flatItems","compactItems"]);this._oFlatItemsChangeDetection=new p("flatItems",this,["defaultItems","compactItems"]);this._oCompactItemsChangeDetection=new p("compactItems",this,["defaultItems","flatItems"]);this._fnGlobalDragStart=function(){this.setProperty("_duringDrag",true)}.bind(this);this._fnGlobalDragEnd=function(){this.setProperty("_duringDrag",false)}.bind(this);document.addEventListener("dragstart",this._fnGlobalDragStart,false);document.addEventListener("dragend",this._fnGlobalDragEnd,false)};b.prototype.destroy=function(){n.prototype.destroy.apply(this,arguments);this._oDefaultItemsChangeDetection.destroy();this._oFlatItemsChangeDetection.destroy();this._oCompactItemsChangeDetection.destroy();document.removeEventListener("dragstart",this._fnGlobalDragStart,false);document.removeEventListener("dragend",this._fnGlobalDragEnd,false);if(this.oCompactItemsNavigation){this.oCompactArea.removeDelegate(this.oCompactItemsNavigation);this.oCompactItemsNavigation.destroy();this.oCompactItemsNavigation=null}if(this._oInvisibleMessageInstance){this._oInvisibleMessageInstance.destroy()}n.prototype.destroy.apply(this,arguments)};b.prototype.setEditable=function(t){if(t===undefined||this.getEditable()===t){return this}this.setProperty("editable",!!t,true);this.oVBox.toggleStyleClass("sapUshellSectionEdit",!!t);return this};b.prototype._showHidePressed=function(t){var e=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._oInvisibleMessageInstance.announce([u.i18n.getText(t?"Section.nowBeingShown":"Section.nowBeingHidden"),u.i18n.getText("Section.ButtonLabelChanged"),u.i18n.getText(t?"Section.Button.Hide":"Section.Button.Show"),e.getText("ACC_CTR_TYPE_BUTTON")].join(" "),m.Polite);this.setShowSection(t)};b.prototype.setShowSection=function(t){if(t===undefined||this.getShowSection()===t){return this}this.setProperty("showSection",t,true);this.oVBox.toggleStyleClass("sapUshellSectionHidden",!t);this.fireSectionVisibilityChange({visible:t});return this};b.prototype._reorderVisualizations=function(t){this.fireVisualizationDrop(t.getParameters())};b.prototype.getClosestVizualization=function(t,e){var a=this.getAllItems();return v(t,a,e)};b.prototype.getClosestVizIndex=function(t,e){var a=this.getClosestVizualization(t,e);return a?this.indexOfVisualization(a):-1};b.prototype.getClosestCompactItemIndex=function(t,e){var a=v(t,this.getCompactItems(),e);if(a){return this.indexOfVisualization(a)}return e?this.getVisualizations().length:0};b.prototype._onDragEnter=function(t){var e=t.getParameter("dragSession");var a=e.getDragControl();var i=a.getParent();var r=e.getDropControl&&e.getDropControl();if(!r){return}if(!r.data("area")){r=r.getParent()}if(r.data("default")&&!i.data("default")){t.preventDefault()}this.fireAreaDragEnter({originalEvent:t,dragControl:a,sourceArea:i.data("area"),targetArea:r.data("area")})};b.prototype.addAggregation=function(t,e){if(t==="defaultItems"||t==="flatItems"){this._addVisualizationLayoutData(e)}n.prototype.addAggregation.apply(this,arguments);this.handleEmptyContentAreas();return this};b.prototype.insertAggregation=function(t,e){if(t==="defaultItems"||t==="flatItems"){this._addVisualizationLayoutData(e,t)}n.prototype.insertAggregation.apply(this,arguments);this.handleEmptyContentAreas();return this};b.prototype._getVisualizationLayoutData=function(t){if(t.getLayout){return t.getLayout()}return{rows:2,columns:2}};b.prototype._getFlatVisualizationLayoutData=function(t){if(t.getLayout){return t.getLayout()}return{rows:1,columns:2}};b.prototype._addVisualizationLayoutData=function(t,e){if(!t.getLayoutData()){var i=e==="defaultItems"?this._getVisualizationLayoutData(t):this._getFlatVisualizationLayoutData(t);t.setLayoutData(new a(i))}};b.prototype._getDefaultDropIndicatorSize=function(t){return this._getDropIndicatorSize(t,y.Standard)};b.prototype._getFlatDropIndicatorSize=function(t){return this._getDropIndicatorSize(t,y.Flat)};b.prototype._getDropIndicatorSize=function(t,e){var a=t.getParent();var i=a&&a.data("area");if(e===i&&t.getLayoutData){var r=t.getLayoutData();return{rows:r.getRows(),columns:r.getColumns()}}var o={};var n=[];if(t.getSupportedDisplayFormats){n=t.getSupportedDisplayFormats()}if(e===y.Flat){o.rows=1;o.columns=2;if(!n.includes(y.Flat)&&n.includes(y.FlatWide)){o.columns=4}}else{o.rows=2;o.columns=2;if(!n.includes(y.Standard)&&n.includes(y.StandardWide)){o.columns=4}}return o};b.prototype.getItemPosition=function(t){if(isFinite(t)){t=this.getVisualizations()[t]}var e=this.oDefaultArea.getItems().indexOf(t);if(e>=0){return{index:e,area:y.Standard}}e=this.oFlatArea.getItems().indexOf(t);if(e>=0){return{index:e,area:y.Flat}}e=this.oCompactArea.getItems().indexOf(t);if(e>=0){return{index:e,area:y.Compact}}return{index:-1,area:y.Standard}};b.prototype._focusItem=function(t){window.setTimeout(function(){var e=t&&t.area?t.area:y.Standard;var a=t&&t.index?t.index:t;var i=this.oDefaultArea.getItems().length;var r=this.oFlatArea.getItems().length;var o=this.oCompactArea.getItems().length;if(isNaN(a)||a<0){a=0}if(e===y.Standard&&i===0){e=y.Flat}if(e===y.Flat&&r===0){e=y.Compact}if(e===y.Compact&&o===0){e=y.Standard}if(i+r+o===0){e="section"}switch(e){case"section":this.focus();break;case y.Flat:if(a>=r){a=r-1}this.oFlatArea.focusItem(a);break;case y.Compact:this.oCompactArea.focusItem(a);break;default:if(a>=i){a=i-1}this.oDefaultArea.focusItem(a);break}}.bind(this),0)};b.prototype.focusVisualization=function(t){var e;if(!this.getShowSection()&&!this.getEditable()){return false}var a=this.getAllItems();if(!a.length){return false}if(t&&t.area){this._focusItem(t);return true}if(t&&t.getMetadata){e=t}if(!e&&t&&t.keycode){switch(t.keycode){case s.ARROW_UP:e=this.getClosestVizualization(t.ref,true);break;case s.ARROW_DOWN:e=this.getClosestVizualization(t.ref,false);break;case s.ARROW_LEFT:t=-1;break;default:break}}if(!e&&t===-1){e=a[a.length-1]}if(!e){e=a[0]}this._focusItem(this.getItemPosition(e));return true};return b});
//# sourceMappingURL=Section.js.map